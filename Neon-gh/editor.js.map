{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/events/events.js","webpack:///./node_modules/inherits/inherits_browser.js","webpack:///./node_modules/immediate/lib/browser.js","webpack:///external \"d3\"","webpack:///./src/utils/SelectTools.ts","webpack:///./node_modules/argsarray/index.js","webpack:///./node_modules/jsonschema/lib/helpers.js","webpack:///./src/DisplayPanel/DisplayControls.ts","webpack:///./src/utils/Notification.ts","webpack:///./src/utils/Color.ts","webpack:///./src/SquareEdit/SelectOptions.ts","webpack:///./src/utils/DragHandler.ts","webpack:///./node_modules/spark-md5/spark-md5.js","webpack:///./src/utils/random.ts","webpack:///(webpack)/buildin/global.js","webpack:///./node_modules/url/url.js","webpack:///./node_modules/jsonschema/lib/scan.js","webpack:///./src/SquareEdit/Contents.ts","webpack:///./src/utils/Select.ts","webpack:///./node_modules/pouchdb/lib/index-browser.es.js","webpack:///./src/NeonView.ts","webpack:///./node_modules/pouchdb/node_modules/uuid/index.js","webpack:///./node_modules/vuvuzela/index.js","webpack:///./src/DisplayPanel/DisplayPanel.ts","webpack:///./src/DivaView.ts","webpack:///./src/SingleView/SingleView.ts","webpack:///./src/SquareEdit/DivaEditMode.ts","webpack:///./src/SquareEdit/SingleEditMode.ts","webpack:///./src/InfoModule.ts","webpack:///./src/TextView.ts","webpack:///./src/TextEditMode.ts","webpack:///./src/utils/ConvertMei.ts","webpack:///./node_modules/pouchdb/node_modules/uuid/lib/rng-browser.js","webpack:///./node_modules/pouchdb/node_modules/uuid/lib/bytesToUuid.js","webpack:///./src/SquareEdit/Controls.ts","webpack:///./src/SquareEdit/Grouping.ts","webpack:///./src/utils/Resize.ts","webpack:///./src/SquareEdit/InsertHandler.ts","webpack:///./deployment/pages/editor.js","webpack:///./src/NeonCore.ts","webpack:///./src/Validation.ts","webpack:///./src/VerovioWrapper.ts","webpack:///./node_modules/process/browser.js","webpack:///./node_modules/pouchdb/node_modules/uuid/v1.js","webpack:///./node_modules/pouchdb/node_modules/uuid/v4.js","webpack:///./src/utils/NeonManifest.ts","webpack:///./node_modules/jsonschema/lib/index.js","webpack:///./node_modules/jsonschema/lib/validator.js","webpack:///./node_modules/node-libs-browser/node_modules/punycode/punycode.js","webpack:///(webpack)/buildin/module.js","webpack:///./node_modules/url/util.js","webpack:///./node_modules/querystring-es3/index.js","webpack:///./node_modules/querystring-es3/decode.js","webpack:///./node_modules/querystring-es3/encode.js","webpack:///./node_modules/jsonschema/lib/attribute.js","webpack:///./src/utils/EditControls.ts","webpack:///./src/utils/EditContents.ts","webpack:///./src/utils/template/Template.ts","webpack:///./src/SingleView/Zoom.ts","webpack:///./src/Warnings.ts","webpack:///./src/SquareEdit/StaffTools.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","EventEmitter","init","this","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","type","prepend","events","existing","warning","newListener","emit","unshift","push","length","warned","w","Error","String","emitter","count","console","warn","onceWrapper","fired","removeListener","wrapFn","arguments","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","err","message","context","handler","len","listeners","addListener","on","prependListener","once","prependOnceListener","list","position","originalListener","shift","index","pop","spliceOne","off","removeAllListeners","keys","rawListeners","eventNames","ctor","superCtor","super_","constructor","writable","configurable","TempCtor","scheduleDrain","draining","Mutation","global","MutationObserver","WebKitMutationObserver","called","observer","nextTick","element","document","createTextNode","observe","characterData","data","setImmediate","MessageChannel","createElement","scriptEl","onreadystatechange","parentNode","removeChild","documentElement","appendChild","setTimeout","channel","port1","onmessage","port2","postMessage","queue","oldQueue","task","d3","getSelectionType","getElementsByClassName","id","unselect","querySelectorAll","forEach","selected","classList","remove","contains","removeAttribute","Color","unhighlight","style","fill","from","el","color","fontWeight","sylRect","syllable","add","selectAll","getElementById","SelectOptions","endOptionsSelection","Grouping","endGroupingSelection","innerHTML","updateHighlight","select","dragHandler","selectStaff","sylId","elem","closest","span","async","isLigature","nc","neonView","getElementAttr","view","getCurrentPageURI","sharedSecondLevelParent","elements","tempElements","secondParent","parentElement","selectBBox","bbox","syl","resize","dragInit","querySelector","staff","highlight","parent","prevNc","previousSibling","nextNc","nextSibling","triggerGrouping","triggerNcActions","ulx","uly","lrx","lry","rotate","path","coordinates","getAttribute","match","map","Math","atan","min","max","notNeumes","nn","selectionType","selectionClass","containsClefOrCustos","groupsToSelect","Set","grouping","follows","slice","precedes","group","groups","values","size","triggerClefActions","triggerCustosActions","triggerDefaultSylActions","triggerDefaultActions","triggerSplitActions","triggerStaffActions","triggerSylActions","staff0","staff1","staffChildren","children","abs","indexOf","firstStaff","secondStaff","firstLayer","secondLayer","firstSyllableChildren","filter","secondSyllableChildren","lastSyllable","firstSyllable","triggerNeumeActions","posFirstY","posSecondY","x","baseVal","y","isFirstLigature","isSecondLigature","g","fun","uri","ValidationError","instance","schema","propertyPath","argument","stack","toString","ValidatorResult","options","ctx","errors","throwError","disableFormat","stringizer","v","addError","detail","importErrors","res","validatorType","join","SchemaError","msg","captureStackTrace","SchemaContext","base","schemas","resolve","makeChild","propertyName","makeSuffix","FORMAT_REGEXPS","input","parseFloat","parseInt","result","RegExp","e","regexp","regex","pattern","ipv4","isFormat","format","validator","test","customFormats","JSON","stringify","deepMerger","dst","deepMerge","copyist","src","copyistWithDeepMerge","array","isArray","pathEncoder","encodeURIComponent","replace","deepCompareStrict","a","b","every","aKeys","bKeys","objectGetPath","k","parts","split","decodeURIComponent","encodePath","getDecimalPlaces","number","decimalPlaces","decimalParts","lastGlyphOpacity","lastImageOpacity","setHighlightControls","highlightDropdown","highlightStaff","highlightSyllable","highlightNeume","highlightNone","highlightType","addEventListener","evt","stopPropagation","toggle","body","highlightClickaway","textContent","setGroupingHighlight","unsetGroupingHighlight","removeEventListener","meiClassName","background","opacitySlider","opacityOutput","inputChangeOpacity","opacity","lowerOpacity","newOpacity","round","setOpacityControls","bgOpacitySlider","bgOpacityOutput","bgInputChangeHandler","setBackgroundOpacityControls","displayContents","toggleDisplay","display","setAttribute","zoomHandler","zoomSlider","zoomOutput","inputChangeHandler","zoomTo","resetZoomAndPan","currentZoom","newZoom","highlightSelection","highlightId","notifications","currentModeMessage","notifying","startNotification","currentNotification","notification","isModeMessage","window","clearTimeout","timeoutID","clearOrShowNextNotification","getId","notificationContent","displayNotification","setTimeoutId","currentId","notif","Notification","displayed","uuidv4","search","ColorPalette","tagName","rects","rect","unsetStaffHighlight","child","cchild","width","height","stroke","debug","setStaffHighlight","staves","staffColor","groupColor","unsetInclinatumAction","unsetVirgaAction","removeHandler","toRemove","chainAction","edit","then","updateForCurrentPage","changeStaffHandler","toChange","moreEdit","deleteButtonHandler","initOptionsListeners","preventDefault","initNeonView","Contents","custosActionContents","extraEdit","ncActionContents","unsetInclinatum","unsetVirga","queueNotification","setInclinatum","setVirga","del","neumeActionContents","neume","contour","changeGroupingAction","triggerChangeGroup","info","getContourByValue","initGroupingListeners","clef","clefActionContents","setCClef","setFClef","staffActionContents","systems","elementIds","editorAction","splitActionContents","SplitHandler","startSplit","co","points","getStaffBBox","y_change","tan","defaultSylActionContents","changeStaff","defaultActionContents","default","selector","dragBehaviour","drag","dragStartCoords","event","dx","dy","sourceEvent","dragging","dragEnded","activeNc","selection","relativeY","relativeX","attr","paramArray","singleAction","action","param","elementId","xDiff","yDiff","reset","resetToAction","hex_chr","md5cycle","md5blk","md5blks","charCodeAt","md5blk_array","md51","tail","tmp","lo","hi","substring","rhex","j","hex","toUtf8","str","unescape","hexToBinaryString","bytes","substr","fromCharCode","SparkMD5","ArrayBuffer","clamp","val","to","num","targetArray","sourceArray","byteLength","begin","end","Uint8Array","append","appendBinary","contents","_buff","_length","_hash","raw","buff","_finish","getState","hash","setState","destroy","hashBinary","content","first","second","returnUInt8Array","buffer","subarray","utf8Str2ArrayBuffer","md51_array","factory","uint8ToUuid","cb","previous","current","padStart","reduce","crypto","octets","modifiers","getRandomValues","punycode","util","Url","protocol","slashes","auth","host","port","hostname","query","pathname","href","parse","urlParse","source","relative","resolveObject","obj","isString","protocolPattern","portPattern","simplePathPattern","unwise","autoEscape","nonHostChars","hostEndingChars","hostnamePartPattern","hostnamePartStart","unsafeProtocol","hostlessProtocol","slashedProtocol","querystring","url","parseQueryString","slashesDenoteHost","isObject","u","queryIndex","splitter","uSplit","rest","trim","simplePath","exec","proto","lowerProto","toLowerCase","atSign","hostEnd","hec","lastIndexOf","parseHost","ipv6Hostname","hostparts","part","newpart","validParts","notHost","bit","toASCII","h","ae","esc","escape","qm","charAt","rel","tkeys","tk","tkey","rkeys","rk","rkey","relPath","isSourceAbs","isRelAbs","mustEndAbs","removeAllDots","srcPath","psychotic","isNullOrUndefined","authInHost","isNull","last","hasTrailingSlash","up","splice","isAbsolute","urilib","helpers","SchemaScanResult","found","ref","scan","scanSchema","baseuri","$ref","resolvedUri","ourBase","scanArray","items","extends","additionalItems","scanObject","properties","additionalProperties","definitions","patternProperties","dependencies","disallow","allOf","anyOf","oneOf","not","insertTabHtml","primitiveTab","groupingTab","systemTab","insertControlsPanel","editControlsPanel","groupingMenu","strokeWidth","escapeKeyListener","infoListeners","isSelByBBox","selByBBox","stopPropHandler","clickHandler","getUserMode","shiftKey","firstLigatureHalf","secondLigatureHalf","ncIndex","firstUse","assert","secondUse","navigator","userAgent","metaKey","ctrlKey","includes","container","pt","createSVGPoint","clientX","clientY","transformMatrix","getScreenCTM","matrixTransform","inverse","selectedStaves","dispatchEvent","MouseEvent","screenX","screenY","altKey","nv","dh","sel","initialX","initialY","panning","dragSelecting","canvas","dragSelectAction","userMode","nodeName","startDrag","mouse","initialP","currentPt","curX","curY","newX","newY","currentWidth","currentHeight","updateRect","rx","ry","lx","ly","node","ul","lr","transform","multiply","box","getBBox","resetTo","ExportedSet","ExportedMap","mangle","unmangle","Map$1","_store","Set$1","cloneBinaryObject","cloneArrayBuffer","webkitSlice","mangled","has","delete","Map","prop","getOwnPropertyDescriptor","species","supportsMapAndSet","funcToString","objectCtorString","clone","newObject","Date","toISOString","Blob","isBinaryObject","Ctor","isPlainObject","toPromise","func","self","usedCB","promise","Promise","fulfill","reject","resp","callback","mesg","adapterFun","_closed","_destroyed","logArgs","origCallback","responseArgs","logApiCall","taskqueue","isReady","addTask","failed","pick","hasLocal","identityFunction","formatResultForOpenRevsGet","ok","bulkGet","db","opts","requests","docs","requestsById","request","numDocs","numDone","perDocResults","checkDone","results","allRequests","nextBatch","upTo","batch","offset","docId","docIdx","docRequests","docOpts","open_revs","rev","formatResult","processBatch","localStorage","setItem","getItem","hasLocalStorage","Changes","guardedConsole","method","defaultBackOff","maxTimeout","random","randomNumber","explainError","status","dbName","inprogress","eventFunction","changesOpts","changes","seq","since","cancelled","onChange","notifyLocalWindows","notify","$inject_Object_assign","assign","nextSource","nextKey","PouchError","reason","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","UNKNOWN_ERROR","BAD_ARG","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","IDB_ERROR","INVALID_REV","MISSING_STUB","createError","CustomPouchError","generateErrorFromResponse","filterChange","req","hasFilter","query_params","change","doc","filterReturn","tryFilter","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","isRemote","_remote","parseDesignDocFunctionName","normalizeDesignDocFunctionName","normalized","qParser","parser","parseUri","encoded","$0","$1","$2","scopeEval","scope","upsert","diffFun","docRev","_rev","newDoc","updated","_id","put","tryAndPut","thisAtob","atob","thisBtoa","btoa","createBlob","builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","getBlob","binaryStringToArrayBuffer","bin","buf","binStringToBluffer","binString","b64ToBluffer","b64","readAsBinaryString","blob","reader","FileReader","hasBinaryString","onloadend","binary","arrayBufferToBinaryString","readAsArrayBuffer","blobToBinaryString","blobOrBuffer","blobToBase64","base64","setImmediateShim","appendBlob","start","sliceBlob","arrayBuffer","appendString","string","binaryMd5","inputIsString","chunkSize","chunks","ceil","currentChunk","next","loadNextChunk","done","rawToBase64","stringMd5","deterministic_revs","clonedDoc","_rev_tree","v4","uuid","winningRev","metadata","winningId","winningPos","winningDeleted","toVisit","rev_tree","tree","ids","branches","pos","deleted","traverseRevTree","revs","newCtx","sortByPos","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","rootToLeaf","paths","history","sortByPos$1","insertSorted","item","comparator","idx","mid","low","high","binarySearch","pathToTree","numStemmed","root","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","diff","candidateParents","trees","parentIdx","elementsLen","merge","depth","newTree","stemmed","stemmedRevs","revHash","stem","getTrees","isDeleted","isLocalId","Changes$1","complete","ee","onDestroy","cancel","pending","lastSeq","isCancelled","tryCatchInChangeListener","validateChanges","processChange","changeList","_conflicts","compare","left","right","yankError","compareByIdThenRev","idCompare","_revisions","AbstractPouchDB","TaskQueue","PouchDB","__opts","auto_compaction","prefix","backend","adapter","adapters","preferredAdapters","adapterName","use_prefix","parseAdapter","_adapter","valid","fail","onDestroyed","from_constructor","onClosed","prepareForDestruction","ready","_changesFilterPlugin","validate","doChanges","continuous","live","normalize","shouldFilter","descending","limit","newPromise","_changes","update_seq","post","bulkDocs","_putLocal","_deleted","_removeLocal","oldRevId","newRevNum","newRevId","putDoc","_put","new_edits","force","putAttachment","attachmentId","rev$$1","api","createAttachment","prevrevpos","content_type","revpos","removeAttachment","docOrId","optsOrRev","was_delete","revsDiff","missing","addToMissing","revId","_getRevisionTree","missingForId","processDoc","missingObj","compactDocument","maxHeight","revTree","edges","prnt","edge","computeHeight","candidates","_doCompaction","compact","_compactionQueue","doNextCompaction","catch","last_seq","_compact","return_docs","promises","row","all","_getLocal","finishOpenRevs","latest","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","indexOfRev","howMany","_revs_info","_getAttachment","getAttachment","allDocs","skip","start_key","startkey","end_key","endkey","incompatibleOpt","allDocsKeysParse","_allDocs","close","_close","_info","db_name","_type","attachmentError","attachmentNameError","atts","cleanDocs","_bulkDocs","registerDependentDatabase","dependentDb","depDB","dependentDbs","usePrefix","destroyDb","_destroy","localDoc","deletedMap","trueName","execute","AbortController","abort","f$1","fetch","Headers","eventEmitter","Pouch","destructListeners","_destructionListeners","dbList","setUpEventEmitter","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","getFieldFromDoc","parsedField","parseField","fieldName","fields","ch","combinationFields","isCombinationalField","field","getKey","mergeAndedSelectors","selectors","matcher","$eq","fieldMatchers","operator","$gte","$gt","mergeGtGte","$lte","$lt","mergeLtLte","$ne","mergeNe","mergeEq","massageSelector","wasAnded","isAndInSelector","isAnd","mergeAndedSelectorsNested","orOrNor","subSelector","collate","normalizeKey","ai","collationIndex","bi","stringCollate","arrayCollate","ak","bk","objectCollate","Infinity","origKey","toJSON","indexify","expFormat","toExponential","magnitude","neg","magString","padWith","upToLength","padding","targetLength","pad","factor","factorStr","toFixed","numToIndexableString","toIndexableString","objKey","parseNumber","originalIdx","numAsString","magAsString","metaStack","lastMetaElement","lastElementIndex","filterInMemoryFields","rows","requestDef","inMemoryFields","rowFilter","fieldSorter","getFieldValuesAsArray","sorting","aRow","bRow","collation","createFieldSorter","docFieldValue","some","orMatchers","find","matchCominationalSelector","matchSelector","userOperator","userValue","matchers","fieldExists","fieldIsNotUndefined","arrayContainsValue","divisor","mod","modField","neValue","arraySize","arrayContainsAllValues","regexMatch","typeMatch","filterName","changesHandler","doc_ids","viewName","ddoc","mapFun","views","rowsMatched","matchesSelector","filterFun","filters","toObject","version","reservedWords","dataWords","parseRevisionInfo","parseDoc","newEdits","dbOpts","nRevNum","revInfo","revisions","revisionIds","makeRevTreeFromRevisions","specialKey","preprocessString","blobType","asBinary","parseBase64","digest","preprocessAttachment","md5","preprocessBlob","updateDoc","revLimit","prev","docInfo","writeDoc","splitRev","targetPos","targetId","revExists","previousWinningRev","previouslyDeleted","isRoot","newRev","rev_map","winningRev$$1","winningRevIsDeleted","delta","processDocs","docInfos","fetchedDocs","tx","overallCallback","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","resultsIdx","docWritten","nextDoc","rootIsMissing","insertDoc","DOC_STORE","META_STORE","safeJsonStringify","json","idbError","encodeMetadata","deletedOrLocal","decodeMetadata","storedObject","safeJsonParse","decodeDoc","_doc_id_rev","readBlobData","asBlob","fetchAttachmentsIfNecessary","txn","attObj","objectStore","onsuccess","fetchAttachment","postProcessAttachments","attNames","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","IDBKeyRange","bound","deleteOrphanedAttachments","openCursor","only","cursor","digestSeq","primaryKey","continue","openTransactionSafely","idb","stores","transaction","idbBulkDocs","docStore","bySeqStore","attachStore","attachAndSeqStore","metaStore","docInfoError","metaDoc","allDocsProcessed","docCountDelta","preconditionErrored","_meta","blobSupport","onAllDocsProcessed","updateDocCountIfReady","docCount","newRevIsDeleted","isUpdate","collectResults","finishDoc","attachmentSaved","newAtt","saveAttachment","writeAttachments","afterPutDoc","revsToDelete","compactTree","metadataToStore","afterPutMetadata","attsAdded","attsToAdd","onerror","insertAttachmentMappings","putReq","overallErr","docv","recv","processedAttachment","preprocessAttachments","txnResult","onabort","ontimeout","oncomplete","finish","digests","filename","verifyAttachment","attErr","verifyAttachments","numFetched","revs_limit","readMetadata","fetchExistingDocs","startTransaction","runBatchedCursor","keyRange","batchSize","onBatch","keysBatch","valuesBatch","pseudoCursor","onGetAll","onGetAllKeys","onCursor","getAll","getAllKeys","newKeyRange","lastKey","upper","upperOpen","code","lowerBound","idbAllDocs","keyRangeError","inclusiveEnd","inclusive_end","upperBound","createKeyRange","onResultsReady","updateSeq","onSuccess","docIdRevIndex","allDocsInner","fetchDocAsynchronously","batchValues","batchValue","batchKeys","returnVal","total_rows","maxKey","allDocsKeys","running","applyNext","docIds","numResults","docIdsToMetadata","onGetMetadata","docIdRev","objectStores","winningDocs","metadatas","fetchWinningDocAndMetadata","winningDoc","processMetadataAndWinningDoc","onBatchDone","filtered","blobSupportPromise","cachedDBs","openReqList","IdbPouch","tryCode","enqueueTask","thisCallback","addDeletedOrLocalIndex","createIndex","unique","migrateLocalStore","localStore","local","range","seqCursor","migrateAttsAndSeqs","digestMap","migrateMetadata","onGetMetadataSeq","metadataSeq","fetchMetadataSeq","instanceId","reqOpts","historyNode","attachId","attachment","blobData","doc_count","idb_attachment_format","oldRev","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","createObjectStore","keyPath","autoIncrement","createSchema","currentTarget","createLocalStoreSchema","addAttachAndSeqStore","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","countDocs","blob$$1","matchedChrome","matchedEdge","checkBlobSupport","supportsBulkGetMap","readAttachmentsAsBlobOrBuffer","encodeDocId","preprocessAttachments$1","getHost","hasUrlPrefix","user","password","username","genDBUrl","genUrl","pathDel","paramsToStr","params","HttpPouch","dbUrl","setupPromise","ourFetch","headers","credentials","nAuth","token","ua","isIE","isTrident","isEdge","isGET","shouldCacheBust","now","adapterFun$$1","setup","fetchJSON","response","skip_setup","encodeAttachmentId","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","filenames","promiseFactories","doNext","runNextBatch","onError","thisErr","pool","typeFieldDescriptor","__proto__","fetchData","docOrDocs","contentType","process","browser","paramStr","batch_size","heartbeat","requestTimeout","timeout","leftToFetch","feed","seq_interval","param_name","lastFetchedSeq","controller","aborted","fetchOpts","signal","fetched","raw_results_length","finished","QueryParseError","NotFoundError","BuiltInError","promisedCallback","sequentialize","promiseFactory","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","log","evalFunctionWithEval","TaskQueue$1","createView","sourceDB","reduceFun","temporary","localDocName","cachedViews","viewSignature","createViewSignature","_cachedViews","promiseForView","depDbName","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","parseViewName","emitError","builtInReduce","sumsqr","_sumsqr","abstract","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","output","sortByKeyThenValue","keyCompare","sliceResults","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","checkQueryParseError","startkeyName","endkeyName","group_level","optionName","checkPositiveInteger","defaultsTo","getDocsToPersist","docIdsToChangesAndEmits","metaDocId","defaultMetaDoc","docData","indexableKeysToKeyValues","isGenOne","getKeyValueDocs","kvDocsRes","kvDocs","oldKeys","keyValue","newKeys","kvDoc","processKeyValueDocs","getQueue","updateView","mapResults","currentSeq","listOfDocsToPersist","docsToPersist","saveKeyValues","processNextBatch","createIndexableKeysToKeyValues","createDocIdsToChangesAndEmits","emittedKeyValue","complexKey","updateViewInQueue","queryView","totalRows","shouldReduce","fetchFromView","viewOpts","expectedKeys","parsedKeyAndDocId","parsedNum","parsedStr","arrayElement","objElement","parseIndexableString","onMapResultsReady","finalResults","shouldGroup","lvl","POSITIVE_INFINITY","groupKey","reduceTry","reduceView","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","queryViewInQueue","queryPromised","_query","customQuery","keysAsString","httpQuery","finalPromiseFactory","designDocName","stale","coerceOptions","viewCleanup","_viewCleanup","customViewCleanup","httpViewCleanup","docsToViews","viewsToStatus","ddocName","viewDBNames","statusIsGood","viewDBName","destroyPromises","localViewCleanup","createAbstractMapReduce","origMap","reduceFunString","builtIn","getBuiltIn","mapreduce","isGenOne$1","getDocAttachments","getDocs","diffs","resultDocs","fetchRevisionOneDocs","hasConflicts","bulkGetOpts","missingRev","createBulkGetOpts","bulkGetResponse","bulkGetInfo","remoteDoc","doCheckForLocalAttachments","fileHasChanged","getDocAttachmentsFromTargetOrSource","Boolean","updateCheckpoint","checkpoint","session","returnValue","session_id","replicator","Checkpointer","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","srcDoc","tgtDoc","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","T","targetRest","hasSessionId","compareReplicationLogs","sessionId","props","floor","getCheckpoint","generateReplicationId","queryParams","filterViewName","sortObjectPropertiesByKey","queryData","md5sum","replicate","currentBatch","repId","checkpointer","batches","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","changedDocs","start_time","docs_read","docs_written","doc_write_failures","initCheckpointer","checkpointOpts","writeDocs","bulkOpts","completeReplication","errorsById","errorsNo","errorName","finishBatch","outResult","getChanges","onCheckpointError","getBatchDocs","got","startNextBatch","abortReplication","processPendingBatch","immediate$$1","fatalError","end_time","retry","back_off_function","backOffSet","current_back_off","backOff","onChangesComplete","onChangesError","_abortChanges","abortChanges","startChanges","_addedListeners","Replication","toPouch","PouchConstructor","replicateWrapper","replicateRet","sync","Sync","canceled","optsPush","optsPull","pull","pullChange","direction","pushChange","pushDenied","pullDenied","pushPaused","pullPaused","pushActive","pullActive","removed","removeAll","addOneListener","out","success","_readyCalled","replicateMethods","other","parseManifest","manifest","NeumeEdit","TextEdit","TextView","prepareEditMode","textView","View","Display","image","title","core","Info","setupEdit","initDb","delay","pageNo","getCurrentPage","changePage","redo","undo","pageURI","elementID","updateDatabase","getAnnotations","timestamp","readAsDataURL","deleteDb","getMEI","mei","getSVG","v1","arrayPrefix","objPrefix","numChar","parsedString","lastCh","numConsecutiveSlashes","className","handleZoom","displayControlsPanel","addUpdateCallback","updateVisualization","DisplayControls","setZoomControls","initDisplayControls","setOpacityFromSlider","updateCallbacks","divaReady","diva","Diva","objectData","minHeight","indexMap","disableDragScrollable","displayPanel","loadDelay","initDivaEvents","setViewEventHandlers","onresize","innerHeight","innerWidth","Events","subscribe","settings","ID","didLoad","adjustZoom","pageIndex","checkAndLoad","page","getPageSVG","svg","updateSVG","containerId","pageIndexes","getActivePageIndex","zoomDuration","firstChild","inner","dimensions","getPageDimensionsAtCurrentZoomLevel","viewHandler","_viewerCore","getPageRegion","includePadding","incorporateViewport","marginLeft","getComputedStyle","getPropertyValue","top","setDisplayListeners","findIndex","visibility","clear","sequence","sequences","canvases","itemTitle","pages","panel","createElementNS","bg","setAttributeNS","hasAttribute","replaceChild","resetTransformations","_page","_delay","restoreTransformation","setSelectListeners","touches","scrollZoom","newHeight","initEditModeControls","insertHandler","bindInsertTabs","click","Select","setSelectHelperObjects","initInsertEditControls","editMenu","backgroundColor","setSelectStrokeWidth","initSelectionButtons","setHighlightSelectionControls","isInsertMode","clickSelect","dragSelect","neumeGroups","updateInfoVisibility","neumeInfo","checked","setInfoControls","block","label","resetInfoListeners","updateInfo","stopListeners","elementClass","attributes","ncs","getContour","ligated","pitches","getPitches","toUpperCase","updateInfoModule","pitchNameToNum","innerText","pname","cont","entries","notificationSent","textLabel","bboxLabel","textButton","bboxButton","setTextViewControls","updateTextViewVisibility","updateBBoxViewVisibility","initSelectByBBoxButton","sylText","getSylText","text","initTextEdit","lyrics","selBySylListener","addBBoxListeners","updateSylText","button","orig","corrected","prompt","copyAttributes","array1","array2","staffBasedMei","DOMParser","serializer","XMLSerializer","meiDoc","parseFromString","precedesSyllables","section","getElementsByTagName","newStaff","newLayer","layer","sb","custos","lastElementChild","lastElement","followsId","followsSyllable","previousElementSibling","firstElementChild","serializeToString","sbBasedMei","originalStaves","origSyllable","isEqualNode","insertBefore","lastChild","insertAdjacentElement","newSyllable","childArray","sbIndex","sbInfo","currentSb","nextSb","childrenArray","copyArray","msCrypto","rnds8","rnds","byteToHex","bth","activate","insertActive","deactivate","editMode","initEditMode","tabIds","tab","selectedOption","insertDisabled","bindElements","toggleInsert","toggleEdit","insertContents","editContents","selBySyl","selByNeume","selByNc","selByStaff","selectBySylHandler","selectByNeumeHandler","selectByNcHandler","selectByStaffHandler","groupingAction","getChildrenIds","getIds","syllable0","syllable1","secondSyllable","groupType","neumeParent","Warnings","groupingNotRecognized","childrenIds","PointNames","TopLeft","Top","TopRight","Right","BottomRight","Bottom","BottomLeft","Left","GetPoints","sin","initialPoint","initialUly","initialLry","initialRectY","polyLen","initialRotate","redraw","pointString","_elem","pointName","point","pointStringRight","pointStringLeft","drawInitialRect","whichPoint","viewportElement","resizeStart","resizeDrag","resizeEnd","rotateStart","temp","tempRotate","rotateEnd","which","PI","currentPoint","firstClick","removeInsertClickHandlers","keydownListener","resetInsertHandler","clickawayHandler","insertMenu","staffHandler","cursorpt","coord","buttonId","alreadyInInsertMode","editModeButton","getGetParam","manifestLocation","storage","statusText","Response","location","verovioWrapper","Validation","undoStacks","redoStacks","neonCache","blankPages","annotations","mei_annotations","lastPageLoaded","annotation","getTime","newAnnotation","loadData","blankPage","convertSbToStaff","dirty","sendForValidation","handle","loadPage","entry","currentMEI","updateCache","svgText","meiPromise","svgPromise","updateTimestamp","pair","schemaResponse","worker","statusField","updateUI","line","link","panelBlock","pNotif","Worker","meiData","verovioWorker","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","currentQueue","queueIndex","cleanUpNextTick","drainQueue","run","marker","runClearTimeout","Item","noop","env","argv","versions","binding","cwd","chdir","dir","umask","_nodeId","_clockseq","rng","bytesToUuid","_lastMSecs","_lastNSecs","clockseq","seedBytes","msecs","nsecs","dt","tl","tmh","ii","NeonSchema","NeonContext","manifestString","Validator","attribute","unresolvedRefs","types","validators","shouldResolve","addSchema","ourUri","addSubSchemaArray","addSubSchema","addSubSchemaObject","setSchemas","getSchema","urn","sch","validateSchema","switchSchema","schemaobj","schemaTraverser","superResolve","resolved","subctx","subschema","skipAttributes","ignoreProperties","validatorErr","allowUnknownAttributes","rewrite","parsed","fragment","testType","isFinite","integer","boolean","date","any","nodeType","freeGlobal","maxInt","regexPunycode","regexNonASCII","regexSeparators","stringFromCharCode","fn","mapDomain","ucs2decode","extra","counter","ucs2encode","digitToBasic","digit","flag","adapt","numPoints","firstTime","baseMinusTMin","decode","basic","oldi","baseMinusT","codePoint","inputLength","bias","encode","handledCPCount","basicLength","q","currentValue","handledCPCountPlusOne","qMinusT","webpackPolyfill","deprecate","qs","sep","eq","maxKeys","kstr","vstr","xs","stringifyPrimitive","objectKeys","ks","f","testSchemaNoThrow","testAdditionalProperty","preValidateProperty","nestedErrors","minProperties","maxProperties","minimum","exclusiveMinimum","maximum","exclusiveMaximum","validateMultipleOfOrDivisbleBy","validationType","errorMessage","validationArgument","instanceDecimals","divisorDecimals","maxDecimals","multiplier","pow","testArrays","multipleOf","divisibleBy","required","minLength","hsp","maxLength","minItems","maxItems","uniqueItems","dep","childContext","notTypes","schemaId","startEditMode","navbarDropdownMenu","undoRedoPanel","initNavbar","initUndoRedoPanel","selectionHighlight","divider","save","export","download","confirm","reload","getPageMEI","convertStaffToSb","getPageName","undoHandler","redoHandler","editItem","editButton","fileLink","navbarContents","navbarFinalize","ViewBox","imageWidth","imageHeight","z","zoomHeight","zoomWidth","ZoomHandler","bgimg","viewBox","updateViewBox","getViewBox","translate","rawViewBox","dragCoordinates","matrix","newCoordinates","deltaX","deltaY","newTransform","dragTransform","slider","newK","getZoom","cursorPt","splitDisable","capture","resetHandler"],"mappings":"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","file":"editor.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 38);\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","module.exports = d3;","import * as Color from './Color';\nimport { updateHighlight } from '../DisplayPanel/DisplayControls';\nimport * as Grouping from '../SquareEdit/Grouping';\nimport { resize } from './Resize';\nimport { Attributes } from '../Types';\nimport NeonView from '../NeonView';\nimport DragHandler from './DragHandler';\nimport * as SelectOptions from '../SquareEdit/SelectOptions';\n\nimport * as d3 from 'd3';\n/**\n * @returns The selection mode chosen by the user.\n */\nexport function getSelectionType (): string {\n  const element = document.getElementsByClassName('sel-by is-active');\n  if (element.length !== 0) {\n    return element[0].id;\n  } else {\n    return null;\n  }\n}\n\n/**\n * Unselect all selected elements and run undo any extra\n * actions.\n */\nexport function unselect (): void {\n  document.querySelectorAll('.selected').forEach((selected: SVGGElement) => {\n    selected.classList.remove('selected');\n    if (selected.classList.contains('staff')) {\n      selected.removeAttribute('style');\n      Color.unhighlight(selected);\n    } else {\n      selected.removeAttribute('style');\n      selected.style.fill = '';\n    }\n  });\n  Array.from(document.getElementsByClassName('text-select')).forEach((el: SVGElement) => {\n    el.style.color = '';\n    el.style.fontWeight = '';\n    el.classList.remove('text-select');\n  });\n  Array.from(document.getElementsByClassName('sylTextRect-display')).forEach((sylRect: HTMLElement) => {\n    sylRect.style.fill = 'blue';\n  });\n\n  Array.from(document.getElementsByClassName('syllable-highlighted')).forEach((syllable: HTMLElement) => {\n    syllable.style.fill = '';\n    syllable.classList.add('syllable');\n    syllable.classList.remove('syllable-highlighted');\n  });\n\n  d3.selectAll('#resizeRect').remove();\n  d3.selectAll('.resizePoint').remove();\n  d3.selectAll('.rotatePoint').remove();\n\n  if (!document.getElementById('selByStaff').classList.contains('is-active')) {\n    Grouping.endGroupingSelection();\n  } else {\n    SelectOptions.endOptionsSelection();\n  }\n  document.getElementById('extraEdit').innerHTML = '';\n  document.getElementById('extraEdit').classList.add('is-invisible');\n  updateHighlight();\n}\n\n/**\n * Generic select function.\n * @param el - Element to select.\n * @param dragHandler - Only used for staves.\n */\nexport function select (el: SVGGraphicsElement, dragHandler?: DragHandler): void {\n  if (el.classList.contains('staff')) {\n    return selectStaff(el, dragHandler);\n  }\n  if (!el.classList.contains('selected') && !el.classList.contains('sylTextRect') &&\n      !el.classList.contains('sylTextRect-display')) {\n    el.classList.add('selected');\n    el.style.fill = '#d00';\n    if (el.querySelectorAll('.sylTextRect-display').length) {\n      el.querySelectorAll('.sylTextRect-display').forEach((elem: HTMLElement) => {\n        elem.style.fill = 'red';\n      });\n    }\n    let sylId;\n    if (el.classList.contains('syllable')) {\n      sylId = el.id;\n    } else if (el.closest('.syllable') !== null) {\n      sylId = el.closest('.syllable').id;\n    }\n    if (sylId !== undefined) {\n      const spans = document.querySelectorAll('span.' + sylId);\n      spans.forEach((span: HTMLElement) => {\n        span.style.color = '#d00';\n        span.style.fontWeight = 'bold';\n        span.classList.add('text-select');\n      });\n    }\n  }\n  updateHighlight();\n}\n\n/**\n * Select an nc.\n * @param el - The neume component.\n */\nexport async function selectNcs (el: SVGGraphicsElement, neonView: NeonView, dragHandler: DragHandler): Promise<void> {\n  if (!el.parentElement.classList.contains('selected')) {\n    const parent = el.parentElement as unknown as SVGGraphicsElement;\n    unselect();\n    select(parent);\n    if (await isLigature(parent, neonView)) {\n      const prevNc = parent.previousSibling as unknown as SVGGraphicsElement;\n      if (await isLigature(prevNc, neonView)) {\n        select(prevNc);\n      } else {\n        const nextNc = parent.nextSibling as unknown as SVGGraphicsElement;\n        if (await isLigature(nextNc, neonView)) {\n          select(nextNc);\n        } else {\n          console.warn('Error: Neither prev or next nc are ligatures');\n        }\n      }\n      Grouping.triggerGrouping('ligature');\n    } else if (parent.classList.contains('nc')) {\n      SelectOptions.triggerNcActions(parent);\n    } else {\n      console.warn('No action triggered!');\n    }\n    dragHandler.dragInit();\n  }\n}\n\n/**\n * @param nc - The neume component.\n * @param neonView - The [[NeonView]] for this instance.\n * @returns True if the neume component is part of a ligature.\n */\nexport async function isLigature (nc: SVGGraphicsElement, neonView: NeonView): Promise<boolean> {\n  const attributes: Attributes = await neonView.getElementAttr(nc.id, neonView.view.getCurrentPageURI());\n  return (attributes.ligated);\n}\n\n/**\n * @param elements - The elements to compare.\n * @returns True if the elements have the same parent up two levels, otherwise false.\n */\nexport function sharedSecondLevelParent (elements: SVGElement[]): boolean {\n  const tempElements = Array.from(elements);\n  const firstElement = tempElements.pop();\n  const secondParent = firstElement.parentElement.parentElement;\n  for (const element of tempElements) {\n    const secPar = element.parentElement.parentElement;\n    if (secPar.id !== secondParent.id) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Get the bounding box of a staff based on its staff lines.\n * Rotate is included in radians.\n */\nexport function getStaffBBox (staff: SVGGElement): {ulx: number; uly: number; lrx: number; lry: number; rotate: number} {\n  let ulx, uly, lrx, lry, rotate;\n  staff.querySelectorAll('path').forEach(path => {\n    const coordinates: number[] = path.getAttribute('d')\n      .match(/\\d+/g)\n      .map(element => Number(element));\n    if (rotate === undefined) {\n      rotate = Math.atan((coordinates[3] - coordinates[1]) /\n        (coordinates[2] - coordinates[0]));\n    }\n\n    if (uly === undefined || Math.min(coordinates[1], coordinates[3]) < uly) {\n      uly = Math.min(coordinates[1], coordinates[3]);\n    }\n    if (ulx === undefined || coordinates[0] < ulx) {\n      ulx = coordinates[0];\n    }\n    if (lry === undefined || Math.max(coordinates[1], coordinates[3]) > lry) {\n      lry = Math.max(coordinates[1], coordinates[3]);\n    }\n    if (lrx === undefined || coordinates[2] > lrx) {\n      lrx = coordinates[2];\n    }\n  });\n  return { 'ulx': ulx, 'uly': uly, 'lrx': lrx, 'lry': lry, 'rotate': rotate };\n}\n\n/**\n * select a boundingbox element\n * @param el - the bbox (sylTextRect) element in the DOM\n * @param dragHandler - the drag handler in use\n */\nexport function selectBBox (el: SVGGraphicsElement, dragHandler: DragHandler, neonView: NeonView): void {\n  const bbox = el;\n  const syl = bbox.closest('.syl');\n  if (!syl.classList.contains('selected')) {\n    syl.classList.add('selected');\n    bbox.style.fill = '#d00';\n    const closest = el.closest('.syllable') as HTMLElement;\n    closest.style.fill = 'red';\n    closest.classList.add('syllable-highlighted');\n    if (neonView !== undefined ){\n      resize(syl as SVGGraphicsElement, neonView, dragHandler);\n    }\n    if (dragHandler !== undefined) {\n      dragHandler.dragInit();\n    }\n    const sylId = el.closest('.syllable').id;\n    if (sylId !== undefined) {\n      const span: HTMLSpanElement = document.querySelector('span.' + sylId);\n      if (span) {\n        span.style.color = '#d00';\n        span.style.fontWeight = 'bold';\n        span.classList.add('text-select');\n      }\n    }\n  }\n}\n\n/**\n * Select not neume elements.\n * @param notNeumes - An array of not neumes elements.\n */\nexport function selectNn (notNeumes: SVGGraphicsElement[]): boolean {\n  if (notNeumes.length > 0) {\n    notNeumes.forEach(nn => { select(nn); });\n    return false;\n  } else {\n    return true;\n  }\n}\n\n/**\n * Select a staff element.\n * @param staff - The staff element in the DOM.\n * @param dragHandler - The drag handler in use.\n */\nexport function selectStaff (staff: SVGGElement, dragHandler: DragHandler): void {\n  if (!staff.classList.contains('selected')) {\n    staff.classList.add('selected');\n    Color.unhighlight(staff);\n    Color.highlight(staff, '#d00');\n    dragHandler.dragInit();\n  }\n}\n\n/**\n * Handle selecting an array of elements based on the selection type.\n */\nexport async function selectAll (elements: Array<SVGGraphicsElement>, neonView: NeonView, dragHandler: DragHandler): Promise<void> {\n  const selectionType = getSelectionType();\n  unselect();\n  if (elements.length === 0) {\n    return;\n  }\n\n  let selectionClass;\n  let containsClefOrCustos = false;\n\n  switch (selectionType) {\n    case 'selBySyl':\n      selectionClass = '.syllable';\n      break;\n    case 'selByNeume':\n      selectionClass = '.neume';\n      break;\n    case 'selByNc':\n      selectionClass = '.nc';\n      break;\n    case 'selByStaff':\n      selectionClass = '.staff';\n      break;\n    case 'selByBBox':\n      selectionClass = '.sylTextRect-display';\n      break;\n    default:\n      console.error('Unknown selection type ' + selectionType);\n      return;\n  }\n\n  // Get the groupings specified by selectionClass\n  // that contain the provided elements to select.\n  const groupsToSelect = new Set();\n  for (const element of elements) {\n    let grouping = element.closest(selectionClass);\n    if (grouping === null) {\n      // Check if we click-selected a clef or a custos\n      grouping = element.closest('.clef, .custos');\n      if (grouping === null) {\n        console.warn('Element ' + element.id + ' is not part of specified group and is not a clef or custos.');\n        continue;\n      }\n      containsClefOrCustos = containsClefOrCustos || true;\n    }\n    groupsToSelect.add(grouping);\n\n    // Check for precedes/follows\n    const follows = grouping.getAttribute('mei:follows');\n    if (follows) {\n      groupsToSelect.add(document.getElementById(follows.slice(1)));\n    }\n    const precedes = grouping.getAttribute('mei:precedes');\n    if (precedes) {\n      groupsToSelect.add(document.getElementById(precedes.slice(1)));\n    }\n  }\n\n  // Select the elements\n  groupsToSelect.forEach((group: SVGGraphicsElement) => { select(group, dragHandler); });\n\n  /* Determine the context menu to display (if any) */\n\n  const groups = Array.from(groupsToSelect.values()) as SVGGraphicsElement[];\n\n  // Handle occurance of clef or custos\n  if (containsClefOrCustos) {\n    // A context menu will only be displayed if there is a single clef\n    if (groupsToSelect.size === 1 && groups[0].classList.contains('clef')) {\n      SelectOptions.triggerClefActions(groups[0]);\n    } else if (groupsToSelect.size === 1 && groups[0].classList.contains('custos')) {\n      SelectOptions.triggerCustosActions();\n    } else {\n      if (selectionType == 'selBySyl') {\n        SelectOptions.triggerDefaultSylActions();\n      } else {\n        SelectOptions.triggerDefaultActions();\n      }\n    }\n    return;\n  }\n\n  switch (selectionType) {\n    case 'selByStaff':\n      switch (groups.length) {\n        case 1:\n          SelectOptions.triggerSplitActions();\n          resize(groups[0], neonView, dragHandler);\n          break;\n        default:\n          SelectOptions.triggerStaffActions();\n      }\n      break;\n\n    case 'selBySyl':\n      switch (groups.length) {\n        case 1:\n          // TODO change context if it is only a neume/nc.\n          SelectOptions.triggerSylActions();\n          break;\n        case 2:\n          // Check if this is a linked syllable split by a staff break\n          if ((groups[0].getAttribute('mei:follows') === '#' + groups[1].id) ||\n          (groups[0].getAttribute('mei:precedes') === '#' + groups[1].id)) {\n            Grouping.triggerGrouping('splitSyllable');\n          } else if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('syl');\n          } else {\n            // Check if this *could* be a selection with a single logical syllable split by a staff break.\n            const staff0 = groups[0].closest('.staff');\n            const staff1 = groups[1].closest('.staff');\n            const staffChildren = Array.from(staff0.parentElement.children);\n            // Check if these are adjacent staves (logically)\n            if (Math.abs(staffChildren.indexOf(staff0) - staffChildren.indexOf(staff1)) === 1) {\n              // Check if one syllable is the last in the first staff and the other is the first in the second.\n              // Determine which staff is first.\n              const firstStaff = (staffChildren.indexOf(staff0) < staffChildren.indexOf(staff1)) ? staff0 : staff1;\n              const secondStaff = (firstStaff.id === staff0.id) ? staff1 : staff0;\n              const firstLayer = firstStaff.querySelector('.layer');\n              const secondLayer = secondStaff.querySelector('.layer');\n\n              // Check that the first staff has either syllable as the last syllable\n              const firstSyllableChildren = Array.from(firstLayer.children)\n                .filter((elem: HTMLElement) => elem.classList.contains('syllable')) as HTMLElement[];\n              const secondSyllableChildren = Array.from(secondLayer.children)\n                .filter((elem: HTMLElement) => elem.classList.contains('syllable')) as HTMLElement[];\n              const lastSyllable = firstSyllableChildren[firstSyllableChildren.length - 1];\n              const firstSyllable = secondSyllableChildren[0];\n              if (lastSyllable.id === groups[0].id && firstSyllable.id === groups[1].id) {\n                Grouping.triggerGrouping('splitSyllable');\n                break;\n              } else if (lastSyllable.id === groups[1].id && firstSyllable.id === groups[0].id) {\n                Grouping.triggerGrouping('splitSyllable');\n                break;\n              }\n            }\n            SelectOptions.triggerDefaultSylActions();\n          }\n          break;\n        default:\n          if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('syl');\n          } else {\n            SelectOptions.triggerDefaultSylActions();\n          }\n      }\n      break;\n\n    case 'selByNeume':\n      switch (groups.length) {\n        case 1:\n          // TODO change context if it is only a nc.\n          SelectOptions.triggerNeumeActions();\n          break;\n        default:\n          if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('neume');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n      }\n      break;\n\n    case 'selByNc':\n      switch (groups.length) {\n        case 1:\n          SelectOptions.triggerNcActions(groups[0]);\n          break;\n        case 2:\n          if (sharedSecondLevelParent(groups)) {\n            // Check if this selection is a ligature or can be a ligature\n            // Check if these neume components are part of the same neume\n            if (groups[0].parentElement === groups[1].parentElement) {\n              const children = Array.from(groups[0].parentElement.children);\n              // Check that neume components are adjacent\n              if (Math.abs(children.indexOf(groups[0]) - children.indexOf(groups[1])) === 1) {\n                // Check that second neume component is lower than first.\n                // Note that the order in the list may not be the same as the\n                // order by x-position.\n                const orderFirstX = (groups[0].children[0] as SVGUseElement)\n                  .x.baseVal.value;\n                const orderSecondX = (groups[1].children[0] as SVGUseElement)\n                  .x.baseVal.value;\n                let posFirstY, posSecondY;\n\n                if (orderFirstX < orderSecondX) {\n                  posFirstY = (groups[0].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                  posSecondY = (groups[1].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                } else {\n                  posFirstY = (groups[1].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                  posSecondY = (groups[0].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                }\n\n                // Also ensure both components are marked or not marked as ligatures.\n                const isFirstLigature = await isLigature(groups[0], neonView);\n                const isSecondLigature = await isLigature(groups[1], neonView);\n                if ((posSecondY > posFirstY) && !(isFirstLigature !== isSecondLigature)) {\n                  Grouping.triggerGrouping('ligature');\n                  break;\n                }\n              }\n            }\n            Grouping.triggerGrouping('nc');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n          break;\n        default:\n          if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('nc');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n      }\n      break;\n    case 'selByBBox':\n      switch (groups.length) {\n        case 1:\n          selectBBox(groups[0], dragHandler, neonView);\n          break;\n        default:\n          groups.forEach(g => selectBBox(g, dragHandler, undefined));\n          break;\n      }\n      break;\n    default:\n      console.error('Unknown selection type. This should not have occurred.');\n  }\n}\n","'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","'use strict';\n\nvar uri = require('url');\n\nvar ValidationError = exports.ValidationError = function ValidationError (message, instance, schema, propertyPath, name, argument) {\n  if (propertyPath) {\n    this.property = propertyPath;\n  }\n  if (message) {\n    this.message = message;\n  }\n  if (schema) {\n    if (schema.id) {\n      this.schema = schema.id;\n    } else {\n      this.schema = schema;\n    }\n  }\n  if (instance) {\n    this.instance = instance;\n  }\n  this.name = name;\n  this.argument = argument;\n  this.stack = this.toString();\n};\n\nValidationError.prototype.toString = function toString() {\n  return this.property + ' ' + this.message;\n};\n\nvar ValidatorResult = exports.ValidatorResult = function ValidatorResult(instance, schema, options, ctx) {\n  this.instance = instance;\n  this.schema = schema;\n  this.propertyPath = ctx.propertyPath;\n  this.errors = [];\n  this.throwError = options && options.throwError;\n  this.disableFormat = options && options.disableFormat === true;\n};\n\nValidatorResult.prototype.addError = function addError(detail) {\n  var err;\n  if (typeof detail == 'string') {\n    err = new ValidationError(detail, this.instance, this.schema, this.propertyPath);\n  } else {\n    if (!detail) throw new Error('Missing error detail');\n    if (!detail.message) throw new Error('Missing error message');\n    if (!detail.name) throw new Error('Missing validator type');\n    err = new ValidationError(detail.message, this.instance, this.schema, this.propertyPath, detail.name, detail.argument);\n  }\n\n  if (this.throwError) {\n    throw err;\n  }\n  this.errors.push(err);\n  return err;\n};\n\nValidatorResult.prototype.importErrors = function importErrors(res) {\n  if (typeof res == 'string' || (res && res.validatorType)) {\n    this.addError(res);\n  } else if (res && res.errors) {\n    Array.prototype.push.apply(this.errors, res.errors);\n  }\n};\n\nfunction stringizer (v,i){\n  return i+': '+v.toString()+'\\n';\n}\nValidatorResult.prototype.toString = function toString(res) {\n  return this.errors.map(stringizer).join('');\n};\n\nObject.defineProperty(ValidatorResult.prototype, \"valid\", { get: function() {\n  return !this.errors.length;\n} });\n\n/**\n * Describes a problem with a Schema which prevents validation of an instance\n * @name SchemaError\n * @constructor\n */\nvar SchemaError = exports.SchemaError = function SchemaError (msg, schema) {\n  this.message = msg;\n  this.schema = schema;\n  Error.call(this, msg);\n  Error.captureStackTrace(this, SchemaError);\n};\nSchemaError.prototype = Object.create(Error.prototype,\n  { constructor: {value: SchemaError, enumerable: false}\n  , name: {value: 'SchemaError', enumerable: false}\n  });\n\nvar SchemaContext = exports.SchemaContext = function SchemaContext (schema, options, propertyPath, base, schemas) {\n  this.schema = schema;\n  this.options = options;\n  this.propertyPath = propertyPath;\n  this.base = base;\n  this.schemas = schemas;\n};\n\nSchemaContext.prototype.resolve = function resolve (target) {\n  return uri.resolve(this.base, target);\n};\n\nSchemaContext.prototype.makeChild = function makeChild(schema, propertyName){\n  var propertyPath = (propertyName===undefined) ? this.propertyPath : this.propertyPath+makeSuffix(propertyName);\n  var base = uri.resolve(this.base, schema.id||'');\n  var ctx = new SchemaContext(schema, this.options, propertyPath, base, Object.create(this.schemas));\n  if(schema.id && !ctx.schemas[base]){\n    ctx.schemas[base] = schema;\n  }\n  return ctx;\n}\n\nvar FORMAT_REGEXPS = exports.FORMAT_REGEXPS = {\n  'date-time': /^\\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\\.\\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,\n  'date': /^\\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,\n  'time': /^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,\n\n  'email': /^(?:[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+\\.)*[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!\\.)){0,61}[a-zA-Z0-9]?\\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\\[(?:(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\.){3}(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\]))$/,\n  'ip-address': /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,\n  'ipv6': /^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/,\n  'uri': /^[a-zA-Z][a-zA-Z0-9+-.]*:[^\\s]*$/,\n\n  'color': /^(#?([0-9A-Fa-f]{3}){1,2}\\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\\(\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*\\))|(rgb\\(\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*\\)))$/,\n\n  // hostname regex from: http://stackoverflow.com/a/1420225/5628\n  'hostname': /^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\\.?$/,\n  'host-name': /^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\\.?$/,\n\n  'alpha': /^[a-zA-Z]+$/,\n  'alphanumeric': /^[a-zA-Z0-9]+$/,\n  'utc-millisec': function (input) {\n    return (typeof input === 'string') && parseFloat(input) === parseInt(input, 10) && !isNaN(input);\n  },\n  'regex': function (input) {\n    var result = true;\n    try {\n      new RegExp(input);\n    } catch (e) {\n      result = false;\n    }\n    return result;\n  },\n  'style': /\\s*(.+?):\\s*([^;]+);?/,\n  'phone': /^\\+(?:[0-9] ?){6,14}[0-9]$/\n};\n\nFORMAT_REGEXPS.regexp = FORMAT_REGEXPS.regex;\nFORMAT_REGEXPS.pattern = FORMAT_REGEXPS.regex;\nFORMAT_REGEXPS.ipv4 = FORMAT_REGEXPS['ip-address'];\n\nexports.isFormat = function isFormat (input, format, validator) {\n  if (typeof input === 'string' && FORMAT_REGEXPS[format] !== undefined) {\n    if (FORMAT_REGEXPS[format] instanceof RegExp) {\n      return FORMAT_REGEXPS[format].test(input);\n    }\n    if (typeof FORMAT_REGEXPS[format] === 'function') {\n      return FORMAT_REGEXPS[format](input);\n    }\n  } else if (validator && validator.customFormats &&\n      typeof validator.customFormats[format] === 'function') {\n    return validator.customFormats[format](input);\n  }\n  return true;\n};\n\nvar makeSuffix = exports.makeSuffix = function makeSuffix (key) {\n  key = key.toString();\n  // This function could be capable of outputting valid a ECMAScript string, but the\n  // resulting code for testing which form to use would be tens of thousands of characters long\n  // That means this will use the name form for some illegal forms\n  if (!key.match(/[.\\s\\[\\]]/) && !key.match(/^[\\d]/)) {\n    return '.' + key;\n  }\n  if (key.match(/^\\d+$/)) {\n    return '[' + key + ']';\n  }\n  return '[' + JSON.stringify(key) + ']';\n};\n\nexports.deepCompareStrict = function deepCompareStrict (a, b) {\n  if (typeof a !== typeof b) {\n    return false;\n  }\n  if (a instanceof Array) {\n    if (!(b instanceof Array)) {\n      return false;\n    }\n    if (a.length !== b.length) {\n      return false;\n    }\n    return a.every(function (v, i) {\n      return deepCompareStrict(a[i], b[i]);\n    });\n  }\n  if (typeof a === 'object') {\n    if (!a || !b) {\n      return a === b;\n    }\n    var aKeys = Object.keys(a);\n    var bKeys = Object.keys(b);\n    if (aKeys.length !== bKeys.length) {\n      return false;\n    }\n    return aKeys.every(function (v) {\n      return deepCompareStrict(a[v], b[v]);\n    });\n  }\n  return a === b;\n};\n\nfunction deepMerger (target, dst, e, i) {\n  if (typeof e === 'object') {\n    dst[i] = deepMerge(target[i], e)\n  } else {\n    if (target.indexOf(e) === -1) {\n      dst.push(e)\n    }\n  }\n}\n\nfunction copyist (src, dst, key) {\n  dst[key] = src[key];\n}\n\nfunction copyistWithDeepMerge (target, src, dst, key) {\n  if (typeof src[key] !== 'object' || !src[key]) {\n    dst[key] = src[key];\n  }\n  else {\n    if (!target[key]) {\n      dst[key] = src[key];\n    } else {\n      dst[key] = deepMerge(target[key], src[key])\n    }\n  }\n}\n\nfunction deepMerge (target, src) {\n  var array = Array.isArray(src);\n  var dst = array && [] || {};\n\n  if (array) {\n    target = target || [];\n    dst = dst.concat(target);\n    src.forEach(deepMerger.bind(null, target, dst));\n  } else {\n    if (target && typeof target === 'object') {\n      Object.keys(target).forEach(copyist.bind(null, target, dst));\n    }\n    Object.keys(src).forEach(copyistWithDeepMerge.bind(null, target, src, dst));\n  }\n\n  return dst;\n};\n\nmodule.exports.deepMerge = deepMerge;\n\n/**\n * Validates instance against the provided schema\n * Implements URI+JSON Pointer encoding, e.g. \"%7e\"=\"~0\"=>\"~\", \"~1\"=\"%2f\"=>\"/\"\n * @param o\n * @param s The path to walk o along\n * @return any\n */\nexports.objectGetPath = function objectGetPath(o, s) {\n  var parts = s.split('/').slice(1);\n  var k;\n  while (typeof (k=parts.shift()) == 'string') {\n    var n = decodeURIComponent(k.replace(/~0/,'~').replace(/~1/g,'/'));\n    if (!(n in o)) return;\n    o = o[n];\n  }\n  return o;\n};\n\nfunction pathEncoder (v) {\n  return '/'+encodeURIComponent(v).replace(/~/g,'%7E');\n}\n/**\n * Accept an Array of property names and return a JSON Pointer URI fragment\n * @param Array a\n * @return {String}\n */\nexports.encodePath = function encodePointer(a){\n\t// ~ must be encoded explicitly because hacks\n\t// the slash is encoded by encodeURIComponent\n\treturn a.map(pathEncoder).join('');\n};\n\n\n/**\n * Calculate the number of decimal places a number uses\n * We need this to get correct results out of multipleOf and divisibleBy\n * when either figure is has decimal places, due to IEEE-754 float issues.\n * @param number\n * @returns {number}\n */\nexports.getDecimalPlaces = function getDecimalPlaces(number) {\n\n  var decimalPlaces = 0;\n  if (isNaN(number)) return decimalPlaces;\n\n  if (typeof number !== 'number') {\n    number = Number(number);\n  }\n\n  var parts = number.toString().split('e');\n  if (parts.length === 2) {\n    if (parts[1][0] !== '-') {\n      return decimalPlaces;\n    } else {\n      decimalPlaces = Number(parts[1].slice(1));\n    }\n  }\n\n  var decimalParts = parts[0].split('.');\n  if (decimalParts.length === 2) {\n    decimalPlaces += decimalParts[1].length;\n  }\n\n  return decimalPlaces;\n};\n\n","/** @module DisplayPanel/DisplayControls */\n\nimport * as Color from '../utils/Color';\nimport ZoomHandler from '../SingleView/Zoom';\n\nlet lastGlyphOpacity: number, lastImageOpacity: number;\n\n/**\n * Initialize listeners and controls for display panel.\n * @param {string} meiClassName - The class used to signifiy the MEI element(s).\n * @param {string} background - The class used to signify the background.\n */\nexport function initDisplayControls (meiClassName: string, background: string): void {\n  setOpacityControls(meiClassName);\n  setBackgroundOpacityControls(background);\n  setHighlightControls();\n  setBurgerControls();\n\n  const displayContents = document.getElementById('displayContents');\n  const toggleDisplay = document.getElementById('toggleDisplay');\n\n  toggleDisplay.parentElement.addEventListener('click', () => {\n    if (displayContents.style.display === 'none') {\n      displayContents.style.display = '';\n      toggleDisplay.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down');\n    } else {\n      displayContents.style.display = 'none';\n      toggleDisplay.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-side');\n    }\n  });\n}\n\n/**\n * Set zoom control listener for button and slider\n * @param zoomHandler - A [[ZoomHandler]] is only necessary in Single Page mode as diva.js handles zooming otherwise.\n */\nexport function setZoomControls (zoomHandler?: ZoomHandler): void {\n  if (zoomHandler === undefined) {\n    return;\n  }\n  const zoomSlider = document.getElementById('zoomSlider') as HTMLInputElement;\n  const zoomOutput = document.getElementById('zoomOutput') as HTMLOutputElement;\n\n  zoomSlider.value = '100';\n  document.getElementById('reset-zoom').addEventListener('click', () => {\n    zoomOutput.value = '100';\n    zoomSlider.value = '100';\n    zoomHandler.resetZoomAndPan();\n  });\n\n  zoomSlider.addEventListener('input', inputChangeHandler);\n  zoomSlider.addEventListener('change', inputChangeHandler);\n\n  function inputChangeHandler (): void {\n    zoomOutput.value = zoomSlider.value;\n    zoomHandler.zoomTo(Number(zoomOutput.value) / 100.0);\n  }\n\n  document.body.addEventListener('keydown', (evt) => {\n    const currentZoom = parseInt(zoomOutput.value);\n    if (evt.key === '+') { // increase zoom by 20\n      const newZoom = Math.min(currentZoom + 20, parseInt(zoomSlider.getAttribute('max')));\n      zoomHandler.zoomTo(newZoom / 100.0);\n      zoomOutput.value = String(newZoom);\n      zoomSlider.value = String(newZoom);\n    } else if (evt.key === '-') { // decrease zoom by 20\n      const newZoom = Math.max(currentZoom - 20, parseInt(zoomSlider.getAttribute('min')));\n      zoomHandler.zoomTo(newZoom / 100.0);\n      zoomOutput.value = String(Math.round(newZoom));\n      zoomSlider.value = String(newZoom);\n    } else if (evt.key === '0') {\n      zoomOutput.value = '100';\n      zoomSlider.value = '100';\n      zoomHandler.resetZoomAndPan();\n    }\n  });\n}\n\n/**\n * Set rendered MEI opacity button and slider listeners.\n * @param meiClassName - Class that contains the rendered MEI.\n */\nfunction setOpacityControls (meiClassName: string): void {\n  lastGlyphOpacity = 100;\n  const opacitySlider = document.getElementById('opacitySlider') as HTMLInputElement;\n  const opacityOutput = document.getElementById('opacityOutput') as HTMLOutputElement;\n\n  opacitySlider.value = '100';\n\n  document.getElementById('reset-opacity').addEventListener('click', () => {\n    // Definition scale is the root element of what is generated by verovio\n    const lowerOpacity = lastGlyphOpacity < 95 ? lastGlyphOpacity / 100.0 : 0;\n    const newOpacity = opacitySlider.value === '100' ? lowerOpacity : 1;\n    (document.querySelectorAll('.' + meiClassName) as NodeListOf<HTMLElement>).forEach(g => {\n      g.style.opacity = newOpacity.toString();\n    });\n\n    lastGlyphOpacity = Number(opacitySlider.value);\n    opacitySlider.value = String(newOpacity * 100);\n    opacityOutput.value = String(Math.round(newOpacity * 100));\n  });\n\n  opacitySlider.addEventListener('input', inputChangeOpacity);\n  opacitySlider.addEventListener('change', inputChangeOpacity);\n\n  function inputChangeOpacity (): void {\n    opacityOutput.value = opacitySlider.value;\n    lastGlyphOpacity = Number(opacitySlider.value);\n    (document.querySelector('.' + meiClassName) as HTMLElement)\n      .style.opacity = (Number(opacityOutput.value) / 100.0).toString();\n  }\n}\n\n/**\n * Update MEI opacity to value from the slider.\n * @param meiClassName - Class that contains the rendered MEI.\n */\nexport function setOpacityFromSlider (meiClassName?: string): void {\n  const opacityOutput = document.getElementById('opacityOutput') as HTMLOutputElement;\n  opacityOutput.value = (document.getElementById('opacitySlider') as HTMLInputElement).value;\n  try {\n    ((document.querySelectorAll('.' + meiClassName)) as NodeListOf<HTMLElement>).forEach(g => {\n      g.style.opacity = (Number(opacityOutput.value) / 100.0).toString();\n    });\n  } catch (e) {}\n}\n\n/**\n * Set background image opacity button and slider listeners.\n * @param background - The background image selector.\n */\nfunction setBackgroundOpacityControls (background: string): void {\n  lastImageOpacity = 100;\n  const bgOpacitySlider = document.getElementById('bgOpacitySlider') as HTMLInputElement;\n  const bgOpacityOutput = document.getElementById('bgOpacityOutput') as HTMLOutputElement;\n\n  bgOpacitySlider.value = '100';\n  document.getElementById('reset-bg-opacity').addEventListener('click', () => {\n    const lowerOpacity = lastImageOpacity < 95 ? lastImageOpacity / 100.0 : 0;\n    const newOpacity = bgOpacitySlider.value === '100' ? lowerOpacity : 1;\n    (document.getElementsByClassName(background)[0] as HTMLElement)\n      .style.opacity = newOpacity.toString();\n\n    lastImageOpacity = Number(bgOpacitySlider.value);\n    bgOpacitySlider.value = String(newOpacity * 100);\n    bgOpacityOutput.value = String(Math.round(newOpacity * 100));\n  });\n\n  bgOpacitySlider.addEventListener('input', bgInputChangeHandler);\n  bgOpacitySlider.addEventListener('change', bgInputChangeHandler);\n\n  function bgInputChangeHandler (): void {\n    bgOpacityOutput.value = bgOpacitySlider.value;\n    lastImageOpacity = Number(bgOpacitySlider.value);\n    (document.getElementsByClassName(background)[0] as HTMLElement)\n      .style.opacity = (Number(bgOpacityOutput.value) / 100.0).toString();\n  }\n}\n\n/**\n * Set listener on staff highlighting checkbox.\n */\nexport function setHighlightControls (): void {\n  const highlightDropdown = document.getElementById('highlight-dropdown');\n  const highlightStaff = document.getElementById('highlight-staff');\n  const highlightSyllable = document.getElementById('highlight-syllable');\n  const highlightNeume = document.getElementById('highlight-neume');\n  const highlightNone = document.getElementById('highlight-none');\n  const highlightType = document.getElementById('highlight-type');\n\n  document.getElementById('highlight-button').addEventListener('click', (evt) => {\n    evt.stopPropagation();\n    highlightDropdown.classList.toggle('is-active');\n    if (highlightDropdown.classList.contains('is-active')) {\n      document.body.addEventListener('click', highlightClickaway);\n      highlightStaff.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightStaff.classList.add('highlight-selected');\n        highlightType.textContent = ' - Staff';\n        Color.setGroupingHighlight('staff');\n      });\n      highlightSyllable.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightSyllable.classList.add('highlight-selected');\n        highlightType.textContent = ' - Syllable';\n        Color.setGroupingHighlight('syllable');\n      });\n      highlightNeume.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightNeume.classList.add('highlight-selected');\n        highlightType.textContent = ' - Neume';\n        Color.setGroupingHighlight('neume');\n      });\n      highlightNone.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightType.textContent = ' - Off';\n        Color.unsetGroupingHighlight();\n      });\n    } else {\n      document.body.removeEventListener('click', highlightClickaway);\n    }\n  });\n}\n\nexport function setHighlightSelectionControls (): void {\n  const highlightSelection = document.getElementById('highlight-selection');\n  highlightSelection.addEventListener('click', () => {\n    document.getElementById('highlight-dropdown').classList.remove('is-active');\n    document.querySelectorAll('.highlight-selected').forEach(elem => {\n      elem.classList.remove('highlight-selected');\n    });\n    highlightSelection.classList.add('highlight-selected');\n    document.getElementById('highlight-type').textContent = ' - Selection';\n    Color.setGroupingHighlight('selection');\n  });\n}\n\n/**\n * Reset the highlight for different types based on the 'highlight-selected' class in the DOM.\n */\nexport function updateHighlight (): void {\n  let highlightId: string;\n  try {\n    highlightId = document.querySelector('.highlight-selected').id;\n  } catch (e) {\n    highlightId = '';\n  }\n  switch (highlightId) {\n    case 'highlight-staff':\n      Color.setGroupingHighlight('staff');\n      break;\n    case 'highlight-syllable':\n      Color.setGroupingHighlight('syllable');\n      break;\n    case 'highlight-neume':\n      Color.setGroupingHighlight('neume');\n      break;\n    case 'highlight-selection':\n      Color.setGroupingHighlight('selection');\n      break;\n    default:\n      Color.unsetGroupingHighlight();\n  }\n}\n\n/**\n * Set listener on burger menu for smaller screens.\n */\nfunction setBurgerControls (): void {\n  document.getElementById('burgerMenu').addEventListener('click', () => {\n    document.getElementById('burgerMenu').classList.toggle('is-active');\n    document.getElementById('navMenu').classList.toggle('is-active');\n  });\n}\n\n/**\n * Clickaway listener for the highlight dropdown.\n */\nfunction highlightClickaway (): void {\n  document.body.removeEventListener('click', highlightClickaway);\n  document.getElementById('highlight-dropdown').classList.remove('is-active');\n}\n","import { uuidv4 } from './random';\n\nconst notifications: Notification[] = new Array(0);\nlet currentModeMessage: Notification = null;\nlet notifying = false;\n\n/**\n * Number of notifications to display at a time.\n */\nconst NUMBER_TO_DISPLAY = 3;\n\n/**\n * Add a notification to the queue.\n * @param notification - Notification content.\n */\nexport function queueNotification (notification: string): void {\n  const notif = new Notification(notification);\n  notifications.push(notif);\n  if (!notifying || document.getElementById('notification-content').querySelectorAll('.neon-notification').length < NUMBER_TO_DISPLAY) {\n    startNotification();\n  }\n}\n\n/**\n * Start displaying notifications. Called automatically.\n */\nfunction startNotification (): void {\n  if (notifications.length > 0) {\n    notifying = true;\n    const currentNotification = notifications.pop();\n    displayNotification(currentNotification);\n    currentNotification.setTimeoutId(window.setTimeout(clearOrShowNextNotification, 5000, currentNotification.getId()));\n    document.getElementById(currentNotification.getId()).addEventListener('click', () => {\n      window.clearTimeout(currentNotification.timeoutID);\n      clearOrShowNextNotification(currentNotification.getId());\n    });\n  }\n}\n\n/**\n * Display a notification.\n * @param notification - Notification to display.\n */\nfunction displayNotification (notification: Notification): void {\n  if (notification.isModeMessage) {\n    if (currentModeMessage === null) {\n      currentModeMessage = notification;\n    } else {\n      window.clearTimeout(currentModeMessage.timeoutID);\n      notifications.push(notification);\n      clearOrShowNextNotification(currentModeMessage.getId());\n      return;\n    }\n  }\n  const notificationContent = document.getElementById('notification-content');\n  notificationContent.innerHTML += '<div class=\\'neon-notification\\' id=\\'' + notification.getId() + '\\'>' + notification.message + '</div> ';\n  notificationContent.style.display = '';\n  notification.display();\n}\n\n/**\n * Clear the notifications if no more exist or display another from the queue.\n * @param currentId - The ID of the notification to be cleared.\n */\nfunction clearOrShowNextNotification (currentId: string): void {\n  document.getElementById(currentId).remove();\n  if (currentModeMessage !== null && currentModeMessage.getId() === currentId) {\n    currentModeMessage = null;\n  }\n  if (notifications.length > 0) {\n    startNotification();\n  } else if (document.querySelectorAll('.neon-notification').length === 0) {\n    document.getElementById('notification-content').style.display = 'none';\n    notifying = false;\n  }\n}\n\n/**\n * A class to manage Neon notifications.\n */\nclass Notification {\n  message: string;\n  displayed: boolean;\n  id: string;\n  isModeMessage: boolean;\n  timeoutID: number;\n  /**\n   * Create a new notification.\n   * @param message - Notification content.\n   */\n  constructor (message: string) {\n    this.message = message;\n    this.displayed = false;\n    this.id = uuidv4();\n    this.isModeMessage = message.search('Mode') !== -1;\n    this.timeoutID = -1;\n  }\n\n  /** Set the ID from setTimeout. */\n  setTimeoutId (id: number): void {\n    this.timeoutID = Math.max(id, -1);\n  }\n\n  /** Display the Notification. */\n  display (): void {\n    this.displayed = true;\n  }\n\n  /**\n   * @returns The UUID for this notification.\n   */\n  getId (): string {\n    return this.id;\n  }\n}\n","/**\n * Adapted from color palette from Figure 2 (Colors optimized for color-blind\n * individuals) from\n * [\"Points of view: Color blindness\" by Bang Wong published in Nature Methods volume 8 on 27 May 2011](https://www.nature.com/articles/nmeth.1618?WT.ec_id=NMETH-201106)\n */\nconst ColorPalette: string[] = [\n  'rgb(230, 159, 0)',\n  'rgb(86, 180, 233)',\n  'rgb(0, 158, 115)',\n  'rgb(240, 228, 66)',\n  'rgb(0, 114, 178)',\n  'rgb(213, 94, 0)',\n  'rgb(204, 121, 167)'\n];\n\n/**\n * Remove the highlight from a staff.\n * @param staff If undefined, the all staves are unhighlighted.\n */\nexport function unhighlight (staff?: SVGGElement): void {\n  let children: NodeListOf<Element>;\n  if (staff) {\n    children = staff.querySelectorAll(':not(.selected) .highlighted');\n  } else {\n    children = document.querySelectorAll(':not(.selected) .highlighted');\n  }\n  children.forEach(elem => {\n    if (elem.tagName === 'path' && !elem.closest('.staff').classList.contains('selected')) {\n      elem.setAttribute('stroke', '#000000');\n    } else {\n      elem.removeAttribute('fill');\n      let rects = elem.querySelectorAll('.sylTextRect-display');\n      if (!rects.length) {\n        try {\n          rects = elem.closest('.syllable').querySelectorAll('.sylTextRect-display');\n        } catch (e) {\n          rects = [] as unknown as NodeListOf<Element>;\n        }\n      }\n      rects.forEach(function (rect: HTMLElement) {\n        if (rect.closest('.syllable').classList.contains('selected') ||\n            rect.closest('.staff').classList.contains('selected') ||\n            rect.closest('.syl').classList.contains('selected')) {\n          rect.style.fill = 'red';\n        } else {\n          rect.style.fill = 'blue';\n        }\n        rect.classList.remove('highlighted');\n      });\n    }\n    elem.classList.remove('highlighted');\n  });\n}\n\n/**\n * Remove the highlight from each staff.\n */\nexport function unsetStaffHighlight (): void {\n  unhighlight();\n}\n\n/**\n * Unset highlight for all grouping types\n */\nexport function unsetGroupingHighlight (): void {\n  unsetStaffHighlight();\n  const highlighted = Array.from(document.getElementsByClassName('highlighted'))\n    .filter((elem: HTMLElement) => !elem.parentElement.classList.contains('selected'));\n  highlighted.forEach((elem: HTMLElement) => {\n    elem.setAttribute('fill', null);\n    let rects = elem.querySelectorAll('.sylTextRect-display');\n    if (!rects.length) {\n      if (elem.closest('.syllable') !== null) {\n        rects = elem.closest('.syllable').querySelectorAll('sylTextRect-display');\n      }\n    }\n    rects.forEach(function (rect: HTMLElement) {\n      if (rect.closest('.syllable').classList.contains('selected') || rect.closest('.syl').classList.contains('selected')) {\n        rect.style.fill = 'red';\n      } else {\n        rect.style.fill = 'blue';\n      }\n      rect.classList.remove('highlighted');\n    });\n    elem.classList.remove('highlighted');\n    elem.querySelectorAll('sylTextRect-display').forEach(rect => {\n      rect.classList.remove('highlighted');\n    });\n  });\n  Array.from(document.getElementsByClassName('selected')).forEach((el) => {el.setAttribute('fill', '');});\n}\n\n/**\n * Highlight a staff a certain color.\n */\nexport function highlight (staff: SVGGElement, color: string): void {\n  const children = Array.from(staff.children);\n  for (let i = 0; i < children.length; i++) {\n    const child = children[i];\n    if (child.tagName === 'path') {\n      child.setAttribute('stroke', color);\n    } else if (child.classList.contains('resizePoint') || child.id === 'resizeRect' || child.classList.contains('rotatePoint')) {\n      return;\n    } else if (child.classList.contains('layer')) {\n      Array.from(child.children).forEach(cchild => { children.push(cchild); });\n    } else if (document.getElementsByClassName('highlight-selected').length &&\n      document.getElementsByClassName('highlight-selected')[0].id === 'highlight-neume'\n      && child.classList.contains('syllable')) {\n      Array.from(child.children).filter(el => el.classList.contains('neume')).forEach(cchild => { children.push(cchild); });\n    } else {\n      child.setAttribute('fill', color);\n      let rects = child.querySelectorAll('.sylTextRect-display');\n      if (!rects.length) {\n        try {\n          rects = child.closest('.syllable').querySelectorAll('.sylTextRect-display');\n        } catch (e) {\n          rects = [] as unknown as NodeListOf<Element>;\n        }\n      }\n      rects.forEach(function (rect: HTMLElement) {\n        if (!(rect.closest('.syllable').classList.contains('selected') ||\n              rect.closest('.syl').classList.contains('selected') ||\n              rect.closest('.staff').classList.contains('selected'))) {\n          rect.style.fill = color;\n          rect.classList.add('highlighted');\n        }\n      });\n    }\n    child.classList.add('highlighted');\n  }\n  let width, height;\n  try {\n    width = Number(document.querySelector('.active-page').querySelector('svg').getAttribute('width').split('px')[0]);\n    height = Number(document.querySelector('.active-page').querySelector('svg').getAttribute('height').split('px')[0]);\n  } catch (e) {\n    console.debug(e);\n  }\n  let stroke: string;\n  if (width !== undefined && height !== undefined) {\n    // idk looks good :')\n    stroke = (width*height/1000000).toString();\n  }\n  else {\n    stroke = '30px';\n  }\n  staff.querySelectorAll('.nc, .custos, .clef').forEach(el => {\n    el.setAttribute('stroke', 'black');\n    el.setAttribute('stroke-width', stroke);\n  });\n}\n\n/**\n * Highlight each staff a different color.\n */\nexport function setStaffHighlight (): void {\n  const staves = Array.from(document.getElementsByClassName('staff')) as SVGGElement[];\n  for (let i = 0; i < staves.length; i++) {\n    const staffColor = ColorPalette[i % ColorPalette.length];\n    highlight(staves[i], staffColor);\n  }\n}\n\n/**\n * Set a highlight by a different grouping.\n * @param grouping - Either \"staff\", \"syllable\", or \"neume\".\n */\nexport function setGroupingHighlight (grouping: string): void {\n  unsetGroupingHighlight();\n  if (grouping === 'staff') {\n    setStaffHighlight();\n    return;\n  } else if (grouping === 'selection') {\n    const temp = document.querySelector('.sel-by.is-active').id;\n    switch (temp) {\n      case 'selBySyl':\n      case 'selByBBox':\n        grouping = 'syllable';\n        break;\n      case 'selByStaff':\n        grouping = 'staff';\n        break;\n      default:\n        grouping = 'neume';\n        break;\n    }\n    setGroupingHighlight(grouping);\n    return;\n  }\n\n  const groups = document.getElementsByClassName(grouping) as HTMLCollectionOf<HTMLElement>;\n  for (let i = 0; i < groups.length; i++) {\n    const groupColor = ColorPalette[i % ColorPalette.length];\n    if ((groups[i].closest('.selected') === null) && !groups[i].classList.contains('selected')) {\n      groups[i].setAttribute('fill', groupColor);\n      const rects = groups[i].querySelectorAll('.sylTextRect-display') as NodeListOf<HTMLElement>;\n      rects.forEach(function (rect) {\n        if (rect.closest('.syl').classList.contains('selected') ||\n            rect.closest('.syllable').classList.contains('selected') ||\n            rect.closest('.staff').classList.contains('selected')) {\n          return;\n        }\n        rect.style.fill = groupColor;\n      });\n      groups[i].classList.add('highlighted');\n      groups[i].querySelectorAll('.sylTextRect-display').forEach(rect => {\n        rect.classList.add('highlighted');\n      });\n    } else {\n      if (!groups[i].classList.contains('selected')) {\n        groups[i].setAttribute('fill', null);\n      } else {\n        groups[i].setAttribute('fill', '#d00');\n      }\n      groups[i].classList.remove('highlighted');\n    }\n  }\n  document.querySelectorAll('.nc, .custos, .clef').forEach(el => {\n    el.setAttribute('stroke', 'black');\n    el.setAttribute('stroke-width', '30px');\n  });\n}\n","import * as Contents from './Contents';\nimport * as Grouping from './Grouping';\nimport * as Notification from '../utils/Notification';\nimport NeonView from '../NeonView';\nimport { SplitHandler } from './StaffTools';\nimport { EditorAction } from '../Types';\nimport { getStaffBBox } from '../utils/SelectTools';\n\n/**\n * The NeonView parent to call editor actions.\n */\nlet neonView: NeonView;\n\n/**\n * Initialize NeonView.\n */\nexport function initNeonView (view: NeonView): void {\n  neonView = view;\n  Grouping.initNeonView(view);\n}\n\n/**\n * @param id - The id of the neume component.\n * @returns An action that unsets the inclinatum parameter of a neume component.\n */\nexport function unsetInclinatumAction (id: string): EditorAction {\n  return {\n    'action': 'set',\n    'param': {\n      'elementId': id,\n      'attrType': 'tilt',\n      'attrValue': ''\n    }\n  };\n}\n\n/**\n * @param id - The id of the neume component.\n * @returns An action that unsets the virga parameter of a neume component.\n */\nexport function unsetVirgaAction (id: string): EditorAction {\n  return {\n    'action': 'set',\n    'param': {\n      'elementId': id,\n      'attrType': 'tilt',\n      'attrValue': ''\n    }\n  };\n}\n\n/**\n * Function to handle removing elements\n */\nexport function removeHandler (): void {\n  const toRemove = [];\n  const selected = Array.from(document.getElementsByClassName('selected'));\n  selected.forEach(elem => {\n    toRemove.push(\n      {\n        'action': 'remove',\n        'param': {\n          'elementId': elem.id\n        }\n      }\n    );\n  });\n  const chainAction: EditorAction = {\n    'action': 'chain',\n    'param': toRemove\n  };\n  endOptionsSelection();\n  neonView.edit(chainAction, neonView.view.getCurrentPageURI()).then(() => { neonView.updateForCurrentPage(); });\n}\n\n/**\n * Function to handle re-associating elements to the nearest staff\n */\nexport function changeStaffHandler(): void {\n  const toChange: EditorAction[] = [];\n  const selected = Array.from(document.getElementsByClassName('selected'));\n  selected.forEach(elem => {\n    toChange.push(\n      {\n        'action': 'changeStaff',\n        'param': {\n          'elementId': elem.id\n        }\n      }\n    );\n  });\n  const chainAction: EditorAction = {\n    'action': 'chain',\n    'param': toChange\n  };\n  endOptionsSelection();\n  neonView.edit(chainAction, neonView.view.getCurrentPageURI()).then(() => { neonView.updateForCurrentPage(); });\n}\n\n/**\n * Trigger the extra nc action menu for a selection.\n */\nexport function triggerNcActions (nc: SVGGraphicsElement): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.custosActionContents;\n  } catch (e) {}\n  try {\n    const extraEdit = document.getElementById('extraEdit');\n    extraEdit.classList.remove('is-invisible');\n    extraEdit.innerHTML = Contents.ncActionContents;\n  } catch (e) {}\n  document.querySelector('#Punctum.dropdown-item')\n    .addEventListener('click', () => {\n      const unsetInclinatum = unsetInclinatumAction(nc.id);\n      const unsetVirga = unsetVirgaAction(nc.id);\n      neonView.edit({ 'action': 'chain', 'param': [ unsetInclinatum, unsetVirga ] }, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n\n  document.querySelector('#Inclinatum.dropdown-item')\n    .addEventListener('click', () => {\n      const setInclinatum = {\n        'action': 'set',\n        'param': {\n          'elementId': nc.id,\n          'attrType': 'tilt',\n          'attrValue': 'se'\n        }\n      };\n      neonView.edit(setInclinatum, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n\n  document.querySelector('#Virga.dropdown-item')\n    .addEventListener('click', () => {\n      const unsetInclinatum = unsetInclinatumAction(nc.id);\n      const setVirga = {\n        'action': 'set',\n        'param': {\n          'elementId': nc.id,\n          'attrType': 'tilt',\n          'attrValue': 'n'\n        }\n      };\n      neonView.edit({ 'action': 'chain', 'param': [ unsetInclinatum, setVirga ] }, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n  initOptionsListeners();\n}\n\n/**\n * Trigger extra neume actions.\n */\nexport function triggerNeumeActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.custosActionContents;\n  } catch (e) {}\n  try {\n    const extraEdit = document.getElementById('extraEdit');\n    extraEdit.classList.remove('is-invisible');\n    extraEdit.innerHTML = Contents.neumeActionContents;\n  } catch (e) {}\n  const neume = document.querySelectorAll('.selected');\n  if (neume.length !== 1) {\n    console.warn('More than one neume selected! Cannot trigger Neume ClickSelect actions.');\n    return;\n  }\n\n  document.querySelector('.grouping')\n    .addEventListener('click', (e) => {\n      const contour = neonView.info.getContourByValue((e.target as HTMLElement).id);\n      triggerChangeGroup(contour);\n    });\n\n  function triggerChangeGroup (contour): void {\n    const changeGroupingAction: EditorAction = {\n      'action': 'changeGroup',\n      'param': {\n        'elementId': neume[0].id,\n        'contour': contour\n      }\n    };\n    neonView.edit(changeGroupingAction, neonView.view.getCurrentPageURI()).then((result) => {\n      if (result) {\n        Notification.queueNotification('Grouping Changed');\n      } else {\n        Notification.queueNotification('Grouping Failed');\n      }\n      endOptionsSelection();\n      neonView.updateForCurrentPage();\n    });\n  }\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n  initOptionsListeners();\n  Grouping.initGroupingListeners();\n}\n\n/**\n * Trigger extra syllable actions.\n */\nexport function triggerSylActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML =\n      '<div><p class=\\'control\\'>' +\n          '<button class=\\'button\\' id=\\'ungroupNeumes\\'>Ungroup</button></p></div>' +\n      '<div><p class=\\'control\\'>' +\n          '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>' +\n      '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>';\n    document.getElementById('changeStaff').addEventListener('click', changeStaffHandler);\n  } catch (e) {}\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n  Grouping.initGroupingListeners();\n}\n\n/**\n * Trigger extra clef actions for a specific clef.\n * @param clef - The clef on which to trigger additional actions.\n */\nexport function triggerClefActions (clef: SVGGraphicsElement): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    // custos contents is just the delete button\n    moreEdit.innerHTML = Contents.custosActionContents;\n  } catch (e) {}\n  try {\n    const extraEdit = document.getElementById('extraEdit');\n    extraEdit.classList.remove('is-invisible');\n    extraEdit.innerHTML = Contents.clefActionContents;\n  } catch (e) {}\n  document.querySelector('#CClef.dropdown-item')\n    .addEventListener('click', () => {\n      const setCClef: EditorAction = {\n        'action': 'setClef',\n        'param': {\n          'elementId': clef.id,\n          'shape': 'C'\n        }\n      };\n      neonView.edit(setCClef, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  document.querySelector('#FClef.dropdown-item')\n    .addEventListener('click', () => {\n      const setFClef: EditorAction = {\n        'action': 'setClef',\n        'param': {\n          'elementId': clef.id,\n          'shape': 'F'\n        }\n      };\n      neonView.edit(setFClef, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n    document.getElementById('changeStaff').addEventListener('click', changeStaffHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n\n  initOptionsListeners();\n}\n\n/**\n * Trigger extra custos actions.\n */\nexport function triggerCustosActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML += Contents.custosActionContents;\n  } catch (e) {}\n\n  try {\n    document.getElementById('changeStaff')\n      .addEventListener('click', changeStaffHandler);\n  } catch (e) {}\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n    document.body.addEventListener('keydown', deleteButtonHandler);\n  } catch (e) {}\n}\n\n/**\n * Trigger extra staff actions.\n */\nexport function triggerStaffActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.staffActionContents;\n  } catch (e) {}\n\n  document.getElementById('merge-systems')\n    .addEventListener('click', () => {\n      const systems = document.querySelectorAll('.staff.selected');\n      const elementIds = [];\n      systems.forEach(staff => {\n        elementIds.push(staff.id);\n      });\n      const editorAction: EditorAction = {\n        'action': 'merge',\n        'param': {\n          'elementIds': elementIds\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Staff Merged');\n          endOptionsSelection();\n          neonView.updateForCurrentPage();\n        } else {\n          Notification.queueNotification('Merge Failed');\n        }\n      });\n    });\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * Trigger split staff option\n */\nexport function triggerSplitActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.splitActionContents;\n  } catch (e) {}\n\n  // TODO add trigger for split action\n  document.getElementById('split-system')\n    .addEventListener('click', () => {\n      const staff = document.querySelector('.staff.selected') as SVGGElement;\n      if (staff !== null) {\n        const split = new SplitHandler(neonView, staff);\n        split.startSplit();\n        endOptionsSelection();\n      } else {\n        console.error('No staff was selected!');\n        endOptionsSelection();\n      }\n    });\n\n  document.getElementById('reset-rotate')\n    .addEventListener('click', () => {\n      const staff = document.querySelector('.staff.selected') as SVGElement;\n      const rect = staff.querySelector('#resizeRect');\n      const co = rect.getAttribute('points').split(' ');\n      const dy = parseInt(co[0].split(',')[1]) - parseInt(co[1].split(',')[1]);\n      let points = getStaffBBox(staff as SVGGElement);\n      let y_change = Math.tan(points.rotate)*(points.lrx - points.ulx);\n      if (staff !== null) {\n        const editorAction: EditorAction = {\n          'action': 'resizeRotate',\n          'param': {\n            'elementId': staff.id,\n            \"ulx\": points.ulx,\n            \"uly\": points.rotate > 0 ? points.uly + y_change/2 : points.uly - y_change/2,\n            \"lrx\": points.lrx,\n            \"lry\": points.rotate > 0 ? points.lry - y_change/2 : points.lry + y_change/2,\n            \"rotate\": 0\n          }\n        };\n        neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then(async (result) => {\n          if (result) {\n            await neonView.updateForCurrentPage();\n          }\n        });\n        endOptionsSelection();\n      } else {\n        console.error('No staff was selected');\n        endOptionsSelection();\n      }\n    });\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * Trigger default actions when selecting by syl\n */\nexport function triggerDefaultSylActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.defaultSylActionContents;\n  } catch (e) {}\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n  try {\n    const changeStaff = document.getElementById('changeStaff');\n    changeStaff.removeEventListener('click', changeStaffHandler);\n    changeStaff.addEventListener('click', changeStaffHandler);\n  } catch(e) {}\n}\n\n/**\n * Trigger default selection option.\n */\nexport function triggerDefaultActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.defaultActionContents;\n  } catch (e) {}\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * End the extra options menu.\n */\nexport function endOptionsSelection (): void {\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.innerHTML = '';\n    moreEdit.classList.add('is-invisible');\n  } catch (e) {}\n  document.body.removeEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * Initialize extra dropdown options.\n */\nfunction initOptionsListeners (): void {\n  document.getElementById('drop_select').addEventListener('click', function () {\n    this.classList.toggle('is-active');\n  });\n}\n\n/** Event handler for delete button press. */\nexport function deleteButtonHandler (evt: KeyboardEvent): void {\n  if (evt.key === 'd' || evt.key === 'Backspace') { removeHandler(); evt.preventDefault(); }\n}\n","import NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport * as d3 from 'd3';\n\nclass DragHandler {\n  private dragStartCoords: Array<number>;\n  private resetToAction: (selection: d3.Selection<d3.BaseType, {}, HTMLElement, any>, args: any[]) => void;\n  readonly neonView: NeonView;\n  private selector: string;\n  private selection: Element[];\n  private dx: number;\n  private dy: number;\n\n  /**\n   * @param selector - CSS selector of element to apply drag handler to.\n   */\n  constructor (neonView: NeonView, selector: string) {\n    this.neonView = neonView;\n    this.selector = selector;\n  }\n\n  /**\n   * Initialize the dragging action and handler for selected elements.\n   */\n  dragInit (): void {\n    // Adding listeners\n    const dragBehaviour = d3.drag()\n      .on('start', dragStarted.bind(this))\n      .on('drag', this.dragging.bind(this))\n      .on('end', this.dragEnded.bind(this));\n\n    const activeNc = d3.selectAll('.selected');\n    const selection = Array.from(document.getElementsByClassName('selected'));\n    this.selection = selection.concat(Array.from(document.getElementsByClassName('resizePoint')));\n\n    this.dragStartCoords = new Array(activeNc.size());\n\n    activeNc.call(dragBehaviour);\n\n    // Drag effects\n    function dragStarted (): void {\n      this.dragStartCoords = [d3.event.x, d3.event.y];\n      this.dx = 0;\n      this.dy = 0;\n      const target = d3.event.sourceEvent.target;\n      if (target.classList.contains('staff')) {\n        d3.select(this.selector).call(dragBehaviour);\n      }\n    }\n  }\n\n  dragging (): void {\n    const relativeY = d3.event.y - this.dragStartCoords[1];\n    const relativeX = d3.event.x - this.dragStartCoords[0];\n    this.dx = d3.event.x - this.dragStartCoords[0];\n    this.dy = d3.event.y - this.dragStartCoords[1];\n    this.selection.forEach((el) => {\n      d3.select(el).attr('transform', function () {\n        return 'translate(' + [relativeX, relativeY] + ')';\n      });\n    });\n    /*\n     * if we're dragging a syllable (or neume etc) then there won't be a syl selected\n     * then we don't want the bounding box (if it is displayed) to move when dragging the neumes\n     * it will be a child of the element in selection, so it will get moved in the above loop\n     * so we cancel that movement out here\n     */\n    if (this.selection.filter((element: HTMLElement) => element.classList.contains('syl')).length === 0) {\n      d3.selectAll('.syllable.selected').selectAll('.sylTextRect-display').attr('transform', function () {\n        return 'translate(' + [-1 * relativeX, -1 * relativeY] + ')';\n      });\n    }\n  }\n\n  dragEnded (): void {\n    const paramArray = [];\n    this.selection.filter((el: SVGElement) => !el.classList.contains('resizePoint')).forEach((el: SVGElement) => {\n      const id = (el.tagName === 'rect') ? el.closest('.syl').id : el.id;\n      const singleAction = { action: 'drag',\n        param: { elementId: id,\n          x: this.dx,\n          y: (this.dy) * -1 }\n      };\n      paramArray.push(singleAction);\n    });\n    const editorAction: EditorAction = {\n      'action': 'chain',\n      'param': paramArray\n    };\n\n    const xDiff = Math.abs(this.dx);\n    const yDiff = Math.abs(this.dy);\n\n    if (xDiff > 5 || yDiff > 5) {\n      this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then(() => {\n        this.neonView.updateForCurrentPage();\n        this.endOptionsSelection();\n        this.reset();\n        this.dragInit();\n      });\n    } else {\n      this.reset();\n      this.dragInit();\n    }\n  }\n\n  /** Set the d3 action to use for [[reset]]. */\n  resetTo (reset: (selection: d3.Selection<d3.BaseType, {}, HTMLElement, any>, args: any[]) => void): void {\n    this.resetToAction = reset;\n  }\n\n  /** Reset to a previous d3 action for [[this.selector]]. */\n  reset (): void {\n    if (this.resetToAction !== undefined) {\n      d3.select(this.selector).call(this.resetToAction);\n    }\n  }\n\n  endOptionsSelection (): void {\n    try {\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('moreEdit').classList.add('is-invisible');\n    } catch (e) {}\n  }\n}\n\nexport { DragHandler as default };\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} raw     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     raw True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","/**\n * Formats raw UUID data into the proper string format.\n * @param data - Raw UUID data.\n * @returns Formatted UUID string.\n */\nfunction uint8ToUuid (data: Uint8Array): string {\n  if (data.length !== 16) {\n    return '';\n  }\n\n  function cb (previous: string, current: number): string {\n    return previous + current.toString(16).padStart(2, '0');\n  }\n\n  return data.slice(0, 4).reduce(cb, '') +\n    '-' + data.slice(4, 6).reduce(cb, '') +\n    '-' + data.slice(6, 8).reduce(cb, '') +\n    '-' + data.slice(8, 10).reduce(cb, '') +\n    '-' + data.slice(10).reduce(cb, '');\n}\n\n/**\n * @returns A [version 4 UUID](https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_(random)).\n */\nexport function uuidv4 (): string {\n  // Check for crypto API\n  if (window.crypto === undefined) {\n    return uint8ToUuid(new Uint8Array(16));\n  }\n\n  // Get 16 octets for UUID\n  const octets = new Uint8Array(16);\n  const modifiers = Uint8Array.from([\n    parseInt('01000000', 2),  // Version bits (4 => 0100)\n    parseInt('10000000', 2),  // Variant bits (10x)\n    parseInt('00001111', 2),  // Mask to zero higher bits, version\n    parseInt('00111111', 2)   // Mask to zero higher bits, variant\n  ]);\n  window.crypto.getRandomValues(octets);\n  // Set version bits and variant bits\n  octets[6] = (octets[6] & modifiers[2]) | modifiers[0];\n  octets[8] = (octets[8] & modifiers[3]) | modifiers[1];\n\n  return uint8ToUuid(octets);\n}\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar punycode = require('punycode');\nvar util = require('./util');\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // Special case for a simple path URL\n    simplePathPattern = /^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[+a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = require('querystring');\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && util.isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!util.isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  // Copy chrome, IE, opera backslash-handling behavior.\n  // Back slashes before the query string get converted to forward slashes\n  // See: https://code.google.com/p/chromium/issues/detail?id=25916\n  var queryIndex = url.indexOf('?'),\n      splitter =\n          (queryIndex !== -1 && queryIndex < url.indexOf('#')) ? '?' : '#',\n      uSplit = url.split(splitter),\n      slashRegex = /\\\\/g;\n  uSplit[0] = uSplit[0].replace(slashRegex, '/');\n  url = uSplit.join(splitter);\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  if (!slashesDenoteHost && url.split('#').length === 1) {\n    // Try fast path regexp\n    var simplePath = simplePathPattern.exec(rest);\n    if (simplePath) {\n      this.path = rest;\n      this.href = rest;\n      this.pathname = simplePath[1];\n      if (simplePath[2]) {\n        this.search = simplePath[2];\n        if (parseQueryString) {\n          this.query = querystring.parse(this.search.substr(1));\n        } else {\n          this.query = this.search.substr(1);\n        }\n      } else if (parseQueryString) {\n        this.search = '';\n        this.query = {};\n      }\n      return this;\n    }\n  }\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a punycoded representation of \"domain\".\n      // It only converts parts of the domain name that\n      // have non-ASCII characters, i.e. it doesn't matter if\n      // you call it with a domain that already is ASCII-only.\n      this.hostname = punycode.toASCII(this.hostname);\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      if (rest.indexOf(ae) === -1)\n        continue;\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (util.isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      util.isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (util.isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  var tkeys = Object.keys(this);\n  for (var tk = 0; tk < tkeys.length; tk++) {\n    var tkey = tkeys[tk];\n    result[tkey] = this[tkey];\n  }\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    var rkeys = Object.keys(relative);\n    for (var rk = 0; rk < rkeys.length; rk++) {\n      var rkey = rkeys[rk];\n      if (rkey !== 'protocol')\n        result[rkey] = relative[rkey];\n    }\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      var keys = Object.keys(relative);\n      for (var v = 0; v < keys.length; v++) {\n        var k = keys[v];\n        result[k] = relative[k];\n      }\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!util.isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especially happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host || srcPath.length > 1) &&\n      (last === '.' || last === '..') || last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last === '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especially happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n","\nvar urilib = require('url');\nvar helpers = require('./helpers');\n\nmodule.exports.SchemaScanResult = SchemaScanResult;\nfunction SchemaScanResult(found, ref){\n  this.id = found;\n  this.ref = ref;\n}\n\n/**\n * Adds a schema with a certain urn to the Validator instance.\n * @param string uri\n * @param object schema\n * @return {Object}\n */\nmodule.exports.scan = function scan(base, schema){\n  function scanSchema(baseuri, schema){\n    if(!schema || typeof schema!='object') return;\n    // Mark all referenced schemas so we can tell later which schemas are referred to, but never defined\n    if(schema.$ref){\n      var resolvedUri = urilib.resolve(baseuri, schema.$ref);\n      ref[resolvedUri] = ref[resolvedUri] ? ref[resolvedUri]+1 : 0;\n      return;\n    }\n    var ourBase = schema.id ? urilib.resolve(baseuri, schema.id) : baseuri;\n    if (ourBase) {\n      // If there's no fragment, append an empty one\n      if(ourBase.indexOf('#')<0) ourBase += '#';\n      if(found[ourBase]){\n        if(!helpers.deepCompareStrict(found[ourBase], schema)){\n          throw new Error('Schema <'+schema+'> already exists with different definition');\n        }\n        return found[ourBase];\n      }\n      found[ourBase] = schema;\n      // strip trailing fragment\n      if(ourBase[ourBase.length-1]=='#'){\n        found[ourBase.substring(0, ourBase.length-1)] = schema;\n      }\n    }\n    scanArray(ourBase+'/items', ((schema.items instanceof Array)?schema.items:[schema.items]));\n    scanArray(ourBase+'/extends', ((schema.extends instanceof Array)?schema.extends:[schema.extends]));\n    scanSchema(ourBase+'/additionalItems', schema.additionalItems);\n    scanObject(ourBase+'/properties', schema.properties);\n    scanSchema(ourBase+'/additionalProperties', schema.additionalProperties);\n    scanObject(ourBase+'/definitions', schema.definitions);\n    scanObject(ourBase+'/patternProperties', schema.patternProperties);\n    scanObject(ourBase+'/dependencies', schema.dependencies);\n    scanArray(ourBase+'/disallow', schema.disallow);\n    scanArray(ourBase+'/allOf', schema.allOf);\n    scanArray(ourBase+'/anyOf', schema.anyOf);\n    scanArray(ourBase+'/oneOf', schema.oneOf);\n    scanSchema(ourBase+'/not', schema.not);\n  }\n  function scanArray(baseuri, schemas){\n    if(!(schemas instanceof Array)) return;\n    for(var i=0; i<schemas.length; i++){\n      scanSchema(baseuri+'/'+i, schemas[i]);\n    }\n  }\n  function scanObject(baseuri, schemas){\n    if(!schemas || typeof schemas!='object') return;\n    for(var p in schemas){\n      scanSchema(baseuri+'/'+p, schemas[p]);\n    }\n  }\n\n  var found = {};\n  var ref = {};\n  var schemaUri = base;\n  scanSchema(base, schema);\n  return new SchemaScanResult(found, ref);\n}\n","/**\n * HTML for each insert tab (neume, grouping, clef, system, and division).\n */\nexport const insertTabHtml: Record<string, string> = {\n  primitiveTab: '<p class=\\'control\\'>' +\n        '<button id=\\'punctum\\' class=\\'button insertel smallel\\' title=\\'punctum\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/punctum.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'virga\\' class=\\'button insertel smallel\\' title=\\'virga\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/virga.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'diamond\\' class=\\'button insertel smallel\\' title=\\'inclinatum\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/diamond.png' + '\\' class=\\'image\\'/></button></p>' +\n  /*  \"<p class='control'>\" +\n        \"<button id='white_punct' class='button insertel smallel' title='white punctum'><img src='\" + White__ASSET_PREFIX__ + 'assets/img/punctum.png' + \"' class='image'/></button></p>\" +\n        \"<p class='control'>\" +\n        \"<button id='quilisma' class='button insertel smallel' title='quilisma'><img src='\" + __ASSET_PREFIX__ + 'assets/img/quilisma.png' + \"' class='image'/></button></p>\" + */\n        '<p class=\\'control\\'>' +\n        '<button id=\\'custos\\' class=\\'button insertel smallel\\' title=\\'custos\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/custos.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'cClef\\' class=\\'button insertel smallel\\' title=\\' C Clef\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/cClef.png' + '\\' class=\\'image\\' /></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'fClef\\' class=\\'button insertel smallel\\' title=\\'F Clef\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/fClef.png' + '\\' class=\\'image\\'/></button></p>',\n  groupingTab: '<p class=\\'control\\'>' +\n        '<button id=\\'pes\\' class=\\'button insertel smallel\\' title=\\'pes\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/pes.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'clivis\\' class=\\'button insertel smallel\\' title=\\'clivis\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/clivis.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'scandicus\\' class=\\'button insertel smallel\\' title=\\'scandicus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/scandicus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'climacus\\' class=\\'button insertel smallel\\' title=\\'climacus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/climacus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'torculus\\' class=\\'button insertel smallel\\' title=\\'toculus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/torculus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'porrectus\\' class=\\'button insertel smallel\\' title=\\'porrectus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/porrectus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'pressus\\' class=\\'button insertel smallel\\' title=\\'pressus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/pressus.png' + '\\' class=\\'image\\'/></button></p>',\n  systemTab: '<p class=\\'control\\'>' +\n        '<button id=\\'staff\\' class=\\'button insertel longel\\' title=\\'system\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/staff.png' + '\\' class=\\'image\\' /></button></p>' +\n        '<p>Click upper left and lower right corners of new staff.</p>'\n  // divisionTab: \"<p class='control'>\" +\n  //     \"<button id='smallDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/smalldiv.png' + \"' class='image'/></button></p>\" +\n  //     \"<p class='control'>\" +\n  //     \"<button id='minorDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/minordiv.png' +\"' class='image'/></button></p>\" +\n  //     \"<p class='control'>\" +\n  //     \"<button id='majorDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/majordiv.png' + \"' class='image'/></button></p>\" +\n  //     \"<p class='control'>\" +\n  //     \"<button id='finalDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/finaldiv.png' + \"' class='image'/></button></p>\"\n};\n\n/**\n * Structure of insert panel with basic grouping tabs.\n */\nexport const insertControlsPanel: string =\n    '<p class=\\'panel-heading\\' id=\\'insertMenu\\'>Insert' +\n    '<svg class=\\'icon is-pulled-right\\'><use id=\\'toggleInsert\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></p>' +\n    '<div id=\\'insertContents\\' style=\\'overflow-y: hidden;\\'>' +\n    '<p class=\\'panel-tabs\\'>' +\n    '<a id=\\'primitiveTab\\' class=\\'insertTab\\'>Primitive Elements</a>' +\n    '<a id=\\'groupingTab\\' class=\\'insertTab\\'>Grouping</a>' +\n    '<a id=\\'systemTab\\' class=\\'insertTab\\'>System</a></p>' +\n    // \"<a id='divisionTab' class='insertTab'>Division</a></p>\" +\n    '<a class=\\'panel-block has-text-centered\\'>' +\n    '<div id=\\'insert_data\\' class=\\'field is-grouped buttons\\'></div></a></div>';\n\n/**\n * Contents of edit panel with buttons.\n */\nexport const editControlsPanel: string =\n    '<p class=\\'panel-heading\\' id=\\'editMenu\\'>Edit' +\n    '<svg class=\\'icon is-pulled-right\\'><use id=\\'toggleEdit\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></p>' +\n    '<div id=\\'editContents\\'>' +\n    '<a class=\\'panel-block\\'>' +\n    '<label>Select By:&nbsp;</label>' +\n    '<div class=\\'field has-addons buttons\\' style=\\'overflow-x: auto;\\'>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by is-active\\' id=\\'selBySyl\\'>Syllable</button></p>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by\\' id=\\'selByNeume\\'>Neume</button></p>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by\\' id=\\'selByNc\\'>Neume Component</button></p>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by\\' id=\\'selByStaff\\'>Staff</button></p></div></a>' +\n    '<div class=\\'field is-grouped buttons\\'>' +\n    '<p class=\\'control\\'>' +\n    '<a id=\\'moreEdit\\' class=\\'panel-block is-invisible\\'>' +\n    '<a id=\\'extraEdit\\' class=\\'panel-block is-invisible\\'>' +\n    /*\n     * The extraEdit panel is added for edit options that have dropdown menus\n     * Like the Neume and Clef menus\n     * This is done because the moreEdit menu needs to have overflow for cases where it has lots of buttons\n     * But overflow ruins dropdown menus\n     */\n    '<a id=\\'neumeEdit\\' class=\\'panel-block is-invisible\\'></div>';\n\n/**\n * Contents of extra nc action menu.\n */\nexport const ncActionContents: string =\n        '<label>Change Head Shape:&nbsp;</label>' +\n        '<div id=\\'drop_select\\' class=\\'dropdown\\'>' +\n        '<div class=\\'dropdown-trigger\\'>' +\n        '<button id=\\'select-options\\' class=\\'button\\' aria-haspopup=\\'true\\' aria-controls=\\'dropdown-menu\\'>' +\n        '<span>Head Shapes</span>' +\n        '<svg class=\\'icon\\'><use xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></button></div>' +\n        '<div class=\\'dropdown-menu\\' id=\\'dropdown-menu\\' role=\\'menu\\'>' +\n        '<div class=\\'dropdown-content\\'>' +\n        '<a id=\\'Punctum\\' class=\\'dropdown-item\\'>Punctum</a>' +\n        '<a id=\\'Virga\\' class=\\'dropdown-item\\'>Virga</a>' +\n        '<a id=\\'Inclinatum\\' class=\\'dropdown-item\\'>Inclinatum</a></div></div></div>' +\n        '<p class=\\'control\\'></p></div>';\n\n/**\n * Contents of extra neume action menu.\n */\nexport const neumeActionContents: string =\n        '<label>Change Grouping:&nbsp;</label>' +\n        '<div id=\\'drop_select\\' class=\\'dropdown\\'>' +\n        '<div class=\\'dropdown-trigger\\'>' +\n        '<button id=\\'select-options\\' class=\\'button\\' aria-haspopup=\\'true\\' aria-controls=\\'dropdown-menu\\'>' +\n        '<span>Groupings</span>' +\n        '<svg class=\\'icon\\'><use xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></button></div>' +\n        '<div class=\\'dropdown-menu\\' id=\\'dropdown-menu\\' role=\\'menu\\'>' +\n        '<div class=\\'dropdown-content scrollable-dropdown\\'>' +\n        '<a id=\\'Pes\\' class=\\'dropdown-item grouping\\'>Pes</a>' +\n        '<a id=\\'Pes subpunctis\\' class=\\'dropdown-item grouping\\'>Pes Subpunctis</a>' +\n        '<a id=\\'Clivis\\' class=\\'dropdown-item grouping\\'>Clivis</a>' +\n        '<a id=\\'Scandicus\\' class=\\'dropdown-item grouping\\'>Scandicus</a>' +\n        '<a id=\\'Scandicus flexus\\' class=\\'dropdown-item grouping\\'>Scandicus Flexus</a>' +\n        '<a id=\\'Scandicus subpunctis\\' class=\\'dropdown-item grouping\\'>Scandicus Subpunctis</a>' +\n        '<a id=\\'Climacus\\' class=\\'dropdown-item grouping\\'>Climacus</a>' +\n        '<a id=\\'Climacus resupinus\\' class=\\'dropdown-item grouping\\'>Climacus Resupinus</a>' +\n        '<a id=\\'Torculus\\' class=\\'dropdown-item grouping\\'>Torculus</a>' +\n        '<a id=\\'Torculus resupinus\\' class=\\'dropdown-item grouping\\'>Torculus Resupinus</a>' +\n        '<a id=\\'Porrectus\\' class=\\'dropdown-item grouping\\'>Porrectus</a>' +\n        '<a id=\\'Porrectus flexus\\' class=\\'dropdown-item grouping\\'>Porrectus Flexus</a>' +\n        '<a id=\\'Porrectus subpunctis\\' class=\\'dropdown-item grouping\\'>Porrectus Subpunctis</a>' +\n        '<a id=\\'Pressus\\' class=\\'dropdown-item grouping\\'>Pressus</a>' +\n        '</div></div></div>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'ungroupNcs\\'>Ungroup</button></p></div>';\n\n/**\n * Contents of extra staff action menu.\n */\nexport const staffActionContents: string =\n    '<label>Merge Systems:&nbsp;</label>' +\n    '<div><p class=\\'control\\'>' +\n    '<button id=\\'merge-systems\\' class=\\'button\\'>Merge</button>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of default action menu.\n */\nexport const defaultActionContents: string =\n    '<div><p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of default action menu when selecting by syllable\n * Same as above except includes re-associate to nearest staff\n */\n export const defaultSylActionContents: string =\n    '<div><p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n    '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>';\n    \n/**\n * Contents of custos action menu.\n */\nexport const custosActionContents: string =\n    '<div><p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n    '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>';\n\n/**\n * Contents of split action menu.\n * @type {string}\n */\nexport const splitActionContents: string=\n    '<label>Split System:&nbsp;</label>' +\n    '<div><p class=\\'control\\'>' +\n    '<button id=\\'split-system\\' class=\\'button\\'>Split</button>' +\n    '<button id=\\'reset-rotate\\' class=\\'button\\'>Reset Rotate</button>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of extra clef action menu.\n */\nexport const clefActionContents: string =\n    '<label>Change Clef Shape:&nbsp;</label>' +\n    '<div id=\\'drop_select\\' class=\\'dropdown\\'>' +\n    '<div class=\\'dropdown-trigger\\'overflow=\\'auto\\'>' +\n    '<button id=\\'select-options\\' class=\\'button\\' aria-haspopup=\\'true\\' aria-controls=\\'dropdown-menu\\'>' +\n    '<span>Clef Shapes</span>' +\n    '<svg class=\\'icon\\'><use xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></button></div>' +\n    '<div class=\\'dropdown-menu\\' id=\\'dropdown-menu\\' role=\\'menu\\'>' +\n    '<div class=\\'dropdown-content\\'>' +\n    '<a id=\\'CClef\\' class=\\'dropdown-item\\'>C Clef</a>' +\n    '<a id=\\'FClef\\' class=\\'dropdown-item\\'>F Clef</a></div></div></div></div>';\n\n/**\n * HTML for grouping selection menu.\n */\nexport const groupingMenu: object = {\n  'nc': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'groupNcs\\'>Group Neume Components</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>',\n  'neume': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'groupNeumes\\'>Group Neumes</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>',\n  'syl': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'mergeSyls\\'>Merge Syllables</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n        '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>',\n  'ligatureNc': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'groupNcs\\'>Group Neume Components</button></p></div>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'toggle-ligature\\'>Toggle Ligature</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div></div>',\n  'ligature': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'toggle-ligature\\'>Toggle Ligature</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div></div>',\n  'splitSyllable': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'toggle-link\\'>Toggle Linked Syllables</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div></div>'\n};\n","/** @module utils/Select */\n\nimport {\n  unselect, getStaffBBox, selectStaff, selectAll, getSelectionType\n} from './SelectTools';\nimport { resize } from './Resize';\nimport NeonView from '../NeonView';\nimport DragHandler from './DragHandler';\nimport { InfoInterface } from '../Interfaces';\nimport ZoomHandler from '../SingleView/Zoom';\n\nimport * as d3 from 'd3';\n\nlet dragHandler: DragHandler, neonView: NeonView, info: InfoInterface, zoomHandler: ZoomHandler;\nlet strokeWidth = 7;\n\n/**\n * Set stroke width on drag select box.\n * @param width - Stroke width in pixels.\n */\nexport function setSelectStrokeWidth (width: number): void {\n  strokeWidth = width;\n}\n\n/**\n * Set the objects for this module.\n */\nexport function setSelectHelperObjects (nv: NeonView, dh: DragHandler): void {\n  dragHandler = dh;\n  neonView = nv;\n  info = neonView.info;\n  zoomHandler = neonView.view.zoomHandler;\n}\n\nfunction escapeKeyListener (evt: KeyboardEvent): void {\n  if (evt.key === 'Escape') {\n    if (document.getElementsByClassName('selected').length > 0) {\n      info.infoListeners();\n    }\n    unselect();\n  }\n}\n\nfunction isSelByBBox (): boolean {\n  const selByBBox = document.getElementById('selByBBox');\n  if (selByBBox) {\n    return selByBBox.classList.contains('is-active');\n  }\n  return false;\n}\n\nfunction stopPropHandler (evt): void { evt.stopPropagation(); }\n\n/**\n * Apply listeners for click selection.\n * @param selector - The CSS selector used to choose where listeners are applied.\n */\nexport function clickSelect (selector: string): void {\n  document.querySelectorAll(selector).forEach(sel => {\n    sel.removeEventListener('mousedown', clickHandler);\n    sel.addEventListener('mousedown', clickHandler);\n  });\n\n  // Click away listeners\n  document.body.removeEventListener('keydown', escapeKeyListener);\n  document.body.addEventListener('keydown', escapeKeyListener);\n\n  document.getElementById('container')\n    .addEventListener('contextmenu', (evt) => { evt.preventDefault(); });\n\n  document.querySelectorAll('use,rect,#moreEdit').forEach(sel => {\n    sel.removeEventListener('click', stopPropHandler);\n    sel.addEventListener('click', stopPropHandler);\n  });\n}\n\n/**\n * Handle click events related to element selection.\n */\nfunction clickHandler (evt: MouseEvent): void {\n  if (!neonView) return;\n  const mode = neonView.getUserMode();\n\n  // If in insert mode or panning is active from shift key\n  if (mode === 'insert' || evt.shiftKey) { return; }\n  // Check if the element being clicked on is part of a drag Selection\n  if (this.tagName === 'use' && getSelectionType() !== 'selByBBox') {\n    if (this.closest('.selected') === null) {\n      let selection = [this];\n      // Check if this is part of a ligature and, if so, add all of it to the selection.\n      const firstLigatureHalf = /E9B[45678]/;\n      const secondLigatureHalf = /E9B[9ABC]/;\n      if (this.getAttribute('xlink:href').match(secondLigatureHalf)) {\n        // This is the second part of a ligature\n        const nc = this.closest('.nc');\n        const neume = this.closest('.neume');\n        const ncIndex = Array.from(neume.children).indexOf(nc);\n        const firstUse = neume.children[ncIndex - 1].children[0];\n        console.assert(firstUse.getAttribute('xlink:href').match(firstLigatureHalf), 'First glyph of ligature unexpected!');\n        if (firstUse.closest('.selected') === null) {\n          selection.unshift(firstUse);\n        }\n      } else if (this.getAttribute('xlink:href').match(firstLigatureHalf)) {\n        // This is the first part of a ligature\n        const nc = this.closest('.nc');\n        const neume = this.closest('.neume');\n        const ncIndex = Array.from(neume.children).indexOf(nc);\n        const secondUse = neume.children[ncIndex + 1].children[0];\n        console.assert(secondUse.getAttribute('xlink:href').match(secondLigatureHalf), 'Second glyph of ligature unexpected!');\n        if (secondUse.closest('.selected') === null) {\n          selection.push(secondUse);\n        }\n      }\n      if (window.navigator.userAgent.match(/Mac/) ? evt.metaKey : evt.ctrlKey) {\n        selection = selection.concat(Array.from(document.getElementsByClassName('selected')));\n      }\n      selectAll(selection, neonView, dragHandler);\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n    }\n    else {\n      let selection = [];\n      if (window.navigator.userAgent.match(/Mac/) ? evt.metaKey : evt.ctrlKey) {\n        // determine which selection mode we're in\n        const temp = document.querySelector('.sel-by.is-active').id;\n        let mode = '';\n        switch (temp) {\n          case 'selByStaff':\n            mode = '.staff';\n            break;\n          case 'selByNeume':\n            mode = '.neume';\n            break;\n          case 'selByNc':\n            mode = '.nc';\n            break;\n          default:\n            mode = '.syllable';\n            break;\n        }\n        const remove = [this.closest(mode)];\n        selection = Array.from(document.getElementsByClassName('selected'));\n        selection = selection.filter( (el) => {\n          return !remove.includes(el);\n        });\n        selectAll(selection, neonView, dragHandler);\n        if (dragHandler) {\n          dragHandler.dragInit();\n        }\n      }\n    }\n  } else if ((evt.target as HTMLElement).tagName === 'rect' && getSelectionType() === 'selByBBox') {\n    if (this.closest('.selected') === null) {\n      let selection = [evt.target] as SVGGElement[];\n      if (window.navigator.userAgent.match(/Mac/) ? evt.metaKey : evt.ctrlKey) {\n        selection = selection.concat(Array.from(document.getElementsByClassName('selected')) as SVGGElement[]);\n        selection = selection.map( (el) => {\n          if (el.tagName == 'rect') {\n            return el;\n          }\n          return el.querySelector('.sylTextRect-Display');\n        });\n      }\n      selectAll(selection, neonView, dragHandler);\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n    } else {\n      let selection = [];\n      if (window.navigator.userAgent.match(/Mac/) ? evt.metaKey : evt.ctrlKey) {\n        const remove = [this];\n        selection = Array.from(document.getElementsByClassName('selected'));\n        selection = selection.map( (el) => {\n          if (el.tagName == 'rect') {\n            return el;\n          }\n          return el.querySelector('.sylTextRect-Display');\n        });\n        selection = selection.filter( (el) => {\n          return !remove.includes(el);\n        });\n        selectAll(selection, neonView, dragHandler);\n        if (dragHandler) {\n          dragHandler.dragInit();\n        }\n      }\n    }\n  } else {\n    // Check if the point being clicked on is a staff selection (if applicable)\n    if (getSelectionType() !== 'selByStaff') {\n      info.infoListeners();\n      return;\n    }\n\n    // Check if the point is in a staff.\n    const container = document.getElementsByClassName('active-page')[0].getElementsByClassName('definition-scale')[0] as SVGSVGElement;\n    let pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGraphicsElement).getScreenCTM();\n    pt = pt.matrixTransform(transformMatrix.inverse());\n\n    const selectedStaves = Array.from(document.getElementsByClassName('staff'))\n      .filter((staff: SVGGElement) => {\n        const bbox = getStaffBBox(staff);\n        const ulx = bbox.ulx;\n        const uly = bbox.uly;\n        const lrx = bbox.lrx;\n        const lry = bbox.lry;\n        const rotate = bbox.rotate;\n\n        return (pt.x > ulx && pt.x < lrx) &&\n          (pt.y > (uly + (pt.x - ulx) * Math.tan(rotate))) &&\n          (pt.y < (lry - (lrx - pt.x) * Math.tan(rotate)));\n      });\n\n    unselect();\n    if (selectedStaves.length == 0) {\n      return;\n    }\n\n    // Select a staff\n    const staff = selectedStaves[0] as SVGGElement;\n    if (!staff.classList.contains('selected')) {\n      // Select previously unselected staff\n      selectStaff(staff, dragHandler);\n      resize(staff, neonView, dragHandler);\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n    }\n    // Trigger mousedown event on the staff\n    staff.dispatchEvent(new MouseEvent('mousedown', {\n      screenX: evt.screenX,\n      screenY: evt.screenY,\n      clientX: evt.clientX,\n      clientY: evt.clientY,\n      ctrlKey: evt.ctrlKey,\n      shiftKey: evt.shiftKey,\n      altKey: evt.altKey,\n      metaKey: evt.metaKey,\n      view: evt.view\n    }));\n  }\n}\n\n/**\n * Apply listeners for drag selection.\n * @param selector - The CSS selector used to choose where listeners are applied.\n */\nexport function dragSelect (selector: string): void {\n  let initialX = 0;\n  let initialY = 0;\n  let panning = false;\n  let dragSelecting = false;\n  // var canvas = d3.select('#svg_group');\n  d3.selectAll(selector.replace('.active-page', '').trim())\n    .on('.drag', null);\n  const canvas = d3.select(selector);\n  const dragSelectAction = d3.drag()\n    .on('start', selStart)\n    .on('drag', selecting)\n    .on('end', selEnd);\n  canvas.call(dragSelectAction);\n  if (dragHandler) {\n    dragHandler.resetTo(dragSelectAction);\n  }\n\n  function selStart (): void {\n    if (!neonView) return;\n    const userMode = neonView.getUserMode();\n    if (d3.event.sourceEvent.target.nodeName !== 'use' && userMode !== 'insert' && d3.event.sourceEvent.target.nodeName !== 'rect') {\n      if (!d3.event.sourceEvent.shiftKey) { // If not holding down shift key to pan\n        if (!document.getElementById('selByStaff').classList.contains('is-active') ||\n          pointNotInStaff(d3.mouse(this))) {\n          unselect();\n          dragSelecting = true;\n          const initialP = d3.mouse(this);\n          initialX = initialP[0];\n          initialY = initialP[1];\n          initRect(initialX, initialY);\n        }\n      } else {\n        panning = true;\n        if (zoomHandler !== undefined) {\n          zoomHandler.startDrag();\n        }\n      }\n    } else if (d3.event.sourceEvent.shiftKey) {\n      panning = true;\n      if (zoomHandler !== undefined) {\n        zoomHandler.startDrag();\n      }\n    }\n  }\n\n  /**\n   * Check if a point is in the bounds of a staff element.\n   * Rotate is not taken into account.\n   */\n  function pointNotInStaff (pt: number[]): boolean {\n    const staves = Array.from(document.getElementsByClassName('staff'));\n    const filtered = staves.filter((staff: SVGGElement) => {\n      const bbox = getStaffBBox(staff);\n      const ulx = bbox.ulx;\n      const uly = bbox.uly;\n      const lrx = bbox.lrx;\n      const lry = bbox.lry;\n      const rotate = bbox.rotate;\n\n      return (pt[0] > ulx && pt[0] < lrx) &&\n        (pt[1] > (uly + (pt[0] - ulx) * Math.tan(rotate))) &&\n        (pt[1] < (lry - (lrx - pt[0]) * Math.tan(rotate)));\n    });\n    return (filtered.length === 0);\n  }\n\n  function selecting (): void {\n    if (!panning && dragSelecting) {\n      const currentPt = d3.mouse(this);\n      const curX = currentPt[0];\n      const curY = currentPt[1];\n\n      const newX = curX < initialX ? curX : initialX;\n      const newY = curY < initialY ? curY : initialY;\n      const width = curX < initialX ? initialX - curX : curX - initialX;\n      const height = curY < initialY ? initialY - curY : curY - initialY;\n\n      updateRect(newX, newY, width, height);\n    } else if (panning) {\n      if (zoomHandler !== undefined) {\n        zoomHandler.dragging();\n      }\n    }\n  }\n\n  function selEnd (): void {\n    if (!panning && dragSelecting) {\n      const rx = parseInt(document.getElementById('selectRect').getAttribute('x'));\n      const ry = parseInt(document.getElementById('selectRect').getAttribute('y'));\n      const lx = parseInt(document.getElementById('selectRect').getAttribute('x')) +\n        parseInt(document.getElementById('selectRect').getAttribute('width'));\n      const ly = parseInt(document.getElementById('selectRect').getAttribute('y')) +\n        parseInt(document.getElementById('selectRect').getAttribute('height'));\n      // Transform to the correct coordinate system\n      const node = canvas.node() as SVGSVGElement;\n      let ul = node.createSVGPoint();\n      ul.x = rx;\n      ul.y = ry;\n      let lr = node.createSVGPoint();\n      lr.x = lx;\n      lr.y = ly;\n      const transform = node.getScreenCTM().inverse()\n        .multiply((canvas.select('.system').node() as SVGGraphicsElement)\n          .getScreenCTM()).inverse();\n      ul = ul.matrixTransform(transform);\n      lr = lr.matrixTransform(transform);\n\n      let nc;\n      if (document.getElementById('selByStaff').classList.contains('is-active')) {\n        nc = document.querySelectorAll(selector + ' use, ' + selector + ' .staff');\n      } else if (isSelByBBox()) {\n        nc = document.querySelectorAll(selector + ' .sylTextRect-display');\n      } else {\n        nc = document.querySelectorAll(selector + ' use');\n      }\n      const els = Array.from(nc);\n\n      const elements = els.filter(function (d: SVGGraphicsElement): boolean {\n        let ulx, uly, lrx, lry;\n        if (isSelByBBox()) {\n          ulx = Number(d.getAttribute('x'));\n          uly = Number(d.getAttribute('y'));\n          lrx = +ulx + +(d.getAttribute('width').slice(0, -2));\n          lry = +uly + +(d.getAttribute('height').slice(0, -2));\n          return !(((ul.x < ulx && lr.x < ulx) || (ul.x > lrx && lr.x > lrx)) || ((ul.y < uly && lr.y < uly) || (ul.y > lry && lr.y > lry)));\n        } else if (d.tagName === 'use') {\n          const box = (d.parentNode as SVGGElement).getBBox();\n          ulx = box.x;\n          uly = box.y;\n          lrx = box.x + box.width;\n          lry = box.y + box.height;\n          return !(((ul.x < ulx && lr.x < ulx) || (ul.x > lrx && lr.x > lrx)) || ((ul.y < uly && lr.y < uly) || (ul.y > lry && lr.y > lry)));\n        } else {\n          const box = getStaffBBox(d);\n          return !((ul.x < box.ulx && lr.x < box.ulx) ||\n                  (ul.x > box.lrx && lr.x > box.lrx) ||\n                  (ul.y < (box.uly + Math.abs(box.ulx - ul.x) * Math.tan(box.rotate)) &&\n                    lr.y < (box.uly + Math.abs(box.ulx - ul.x) * Math.tan(box.rotate))) ||\n                  (ul.y > (box.lry + Math.abs(box.lry - lr.y) * Math.tan(box.rotate)) &&\n                    lr.y > (box.lry + Math.abs(box.lry - lr.y) * Math.tan(box.rotate))));\n        }\n      }) as SVGGraphicsElement[];\n\n      // Get other halves of ligatures if only one is selected\n      elements.forEach((element: SVGElement) => {\n        if (element.tagName === 'use' && element.getAttribute('xlink:href').match(/E9B[456789ABC]/)) {\n          const neume = element.closest('.neume');\n          const ncIndex = Array.from(neume.children).indexOf(element.closest('.nc'));\n          if (element.getAttribute('xlink:href').match(/E9B[45678]/)) {\n            // Add second half of ligature to selected list if not already present\n            const secondNc = neume.children[ncIndex + 1];\n            const secondUse = secondNc.querySelector('use');\n            if (elements.indexOf(secondUse) < 0) {\n              elements.push(secondUse);\n            }\n          } else {\n            // Add first half of ligature to selected list if not already present\n            const firstNc = neume.children[ncIndex - 1];\n            const firstUse = firstNc.querySelector('use');\n            if (elements.indexOf(firstUse) < 0) {\n              elements.push(firstUse);\n            }\n          }\n        }\n      });\n      selectAll(elements, neonView, dragHandler);\n\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n      d3.selectAll('#selectRect').remove();\n      dragSelecting = false;\n    }\n    panning = false;\n  }\n\n  /**\n     * Create an initial dragging rectangle.\n     * @param ulx - The upper left x-position of the new rectangle.\n     * @param uly - The upper left y-position of the new rectangle.\n     */\n  function initRect (ulx: number, uly: number): void {\n    canvas.append('rect')\n      .attr('x', ulx)\n      .attr('y', uly)\n      .attr('width', 0)\n      .attr('height', 0)\n      .attr('id', 'selectRect')\n      .attr('stroke', 'black')\n      .attr('stroke-width', strokeWidth)\n      .attr('fill', 'none');\n  }\n\n  /**\n     * Update the dragging rectangle.\n     * @param newX - The new ulx.\n     * @param newY - The new uly.\n     * @param currentWidth - The width of the rectangle in pixels.\n     * @param currentHeight - The height of the rectangle in pixels.\n     */\n  function updateRect (newX: number, newY: number, currentWidth: number, currentHeight: number): void {\n    d3.select('#selectRect')\n      .attr('x', newX)\n      .attr('y', newY)\n      .attr('width', currentWidth)\n      .attr('height', currentHeight);\n  }\n}\n","import immediate from 'immediate';\nimport uuidV4 from 'uuid';\nimport Md5 from 'spark-md5';\nimport vuvuzela from 'vuvuzela';\nimport getArguments from 'argsarray';\nimport inherits from 'inherits';\nimport { EventEmitter } from 'events';\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = global.setImmediate || global.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EventEmitter);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EventEmitter.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev$$1 = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev$$1] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev$$1});\n    }\n    return rev$$1;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      immediate(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EventEmitter);\n\nfunction AbstractPouchDB() {\n  EventEmitter.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev$$1,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev$$1) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev$$1,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev$$1) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev$$1 = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev$$1);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev$$1);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev$$1) {\n      addToMissing(id, rev$$1);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev$$1) {\n      if (height[rev$$1] > maxHeight) {\n        candidates.push(rev$$1);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev$$1 = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev$$1) !== -1) {\n        revs.push(rev$$1);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      /* istanbul ignore if */\n      if (!path) {\n        err = new Error('invalid rev tree');\n        err.docId = id;\n        return cb(err);\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev$$1) {\n            return rev$$1.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev$$1) {\n          pos--;\n          return {\n            rev: pos + '-' + rev$$1.id,\n            status: rev$$1.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EventEmitter();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EventEmitter.prototype).forEach(function (key) {\n    if (typeof EventEmitter.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.2.1\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n//#7458: execute function mergeAndedSelectors on nested $and\nfunction mergeAndedSelectorsNested(obj) {\n    for (var prop in obj) {\n        if (Array.isArray(obj)) {\n            for (var i in obj) {\n                if (obj[i]['$and']) {\n                    obj[i] = mergeAndedSelectors(obj[i]['$and']);\n                }\n            }\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            mergeAndedSelectorsNested(value); // <- recursive call\n        }\n    }\n    return obj;\n}\n\n//#7458: determine id $and is present in selector (at any level)\nfunction isAndInSelector(obj, isAnd) {\n    for (var prop in obj) {\n        if (prop === '$and') {\n            isAnd = true;\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            isAnd = isAndInSelector(value, isAnd); // <- recursive call\n        }\n    }\n    return isAnd;\n}\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n    //#7458: if $and is present in selector (at any level) merge nested $and\n    if (isAndInSelector(result, false)) {\n        result = mergeAndedSelectorsNested(result);\n        if ('$and' in result) {\n            result = mergeAndedSelectors(result['$and']);\n        }\n        wasAnded = true;\n    }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  // is matcher an object, if so continue recursion\n  if (typeof matcher === 'object') {\n    return Object.keys(matcher).every(function (userOperator) {\n      var userValue = matcher[userOperator];\n      return match(userOperator, doc, userValue, parsedField, docFieldValue);\n    });\n  }\n\n  // no more depth, No need to recurse further\n  return matcher === docFieldValue;\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev$$1) {\n  if (!/^\\d+-/.test(rev$$1)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev$$1.indexOf('-');\n  var left = rev$$1.substring(0, idx);\n  var right = rev$$1.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev$$1) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev$$1;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending  no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      immediate(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev$$1 = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev$$1;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev$$1;\n      if (!opts.rev) {\n        rev$$1 = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev$$1 = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev$$1;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev$$1 = pos + '-' + revHash;\n        if (revs.indexOf(rev$$1) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return immediate(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function (e) {\n    var msg = e.target.error && e.target.error.message;\n\n    if (!msg) {\n      msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    } else if (msg.indexOf(\"stored database is a higher version\") !== -1) {\n      msg = new Error('This DB was created with the newer \"indexeddb\" adapter, but you are trying to open it with the older \"idb\" adapter');\n    }\n\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc && doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    options.credentials = 'include';\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  immediate(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).catch(function () {\n      return {};\n    }).then(function (result) {\n      // Bad response or missing `uuid` should not prevent ID generation.\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      var url = path.substring(0, 1) === '/' ?\n        genUrl(host, path.substring(1)) :\n        genDBUrl(host, path);\n      return ourFetch(url, options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if ('buffer' in response) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            var typeFieldDescriptor = Object.getOwnPropertyDescriptor(blob.__proto__, 'type');\n            if (!typeFieldDescriptor || typeFieldDescriptor.set) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev$$1 = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev$$1;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser && typeof response.buffer === 'function') {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev$$1,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev$$1;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev$$1, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev$$1;\n      rev$$1 = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev$$1) {\n      url += '?rev=' + rev$$1;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        immediate(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      immediate(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      immediate(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              immediate(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev$$1) {\n  return /^1-/.test(rev$$1);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate$$1) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate$$1 ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    immediate(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EventEmitter);\nfunction Replication() {\n  EventEmitter.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EventEmitter);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\n// Pull from src because pouchdb-node/pouchdb-browser themselves\n\nexport default PouchDB;\n","import NeonCore from './NeonCore';\n\nimport { parseManifest } from './utils/NeonManifest';\nimport { prepareEditMode } from './utils/EditControls';\nimport setBody from './utils/template/Template';\nimport * as Types from './Types';\nimport * as Interfaces from './Interfaces';\n\n\n/**\n * NeonView class. Manages the other modules of Neon and communicates with\n * NeonCore.\n */\nclass NeonView {\n  /** The manifest describing what to load and where to find it. */\n  manifest: Types.NeonManifest;\n  /** Module that displays rendered MEI. */\n  view: Interfaces.ViewInterface;\n  /** Name of the document loaded. */\n  name: string;\n  /** Module that handles managing resources, rendering SVGs. */\n  core: NeonCore;\n  /** Module that provides additional information on musical elements. */\n  info: Interfaces.InfoInterface;\n  /** Module that allows editing of musical elements. */\n  NeumeEdit: Interfaces.NeumeEditInterface;\n  /** Module that allows viewing of syllable text. */\n  textView: Interfaces.TextViewInterface;\n  /** Module that allows editing of syllable text. */\n  TextEdit: Interfaces.TextEditInterface;\n\n  params: Interfaces.NeonViewParams;\n\n\n  /**\n   * Constructor for NeonView. Sets mode and passes constructors.\n   */\n  constructor (params: Interfaces.NeonViewParams) {\n    if (!parseManifest(params.manifest)) {\n      console.error('Unable to parse the manifest');\n    }\n\n    this.params = params;\n    this.manifest = params.manifest;\n  }\n\n  /**\n   * Set up Neon for any provided editing modules.\n   */\n  setupEdit(params: Interfaces.NeonViewParams): void {\n    if (params.NeumeEdit !== undefined || (params.TextEdit !== undefined && params.TextView !== undefined)) {\n      // Set up display for edit button\n      prepareEditMode(this);\n    }\n\n    if (params.NeumeEdit !== undefined) {\n      this.NeumeEdit = new params.NeumeEdit(this);\n    }\n    if (params.TextView !== undefined) {\n      this.textView = new params.TextView(this);\n      if (params.TextEdit !== undefined) {\n        this.TextEdit = new params.TextEdit(this);\n      }\n    }\n  }\n\n  /**\n   * Start Neon\n   */\n  start (): void {\n    /* this.core.db.info().then((info) => {\n      if (info.doc_count === 0) {\n        this.core.initDb().then(() => { this.updateForCurrentPage(); });\n      } else {\n        Notification.queueNotification('Existing database found. Revert to start from the beginning.');\n        this.updateForCurrentPage();\n      }\n    }); */\n    setBody().then(() => {\n      this.view = new this.params.View(this, this.params.Display, this.manifest.image);\n      this.name = this.manifest.title;\n\n      this.core = new NeonCore(this.manifest);\n      this.info = new this.params.Info(this);\n\n      window.setTimeout(this.setupEdit.bind(this), 2000, this.params);\n      return this.core.initDb();\n    }).then(() => {\n      this.updateForCurrentPage(true);\n    });\n  }\n\n  /**\n   * Get the current page from the loaded view and then display the\n   * most up to date SVG.\n   */\n  updateForCurrentPage (delay = false): Promise<void> {\n    const pageNo = this.view.getCurrentPage();\n    return this.view.changePage(pageNo, delay);\n  }\n\n  /**\n   * Redo an action performed on the current page (if there is one).\n   */\n  redo (): Promise<boolean> {\n    return this.core.redo(this.view.getCurrentPageURI());\n  }\n\n  /**\n   * Undo the last action performed on the current page (if there is one).\n   */\n  undo (): Promise<boolean> {\n    return this.core.undo(this.view.getCurrentPageURI());\n  }\n\n  /**\n   * Get the mode Neon is in.\n   * @returns Value is \"viewer\", \"insert\", or \"edit\".\n   */\n  getUserMode (): string {\n    if (this.NeumeEdit !== undefined) {\n      return this.NeumeEdit.getUserMode();\n    } else if (this.TextEdit !== undefined) {\n      return 'edit';\n    } else {\n      return 'viewer';\n    }\n  }\n\n  /**\n   * Attempt to perform an editor action.\n   * @param action - The editor toolkit action object.\n   * @param pageURI - The URI of the page to perform the action on\n   */\n  edit (action: Types.EditorAction, pageURI: string): Promise<boolean> {\n    return this.core.edit(action, pageURI);\n  }\n\n  /**\n   * Get the attributes for a specific musical element.\n   * @param elementId - The unique ID of the musical element.\n   * @param pageURI - The URI of the page the element is found on.\n   */\n  getElementAttr (elementID: string, pageURI: string): Promise<Types.Attributes> {\n    return this.core.getElementAttr(elementID, pageURI);\n  }\n\n  /**\n   * Updates browser database and creates JSON-LD save file.\n   * @returns The contents of this file.\n   */\n  export (): Promise<string | ArrayBuffer> {\n    return (new Promise((resolve, reject): void => {\n      this.core.updateDatabase().then(() => {\n        this.manifest['mei_annotations'] = this.core.getAnnotations();\n        this.manifest.timestamp = (new Date()).toISOString();\n        const data = new window.Blob([JSON.stringify(this.manifest, null, 2)], { type: 'application/ld+json' });\n        const reader = new FileReader();\n        reader.addEventListener('load', () => {\n          resolve(reader.result);\n        });\n        reader.readAsDataURL(data);\n      }).catch(err => { reject(err); });\n    }));\n  }\n\n  /**\n   * Save the current state to the browser database.\n   */\n  save (): Promise<void> {\n    return this.core.updateDatabase();\n  }\n\n  /**\n   * Deletes the local database of the loaded MEI file(s).\n   */\n  deleteDb (): Promise<{}[]> {\n    return this.core.deleteDb();\n  }\n\n  /**\n   * Get the page's MEI file encoded as a data URI.\n   * @param pageNo - The URI specifying the page.\n   * @returns A [Data URI](https://en.wikipedia.org/wiki/Data_URI_scheme).\n   */\n  getPageURI (pageNo?: string): Promise<string> {\n    if (pageNo === undefined) {\n      pageNo = this.view.getCurrentPageURI();\n    }\n    return new Promise((resolve): void => {\n      this.core.getMEI(pageNo).then((mei) => {\n        resolve('data:application/mei+xml;charset=utf-8,' + encodeURIComponent(mei));\n      });\n    });\n  }\n\n  /**\n   * Get the page's MEI file as a string.\n   * @param pageNo - The identifying URI of the page.\n   */\n  getPageMEI (pageNo: string): Promise<string> {\n    return this.core.getMEI(pageNo);\n  }\n\n  /**\n   * Get the page's SVG.\n   * @param pageNo - The identifying URI of the page.\n   */\n  getPageSVG (pageNo: string): Promise<SVGSVGElement> {\n    return this.core.getSVG(pageNo);\n  }\n}\n\nexport { NeonView as default };\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","import * as DisplayControls from './DisplayControls';\nimport ZoomHandler from '../SingleView/Zoom';\nimport { DisplayInterface, ViewInterface } from '../Interfaces';\n\n/**\n * Return the HTML for the display panel.\n * @param {ZoomHandler} handleZoom - Includes zoom controls if defined.\n * @returns {string}\n */\nfunction displayControlsPanel (handleZoom: ZoomHandler): string {\n  let contents =\n  '<p class=\\'panel-heading\\' id=\\'displayHeader\\'>Display' +\n  '<svg class=\\'icon is-pulled-right\\'><use id=\\'toggleDisplay\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></p>' +\n  '<div id=\\'displayContents\\'>';\n  if (handleZoom !== undefined) {\n    contents +=\n    '<a class=\\'panel-block has-text-centered\\'><button class=\\'button\\' id=\\'reset-zoom\\'>Zoom</button>' +\n    '<input class=\\'slider is-fullwidth\\' id=\\'zoomSlider\\' step=\\'5\\' min=\\'25\\' max=\\'400\\' value=\\'100\\' type=\\'range\\'/>' +\n    '<output id=\\'zoomOutput\\' for=\\'zoomSlider\\'>100</output></a>';\n  }\n  contents +=\n  '<a class=\\'panel-block has-text-centered\\'><button class=\\'button\\' id=\\'reset-opacity\\'>Glyph Opacity</button>' +\n  '<input class=\\'slider is-fullwidth\\' id=\\'opacitySlider\\' step=\\'5\\' min=\\'0\\' max=\\'100\\' value=\\'100\\' type=\\'range\\'/>' +\n  '<output id=\\'opacityOutput\\' for=\\'opacitySlider\\'>100</output></a>' +\n  '<a class=\\'panel-block has-text-centered\\'><button class=\\'button\\' id=\\'reset-bg-opacity\\'>Image Opacity</button>' +\n  '<input class=\\'slider is-fullwidth\\' id=\\'bgOpacitySlider\\' step=\\'5\\' min=\\'0\\' max=\\'100\\' value=\\'100\\' type=\\'range\\'/>' +\n  '<output id=\\'bgOpacityOutput\\' for=\\'bgOpacitySlider\\'>100</output></a>' +\n  '<div class=\\'panel-block\\' id=\\'extensible-block\\'>' +\n  '<div class=\\'dropdown\\' id=\\'highlight-dropdown\\'><div class=\\'dropdown-trigger\\'>' +\n  '<button class=\\'button\\' id=\\'highlight-button\\' aria-haspopup=\\'true\\' aria-controls=\\'highlight-menu\\' style=\\'width: auto\\'>' +\n  '<span>Highlight</span><span id=\\'highlight-type\\'>&nbsp;- Off</span>' +\n  '<svg class=\\'icon\\'><use id=\\'toggleDisplay\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use>' +\n  '</svg></button></div><div class=\\'dropdown-menu\\' id=\\'highlight-menu\\' role=\\'menu\\'>' +\n  '<div class=\\'dropdown-content\\'><a class=\\'dropdown-item\\' id=\\'highlight-staff\\'>Staff</a>' +\n  '<a class=\\'dropdown-item\\' id=\\'highlight-syllable\\'>Syllable</a>' +\n  '<a class=\\'dropdown-item\\' id=\\'highlight-neume\\'>Neume</a><hr class=\\'dropdown-divider\\'/>' +\n  '<a class=\\'dropdown-item\\' id=\\'highlight-none\\'>None</a></div></div></div></div></div>';\n  return contents;\n}\n\n/**\n * A class that sets the content of the display panel to the right and\n * manages controls for viewing.\n */\nclass DisplayPanel implements DisplayInterface {\n  view: ViewInterface;\n  className: string;\n  background: string;\n  zoomHandler: ZoomHandler;\n\n  /**\n   * Constructor for DisplayPanel.\n   * @param {SingleView | DivaView} view - The View parent.\n   * @param {string} className - The class name for the rendered SVG object(s).\n   * @param {string} background - The class name associated with the background.\n   * @param {ZoomHandler} [zoomHandler] - The ZoomHandler object, if SingleView.\n   */\n  constructor (view: ViewInterface, className: string,\n    background: string, zoomHandler: ZoomHandler = undefined) {\n    this.view = view;\n    this.className = className;\n    this.background = background;\n    this.zoomHandler = zoomHandler;\n\n    const displayPanel = document.getElementById('display_controls');\n    displayPanel.innerHTML = displayControlsPanel(this.zoomHandler);\n    this.view.addUpdateCallback(this.updateVisualization.bind(this));\n  }\n\n  /**\n   * Apply event listeners related to the DisplayPanel.\n   */\n  setDisplayListeners (): void {\n    if (this.zoomHandler) {\n      // Zoom handler stuff\n      DisplayControls.setZoomControls(this.zoomHandler);\n    }\n    DisplayControls.initDisplayControls(this.className, this.background);\n  }\n\n  /**\n   * Update SVG based on visualization settings\n   */\n  updateVisualization (): void {\n    DisplayControls.setOpacityFromSlider(this.className);\n    DisplayControls.updateHighlight();\n  }\n}\n\nexport { DisplayPanel as default };\n","import NeonView from './NeonView';\nimport DisplayPanel from './DisplayPanel/DisplayPanel';\nimport { DisplayConstructable, ViewInterface } from './Interfaces';\nimport ZoomHandler from './SingleView/Zoom';\n\ndeclare let Diva: any;\n\n/**\n * View module that uses the diva.js viewer to render the pages of a IIIF manifests\n * and then display the rendered MEI files over the proper pages.\n */\nclass DivaView implements ViewInterface {\n  readonly neonView: NeonView;\n  /** Callbacks that run whenever the display updates. */\n  private updateCallbacks: Array<() => void>;\n  divaReady: boolean;\n  /** The diva.js instance. */\n  private diva: any;\n  /** Map zero-index page numbers to the actual URI/IRI identifier. */\n  private indexMap: Map<number, string>;\n  private displayPanel: DisplayPanel;\n  /** Time to wait after a page becomes active before loading it. In milliseconds. */\n  private loadDelay: number;\n  zoomHandler: ZoomHandler;\n\n  /**\n   * @param manifest - URI/IRI to the IIIF manifest.\n   */\n  constructor (neonView: NeonView, Display: DisplayConstructable, manifest: string) {\n    this.neonView = neonView;\n    this.updateCallbacks = [];\n    this.divaReady = false;\n    this.diva = new Diva('container', {\n      objectData: manifest\n    });\n    document.getElementById('container').style.minHeight = '100%';\n    this.indexMap = new Map();\n    this.diva.disableDragScrollable();\n    this.displayPanel = new Display(this, 'neon-container', 'diva-viewer-canvas');\n    this.loadDelay = 500; // in milliseconds\n    this.initDivaEvents();\n    this.setViewEventHandlers();\n\n    window.onresize = (): void => {\n      const height = window.innerHeight;\n      const width = window.innerWidth;\n\n      window.setTimeout((): void => {\n        if ((height === window.innerHeight) && (width === window.innerWidth)) {\n          this.changePage(this.getCurrentPage(), false);\n        }\n      }, this.loadDelay);\n    };\n  }\n\n  /**\n   * Set the listeners for certain events internal to diva.js\n   */\n  initDivaEvents (): void {\n    Diva.Events.subscribe('ManifestDidLoad', this.parseManifest.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ObjectDidLoad', this.didLoad.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ActivePageDidChange', this.changePage.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ZoomLevelDidChange', this.adjustZoom.bind(this), this.diva.settings.ID);\n  }\n\n  /**\n   * Called when the visible page changes in the diva.js viewer.\n   * @param pageIndex - The zero-indexed page that is most visible.\n   * @param delay - Whether to delay the loading of the page so that neon doesn't lag while scrolling.\n   */\n  async changePage (pageIndex: number, delay = true): Promise<void> {\n    function checkAndLoad (page: number): void {\n      if (page === this.getCurrentPage()) {\n        const pageURI = this.indexMap.get(page);\n        this.neonView.getPageSVG(pageURI).then((svg: SVGSVGElement) => {\n          this.updateSVG(svg, page);\n          const containerId = 'neon-container-' + page;\n          const container = document.getElementById(containerId);\n          if (container !== null) {\n            container.classList.add('active-page');\n          }\n          this.updateCallbacks.forEach((callback: Function) => callback());\n        }).catch((err: { name: string }) => {\n          if (err.name !== 'not_found' && err.name !== 'missing_mei') {\n            console.error(err);\n          }\n        });\n      }\n    }\n\n    const pageIndexes = [pageIndex];\n    Array.from(document.getElementsByClassName('active-page')).forEach(elem => {\n      elem.classList.remove('active-page');\n    });\n    for (const page of pageIndexes) {\n      if (delay) {\n        window.setTimeout(checkAndLoad.bind(this), (this.loadDelay), page);\n      } else {\n        checkAndLoad.bind(this)(page);\n      }\n    }\n  }\n\n  /**\n   * @returns Active zero-indexed page in the diva.js viewer.\n   */\n  getCurrentPage (): number {\n    return this.diva.getActivePageIndex();\n  }\n\n  /**\n   * @returns The active page URI in the diva.js viewer.\n   */\n  getCurrentPageURI (): string {\n    return this.indexMap.get(this.getCurrentPage());\n  }\n\n  /**\n   * Adjust the rendered SVG(s) to be the correct size after zooming.\n   */\n  adjustZoom (): void {\n    (new Promise((resolve): void => {\n      Array.from(document.getElementsByClassName('neon-container'))\n        .forEach((elem: HTMLElement) => { elem.style.display = 'none'; });\n      setTimeout(resolve, this.diva.settings.zoomDuration + 100);\n    })).then(() => {\n      this.changePage(this.diva.getActivePageIndex(), true);\n      Array.from(document.getElementsByClassName('neon-container'))\n        .forEach((elem: HTMLElement) => {\n          const svg = elem.firstChild as SVGSVGElement;\n          const pageNo = parseInt(elem.id.match(/\\d+/)[0]);\n          this.updateSVG(svg, pageNo);\n          elem.style.display = '';\n        });\n    });\n  }\n\n  /**\n   * Update the SVG being displayed for the specified page.\n   * @param svg - The SVG of the page to update to.\n   * @param pageNo - The zero-indexed page number.\n   */\n  updateSVG (svg: SVGSVGElement, pageNo: number): void {\n    const inner = document.getElementById('diva-1-inner');\n    const dimensions = this.diva.getPageDimensionsAtCurrentZoomLevel(pageNo);\n    const offset = this.diva.settings.viewHandler._viewerCore.getPageRegion(pageNo, {\n      includePadding: true,\n      incorporateViewport: true\n    });\n    const marginLeft = window.getComputedStyle(inner, null)\n      .getPropertyValue('margin-left');\n\n    const containerId = 'neon-container-' + pageNo.toString();\n    let container = document.getElementById(containerId);\n    if (container === null) {\n      container = document.createElement('div');\n      container.id = containerId;\n      container.classList.add('neon-container');\n      inner.appendChild(container);\n    }\n\n    while (container.firstChild) {\n      container.removeChild(container.firstChild);\n    }\n\n    svg.setAttribute('width', dimensions.width);\n    svg.setAttribute('height', dimensions.height);\n    container.style.position = 'absolute';\n    container.style.top = `${offset.top}px`;\n    container.style.left = `${offset.left - parseInt(marginLeft)}px`;\n\n    container.appendChild(svg);\n  }\n\n  /**\n   * Function called when diva.js finishes loading.\n   */\n  didLoad (): void {\n    this.divaReady = true;\n    this.displayPanel.setDisplayListeners();\n    document.getElementById('loading').style.display = 'none';\n    console.log(this.diva);\n  }\n\n  /**\n   * Add a callback function that will be run whenever an SVG is updated.\n   * @param cb - The callback function.\n   */\n  addUpdateCallback (cb: () => void): void {\n    this.updateCallbacks.push(cb);\n  }\n\n  /**\n   * Remove a callback function previously added to the list of functions to call.\n   * @param cb - The callback function.\n   */\n  removeUpdateCallback (cb: () => void): void {\n    const index = this.updateCallbacks.findIndex((elem) => {\n      return elem === cb;\n    });\n    if (index !== -1) {\n      this.updateCallbacks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Set listeners on the body element for global events.\n   */\n  setViewEventHandlers (): void {\n    document.body.addEventListener('keydown', (evt) => {\n      switch (evt.key) {\n        case 'h':\n          for (const container of document.getElementsByClassName('neon-container') as HTMLCollectionOf<HTMLElement>) {\n            container.style.visibility = 'hidden';\n          }\n          break;\n        default: break;\n      }\n    });\n\n    document.body.addEventListener('keyup', (evt) => {\n      switch (evt.key) {\n        case 'h':\n          for (const container of document.getElementsByClassName('neon-container') as HTMLCollectionOf<HTMLElement>) {\n            container.style.visibility = '';\n          }\n          break;\n        default: break;\n      }\n    });\n  }\n\n  /**\n   * Use the IIIF manifest to create a map between IIIF canvases and page indexes.\n   * @param manifest - The IIIF manifest object.\n   */\n  parseManifest (manifest: { sequences: { canvases: object[] }[] }): void {\n    this.indexMap.clear();\n    for (const sequence of manifest.sequences) {\n      for (const canvas of sequence.canvases) {\n        this.indexMap.set(sequence.canvases.indexOf(canvas), canvas['@id']);\n      }\n    }\n  }\n\n  /**\n   * @returns The name of the active page/canvas combined with the manuscript name.\n   */\n  getPageName (): string {\n    const manuscriptName = this.diva.settings.manifest.itemTitle;\n    const pageName = this.diva.settings.manifest.pages[this.getCurrentPage()].l;\n    return manuscriptName + ' \\u2014 ' + pageName;\n  }\n}\n\nexport { DivaView as default };\n","import { updateHighlight, setOpacityFromSlider } from '../DisplayPanel/DisplayControls';\nimport NeonView from '../NeonView';\nimport DisplayPanel from '../DisplayPanel/DisplayPanel';\nimport ZoomHandler from './Zoom';\nimport { ViewInterface, DisplayConstructable } from '../Interfaces';\n\nimport * as d3 from 'd3';\n\n/**\n * A view module for displaying a single page of a manuscript.\n */\nclass SingleView implements ViewInterface {\n  readonly neonView: NeonView;\n  private container: HTMLElement;\n  private updateCallbacks: Array<() => void>;\n  private group: SVGSVGElement;\n  private bg: SVGImageElement;\n  private mei: SVGSVGElement;\n  zoomHandler: ZoomHandler;\n  private displayPanel: DisplayPanel;\n  readonly pageURI: string;\n  /**\n   * Constructor for SingleView.\n   * @param image - The URI to the background image for the page.\n   */\n  constructor (neonView: NeonView, panel: DisplayConstructable, image: string) {\n    this.neonView = neonView;\n    this.container = document.getElementById('container');\n    this.updateCallbacks = new Array(0);\n    // Group will contain the image and the rendered SVG\n    this.group = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    this.group.id = 'svg_group';\n    this.group.setAttribute('height', window.innerHeight.toString());\n    this.group.setAttribute('width', '100%');\n\n    this.bg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\n    this.bg.id = 'bgimg';\n    this.bg.classList.add('background');\n    this.bg.setAttribute('x', '0');\n    this.bg.setAttribute('y', '0');\n\n    const reader = new FileReader();\n    fetch(image).then(result => {\n      if (result.ok) {\n        reader.addEventListener('load', () => {\n          this.bg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', reader.result.toString());\n          const bbox = this.bg.getBBox();\n          if (!this.group.hasAttribute('viewBox')) {\n            this.group.setAttribute('viewBox', '0 0 ' + bbox.width.toString() + ' ' + bbox.height.toString());\n          }\n        });\n        return result.blob();\n      }\n    }).then(blob => {\n      reader.readAsDataURL(blob);\n    });\n\n    this.mei = document.createElementNS('http://www.w3.org/svg', 'svg') as SVGSVGElement;\n    this.mei.id = 'mei_output';\n    this.mei.classList.add('neon-container', 'active-page');\n\n    this.group.appendChild(this.bg);\n    this.group.appendChild(this.mei);\n    this.container.appendChild(this.group);\n\n    this.zoomHandler = new ZoomHandler();\n    this.displayPanel = new panel(this, 'neon-container', 'background', this.zoomHandler);\n\n    this.setViewEventHandlers();\n    this.displayPanel.setDisplayListeners();\n\n    this.pageURI = image;\n\n    document.getElementById('loading').style.display = 'none';\n  }\n\n  /**\n   * Update the SVG being displayed.\n   * @param svg - New rendered SVG to use.\n   */\n  updateSVG (svg: SVGSVGElement): void {\n    this.group.replaceChild(svg, this.mei);\n    this.mei = svg;\n    this.mei.id = 'mei_output';\n    this.mei.classList.add('neon-container', 'active-page');\n    const height = parseInt(this.mei.getAttribute('height'));\n    const width = parseInt(this.mei.getAttribute('width'));\n\n    this.bg.setAttribute('height', height.toString());\n    this.bg.setAttribute('width', width.toString());\n    this.group.setAttribute('viewBox', '0 0 ' + width + ' ' + height);\n    updateHighlight();\n    this.resetTransformations();\n    this.updateCallbacks.forEach(callback => callback());\n  }\n\n  /**\n   * Change to a certain page\n   * Since there is only one page, this is essentially a wrapper for updateSVG\n   */\n  async changePage (_page: number, _delay: boolean): Promise<void> {\n    const svg = await this.neonView.getPageSVG(this.getCurrentPageURI());\n    this.updateSVG(svg);\n  }\n\n  /**\n   * Add a callback to the list of those be called when the page updates.\n   * @param cb - The callback function.\n   */\n  addUpdateCallback (cb: () => void): void {\n    this.updateCallbacks.push(cb);\n  }\n\n  /**\n   * Remove a callback from the list of callbacks if it is part of the list.\n   * @param cb - The callback function.\n   */\n  removeUpdateCallback (cb: () => void): void {\n    const index = this.updateCallbacks.findIndex((elem) => {\n      return elem === cb;\n    });\n    if (index !== -1) {\n      this.updateCallbacks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Reset the transformations that have been applied to the SVG upon update.\n   */\n  resetTransformations (): void {\n    this.displayPanel.zoomHandler.restoreTransformation();\n    setOpacityFromSlider();\n  }\n\n  /**\n   * @returns The zero-indexed number of the current page. This will always be zero.\n   */\n  getCurrentPage (): number {\n    return 0;\n  }\n\n  /**\n   * @returns The URI of the page.\n   */\n  getCurrentPageURI (): string {\n    return this.pageURI;\n  }\n\n  /**\n   * Set event handlers for the view and display panel.\n   */\n  setViewEventHandlers (): void {\n    document.body.addEventListener('keydown', (evt) => {\n      switch (evt.key) {\n        case 'Shift':\n          d3.select('#svg_group').on('.drag', null);\n          d3.select('#svg_group').call(\n            d3.drag().on('start', this.displayPanel.zoomHandler.startDrag.bind(this.displayPanel.zoomHandler))\n              .on('drag', this.displayPanel.zoomHandler.dragging.bind(this.displayPanel.zoomHandler))\n          );\n          break;\n        case 'h':\n          document.getElementById('mei_output').setAttribute('visibility', 'hidden');\n          break;\n        default: break;\n      }\n    });\n    document.body.addEventListener('keyup', (evt) => {\n      switch (evt.key) {\n        case 'Shift':\n          d3.select('#svg_group').on('.drag', null);\n          if (this.neonView.getUserMode() !== 'viewer') {\n            this.neonView.NeumeEdit.setSelectListeners();\n          }\n          break;\n        case 'h':\n          document.getElementById('mei_output').setAttribute('visibility', 'visible');\n          break;\n        default: break;\n      }\n    });\n\n    d3.select('#container').on('touchstart', () => {\n      if (d3.event.touches.length === 2) {\n        this.displayPanel.zoomHandler.startDrag();\n        d3.select('#container').on('touchmove', this.displayPanel.zoomHandler.dragging.bind(this.displayPanel.zoomHandler));\n        d3.select('#container').on('touchend', () => {\n          d3.select('#container').on('touchmove', null);\n        });\n      }\n    });\n    d3.select('#container').on('wheel', this.displayPanel.zoomHandler.scrollZoom.bind(this.displayPanel.zoomHandler), false);\n    // Update height of container based on window\n    window.onresize = (): void => {\n      const newHeight = window.innerHeight;\n      const container = document.getElementById('container');\n      if (newHeight > Number(container.getAttribute('height'))) {\n        container.setAttribute('height', newHeight.toString());\n      }\n    };\n  }\n\n  /**\n   * @returns A human readable name for the page. Used for downloads.\n   */\n  getPageName (): string {\n    return this.neonView.name;\n  }\n}\n\nexport { SingleView as default };\n","import { bindInsertTabs, initInsertEditControls, initEditModeControls, initSelectionButtons } from './Controls';\nimport * as Select from '../utils/Select';\nimport InsertHandler from './InsertHandler';\nimport NeonView from '../NeonView';\nimport * as SelectOptions from './SelectOptions';\nimport { setHighlightSelectionControls } from '../DisplayPanel/DisplayControls';\nimport DragHandler from '../utils/DragHandler';\nimport { NeumeEditInterface } from '../Interfaces';\n\nclass DivaEdit implements NeumeEditInterface {\n  neonView: NeonView;\n  dragHandler: DragHandler;\n  insertHandler: InsertHandler;\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    initEditModeControls(this);\n  }\n\n  initEditMode (): void {\n    this.dragHandler = new DragHandler(this.neonView, '.active-page > svg');\n    this.insertHandler = new InsertHandler(this.neonView, '.active-page > svg');\n    bindInsertTabs(this.insertHandler);\n    document.getElementById('primitiveTab').click();\n    Select.setSelectHelperObjects(this.neonView, this.dragHandler);\n    this.setSelectListeners();\n\n    SelectOptions.initNeonView(this.neonView);\n    initInsertEditControls();\n    const editMenu = document.getElementById('editMenu');\n    editMenu.style.backgroundColor = '#ffc7c7';\n    editMenu.style.fontWeight = 'bold';\n\n    Select.setSelectStrokeWidth(1);\n\n    initSelectionButtons();\n\n    setHighlightSelectionControls();\n\n    this.neonView.view.addUpdateCallback(this.setSelectListeners.bind(this));\n  }\n\n  /**\n   * Get the user mode that Neon is in. Either insert, edit, or viewer.\n   * @returns {string}\n   */\n  getUserMode (): string {\n    if (this.insertHandler !== undefined) {\n      if (this.insertHandler.isInsertMode()) {\n        return 'insert';\n      }\n      return 'edit';\n    }\n    return 'viewer';\n  }\n\n  setSelectListeners (): void {\n    Select.clickSelect('.active-page > svg > svg, .active-page > svg > svg use, .active-page > svg > svg rect');\n    Select.dragSelect('.active-page svg');\n  }\n}\n\nexport { DivaEdit as default };\n","import { bindInsertTabs, initInsertEditControls, initEditModeControls, initSelectionButtons } from './Controls';\nimport { setHighlightSelectionControls } from '../DisplayPanel/DisplayControls';\nimport * as Select from '../utils/Select';\nimport InsertHandler from './InsertHandler';\nimport NeonView from '../NeonView';\nimport * as SelectOptions from './SelectOptions';\nimport DragHandler from '../utils/DragHandler';\nimport { NeumeEditInterface } from '../Interfaces';\n\n/**\n * An Edit Module for a single page of a manuscript.\n * Works with the SingleView module.\n */\nclass SingleEditMode implements NeumeEditInterface {\n  neonView: NeonView;\n  dragHandler: DragHandler;\n  insertHandler: InsertHandler;\n  /**\n   * Constructor for an EditMode object.\n   * @param {NeonView} neonView - The NeonView parent.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    initEditModeControls(this);\n  }\n\n  /**\n   * Initialize the start of edit mode when first leaving viewer mode.\n   */\n  initEditMode (): void {\n    this.dragHandler = new DragHandler(this.neonView, '#svg_group');\n    this.insertHandler = new InsertHandler(this.neonView, '#svg_group');\n    bindInsertTabs(this.insertHandler);\n    document.getElementById('primitiveTab').click();\n    Select.setSelectHelperObjects(this.neonView, this.dragHandler);\n    this.setSelectListeners();\n\n    SelectOptions.initNeonView(this.neonView);\n    initInsertEditControls();\n    const editMenu = document.getElementById('editMenu');\n    editMenu.style.backgroundColor = '#ffc7c7';\n    editMenu.style.fontWeight = 'bold';\n\n    initSelectionButtons();\n\n    setHighlightSelectionControls();\n\n    this.neonView.view.addUpdateCallback(this.setSelectListeners.bind(this));\n  }\n\n  /**\n   * Get the user mode that Neon is in. Either insert, edit, or viewer.\n   * @returns {string}\n   */\n  getUserMode (): string {\n    if (this.insertHandler !== undefined) {\n      if (this.insertHandler.isInsertMode()) {\n        return 'insert';\n      }\n      return 'edit';\n    }\n    return 'viewer';\n  }\n\n  setSelectListeners (): void {\n    Select.clickSelect('#svg_group, #svg_group use, #svg_group rect');\n    Select.dragSelect('#svg_group');\n  }\n}\n\nexport { SingleEditMode as default };\n","/** @module InfoModule */\n\nimport NeonView from './NeonView';\nimport { InfoInterface } from './Interfaces';\nimport { Attributes } from './Types';\n\n/**\n * Map of contours to neume names.\n */\nconst neumeGroups = new Map(\n  [['', 'Punctum'], ['u', 'Pes'], ['d', 'Clivis'], ['uu', 'Scandicus'], ['ud', 'Torculus'], ['du', 'Porrectus'], ['s', 'Distropha'], ['ss', 'Tristopha'],\n    ['sd', 'Pressus'], ['dd', 'Climacus'], ['ddu', 'Climacus resupinus'], ['udu', 'Torculus resupinus'], ['dud', 'Porrectus flexus'],\n    ['udd', 'Pes subpunctis'], ['uud', 'Scandicus flexus'], ['uudd', 'Scandicus subpunctis'], ['dudd', 'Porrectus subpunctis']]\n);\n\nfunction startInfoVisibility (): void {\n  document.getElementById('neume_info').innerHTML =\n    '<article class=\\'message\\'><div class=\\'message-header\\'><p></p></div>' +\n      '<div class=\\'message-body\\'></div>';\n  document.getElementById('neume_info').setAttribute('style', 'display: none');\n}\n\n/**\n * Update the visibility of infoBox\n */\nfunction updateInfoVisibility (): void {\n  const neumeInfo = document.getElementById('neume_info');\n  if ((document.getElementById('displayInfo') as HTMLInputElement).checked) {\n    neumeInfo.setAttribute('style', '');\n  } else {\n    neumeInfo.setAttribute('style', 'display: none');\n  }\n}\n\n/**\n * Set listener on info visibility checkbox.\n */\nfunction setInfoControls (): void {\n  startInfoVisibility();\n  updateInfoVisibility();\n  document.getElementById('displayInfo').addEventListener('click', updateInfoVisibility);\n}\n\n/**\n * Class that manages getting information for elements in Neon from Verovio.\n */\nclass InfoModule implements InfoInterface {\n  private neonView: NeonView;\n\n  /**\n   * A constructor for an InfoModule.\n   * @param {NeonView} neonView - The NeonView parent.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    // Add info box enable/disable check box\n    const block = document.getElementById('extensible-block');\n    const label = document.createElement('label');\n    label.classList.add('checkbox');\n    label.textContent = 'Display Info: ';\n    const input = document.createElement('input');\n    input.classList.add('checkbox');\n    input.id = 'displayInfo';\n    input.type = 'checkbox';\n    input.checked = false;\n    label.appendChild(input);\n    block.prepend(label);\n\n    this.neonView.view.addUpdateCallback(this.resetInfoListeners.bind(this));\n    setInfoControls();\n    this.resetInfoListeners();\n  }\n\n  /**\n   * Set listeners for the InfoModule.\n   * Trigger action on mouseover of specific musical element classes.\n   */\n  infoListeners (): void {\n    try {\n      document.getElementsByClassName('active-page')[0]\n        .querySelectorAll('.neume,.custos,.clef')\n        .forEach(node => {\n          node.addEventListener('mouseover', this.updateInfo.bind(this));\n        });\n    } catch (e) {}\n  }\n\n  /**\n   * Stop listeners for the InfoModule.\n   */\n  stopListeners (): void {\n    document.querySelectorAll('.neume,.custos,.clef').forEach(node => {\n      node.removeEventListener('mouseover', this.updateInfo.bind(this));\n    });\n  }\n\n  /**\n   * Restart listeners for the InfoModule.\n   */\n  resetInfoListeners (): void {\n    this.stopListeners();\n    this.infoListeners();\n  }\n\n  /**\n   * Get updated info for the calling element based on its element type.\n   * Makes calls to NeonCore to get the information necessary.\n   */\n  async updateInfo (event: MouseEvent): Promise<void> {\n  // For now, since Clefs do not have their own element tag in mei4, there is not a way to select the <g> element\n  // So we will simply return if ID does not exist for now\n    const id = (event.currentTarget as HTMLElement).id;\n    if (id === '') {\n      Array.from(document.getElementById('neume_info').children).forEach(child => {\n        child.remove();\n      });\n      console.log('No id!');\n      return;\n    }\n\n    const element = document.getElementById(id);\n    const classRe = /neume|nc|clef|custos|staff/;\n    const elementClass = element.getAttribute('class').match(classRe)[0];\n    let body = '';\n    let attributes: Attributes;\n\n    // Gets the pitches depending on element type and\n    switch (elementClass) {\n      case 'neume':\n        // Select neume components of selected neume\n        const ncs = element.querySelectorAll('.nc') as NodeListOf<SVGGraphicsElement>;\n        let contour = await this.getContour(ncs);\n        if (contour === 'Clivis') {\n          const attr: Attributes = await this.neonView.getElementAttr(ncs[0].id, this.neonView.view.getCurrentPageURI());\n          if (attr.ligated) {\n            contour = 'Ligature';\n          }\n        }\n        let pitches = await this.getPitches(ncs);\n\n        pitches = pitches.trim().toUpperCase();\n        body = 'Shape: ' + (contour === undefined ? 'Compound' : contour) + '\\r\\n' +\n                'Pitch(es): ' + pitches;\n        break;\n      case 'custos':\n        attributes = await this.neonView.getElementAttr(id, this.neonView.view.getCurrentPageURI());\n        body += 'Pitch: ' + (attributes['pname']).toUpperCase() + attributes['oct'];\n        break;\n      case 'clef':\n        attributes = await this.neonView.getElementAttr(id, this.neonView.view.getCurrentPageURI());\n        body += 'Shape: ' + attributes['shape'] + '\\r\\n' +\n                'Line: ' + attributes['line'];\n        break;\n      default:\n        body += 'nothing';\n        break;\n    }\n    this.updateInfoModule(elementClass, body);\n  }\n\n  /**\n   * Get the individual pitches of a neume.\n   * @param ncs - Neume components in the neume.\n   * @returns Space separated pitches of the neume components in order.\n   */\n  async getPitches (ncs: Iterable<SVGGraphicsElement>): Promise<string> {\n    let pitches = '';\n    for (const nc of ncs) {\n      const attributes: Attributes = await this.neonView.getElementAttr(nc.id, this.neonView.view.getCurrentPageURI());\n      pitches += attributes['pname'] + attributes['oct'] + ' ';\n    }\n    return pitches;\n  }\n\n  /**\n   * Get the contour of a neume.\n   * @param ncs - Neume components in the neume.\n   */\n  async getContour (ncs: Iterable<SVGGraphicsElement>): Promise<string> {\n    let contour = '';\n    let previous: Attributes = null;\n    for (const nc of ncs) {\n      const attributes: Attributes = await this.neonView.getElementAttr(nc.id, this.neonView.view.getCurrentPageURI());\n      if (previous !== null) {\n        if (previous['oct'] > attributes['oct']) {\n          contour += 'd';\n        } else if (previous['oct'] < attributes['oct']) {\n          contour += 'u';\n        } else {\n          if (this.pitchNameToNum(previous['pname']) < this.pitchNameToNum(attributes['pname'])) {\n            contour += 'u';\n          } else if (this.pitchNameToNum(previous['pname']) > this.pitchNameToNum(attributes['pname'])) {\n            contour += 'd';\n          } else {\n            contour += 's';\n          }\n        }\n      }\n      previous = attributes;\n    }\n    if (neumeGroups.get(contour) === undefined) {\n      console.warn('Unknown contour: ' + contour);\n    }\n    return neumeGroups.get(contour);\n  }\n\n  /**\n   * Show and update the info box.\n   * @param title - The info box title.\n   * @param body - The info box contents.\n   */\n  updateInfoModule (title: string, body: string): void {\n    document.getElementsByClassName('message-header')[0].querySelector('p')\n      .textContent = title;\n    (document.getElementsByClassName('message-body')[0] as HTMLElement).innerText = body;\n\n    if ((document.getElementById('displayInfo') as HTMLInputElement).checked) {\n      (document.getElementsByClassName('message')[0] as HTMLElement).style.display = '';\n    }\n  }\n\n  /**\n   * Convert a pitch name (a-g) to a number (where c is 1, d is 2, ...and b is 7).\n   * @param pname - The pitch name.\n   * @returns Equivalent pitch name as a number from 1 to 7.\n   */\n  pitchNameToNum (pname: string): number {\n    switch (pname) {\n      case 'c':\n        return 1;\n      case 'd':\n        return 2;\n      case 'e':\n        return 3;\n      case 'f':\n        return 4;\n      case 'g':\n        return 5;\n      case 'a':\n        return 6;\n      case 'b':\n        return 7;\n      default:\n        console.log('Unknown pitch name');\n    }\n  }\n\n  /**\n   * Find the contour of an neume grouping based on the grouping name.\n   * @param value - The contour name.\n   * @returns Best guess name of the neume shape.\n   */\n  getContourByValue (value: string): string {\n    for (const [cont, v] of neumeGroups.entries()) {\n      if (v === value) {\n        return cont;\n      }\n    }\n  }\n}\n\nexport { InfoModule as default };\n","import * as Notification from './utils/Notification';\nimport NeonView from './NeonView';\nimport { unselect } from './utils/SelectTools';\nimport { updateHighlight } from './DisplayPanel/DisplayControls';\nimport { TextViewInterface } from './Interfaces';\n\n/*\n * Class that manages getting the text for syllables in Neon from the mei file\n */\nclass TextView implements TextViewInterface {\n  private neonView: NeonView;\n  /** Whether or not the user has been notified about blank syllables. */\n  private notificationSent: boolean;\n  /**\n   * A constructor for a TextView.\n   * @param neonView - The calling [[NeonView]] for the instance.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    this.notificationSent = false;\n\n    // add checkbox to enable/disable the view\n    const block = document.getElementById('extensible-block');\n    const textLabel = document.createElement('label');\n    const bboxLabel = document.createElement('label');\n    const textButton = document.createElement('input');\n    const bboxButton = document.createElement('input');\n    textLabel.classList.add('checkbox');\n    bboxLabel.classList.add('checkbox');\n    textLabel.textContent = 'Display Text: ';\n    bboxLabel.textContent = 'Display Text BBoxes: ';\n    textButton.classList.add('checkbox');\n    bboxButton.classList.add('checkbox');\n    textButton.id = 'displayText';\n    textButton.type = 'checkbox';\n    bboxButton.id = 'displayBBox';\n    bboxButton.type = 'checkbox';\n    textButton.checked = false;\n    bboxButton.checked = false;\n    textLabel.appendChild(textButton);\n    bboxLabel.appendChild(bboxButton);\n    block.prepend(bboxLabel);\n    block.prepend(textLabel);\n\n    this.setTextViewControls();\n    this.neonView.view.addUpdateCallback(this.updateTextViewVisibility.bind(this));\n    this.neonView.view.addUpdateCallback(this.updateBBoxViewVisibility.bind(this));\n  }\n\n  /**\n  * Set listeners on textview visibility checkbox\n  */\n  setTextViewControls (): void {\n    function textViewVis (): void { this.updateTextViewVisibility(); }\n    function bboxViewVis (): void { this.updateBBoxViewVisibility(); }\n\n    this.updateTextViewVisibility();\n    this.updateBBoxViewVisibility();\n    document.getElementById('displayText')\n      .addEventListener('click', textViewVis.bind(this));\n    document.getElementById('displayBBox')\n      .addEventListener('click', bboxViewVis.bind(this));\n  }\n\n  /**\n   * Update visibility of text bounding boxes\n   */\n  updateBBoxViewVisibility (): void {\n    if ((document.getElementById('displayBBox')as HTMLInputElement).checked) {\n      document.querySelectorAll('.sylTextRect').forEach(rect => {\n        rect.classList.add('sylTextRect-display');\n        rect.classList.remove('sylTextRect');\n      });\n      document.querySelectorAll('.syl.selected .sylTextRect-display')\n        .forEach((rect: HTMLElement) => { rect.style.fill = 'red'; });\n\n      if (this.neonView.getUserMode() !== 'viewer' && this.neonView.TextEdit !== undefined) {\n        this.neonView.TextEdit.initSelectByBBoxButton();\n      }\n    } else {\n      if ((document.getElementById('selByBBox') !== null) &&\n        document.getElementById('selByBBox').classList.contains('is-active')) {\n        unselect();\n        document.getElementById('selByBBox').classList.remove('is-active');\n        document.getElementById('selBySyl').classList.add('is-active');\n      }\n      document.querySelectorAll('.sylTextRect-display').forEach(rect => {\n        rect.classList.add('sylTextRect');\n        rect.classList.remove('sylTextRect-display');\n      });\n      document.querySelectorAll('.syl.selected .sylTextRect').forEach((rect: HTMLElement) => {\n        rect.style.fill = 'none';\n      });\n      try {\n        document.getElementById('selByBBox').style.display = 'none';\n      } catch (e) {}\n    }\n    updateHighlight();\n  }\n\n  /**\n  * Update the visibility of the textview box\n  * and add the event listeners to make sure the syl highlights when moused over\n  */\n  updateTextViewVisibility (): void {\n    if ((document.getElementById('displayText') as HTMLInputElement).checked) {\n      const sylText = document.getElementById('syl_text');\n      sylText.style.display = '';\n      sylText.innerHTML = '<p>' + this.getSylText() + '</p>';\n      const spans = sylText.querySelectorAll('p > span');\n      spans.forEach(span => {\n        const syllable = document.getElementById(span.className);\n        const syl = syllable.querySelector('.syl');\n        const text = syl.querySelector('text');\n        const rect = syl.querySelector('rect');\n        if (text.classList.length === 0) {\n          text.classList.add('text');\n        }\n\n        span.addEventListener('mouseover', () => {\n          syllable.classList.add('selected');\n          syllable.querySelectorAll('.neume').forEach(neume => {\n            neume.classList.add('selected');\n          });\n          if (rect !== null) {\n            rect.style.fill = '#d00';\n          }\n          // syl.attr('fill', '#ffc7c7');\n          // this.highlightBoundingBox(span);\n        });\n\n        span.addEventListener('mouseleave', () => {\n          syllable.classList.remove('selected');\n          syllable.querySelectorAll('.neume').forEach(neume => {\n            neume.classList.remove('selected');\n          });\n          if (rect !== null) {\n            if (syllable.style.fill !== 'rgb(0, 0, 0)') { // syllable.getAttributeNS('http://www.w3.org/2000/SVG', 'fill');\n              rect.style.fill = syllable.getAttribute('fill');\n            } else {\n              rect.style.fill = 'blue';\n            }\n          }\n          // syl.attr('fill', null);\n          // this.removeBoundingBox(span);\n        });\n      });\n      if (this.neonView.getUserMode() !== 'viewer' && this.neonView.TextEdit !== undefined) {\n        this.neonView.TextEdit.initTextEdit();\n      }\n    } else {\n      document.getElementById('syl_text').style.display = 'none';\n    }\n  }\n\n  /**\n   * Get the syllable text of the loaded file\n   */\n  getSylText (): string {\n    let lyrics = '';\n    const uniToDash = /\\ue551/g;\n    const syllables = document.querySelectorAll('.active-page .syllable');\n    syllables.forEach(syllable => {\n      if (syllable.querySelector('.syl') !== null) {\n        const syl = syllable.querySelector('.syl');\n        lyrics += '<span class=\\'' + syllable.id + '\\'>';\n        if (syl.textContent.trim() === '') {\n          lyrics += '&#x25CA; ';\n        } else {\n          Array.from(syl.children[0].children[0].children).forEach(text => {\n            lyrics += text.textContent !== '' ? text.textContent : '&#x25CA; ';\n          });\n        }\n        lyrics += ' </span>';\n      }\n    });\n    if (!this.notificationSent) {\n      Notification.queueNotification('Blank syllables are represented by &#x25CA;!');\n      this.notificationSent = true;\n    }\n    return lyrics.replace(uniToDash, '-');\n  }\n}\n\nexport { TextView as default };\n","import { unselect } from './utils/SelectTools';\nimport DragHandler from './utils/DragHandler';\nimport NeonView from './NeonView';\nimport { setSelectHelperObjects, dragSelect, clickSelect } from './utils/Select';\nimport { setGroupingHighlight } from './utils/Color';\nimport { TextEditInterface } from './Interfaces';\n\n/**\n * Format a string for prompting the user.\n * @param rawString - The unformatted string.\n */\nfunction formatRaw (rawString: string): string {\n  const removeSymbol = /\\u{25CA}/u;\n  return rawString.replace(removeSymbol, '').trim();\n}\n\nfunction selBySylListener (): void {\n  if (!document.getElementById('selByBBox').classList.contains('is-active')) {\n    unselect();\n    try {\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('extraEdit').innerHTML = '';\n      document.getElementById('extraEdit').classList.add('is-invisible');\n    } catch (e) {}\n    document.getElementById('selByBBox').classList.add('is-active');\n    try {\n      document.getElementById('selByNc').classList.remove('is-active');\n      document.getElementById('selByNeume').classList.remove('is-active');\n      document.getElementById('selByStaff').classList.remove('is-active');\n      document.getElementById('selBySyl').classList.remove('is-active');\n    } catch (e) {}\n    try {\n      if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n        setGroupingHighlight('syllable');\n      }\n    } catch (e) {}\n  }\n  this.addBBoxListeners();\n}\n\n/**\n * A Text editing module that works with the SingleView and DivaView modules\n */\nexport default class TextEditMode implements TextEditInterface {\n  private dragHandler: DragHandler;\n  private neonView: NeonView;\n\n  /**\n   * Constructor for a TextEdit\n   * @param neonView - The calling [[NeonView]] for the instance.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    this.initEditModeControls();\n  }\n\n  /**\n   * Set listener on edit mode button to start editing.\n   */\n  initEditModeControls (): void {\n    document.getElementById('edit_mode').addEventListener('click', () => {\n      this.initTextEdit();\n      if ((document.getElementById('displayBBox') as HTMLInputElement).checked) {\n        this.initSelectByBBoxButton();\n      }\n    });\n  }\n\n  /**\n  * Set text to edit mode\n  */\n  initTextEdit (): void {\n    const spans = document.getElementById('syl_text').querySelectorAll('p > span');\n    spans.forEach(span => {\n      function updateSylText (): void {\n        this.updateSylText(span);\n      }\n\n      span.removeEventListener('click', updateSylText.bind(this));\n      span.addEventListener('click', updateSylText.bind(this));\n    });\n  }\n\n  /**\n  * Add the selectByBBox button.\n  * If neume edit mode is there, add it to the bar with the other select by buttons.\n  * Otherwise add an invisible button\n  * since the only edit mode is selectByRect in that case\n  */\n  initSelectByBBoxButton (): void {\n    if (this.neonView.NeumeEdit !== undefined) {\n      const selByBBox = document.getElementById('selByBBox');\n      if (selByBBox) {\n        selByBBox.style.display = '';\n        return;\n      }\n\n      const block = document.getElementById('selBySyl')\n        .closest('.control')\n        .closest('.field');\n      const p = document.createElement('p');\n      p.classList.add('control');\n      const button = document.createElement('button');\n      button.classList.add('button', 'sel-by');\n      button.id = 'selByBBox';\n      button.textContent = 'BBox';\n      p.appendChild(button);\n      block.appendChild(p);\n      button.addEventListener('click', selBySylListener.bind(this));\n      document.body.addEventListener('keydown', (evt) => {\n        if (evt.key === '5') {\n          if (document.getElementById('selByBBox').style.display === '') {\n            selBySylListener.bind(this)();\n          }\n        }\n      });\n      this.neonView.view.addUpdateCallback(this.addBBoxListeners.bind(this));\n    } else {\n      const block = document.getElementById('undo').closest('.control');\n      const p = document.createElement('p');\n      p.classList.add('control');\n      const button = document.createElement('button');\n      button.classList.add('button', 'sel-by');\n      button.id = 'selByBBox';\n      button.textContent = 'BBox';\n      p.appendChild(button);\n      block.appendChild(p);\n      button.classList.add('is-active');\n      button.style.display = 'none';\n      this.addBBoxListeners();\n      this.neonView.view.addUpdateCallback(this.addBBoxListeners.bind(this));\n    }\n  }\n\n  /**\n   * Initialize select by bbox mode\n   */\n  addBBoxListeners (): void {\n    if (document.getElementById('selByBBox').classList.contains('is-active')) {\n      unselect();\n      if (this.neonView.NeumeEdit === undefined) {\n        // just in case\n        this.dragHandler = new DragHandler(this.neonView, '.sylTextRect-display');\n        setSelectHelperObjects(this.neonView, this.dragHandler);\n        if (this.neonView.view.constructor.name === 'SingleView') {\n          clickSelect('#mei_output, #mei_output rect');\n          dragSelect('#svg_group');\n        } else {\n          clickSelect('.active-page > svg > svg, .active-page > svg > svg rect');\n          dragSelect('.active-page svg');\n        }\n      }\n    }\n  }\n\n  /**\n  * Update the text for a single syl element\n  */\n  updateSylText (span: HTMLSpanElement): void {\n    const orig = formatRaw(span.textContent);\n    const corrected = window.prompt('', orig);\n    if (corrected !== null && corrected !== orig) {\n      const editorAction = {\n        'action': 'setText',\n        'param': {\n          'elementId': [...span.classList.entries()].filter(e => e[1] !== 'text-select')[0][1],\n          'text': corrected\n        }\n      };\n      this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then((response) => {\n        if (response) {\n          this.neonView.updateForCurrentPage();\n        }\n      });\n    }\n  }\n}\n","import { uuidv4 } from './random';\n\nexport function zip<T> (array1: Array<T>, array2: Array<T>): Array<T> {\n  const result = [];\n  for (let i = 0; i < (array1.length > array2.length ? array2.length : array1.length); i++) {\n    result.push([array1[i], array2[i]]);\n  }\n  return result;\n}\n\nfunction copyAttributes(src: Element, dst: Element): void {\n  for (const attr of src.attributes) {\n    dst.setAttribute(attr.name, attr.value);\n  }\n}\n\nexport function convertStaffToSb(staffBasedMei: string): string {\n  const parser = new DOMParser();\n  const serializer = new XMLSerializer();\n  const meiDoc = parser.parseFromString(staffBasedMei, 'text/xml');\n  const mei = meiDoc.documentElement;\n\n  const precedesSyllables: Set<Element> = new Set();\n\n  for (const section of mei.getElementsByTagName('section')) {\n    const newStaff = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'staff');\n    const newLayer = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'layer');\n    newStaff.setAttribute('n', '1');\n    newLayer.setAttribute('n', '1');\n    newStaff.appendChild(newLayer);\n\n    const staves = Array.from(section.getElementsByTagName('staff'));\n\n    for (const staff of staves) {\n      const layer = staff.getElementsByTagName('layer')[0];\n\n      const sb = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'sb');\n      sb.setAttribute('n', staff.getAttribute('n'));\n      sb.setAttribute('facs', staff.getAttribute('facs'));\n      sb.setAttribute('xml:id', staff.getAttribute('xml:id'));\n\n      // Handle custos\n      let custos: Element = undefined;\n      if ((newLayer.lastElementChild !== null) &&\n        (newLayer.lastElementChild.tagName === 'custos')) {\n        custos = newLayer.removeChild(newLayer.lastElementChild);\n      }\n\n      // Insert sb either as last child of layer or in the last syllable\n      const lastElement = newLayer.lastElementChild;\n      if ((lastElement !== null) && (lastElement.tagName === 'syllable') && lastElement.hasAttribute('precedes')) {\n        if (custos !== undefined) lastElement.appendChild(custos);\n        lastElement.appendChild(sb);\n      }\n      else {\n        if (custos !== undefined) newLayer.appendChild(custos);\n        newLayer.appendChild(sb);\n      }\n\n      // Handle split syllables\n      for (const precedes of precedesSyllables) {\n        const followsId = precedes.getAttribute('precedes');\n        const followsSyllable = Array.from(layer.getElementsByTagName('syllable'))\n          .filter(syllable => { return '#' + syllable.getAttribute('xml:id') === followsId; })\n          .pop();\n        if (followsSyllable !== undefined) {\n          // Check for preceeding clef\n          if ((followsSyllable.previousElementSibling !== null) &&\n          (followsSyllable.previousElementSibling.tagName === 'clef')) {\n            precedes.append(followsSyllable.previousElementSibling);\n          }\n          while (followsSyllable.firstChild !== null) {\n            precedes.append(followsSyllable.firstChild);\n          }\n          followsSyllable.remove();\n          precedes.removeAttribute('precedes');\n          precedesSyllables.delete(precedes);\n        }\n      }\n\n      // Add remaining elements of layer to newLayer\n      while (layer.firstElementChild !== null) {\n        if (layer.firstElementChild.hasAttribute('precedes')) {\n          precedesSyllables.add(layer.firstElementChild);\n        }\n        newLayer.appendChild(layer.firstElementChild);\n      }\n      staff.remove();\n    }\n    section.appendChild(newStaff);\n  }\n\n  return serializer.serializeToString(meiDoc);\n}\n\nexport function convertSbToStaff(sbBasedMei: string): string {\n  const parser = new DOMParser();\n  const meiDoc = parser.parseFromString(sbBasedMei, 'text/xml');\n  const mei = meiDoc.documentElement;\n\n  // Go section by section just in case\n  for (const section of mei.getElementsByTagName('section')) {\n    // In case there are multiple staves here we want to preserve those\n    // A separate array is necessary as the HTMLCollection will update!\n    const originalStaves = Array.from(section.getElementsByTagName('staff'));\n    for (const staff of originalStaves) {\n      const layer = staff.getElementsByTagName('layer')[0];\n      // First pass: get all sb elements as direct children of layer\n      for (const sb of layer.getElementsByTagName('sb')) {\n        if (sb.parentElement.tagName !== 'layer') {\n          const origSyllable: Element = sb.parentElement;\n          if (origSyllable.firstChild.isEqualNode(sb)) {\n            layer.insertBefore(sb, origSyllable);\n          }\n          else if (origSyllable.lastChild.isEqualNode(sb)) {\n            origSyllable.insertAdjacentElement('afterend', sb);\n          }\n          else {\n            // We need to split the syllable here\n            const newSyllable = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'syllable');\n            newSyllable.setAttribute('xml:id', 'm-' + uuidv4());\n            newSyllable.setAttribute('follows', '#' + origSyllable.getAttribute('xml:id'));\n            origSyllable.setAttribute('precedes', '#' + newSyllable.getAttribute('xml:id'));\n\n            const childArray = Array.from(origSyllable.children);\n            const sbIndex = childArray.indexOf(sb);\n            for (const child of origSyllable.children) {\n              const index = childArray.indexOf(child);\n              if (index > sbIndex) {\n                newSyllable.appendChild(child);\n              }\n            }\n\n            origSyllable.insertAdjacentElement('afterend', sb);\n            sb.insertAdjacentElement('afterend', newSyllable);\n\n            // Move any custos in origSyllable out of it\n            for (const custos of origSyllable.getElementsByTagName('custos')) {\n              origSyllable.insertAdjacentElement('afterend', custos);\n            }\n\n            // Move any clef in newSyllable out of it\n            for (const clef of newSyllable.getElementsByTagName('clef')) {\n              newSyllable.insertAdjacentElement('beforebegin', clef);\n            }\n          }\n        }\n      }\n\n      const sbInfo: Array<string> = [];\n      for (const sb of layer.getElementsByTagName('sb')) {\n        sbInfo.push(sb.getAttribute('xml:id'));\n      }\n\n      for (let i = 0; i < sbInfo.length; i++) {\n        const currentSb = Array.from(layer.getElementsByTagName('sb'))\n          .filter(el => { return el.getAttribute('xml:id') === sbInfo[i]; })[0];\n        const nextSb = (i === sbInfo.length - 1) ? undefined :\n          Array.from(layer.getElementsByTagName('sb')).filter(el => {\n            return el.getAttribute('xml:id') === sbInfo[i + 1];\n          })[0];\n\n        const newStaff = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'staff');\n        copyAttributes(currentSb, newStaff);\n        const newLayer = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'layer');\n        newLayer.setAttribute('n', '1');\n        newLayer.setAttribute('xml:id', 'm-' + uuidv4());\n        newStaff.appendChild(newLayer);\n\n        const childrenArray = Array.from(layer.children);\n        const copyArray = childrenArray.slice(childrenArray.indexOf(currentSb) + 1, childrenArray.indexOf(nextSb));\n\n        for (const child of copyArray) {\n          newLayer.appendChild(child);\n        }\n\n        section.insertBefore(newStaff, staff);\n      }\n      staff.remove();\n    }\n  }\n  const serializer = new XMLSerializer();\n  return serializer.serializeToString(meiDoc);\n}\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([bth[buf[i++]], bth[buf[i++]], \n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]]]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","/** @module SquareEdit/Controls */\n\nimport * as Contents from './Contents';\nimport { setGroupingHighlight } from '../utils/Color';\nimport { unselect } from '../utils/SelectTools';\nimport InsertHandler from './InsertHandler';\nimport { NeumeEditInterface } from '../Interfaces';\n\n/**\n * Set listener on EditMode button.\n */\nexport function initEditModeControls (editMode: NeumeEditInterface) {\n  document.getElementById('edit_mode').addEventListener('click', function () {\n    document.getElementById('insert_controls').innerHTML += Contents.insertControlsPanel;\n    document.getElementById('edit_controls').innerHTML += Contents.editControlsPanel;\n    editMode.initEditMode();\n  });\n}\n\n/**\n * Bind listeners to insert tabs.'\n */\nexport function bindInsertTabs (insertHandler: InsertHandler) {\n  const insertTabs: Element[] = Array.from(document.getElementsByClassName('insertTab'));\n  const tabIds: string[] = insertTabs.map((tab) => { return tab.id; });\n\n  document.body.addEventListener('keydown', (evt: KeyboardEvent) => {\n    if (evt.code.match(/^Digit\\d$/) && evt.shiftKey) {\n      try {\n        const index = Number(evt.code[evt.code.length - 1]) - 1;\n        const insertOptions = document.getElementsByClassName('insertel');\n        const selectedOption = insertOptions[index];\n        deactivate('.insertel');\n        insertHandler.insertDisabled();\n        activate(selectedOption.id, insertHandler);\n      } catch (e) {\n        console.debug(e);\n      }\n    }\n  });\n\n  tabIds.forEach((tab) => {\n    document.getElementById(tab).addEventListener('click', () => {\n      deactivate('.insertTab');\n      activate(tab, insertHandler);\n      document.getElementById('insert_data').innerHTML = Contents.insertTabHtml[tab];\n      bindElements(insertHandler);\n      deactivate('.insertel');\n      const firstOption = document.getElementsByClassName('insertel')[0];\n      activate(firstOption.id, insertHandler);\n    });\n  });\n}\n\n/**\n * Initialize Edit and Insert control panels.\n */\nexport function initInsertEditControls () {\n  const toggleInsert = document.getElementById('toggleInsert');\n  const toggleEdit = document.getElementById('toggleEdit');\n  const insertContents = document.getElementById('insertContents');\n  const editContents = document.getElementById('editContents');\n  toggleInsert.parentElement.addEventListener('click', () => {\n    if (insertContents.style.display === 'none') {\n      insertContents.style.display = '';\n      toggleInsert.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down');\n    } else {\n      insertContents.style.display = 'none';\n      toggleInsert.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-side');\n    }\n  });\n\n  toggleEdit.parentElement.addEventListener('click', () => {\n    if (editContents.style.display === 'none') {\n      editContents.style.display = '';\n      toggleEdit.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down');\n    } else {\n      editContents.style.display = 'none';\n      toggleEdit.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-side');\n    }\n  });\n}\n\n/**\n * Activate a certain insert action.\n * @param id - The ID of the insert action tab.\n */\nfunction activate (id: string, insertHandler: InsertHandler) {\n  document.getElementById(id).classList.add('is-active');\n  if (document.getElementById(id).classList.contains('insertel')) {\n    insertHandler.insertActive(id);\n  }\n}\n\n/**\n * Deactivate a certain insert action.\n * @param type - A CSS selector for the action tab.\n */\nfunction deactivate (type: string) {\n  const elList = document.querySelectorAll(type);\n  elList.forEach(el => {\n    el.classList.remove('is-active');\n  });\n}\n\n/**\n * Bind listeners to insert tab elements.\n */\nfunction bindElements (insertHandler: InsertHandler) {\n  const insertElements = Array.from(document.getElementsByClassName('insertel'));\n  const elementIds = insertElements.map(el => el.id);\n  elementIds.forEach(el => {\n    document.getElementById(el).addEventListener('click', () => {\n      deactivate('.insertel');\n      activate(el, insertHandler);\n    });\n  });\n}\n\n/**\n * Set listeners on the buttons to change selection modes.\n */\nexport function initSelectionButtons () {\n  const selBySyl = document.getElementById('selBySyl');\n  const selByNeume = document.getElementById('selByNeume');\n  const selByNc = document.getElementById('selByNc');\n  const selByStaff = document.getElementById('selByStaff');\n\n  selBySyl.addEventListener('click', selectBySylHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '1') {\n      selectBySylHandler();\n    }\n  });\n\n  selByNeume.addEventListener('click', selectByNeumeHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '2') {\n      selectByNeumeHandler();\n    }\n  });\n\n  selByNc.addEventListener('click', selectByNcHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '3') {\n      selectByNcHandler();\n    }\n  });\n\n  selByStaff.addEventListener('click', selectByStaffHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '4') {\n      selectByStaffHandler();\n    }\n  });\n\n  function selectBySylHandler () {\n    if (!selBySyl.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('extraEdit').innerHTML = '';\n      document.getElementById('extraEdit').classList.add('is-invisible');\n      selBySyl.classList.add('is-active');\n      selByNeume.classList.remove('is-active');\n      selByNc.classList.remove('is-active');\n      selByStaff.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('syllable');\n        }\n      } catch (e) {}\n    }\n  }\n\n  function selectByNeumeHandler () {\n    if (!selByNeume.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('extraEdit').innerHTML = '';\n      document.getElementById('extraEdit').classList.add('is-invisible');\n      selByNeume.classList.add('is-active');\n      selByNc.classList.remove('is-active');\n      selBySyl.classList.remove('is-active');\n      selByStaff.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('neume');\n        }\n      } catch (e) {}\n    }\n  }\n\n  function selectByNcHandler () {\n    if (!selByNc.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('extraEdit').innerHTML = '';\n      document.getElementById('extraEdit').classList.add('is-invisible');\n      selByNc.classList.add('is-active');\n      selByNeume.classList.remove('is-active');\n      selBySyl.classList.remove('is-active');\n      selByStaff.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('neume');\n        }\n      } catch (e) {}\n    }\n  }\n\n  function selectByStaffHandler () {\n    if (!selByStaff.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('extraEdit').innerHTML = '';\n      document.getElementById('extraEdit').classList.add('is-invisible');\n      selByStaff.classList.add('is-active');\n      selByNeume.classList.remove('is-active');\n      selByNc.classList.remove('is-active');\n      selBySyl.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('staff');\n        }\n      } catch (e) {}\n    }\n  }\n}\n","import * as Contents from './Contents';\nimport * as Warnings from '../Warnings';\nimport * as Notification from '../utils/Notification';\nimport NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport { unsetVirgaAction, unsetInclinatumAction, removeHandler, deleteButtonHandler } from './SelectOptions';\n\n/**\n * The NeonView parent to access editor actions.\n */\nlet neonView: NeonView;\n\n/**\n * Set the neonView member.\n */\nexport function initNeonView (view: NeonView): void {\n  neonView = view;\n}\n\n/**\n * Trigger the grouping selection menu.\n * @param type - The grouping type: nc, neume, syl, ligatureNc, or ligature\n */\nexport function triggerGrouping (type: string): void {\n  const moreEdit = document.getElementById('moreEdit');\n  moreEdit.classList.remove('is-invisible');\n  moreEdit.innerHTML += Contents.groupingMenu[type];\n  initGroupingListeners();\n}\n\n/**\n * Remove the grouping selection menu.\n */\nexport function endGroupingSelection (): void {\n  const moreEdit = document.getElementById('moreEdit');\n  moreEdit.innerHTML = '';\n  moreEdit.classList.add('is-invisible');\n  document.body.removeEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * The grouping dropdown listener.\n */\nexport function initGroupingListeners (): void {\n  const del = document.getElementById('delete');\n  del.removeEventListener('click', removeHandler);\n  del.addEventListener('click', removeHandler);\n  document.body.addEventListener('keydown', deleteButtonHandler);\n  try {\n    document.getElementById('mergeSyls').addEventListener('click', () => {\n      const elementIds = getChildrenIds().filter(e =>\n        document.getElementById(e).classList.contains('neume')\n      );\n      groupingAction('group', 'neume', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('groupNeumes').addEventListener('click', () => {\n      const elementIds = getIds();\n      groupingAction('group', 'neume', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('groupNcs').addEventListener('click', () => {\n      const elementIds = getIds();\n      groupingAction('group', 'nc', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('ungroupNeumes').addEventListener('click', () => {\n      const elementIds = getChildrenIds();\n      groupingAction('ungroup', 'neume', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('ungroupNcs').addEventListener('click', () => {\n      const elementIds = getChildrenIds();\n      groupingAction('ungroup', 'nc', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('toggle-ligature').addEventListener('click', async () => {\n      const elementIds = getIds();\n      let isLigature;\n      const ligatureRegex = /#E99[016]/;\n      if (!ligatureRegex.test(document.getElementById(elementIds[0]).children[0].getAttribute('xlink:href'))) { // SMUFL codes for ligature glyphs\n        isLigature = true;\n      } else {\n        isLigature = false;\n        const chainAction: EditorAction = { 'action': 'chain',\n          'param': [\n            unsetInclinatumAction(elementIds[0]), unsetVirgaAction(elementIds[0]),\n            unsetInclinatumAction(elementIds[1]), unsetVirgaAction(elementIds[1])\n          ] };\n        await neonView.edit(chainAction, neonView.view.getCurrentPageURI());\n      }\n\n      const editorAction: EditorAction = {\n        'action': 'toggleLigature',\n        'param': {\n          'elementIds': elementIds,\n          'isLigature': isLigature.toString()\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Ligature Toggled');\n        } else {\n          Notification.queueNotification('Ligature Toggle Failed');\n        }\n        endGroupingSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('toggle-link').addEventListener('click', () => {\n      const elementIds = getIds();\n      const chainAction: EditorAction = {\n        'action': 'chain',\n        'param': []\n      };\n      const param = new Array<EditorAction>();\n      if (document.getElementById(elementIds[0]).getAttribute('mei:precedes')) {\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[0],\n            'attrType': 'precedes',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[1],\n            'attrType': 'follows',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'setText',\n          'param': {\n            'elementId': elementIds[1],\n            'text': ''\n          }\n        });\n      } else if (document.getElementById(elementIds[0]).getAttribute('mei:follows')) {\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[0],\n            'attrType': 'follows',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[1],\n            'attrType': 'precedes',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'setText',\n          'param': {\n            'elementId': elementIds[0],\n            'text': ''\n          }\n        });\n      } else {\n        // Associate syllables. Will need to find which is first. Use staves.\n        const syllable0 = document.getElementById(elementIds[0]);\n        const syllable1 = document.getElementById(elementIds[1]);\n        const staff0 = syllable0.closest('.staff');\n        const staff1 = syllable1.closest('.staff');\n        const staffChildren = Array.from(staff0.parentElement.children).filter((elem: HTMLElement) => elem.classList.contains('staff'));\n\n        let firstSyllable, secondSyllable;\n        // Determine first syllable comes first by staff\n        if (staffChildren.indexOf(staff0) < staffChildren.indexOf(staff1)) {\n          firstSyllable = syllable0;\n          secondSyllable = syllable1;\n        } else {\n          firstSyllable = syllable1;\n          secondSyllable = syllable0;\n        }\n\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': firstSyllable.id,\n            'attrType': 'precedes',\n            'attrValue': '#' + secondSyllable.id\n          }\n        });\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': secondSyllable.id,\n            'attrType': 'follows',\n            'attrValue': '#' + firstSyllable.id\n          }\n        });\n        // Delete syl on second syllable\n        const syl = secondSyllable.querySelector('.syl');\n        if (syl !== null) {\n          param.push({\n            'action': 'remove',\n            'param': {\n              'elementId': syl.id\n            }\n          });\n        }\n      }\n      chainAction.param = param;\n      neonView.edit(chainAction, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Toggled Syllable Link');\n        } else {\n          Notification.queueNotification('Failed to Toggle Syllable Link');\n        }\n        endGroupingSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  } catch (e) {}\n}\n\n/**\n * Form and execute a group/ungroup action.\n * @param action - The action to execute. Either \"group\" or \"ungroup\".\n * @param groupType - The type of elements to group. Either \"neume\" or \"nc\".\n * @param elementIds - The IDs of the elements.\n */\nfunction groupingAction (action: string, groupType: string, elementIds: string[]): void {\n  const editorAction: EditorAction = {\n    'action': action,\n    'param': {\n      'groupType': groupType,\n      'elementIds': elementIds\n    }\n  };\n  neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then((result) => {\n    if (result) {\n      if (action === 'group') {\n        Notification.queueNotification('Grouping Success');\n      } else {\n        Notification.queueNotification('Ungrouping Success');\n      }\n    } else {\n      if (action === 'group') {\n        Notification.queueNotification('Grouping Failed');\n      } else {\n        Notification.queueNotification('Ungrouping Failed');\n      }\n    }\n    neonView.updateForCurrentPage();\n\n    // Prompt user to confirm if Neon does not re cognize contour\n    if (groupType === 'nc') {\n      const neumeParent = document.getElementById(elementIds[0]).parentElement;\n      const ncs = Array.from(neumeParent.children) as SVGGraphicsElement[];\n      const contour = neonView.info.getContour(ncs);\n      if (contour === undefined) {\n        Warnings.groupingNotRecognized();\n      }\n    }\n    endGroupingSelection();\n  });\n}\n\n/**\n * @returns The IDs of selected elements.\n */\nfunction getIds (): string[] {\n  const ids = [];\n  const elements = Array.from(document.getElementsByClassName('selected'));\n  elements.forEach(el => {\n    ids.push(el.id);\n  });\n  return ids;\n}\n\n/**\n * @returns The IDs of the selected elements' children.\n */\nfunction getChildrenIds (): string[] {\n  const childrenIds = [];\n  const elements = Array.from(document.getElementsByClassName('selected'));\n  elements.forEach(el => {\n    const children = Array.from(el.children);\n    children.forEach(ch => {\n      childrenIds.push(ch.id);\n    });\n  });\n  return childrenIds;\n}\n","import { getStaffBBox, selectBBox, selectStaff } from './SelectTools';\nimport NeonView from '../NeonView';\nimport DragHandler from './DragHandler';\n\nimport * as d3 from 'd3';\n\n/**\n * Resize a staff or a syllable text bounding box.\n * For staves, this also supports adjusting the rotate.\n */\ntype Point = { x: number; y: number; name: number };\n\n/**\n * The points you can click and drag to resize\n */\nconst PointNames = {\n  TopLeft: 0,\n  Top: 1,\n  TopRight: 2,\n  Right: 3,\n  BottomRight: 4,\n  Bottom: 5,\n  BottomLeft: 6,\n  Left: 7\n};\n\nfunction GetPoints(ulx: number, uly: number, lrx: number, lry: number, rotate: number): Point[] {\n  // Note that arc functions return an angle x in [-pi/2, pi/2].\n  let points: Array<Point>;\n  // ul is ulx, uly, lr is lrx, lry\n  if (rotate >= 0) {\n    points = [\n      { x: ulx, y: uly, name: PointNames.TopLeft },\n      { x: (ulx + lrx) / 2, y: uly + (lrx - ulx) / 2 * Math.sin(rotate), name: PointNames.Top },\n      { x: lrx, y: uly + (lrx - ulx) * Math.sin(rotate), name: PointNames.TopRight },\n      { x: lrx, y: (uly + lry + (lrx - ulx) * Math.sin(rotate)) / 2, name: PointNames.Right },\n      { x: lrx, y: lry, name: PointNames.BottomRight },\n      { x: (ulx + lrx) / 2, y: lry - (lrx - ulx) / 2 * Math.sin(rotate), name: PointNames.Bottom },\n      { x: ulx, y: lry - (lrx - ulx) * Math.sin(rotate), name: PointNames.BottomLeft },\n      { x: ulx, y: (uly + lry - (lrx - ulx) * Math.sin(rotate)) / 2, name: PointNames.Left }\n    ];\n  }\n  // Not that\n  else {\n    const a = (lrx - ulx) * Math.tan(Math.abs(rotate));\n    const b = lry - uly - a;\n    points = [\n      { x: ulx, y: uly + a, name: PointNames.TopLeft },\n      { x: (ulx + lrx) / 2, y: uly + a / 2, name: PointNames.Top },\n      { x: lrx, y: uly, name: PointNames.TopRight },\n      { x: lrx, y: uly + b / 2, name: PointNames.Right },\n      { x: lrx, y: uly + b, name: PointNames.BottomRight },\n      { x: (ulx + lrx) / 2, y: lry - a / 2, name: PointNames.Bottom },\n      { x: ulx, y: lry, name: PointNames.BottomLeft },\n      { x: ulx, y: lry - b / 2, name: PointNames.Left }\n    ];\n  }\n  return points;\n}\n\nexport function resize (element: SVGGraphicsElement, neonView: NeonView, dragHandler: DragHandler): void {\n  /**\n   * The upper-left x-coordinate of the element.\n   */\n  let ulx: number;\n  /**\n   * The upper-left y-coordinate of the element.\n   */\n  let uly: number;\n  /**\n   * The lower-right x-coordinate of the element.\n   */\n  let lrx: number;\n  /**\n   * The lower-right y-coordinate of the element.\n   */\n  let lry: number;\n\n  /**\n   * The rotate of the rect in radians.\n   */\n  let rotate: number;\n\n  let initialPoint: number[], initialUly: number, initialLry: number,\n    initialY: number, initialRectY: number, polyLen: number, dy: number, initialRotate: number;\n\n  drawInitialRect();\n  /**\n   * Draw the initial rectangle around the element\n   * and add the listeners to support dragging to resize.\n   */\n  function drawInitialRect (): void {\n    if (element === null) return;\n\n    // if it's a boundingbox just get the coordinates\n    if (element.classList.contains('syl')) {\n      const rect = element.querySelector('.sylTextRect-display');\n      if (rect === null) {\n        console.warn('Tried to draw resize rect for a sylTextRect that doesn\\'t exist (or isn\\'t displaying)');\n        return;\n      }\n      ulx = Number(rect.getAttribute('x'));\n      uly = Number(rect.getAttribute('y'));\n      lrx = +ulx + +rect.getAttribute('width');\n      lry = +uly + +rect.getAttribute('height');\n\n      rotate = 0;\n    }\n\n    // if it's a staff use the paths to get it's boundingbox\n    if (element.classList.contains('staff')) {\n      const bbox = getStaffBBox(element);\n      ulx = bbox.ulx;\n      uly = bbox.uly;\n      lrx = bbox.lrx;\n      lry = bbox.lry;\n\n      const coordinates: number[] = element.querySelector('path')\n        .getAttribute('d')\n        .match(/\\d+/g)\n        .map(element => Number(element));\n      rotate = Math.atan((coordinates[3] - coordinates[1]) /\n        (coordinates[2] - coordinates[0]));\n    }\n\n    let whichPoint: string;\n\n    const points = GetPoints(ulx, uly, lrx, lry, rotate);\n\n    polyLen = points[2].x - points[0].x;\n\n    const pointString = points.filter((_elem, index) => { return index % 2 === 0; })\n      .map(elem => elem.x + ',' + elem.y)\n      .join(' ');\n\n    d3.select('#' + element.id).append('polygon')\n      .attr('points', pointString)\n      .attr('id', 'resizeRect')\n      .attr('stroke', 'black')\n      .attr('stroke-width', 10)\n      .attr('fill', 'none')\n      .style('cursor', 'move')\n      .style('stroke-dasharray', '20 10');\n\n    for (const pointName in PointNames) {\n      const point: Point = points[PointNames[pointName]];\n      d3.select(element.viewportElement).append('circle')\n        .attr('cx', point.x)\n        .attr('cy', point.y)\n        .attr('r', 25)\n        .attr('stroke', 'black')\n        .attr('stroke-width', 4)\n        .attr('fill', '#0099ff')\n        .attr('class', 'resizePoint')\n        .attr('id', 'p-' + pointName);\n    }\n\n    // do it as a loop instead of selectAll so that you can easily know which point was\n    for (const name in PointNames) {\n      d3.select('#p-' + name).filter('.resizePoint').call(\n        d3.drag()\n          .on('start', () => { resizeStart(name); })\n          .on('drag', resizeDrag)\n          .on('end', resizeEnd.bind(this)));\n    }\n\n    if (element.classList.contains('staff')) {\n      let x = points[3].x;\n      let y = points[3].y;\n      const pointStringRight = (x + 100) + ',' + (y + 85) + ' ' +\n        (x + 70) + ',' + (y + 50) + ' ' + (x + 100) + ',' + (y + 15) + ' ' + (x + 130) + ',' + (y + 50);\n      x = points[7].x;\n      y = points[7].y;\n      const pointStringLeft = (x - 100) + ',' + (y - 15) + ' ' +\n        (x - 130) + ',' + (y - 50) + ' ' + (x - 100) + ',' + (y - 85) + ' ' + (x - 70) + ',' + (y - 50);\n\n      d3.select('#' + element.id).append('polygon')\n        .attr('points', pointStringRight)\n        .attr('id', 'rotateRight')\n        .attr('stroke', 'black')\n        .attr('stroke-width', 7)\n        .attr('fill', '#0099ff')\n        .attr('class', 'rotatePoint');\n\n      d3.select('#' + element.id).append('polygon')\n        .attr('points', pointStringLeft)\n        .attr('id', 'rotateLeft')\n        .attr('stroke', 'black')\n        .attr('stroke-width', 7)\n        .attr('fill', '#0099ff')\n        .attr('class', 'rotatePoint');\n\n      d3.select('#rotateLeft').call(\n        d3.drag()\n          .on('start', rotateStart)\n          .on('drag', rotateDragLeft)\n          .on('end', rotateEnd));\n\n      d3.select('#rotateRight').call(\n        d3.drag()\n          .on('start', rotateStart)\n          .on('drag', rotateDragRight)\n          .on('end', rotateEnd));\n    }\n\n    function rotateStart (): void {\n      const which = d3.event.sourceEvent.target.id;\n      initialY = d3.mouse(this)[1];\n      initialLry = lry;\n      initialUly = uly;\n      initialRectY = (which === 'rotateRight' ? lry : uly);\n      initialRotate = rotate;\n    }\n\n    function rotateDragLeft (): void {\n      const currentY = d3.mouse(this)[1];\n      const temp = currentY - initialY;\n      const tempRotate = initialRotate - Math.atan(temp / polyLen);\n      if (tempRotate > -0.2 && tempRotate < 0.2) {\n        dy = temp;\n        uly = initialRectY + dy;\n        rotate = tempRotate;\n        if (rotate >= 0) {\n          uly = dy + points.filter(point => point.name === PointNames.TopLeft)[0].y;\n          lry = points.filter(point => point.name === PointNames.BottomRight)[0].y;\n        } else {\n          uly = points.filter(point => point.name === PointNames.TopRight)[0].y;\n          lry = dy + points.filter(point => point.name === PointNames.BottomLeft)[0].y;\n        }\n      }\n      redraw();\n    }\n\n    function rotateDragRight (): void {\n      const currentY = d3.mouse(this)[1];\n      const temp = currentY - initialY;\n      const tempRotate = initialRotate + Math.atan(temp / polyLen);\n      if (tempRotate > -0.2 && tempRotate < 0.2) {\n        dy = temp;\n        rotate = tempRotate;\n        if (rotate >= 0 ) {\n          lry = dy + points.filter(point => point.name === PointNames.BottomRight)[0].y;\n          uly = points.filter(point => point.name === PointNames.TopLeft)[0].y;\n        } else {\n          uly = dy + points.filter(point => point.name === PointNames.TopRight)[0].y;\n          lry = points.filter(point => point.name === PointNames.BottomLeft)[0].y;\n        }\n      }\n      redraw();\n    }\n\n    function rotateEnd (): void {\n      if (dy === undefined) {\n        dy = 0;\n      }\n      const editorAction = {\n        'action': 'resizeRotate',\n        'param': {\n          'elementId': element.id,\n          'ulx': ulx,\n          'uly': uly,\n          'lrx': lrx,\n          'lry': lry,\n          'rotate': rotate * 180 / Math.PI\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then(async (result) => {\n        if (result) {\n          await neonView.updateForCurrentPage();\n        }\n        element = document.getElementById(element.id) as unknown as SVGGraphicsElement;\n        ulx = undefined;\n        uly = undefined;\n        lrx = undefined;\n        lry = undefined;\n        dy = undefined;\n        drawInitialRect();\n        if (element.classList.contains('syl')) {\n          selectBBox(element.querySelector('.sylTextRect-display'), dragHandler, this);\n        } else {\n          selectStaff(element, dragHandler);\n        }\n      });\n    }\n\n    function resizeStart (name: string): void {\n      whichPoint = name;\n      const point = points.find(point => { return point.name === PointNames[name]; });\n      initialPoint = [point.x, point.y];\n      initialUly = uly;\n      initialLry = lry;\n    }\n\n    function resizeDrag (): void {\n      const currentPoint = d3.mouse(this);\n      switch (PointNames[whichPoint]) {\n        case PointNames.TopLeft:\n          ulx = currentPoint[0];\n          uly = currentPoint[1];\n          break;\n        case PointNames.Top:\n          uly = currentPoint[1] - (lrx - ulx) * Math.tan(rotate) / 2;\n          break;\n        case PointNames.TopRight:\n          lrx = currentPoint[0];\n          uly = currentPoint[1] - (lrx - ulx) * Math.tan(rotate);\n          break;\n        case PointNames.Right:\n          lrx = currentPoint[0];\n          lry = initialLry + (currentPoint[0] - initialPoint[0]) * Math.tan(rotate);\n          break;\n        case PointNames.BottomRight:\n          lrx = currentPoint[0];\n          lry = currentPoint[1];\n          break;\n        case PointNames.Bottom:\n          lry = currentPoint[1] + (lrx - ulx) * Math.tan(rotate) / 2;\n          break;\n        case PointNames.BottomLeft:\n          ulx = currentPoint[0];\n          lry = currentPoint[1] + (lrx - ulx) * Math.tan(rotate);\n          break;\n        case PointNames.Left:\n          ulx = currentPoint[0];\n          uly = initialUly + (currentPoint[0] - initialPoint[0]) * Math.tan(rotate);\n          break;\n        default:\n          console.error('Something that wasn\\'t a side of the rectangle was dragged. This shouldn\\'t happen.');\n      }\n      redraw();\n    }\n\n    function resizeEnd (): void {\n      const editorAction = {\n        'action': 'resize',\n        'param': {\n          'elementId': element.id,\n          'ulx': ulx,\n          'uly': uly,\n          'lrx': lrx,\n          'lry': lry\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then(async (result) => {\n        if (result) {\n          await neonView.updateForCurrentPage();\n        }\n        element = document.getElementById(element.id) as unknown as SVGGraphicsElement;\n        ulx = undefined;\n        uly = undefined;\n        lrx = undefined;\n        lry = undefined;\n        d3.selectAll('.resizePoint').remove();\n        d3.selectAll('#resizeRect').remove();\n        d3.selectAll('.rotatePoint').remove();\n        drawInitialRect();\n        if (element.classList.contains('syl')) {\n          selectBBox(element.querySelector('.sylTextRect-display'), dragHandler, this);\n        } else {\n          try {\n            document.getElementById('moreEdit').innerHTML = '';\n            document.getElementById('moreEdit').classList.add('is-invisible');\n          } catch (e) {}\n        }\n      });\n    }\n  }\n\n  /**\n   * Redraw the rectangle with the new bounds\n   */\n  function redraw (): void {\n    const points: Point[] = GetPoints(ulx, uly, lrx, lry, rotate);\n\n    const pointString: string = points.filter((_elem, index) => { return index % 2 === 0; })\n      .map(elem => elem.x + ',' + elem.y)\n      .join(' ');\n\n    d3.select('#resizeRect').attr('points', pointString);\n\n    for (const pointName in PointNames) {\n      const point: Point = points[PointNames[pointName]];\n      d3.select('#p-' + pointName).filter('.resizePoint')\n        .attr('cx', point.x)\n        .attr('cy', point.y);\n    }\n\n    let x = points[3].x;\n    let y = points[3].y;\n    const pointStringRight = (x + 100) + ',' + (y + 85) + ' ' +\n      (x + 70) + ',' + (y + 50) + ' ' + (x + 100) + ',' + (y + 15) + ' ' + (x + 130) + ',' + (y + 50);\n    x = points[7].x;\n    y = points[7].y;\n    const pointStringLeft = (x - 100) + ',' + (y - 15) + ' ' +\n      (x - 130) + ',' + (y - 50) + ' ' + (x - 100) + ',' + (y - 85) + ' ' + (x - 70) + ',' + (y - 50);\n\n    d3.select('#rotateLeft').attr('points', pointStringLeft);\n    d3.select('#rotateRight').attr('points', pointStringRight);\n  }\n}\n","import NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport * as d3 from 'd3';\n\n/**\n * Class that handles insert mode, events, and actions.\n */\nclass InsertHandler {\n  type: string;\n  firstClick = true;\n  coord: DOMPoint;\n  attributes: object;\n  selector: string;\n  neonView: NeonView;\n\n  /**\n   * @param neonView - NeonView parent.\n   * @param sel - The CSS selector to apply insert listeners to.\n   */\n  constructor (neonView: NeonView, sel: string) {\n    this.neonView = neonView;\n    this.selector = sel;\n  }\n\n  /**\n   * Called when an insert button is clicked.\n   * Triggers the start of insert mode.\n   * @param buttonId - The ID of the button that was clicked.\n   */\n  insertActive (buttonId: string): void {\n    const alreadyInInsertMode = this.isInsertMode();\n    switch (buttonId) {\n      case 'punctum':\n        this.type = 'nc';\n        this.attributes = null;\n        break;\n      case 'diamond':\n        this.type = 'nc';\n        this.attributes = { 'tilt': 'se' };\n        break;\n      case 'virga':\n        this.type = 'nc';\n        this.attributes = { 'tilt': 'n' };\n        break;\n      case 'pes':\n      case 'clivis':\n      case 'scandicus':\n      case 'climacus':\n      case 'torculus':\n      case 'porrectus':\n      case 'pressus':\n        const contour = this.neonView.info.getContourByValue(\n          buttonId.charAt(0).toUpperCase() + buttonId.slice(1)\n        );\n        this.type = 'grouping';\n        this.attributes = { 'contour': contour };\n        break;\n      case 'cClef':\n      case 'fClef':\n        this.type = 'clef';\n        this.attributes = { 'shape': buttonId.charAt(0).toUpperCase() };\n        break;\n      case 'custos':\n        this.type = 'custos';\n        this.attributes = null;\n        break;\n      case 'staff':\n        this.type = 'staff';\n        this.attributes = null;\n        break;\n      default:\n        this.type = '';\n        this.attributes = null;\n        console.error('Invalid button for insertion: ' + buttonId + '.');\n        return;\n    }\n\n    this.removeInsertClickHandlers();\n    if (this.type === 'staff') {\n      document.querySelector(this.selector)\n        .addEventListener('click', this.staffHandler);\n    } else {\n      document.querySelector(this.selector)\n        .addEventListener('click', this.handler);\n    }\n\n    // Disable edit mode listeners\n    document.body.addEventListener('keydown', this.keydownListener);\n    document.body.addEventListener('keyup', this.resetInsertHandler);\n    document.body.addEventListener('click', this.clickawayHandler);\n\n    // Add 'return to edit mode' button\n    if (!alreadyInInsertMode) {\n      const editModeButton = document.createElement('button');\n      editModeButton.id = 'returnToEditMode';\n      editModeButton.classList.add('button');\n      editModeButton.innerHTML = 'Return to Edit Mode';\n      document.getElementById('redo').parentNode.appendChild(editModeButton);\n      editModeButton.addEventListener('click', this.insertDisabled);\n    }\n    const editMenu = document.getElementById('editMenu');\n    editMenu.style.backgroundColor = 'whitesmoke';\n    editMenu.style.fontWeight = '';\n    const insertMenu = document.getElementById('insertMenu');\n    insertMenu.style.backgroundColor = '#ffc7c7';\n    insertMenu.style.fontWeight = 'bold';\n  }\n\n  /**\n   * Disable insert mode and remove event listeners.\n   */\n  insertDisabled = (function insertDisabled (): void {\n    this.type = '';\n    this.removeInsertClickHandlers();\n    document.body.removeEventListener('keydown', this.keydownListener);\n    document.body.removeEventListener('keyup', this.resetInsertHandler);\n    document.body.removeEventListener('click', this.clickawayHandler);\n    const selected = document.querySelector('.insertel.is-active');\n    if (selected !== null) {\n      selected.classList.remove('is-active');\n    }\n    this.firstClick = true;\n    try {\n      document.getElementById('returnToEditMode').remove();\n    } catch (e) {\n      // console.debug(e);\n    }\n    const editMenu = document.getElementById('editMenu');\n    const insertMenu = document.getElementById('insertMenu');\n    editMenu.style.backgroundColor = '#ffc7c7';\n    editMenu.style.fontWeight = 'bold';\n    insertMenu.style.backgroundColor = 'whitesmoke';\n    insertMenu.style.fontWeight = '';\n  }).bind(this);\n\n  /**\n   * Event handler to handle a user clicking away from the active page\n   * causing insert mode to end.\n   */\n  clickawayHandler = (function clickawayHandler (evt: MouseEvent): void {\n    const target = evt.target as HTMLElement;\n    if (target.closest('.active-page') === null &&\n      target.closest('#insert_controls') === null &&\n      target.closest('#svg_group') === null) {\n      this.insertDisabled();\n      document.body.removeEventListener('keydown',\n        this.staffHandler);\n      document.body.removeEventListener('keydown',\n        this.handler);\n    }\n  }).bind(this);\n\n  /**\n   * Resets an insert event listener after temporarily removing it.\n   */\n  resetInsertHandler = (function resetInsertHandler (evt: KeyboardEvent): void {\n    if (evt.key === 'Shift') {\n      document.querySelector(this.selector)\n        .addEventListener('click', this.type === 'staff' ?\n          this.staffHandler : this.handler);\n    }\n  }).bind(this);\n\n  /**\n   * Listens to key presses to either exit edit mode (if Escape) or\n   * temporarily remove insert event listeners (if Shift).\n   */\n  keydownListener = (function keydownListener (evt: KeyboardEvent): void {\n    if (evt.key === 'Escape') {\n      this.insertDisabled();\n      document.body.removeEventListener('keydown', this.staffHandler);\n      document.body.removeEventListener('keydown', this.handler);\n    } else if (evt.key === 'Shift') {\n      this.removeInsertClickHandlers();\n    }\n  }).bind(this);\n\n  /**\n   * Event handler for clicking to insert any element except a staff.\n   */\n  handler = (function handler (evt: MouseEvent): void {\n    evt.stopPropagation();\n    const container = document.getElementsByClassName('active-page')[0].getElementsByClassName('definition-scale')[0] as SVGSVGElement;\n    const pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n    // Transform pt to SVG context\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGraphicsElement).getScreenCTM();\n    const cursorpt = pt.matrixTransform(transformMatrix.inverse());\n\n    const editorAction: EditorAction = {\n      'action': 'insert',\n      'param': {\n        'elementType': this.type,\n        'staffId': 'auto',\n        'ulx': cursorpt.x,\n        'uly': cursorpt.y\n      }\n    };\n\n    if (this.attributes !== null) {\n      editorAction['param']['attributes'] = this.attributes;\n      if (this.attributes['shape'] === 'F') {\n        editorAction['param']['ulx'] -= 50;\n      }\n    }\n\n    this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then(() => {\n      return this.neonView.updateForCurrentPage();\n    }).then(() => {\n      document.querySelector(this.selector).addEventListener('click', this.handler);\n    });\n  }).bind(this);\n\n  /**\n   * Event handler to insert a staff.\n   */\n  staffHandler = (function staffHandler (evt: MouseEvent): void {\n    const container = document.getElementsByClassName('active-page')[0].getElementsByClassName('definition-scale')[0] as SVGSVGElement;\n    const pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGraphicsElement).getScreenCTM();\n    const cursorpt = pt.matrixTransform(transformMatrix.inverse());\n\n    if (this.firstClick) {\n      this.coord = cursorpt;\n      d3.select(container).append('circle').attr('cx', cursorpt.x)\n        .attr('cy', cursorpt.y)\n        .attr('r', 10)\n        .attr('id', 'staff-circle')\n        .attr('fill', 'green');\n      this.firstClick = false;\n    } else {\n      let ul, lr;\n      if (cursorpt.x < this.coord.x || cursorpt.y < this.coord.y) { // second point is not lr\n        ul = cursorpt;\n        lr = this.coord;\n      } else {\n        ul = this.coord;\n        lr = cursorpt;\n      }\n      document.getElementById('staff-circle').remove();\n      const action: EditorAction = {\n        'action': 'insert',\n        'param': {\n          'elementType': 'staff',\n          'staffId': 'auto',\n          'ulx': ul.x,\n          'uly': ul.y,\n          'lrx': lr.x,\n          'lry': lr.y\n        }\n      };\n\n      this.neonView.edit(action, this.neonView.view.getCurrentPageURI()).then(() => {\n        this.neonView.updateForCurrentPage();\n        this.firstClick = true;\n      });\n    }\n  }).bind(this);\n\n  /**\n   * Remove the insert listeners while not leaving insert mode entirely.\n   */\n  removeInsertClickHandlers = (function removeInsertClickHandlers (): void {\n    document.querySelector(this.selector).removeEventListener('click', this.staffHandler);\n    document.querySelector(this.selector).removeEventListener('click', this.handler);\n  }).bind(this);\n\n  isInsertMode (): boolean {\n    return (this.type !== '');\n  }\n}\nexport { InsertHandler as default };\n","import NeonView from '../../src/NeonView';\nimport DisplayPanel from '../../src/DisplayPanel/DisplayPanel';\nimport DivaView from '../../src/DivaView';\nimport SingleView from '../../src/SingleView/SingleView';\nimport DivaEdit from '../../src/SquareEdit/DivaEditMode';\nimport SingleEditMode from '../../src/SquareEdit/SingleEditMode';\nimport InfoModule from '../../src/InfoModule';\nimport TextView from '../../src/TextView';\nimport TextEditMode from '../../src/TextEditMode';\n\nimport PouchDB from 'pouchdb';\n\nlet name = getGetParam('manifest');\nlet manifestLocation = 'manifests/' + name + '.jsonld';\nlet storage = getGetParam('storage');\n\nif (name) {\n  window.fetch(manifestLocation).then(response => {\n    if (response.ok) {\n      return response.text();\n    } else {\n      throw new Error(response.statusText);\n    }\n  }).then(async text => {\n    let manifest;\n    try {\n      manifest = JSON.parse(text);\n    } catch (e) {\n      console.error(e);\n      console.debug(text);\n      return;\n    }\n    let params = {\n      manifest: manifest,\n      Display: DisplayPanel,\n      Info: InfoModule,\n      TextView: TextView,\n      TextEdit: TextEditMode\n    };\n    // Determine if it is a single page or multiple by media type\n    let mediaType = await new Promise((resolve, reject) => {\n      window.fetch(manifest.image).then(response => {\n        resolve(response.headers.get('Content-Type'));\n      }).catch(err => {\n        reject(err);\n      });\n    });\n    if (mediaType.match(/image\\/*/)) {\n      params.View = SingleView;\n      params.NeumeEdit = SingleEditMode;\n    } else {\n      params.View = DivaView;\n      params.NeumeEdit = DivaEdit;\n    }\n\n    var view = new NeonView(params);\n    view.start();\n  });\n} else {\n  let db = new PouchDB('Neon-User-Storage');\n  db.getAttachment(storage, 'manifest').then(blob => {\n    return new window.Response(blob).json();\n  }).then(async manifest => {\n    console.log(manifest);\n    let params = {\n      manifest: manifest,\n      Display: DisplayPanel,\n      Info: InfoModule,\n      TextView: TextView,\n      TextEdit: TextEditMode\n    };\n\n    let mediaType = await new Promise((resolve, reject) => {\n      window.fetch(manifest.image).then(response => {\n        resolve(response.headers.get('Content-Type'));\n      }).catch(err => {\n        reject(err);\n      });\n    });\n    if (mediaType.match(/image\\/*/)) {\n      params.View = SingleView;\n      params.NeumeEdit = SingleEditMode;\n    } else {\n      params.View = DivaView;\n      params.NeumeEdit = DivaEdit;\n    }\n\n    var view = new NeonView(params);\n    view.start();\n  });\n}\n\nfunction getGetParam (paramName) {\n  let result = null;\n\n  let tmp = [];\n  window.location.search\n    .substr(1)\n    .split('&')\n    .forEach((item) => {\n      tmp = item.split('=');\n      if (tmp[0] === paramName) {\n        result = decodeURIComponent(tmp[1]);\n      }\n    });\n  return result;\n}\n","import { convertSbToStaff } from './utils/ConvertMei';\nimport * as Validation from './Validation';\nimport VerovioWrapper from './VerovioWrapper';\nimport { WebAnnotation, Attributes, EditorAction, NeonManifest, VerovioMessage } from './Types';\nimport { uuidv4 } from './utils/random';\n\nimport PouchDB from 'pouchdb';\n\n/**\n * A cache is used to keep track of what has happened\n * across multiple pages in a manuscript without having\n * to make many calls to the PouchhDb database.\n */\ninterface CacheEntry {\n  dirty: boolean;\n  mei: string;\n  svg: SVGSVGElement;\n}\n\n/**\n * The core component of Neon. This manages the database,\n * the verovio toolkit, the cache, and undo/redo stacks.\n */\nclass NeonCore {\n  /** Wrapper for the Verovio WebWorker. */\n  private verovioWrapper: VerovioWrapper;\n  /** Stacks of actions that can be undone per page. */\n  private undoStacks: Map<string, string[]>;\n  /** Stacks of actions that can be redone per page. */\n  private redoStacks: Map<string, string[]>;\n  /** Cache containing entries for each page. */\n  private neonCache: Map<string, CacheEntry>;\n  private db: PouchDB.Database;\n  private parser: DOMParser;\n  /** Pages known not to have any associated MEI. */\n  private blankPages: Array<string>;\n  /** A collection of W3 Web Annotations. */\n  private annotations: WebAnnotation[];\n  private manifest: NeonManifest;\n  private lastPageLoaded: string;\n\n  getAnnotations (): WebAnnotation[] { return this.annotations; }\n\n  /**\n   * Constructor for NeonCore\n   */\n  constructor (manifest: NeonManifest) {\n    this.verovioWrapper = new VerovioWrapper();\n    Validation.init();\n\n    /**\n     * Stacks of previous MEI files representing actions that can be undone for each page.\n     * @type {Map.<string, Array.<string>>}\n     */\n    this.undoStacks = new Map<string, string[]>();\n\n    /**\n     * Stacks of previous MEI files representing actions that can be redone for each page.\n     * @type {Map.<string, Array.<string>>}\n     */\n    this.redoStacks = new Map();\n\n    this.neonCache = new Map();\n\n    this.parser = new DOMParser();\n\n    this.db = new PouchDB('Neon');\n\n    this.blankPages = [];\n\n    // Add each MEI to the database\n    this.manifest = manifest;\n    this.annotations = manifest.mei_annotations;\n    this.lastPageLoaded = '';\n  }\n\n  /**\n   * Initialize the PouchDb database based on the provided manifest.\n   * If a newer version already exists in the database, this will\n   * not update the database unless forced.\n   * @param force - If a database update should be forced.\n   */\n  async initDb (force = false): Promise<{}> {\n    // Check for existing manifest\n    type DbAnnotation = PouchDB.Core.IdMeta & PouchDB.Core.GetMeta & WebAnnotation;\n    type Doc = PouchDB.Core.IdMeta & PouchDB.Core.GetMeta & { timestamp: string; annotations: string[]};\n    const response = await new Promise<{}>((resolve, reject): void => {\n      this.db.get(this.manifest['@id']).catch(err => {\n        if (err.name === 'not_found') {\n          // This is a new document.\n          const doc = {\n            _id: this.manifest['@id'],\n            timestamp: this.manifest.timestamp,\n            image: this.manifest.image,\n            title: this.manifest.title,\n            annotations: []\n          };\n          this.annotations.forEach(annotation => {\n            doc.annotations.push(annotation.id);\n          });\n          return doc;\n        } else {\n          console.error(err);\n          return reject(err);\n        }\n      }).then(async (doc: Doc) => {\n        // Check if doc timestamp is newer than manifest\n        const docTime = (new Date(doc.timestamp)).getTime();\n        const manTime = (new Date(this.manifest.timestamp)).getTime();\n        if (docTime > manTime) {\n          if (!force) {\n            // Fill annotations list with db annotations\n            this.annotations = [];\n            const promises = doc.annotations.map((id: string) => {\n              return new Promise((res) => {\n                this.db.get(id).then((annotation: DbAnnotation) => {\n                  this.annotations.push({\n                    id: annotation._id,\n                    type: 'Annotation',\n                    body: annotation.body,\n                    target: annotation.target\n                  });\n                  res();\n                }).catch(err => {\n                  console.error(err);\n                  res();\n                });\n              });\n            });\n            await Promise.all(promises);\n            return resolve(false);\n          }\n        }\n        for (const annotation of this.annotations) {\n          // Add annotations to database\n          await this.db.get(annotation.id).catch(err => {\n            if (err.name === 'not_found') {\n              return {\n                _id: annotation.id\n              };\n            } else {\n              console.error(err);\n              return reject(err);\n            }\n          }).then((newAnnotation: DbAnnotation) => {\n            newAnnotation.body = annotation.body;\n            newAnnotation.target = annotation.target;\n            return this.db.put(newAnnotation);\n          }).catch(err => {\n            reject(err);\n            console.error(err);\n          });\n        }\n        return this.db.put(doc);\n      }).then(() => {\n        return resolve(true);\n      }).catch(err => {\n        reject(err);\n        console.error(err);\n      });\n    });\n\n    return response;\n  }\n\n  /**\n   * Load a page into the verovio toolkit. This will fetch the\n   * page from the cache or from the database.\n   * @param pageURI - The URI of the selected page.\n   */\n  loadPage (pageURI: string): Promise<CacheEntry> {\n    return new Promise((resolve, reject): void => {\n      // Was this already the loaded page?\n      if (this.lastPageLoaded === pageURI && this.neonCache.has(pageURI)) {\n        resolve(this.neonCache.get(pageURI));\n      } else if (this.neonCache.has(pageURI)) {\n        this.loadData(pageURI, this.neonCache.get(pageURI).mei).then(() => {\n          resolve(this.neonCache.get(pageURI));\n        });\n      // Do we know this page has no MEI content?\n      } else if (this.blankPages.includes(pageURI)) {\n        Validation.blankPage();\n        const e = new Error('No MEI file for page ' + pageURI);\n        e.name = 'missing_mei';\n        reject(e);\n      } else {\n        // Find annotation\n        const annotation = this.annotations.find(elem => {\n          return elem.target === pageURI;\n        });\n        if (annotation) {\n          window.fetch(annotation.body).then(response => {\n            if (response.ok) {\n              return response.text();\n            } else {\n              throw new Error(response.statusText);\n            }\n          }).then(data => {\n            // Check if the MEI file is sb-based. If so, convert to staff-based.\n            if (data.match(/<sb .+>/)) {\n              data = convertSbToStaff(data);\n            }\n            this.loadData(pageURI, data).then(() => {\n              resolve(this.neonCache.get(pageURI));\n            });\n          }).catch(err => {\n            reject(err);\n          });\n        } else {\n          // If no annotation was found treat the page as\n          // being blank\n          Validation.blankPage();\n          this.blankPages.push(pageURI);\n        }\n      }\n    });\n  }\n\n  /**\n   * Load data into the verovio toolkit and update the cache.\n   * @param pageURI - The URI of the selected page.\n   * @param data - The MEI of the page as a string.\n   * @param dirty - If the cache entry should be marked as dirty.\n   */\n  loadData (pageURI: string, data: string, dirty = false): Promise<void> {\n    Validation.sendForValidation(data);\n    this.lastPageLoaded = pageURI;\n    /* A promise is returned that will resolve to the result of the action.\n     * However the value that is must return comes from the Web Worker and\n     * information passed between the worker and main context much be in a\n     * message. So an event handler is put on verovioWrapper for when a message\n     * is receieved from the worker. Then a message is sent to the worker to\n     * take an action. A response is sent back and the previously mentioned\n     * event handler handles the response. Since it is defined within the\n     * promise it has access to the necessary resolve function.\n     */\n    return new Promise((resolve): void => {\n      const message: VerovioMessage = {\n        id: uuidv4(),\n        action: 'renderData',\n        mei: data\n      };\n      function handle (evt: MessageEvent): void {\n        if (evt.data.id === message.id) {\n          const svg = this.parser.parseFromString(\n            evt.data.svg,\n            'image/svg+xml'\n          ).documentElement;\n          this.neonCache.set(pageURI, {\n            svg: svg,\n            mei: data,\n            dirty: dirty\n          });\n          evt.target.removeEventListener('message', handle);\n          resolve();\n        }\n      }\n      this.verovioWrapper.addEventListener('message', handle.bind(this));\n      this.verovioWrapper.postMessage(message);\n    });\n  }\n\n  /**\n   * Get the SVG for a specific page.\n   * @param pageURI - The URI of the selected page.\n   */\n  getSVG (pageURI: string): Promise<SVGSVGElement> {\n    return new Promise((resolve, reject): void => {\n      this.loadPage(pageURI).then((entry) => {\n        resolve(entry.svg);\n      }).catch((err) => { reject(err); });\n    });\n  }\n\n  /**\n   * Get the MEI for a specific page.\n   * @param pageURI - The URI of the selected page.\n   */\n  getMEI (pageURI: string): Promise<string> {\n    return new Promise((resolve, reject): void => {\n      this.loadPage(pageURI).then((entry) => {\n        resolve(entry.mei);\n      }).catch((err) => { reject(err); });\n    });\n  }\n\n  /**\n   * Get musical element attributes from the verovio toolkit.\n   * @param elementId - The unique ID of the musical element.\n   * @param pageURI - The URI of the selected page.\n   */\n  getElementAttr (elementId: string, pageURI: string): Promise<Attributes> {\n    return new Promise((resolve): void => {\n      this.loadPage(pageURI).then(() => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'getElementAttr',\n          elementId: elementId\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            evt.target.removeEventListener('message', handle);\n            resolve(evt.data.attributes);\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n    });\n  }\n\n  /**\n   * Perform an editor action on a specific page.\n   * @param action - The editor toolkit action object.\n   * @param pageURI - The URI of the selected page.\n   */\n  edit (editorAction: EditorAction, pageURI: string): Promise<boolean> {\n    let promise: Promise<CacheEntry>;\n    if (this.lastPageLoaded === pageURI) {\n      promise = Promise.resolve(this.neonCache.get(pageURI));\n    } else {\n      promise = this.loadPage(pageURI);\n    }\n    return new Promise((resolve): void => {\n      promise.then(entry => {\n        const currentMEI = entry.mei;\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'edit',\n          editorAction: editorAction\n        };\n        function handle (evt: MessageEvent): void {\n          if (evt.data.id === message.id) {\n            if (evt.data.result) {\n              if (!this.undoStacks.has(pageURI)) {\n                this.undoStacks.set(pageURI, []);\n              }\n              this.undoStacks.get(pageURI).push(currentMEI);\n              this.redoStacks.set(pageURI, []);\n            }\n            evt.target.removeEventListener('message', handle);\n            this.updateCache(pageURI, true).then(() => { resolve(evt.data.result); });\n          }\n        }\n        this.verovioWrapper.addEventListener('message', handle.bind(this));\n        this.verovioWrapper.postMessage(message);\n      });\n    });\n  }\n\n  /**\n   * Update contents of the cache using information in verovio toolkit.\n   * @param pageURI - Page to be updated in cache.\n   * @param dirty - If the entry should be marked as dirty\n   */\n  updateCache (pageURI: string, dirty: boolean): Promise<void> {\n    return new Promise((resolve): void => {\n      // Must get MEI and then get SVG then finish.\n      let mei: string, svgText: string;\n      const meiPromise = new Promise((resolve): void => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'getMEI'\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            mei = evt.data.mei;\n            evt.target.removeEventListener('message', handle);\n            resolve();\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n      const svgPromise = new Promise((resolve): void => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'renderToSVG'\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            svgText = evt.data.svg;\n            evt.target.removeEventListener('message', handle);\n            resolve();\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n\n      meiPromise.then(() => { return svgPromise; }).then(() => {\n        const svg = this.parser.parseFromString(\n          svgText,\n          'image/svg+xml'\n        ).documentElement as unknown as SVGSVGElement;\n        this.neonCache.set(pageURI, {\n          mei: mei,\n          svg: svg,\n          dirty: dirty\n        });\n        resolve();\n      });\n    });\n  }\n\n  /**\n   * Get the edit info string from the verovio toolkit.\n   * @param pageURI - The URI of the page to get the edit info string from.\n   */\n  info (pageURI: string): Promise<string> {\n    let promise: Promise<CacheEntry | void>;\n    if (this.lastPageLoaded === pageURI) {\n      promise = Promise.resolve();\n    } else {\n      promise = this.loadPage(pageURI);\n    }\n    return new Promise((resolve): void => {\n      promise.then(() => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'editInfo'\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            evt.target.removeEventListener('message', handle);\n            resolve(JSON.parse(evt.data.info));\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n    });\n  }\n\n  /**\n   * Undo the last action performed on a specific page.\n   * @param pageURI - The URI of the selected page.\n   * @returns If the action was undone.\n   */\n  undo (pageURI: string): Promise<boolean> {\n    return new Promise((resolve): void => {\n      if (this.undoStacks.has(pageURI)) {\n        const state = this.undoStacks.get(pageURI).pop();\n        if (state !== undefined) {\n          this.getMEI(pageURI).then(mei => {\n            this.redoStacks.get(pageURI).push(mei);\n            return this.loadData(pageURI, state, true);\n          }).then(() => {\n            resolve(true);\n          });\n          return;\n        }\n      }\n      resolve(false);\n    });\n  }\n\n  /**\n   * Redo the last action performed on a page.\n   * @param pageURI - The page URI.\n   * @returns If the action was redone.\n   */\n  redo (pageURI: string): Promise<boolean> {\n    return new Promise((resolve): void => {\n      if (this.redoStacks.has(pageURI)) {\n        const state = this.redoStacks.get(pageURI).pop();\n        if (state !== undefined) {\n          this.getMEI(pageURI).then((mei) => {\n            this.undoStacks.get(pageURI).push(mei);\n            return this.loadData(pageURI, state, true);\n          }).then(() => {\n            resolve(true);\n          });\n          return;\n        }\n      }\n      resolve(false);\n    });\n  }\n\n  /**\n   * Update the PouchDb database stored in the browser.\n   * This is based on the data stored in the cache. To save time,\n   * only entries marked as dirty will be updated.\n   */\n  async updateDatabase (): Promise<void> {\n    type Doc = PouchDB.Core.GetMeta & PouchDB.Core.IdMeta & { body: string; timestamp: string };\n    let updateTimestamp = false;\n    for (const pair of this.neonCache) {\n      const key = pair[0];\n      const value = pair[1];\n      if (value.dirty) {\n        updateTimestamp = true;\n        const index = this.annotations.findIndex(elem => { return elem.target === key; });\n        // try to update server with PUT request (if applicable)\n        // this is simpler than expecting a specific API on the server\n        // and using POST requests, although that would be better if there\n        // is ever a dedicated public server for Neon! At time of writing,\n        // only dev/testing server accepts PUT requests.\n        // only attempt if not a data URI\n        let uri: string;\n        if (!this.annotations[index].body.match(/^data:/)) {\n          await window.fetch(this.annotations[index].body,\n            {\n              method: 'PUT',\n              headers: { 'Content-Type': 'application/mei+xml' },\n              body: value.mei\n            }\n          ).then(response => {\n            if (response.ok) {\n              uri = this.annotations[index].body;\n            } else {\n              uri = 'data:application/mei+xml;base64,' + window.btoa(value.mei);\n            }\n          }).catch(err => {\n            console.error(err);\n            console.warn('Falling back to data URI');\n            uri = 'data:application/mei+xml;base64,' + window.btoa(value.mei);\n          });\n        } else {\n          uri = 'data:application/mei+xml;base64,' + window.btoa(value.mei);\n        }\n        // Update URI in annotations, database\n        this.annotations[index].body = uri;\n        await this.db.get(this.annotations[index].id).then((doc: Doc) => {\n          doc.body = uri;\n          return this.db.put(doc);\n        }).then(() => {\n          value.dirty = false;\n        }).catch(err => {\n          console.error(err);\n        });\n      }\n    }\n\n    if (updateTimestamp) {\n      await this.db.get(this.manifest['@id']).then((doc: Doc) => {\n        doc.timestamp = (new Date()).toISOString();\n        return this.db.put(doc);\n      }).catch(err => {\n        console.error(err);\n      });\n    }\n  }\n\n  /** Completely remove the database. */\n  async deleteDb (): Promise<{}[]> {\n    type Doc = PouchDB.Core.IdMeta & PouchDB.Core.GetMeta & { timestamp: string; annotations: string[]};\n    const annotations = await this.db.get(this.manifest['@id'])\n      .then((doc: Doc) => { return doc.annotations; } );\n    annotations.push(this.manifest['@id']);\n\n    const promises = annotations.map((id) => {\n      return new Promise(res => {\n        this.db.get(id)\n          .then(doc => { return this.db.remove(doc); })\n          .then(() => res());\n      });\n    });\n    return Promise.all(promises);\n  }\n}\n\nexport { NeonCore as default };\n","const schemaResponse = fetch(__ASSET_PREFIX__ + 'assets/mei-all.rng');\nlet worker: Worker, schema: string, statusField: HTMLSpanElement;\n\n/**\n * Update the UI with the validation results. Called when the WebWorker finishes validating.\n */\nfunction updateUI (message: { data: string[] }): void {\n  const errors = message.data;\n  if (errors === null) {\n    statusField.textContent = 'VALID';\n    statusField.style.color = 'green';\n    for (const child of statusField.children) {\n      child.remove();\n    }\n  } else {\n    let log = '';\n    errors.forEach(line => {\n      log += line + '\\n';\n    });\n    statusField.textContent = '';\n    statusField.style.color = 'red';\n    const link = document.createElement('a');\n    link.setAttribute('href', 'data:text/plain;charset=utf-8,' +\n      encodeURIComponent(log));\n    link.setAttribute('download', 'validation.log');\n    link.textContent = 'INVALID';\n    statusField.appendChild(link);\n  }\n}\n\n/**\n * Add the validation information to the display and create the WebWorker\n * for validation MEI.\n */\nexport async function init (): Promise<void> {\n  const displayContents = document.getElementById('displayContents');\n  if (displayContents !== null) {\n    const panelBlock = document.createElement('div');\n    panelBlock.classList.add('panel-block');\n    const pNotif = document.createElement('p');\n    pNotif.textContent = 'MEI Status: ';\n    const span = document.createElement('span');\n    span.id = 'validation_status';\n    span.textContent = 'unknown';\n    pNotif.appendChild(span);\n    panelBlock.appendChild(pNotif);\n    displayContents.appendChild(panelBlock);\n    statusField = document.getElementById('validation_status');\n    worker = new Worker(__ASSET_PREFIX__ + 'workers/Worker.js');\n    worker.onmessage = updateUI;\n  }\n}\n\n/**\n * Send the contents of an MEI file to the WebWorker for validation.\n * @param {string} meiData\n */\nexport async function sendForValidation (meiData: string): Promise<void> {\n  if (statusField === undefined) {\n    return;\n  }\n  if (schema === undefined) {\n    const response = await schemaResponse;\n    schema = await response.text();\n  }\n  statusField.textContent = 'checking...';\n  statusField.style.color = 'gray';\n  worker.postMessage({\n    mei: meiData,\n    schema: schema\n  });\n}\n\n/**\n * Update the message on a blank page when there is no MEI.\n */\nexport function blankPage (): void {\n  for (const child of statusField.children) {\n    child.remove();\n  }\n  statusField.textContent = 'No MEI';\n  statusField.style.color = 'color:gray';\n}\n","import { VerovioMessage } from './Types';\n\n\n/**\n * A wrapper around the verovio web worker to permit mocking in tests.\n */\nexport default class VerovioWrapper {\n  verovioWorker: Worker;\n  constructor () {\n    this.verovioWorker = new Worker(__ASSET_PREFIX__ + 'workers/VerovioWorker.js');\n  }\n\n  /**\n   * Set an event listener onto the actual web worker.\n   */\n  addEventListener (type: string, handler: EventListenerOrEventListenerObject): void {\n    return this.verovioWorker.addEventListener(type, handler);\n  }\n\n  /**\n   * Send a message to the actual web worker.\n   */\n  postMessage (message: VerovioMessage): void {\n    return this.verovioWorker.postMessage(message);\n  }\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","import { NeonManifest } from '../Types';\nconst NeonSchema = require('./manifest/NeonSchema.json');\nconst NeonContext = require('./manifest/context.json');\n\nimport { validate } from 'jsonschema';\n/**\n * Check if the provided Neon manifest is parseable.\n * @param {string} manifestString - The Neon manifest as a string.\n */\nexport function parseManifest (manifestString: NeonManifest): boolean {\n  const results = validate(manifestString, NeonSchema);\n  const instance = results.instance;\n  if (results.errors.length > 0) {\n    console.error(results.errors);\n    return false;\n  }\n  const context = instance['@context'];\n  if (context === 'https://ddmal.music.mcgill.ca/Neon/contexts/1/manifest.jsonld') {\n    return true;\n  }\n  if ((context[0] === NeonContext[0]) &&\n      (context[1]['schema'] === NeonContext[1]['schema']) &&\n      (context[1]['title'] === NeonContext[1]['title']) &&\n      (context[1]['timestamp'] === NeonContext[1]['timestamp']) &&\n      (context[1]['image']['@id'] === NeonContext[1]['image']['@id']) &&\n      (context[1]['image']['@type'] === NeonContext[1]['image']['@type']) &&\n      (context[1]['mei_annotations']['@id'] === NeonContext[1]['mei_annotations']['@id']) &&\n      (context[1]['mei_annotations']['@type'] === NeonContext[1]['mei_annotations']['@type']) &&\n      (context[1]['mei_annotations']['@container'] === NeonContext[1]['mei_annotations']['@container'])) {\n    return true;\n  } else {\n    console.error('Context mismatch');\n    console.error(context);\n    console.error(NeonContext);\n    return false;\n  }\n}\n","'use strict';\n\nvar Validator = module.exports.Validator = require('./validator');\n\nmodule.exports.ValidatorResult = require('./helpers').ValidatorResult;\nmodule.exports.ValidationError = require('./helpers').ValidationError;\nmodule.exports.SchemaError = require('./helpers').SchemaError;\nmodule.exports.SchemaScanResult = require('./scan').SchemaScanResult;\nmodule.exports.scan = require('./scan').scan;\n\nmodule.exports.validate = function (instance, schema, options) {\n  var v = new Validator();\n  return v.validate(instance, schema, options);\n};\n","'use strict';\n\nvar urilib = require('url');\n\nvar attribute = require('./attribute');\nvar helpers = require('./helpers');\nvar scanSchema = require('./scan').scan;\nvar ValidatorResult = helpers.ValidatorResult;\nvar SchemaError = helpers.SchemaError;\nvar SchemaContext = helpers.SchemaContext;\n//var anonymousBase = 'vnd.jsonschema:///';\nvar anonymousBase = '/';\n\n/**\n * Creates a new Validator object\n * @name Validator\n * @constructor\n */\nvar Validator = function Validator () {\n  // Allow a validator instance to override global custom formats or to have their\n  // own custom formats.\n  this.customFormats = Object.create(Validator.prototype.customFormats);\n  this.schemas = {};\n  this.unresolvedRefs = [];\n\n  // Use Object.create to make this extensible without Validator instances stepping on each other's toes.\n  this.types = Object.create(types);\n  this.attributes = Object.create(attribute.validators);\n};\n\n// Allow formats to be registered globally.\nValidator.prototype.customFormats = {};\n\n// Hint at the presence of a property\nValidator.prototype.schemas = null;\nValidator.prototype.types = null;\nValidator.prototype.attributes = null;\nValidator.prototype.unresolvedRefs = null;\n\n/**\n * Adds a schema with a certain urn to the Validator instance.\n * @param schema\n * @param urn\n * @return {Object}\n */\nValidator.prototype.addSchema = function addSchema (schema, base) {\n  var self = this;\n  if (!schema) {\n    return null;\n  }\n  var scan = scanSchema(base||anonymousBase, schema);\n  var ourUri = base || schema.id;\n  for(var uri in scan.id){\n    this.schemas[uri] = scan.id[uri];\n  }\n  for(var uri in scan.ref){\n    this.unresolvedRefs.push(uri);\n  }\n  this.unresolvedRefs = this.unresolvedRefs.filter(function(uri){\n    return typeof self.schemas[uri]==='undefined';\n  });\n  return this.schemas[ourUri];\n};\n\nValidator.prototype.addSubSchemaArray = function addSubSchemaArray(baseuri, schemas) {\n  if(!(schemas instanceof Array)) return;\n  for(var i=0; i<schemas.length; i++){\n    this.addSubSchema(baseuri, schemas[i]);\n  }\n};\n\nValidator.prototype.addSubSchemaObject = function addSubSchemaArray(baseuri, schemas) {\n  if(!schemas || typeof schemas!='object') return;\n  for(var p in schemas){\n    this.addSubSchema(baseuri, schemas[p]);\n  }\n};\n\n\n\n/**\n * Sets all the schemas of the Validator instance.\n * @param schemas\n */\nValidator.prototype.setSchemas = function setSchemas (schemas) {\n  this.schemas = schemas;\n};\n\n/**\n * Returns the schema of a certain urn\n * @param urn\n */\nValidator.prototype.getSchema = function getSchema (urn) {\n  return this.schemas[urn];\n};\n\n/**\n * Validates instance against the provided schema\n * @param instance\n * @param schema\n * @param [options]\n * @param [ctx]\n * @return {Array}\n */\nValidator.prototype.validate = function validate (instance, schema, options, ctx) {\n  if (!options) {\n    options = {};\n  }\n  var propertyName = options.propertyName || 'instance';\n  // This will work so long as the function at uri.resolve() will resolve a relative URI to a relative URI\n  var base = urilib.resolve(options.base||anonymousBase, schema.id||'');\n  if(!ctx){\n    ctx = new SchemaContext(schema, options, propertyName, base, Object.create(this.schemas));\n    if (!ctx.schemas[base]) {\n      ctx.schemas[base] = schema;\n    }\n    var found = scanSchema(base, schema);\n    for(var n in found.id){\n      var sch = found.id[n];\n      ctx.schemas[n] = sch;\n    }\n  }\n  if (schema) {\n    var result = this.validateSchema(instance, schema, options, ctx);\n    if (!result) {\n      throw new Error('Result undefined');\n    }\n    return result;\n  }\n  throw new SchemaError('no schema specified', schema);\n};\n\n/**\n* @param Object schema\n* @return mixed schema uri or false\n*/\nfunction shouldResolve(schema) {\n  var ref = (typeof schema === 'string') ? schema : schema.$ref;\n  if (typeof ref=='string') return ref;\n  return false;\n}\n\n/**\n * Validates an instance against the schema (the actual work horse)\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @private\n * @return {ValidatorResult}\n */\nValidator.prototype.validateSchema = function validateSchema (instance, schema, options, ctx) {\n  var result = new ValidatorResult(instance, schema, options, ctx);\n\n    // Support for the true/false schemas\n  if(typeof schema==='boolean') {\n    if(schema===true){\n      // `true` is always valid\n      schema = {};\n    }else if(schema===false){\n      // `false` is always invalid\n      schema = {type: []};\n    }\n  }else if(!schema){\n    // This might be a string\n    throw new Error(\"schema is undefined\");\n  }\n\n  if (schema['extends']) {\n    if (schema['extends'] instanceof Array) {\n      var schemaobj = {schema: schema, ctx: ctx};\n      schema['extends'].forEach(this.schemaTraverser.bind(this, schemaobj));\n      schema = schemaobj.schema;\n      schemaobj.schema = null;\n      schemaobj.ctx = null;\n      schemaobj = null;\n    } else {\n      schema = helpers.deepMerge(schema, this.superResolve(schema['extends'], ctx));\n    }\n  }\n\n  // If passed a string argument, load that schema URI\n  var switchSchema;\n  if (switchSchema = shouldResolve(schema)) {\n    var resolved = this.resolve(schema, switchSchema, ctx);\n    var subctx = new SchemaContext(resolved.subschema, options, ctx.propertyPath, resolved.switchSchema, ctx.schemas);\n    return this.validateSchema(instance, resolved.subschema, options, subctx);\n  }\n\n  var skipAttributes = options && options.skipAttributes || [];\n  // Validate each schema attribute against the instance\n  for (var key in schema) {\n    if (!attribute.ignoreProperties[key] && skipAttributes.indexOf(key) < 0) {\n      var validatorErr = null;\n      var validator = this.attributes[key];\n      if (validator) {\n        validatorErr = validator.call(this, instance, schema, options, ctx);\n      } else if (options.allowUnknownAttributes === false) {\n        // This represents an error with the schema itself, not an invalid instance\n        throw new SchemaError(\"Unsupported attribute: \" + key, schema);\n      }\n      if (validatorErr) {\n        result.importErrors(validatorErr);\n      }\n    }\n  }\n\n  if (typeof options.rewrite == 'function') {\n    var value = options.rewrite.call(this, instance, schema, options, ctx);\n    result.instance = value;\n  }\n  return result;\n};\n\n/**\n* @private\n* @param Object schema\n* @param SchemaContext ctx\n* @returns Object schema or resolved schema\n*/\nValidator.prototype.schemaTraverser = function schemaTraverser (schemaobj, s) {\n  schemaobj.schema = helpers.deepMerge(schemaobj.schema, this.superResolve(s, schemaobj.ctx));\n}\n\n/**\n* @private\n* @param Object schema\n* @param SchemaContext ctx\n* @returns Object schema or resolved schema\n*/\nValidator.prototype.superResolve = function superResolve (schema, ctx) {\n  var ref;\n  if(ref = shouldResolve(schema)) {\n    return this.resolve(schema, ref, ctx).subschema;\n  }\n  return schema;\n}\n\n/**\n* @private\n* @param Object schema\n* @param Object switchSchema\n* @param SchemaContext ctx\n* @return Object resolved schemas {subschema:String, switchSchema: String}\n* @throws SchemaError\n*/\nValidator.prototype.resolve = function resolve (schema, switchSchema, ctx) {\n  switchSchema = ctx.resolve(switchSchema);\n  // First see if the schema exists under the provided URI\n  if (ctx.schemas[switchSchema]) {\n    return {subschema: ctx.schemas[switchSchema], switchSchema: switchSchema};\n  }\n  // Else try walking the property pointer\n  var parsed = urilib.parse(switchSchema);\n  var fragment = parsed && parsed.hash;\n  var document = fragment && fragment.length && switchSchema.substr(0, switchSchema.length - fragment.length);\n  if (!document || !ctx.schemas[document]) {\n    throw new SchemaError(\"no such schema <\" + switchSchema + \">\", schema);\n  }\n  var subschema = helpers.objectGetPath(ctx.schemas[document], fragment.substr(1));\n  if(subschema===undefined){\n    throw new SchemaError(\"no such schema \" + fragment + \" located in <\" + document + \">\", schema);\n  }\n  return {subschema: subschema, switchSchema: switchSchema};\n};\n\n/**\n * Tests whether the instance if of a certain type.\n * @private\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @param type\n * @return {boolean}\n */\nValidator.prototype.testType = function validateType (instance, schema, options, ctx, type) {\n  if (typeof this.types[type] == 'function') {\n    return this.types[type].call(this, instance);\n  }\n  if (type && typeof type == 'object') {\n    var res = this.validateSchema(instance, type, options, ctx);\n    return res === undefined || !(res && res.errors.length);\n  }\n  // Undefined or properties not on the list are acceptable, same as not being defined\n  return true;\n};\n\nvar types = Validator.prototype.types = {};\ntypes.string = function testString (instance) {\n  return typeof instance == 'string';\n};\ntypes.number = function testNumber (instance) {\n  // isFinite returns false for NaN, Infinity, and -Infinity\n  return typeof instance == 'number' && isFinite(instance);\n};\ntypes.integer = function testInteger (instance) {\n  return (typeof instance == 'number') && instance % 1 === 0;\n};\ntypes.boolean = function testBoolean (instance) {\n  return typeof instance == 'boolean';\n};\ntypes.array = function testArray (instance) {\n  return Array.isArray(instance);\n};\ntypes['null'] = function testNull (instance) {\n  return instance === null;\n};\ntypes.date = function testDate (instance) {\n  return instance instanceof Date;\n};\ntypes.any = function testAny (instance) {\n  return true;\n};\ntypes.object = function testObject (instance) {\n  // TODO: fix this - see #15\n  return instance && (typeof instance) === 'object' && !(instance instanceof Array) && !(instance instanceof Date);\n};\n\nmodule.exports = Validator;\n","/*! https://mths.be/punycode v1.4.1 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports &&\n\t\t!exports.nodeType && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\t!module.nodeType && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (\n\t\tfreeGlobal.global === freeGlobal ||\n\t\tfreeGlobal.window === freeGlobal ||\n\t\tfreeGlobal.self === freeGlobal\n\t) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^\\x20-\\x7E]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow new RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\tvar result = [];\n\t\twhile (length--) {\n\t\t\tresult[length] = fn(array[length]);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t * addresses.\n\t * @private\n\t * @param {String} domain The domain name or email address.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\tvar parts = string.split('@');\n\t\tvar result = '';\n\t\tif (parts.length > 1) {\n\t\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t\t// the local part (i.e. everything up to `@`) intact.\n\t\t\tresult = parts[0] + '@';\n\t\t\tstring = parts[1];\n\t\t}\n\t\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\t\tstring = string.replace(regexSeparators, '\\x2E');\n\t\tvar labels = string.split('.');\n\t\tvar encoded = map(labels, fn).join('.');\n\t\treturn result + encoded;\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * https://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t * Punycode string of ASCII-only symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name or an email address\n\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t * it doesn't matter if you call it on a string that has already been\n\t * converted to Unicode.\n\t * @memberOf punycode\n\t * @param {String} input The Punycoded domain name or email address to\n\t * convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name or an email address to\n\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t * ASCII.\n\t * @memberOf punycode\n\t * @param {String} input The domain name or email address to convert, as a\n\t * Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name or\n\t * email address.\n\t */\n\tfunction toASCII(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.4.1',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && freeModule) {\n\t\tif (module.exports == freeExports) {\n\t\t\t// in Node.js, io.js, or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else {\n\t\t\t// in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n","module.exports = function(module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function() {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","'use strict';\n\nmodule.exports = {\n  isString: function(arg) {\n    return typeof(arg) === 'string';\n  },\n  isObject: function(arg) {\n    return typeof(arg) === 'object' && arg !== null;\n  },\n  isNull: function(arg) {\n    return arg === null;\n  },\n  isNullOrUndefined: function(arg) {\n    return arg == null;\n  }\n};\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n","'use strict';\n\nvar helpers = require('./helpers');\n\n/** @type ValidatorResult */\nvar ValidatorResult = helpers.ValidatorResult;\n/** @type SchemaError */\nvar SchemaError = helpers.SchemaError;\n\nvar attribute = {};\n\nattribute.ignoreProperties = {\n  // informative properties\n  'id': true,\n  'default': true,\n  'description': true,\n  'title': true,\n  // arguments to other properties\n  'exclusiveMinimum': true,\n  'exclusiveMaximum': true,\n  'additionalItems': true,\n  // special-handled properties\n  '$schema': true,\n  '$ref': true,\n  'extends': true\n};\n\n/**\n * @name validators\n */\nvar validators = attribute.validators = {};\n\n/**\n * Validates whether the instance if of a certain type\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {ValidatorResult|null}\n */\nvalidators.type = function validateType (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var types = Array.isArray(schema.type) ? schema.type : [schema.type];\n  if (!types.some(this.testType.bind(this, instance, schema, options, ctx))) {\n    var list = types.map(function (v) {\n      return v.id && ('<' + v.id + '>') || (v+'');\n    });\n    result.addError({\n      name: 'type',\n      argument: list,\n      message: \"is not of a type(s) \" + list,\n    });\n  }\n  return result;\n};\n\nfunction testSchemaNoThrow(instance, options, ctx, callback, schema){\n  var throwError = options.throwError;\n  options.throwError = false;\n  var res = this.validateSchema(instance, schema, options, ctx);\n  options.throwError = throwError;\n\n  if (! res.valid && callback instanceof Function) {\n    callback(res);\n  }\n  return res.valid;\n}\n\n/**\n * Validates whether the instance matches some of the given schemas\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {ValidatorResult|null}\n */\nvalidators.anyOf = function validateAnyOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var inner = new ValidatorResult(instance, schema, options, ctx);\n  if (!Array.isArray(schema.anyOf)){\n    throw new SchemaError(\"anyOf must be an array\");\n  }\n  if (!schema.anyOf.some(\n    testSchemaNoThrow.bind(\n      this, instance, options, ctx, function(res){inner.importErrors(res);}\n      ))) {\n    var list = schema.anyOf.map(function (v, i) {\n      return (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n    });\n    if (options.nestedErrors) {\n      result.importErrors(inner);\n    }\n    result.addError({\n      name: 'anyOf',\n      argument: list,\n      message: \"is not any of \" + list.join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance matches every given schema\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.allOf = function validateAllOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema.allOf)){\n    throw new SchemaError(\"allOf must be an array\");\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var self = this;\n  schema.allOf.forEach(function(v, i){\n    var valid = self.validateSchema(instance, v, options, ctx);\n    if(!valid.valid){\n      var msg = (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n      result.addError({\n        name: 'allOf',\n        argument: { id: msg, length: valid.errors.length, valid: valid },\n        message: 'does not match allOf schema ' + msg + ' with ' + valid.errors.length + ' error[s]:',\n      });\n      result.importErrors(valid);\n    }\n  });\n  return result;\n};\n\n/**\n * Validates whether the instance matches exactly one of the given schemas\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.oneOf = function validateOneOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema.oneOf)){\n    throw new SchemaError(\"oneOf must be an array\");\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var inner = new ValidatorResult(instance, schema, options, ctx);\n  var count = schema.oneOf.filter(\n    testSchemaNoThrow.bind(\n      this, instance, options, ctx, function(res) {inner.importErrors(res);}\n      ) ).length;\n  var list = schema.oneOf.map(function (v, i) {\n    return (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n  });\n  if (count!==1) {\n    if (options.nestedErrors) {\n      result.importErrors(inner);\n    }\n    result.addError({\n      name: 'oneOf',\n      argument: list,\n      message: \"is not exactly one from \" + list.join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates properties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.properties = function validateProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var properties = schema.properties || {};\n  for (var property in properties) {\n    if (typeof options.preValidateProperty == 'function') {\n      options.preValidateProperty(instance, property, properties[property], options, ctx);\n    }\n\n    var prop = Object.hasOwnProperty.call(instance, property) ? instance[property] : undefined;\n    var res = this.validateSchema(prop, properties[property], options, ctx.makeChild(properties[property], property));\n    if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n    result.importErrors(res);\n  }\n  return result;\n};\n\n/**\n * Test a specific property within in instance against the additionalProperties schema attribute\n * This ignores properties with definitions in the properties schema attribute, but no other attributes.\n * If too many more types of property-existance tests pop up they may need their own class of tests (like `type` has)\n * @private\n * @return {boolean}\n */\nfunction testAdditionalProperty (instance, schema, options, ctx, property, result) {\n  if(!this.types.object(instance)) return;\n  if (schema.properties && schema.properties[property] !== undefined) {\n    return;\n  }\n  if (schema.additionalProperties === false) {\n    result.addError({\n      name: 'additionalProperties',\n      argument: property,\n      message: \"additionalProperty \" + JSON.stringify(property) + \" exists in instance when not allowed\",\n    });\n  } else {\n    var additionalProperties = schema.additionalProperties || {};\n\n    if (typeof options.preValidateProperty == 'function') {\n      options.preValidateProperty(instance, property, additionalProperties, options, ctx);\n    }\n\n    var res = this.validateSchema(instance[property], additionalProperties, options, ctx.makeChild(additionalProperties, property));\n    if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n    result.importErrors(res);\n  }\n}\n\n/**\n * Validates patternProperties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.patternProperties = function validatePatternProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var patternProperties = schema.patternProperties || {};\n\n  for (var property in instance) {\n    var test = true;\n    for (var pattern in patternProperties) {\n      var expr = new RegExp(pattern);\n      if (!expr.test(property)) {\n        continue;\n      }\n      test = false;\n\n      if (typeof options.preValidateProperty == 'function') {\n        options.preValidateProperty(instance, property, patternProperties[pattern], options, ctx);\n      }\n\n      var res = this.validateSchema(instance[property], patternProperties[pattern], options, ctx.makeChild(patternProperties[pattern], property));\n      if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n      result.importErrors(res);\n    }\n    if (test) {\n      testAdditionalProperty.call(this, instance, schema, options, ctx, property, result);\n    }\n  }\n\n  return result;\n};\n\n/**\n * Validates additionalProperties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.additionalProperties = function validateAdditionalProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  // if patternProperties is defined then we'll test when that one is called instead\n  if (schema.patternProperties) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  for (var property in instance) {\n    testAdditionalProperty.call(this, instance, schema, options, ctx, property, result);\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at least of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minProperties = function validateMinProperties (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var keys = Object.keys(instance);\n  if (!(keys.length >= schema.minProperties)) {\n    result.addError({\n      name: 'minProperties',\n      argument: schema.minProperties,\n      message: \"does not meet minimum property length of \" + schema.minProperties,\n    })\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at most of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxProperties = function validateMaxProperties (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var keys = Object.keys(instance);\n  if (!(keys.length <= schema.maxProperties)) {\n    result.addError({\n      name: 'maxProperties',\n      argument: schema.maxProperties,\n      message: \"does not meet maximum property length of \" + schema.maxProperties,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates items when instance is an array\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.items = function validateItems (instance, schema, options, ctx) {\n  var self = this;\n  if (!this.types.array(instance)) return;\n  if (!schema.items) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  instance.every(function (value, i) {\n    var items = Array.isArray(schema.items) ? (schema.items[i] || schema.additionalItems) : schema.items;\n    if (items === undefined) {\n      return true;\n    }\n    if (items === false) {\n      result.addError({\n        name: 'items',\n        message: \"additionalItems not permitted\",\n      });\n      return false;\n    }\n    var res = self.validateSchema(value, items, options, ctx.makeChild(items, i));\n    if(res.instance !== result.instance[i]) result.instance[i] = res.instance;\n    result.importErrors(res);\n    return true;\n  });\n  return result;\n};\n\n/**\n * Validates minimum and exclusiveMinimum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minimum = function validateMinimum (instance, schema, options, ctx) {\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var valid = true;\n  if (schema.exclusiveMinimum && schema.exclusiveMinimum === true) {\n    valid = instance > schema.minimum;\n  } else {\n    valid = instance >= schema.minimum;\n  }\n  if (!valid) {\n    result.addError({\n      name: 'minimum',\n      argument: schema.minimum,\n      message: \"must have a minimum value of \" + schema.minimum,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates maximum and exclusiveMaximum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maximum = function validateMaximum (instance, schema, options, ctx) {\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var valid;\n  if (schema.exclusiveMaximum && schema.exclusiveMaximum === true) {\n    valid = instance < schema.maximum;\n  } else {\n    valid = instance <= schema.maximum;\n  }\n  if (!valid) {\n    result.addError({\n      name: 'maximum',\n      argument: schema.maximum,\n      message: \"must have a maximum value of \" + schema.maximum,\n    });\n  }\n  return result;\n};\n\n/**\n * Perform validation for multipleOf and divisibleBy, which are essentially the same.\n * @param instance\n * @param schema\n * @param validationType\n * @param errorMessage\n * @returns {String|null}\n */\nvar validateMultipleOfOrDivisbleBy = function validateMultipleOfOrDivisbleBy (instance, schema, options, ctx, validationType, errorMessage) {\n  if (!this.types.number(instance)) return;\n\n  var validationArgument = schema[validationType];\n  if (validationArgument == 0) {\n    throw new SchemaError(validationType + \" cannot be zero\");\n  }\n\n  var result = new ValidatorResult(instance, schema, options, ctx);\n\n  var instanceDecimals = helpers.getDecimalPlaces(instance);\n  var divisorDecimals = helpers.getDecimalPlaces(validationArgument);\n\n  var maxDecimals = Math.max(instanceDecimals , divisorDecimals);\n  var multiplier = Math.pow(10, maxDecimals);\n\n  if (Math.round(instance * multiplier) % Math.round(validationArgument * multiplier) !== 0) {\n    result.addError({\n      name: validationType,\n      argument:  validationArgument,\n      message: errorMessage + JSON.stringify(validationArgument)\n    });\n  }\n\n  return result;\n};\n\n/**\n * Validates divisibleBy when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.multipleOf = function validateMultipleOf (instance, schema, options, ctx) {\n return validateMultipleOfOrDivisbleBy.call(this, instance, schema, options, ctx, \"multipleOf\", \"is not a multiple of (divisible by) \");\n};\n\n/**\n * Validates multipleOf when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.divisibleBy = function validateDivisibleBy (instance, schema, options, ctx) {\n  return validateMultipleOfOrDivisbleBy.call(this, instance, schema, options, ctx, \"divisibleBy\", \"is not divisible by (multiple of) \");\n};\n\n/**\n * Validates whether the instance value is present.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.required = function validateRequired (instance, schema, options, ctx) {\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (instance === undefined && schema.required === true) {\n    // A boolean form is implemented for reverse-compatability with schemas written against older drafts\n    result.addError({\n      name: 'required',\n      message: \"is required\"\n    });\n  } else if (this.types.object(instance) && Array.isArray(schema.required)) {\n    schema.required.forEach(function(n){\n      if(instance[n]===undefined){\n        result.addError({\n          name: 'required',\n          argument: n,\n          message: \"requires property \" + JSON.stringify(n),\n        });\n      }\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value matches the regular expression, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.pattern = function validatePattern (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!instance.match(schema.pattern)) {\n    result.addError({\n      name: 'pattern',\n      argument: schema.pattern,\n      message: \"does not match pattern \" + JSON.stringify(schema.pattern.toString()),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is of a certain defined format or a custom\n * format.\n * The following formats are supported for string types:\n *   - date-time\n *   - date\n *   - time\n *   - ip-address\n *   - ipv6\n *   - uri\n *   - color\n *   - host-name\n *   - alpha\n *   - alpha-numeric\n *   - utc-millisec\n * @param instance\n * @param schema\n * @param [options]\n * @param [ctx]\n * @return {String|null}\n */\nvalidators.format = function validateFormat (instance, schema, options, ctx) {\n  if (instance===undefined) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!result.disableFormat && !helpers.isFormat(instance, schema.format, this)) {\n    result.addError({\n      name: 'format',\n      argument: schema.format,\n      message: \"does not conform to the \" + JSON.stringify(schema.format) + \" format\",\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at least of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minLength = function validateMinLength (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var hsp = instance.match(/[\\uDC00-\\uDFFF]/g);\n  var length = instance.length - (hsp ? hsp.length : 0);\n  if (!(length >= schema.minLength)) {\n    result.addError({\n      name: 'minLength',\n      argument: schema.minLength,\n      message: \"does not meet minimum length of \" + schema.minLength,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at most of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxLength = function validateMaxLength (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  // TODO if this was already computed in \"minLength\", use that value instead of re-computing\n  var hsp = instance.match(/[\\uDC00-\\uDFFF]/g);\n  var length = instance.length - (hsp ? hsp.length : 0);\n  if (!(length <= schema.maxLength)) {\n    result.addError({\n      name: 'maxLength',\n      argument: schema.maxLength,\n      message: \"does not meet maximum length of \" + schema.maxLength,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether instance contains at least a minimum number of items, when the instance is an Array.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minItems = function validateMinItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!(instance.length >= schema.minItems)) {\n    result.addError({\n      name: 'minItems',\n      argument: schema.minItems,\n      message: \"does not meet minimum length of \" + schema.minItems,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether instance contains no more than a maximum number of items, when the instance is an Array.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxItems = function validateMaxItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!(instance.length <= schema.maxItems)) {\n    result.addError({\n      name: 'maxItems',\n      argument: schema.maxItems,\n      message: \"does not meet maximum length of \" + schema.maxItems,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates that every item in an instance array is unique, when instance is an array\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.uniqueItems = function validateUniqueItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  function testArrays (v, i, a) {\n    for (var j = i + 1; j < a.length; j++) if (helpers.deepCompareStrict(v, a[j])) {\n      return false;\n    }\n    return true;\n  }\n  if (!instance.every(testArrays)) {\n    result.addError({\n      name: 'uniqueItems',\n      message: \"contains duplicate item\",\n    });\n  }\n  return result;\n};\n\n/**\n * Deep compares arrays for duplicates\n * @param v\n * @param i\n * @param a\n * @private\n * @return {boolean}\n */\nfunction testArrays (v, i, a) {\n  var j, len = a.length;\n  for (j = i + 1, len; j < len; j++) {\n    if (helpers.deepCompareStrict(v, a[j])) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Validates whether there are no duplicates, when the instance is an Array.\n * @param instance\n * @return {String|null}\n */\nvalidators.uniqueItems = function validateUniqueItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!instance.every(testArrays)) {\n    result.addError({\n      name: 'uniqueItems',\n      message: \"contains duplicate item\",\n    });\n  }\n  return result;\n};\n\n/**\n * Validate for the presence of dependency properties, if the instance is an object.\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {null|ValidatorResult}\n */\nvalidators.dependencies = function validateDependencies (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  for (var property in schema.dependencies) {\n    if (instance[property] === undefined) {\n      continue;\n    }\n    var dep = schema.dependencies[property];\n    var childContext = ctx.makeChild(dep, property);\n    if (typeof dep == 'string') {\n      dep = [dep];\n    }\n    if (Array.isArray(dep)) {\n      dep.forEach(function (prop) {\n        if (instance[prop] === undefined) {\n          result.addError({\n            // FIXME there's two different \"dependencies\" errors here with slightly different outputs\n            // Can we make these the same? Or should we create different error types?\n            name: 'dependencies',\n            argument: childContext.propertyPath,\n            message: \"property \" + prop + \" not found, required by \" + childContext.propertyPath,\n          });\n        }\n      });\n    } else {\n      var res = this.validateSchema(instance, dep, options, childContext);\n      if(result.instance !== res.instance) result.instance = res.instance;\n      if (res && res.errors.length) {\n        result.addError({\n          name: 'dependencies',\n          argument: childContext.propertyPath,\n          message: \"does not meet dependency required by \" + childContext.propertyPath,\n        });\n        result.importErrors(res);\n      }\n    }\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is one of the enumerated values.\n *\n * @param instance\n * @param schema\n * @return {ValidatorResult|null}\n */\nvalidators['enum'] = function validateEnum (instance, schema, options, ctx) {\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema['enum'])) {\n    throw new SchemaError(\"enum expects an array\", schema);\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!schema['enum'].some(helpers.deepCompareStrict.bind(null, instance))) {\n    result.addError({\n      name: 'enum',\n      argument: schema['enum'],\n      message: \"is not one of enum values: \" + schema['enum'].map(String).join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance exactly matches a given value\n *\n * @param instance\n * @param schema\n * @return {ValidatorResult|null}\n */\nvalidators['const'] = function validateEnum (instance, schema, options, ctx) {\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!helpers.deepCompareStrict(schema['const'], instance)) {\n    result.addError({\n      name: 'const',\n      argument: schema['const'],\n      message: \"does not exactly match expected constant: \" + schema['const'],\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance if of a prohibited type.\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {null|ValidatorResult}\n */\nvalidators.not = validators.disallow = function validateNot (instance, schema, options, ctx) {\n  var self = this;\n  if(instance===undefined) return null;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var notTypes = schema.not || schema.disallow;\n  if(!notTypes) return null;\n  if(!Array.isArray(notTypes)) notTypes=[notTypes];\n  notTypes.forEach(function (type) {\n    if (self.testType(instance, schema, options, ctx, type)) {\n      var schemaId = type && type.id && ('<' + type.id + '>') || type;\n      result.addError({\n        name: 'not',\n        argument: schemaId,\n        message: \"is of prohibited type \" + schemaId,\n      });\n    }\n  });\n  return result;\n};\n\nmodule.exports = attribute;\n","import * as Notification from './Notification';\nimport NeonView from '../NeonView';\nimport { navbarDropdownMenu, undoRedoPanel } from './EditContents';\nimport { convertStaffToSb } from './ConvertMei';\n\n/**\n * prepare the edit mode button\n */\nexport function prepareEditMode (neonView: NeonView): void {\n  const parent = document.getElementById('dropdown_toggle');\n  const editItem = document.createElement('a');\n  editItem.classList.add('navbar-item');\n  const editButton = document.createElement('button');\n  editButton.classList.add('button');\n  editButton.id = 'edit_mode';\n  editButton.textContent = 'Edit MEI';\n  editItem.appendChild(editButton);\n  parent.appendChild(editItem);\n\n  editButton.addEventListener('click', () => {\n    startEditMode(neonView);\n  });\n}\n\n/**\n * start the basic edit mode features\n * is called when the edit mode button is clicked\n */\nexport function startEditMode (neonView: NeonView): void {\n  const parent: HTMLElement = document.getElementById('dropdown_toggle').parentElement;\n  document.getElementById('dropdown_toggle').remove();\n  parent.prepend(navbarDropdownMenu);\n  document.getElementById('undoRedo_controls').innerHTML = undoRedoPanel;\n  initNavbar(neonView);\n  initUndoRedoPanel(neonView);\n\n  const selectionHighlight = document.createElement('a');\n  const divider = document.createElement('hr');\n  divider.classList.add('dropdown-divider');\n  selectionHighlight.classList.add('dropdown-item');\n  selectionHighlight.id = 'highlight-selection';\n  selectionHighlight.textContent = 'By Selection Mode';\n  (document.getElementsByClassName('dropdown-content'))[0].appendChild(divider);\n  (document.getElementsByClassName('dropdown-content'))[0].appendChild(selectionHighlight);\n}\n\n/**\n * Set listener on switching EditMode button to File dropdown in the navbar.\n */\nexport function initNavbar (neonView: NeonView): void {\n  // setup navbar listeners\n  document.getElementById('save').addEventListener('click', () => {\n    neonView.save().then(() => {\n      Notification.queueNotification('Saved');\n    });\n  });\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === 's') {\n      neonView.save().then(() => {\n        Notification.queueNotification('Saved');\n      });\n    }\n  });\n\n  document.getElementById('export').addEventListener('click', () => {\n    neonView.export().then(manifest => {\n      const link: HTMLAnchorElement = document.createElement('a');\n      link.href = manifest as string;\n      link.download = neonView.name + '.jsonld';\n      document.body.appendChild(link);\n      link.click();\n      link.remove();\n      Notification.queueNotification('Saved');\n    });\n  });\n\n  document.getElementById('revert').addEventListener('click', function () {\n    if (window.confirm('Reverting will cause all changes to be lost. Press OK to continue.')) {\n      neonView.deleteDb().then(() => {\n        window.location.reload();\n      });\n    }\n  });\n  // Download link for MEI\n  // Is an actual file with a valid URI except in local mode where it must be generated.\n  document.getElementById('getmei').addEventListener('click', () => {\n    const uri = neonView.view.getCurrentPageURI();\n    neonView.getPageMEI(uri).then(mei => {\n      const data = 'data:application/mei+xml;base64,' + window.btoa(convertStaffToSb(mei));\n      document.getElementById('getmei').setAttribute('href', data);\n      document.getElementById('getmei').setAttribute('download', neonView.view.getPageName() + '.mei');\n    });\n  });\n}\n\n/**\n * Initialize the undo/redo panel\n */\nexport function initUndoRedoPanel (neonView: NeonView): void {\n  document.getElementById('undo').addEventListener('click', undoHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === 'z' && (evt.ctrlKey || evt.metaKey)) {\n      undoHandler();\n    }\n  });\n\n  document.getElementById('redo').addEventListener('click', redoHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if ((evt.key === 'Z' || (evt.key === 'z' && evt.shiftKey)) && (evt.ctrlKey || evt.metaKey)) {\n      redoHandler();\n    }\n  });\n\n  /**\n   * Tries to undo an action and update the page if it succeeds.\n   */\n  function undoHandler (): void {\n    neonView.undo().then((result: boolean) => {\n      if (result) {\n        neonView.updateForCurrentPage();\n      } else {\n        console.error('Failed to undo action');\n      }\n    });\n  }\n\n  /**\n   * Tries to redo an action and update the page if it succeeds.\n   */\n  function redoHandler (): void {\n    neonView.redo().then((result: boolean) => {\n      if (result) {\n        neonView.updateForCurrentPage();\n      } else {\n        console.error('Failed to redo action');\n      }\n    });\n  }\n}\n","/**\n * Contents of navbar menu after switching to edit mode.\n */\nexport const navbarDropdownMenu: HTMLDivElement = document.createElement('div');\nnavbarDropdownMenu.classList.add('navbar-item', 'has-dropdown', 'is-hoverable');\nconst fileLink = document.createElement('a');\nfileLink.classList.add('navbar-link');\nfileLink.textContent = 'File';\nconst navbarContents = document.createElement('div');\nnavbarContents.classList.add('navbar-dropdown');\nnavbarContents.id = 'navbar-dropdown-options';\nconst contents = [['save', 'Save'], ['export', 'Save and Export to File'],\n  ['getmei', 'Download MEI'], ['revert', 'Revert']];\ncontents.forEach(content => {\n  const item = document.createElement('a');\n  item.id = content[0];\n  item.classList.add('navbar-item');\n  item.textContent = content[1];\n  navbarContents.appendChild(item);\n});\nnavbarDropdownMenu.appendChild(fileLink);\nnavbarDropdownMenu.appendChild(navbarContents);\n\n/**\n * Finalize option in the navbar for rodan\n */\nexport const navbarFinalize =\n    '<a id=\\'finalize\\' class=\\'navbar-item\\'> Finalize MEI </a>';\n\n/**\n * Contents of the undo/redo panel with buttons\n */\nexport const undoRedoPanel: string =\n    '<div class=\\'field has-addons buttons\\' style=\\'overflow-x: auto;\\'>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'undo\\'>Undo</button>' +\n    '<button class=\\'button\\' id=\\'redo\\'>Redo</button></p></a></div>';\n","async function setBody (): Promise<void> {\n  const response = await fetch(__ASSET_PREFIX__ + 'assets/template.html');\n  document.body.innerHTML = await response.text();\n  (document.getElementById('home-link') as HTMLAnchorElement)\n    .href = __LINK_LOCATION__;\n  document.getElementById('neon-version').textContent = __NEON_VERSION__;\n}\n\nexport { setBody as default };\n","import * as d3 from 'd3';\n\nexport class ViewBox {\n  a: number;\n  b: number;\n  c: number;\n  d: number;\n\n  imageHeight: number;\n  imageWidth: number;\n\n  /**\n   * @param imageWidth - Width of the contained image.\n   * @param imageHeight - Height of the contained image.\n   */\n  constructor (imageWidth: number, imageHeight: number) {\n    this.a = 0;\n    this.b = 0;\n    this.c = imageWidth;\n    this.d = imageHeight;\n\n    this.imageWidth = imageWidth;\n    this.imageHeight = imageHeight;\n  }\n\n  /**\n   * Set values of the viewBox manually.\n   * @param w - First value.\n   * @param x - Second value.\n   * @param y - Third value.\n   * @param z - Fourth value.\n   */\n  set (w: number, x: number, y: number, z: number): void {\n    this.a = w;\n    this.b = x;\n    this.c = y;\n    this.d = z;\n  }\n\n  /** @returns Value for the viewBox parameter. */\n  get (): string {\n    return this.a.toString() + ' ' + this.b.toString() + ' ' +\n      this.c + ' ' + this.d;\n  }\n\n  /** @param k - Factor to zoom to. */\n  zoomTo (k: number): void {\n    const zoomHeight = (this.imageHeight / k);\n    const zoomWidth = (this.imageWidth / k);\n\n    this.c = zoomWidth;\n    this.d = zoomHeight;\n  }\n\n  /** @returns Current zoom factor. */\n  getZoom (): number {\n    return this.imageWidth / this.c;\n  }\n\n  /**\n   * Translate viewport.\n   * @param xDiff - Amount to shift on x-axis.\n   * @param yDiff - Amount to shift on y-axis.\n   */\n  translate (xDiff: number, yDiff: number): void {\n    this.a += xDiff;\n    this.b += yDiff;\n  }\n}\n\nexport class ZoomHandler {\n  dragCoordinates: DOMPoint;\n  viewBox: ViewBox;\n  matrix: DOMMatrix;\n\n  /**\n   * Reset the zoom and pan of the SVG viewbox\n   */\n  resetZoomAndPan (): void {\n    const bgimg = document.getElementById('bgimg') as HTMLImageElement;\n    this.viewBox = new ViewBox(parseInt(bgimg.getAttribute('width')), parseInt(bgimg.getAttribute('height')));\n\n    this.updateViewBox();\n  }\n\n  /**\n   * @param k - Factor to zoom to.\n   */\n  zoomTo (k: number): void {\n    this.getViewBox();\n    this.viewBox.zoomTo(k);\n    this.updateViewBox();\n  }\n\n  /**\n   * Translate the view box by relative coordinates.\n  * @param xDiff - Amount to shift on x-axis.\n  * @param yDiff - Amount to shift on y-axis.\n  */\n  translate (xDiff: number, yDiff: number): void {\n    this.getViewBox();\n    this.viewBox.translate(xDiff, yDiff);\n    this.updateViewBox();\n  }\n\n  /**\n   * Restore the view box to its position before the editor action.\n   */\n  restoreTransformation (): void {\n    if (this.viewBox === undefined) {\n      this.resetZoomAndPan();\n    } else {\n      this.updateViewBox();\n    }\n  }\n\n  /**\n   * Get the view box from the SVG in the page.\n   */\n  getViewBox (): void {\n    if (this.viewBox === undefined) {\n      const bgimg = document.getElementById('bgimg') as HTMLImageElement;\n      this.viewBox = new ViewBox(parseInt(bgimg.getAttribute('width')), parseInt(bgimg.getAttribute('height')));\n    }\n    const rawViewBox = document.getElementById('svg_group')\n      .getAttribute('viewBox')\n      .split(' ');\n    this.viewBox.set(\n      parseInt(rawViewBox[0]),\n      parseInt(rawViewBox[1]),\n      parseInt(rawViewBox[2]),\n      parseInt(rawViewBox[3])\n    );\n  }\n\n  /**\n   * Update the viewBox attribute of svg_group\n   */\n  updateViewBox (): void {\n    document.getElementById('svg_group').setAttribute('viewBox', this.viewBox.get());\n  }\n\n  startDrag (): void {\n    const group = document.getElementById('svg_group') as unknown as SVGSVGElement;\n    this.dragCoordinates = group.createSVGPoint();\n    if (d3.event.type === 'touchstart') {\n      // If drag is triggered by a touch event\n      this.dragCoordinates.x = d3.event.touches[0].screenX;\n      this.dragCoordinates.y = d3.event.touches[0].screenY;\n    } else {\n      // Otherwise triggered by a mouse click\n      this.dragCoordinates.x = d3.event.x;\n      this.dragCoordinates.y = d3.event.y;\n    }\n\n    this.matrix = group.getScreenCTM().inverse();\n  }\n\n  dragging (): void {\n    const group = document.getElementById('svg_group') as unknown as SVGSVGElement;\n    const newCoordinates = group.createSVGPoint();\n    // Same kind of checking as in startDrag\n    if (d3.event.type === 'touchmove') {\n      newCoordinates.x = d3.event.touches[0].screenX;\n      newCoordinates.y = d3.event.touches[0].screenY;\n    } else if (d3.event.type === 'wheel' && d3.event.shiftKey === false) {\n      if (this.matrix === undefined) {\n        this.matrix = group.getScreenCTM().inverse();\n      }\n      if (this.dragCoordinates === undefined) {\n        this.dragCoordinates = group.createSVGPoint();\n      }\n      this.dragCoordinates.x = d3.event.x;\n      this.dragCoordinates.y = d3.event.y;\n      newCoordinates.x = this.dragCoordinates.x - d3.event.deltaX;\n      newCoordinates.y = this.dragCoordinates.y - d3.event.deltaY;\n      d3.event.preventDefault();\n    } else {\n      newCoordinates.x = d3.event.x;\n      newCoordinates.y = d3.event.y;\n    }\n    const newTransform = newCoordinates.matrixTransform(this.matrix);\n    const dragTransform = this.dragCoordinates.matrixTransform(this.matrix);\n    this.translate(-newTransform.x + dragTransform.x, -newTransform.y + dragTransform.y);\n    this.dragCoordinates = newCoordinates;\n  }\n\n  scrollZoom (): void {\n    if (d3.event.type !== 'wheel') return;\n    if (!d3.event.shiftKey) {\n      this.dragging();\n      return;\n    }\n    const slider = document.getElementById('zoomSlider') as HTMLInputElement;\n    this.getViewBox();\n    const k = this.viewBox.getZoom();\n    let newK = k - d3.event.deltaX / 100;\n    if (newK < parseInt(slider.getAttribute('min')) / 100) newK = 0.25;\n    if (newK > parseInt(slider.getAttribute('max')) / 100) newK = 4;\n    this.zoomTo(newK);\n\n    // Update zoom slider\n    slider.value = (newK * 100).toString();\n    (document.getElementById('zoomOutput') as HTMLOutputElement).value = String(Math.round(newK * 100));\n  }\n}\n\nexport { ZoomHandler as default };\n","/** @module Warnings */\n\n/**\n * Warn when grouped neume components form an unrecognized neume.\n */\nexport function groupingNotRecognized () {\n  if (!(window.confirm('Neon does not recognize this neume grouping. Would you like to create a compound neume?'))) {\n    document.getElementById('undo').click();\n  }\n}\n","import * as Notification from '../utils/Notification';\nimport NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport { selectAll } from '../utils/SelectTools';\nimport DragHandler from '../utils/DragHandler';\n\n/** Handle splitting a staff into two staves through Verovio. */\nexport class SplitHandler {\n  readonly neonView: NeonView;\n  readonly staff: SVGGElement;\n\n  /**\n   * @param staff - The staff that will be modified.\n   */\n  constructor (neonView: NeonView, staff: SVGGElement) {\n    this.neonView = neonView;\n    this.staff = staff;\n  }\n\n  /**\n   * First part of the split action.\n   */\n  startSplit (): void {\n    this.splitDisable();\n\n    document.body.addEventListener('click', this.handler, { capture: true });\n\n    // Handle keypresses\n    document.body.addEventListener('keydown', this.keydownListener);\n    document.body.addEventListener('keyup', this.resetHandler);\n    document.body.addEventListener('click', this.clickawayHandler);\n\n    Notification.queueNotification('Click Where to Split');\n  }\n\n  splitDisable (): void {\n    document.body.removeEventListener('keydown', this.keydownListener);\n    document.body.removeEventListener('keyup', this.resetHandler);\n    document.body.removeEventListener('click', this.clickawayHandler);\n    document.body.removeEventListener('click', this.handler, { capture: true });\n  }\n\n  /** Handle input to split a staff. */\n  handler = ((evt: MouseEvent): void => {\n    const id = this.staff.id;\n\n    const container = this.staff.closest('.definition-scale') as SVGSVGElement;\n    const pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n\n    // Transform to SVG coordinate system.\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGElement)\n      .getScreenCTM().inverse();\n    const cursorPt = pt.matrixTransform(transformMatrix);\n    // Find staff point corresponds to if one exists\n    // TODO\n\n    const editorAction: EditorAction = {\n      'action': 'split',\n      'param': {\n        'elementId': id,\n        'x': cursorPt.x\n      }\n    };\n\n    this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then(async (result) => {\n      if (result) {\n        await this.neonView.updateForCurrentPage();\n        Notification.queueNotification('Split action successful');\n      }\n      const dragHandler = new DragHandler(this.neonView, '.staff');\n      this.splitDisable();\n      selectAll([document.querySelector('#' + id) as SVGGElement], this.neonView, dragHandler);\n      try {\n        document.getElementById('moreEdit').innerHTML = '';\n        document.getElementById('moreEdit').classList.add('is-invisible');\n      } catch (e) {}\n    });\n  }).bind(this);\n\n  /** Exits split on Escape press, disables on Shift. */\n  keydownListener = ((evt: KeyboardEvent): void => {\n    if (evt.key === 'Escape') {\n      this.splitDisable();\n    } else if (evt.key === 'Shift') {\n      document.body.removeEventListener('click', this.handler, { capture: true });\n    }\n  }).bind(this);\n\n  /** Exit split if user clicks off of active page. */\n  clickawayHandler = ((evt: MouseEvent): void => {\n    const target = evt.target as HTMLElement;\n    if (target.closest('.active-page') === null) {\n      this.splitDisable();\n      document.body.removeEventListener('click', this.handler, { capture: true });\n    }\n  }).bind(this);\n\n  /** Called to reapply the event listener if necessary. */\n  resetHandler = ((evt: KeyboardEvent): void => {\n    if (evt.key === 'Shift') {\n      document.body.addEventListener('click', this.handler, { capture: true });\n    }\n  }).bind(this);\n}\n"],"sourceRoot":""}