{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/events/events.js","webpack:///./node_modules/pouchdb/node_modules/inherits/inherits_browser.js","webpack:///./node_modules/immediate/lib/browser.js","webpack:///(webpack)/buildin/global.js","webpack:///./node_modules/readable-stream/lib/_stream_duplex.js","webpack:///external \"d3\"","webpack:///./node_modules/argsarray/index.js","webpack:///./node_modules/process/browser.js","webpack:///./node_modules/inherits/inherits_browser.js","webpack:///./node_modules/jsonschema/lib/helpers.js","webpack:///./src/DisplayPanel/DisplayControls.ts","webpack:///./src/utils/SelectTools.ts","webpack:///./node_modules/core-util-is/lib/util.js","webpack:///./src/utils/Notification.ts","webpack:///./node_modules/buffer/index.js","webpack:///./node_modules/process-nextick-args/index.js","webpack:///./src/utils/Color.ts","webpack:///./src/SquareEdit/SelectOptions.ts","webpack:///./src/utils/DragHandler.ts","webpack:///./node_modules/spark-md5/spark-md5.js","webpack:///./node_modules/elementtree/lib/sprintf.js","webpack:///./node_modules/util/util.js","webpack:///./node_modules/readable-stream/readable-browser.js","webpack:///./node_modules/readable-stream/node_modules/safe-buffer/index.js","webpack:///./node_modules/readable-stream/lib/_stream_writable.js","webpack:///./node_modules/node-libs-browser/node_modules/string_decoder/lib/string_decoder.js","webpack:///./src/utils/random.ts","webpack:///./node_modules/url/url.js","webpack:///./node_modules/jsonschema/lib/scan.js","webpack:///./src/SquareEdit/Contents.ts","webpack:///./src/utils/Select.ts","webpack:///./node_modules/pouchdb/lib/index-browser.es.js","webpack:///./src/NeonView.ts","webpack:///./node_modules/pouchdb/node_modules/uuid/index.js","webpack:///./node_modules/vuvuzela/index.js","webpack:///./src/DisplayPanel/DisplayPanel.ts","webpack:///./src/DivaView.ts","webpack:///./src/SingleView/SingleView.ts","webpack:///./src/SquareEdit/DivaEditMode.ts","webpack:///./src/SquareEdit/SingleEditMode.ts","webpack:///./src/InfoModule.ts","webpack:///./src/TextView.ts","webpack:///./src/TextEditMode.ts","webpack:///./src/utils/ConvertMei.ts","webpack:///./node_modules/elementtree/lib/elementtree.js","webpack:///./node_modules/elementtree/lib/utils.js","webpack:///./node_modules/elementtree/lib/treebuilder.js","webpack:///./node_modules/readable-stream/lib/_stream_readable.js","webpack:///./node_modules/readable-stream/lib/internal/streams/stream-browser.js","webpack:///./node_modules/readable-stream/lib/internal/streams/destroy.js","webpack:///./node_modules/readable-stream/lib/_stream_transform.js","webpack:///./node_modules/pouchdb/node_modules/uuid/lib/rng-browser.js","webpack:///./node_modules/pouchdb/node_modules/uuid/lib/bytesToUuid.js","webpack:///./src/SquareEdit/Controls.ts","webpack:///./src/SquareEdit/Grouping.ts","webpack:///./src/utils/Resize.ts","webpack:///./src/SquareEdit/InsertHandler.ts","webpack:///./deployment/pages/editor.js","webpack:///./src/NeonCore.ts","webpack:///./node_modules/elementtree/lib/elementpath.js","webpack:///./node_modules/elementtree/lib/errors.js","webpack:///./node_modules/util/support/isBufferBrowser.js","webpack:///./node_modules/util/node_modules/inherits/inherits_browser.js","webpack:///./node_modules/elementtree/lib/parser.js","webpack:///./node_modules/elementtree/lib/parsers/index.js","webpack:///./node_modules/elementtree/lib/parsers/sax.js","webpack:///./node_modules/elementtree/node_modules/sax/lib/sax.js","webpack:///./node_modules/base64-js/index.js","webpack:///./node_modules/ieee754/index.js","webpack:///./node_modules/buffer/node_modules/isarray/index.js","webpack:///./node_modules/stream-browserify/index.js","webpack:///./node_modules/readable-stream/node_modules/isarray/index.js","webpack:///./node_modules/readable-stream/lib/internal/streams/BufferList.js","webpack:///./node_modules/timers-browserify/main.js","webpack:///./node_modules/setimmediate/setImmediate.js","webpack:///./node_modules/util-deprecate/browser.js","webpack:///./node_modules/safe-buffer/index.js","webpack:///./node_modules/readable-stream/lib/_stream_passthrough.js","webpack:///./node_modules/readable-stream/writable-browser.js","webpack:///./node_modules/readable-stream/duplex-browser.js","webpack:///./node_modules/readable-stream/transform.js","webpack:///./node_modules/readable-stream/passthrough.js","webpack:///./node_modules/elementtree/lib/constants.js","webpack:///./src/Validation.ts","webpack:///./src/VerovioWrapper.ts","webpack:///./node_modules/pouchdb/node_modules/uuid/v1.js","webpack:///./node_modules/pouchdb/node_modules/uuid/v4.js","webpack:///./src/utils/NeonManifest.ts","webpack:///./node_modules/jsonschema/lib/index.js","webpack:///./node_modules/jsonschema/lib/validator.js","webpack:///./node_modules/punycode/punycode.js","webpack:///(webpack)/buildin/module.js","webpack:///./node_modules/url/util.js","webpack:///./node_modules/querystring-es3/index.js","webpack:///./node_modules/querystring-es3/decode.js","webpack:///./node_modules/querystring-es3/encode.js","webpack:///./node_modules/jsonschema/lib/attribute.js","webpack:///./src/utils/EditControls.ts","webpack:///./src/utils/EditContents.ts","webpack:///./src/utils/template/Template.ts","webpack:///./src/SingleView/Zoom.ts","webpack:///./src/Warnings.ts","webpack:///./src/SquareEdit/StaffTools.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","EventEmitter","init","this","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","$getMaxListeners","that","_addListener","type","listener","prepend","events","existing","warning","TypeError","newListener","emit","unshift","push","length","warned","w","Error","String","emitter","count","console","warn","_onceWrap","state","fired","wrapFn","wrapped","arguments","removeListener","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","err","message","context","handler","len","listeners","addListener","on","prependListener","once","prependOnceListener","list","position","originalListener","shift","index","pop","spliceOne","off","removeAllListeners","keys","rawListeners","eventNames","ctor","superCtor","super_","constructor","writable","configurable","TempCtor","scheduleDrain","draining","Mutation","global","MutationObserver","WebKitMutationObserver","called","observer","nextTick","element","document","createTextNode","observe","characterData","data","setImmediate","MessageChannel","createElement","scriptEl","onreadystatechange","parentNode","removeChild","documentElement","appendChild","setTimeout","channel","port1","onmessage","port2","postMessage","queue","oldQueue","task","g","e","window","pna","objectKeys","obj","Duplex","util","inherits","Readable","Writable","v","method","options","readable","allowHalfOpen","onend","_writableState","ended","onEndNT","self","end","highWaterMark","_readableState","destroyed","_destroy","cb","d3","fun","cachedSetTimeout","cachedClearTimeout","process","defaultSetTimout","defaultClearTimeout","runTimeout","clearTimeout","currentQueue","queueIndex","cleanUpNextTick","drainQueue","timeout","run","marker","runClearTimeout","Item","array","noop","title","browser","env","argv","version","versions","binding","cwd","chdir","dir","umask","uri","ValidationError","instance","schema","propertyPath","argument","id","stack","toString","ValidatorResult","ctx","errors","throwError","disableFormat","stringizer","addError","detail","importErrors","res","validatorType","map","join","SchemaError","msg","captureStackTrace","SchemaContext","base","schemas","resolve","makeChild","propertyName","makeSuffix","FORMAT_REGEXPS","input","parseFloat","parseInt","result","RegExp","regexp","regex","pattern","ipv4","isFormat","format","validator","test","customFormats","match","JSON","stringify","deepMerge","src","isArray","dst","forEach","indexOf","pathEncoder","encodeURIComponent","replace","deepCompareStrict","a","b","every","aKeys","bKeys","objectGetPath","k","parts","split","slice","decodeURIComponent","encodePath","getDecimalPlaces","number","decimalPlaces","decimalParts","lastGlyphOpacity","lastImageOpacity","setHighlightControls","highlightDropdown","getElementById","highlightStaff","highlightSyllable","highlightNeume","highlightNone","highlightType","addEventListener","evt","stopPropagation","classList","toggle","contains","body","highlightClickaway","remove","querySelectorAll","elem","add","textContent","Color","setGroupingHighlight","unsetGroupingHighlight","removeEventListener","meiClassName","background","opacitySlider","opacityOutput","inputChangeOpacity","querySelector","style","opacity","lowerOpacity","newOpacity","Math","round","setOpacityControls","bgOpacitySlider","bgOpacityOutput","bgInputChangeHandler","getElementsByClassName","setBackgroundOpacityControls","displayContents","toggleDisplay","display","setAttribute","zoomHandler","zoomSlider","zoomOutput","inputChangeHandler","zoomTo","resetZoomAndPan","currentZoom","newZoom","min","getAttribute","max","highlightSelection","highlightId","getSelectionType","unselect","selected","removeAttribute","unhighlight","fill","from","el","color","fontWeight","sylRect","syllable","selectAll","SelectOptions","endOptionsSelection","Grouping","endGroupingSelection","updateHighlight","select","dragHandler","selectStaff","sylId","closest","span","async","isLigature","nc","neonView","getElementAttr","view","getCurrentPageURI","sharedSecondLevelParent","elements","tempElements","secondParent","parentElement","selectBBox","bbox","syl","resize","dragInit","staff","highlight","parent","prevNc","previousSibling","nextNc","nextSibling","triggerGrouping","triggerNcActions","ulx","uly","lrx","lry","skew","path","coordinates","atan","notNeumes","nn","selectionType","selectionClass","containsClefOrCustos","groupsToSelect","Set","grouping","follows","precedes","group","groups","values","size","triggerClefActions","triggerCustosActions","triggerDefaultSylActions","triggerDefaultActions","triggerSplitActions","triggerStaffActions","triggerSylActions","staff0","staff1","staffChildren","children","abs","firstStaff","secondStaff","firstLayer","secondLayer","firstSyllableChildren","filter","secondSyllableChildren","lastSyllable","firstSyllable","triggerNeumeActions","posFirstY","posSecondY","x","baseVal","y","isFirstLigature","isSecondLigature","objectToString","isBoolean","isNull","isNullOrUndefined","isNumber","isString","isSymbol","isUndefined","isRegExp","re","isObject","isDate","isError","isFunction","isPrimitive","isBuffer","Buffer","notifications","currentModeMessage","notifying","NUMBER_TO_DISPLAY","startNotification","currentNotification","notification","isModeMessage","timeoutID","clearOrShowNextNotification","getId","notificationContent","innerHTML","displayNotification","setTimeoutId","currentId","notif","Notification","displayed","uuidv4","search","base64","ieee754","kMaxLength","TYPED_ARRAY_SUPPORT","createBuffer","Uint8Array","__proto__","encodingOrOffset","allocUnsafe","ArrayBuffer","byteOffset","byteLength","fromArrayLike","fromArrayBuffer","string","encoding","isEncoding","actual","write","fromString","checked","buffer","val","fromObject","assertSize","isView","loweredCase","utf8ToBytes","base64ToBytes","toLowerCase","slowToString","start","hexSlice","utf8Slice","asciiSlice","latin1Slice","base64Slice","utf16leSlice","swap","bidirectionalIndexOf","arrayIndexOf","lastIndexOf","indexSize","arrLength","valLength","read","buf","readUInt16BE","foundIndex","found","j","hexWrite","offset","remaining","strLen","parsed","substr","utf8Write","blitBuffer","asciiWrite","str","byteArray","charCodeAt","asciiToBytes","latin1Write","base64Write","ucs2Write","units","hi","lo","utf16leToBytes","fromByteArray","secondByte","thirdByte","fourthByte","tempCodePoint","firstByte","codePoint","bytesPerSequence","codePoints","MAX_ARGUMENTS_LENGTH","fromCharCode","decodeCodePointsArray","SlowBuffer","alloc","INSPECT_MAX_BYTES","foo","subarray","typedArraySupport","poolSize","_augment","species","allocUnsafeSlow","_isBuffer","compare","pos","swap16","swap32","swap64","equals","inspect","thisStart","thisEnd","thisCopy","targetCopy","includes","isFinite","toJSON","_arr","out","toHex","bytes","checkOffset","ext","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","writeDouble","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt8","readUInt16LE","readUInt32LE","readUInt32BE","readIntLE","pow","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","writeUIntBE","writeUInt8","floor","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","limit","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","targetStart","code","INVALID_BASE64_RE","Infinity","leadSurrogate","toByteArray","trim","stringtrim","base64clean","fn","arg1","arg2","arg3","ColorPalette","tagName","rects","rect","unsetStaffHighlight","child","cchild","setStaffHighlight","staves","staffColor","groupColor","unsetInclinatumAction","unsetVirgaAction","removeHandler","toRemove","chainAction","edit","then","updateForCurrentPage","changeStaffHandler","toChange","moreEdit","deleteButtonHandler","initOptionsListeners","preventDefault","initNeonView","Contents","ncActionContents","unsetInclinatum","unsetVirga","queueNotification","setInclinatum","setVirga","del","neumeActionContents","neume","contour","changeGroupingAction","triggerChangeGroup","info","getContourByValue","initGroupingListeners","clef","clefActionContents","setCClef","setFClef","custosActionContents","staffActionContents","systems","elementIds","editorAction","splitActionContents","SplitHandler","startSplit","co","dy","updateForCurrentPagePromise","defaultSylActionContents","changeStaff","defaultActionContents","default","selector","dragBehaviour","drag","dragStartCoords","event","dx","sourceEvent","dragging","dragEnded","activeNc","selection","relativeY","relativeX","attr","paramArray","singleAction","action","param","elementId","xDiff","yDiff","reset","resetToAction","hex_chr","md5cycle","md5blk","md5blks","md5blk_array","md51","tail","tmp","substring","rhex","hex","toUtf8","unescape","hexToBinaryString","SparkMD5","clamp","to","num","targetArray","sourceArray","begin","append","appendBinary","contents","_buff","_length","_hash","raw","buff","_finish","getState","hash","setState","destroy","hashBinary","content","first","second","returnUInt8Array","utf8Str2ArrayBuffer","md51_array","factory","cache","TO_ESCAPE","'","populate","formatter","prev","builder","sprintf","var_args","getOwnPropertyDescriptors","descriptors","getOwnPropertyDescriptor","formatRegExp","f","objects","_","deprecate","noDeprecation","throwDeprecation","traceDeprecation","trace","debugEnviron","debugs","opts","seen","stylize","stylizeNoColor","depth","colors","showHidden","_extend","customInspect","stylizeWithColor","formatValue","styleType","styles","recurseTimes","primitive","simple","formatPrimitive","visibleKeys","idx","arrayToHash","formatError","Date","output","braces","toUTCString","formatProperty","formatArray","reduce","cur","numLinesEst","reduceToSingleString","desc","line","ar","pad","debuglog","NODE_DEBUG","toUpperCase","pid","months","timestamp","time","getHours","getMinutes","getSeconds","getDate","getMonth","prop","log","origin","kCustomPromisifiedSymbol","callbackifyOnRejected","reason","newReason","promisify","original","promiseResolve","promiseReject","promise","Promise","reject","setPrototypeOf","defineProperties","custom","callbackify","callbackified","maybeCb","rej","Stream","Transform","PassThrough","copyProps","SafeBuffer","CorkedRequest","_this","next","entry","finish","corkReq","callback","pendingcb","corkedRequestsFree","onCorkedFinish","asyncWrite","WritableState","internalUtil","OurUint8Array","realHasInstance","destroyImpl","nop","stream","isDuplex","objectMode","writableObjectMode","hwm","writableHwm","writableHighWaterMark","defaultHwm","finalCalled","needDrain","ending","finished","noDecode","decodeStrings","defaultEncoding","writing","corked","sync","bufferProcessing","onwrite","writecb","writelen","onwriteStateUpdate","finishMaybe","errorEmitted","onwriteError","needFinish","bufferedRequest","clearBuffer","afterWrite","lastBufferedRequest","prefinished","bufferedRequestCount","_write","writev","_writev","final","_final","doWrite","chunk","onwriteDrain","holder","allBuffers","isBuf","callFinal","need","prefinish","getBuffer","current","hasInstance","pipe","_uint8ArrayToBuffer","writeAfterEnd","valid","validChunk","newChunk","decodeChunk","last","writeOrBuffer","cork","uncork","setDefaultEncoding","endWritable","_undestroy","undestroy","StringDecoder","nb","enc","nenc","retried","_normalizeEncoding","normalizeEncoding","text","utf16Text","utf16End","fillLast","utf8FillLast","base64Text","base64End","simpleWrite","simpleEnd","lastNeed","lastTotal","lastChar","utf8CheckByte","byte","utf8CheckExtraBytes","total","utf8CheckIncomplete","uint8ToUuid","previous","padStart","crypto","octets","modifiers","getRandomValues","punycode","Url","protocol","slashes","auth","host","port","hostname","query","pathname","href","parse","urlParse","source","relative","resolveObject","protocolPattern","portPattern","simplePathPattern","unwise","autoEscape","nonHostChars","hostEndingChars","hostnamePartPattern","hostnamePartStart","unsafeProtocol","hostlessProtocol","slashedProtocol","querystring","url","parseQueryString","slashesDenoteHost","u","queryIndex","splitter","uSplit","rest","simplePath","exec","proto","lowerProto","atSign","hostEnd","hec","parseHost","ipv6Hostname","hostparts","part","newpart","validParts","notHost","bit","toASCII","h","ae","esc","escape","qm","charAt","rel","tkeys","tk","tkey","rkeys","rk","rkey","relPath","isSourceAbs","isRelAbs","mustEndAbs","removeAllDots","srcPath","psychotic","authInHost","hasTrailingSlash","up","splice","isAbsolute","urilib","helpers","SchemaScanResult","ref","scan","scanSchema","baseuri","$ref","resolvedUri","ourBase","scanArray","items","extends","additionalItems","scanObject","properties","additionalProperties","definitions","patternProperties","dependencies","disallow","allOf","anyOf","oneOf","not","insertTabHtml","primitiveTab","groupingTab","systemTab","insertControlsPanel","editControlsPanel","groupingMenu","strokeWidth","escapeKeyListener","infoListeners","isSelByBBox","selByBBox","stopPropHandler","clickHandler","getUserMode","shiftKey","firstLigatureHalf","secondLigatureHalf","ncIndex","firstUse","assert","secondUse","navigator","userAgent","metaKey","ctrlKey","container","pt","createSVGPoint","clientX","clientY","transformMatrix","getScreenCTM","matrixTransform","inverse","selectedStaves","getStaffBBox","tan","dispatchEvent","MouseEvent","screenX","screenY","altKey","width","nv","dh","sel","initialX","initialY","panning","dragSelecting","canvas","dragSelectAction","userMode","nodeName","startDrag","mouse","initialP","currentPt","curX","curY","newX","newY","currentWidth","currentHeight","updateRect","rx","ry","lx","ly","node","ul","lr","transform","multiply","box","getBBox","height","resetTo","ExportedSet","ExportedMap","mangle","unmangle","Map$1","_store","Set$1","cloneBinaryObject","cloneArrayBuffer","webkitSlice","mangled","has","delete","Map","supportsMapAndSet","funcToString","objectCtorString","clone","newObject","toISOString","Blob","isBinaryObject","Ctor","isPlainObject","toPromise","func","usedCB","fulfill","resp","mesg","adapterFun","_closed","_destroyed","logArgs","origCallback","responseArgs","logApiCall","taskqueue","isReady","addTask","failed","pick","hasLocal","MAX_NUM_CONCURRENT_REQUESTS","identityFunction","formatResultForOpenRevsGet","ok","bulkGet","db","requests","docs","requestsById","request","numDocs","numDone","perDocResults","checkDone","results","allRequests","nextBatch","upTo","batch","docId","docIdx","docRequests","docOpts","open_revs","rev","formatResult","processBatch","localStorage","setItem","getItem","hasLocalStorage","Changes","attachBrowserEvents","guardedConsole","defaultBackOff","maxTimeout","random","randomNumber","explainError","status","dbName","inprogress","eventFunction","changesOpts","changes","seq","since","cancelled","onChange","notifyLocalWindows","notify","$inject_Object_assign","assign","nextSource","nextKey","PouchError","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","UNKNOWN_ERROR","BAD_ARG","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","IDB_ERROR","INVALID_REV","MISSING_STUB","createError","CustomPouchError","generateErrorFromResponse","filterChange","req","hasFilter","query_params","change","doc","filterReturn","tryFilter","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","isRemote","_remote","parseDesignDocFunctionName","normalizeDesignDocFunctionName","normalized","qName","qParser","parser","parseUri","encoded","$0","$1","$2","scopeEval","scope","upsert","diffFun","docRev","_rev","newDoc","updated","_id","put","tryAndPut","thisAtob","atob","thisBtoa","btoa","createBlob","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","getBlob","binaryStringToArrayBuffer","bin","binStringToBluffer","binString","b64ToBluffer","b64","readAsBinaryString","blob","reader","FileReader","hasBinaryString","onloadend","binary","arrayBufferToBinaryString","readAsArrayBuffer","blobToBinaryString","blobOrBuffer","blobToBase64","setImmediateShim","MD5_CHUNK_SIZE","appendBlob","sliceBlob","arrayBuffer","appendString","binaryMd5","inputIsString","chunkSize","chunks","ceil","currentChunk","loadNextChunk","done","rawToBase64","stringMd5","deterministic_revs","clonedDoc","_rev_tree","v4","uuid","winningRev","metadata","winningId","winningPos","winningDeleted","toVisit","rev_tree","tree","ids","branches","deleted","traverseRevTree","revs","newCtx","sortByPos","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","rootToLeaf","paths","history","sortByPos$1","insertSorted","item","comparator","mid","low","high","binarySearch","pathToTree","numStemmed","root","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","diff","candidateParents","trees","parentIdx","elementsLen","merge","newTree","stemmed","stemmedRevs","revHash","stem","getTrees","isDeleted","isLocalId","Changes$1","complete","ee","onDestroy","cancel","pending","lastSeq","isCancelled","tryCatchInChangeListener","validateChanges","processChange","changeList","_conflicts","left","right","yankError","compareByIdThenRev","idCompare","_revisions","AbstractPouchDB","TaskQueue","PouchDB","__opts","auto_compaction","prefix","backend","adapter","adapters","preferredAdapters","adapterName","use_prefix","parseAdapter","_adapter","fail","onDestroyed","from_constructor","onClosed","prepareForDestruction","ready","_changesFilterPlugin","validate","doChanges","continuous","live","normalize","shouldFilter","descending","newPromise","_changes","update_seq","post","bulkDocs","_putLocal","_deleted","_removeLocal","oldRevId","newRevNum","newRevId","putDoc","_put","new_edits","force","putAttachment","attachmentId","rev$$1","api","createAttachment","prevrevpos","content_type","revpos","removeAttachment","docOrId","optsOrRev","was_delete","revsDiff","missing","addToMissing","revId","_getRevisionTree","missingForId","processDoc","missingObj","compactDocument","maxHeight","revTree","edges","prnt","edge","computeHeight","candidates","_doCompaction","compact","_compactionQueue","doNextCompaction","catch","last_seq","_compact","return_docs","promises","row","all","_getLocal","finishOpenRevs","latest","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","indexOfRev","howMany","_revs_info","_getAttachment","getAttachment","allDocs","skip","start_key","startkey","end_key","endkey","incompatibleOpt","allDocsKeysParse","_allDocs","close","_close","_info","db_name","_type","attachmentError","attachmentNameError","atts","cleanDocs","_bulkDocs","registerDependentDatabase","dependentDb","depDB","dependentDbs","usePrefix","destroyDb","localDoc","deletedMap","trueName","execute","AbortController","abort","f$1","fetch","Headers","eventEmitter","Pouch","destructListeners","_destructionListeners","dbList","setUpEventEmitter","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","getFieldFromDoc","parsedField","parseField","fieldName","fields","ch","combinationFields","isCombinationalField","field","getKey","mergeAndedSelectors","selectors","matcher","$eq","fieldMatchers","operator","$gte","$gt","mergeGtGte","$lte","$lt","mergeLtLte","$ne","mergeNe","mergeEq","massageSelector","wasAnded","isAndInSelector","isAnd","mergeAndedSelectorsNested","orOrNor","subSelector","MIN_MAGNITUDE","MAGNITUDE_DIGITS","SEP","collate","normalizeKey","ai","collationIndex","bi","stringCollate","arrayCollate","ak","bk","objectCollate","origKey","indexify","expFormat","toExponential","magnitude","neg","magString","padWith","upToLength","padding","targetLength","factor","factorStr","toFixed","numToIndexableString","toIndexableString","objKey","parseNumber","originalIdx","numAsString","magAsString","metaStack","lastMetaElement","lastElementIndex","filterInMemoryFields","rows","requestDef","inMemoryFields","rowFilter","fieldSorter","getFieldValuesAsArray","sorting","aRow","bRow","collation","createFieldSorter","docFieldValue","some","orMatchers","find","matchCominationalSelector","matchSelector","userOperator","userValue","matchers","fieldExists","fieldIsNotUndefined","arrayContainsValue","divisor","mod","modField","neValue","arraySize","arrayContainsAllValues","regexMatch","typeMatch","filterName","changesHandler","doc_ids","viewName","ddoc","mapFun","views","rowsMatched","matchesSelector","filterFun","filters","toObject","reservedWords","dataWords","parseRevisionInfo","parseDoc","newEdits","dbOpts","nRevNum","revInfo","revisions","revisionIds","makeRevTreeFromRevisions","specialKey","preprocessString","blobType","asBinary","parseBase64","digest","preprocessAttachment","md5","preprocessBlob","updateDoc","revLimit","docInfo","writeDoc","splitRev","targetPos","targetId","revExists","previousWinningRev","previouslyDeleted","isRoot","newRev","rev_map","winningRev$$1","winningRevIsDeleted","delta","processDocs","docInfos","fetchedDocs","tx","overallCallback","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","resultsIdx","docWritten","nextDoc","rootIsMissing","insertDoc","ADAPTER_VERSION","DOC_STORE","BY_SEQ_STORE","ATTACH_STORE","ATTACH_AND_SEQ_STORE","META_STORE","LOCAL_STORE","DETECT_BLOB_SUPPORT_STORE","safeJsonStringify","json","idbError","encodeMetadata","deletedOrLocal","decodeMetadata","storedObject","safeJsonParse","decodeDoc","_doc_id_rev","readBlobData","asBlob","fetchAttachmentsIfNecessary","txn","attObj","objectStore","onsuccess","fetchAttachment","postProcessAttachments","attNames","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","IDBKeyRange","bound","deleteOrphanedAttachments","openCursor","only","cursor","digestSeq","primaryKey","continue","openTransactionSafely","idb","stores","transaction","idbBulkDocs","docStore","bySeqStore","attachStore","attachAndSeqStore","metaStore","docInfoError","metaDoc","allDocsProcessed","docCountDelta","preconditionErrored","_meta","blobSupport","onAllDocsProcessed","updateDocCountIfReady","docCount","newRevIsDeleted","isUpdate","collectResults","finishDoc","attachmentSaved","newAtt","saveAttachment","writeAttachments","afterPutDoc","revsToDelete","compactTree","metadataToStore","afterPutMetadata","attsAdded","attsToAdd","onerror","insertAttachmentMappings","putReq","overallErr","docv","recv","processedAttachment","preprocessAttachments","txnResult","onabort","ontimeout","oncomplete","digests","filename","verifyAttachment","attErr","verifyAttachments","numFetched","revs_limit","readMetadata","fetchExistingDocs","startTransaction","runBatchedCursor","keyRange","batchSize","onBatch","keysBatch","valuesBatch","pseudoCursor","onGetAll","onGetAllKeys","onCursor","getAll","getAllKeys","newKeyRange","lastKey","upper","upperOpen","lowerBound","idbAllDocs","keyRangeError","inclusiveEnd","inclusive_end","upperBound","createKeyRange","onResultsReady","updateSeq","onSuccess","docIdRevIndex","allDocsInner","fetchDocAsynchronously","batchValues","batchValue","batchKeys","returnVal","total_rows","maxKey","allDocsKeys","running","applyNext","docIds","numResults","docIdsToMetadata","onGetMetadata","docIdRev","objectStores","winningDocs","metadatas","fetchWinningDocAndMetadata","winningDoc","processMetadataAndWinningDoc","onBatchDone","filtered","blobSupportPromise","cachedDBs","openReqList","IdbPouch","tryCode","enqueueTask","thisCallback","addDeletedOrLocalIndex","createIndex","unique","migrateLocalStore","localStore","local","range","seqCursor","migrateAttsAndSeqs","digestMap","migrateMetadata","onGetMetadataSeq","metadataSeq","fetchMetadataSeq","instanceId","reqOpts","historyNode","attachId","attachment","blobData","doc_count","idb_attachment_format","oldRev","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","createObjectStore","keyPath","autoIncrement","createSchema","currentTarget","createLocalStoreSchema","addAttachAndSeqStore","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","countDocs","blob$$1","matchedChrome","matchedEdge","checkBlobSupport","CHANGES_BATCH_SIZE","MAX_SIMULTANEOUS_REVS","CHANGES_TIMEOUT_BUFFER","DEFAULT_HEARTBEAT","supportsBulkGetMap","readAttachmentsAsBlobOrBuffer","encodeDocId","preprocessAttachments$1","getHost","hasUrlPrefix","user","password","username","genDBUrl","genUrl","pathDel","paramsToStr","params","HttpPouch","dbUrl","setupPromise","ourFetch","headers","credentials","nAuth","token","ua","isIE","isTrident","isEdge","isGET","shouldCacheBust","now","adapterFun$$1","setup","fetchJSON","response","skip_setup","encodeAttachmentId","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","filenames","promiseFactories","doNext","runNextBatch","onError","thisErr","pool","fetchData","docOrDocs","contentType","paramStr","batch_size","heartbeat","requestTimeout","leftToFetch","feed","seq_interval","param_name","lastFetchedSeq","controller","aborted","fetchOpts","signal","fetched","raw_results_length","QueryParseError","NotFoundError","BuiltInError","promisedCallback","sequentialize","promiseFactory","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","evalFunctionWithEval","TaskQueue$1","createView","sourceDB","reduceFun","temporary","localDocName","cachedViews","viewSignature","createViewSignature","_cachedViews","promiseForView","depDbName","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","CHANGES_BATCH_SIZE$1","parseViewName","emitError","builtInReduce","_sum","_count","_stats","sumsqr","_sumsqr","abstract","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","sortByKeyThenValue","keyCompare","sliceResults","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","checkQueryParseError","startkeyName","endkeyName","group_level","optionName","checkPositiveInteger","defaultsTo","getDocsToPersist","docIdsToChangesAndEmits","metaDocId","defaultMetaDoc","docData","indexableKeysToKeyValues","isGenOne","getKeyValueDocs","kvDocsRes","kvDocs","oldKeys","keyValue","newKeys","kvDoc","processKeyValueDocs","getQueue","updateView","mapResults","currentSeq","listOfDocsToPersist","docsToPersist","saveKeyValues","processNextBatch","createIndexableKeysToKeyValues","createDocIdsToChangesAndEmits","emittedKeyValue","complexKey","updateViewInQueue","queryView","totalRows","shouldReduce","fetchFromView","viewOpts","expectedKeys","parsedKeyAndDocId","parsedNum","parsedStr","arrayElement","objElement","parseIndexableString","onMapResultsReady","finalResults","shouldGroup","lvl","POSITIVE_INFINITY","groupKey","reduceTry","reduceView","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","queryViewInQueue","queryPromised","_query","customQuery","keysAsString","httpQuery","finalPromiseFactory","designDocName","stale","coerceOptions","viewCleanup","_viewCleanup","customViewCleanup","httpViewCleanup","docsToViews","viewsToStatus","ddocName","viewDBNames","statusIsGood","viewDBName","destroyPromises","localViewCleanup","createAbstractMapReduce","origMap","reduceFunString","builtIn","getBuiltIn","mapreduce","isGenOne$1","getDocAttachments","getDocs","diffs","resultDocs","fetchRevisionOneDocs","hasConflicts","bulkGetOpts","missingRev","createBulkGetOpts","bulkGetResponse","bulkGetInfo","remoteDoc","doCheckForLocalAttachments","fileHasChanged","getDocAttachmentsFromTargetOrSource","Boolean","CHECKPOINT_VERSION","REPLICATOR","CHECKPOINT_HISTORY_SIZE","LOWEST_SEQ","updateCheckpoint","checkpoint","session","returnValue","session_id","replicator","Checkpointer","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","srcDoc","tgtDoc","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","T","targetRest","sourceId","hasSessionId","compareReplicationLogs","sessionId","props","getCheckpoint","STARTING_BACK_OFF","generateReplicationId","queryParams","filterViewName","sortObjectPropertiesByKey","queryData","md5sum","replicate","currentBatch","repId","checkpointer","batches","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","changedDocs","start_time","docs_read","docs_written","doc_write_failures","initCheckpointer","checkpointOpts","writeDocs","bulkOpts","completeReplication","errorsById","errorsNo","errorName","finishBatch","outResult","getChanges","onCheckpointError","getBatchDocs","got","startNextBatch","abortReplication","processPendingBatch","immediate$$1","fatalError","end_time","retry","back_off_function","backOffSet","current_back_off","backOff","onChangesComplete","onChangesError","_abortChanges","abortChanges","startChanges","_addedListeners","Replication","toPouch","PouchConstructor","replicateWrapper","replicateRet","Sync","canceled","optsPush","optsPull","pull","pullChange","direction","pushChange","pushDenied","pullDenied","pushPaused","pullPaused","pushActive","pullActive","removed","removeAll","addOneListener","success","_readyCalled","replicateMethods","other","parseManifest","manifest","NeumeEdit","TextEdit","TextView","prepareEditMode","textView","View","Display","image","core","Info","setupEdit","initDb","delay","pageNo","getCurrentPage","changePage","redo","undo","pageURI","elementID","updateDatabase","getAnnotations","readAsDataURL","deleteDb","getMEI","mei","getSVG","v1","arrayPrefix","objPrefix","numChar","parsedString","lastCh","numConsecutiveSlashes","className","handleZoom","displayControlsPanel","addUpdateCallback","updateVisualization","DisplayControls","setZoomControls","initDisplayControls","setOpacityFromSlider","updateCallbacks","divaReady","diva","Diva","objectData","minHeight","indexMap","disableDragScrollable","displayPanel","loadDelay","initDivaEvents","setViewEventHandlers","onresize","innerHeight","innerWidth","Events","subscribe","settings","ID","didLoad","adjustZoom","pageIndex","checkAndLoad","page","getPageSVG","svg","updateSVG","containerId","pageIndexes","getActivePageIndex","zoomDuration","firstChild","inner","dimensions","getPageDimensionsAtCurrentZoomLevel","viewHandler","_viewerCore","getPageRegion","includePadding","incorporateViewport","marginLeft","getComputedStyle","getPropertyValue","top","setDisplayListeners","findIndex","visibility","clear","sequence","sequences","canvases","itemTitle","pages","panel","createElementNS","bg","setAttributeNS","replaceChild","resetTransformations","_page","_delay","restoreTransformation","setSelectListeners","touches","scrollZoom","newHeight","initEditModeControls","insertHandler","bindInsertTabs","click","Select","setSelectHelperObjects","initInsertEditControls","editMenu","backgroundColor","setSelectStrokeWidth","initSelectionButtons","setHighlightSelectionControls","isInsertMode","clickSelect","dragSelect","neumeGroups","updateInfoVisibility","neumeInfo","setInfoControls","block","label","resetInfoListeners","updateInfo","stopListeners","elementClass","attributes","ncs","getContour","ligated","pitches","getPitches","updateInfoModule","pitchNameToNum","innerText","pname","cont","entries","notificationSent","textLabel","bboxLabel","textButton","bboxButton","setTextViewControls","updateTextViewVisibility","updateBBoxViewVisibility","initSelectByBBoxButton","sylText","getSylText","initTextEdit","lyrics","selBySylListener","addBBoxListeners","updateSylText","button","orig","corrected","prompt","zip","array1","array2","et","register_namespace","staffBasedMei","meiTree","meiTag","getroot","section","findall","newStaff","Element","SubElement","getchildren","layer","sb","tag","syllableId","_children","sectionId","indent","sbBasedMei","staffStore","sbIndexes","sbIndex","attrib","custos","lastStaff","lastIndex","getSlice","stavesAdded","staffIndex","newLayer","newSyllableId","newSyllable","oldSyllableContent","syllableAttrib","layerAttrib","layerContent","utils","ElementPath","TreeBuilder","get_parser","constants","element_ids","Comment","CData","ProcessingInstruction","QName","text_or_uri","ElementTree","_root","makeelement","delItem","stop","setSlice","delSlice","extend","insert","findtext","defvalue","iter","itertext","_setroot","DEFAULT_PARSER","XMLParser","xml_declaration","default_namespace","_serialize_text","qnames","namespaces","indent_string","add_qname","qname","_namespace_map","_namespaces","_serialize_xml","newlines","_escape_cdata","_escape_text","_escape_attrib","_escape","isAttribute","isText","PI","XML","tostring","ignored","rv","matches","attrname","element_factory","_data","_elem","_last","_tail","_factory","_flush","attrs","ReadableState","EElistenerCount","debugUtil","debug","BufferList","kProxyEvents","readableObjectMode","readableHwm","readableHighWaterMark","pipes","pipesCount","flowing","endEmitted","reading","needReadable","emittedReadable","readableListening","resumeScheduled","awaitDrain","readingMore","decoder","_read","readableAddChunk","addToFront","skipChunkCheck","emitReadable","onEofChunk","chunkInvalid","addChunk","maybeReadMore","needMoreData","isPaused","setEncoding","MAX_HWM","howMuchToRead","head","computeNewHighWaterMark","emitReadable_","flow","maybeReadMore_","nReadingNextTick","resume_","fromList","hasStrings","copyFromBufferString","copyFromBuffer","fromListPartial","endReadable","endReadableNT","xs","nOrig","doRead","dest","pipeOpts","endFn","stdout","stderr","unpipe","onunpipe","unpipeInfo","hasUnpiped","onclose","onfinish","ondrain","ondata","cleanedUp","pipeOnDrain","increasedAwaitDrain","pause","resume","dests","ev","wrap","paused","_fromList","emitErrorNT","readableDestroyed","writableDestroyed","afterTransform","ts","_transformState","transforming","writechunk","rs","needTransform","writeencoding","_transform","flush","_this2","err2","msCrypto","rnds8","rnds","byteToHex","bth","activate","insertActive","deactivate","editMode","initEditMode","tabIds","tab","selectedOption","insertDisabled","bindElements","toggleInsert","toggleEdit","insertContents","editContents","selBySyl","selByNeume","selByNc","selByStaff","selectBySylHandler","selectByNeumeHandler","selectByNcHandler","selectByStaffHandler","groupingAction","getChildrenIds","getIds","syllable0","syllable1","secondSyllable","groupType","neumeParent","Warnings","groupingNotRecognized","childrenIds","PointNames","TopLeft","Top","TopRight","Right","BottomRight","Bottom","BottomLeft","Left","initialPoint","initialUly","initialLry","whichSkewPoint","initialRectY","polyLen","initialSkew","redraw","points","sin","pointString","pointName","point","pointStringRight","pointStringLeft","drawInitialRect","whichPoint","viewportElement","resizeStart","resizeDrag","resizeEnd","skewStart","temp","tempSkew","skewEnd","which","polygon","currentPoint","firstClick","removeInsertClickHandlers","keydownListener","resetInsertHandler","clickawayHandler","insertMenu","staffHandler","cursorpt","coord","buttonId","alreadyInInsertMode","editModeButton","getGetParam","manifestLocation","storage","statusText","Response","location","annotations","verovioWrapper","Validation","undoStacks","redoStacks","neonCache","DOMParser","blankPages","mei_annotations","lastPageLoaded","annotation","getTime","newAnnotation","loadData","blankPage","convertSbToStaff","dirty","sendForValidation","handle","parseFromString","loadPage","currentMEI","updateCache","svgText","meiPromise","svgPromise","updateTimestamp","pair","SyntaxError","_cache","RE","xpath_tokenizer","ops","parent_map","_SelectorContext","getToken","resultElements","parsers","sax","onopentag","_handleOpenTag","ontext","_handleText","oncdata","_handleCdata","ondoctype","_handleDoctype","oncomment","_handleComment","onclosetag","_handleCloseTag","_handleError","comment","strict","opt","SAXParser","SAXStream","createStream","MAX_BUFFER_LENGTH","buffers","clearBuffers","q","bufferCheckPosition","lowercase","lowercasetags","looseCase","tags","closed","closedRoot","sawRoot","noscript","BEGIN","strictEntities","ENTITIES","XML_ENTITIES","attribList","xmlns","rootNS","trackPosition","column","EVENTS","F","BEGIN_WHITESPACE","beginWhiteSpace","TEXT","starti","textNode","whitespace","strictFail","TEXT_ENTITY","OPEN_WAKA","startTagPosition","SCRIPT","SCRIPT_ENDING","script","CLOSE_TAG","SGML_DECL","sgmlDecl","is","nameStart","OPEN_TAG","PROC_INST","procInstName","procInstBody","CDATA","emitNode","cdata","COMMENT","DOCTYPE","doctype","quote","SGML_DECL_QUOTED","DOCTYPE_DTD","DOCTYPE_QUOTED","DOCTYPE_DTD_QUOTED","COMMENT_ENDING","COMMENT_ENDED","textopts","CDATA_ENDING","CDATA_ENDING_2","PROC_INST_ENDING","PROC_INST_BODY","nameBody","newTag","openTag","OPEN_TAG_SLASH","ATTRIB","closeTag","attribName","attribValue","ATTRIB_NAME","ATTRIB_VALUE","ATTRIB_NAME_SAW_WHITE","ATTRIB_VALUE_QUOTED","ATTRIB_VALUE_UNQUOTED","ATTRIB_VALUE_ENTITY_Q","ATTRIB_VALUE_CLOSED","attribEnd","ATTRIB_VALUE_ENTITY_U","CLOSE_TAG_SAW_WHITE","returnState","parseEntity","entity","entityBody","entityStart","maxAllowed","maxActual","closeText","checkBufferLength","ex","streamWraps","_parser","me","_decoder","SD","letter","XML_NAMESPACE","XMLNS_NAMESPACE","xml","charClass","charclass","stringFromCharCode","fromCodePoint","STATE","COMMENT_STARTING","nodeType","attribute","qualName","qn","selfClosing","isSelfClosing","closeTo","entityLC","numStr","highSurrogate","lowSurrogate","MAX_SIZE","codeUnits","lens","getLens","validLen","placeHoldersLen","Arr","_byteLength","curByte","revLookup","uint8","extraBytes","len2","encodeChunk","lookup","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","rt","LN2","EE","_isStdio","didOnEnd","cleanup","Constructor","_classCallCheck","Timeout","clearFn","_clearFn","setInterval","clearInterval","unref","enroll","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","clearImmediate","registerImmediate","html","messagePrefix","onGlobalMessage","nextHandle","tasksByHandle","currentlyRunningATask","attachTo","runIfPresent","importScripts","postMessageIsAsynchronous","oldOnMessage","canUsePostMessage","attachEvent","config","schemaResponse","worker","statusField","updateUI","link","panelBlock","pNotif","Worker","meiData","verovioWorker","_nodeId","_clockseq","rng","bytesToUuid","_lastMSecs","_lastNSecs","clockseq","seedBytes","nsecs","dt","tl","tmh","ii","NeonSchema","NeonContext","manifestString","Validator","unresolvedRefs","types","validators","shouldResolve","addSchema","ourUri","addSubSchemaArray","addSubSchema","addSubSchemaObject","setSchemas","getSchema","urn","sch","validateSchema","switchSchema","schemaobj","schemaTraverser","superResolve","resolved","subctx","subschema","skipAttributes","ignoreProperties","validatorErr","allowUnknownAttributes","rewrite","fragment","testType","integer","boolean","date","any","freeGlobal","maxInt","tMin","tMax","damp","initialBias","initialN","delimiter","regexPunycode","regexNonASCII","regexSeparators","baseMinusTMin","mapDomain","ucs2decode","extra","counter","ucs2encode","digitToBasic","digit","flag","adapt","numPoints","firstTime","decode","basic","oldi","baseMinusT","inputLength","bias","encode","handledCPCount","basicLength","currentValue","handledCPCountPlusOne","qMinusT","webpackPolyfill","qs","sep","eq","maxKeys","kstr","vstr","stringifyPrimitive","ks","testSchemaNoThrow","testAdditionalProperty","preValidateProperty","nestedErrors","minProperties","maxProperties","minimum","exclusiveMinimum","maximum","exclusiveMaximum","validateMultipleOfOrDivisbleBy","validationType","errorMessage","validationArgument","instanceDecimals","divisorDecimals","maxDecimals","multiplier","testArrays","multipleOf","divisibleBy","required","minLength","hsp","maxLength","minItems","maxItems","uniqueItems","dep","childContext","notTypes","schemaId","startEditMode","navbarDropdownMenu","undoRedoPanel","initNavbar","initUndoRedoPanel","selectionHighlight","divider","save","export","download","confirm","reload","getPageMEI","convertStaffToSb","getPageName","undoHandler","redoHandler","editItem","editButton","fileLink","navbarContents","navbarFinalize","ViewBox","imageWidth","imageHeight","z","zoomHeight","zoomWidth","ZoomHandler","bgimg","viewBox","updateViewBox","getViewBox","translate","rawViewBox","dragCoordinates","matrix","newCoordinates","deltaX","deltaY","newTransform","dragTransform","slider","newK","getZoom","cursorPt","splitDisable","capture","resetHandler"],"mappings":"aACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QAKfF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,I,+BC3DrD,IAOIC,EAPAC,EAAuB,iBAAZC,QAAuBA,QAAU,KAC5CC,EAAeF,GAAwB,mBAAZA,EAAEG,MAC7BH,EAAEG,MACF,SAAsBC,EAAQC,EAAUC,GACxC,OAAOC,SAASZ,UAAUQ,MAAMjC,KAAKkC,EAAQC,EAAUC,IAKzDP,EADEC,GAA0B,mBAAdA,EAAEQ,QACCR,EAAEQ,QACV/B,OAAOgC,sBACC,SAAwBL,GACvC,OAAO3B,OAAOiC,oBAAoBN,GAC/BO,OAAOlC,OAAOgC,sBAAsBL,KAGxB,SAAwBA,GACvC,OAAO3B,OAAOiC,oBAAoBN,IAQtC,IAAIQ,EAAcC,OAAOC,OAAS,SAAqB9B,GACrD,OAAOA,GAAUA,GAGnB,SAAS+B,IACPA,EAAaC,KAAK9C,KAAK+C,MAEzBnD,EAAOD,QAAUkD,EAGjBA,EAAaA,aAAeA,EAE5BA,EAAapB,UAAUuB,aAAUC,EACjCJ,EAAapB,UAAUyB,aAAe,EACtCL,EAAapB,UAAU0B,mBAAgBF,EAIvC,IAAIG,EAAsB,GAoC1B,SAASC,EAAiBC,GACxB,YAA2BL,IAAvBK,EAAKH,cACAN,EAAaO,oBACfE,EAAKH,cAmDd,SAASI,EAAarB,EAAQsB,EAAMC,EAAUC,GAC5C,IAAIzD,EACA0D,EACAC,EAnHsBC,EAqH1B,GAAwB,mBAAbJ,EACT,MAAM,IAAIK,UAAU,0EAA4EL,GAqBlG,QAjBeR,KADfU,EAASzB,EAAOc,UAEdW,EAASzB,EAAOc,QAAUzC,OAAOY,OAAO,MACxCe,EAAOgB,aAAe,SAIKD,IAAvBU,EAAOI,cACT7B,EAAO8B,KAAK,cAAeR,EACfC,EAASA,SAAWA,EAASA,SAAWA,GAIpDE,EAASzB,EAAOc,SAElBY,EAAWD,EAAOH,SAGHP,IAAbW,EAEFA,EAAWD,EAAOH,GAAQC,IACxBvB,EAAOgB,kBAeT,GAbwB,mBAAbU,EAETA,EAAWD,EAAOH,GAChBE,EAAU,CAACD,EAAUG,GAAY,CAACA,EAAUH,GAErCC,EACTE,EAASK,QAAQR,GAEjBG,EAASM,KAAKT,IAIhBxD,EAAIoD,EAAiBnB,IACb,GAAK0B,EAASO,OAASlE,IAAM2D,EAASQ,OAAQ,CACpDR,EAASQ,QAAS,EAGlB,IAAIC,EAAI,IAAIC,MAAM,+CACEV,EAASO,OAAS,IAAMI,OAAOf,GAAQ,qEAG3Da,EAAEjE,KAAO,8BACTiE,EAAEG,QAAUtC,EACZmC,EAAEb,KAAOA,EACTa,EAAEI,MAAQb,EAASO,OAxKGN,EAyKHQ,EAxKnBK,SAAWA,QAAQC,MAAMD,QAAQC,KAAKd,GA4K1C,OAAO3B,EAwBT,SAAS0C,EAAU1C,EAAQsB,EAAMC,GAC/B,IAAIoB,EAAQ,CAAEC,OAAO,EAAOC,YAAQ9B,EAAWf,OAAQA,EAAQsB,KAAMA,EAAMC,SAAUA,GACjFuB,EAZN,WAEE,IADA,IAAI5C,EAAO,GACFvC,EAAI,EAAGA,EAAIoF,UAAUd,OAAQtE,IAAKuC,EAAK8B,KAAKe,UAAUpF,IAC1DkD,KAAK+B,QACR/B,KAAKb,OAAOgD,eAAenC,KAAKS,KAAMT,KAAKgC,QAC3ChC,KAAK+B,OAAQ,EACb9C,EAAae,KAAKU,SAAUV,KAAKb,OAAQE,KAMjBf,KAAKwD,GAG/B,OAFAG,EAAQvB,SAAWA,EACnBoB,EAAME,OAASC,EACRA,EAgIT,SAASG,EAAWjD,EAAQsB,EAAM4B,GAChC,IAAIzB,EAASzB,EAAOc,QAEpB,QAAeC,IAAXU,EACF,MAAO,GAET,IAAI0B,EAAa1B,EAAOH,GACxB,YAAmBP,IAAfoC,EACK,GAEiB,mBAAfA,EACFD,EAAS,CAACC,EAAW5B,UAAY4B,GAAc,CAACA,GAElDD,EAsDT,SAAyBE,GAEvB,IADA,IAAIC,EAAM,IAAIC,MAAMF,EAAInB,QACftE,EAAI,EAAGA,EAAI0F,EAAIpB,SAAUtE,EAChC0F,EAAI1F,GAAKyF,EAAIzF,GAAG4D,UAAY6B,EAAIzF,GAElC,OAAO0F,EA1DLE,CAAgBJ,GAAcK,EAAWL,EAAYA,EAAWlB,QAoBpE,SAASwB,EAAcnC,GACrB,IAAIG,EAASZ,KAAKC,QAElB,QAAeC,IAAXU,EAAsB,CACxB,IAAI0B,EAAa1B,EAAOH,GAExB,GAA0B,mBAAf6B,EACT,OAAO,EACF,QAAmBpC,IAAfoC,EACT,OAAOA,EAAWlB,OAItB,OAAO,EAOT,SAASuB,EAAWJ,EAAKhE,GAEvB,IADA,IAAIsE,EAAO,IAAIJ,MAAMlE,GACZzB,EAAI,EAAGA,EAAIyB,IAAKzB,EACvB+F,EAAK/F,GAAKyF,EAAIzF,GAChB,OAAO+F,EA5WTrF,OAAOC,eAAeqC,EAAc,sBAAuB,CACzDpC,YAAY,EACZC,IAAK,WACH,OAAO0C,GAETyC,IAAK,SAASC,GACZ,GAAmB,iBAARA,GAAoBA,EAAM,GAAKpD,EAAYoD,GACpD,MAAM,IAAIC,WAAW,kGAAoGD,EAAM,KAEjI1C,EAAsB0C,KAI1BjD,EAAaC,KAAO,gBAEGG,IAAjBF,KAAKC,SACLD,KAAKC,UAAYzC,OAAOyF,eAAejD,MAAMC,UAC/CD,KAAKC,QAAUzC,OAAOY,OAAO,MAC7B4B,KAAKG,aAAe,GAGtBH,KAAKI,cAAgBJ,KAAKI,oBAAiBF,GAK7CJ,EAAapB,UAAUwE,gBAAkB,SAAyB3E,GAChE,GAAiB,iBAANA,GAAkBA,EAAI,GAAKoB,EAAYpB,GAChD,MAAM,IAAIyE,WAAW,gFAAkFzE,EAAI,KAG7G,OADAyB,KAAKI,cAAgB7B,EACdyB,MASTF,EAAapB,UAAUyE,gBAAkB,WACvC,OAAO7C,EAAiBN,OAG1BF,EAAapB,UAAUuC,KAAO,SAAcR,GAE1C,IADA,IAAIpB,EAAO,GACFvC,EAAI,EAAGA,EAAIoF,UAAUd,OAAQtE,IAAKuC,EAAK8B,KAAKe,UAAUpF,IAC/D,IAAIsG,EAAoB,UAAT3C,EAEXG,EAASZ,KAAKC,QAClB,QAAeC,IAAXU,EACFwC,EAAWA,QAA4BlD,IAAjBU,EAAOyC,WAC1B,IAAKD,EACR,OAAO,EAGT,GAAIA,EAAS,CACX,IAAIE,EAGJ,GAFIjE,EAAK+B,OAAS,IAChBkC,EAAKjE,EAAK,IACRiE,aAAc/B,MAGhB,MAAM+B,EAGR,IAAIC,EAAM,IAAIhC,MAAM,oBAAsB+B,EAAK,KAAOA,EAAGE,QAAU,IAAM,KAEzE,MADAD,EAAIE,QAAUH,EACRC,EAGR,IAAIG,EAAU9C,EAAOH,GAErB,QAAgBP,IAAZwD,EACF,OAAO,EAET,GAAuB,mBAAZA,EACTzE,EAAayE,EAAS1D,KAAMX,OAE5B,KAAIsE,EAAMD,EAAQtC,OACdwC,EAAYjB,EAAWe,EAASC,GACpC,IAAS7G,EAAI,EAAGA,EAAI6G,IAAO7G,EACzBmC,EAAa2E,EAAU9G,GAAIkD,KAAMX,GAGrC,OAAO,GAmETS,EAAapB,UAAUmF,YAAc,SAAqBpD,EAAMC,GAC9D,OAAOF,EAAaR,KAAMS,EAAMC,GAAU,IAG5CZ,EAAapB,UAAUoF,GAAKhE,EAAapB,UAAUmF,YAEnD/D,EAAapB,UAAUqF,gBACnB,SAAyBtD,EAAMC,GAC7B,OAAOF,EAAaR,KAAMS,EAAMC,GAAU,IAqBhDZ,EAAapB,UAAUsF,KAAO,SAAcvD,EAAMC,GAChD,GAAwB,mBAAbA,EACT,MAAM,IAAIK,UAAU,0EAA4EL,GAGlG,OADAV,KAAK8D,GAAGrD,EAAMoB,EAAU7B,KAAMS,EAAMC,IAC7BV,MAGTF,EAAapB,UAAUuF,oBACnB,SAA6BxD,EAAMC,GACjC,GAAwB,mBAAbA,EACT,MAAM,IAAIK,UAAU,0EAA4EL,GAGlG,OADAV,KAAK+D,gBAAgBtD,EAAMoB,EAAU7B,KAAMS,EAAMC,IAC1CV,MAIbF,EAAapB,UAAUyD,eACnB,SAAwB1B,EAAMC,GAC5B,IAAIwD,EAAMtD,EAAQuD,EAAUrH,EAAGsH,EAE/B,GAAwB,mBAAb1D,EACT,MAAM,IAAIK,UAAU,0EAA4EL,GAIlG,QAAeR,KADfU,EAASZ,KAAKC,SAEZ,OAAOD,KAGT,QAAaE,KADbgE,EAAOtD,EAAOH,IAEZ,OAAOT,KAET,GAAIkE,IAASxD,GAAYwD,EAAKxD,WAAaA,EACb,KAAtBV,KAAKG,aACTH,KAAKC,QAAUzC,OAAOY,OAAO,cAEtBwC,EAAOH,GACVG,EAAOuB,gBACTnC,KAAKiB,KAAK,iBAAkBR,EAAMyD,EAAKxD,UAAYA,SAElD,GAAoB,mBAATwD,EAAqB,CAGrC,IAFAC,GAAY,EAEPrH,EAAIoH,EAAK9C,OAAS,EAAGtE,GAAK,EAAGA,IAChC,GAAIoH,EAAKpH,KAAO4D,GAAYwD,EAAKpH,GAAG4D,WAAaA,EAAU,CACzD0D,EAAmBF,EAAKpH,GAAG4D,SAC3ByD,EAAWrH,EACX,MAIJ,GAAIqH,EAAW,EACb,OAAOnE,KAEQ,IAAbmE,EACFD,EAAKG,QAiIf,SAAmBH,EAAMI,GACvB,KAAOA,EAAQ,EAAIJ,EAAK9C,OAAQkD,IAC9BJ,EAAKI,GAASJ,EAAKI,EAAQ,GAC7BJ,EAAKK,MAlIGC,CAAUN,EAAMC,GAGE,IAAhBD,EAAK9C,SACPR,EAAOH,GAAQyD,EAAK,SAEQhE,IAA1BU,EAAOuB,gBACTnC,KAAKiB,KAAK,iBAAkBR,EAAM2D,GAAoB1D,GAG1D,OAAOV,MAGbF,EAAapB,UAAU+F,IAAM3E,EAAapB,UAAUyD,eAEpDrC,EAAapB,UAAUgG,mBACnB,SAA4BjE,GAC1B,IAAImD,EAAWhD,EAAQ9D,EAGvB,QAAeoD,KADfU,EAASZ,KAAKC,SAEZ,OAAOD,KAGT,QAA8BE,IAA1BU,EAAOuB,eAUT,OATyB,IAArBD,UAAUd,QACZpB,KAAKC,QAAUzC,OAAOY,OAAO,MAC7B4B,KAAKG,aAAe,QACMD,IAAjBU,EAAOH,KACY,KAAtBT,KAAKG,aACTH,KAAKC,QAAUzC,OAAOY,OAAO,aAEtBwC,EAAOH,IAEXT,KAIT,GAAyB,IAArBkC,UAAUd,OAAc,CAC1B,IACI/C,EADAsG,EAAOnH,OAAOmH,KAAK/D,GAEvB,IAAK9D,EAAI,EAAGA,EAAI6H,EAAKvD,SAAUtE,EAEjB,oBADZuB,EAAMsG,EAAK7H,KAEXkD,KAAK0E,mBAAmBrG,GAK1B,OAHA2B,KAAK0E,mBAAmB,kBACxB1E,KAAKC,QAAUzC,OAAOY,OAAO,MAC7B4B,KAAKG,aAAe,EACbH,KAKT,GAAyB,mBAFzB4D,EAAYhD,EAAOH,IAGjBT,KAAKmC,eAAe1B,EAAMmD,QACrB,QAAkB1D,IAAd0D,EAET,IAAK9G,EAAI8G,EAAUxC,OAAS,EAAGtE,GAAK,EAAGA,IACrCkD,KAAKmC,eAAe1B,EAAMmD,EAAU9G,IAIxC,OAAOkD,MAoBbF,EAAapB,UAAUkF,UAAY,SAAmBnD,GACpD,OAAO2B,EAAWpC,KAAMS,GAAM,IAGhCX,EAAapB,UAAUkG,aAAe,SAAsBnE,GAC1D,OAAO2B,EAAWpC,KAAMS,GAAM,IAGhCX,EAAa8C,cAAgB,SAASnB,EAAShB,GAC7C,MAAqC,mBAA1BgB,EAAQmB,cACVnB,EAAQmB,cAAcnC,GAEtBmC,EAAc3F,KAAKwE,EAAShB,IAIvCX,EAAapB,UAAUkE,cAAgBA,EAiBvC9C,EAAapB,UAAUmG,WAAa,WAClC,OAAO7E,KAAKG,aAAe,EAAIrB,EAAekB,KAAKC,SAAW,K,cCzanC,mBAAlBzC,OAAOY,OAEhBvB,EAAOD,QAAU,SAAkBkI,EAAMC,GACvCD,EAAKE,OAASD,EACdD,EAAKpG,UAAYlB,OAAOY,OAAO2G,EAAUrG,UAAW,CAClDuG,YAAa,CACXlH,MAAO+G,EACPpH,YAAY,EACZwH,UAAU,EACVC,cAAc,MAMpBtI,EAAOD,QAAU,SAAkBkI,EAAMC,GACvCD,EAAKE,OAASD,EACd,IAAIK,EAAW,aACfA,EAAS1G,UAAYqG,EAAUrG,UAC/BoG,EAAKpG,UAAY,IAAI0G,EACrBN,EAAKpG,UAAUuG,YAAcH,I,8BCpBjC,YACA,IAEIO,EAyCAC,EA3CAC,EAAWC,EAAOC,kBAAoBD,EAAOE,uBAK/C,GAAIH,EAAU,CACZ,IAAII,EAAS,EACTC,EAAW,IAAIL,EAASM,GACxBC,EAAUN,EAAOO,SAASC,eAAe,IAC7CJ,EAASK,QAAQH,EAAS,CACxBI,eAAe,IAEjBb,EAAgB,WACdS,EAAQK,KAAQR,IAAWA,EAAS,QAEjC,GAAKH,EAAOY,mBAAiD,IAA1BZ,EAAOa,eAO/ChB,EADS,aAAcG,GAAU,uBAAwBA,EAAOO,SAASO,cAAc,UACvE,WAId,IAAIC,EAAWf,EAAOO,SAASO,cAAc,UAC7CC,EAASC,mBAAqB,WAC5BX,IAEAU,EAASC,mBAAqB,KAC9BD,EAASE,WAAWC,YAAYH,GAChCA,EAAW,MAEbf,EAAOO,SAASY,gBAAgBC,YAAYL,IAG9B,WACdM,WAAWhB,EAAU,QAvBwD,CAC/E,IAAIiB,EAAU,IAAItB,EAAOa,eACzBS,EAAQC,MAAMC,UAAYnB,EAC1BR,EAAgB,WACdyB,EAAQG,MAAMC,YAAY,IAyBhC,IAAIC,EAAQ,GAEZ,SAAStB,IAEP,IAAI/I,EAAGsK,EADP9B,GAAW,EAGX,IADA,IAAI3B,EAAMwD,EAAM/F,OACTuC,GAAK,CAIV,IAHAyD,EAAWD,EACXA,EAAQ,GACRrK,GAAK,IACIA,EAAI6G,GACXyD,EAAStK,KAEX6G,EAAMwD,EAAM/F,OAEdkE,GAAW,EAGbzI,EAAOD,QACP,SAAmByK,GACQ,IAArBF,EAAMhG,KAAKkG,IAAgB/B,GAC7BD,O,+BClEJ,IAAIiC,EAGJA,EAAI,WACH,OAAOtH,KADJ,GAIJ,IAECsH,EAAIA,GAAK,IAAIhI,SAAS,cAAb,GACR,MAAOiI,GAEc,iBAAXC,SAAqBF,EAAIE,QAOrC3K,EAAOD,QAAU0K,G,6BCWjB,IAAIG,EAAM,EAAQ,IAIdC,EAAalK,OAAOmH,MAAQ,SAAUgD,GACxC,IAAIhD,EAAO,GACX,IAAK,IAAItG,KAAOsJ,EACdhD,EAAKxD,KAAK9C,GACX,OAAOsG,GAIV9H,EAAOD,QAAUgL,EAGjB,IAAIC,EAAO,EAAQ,IACnBA,EAAKC,SAAW,EAAQ,GAGxB,IAAIC,EAAW,EAAQ,IACnBC,EAAW,EAAQ,IAEvBH,EAAKC,SAASF,EAAQG,GAKpB,IADA,IAAIpD,EAAO+C,EAAWM,EAAStJ,WACtBuJ,EAAI,EAAGA,EAAItD,EAAKvD,OAAQ6G,IAAK,CACpC,IAAIC,EAASvD,EAAKsD,GACbL,EAAOlJ,UAAUwJ,KAASN,EAAOlJ,UAAUwJ,GAAUF,EAAStJ,UAAUwJ,IAIjF,SAASN,EAAOO,GACd,KAAMnI,gBAAgB4H,GAAS,OAAO,IAAIA,EAAOO,GAEjDJ,EAAS9K,KAAK+C,KAAMmI,GACpBH,EAAS/K,KAAK+C,KAAMmI,GAEhBA,IAAgC,IAArBA,EAAQC,WAAoBpI,KAAKoI,UAAW,GAEvDD,IAAgC,IAArBA,EAAQjD,WAAoBlF,KAAKkF,UAAW,GAE3DlF,KAAKqI,eAAgB,EACjBF,IAAqC,IAA1BA,EAAQE,gBAAyBrI,KAAKqI,eAAgB,GAErErI,KAAKgE,KAAK,MAAOsE,GAcnB,SAASA,IAGHtI,KAAKqI,eAAiBrI,KAAKuI,eAAeC,OAI9Cf,EAAI5B,SAAS4C,EAASzI,MAGxB,SAASyI,EAAQC,GACfA,EAAKC,MAtBPnL,OAAOC,eAAemK,EAAOlJ,UAAW,wBAAyB,CAI/DhB,YAAY,EACZC,IAAK,WACH,OAAOqC,KAAKuI,eAAeK,iBAmB/BpL,OAAOC,eAAemK,EAAOlJ,UAAW,YAAa,CACnDf,IAAK,WACH,YAA4BuC,IAAxBF,KAAK6I,qBAAwD3I,IAAxBF,KAAKuI,iBAGvCvI,KAAK6I,eAAeC,WAAa9I,KAAKuI,eAAeO,YAE9DhG,IAAK,SAAU/E,QAGemC,IAAxBF,KAAK6I,qBAAwD3I,IAAxBF,KAAKuI,iBAM9CvI,KAAK6I,eAAeC,UAAY/K,EAChCiC,KAAKuI,eAAeO,UAAY/K,MAIpC6J,EAAOlJ,UAAUqK,SAAW,SAAUxF,EAAKyF,GACzChJ,KAAKmB,KAAK,MACVnB,KAAK2I,MAELlB,EAAI5B,SAASmD,EAAIzF,K,cCjInB1G,EAAOD,QAAUqM,I,6BCEjBpM,EAAOD,QAEP,SAAmBsM,GACjB,OAAO,WACL,IAAIvF,EAAMzB,UAAUd,OACpB,GAAIuC,EAAK,CAGP,IAFA,IAAItE,EAAO,GACPvC,GAAK,IACAA,EAAI6G,GACXtE,EAAKvC,GAAKoF,UAAUpF,GAEtB,OAAOoM,EAAIjM,KAAK+C,KAAMX,GAEtB,OAAO6J,EAAIjM,KAAK+C,KAAM,O,cCd5B,IAOImJ,EACAC,EARAC,EAAUxM,EAAOD,QAAU,GAU/B,SAAS0M,IACL,MAAM,IAAI/H,MAAM,mCAEpB,SAASgI,IACL,MAAM,IAAIhI,MAAM,qCAsBpB,SAASiI,EAAWN,GAChB,GAAIC,IAAqBtC,WAErB,OAAOA,WAAWqC,EAAK,GAG3B,IAAKC,IAAqBG,IAAqBH,IAAqBtC,WAEhE,OADAsC,EAAmBtC,WACZA,WAAWqC,EAAK,GAE3B,IAEI,OAAOC,EAAiBD,EAAK,GAC/B,MAAM3B,GACJ,IAEI,OAAO4B,EAAiBlM,KAAK,KAAMiM,EAAK,GAC1C,MAAM3B,GAEJ,OAAO4B,EAAiBlM,KAAK+C,KAAMkJ,EAAK,MAvCnD,WACG,IAEQC,EADsB,mBAAftC,WACYA,WAEAyC,EAEzB,MAAO/B,GACL4B,EAAmBG,EAEvB,IAEQF,EADwB,mBAAjBK,aACcA,aAEAF,EAE3B,MAAOhC,GACL6B,EAAqBG,GAjB7B,GAwEA,IAEIG,EAFAvC,EAAQ,GACR7B,GAAW,EAEXqE,GAAc,EAElB,SAASC,IACAtE,GAAaoE,IAGlBpE,GAAW,EACPoE,EAAatI,OACb+F,EAAQuC,EAAahK,OAAOyH,GAE5BwC,GAAc,EAEdxC,EAAM/F,QACNyI,KAIR,SAASA,IACL,IAAIvE,EAAJ,CAGA,IAAIwE,EAAUN,EAAWI,GACzBtE,GAAW,EAGX,IADA,IAAI3B,EAAMwD,EAAM/F,OACVuC,GAAK,CAGP,IAFA+F,EAAevC,EACfA,EAAQ,KACCwC,EAAahG,GACd+F,GACAA,EAAaC,GAAYI,MAGjCJ,GAAc,EACdhG,EAAMwD,EAAM/F,OAEhBsI,EAAe,KACfpE,GAAW,EAnEf,SAAyB0E,GACrB,GAAIZ,IAAuBK,aAEvB,OAAOA,aAAaO,GAGxB,IAAKZ,IAAuBG,IAAwBH,IAAuBK,aAEvE,OADAL,EAAqBK,aACdA,aAAaO,GAExB,IAEWZ,EAAmBY,GAC5B,MAAOzC,GACL,IAEI,OAAO6B,EAAmBnM,KAAK,KAAM+M,GACvC,MAAOzC,GAGL,OAAO6B,EAAmBnM,KAAK+C,KAAMgK,KAgD7CC,CAAgBH,IAiBpB,SAASI,EAAKhB,EAAKiB,GACfnK,KAAKkJ,IAAMA,EACXlJ,KAAKmK,MAAQA,EAYjB,SAASC,KA5BTf,EAAQxD,SAAW,SAAUqD,GACzB,IAAI7J,EAAO,IAAIoD,MAAMP,UAAUd,OAAS,GACxC,GAAIc,UAAUd,OAAS,EACnB,IAAK,IAAItE,EAAI,EAAGA,EAAIoF,UAAUd,OAAQtE,IAClCuC,EAAKvC,EAAI,GAAKoF,UAAUpF,GAGhCqK,EAAMhG,KAAK,IAAI+I,EAAKhB,EAAK7J,IACJ,IAAjB8H,EAAM/F,QAAiBkE,GACvBkE,EAAWK,IASnBK,EAAKxL,UAAUqL,IAAM,WACjB/J,KAAKkJ,IAAIhK,MAAM,KAAMc,KAAKmK,QAE9Bd,EAAQgB,MAAQ,UAChBhB,EAAQiB,SAAU,EAClBjB,EAAQkB,IAAM,GACdlB,EAAQmB,KAAO,GACfnB,EAAQoB,QAAU,GAClBpB,EAAQqB,SAAW,GAInBrB,EAAQvF,GAAKsG,EACbf,EAAQxF,YAAcuG,EACtBf,EAAQrF,KAAOoG,EACff,EAAQ5E,IAAM2F,EACdf,EAAQlH,eAAiBiI,EACzBf,EAAQ3E,mBAAqB0F,EAC7Bf,EAAQpI,KAAOmJ,EACff,EAAQtF,gBAAkBqG,EAC1Bf,EAAQpF,oBAAsBmG,EAE9Bf,EAAQzF,UAAY,SAAUvG,GAAQ,MAAO,IAE7CgM,EAAQsB,QAAU,SAAUtN,GACxB,MAAM,IAAIkE,MAAM,qCAGpB8H,EAAQuB,IAAM,WAAc,MAAO,KACnCvB,EAAQwB,MAAQ,SAAUC,GACtB,MAAM,IAAIvJ,MAAM,mCAEpB8H,EAAQ0B,MAAQ,WAAa,OAAO,I,cCvLP,mBAAlBvN,OAAOY,OAEhBvB,EAAOD,QAAU,SAAkBkI,EAAMC,GACnCA,IACFD,EAAKE,OAASD,EACdD,EAAKpG,UAAYlB,OAAOY,OAAO2G,EAAUrG,UAAW,CAClDuG,YAAa,CACXlH,MAAO+G,EACPpH,YAAY,EACZwH,UAAU,EACVC,cAAc,OAOtBtI,EAAOD,QAAU,SAAkBkI,EAAMC,GACvC,GAAIA,EAAW,CACbD,EAAKE,OAASD,EACd,IAAIK,EAAW,aACfA,EAAS1G,UAAYqG,EAAUrG,UAC/BoG,EAAKpG,UAAY,IAAI0G,EACrBN,EAAKpG,UAAUuG,YAAcH,K,6BCrBnC,IAAIkG,EAAM,EAAQ,IAEdC,EAAkBrO,EAAQqO,gBAAkB,SAA0BzH,EAAS0H,EAAUC,EAAQC,EAAc/N,EAAMgO,GACnHD,IACFpL,KAAKvB,SAAW2M,GAEd5H,IACFxD,KAAKwD,QAAUA,GAEb2H,IACEA,EAAOG,GACTtL,KAAKmL,OAASA,EAAOG,GAErBtL,KAAKmL,OAASA,GAGdD,IACFlL,KAAKkL,SAAWA,GAElBlL,KAAK3C,KAAOA,EACZ2C,KAAKqL,SAAWA,EAChBrL,KAAKuL,MAAQvL,KAAKwL,YAGpBP,EAAgBvM,UAAU8M,SAAW,WACnC,OAAOxL,KAAKvB,SAAW,IAAMuB,KAAKwD,SAGpC,IAAIiI,EAAkB7O,EAAQ6O,gBAAkB,SAAyBP,EAAUC,EAAQhD,EAASuD,GAClG1L,KAAKkL,SAAWA,EAChBlL,KAAKmL,OAASA,EACdnL,KAAKoL,aAAeM,EAAIN,aACxBpL,KAAK2L,OAAS,GACd3L,KAAK4L,WAAazD,GAAWA,EAAQyD,WACrC5L,KAAK6L,cAAgB1D,IAAqC,IAA1BA,EAAQ0D,eA6B1C,SAASC,EAAY7D,EAAEnL,GACrB,OAAOA,EAAE,KAAKmL,EAAEuD,WAAW,KA3B7BC,EAAgB/M,UAAUqN,SAAW,SAAkBC,GACrD,IAAIzI,EACJ,GAAqB,iBAAVyI,EACTzI,EAAM,IAAI0H,EAAgBe,EAAQhM,KAAKkL,SAAUlL,KAAKmL,OAAQnL,KAAKoL,kBAC9D,CACL,IAAKY,EAAQ,MAAM,IAAIzK,MAAM,wBAC7B,IAAKyK,EAAOxI,QAAS,MAAM,IAAIjC,MAAM,yBACrC,IAAKyK,EAAO3O,KAAM,MAAM,IAAIkE,MAAM,0BAClCgC,EAAM,IAAI0H,EAAgBe,EAAOxI,QAASxD,KAAKkL,SAAUlL,KAAKmL,OAAQnL,KAAKoL,aAAcY,EAAO3O,KAAM2O,EAAOX,UAG/G,GAAIrL,KAAK4L,WACP,MAAMrI,EAGR,OADAvD,KAAK2L,OAAOxK,KAAKoC,GACVA,GAGTkI,EAAgB/M,UAAUuN,aAAe,SAAsBC,GAC3C,iBAAPA,GAAoBA,GAAOA,EAAIC,cACxCnM,KAAK+L,SAASG,GACLA,GAAOA,EAAIP,QACpBlJ,MAAM/D,UAAUyC,KAAKjC,MAAMc,KAAK2L,OAAQO,EAAIP,SAOhDF,EAAgB/M,UAAU8M,SAAW,SAAkBU,GACrD,OAAOlM,KAAK2L,OAAOS,IAAIN,GAAYO,KAAK,KAG1C7O,OAAOC,eAAegO,EAAgB/M,UAAW,QAAS,CAAEf,IAAK,WAC/D,OAAQqC,KAAK2L,OAAOvK,UAQtB,IAAIkL,EAAc1P,EAAQ0P,YAAc,SAASA,EAAaC,EAAKpB,GACjEnL,KAAKwD,QAAU+I,EACfvM,KAAKmL,OAASA,EACd5J,MAAMtE,KAAK+C,KAAMuM,GACjBhL,MAAMiL,kBAAkBxM,KAAMsM,IAEhCA,EAAY5N,UAAYlB,OAAOY,OAAOmD,MAAM7C,UAC1C,CAAEuG,YAAa,CAAClH,MAAOuO,EAAa5O,YAAY,GAC9CL,KAAM,CAACU,MAAO,cAAeL,YAAY,KAG7C,IAAI+O,EAAgB7P,EAAQ6P,cAAgB,SAAwBtB,EAAQhD,EAASiD,EAAcsB,EAAMC,GACvG3M,KAAKmL,OAASA,EACdnL,KAAKmI,QAAUA,EACfnI,KAAKoL,aAAeA,EACpBpL,KAAK0M,KAAOA,EACZ1M,KAAK2M,QAAUA,GAGjBF,EAAc/N,UAAUkO,QAAU,SAAkBzN,GAClD,OAAO6L,EAAI4B,QAAQ5M,KAAK0M,KAAMvN,IAGhCsN,EAAc/N,UAAUmO,UAAY,SAAmB1B,EAAQ2B,GAC7D,IAAI1B,OAA+BlL,IAAf4M,EAA4B9M,KAAKoL,aAAepL,KAAKoL,aAAa2B,EAAWD,GAC7FJ,EAAO1B,EAAI4B,QAAQ5M,KAAK0M,KAAMvB,EAAOG,IAAI,IACzCI,EAAM,IAAIe,EAActB,EAAQnL,KAAKmI,QAASiD,EAAcsB,EAAMlP,OAAOY,OAAO4B,KAAK2M,UAIzF,OAHGxB,EAAOG,KAAOI,EAAIiB,QAAQD,KAC3BhB,EAAIiB,QAAQD,GAAQvB,GAEfO,GAGT,IAAIsB,EAAiBpQ,EAAQoQ,eAAiB,CAC5C,YAAa,8JACb,KAAQ,2DACR,KAAQ,oDAER,MAAS,ySACT,aAAc,8FACd,KAAQ,0jCACR,IAAO,mCAEP,MAAS,6YAGT,SAAY,gIACZ,YAAa,gIAEb,MAAS,cACT,aAAgB,iBAChB,eAAgB,SAAUC,GACxB,MAAyB,iBAAVA,GAAuBC,WAAWD,KAAWE,SAASF,EAAO,MAAQpN,MAAMoN,IAE5F,MAAS,SAAUA,GACjB,IAAIG,GAAS,EACb,IACE,IAAIC,OAAOJ,GACX,MAAO1F,GACP6F,GAAS,EAEX,OAAOA,GAET,MAAS,yBACT,MAAS,8BAGXJ,EAAeM,OAASN,EAAeO,MACvCP,EAAeQ,QAAUR,EAAeO,MACxCP,EAAeS,KAAOT,EAAe,cAErCpQ,EAAQ8Q,SAAW,SAAmBT,EAAOU,EAAQC,GACnD,GAAqB,iBAAVX,QAAiD/M,IAA3B8M,EAAeW,GAAuB,CACrE,GAAIX,EAAeW,aAAmBN,OACpC,OAAOL,EAAeW,GAAQE,KAAKZ,GAErC,GAAsC,mBAA3BD,EAAeW,GACxB,OAAOX,EAAeW,GAAQV,QAE3B,GAAIW,GAAaA,EAAUE,eACa,mBAApCF,EAAUE,cAAcH,GACjC,OAAOC,EAAUE,cAAcH,GAAQV,GAEzC,OAAO,GAGT,IAAIF,EAAanQ,EAAQmQ,WAAa,SAAqB1O,GAKzD,OAJAA,EAAMA,EAAImN,YAIDuC,MAAM,cAAiB1P,EAAI0P,MAAM,SAGtC1P,EAAI0P,MAAM,SACL,IAAM1P,EAAM,IAEd,IAAM2P,KAAKC,UAAU5P,GAAO,IAL1B,IAAMA,GAkEjB,SAAS6P,EAAW/O,EAAQgP,GAC1B,IAAIhE,EAAQ1H,MAAM2L,QAAQD,GACtBE,EAAMlE,GAAS,IAAM,GAazB,OAXIA,GACFhL,EAASA,GAAU,GACnBkP,EAAMA,EAAI3O,OAAOP,GACjBgP,EAAIG,QAlCR,SAAqBnP,EAAQkP,EAAK9G,EAAGzK,GAClB,iBAANyK,EACT8G,EAAIvR,GAAKoR,EAAU/O,EAAOrC,GAAIyK,IAEH,IAAvBpI,EAAOoP,QAAQhH,IACjB8G,EAAIlN,KAAKoG,IA6BYjJ,KAAK,KAAMa,EAAQkP,MAEtClP,GAA4B,iBAAXA,GACnB3B,OAAOmH,KAAKxF,GAAQmP,QA3B1B,SAAkBH,EAAKE,EAAKhQ,GAC1BgQ,EAAIhQ,GAAO8P,EAAI9P,IA0ByBC,KAAK,KAAMa,EAAQkP,IAEzD7Q,OAAOmH,KAAKwJ,GAAKG,QAzBrB,SAA+BnP,EAAQgP,EAAKE,EAAKhQ,GACvB,iBAAb8P,EAAI9P,IAAsB8P,EAAI9P,IAIlCc,EAAOd,GAGVgQ,EAAIhQ,GAAO6P,EAAU/O,EAAOd,GAAM8P,EAAI9P,IANxCgQ,EAAIhQ,GAAO8P,EAAI9P,IAuB+BC,KAAK,KAAMa,EAAQgP,EAAKE,KAGjEA,EAuBT,SAASG,EAAavG,GACpB,MAAO,IAAIwG,mBAAmBxG,GAAGyG,QAAQ,KAAK,OAjGhD9R,EAAQ+R,kBAAoB,SAASA,EAAmBC,EAAGC,GACzD,UAAWD,UAAaC,EACtB,OAAO,EAET,GAAID,aAAanM,MACf,OAAMoM,aAAapM,QAGfmM,EAAExN,SAAWyN,EAAEzN,QAGZwN,EAAEE,MAAM,SAAU7G,EAAGnL,GAC1B,OAAO6R,EAAkBC,EAAE9R,GAAI+R,EAAE/R,OAGrC,GAAiB,iBAAN8R,EAAgB,CACzB,IAAKA,IAAMC,EACT,OAAOD,IAAMC,EAEf,IAAIE,EAAQvR,OAAOmH,KAAKiK,GACpBI,EAAQxR,OAAOmH,KAAKkK,GACxB,OAAIE,EAAM3N,SAAW4N,EAAM5N,QAGpB2N,EAAMD,MAAM,SAAU7G,GAC3B,OAAO0G,EAAkBC,EAAE3G,GAAI4G,EAAE5G,MAGrC,OAAO2G,IAAMC,GAgDfhS,EAAOD,QAAQsR,UAAYA,EAS3BtR,EAAQqS,cAAgB,SAAuB1R,EAAGsB,GAGhD,IAFA,IACIqQ,EADAC,EAAQtQ,EAAEuQ,MAAM,KAAKC,MAAM,GAEI,iBAApBH,EAAEC,EAAM9K,UAAsB,CAC3C,IAAI9F,EAAI+Q,mBAAmBJ,EAAER,QAAQ,KAAK,KAAKA,QAAQ,MAAM,MAC7D,KAAMnQ,KAAKhB,GAAI,OACfA,EAAIA,EAAEgB,GAER,OAAOhB,GAWTX,EAAQ2S,WAAa,SAAuBX,GAG3C,OAAOA,EAAExC,IAAIoC,GAAanC,KAAK,KAWhCzP,EAAQ4S,iBAAmB,SAA0BC,GAEnD,IAAIC,EAAgB,EACpB,GAAI7P,MAAM4P,GAAS,OAAOC,EAEJ,iBAAXD,IACTA,EAAS7P,OAAO6P,IAGlB,IAAIN,EAAQM,EAAOjE,WAAW4D,MAAM,KACpC,GAAqB,IAAjBD,EAAM/N,OAAc,CACtB,GAAoB,MAAhB+N,EAAM,GAAG,GACX,OAAOO,EAEPA,EAAgB9P,OAAOuP,EAAM,GAAGE,MAAM,IAI1C,IAAIM,EAAeR,EAAM,GAAGC,MAAM,KAKlC,OAJ4B,IAAxBO,EAAavO,SACfsO,GAAiBC,EAAa,GAAGvO,QAG5BsO,I,8EChUT,cAGA,IAAIE,EAA0BC,EAyJ9B,SAAgBC,IACd,MAAMC,EAAoBhK,SAASiK,eAAe,sBAC5CC,EAAiBlK,SAASiK,eAAe,mBACzCE,EAAoBnK,SAASiK,eAAe,sBAC5CG,EAAiBpK,SAASiK,eAAe,mBACzCI,EAAgBrK,SAASiK,eAAe,kBACxCK,EAAgBtK,SAASiK,eAAe,kBAE9CjK,SAASiK,eAAe,oBAAoBM,iBAAiB,QAAUC,IACrEA,EAAIC,kBACJT,EAAkBU,UAAUC,OAAO,aAC/BX,EAAkBU,UAAUE,SAAS,cACvC5K,SAAS6K,KAAKN,iBAAiB,QAASO,GACxCZ,EAAeK,iBAAiB,QAAS,KACvCP,EAAkBU,UAAUK,OAAO,aACnC/K,SAASgL,iBAAiB,uBAAuBzC,QAAQ0C,IACvDA,EAAKP,UAAUK,OAAO,wBAExBb,EAAeQ,UAAUQ,IAAI,sBAC7BZ,EAAca,YAAc,WAC5BC,EAAMC,qBAAqB,WAE7BlB,EAAkBI,iBAAiB,QAAS,KAC1CP,EAAkBU,UAAUK,OAAO,aACnC/K,SAASgL,iBAAiB,uBAAuBzC,QAAQ0C,IACvDA,EAAKP,UAAUK,OAAO,wBAExBZ,EAAkBO,UAAUQ,IAAI,sBAChCZ,EAAca,YAAc,cAC5BC,EAAMC,qBAAqB,cAE7BjB,EAAeG,iBAAiB,QAAS,KACvCP,EAAkBU,UAAUK,OAAO,aACnC/K,SAASgL,iBAAiB,uBAAuBzC,QAAQ0C,IACvDA,EAAKP,UAAUK,OAAO,wBAExBX,EAAeM,UAAUQ,IAAI,sBAC7BZ,EAAca,YAAc,WAC5BC,EAAMC,qBAAqB,WAE7BhB,EAAcE,iBAAiB,QAAS,KACtCP,EAAkBU,UAAUK,OAAO,aACnC/K,SAASgL,iBAAiB,uBAAuBzC,QAAQ0C,IACvDA,EAAKP,UAAUK,OAAO,wBAExBT,EAAca,YAAc,SAC5BC,EAAME,4BAGRtL,SAAS6K,KAAKU,oBAAoB,QAAST,KA2DjD,SAASA,IACP9K,SAAS6K,KAAKU,oBAAoB,QAAST,GAC3C9K,SAASiK,eAAe,sBAAsBS,UAAUK,OAAO,aAhQjE,+BAAqCS,EAAsBC,IAoE3D,SAA6BD,GAC3B3B,EAAmB,IACnB,MAAM6B,EAAgB1L,SAASiK,eAAe,iBACxC0B,EAAgB3L,SAASiK,eAAe,iBAoB9C,SAAS2B,IACPD,EAAc3T,MAAQ0T,EAAc1T,MACpC6R,EAAmBhQ,OAAO6R,EAAc1T,OACvCgI,SAAS6L,cAAc,IAAML,GAC3BM,MAAMC,SAAWlS,OAAO8R,EAAc3T,OAAS,KAAOyN,WAtB3DiG,EAAc1T,MAAQ,MAEtBgI,SAASiK,eAAe,iBAAiBM,iBAAiB,QAAS,KAEjE,MAAMyB,EAAenC,EAAmB,GAAKA,EAAmB,IAAQ,EAClEoC,EAAqC,QAAxBP,EAAc1T,MAAkBgU,EAAe,EACjEhM,SAASgL,iBAAiB,IAAMQ,GAA0CjD,QAAQhH,IACjFA,EAAEuK,MAAMC,QAAUE,EAAWxG,aAG/BoE,EAAmBhQ,OAAO6R,EAAc1T,OACxC0T,EAAc1T,MAAQyD,OAAoB,IAAbwQ,GAC7BN,EAAc3T,MAAQyD,OAAOyQ,KAAKC,MAAmB,IAAbF,MAG1CP,EAAcnB,iBAAiB,QAASqB,GACxCF,EAAcnB,iBAAiB,SAAUqB,GAxFzCQ,CAAmBZ,GAkHrB,SAAuCC,GACrC3B,EAAmB,IACnB,MAAMuC,EAAkBrM,SAASiK,eAAe,mBAC1CqC,EAAkBtM,SAASiK,eAAe,mBAiBhD,SAASsC,IACPD,EAAgBtU,MAAQqU,EAAgBrU,MACxC8R,EAAmBjQ,OAAOwS,EAAgBrU,OACzCgI,SAASwM,uBAAuBf,GAAY,GAC1CK,MAAMC,SAAWlS,OAAOyS,EAAgBtU,OAAS,KAAOyN,WAnB7D4G,EAAgBrU,MAAQ,MACxBgI,SAASiK,eAAe,oBAAoBM,iBAAiB,QAAS,KACpE,MAAMyB,EAAelC,EAAmB,GAAKA,EAAmB,IAAQ,EAClEmC,EAAuC,QAA1BI,EAAgBrU,MAAkBgU,EAAe,EACnEhM,SAASwM,uBAAuBf,GAAY,GAC1CK,MAAMC,QAAUE,EAAWxG,WAE9BqE,EAAmBjQ,OAAOwS,EAAgBrU,OAC1CqU,EAAgBrU,MAAQyD,OAAoB,IAAbwQ,GAC/BK,EAAgBtU,MAAQyD,OAAOyQ,KAAKC,MAAmB,IAAbF,MAG5CI,EAAgB9B,iBAAiB,QAASgC,GAC1CF,EAAgB9B,iBAAiB,SAAUgC,GAnI3CE,CAA6BhB,GAC7B1B,IAkPA/J,SAASiK,eAAe,cAAcM,iBAAiB,QAAS,KAC9DvK,SAASiK,eAAe,cAAcS,UAAUC,OAAO,aACvD3K,SAASiK,eAAe,WAAWS,UAAUC,OAAO,eAjPtD,MAAM+B,EAAkB1M,SAASiK,eAAe,mBAC1C0C,EAAgB3M,SAASiK,eAAe,iBAE9C0C,EAAcpC,iBAAiB,QAAS,KACA,SAAlCmC,EAAgBZ,MAAMc,SACxBF,EAAgBZ,MAAMc,QAAU,GAChCD,EAAcE,aAAa,aAAc,sDAEzCH,EAAgBZ,MAAMc,QAAU,OAChCD,EAAcE,aAAa,aAAc,wDAQ/C,2BAAiCC,GAC/B,QAAoB3S,IAAhB2S,EACF,OAEF,MAAMC,EAAa/M,SAASiK,eAAe,cACrC+C,EAAahN,SAASiK,eAAe,cAY3C,SAASgD,IACPD,EAAWhV,MAAQ+U,EAAW/U,MAC9B8U,EAAYI,OAAOrT,OAAOmT,EAAWhV,OAAS,KAZhD+U,EAAW/U,MAAQ,MACnBgI,SAASiK,eAAe,cAAcM,iBAAiB,QAAS,KAC9DyC,EAAWhV,MAAQ,MACnB+U,EAAW/U,MAAQ,MACnB8U,EAAYK,oBAGdJ,EAAWxC,iBAAiB,QAAS0C,GACrCF,EAAWxC,iBAAiB,SAAU0C,GAOtCjN,SAAS6K,KAAKN,iBAAiB,UAAYC,IACzC,MAAM4C,EAAchG,SAAS4F,EAAWhV,OACxC,GAAgB,MAAZwS,EAAIlS,IAAa,CACnB,MAAM+U,EAAUnB,KAAKoB,IAAIF,EAAc,GAAIhG,SAAS2F,EAAWQ,aAAa,SAC5ET,EAAYI,OAAOG,EAAU,KAC7BL,EAAWhV,MAAQyD,OAAO4R,GAC1BN,EAAW/U,MAAQyD,OAAO4R,QACrB,GAAgB,MAAZ7C,EAAIlS,IAAa,CAC1B,MAAM+U,EAAUnB,KAAKsB,IAAIJ,EAAc,GAAIhG,SAAS2F,EAAWQ,aAAa,SAC5ET,EAAYI,OAAOG,EAAU,KAC7BL,EAAWhV,MAAQyD,OAAOyQ,KAAKC,MAAMkB,IACrCN,EAAW/U,MAAQyD,OAAO4R,OACL,MAAZ7C,EAAIlS,MACb0U,EAAWhV,MAAQ,MACnB+U,EAAW/U,MAAQ,MACnB8U,EAAYK,sBA0ClB,gCAAsC3B,GACpC,MAAMG,EAAgB3L,SAASiK,eAAe,iBAC9C0B,EAAc3T,MAASgI,SAASiK,eAAe,iBAAsCjS,MACrF,IACIgI,SAASgL,iBAAiB,IAAMQ,GAA2CjD,QAAQhH,IACnFA,EAAEuK,MAAMC,SAAWlS,OAAO8R,EAAc3T,OAAS,KAAOyN,aAE1D,MAAOjE,MAqCX,yBAsDA,2CACE,MAAMiM,EAAqBzN,SAASiK,eAAe,uBACnDwD,EAAmBlD,iBAAiB,QAAS,KAC3CvK,SAASiK,eAAe,sBAAsBS,UAAUK,OAAO,aAC/D/K,SAASgL,iBAAiB,uBAAuBzC,QAAQ0C,IACvDA,EAAKP,UAAUK,OAAO,wBAExB0C,EAAmB/C,UAAUQ,IAAI,sBACjClL,SAASiK,eAAe,kBAAkBkB,YAAc,eACxDC,EAAMC,qBAAqB,gBAO/B,6BACE,IAAIqC,EACJ,IACEA,EAAc1N,SAAS6L,cAAc,uBAAuBtG,GAC5D,MAAO/D,GACPkM,EAAc,GAEhB,OAAQA,GACN,IAAK,kBACHtC,EAAMC,qBAAqB,SAC3B,MACF,IAAK,qBACHD,EAAMC,qBAAqB,YAC3B,MACF,IAAK,kBACHD,EAAMC,qBAAqB,SAC3B,MACF,IAAK,sBACHD,EAAMC,qBAAqB,aAC3B,MACF,QACED,EAAME,4B,8ECzPZ,cACA,QACA,QACA,QAIA,QAEA,OAIA,SAAgBqC,IACd,MAAM5N,EAAUC,SAASwM,uBAAuB,oBAChD,OAAuB,IAAnBzM,EAAQ1E,OACH0E,EAAQ,GAAGwF,GAEX,KAQX,SAAgBqI,IACd5N,SAASgL,iBAAiB,aAAazC,QAASsF,IAC9CA,EAASnD,UAAUK,OAAO,YACtB8C,EAASnD,UAAUE,SAAS,UAC9BiD,EAASC,gBAAgB,SACzB1C,EAAM2C,YAAYF,KAElBA,EAASC,gBAAgB,SACzBD,EAAS/B,MAAMkC,KAAO,MAG1BtR,MAAMuR,KAAKjO,SAASwM,uBAAuB,gBAAgBjE,QAAS2F,IAClEA,EAAGpC,MAAMqC,MAAQ,GACjBD,EAAGpC,MAAMsC,WAAa,GACtBF,EAAGxD,UAAUK,OAAO,iBAEtBrO,MAAMuR,KAAKjO,SAASwM,uBAAuB,wBAAwBjE,QAAS8F,IAC1EA,EAAQvC,MAAMkC,KAAO,SAGvBtR,MAAMuR,KAAKjO,SAASwM,uBAAuB,yBAAyBjE,QAAS+F,IAC3EA,EAASxC,MAAMkC,KAAO,GACtBM,EAAS5D,UAAUQ,IAAI,YACvBoD,EAAS5D,UAAUK,OAAO,0BAG5B7H,EAAGqL,UAAU,eAAexD,SAC5B7H,EAAGqL,UAAU,gBAAgBxD,SAC7B7H,EAAGqL,UAAU,cAAcxD,SAEtB/K,SAASiK,eAAe,cAAcS,UAAUE,SAAS,aAG5D4D,EAAcC,sBAFdC,EAASC,uBAIX,EAAAC,kBAMF,SAAgBC,EAAQX,EAAwBY,GAC9C,GAAIZ,EAAGxD,UAAUE,SAAS,SACxB,OAAOmE,EAAYb,EAAIY,GAEzB,IAAKZ,EAAGxD,UAAUE,SAAS,cAAgBsD,EAAGxD,UAAUE,SAAS,iBAC5DsD,EAAGxD,UAAUE,SAAS,uBAAwB,CAQjD,IAAIoE,EAMJ,GAbAd,EAAGxD,UAAUQ,IAAI,YACjBgD,EAAGpC,MAAMkC,KAAO,OACZE,EAAGlD,iBAAiB,wBAAwB3P,QAC9C6S,EAAGlD,iBAAiB,wBAAwBzC,QAAS0C,IACnDA,EAAKa,MAAMkC,KAAO,QAIlBE,EAAGxD,UAAUE,SAAS,YACxBoE,EAAQd,EAAG3I,GAC0B,OAA5B2I,EAAGe,QAAQ,eACpBD,EAAQd,EAAGe,QAAQ,aAAa1J,SAEpBpL,IAAV6U,EAAqB,CACThP,SAASgL,iBAAiB,QAAUgE,GAC5CzG,QAAS2G,IACbA,EAAKpD,MAAMqC,MAAQ,OACnBe,EAAKpD,MAAMsC,WAAa,OACxBc,EAAKxE,UAAUQ,IAAI,kBAIzB,EAAA0D,kBAoCKO,eAAeC,EAAYC,EAAwBC,GAExD,aADqCA,EAASC,eAAeF,EAAG9J,GAAI+J,EAASE,KAAKC,sBACxD,QAM5B,SAAgBC,EAAyBC,GACvC,MAAMC,EAAelT,MAAMuR,KAAK0B,GAE1BE,EADeD,EAAapR,MACAsR,cAAcA,cAChD,IAAK,MAAM/P,KAAW6P,EAAc,CAElC,GADe7P,EAAQ+P,cAAcA,cAC1BvK,KAAOsK,EAAatK,GAC7B,OAAO,EAGX,OAAO,EAsCT,SAAgBwK,EAAY7B,EAAwBY,EAA0BQ,GAC5E,MAAMU,EAAO9B,EACP+B,EAAMD,EAAKf,QAAQ,QACzB,IAAKgB,EAAIvF,UAAUE,SAAS,YAAa,CACvCqF,EAAIvF,UAAUQ,IAAI,YAClB8E,EAAKlE,MAAMkC,KAAO,OAClB,MAAMiB,EAAUf,EAAGe,QAAQ,aAC3BA,EAAQnD,MAAMkC,KAAO,MACrBiB,EAAQvE,UAAUQ,IAAI,6BACL/Q,IAAbmV,GACF,EAAAY,OAAOD,EAA2BX,EAAUR,QAE1B3U,IAAhB2U,GACFA,EAAYqB,WAEd,MAAMnB,EAAQd,EAAGe,QAAQ,aAAa1J,GACtC,QAAcpL,IAAV6U,EAAqB,CACvB,MAAME,EAAwBlP,SAAS6L,cAAc,QAAUmD,GAC3DE,IACFA,EAAKpD,MAAMqC,MAAQ,OACnBe,EAAKpD,MAAMsC,WAAa,OACxBc,EAAKxE,UAAUQ,IAAI,kBAwB3B,SAAgB6D,EAAaqB,EAAoBtB,GAC1CsB,EAAM1F,UAAUE,SAAS,cAC5BwF,EAAM1F,UAAUQ,IAAI,YACpBE,EAAM2C,YAAYqC,GAClBhF,EAAMiF,UAAUD,EAAO,QACvBtB,EAAYqB,YAhOhB,qBAaA,aAyCA,WAkCA,YAAOhB,eAA0BjB,EAAwBoB,EAAoBR,GAC3E,IAAKZ,EAAG4B,cAAcpF,UAAUE,SAAS,YAAa,CACpD,MAAM0F,EAASpC,EAAG4B,cAGlB,GAFAlC,IACAiB,EAAOyB,SACGlB,EAAWkB,EAAQhB,GAAW,CACtC,MAAMiB,EAASD,EAAOE,gBACtB,SAAUpB,EAAWmB,EAAQjB,GAC3BT,EAAO0B,OACF,CACL,MAAME,EAASH,EAAOI,kBACZtB,EAAWqB,EAAQnB,GAC3BT,EAAO4B,GAEP7U,QAAQC,KAAK,gDAGjB6S,EAASiC,gBAAgB,iBAChBL,EAAO5F,UAAUE,SAAS,MACnC4D,EAAcoC,iBAAiBN,GAE/B1U,QAAQC,KAAK,wBAEfiT,EAAYqB,aAOhB,eAQA,4BAiBA,wBAA8BC,GAC5B,IAAIS,EAAKC,EAAKC,EAAKC,EAAKC,EAsBxB,OArBAb,EAAMpF,iBAAiB,QAAQzC,QAAQ2I,IACrC,MAAMC,EAAwBD,EAAK3D,aAAa,KAC7CvF,MAAM,QACN3B,IAAItG,GAAWlG,OAAOkG,SACZ5F,IAAT8W,IACFA,EAAO/E,KAAKkF,MAAMD,EAAY,GAAKA,EAAY,KAC5CA,EAAY,GAAKA,EAAY,YAEtBhX,IAAR2W,GAAqBK,EAAY,GAAKL,KACxCA,EAAMK,EAAY,UAERhX,IAAR0W,GAAqBM,EAAY,GAAKN,KACxCA,EAAMM,EAAY,UAERhX,IAAR6W,GAAqBG,EAAY,GAAKH,KACxCA,EAAMG,EAAY,UAERhX,IAAR4W,GAAqBI,EAAY,GAAKJ,KACxCA,EAAMI,EAAY,MAGf,CAAE,IAAON,EAAK,IAAOC,EAAK,IAAOC,EAAK,IAAOC,EAAK,KAAQC,IAQnE,eA+BA,oBAA0BI,GACxB,QAAIA,EAAUhW,OAAS,KACrBgW,EAAU9I,QAAQ+I,IAAQzC,EAAOyC,MAC1B,IAWX,gBAYA,YAAOnC,eAA0BQ,EAAqCL,EAAoBR,GACxF,MAAMyC,EAAgB5D,IAEtB,GADAC,IACwB,IAApB+B,EAAStU,OACX,OAGF,IAAImW,EACAC,GAAuB,EAE3B,OAAQF,GACN,IAAK,WACHC,EAAiB,YACjB,MACF,IAAK,aACHA,EAAiB,SACjB,MACF,IAAK,UACHA,EAAiB,MACjB,MACF,IAAK,aACHA,EAAiB,SACjB,MACF,IAAK,YACHA,EAAiB,uBACjB,MACF,QAEE,YADA5V,QAAQ0B,MAAM,0BAA4BiU,GAM9C,MAAMG,EAAiB,IAAIC,IAC3B,IAAK,MAAM5R,KAAW4P,EAAU,CAC9B,IAAIiC,EAAW7R,EAAQkP,QAAQuC,GAC/B,GAAiB,OAAbI,EAAmB,CAGrB,GAAiB,QADjBA,EAAW7R,EAAQkP,QAAQ,mBACJ,CACrBrT,QAAQC,KAAK,WAAakE,EAAQwF,GAAK,gEACvC,SAEFkM,EAAuBA,IAAwB,EAEjDC,EAAexG,IAAI0G,GAGnB,MAAMC,EAAUD,EAASrE,aAAa,eAClCsE,GACFH,EAAexG,IAAIlL,SAASiK,eAAe4H,IAE7C,MAAMC,EAAWF,EAASrE,aAAa,gBACnCuE,GACFJ,EAAexG,IAAIlL,SAASiK,eAAe6H,IAK/CJ,EAAenJ,QAASwJ,IAAgClD,EAAOkD,EAAOjD,KAItE,MAAMkD,EAAStV,MAAMuR,KAAKyD,EAAeO,UAGzC,GAAIR,EAE0B,IAAxBC,EAAeQ,MAAcF,EAAO,GAAGtH,UAAUE,SAAS,QAC5D4D,EAAc2D,mBAAmBH,EAAO,IACP,IAAxBN,EAAeQ,MAAcF,EAAO,GAAGtH,UAAUE,SAAS,UACnE4D,EAAc4D,uBAEO,YAAjBb,EACF/C,EAAc6D,2BAEd7D,EAAc8D,6BAMpB,OAAQf,GACN,IAAK,aACH,OAAQS,EAAO3W,QACb,KAAK,EACHmT,EAAc+D,sBACd,EAAArC,OAAO8B,EAAO,GAAI1C,EAAUR,GAC5B,MACF,QACEN,EAAcgE,sBAElB,MAEF,IAAK,WACH,OAAQR,EAAO3W,QACb,KAAK,EAEHmT,EAAciE,oBACd,MACF,KAAK,EAEH,GAAKT,EAAO,GAAGzE,aAAa,iBAAmByE,EAAO,GAAGzM,IAAQyM,EAAO,GAAGzE,aAAa,kBAAoByE,EAAO,GAAGzM,GACpHmJ,EAASiC,gBAAgB,sBACpB,GAAIjB,EAAwBsC,GACjCtD,EAASiC,gBAAgB,WACpB,CAEL,MAAM+B,EAASV,EAAO,GAAG/C,QAAQ,UAC3B0D,EAASX,EAAO,GAAG/C,QAAQ,UAC3B2D,EAAgBlW,MAAMuR,KAAKyE,EAAO5C,cAAc+C,UAEtD,GAAgF,IAA5E3G,KAAK4G,IAAIF,EAAcpK,QAAQkK,GAAUE,EAAcpK,QAAQmK,IAAgB,CAGjF,MAAMI,EAAcH,EAAcpK,QAAQkK,GAAUE,EAAcpK,QAAQmK,GAAWD,EAASC,EACxFK,EAAeD,EAAWxN,KAAOmN,EAAOnN,GAAMoN,EAASD,EACvDO,EAAaF,EAAWlH,cAAc,UACtCqH,EAAcF,EAAYnH,cAAc,UAGxCsH,EAAwBzW,MAAMuR,KAAKgF,EAAWJ,UACjDO,OAAQnI,GAAsBA,EAAKP,UAAUE,SAAS,aACnDyI,EAAyB3W,MAAMuR,KAAKiF,EAAYL,UACnDO,OAAQnI,GAAsBA,EAAKP,UAAUE,SAAS,aACnD0I,EAAeH,EAAsBA,EAAsB9X,OAAS,GACpEkY,EAAgBF,EAAuB,GAC7C,GAAIC,EAAa/N,KAAOyM,EAAO,GAAGzM,IAAMgO,EAAchO,KAAOyM,EAAO,GAAGzM,GAAI,CACzEmJ,EAASiC,gBAAgB,iBACzB,MACK,GAAI2C,EAAa/N,KAAOyM,EAAO,GAAGzM,IAAMgO,EAAchO,KAAOyM,EAAO,GAAGzM,GAAI,CAChFmJ,EAASiC,gBAAgB,iBACzB,OAGJnC,EAAc6D,2BAEhB,MACF,QACM3C,EAAwBsC,GAC1BtD,EAASiC,gBAAgB,OAEzBnC,EAAc6D,2BAGpB,MAEF,IAAK,aACH,OAAQL,EAAO3W,QACb,KAAK,EAEHmT,EAAcgF,sBACd,MACF,QACM9D,EAAwBsC,GAC1BtD,EAASiC,gBAAgB,SAEzBnC,EAAc8D,wBAGpB,MAEF,IAAK,UACH,OAAQN,EAAO3W,QACb,KAAK,EACHmT,EAAcoC,iBAAiBoB,EAAO,IACtC,MACF,KAAK,EACH,GAAItC,EAAwBsC,GAAS,CAGnC,GAAIA,EAAO,GAAGlC,gBAAkBkC,EAAO,GAAGlC,cAAe,CACvD,MAAM+C,EAAWnW,MAAMuR,KAAK+D,EAAO,GAAGlC,cAAc+C,UAEpD,GAA4E,IAAxE3G,KAAK4G,IAAID,EAASrK,QAAQwJ,EAAO,IAAMa,EAASrK,QAAQwJ,EAAO,KAAY,CAQ7E,IAAIyB,EAAWC,EAJM1B,EAAO,GAAGa,SAAS,GACrCc,EAAEC,QAAQ5b,MACSga,EAAO,GAAGa,SAAS,GACtCc,EAAEC,QAAQ5b,OAIXyb,EAAazB,EAAO,GAAGa,SAAS,GAC7BgB,EAAED,QAAQ5b,MACb0b,EAAc1B,EAAO,GAAGa,SAAS,GAC9BgB,EAAED,QAAQ5b,QAEbyb,EAAazB,EAAO,GAAGa,SAAS,GAC7BgB,EAAED,QAAQ5b,MACb0b,EAAc1B,EAAO,GAAGa,SAAS,GAC9BgB,EAAED,QAAQ5b,OAIf,MAAM8b,QAAwB1E,EAAW4C,EAAO,GAAI1C,GAC9CyE,QAAyB3E,EAAW4C,EAAO,GAAI1C,GACrD,GAAKoE,EAAaD,GAAgBK,IAAoBC,EAAmB,CACvErF,EAASiC,gBAAgB,YACzB,QAINjC,EAASiC,gBAAgB,WAEzBnC,EAAc8D,wBAEhB,MACF,QACM5C,EAAwBsC,GAC1BtD,EAASiC,gBAAgB,MAEzBnC,EAAc8D,wBAGpB,MACF,IAAK,YACH,OAAQN,EAAO3W,QACb,KAAK,EACH0U,EAAWiC,EAAO,GAAIlD,EAAaQ,GACnC,MACF,QACE0C,EAAOzJ,QAAQhH,GAAKwO,EAAWxO,EAAGuN,OAAa3U,IAGnD,MACF,QACEyB,QAAQ0B,MAAM,6D,iBCzdpB,YAwGA,SAAS0W,EAAexc,GACtB,OAAOC,OAAOkB,UAAU8M,SAASvO,KAAKM,GA3ExCX,EAAQwR,QANR,SAAiBrL,GACf,OAAIN,MAAM2L,QACD3L,MAAM2L,QAAQrL,GAEQ,mBAAxBgX,EAAehX,IAOxBnG,EAAQod,UAHR,SAAmBjX,GACjB,MAAsB,kBAARA,GAOhBnG,EAAQqd,OAHR,SAAgBlX,GACd,OAAe,OAARA,GAOTnG,EAAQsd,kBAHR,SAA2BnX,GACzB,OAAc,MAAPA,GAOTnG,EAAQud,SAHR,SAAkBpX,GAChB,MAAsB,iBAARA,GAOhBnG,EAAQwd,SAHR,SAAkBrX,GAChB,MAAsB,iBAARA,GAOhBnG,EAAQyd,SAHR,SAAkBtX,GAChB,MAAsB,iBAARA,GAOhBnG,EAAQ0d,YAHR,SAAqBvX,GACnB,YAAe,IAARA,GAOTnG,EAAQ2d,SAHR,SAAkBC,GAChB,MAA8B,oBAAvBT,EAAeS,IAOxB5d,EAAQ6d,SAHR,SAAkB1X,GAChB,MAAsB,iBAARA,GAA4B,OAARA,GAOpCnG,EAAQ8d,OAHR,SAAgBtd,GACd,MAA6B,kBAAtB2c,EAAe3c,IAOxBR,EAAQ+d,QAHR,SAAiBpT,GACf,MAA8B,mBAAtBwS,EAAexS,IAA2BA,aAAahG,OAOjE3E,EAAQge,WAHR,SAAoB7X,GAClB,MAAsB,mBAARA,GAYhBnG,EAAQie,YARR,SAAqB9X,GACnB,OAAe,OAARA,GACe,kBAARA,GACQ,iBAARA,GACQ,iBAARA,GACQ,iBAARA,QACQ,IAARA,GAIhBnG,EAAQke,SAAWC,EAAOD,W,uGCtG1B,cAEME,EAAgC,IAAIvY,MAAM,GAChD,IAAIwY,EAAmC,KACnCC,GAAY,EAKhB,MAAMC,EAAoB,EAgB1B,SAASC,IACP,GAAIJ,EAAc5Z,OAAS,EAAG,CAC5B8Z,GAAY,EACZ,MAAMG,EAAsBL,EAAczW,OAa9C,SAA8B+W,GAC5B,GAAIA,EAAaC,cAAe,CAC9B,GAA2B,OAAvBN,EAMF,OAHAzT,OAAOiC,aAAawR,EAAmBO,WACvCR,EAAc7Z,KAAKma,QACnBG,EAA4BR,EAAmBS,SAJ/CT,EAAqBK,EAQzB,MAAMK,EAAsB5V,SAASiK,eAAe,wBACpD2L,EAAoBC,WAAa,sCAA2CN,EAAaI,QAAU,KAAQJ,EAAa9X,QAAU,UAClImY,EAAoB9J,MAAMc,QAAU,GACpC2I,EAAa3I,UA1BXkJ,CAAoBR,GACpBA,EAAoBS,aAAatU,OAAOX,WAAW4U,EAA6B,IAAMJ,EAAoBK,UAC1G3V,SAASiK,eAAeqL,EAAoBK,SAASpL,iBAAiB,QAAS,KAC7E9I,OAAOiC,aAAa4R,EAAoBG,WACxCC,EAA4BJ,EAAoBK,YA6BtD,SAASD,EAA6BM,GACpChW,SAASiK,eAAe+L,GAAWjL,SACR,OAAvBmK,GAA+BA,EAAmBS,UAAYK,IAChEd,EAAqB,MAEnBD,EAAc5Z,OAAS,EACzBga,IACoE,IAA3DrV,SAASgL,iBAAiB,sBAAsB3P,SACzD2E,SAASiK,eAAe,wBAAwB6B,MAAMc,QAAU,OAChEuI,GAAY,GAzDhB,6BAAmCI,GACjC,MAAMU,EAAQ,IAAIC,EAAaX,GAC/BN,EAAc7Z,KAAK6a,KACdd,GAAanV,SAASiK,eAAe,wBAAwBe,iBAAiB,sBAAsB3P,OAAS+Z,IAChHC,KA4DJ,MAAMa,EASJ,YAAazY,GACXxD,KAAKwD,QAAUA,EACfxD,KAAKkc,WAAY,EACjBlc,KAAKsL,GAAK,EAAA6Q,SACVnc,KAAKub,eAA4C,IAA5B/X,EAAQ4Y,OAAO,QACpCpc,KAAKwb,WAAa,EAIpB,aAAclQ,GACZtL,KAAKwb,UAAYvJ,KAAKsB,IAAIjI,GAAK,GAIjC,UACEtL,KAAKkc,WAAY,EAMnB,QACE,OAAOlc,KAAKsL,M,8BC7GhB;;;;;;;AAUA,IAAI+Q,EAAS,EAAQ,IACjBC,EAAU,EAAQ,IAClBlO,EAAU,EAAQ,IAmDtB,SAASmO,IACP,OAAOxB,EAAOyB,oBACV,WACA,WAGN,SAASC,EAAclc,EAAMa,GAC3B,GAAImb,IAAenb,EACjB,MAAM,IAAI4B,WAAW,8BAcvB,OAZI+X,EAAOyB,qBAETjc,EAAO,IAAImc,WAAWtb,IACjBub,UAAY5B,EAAOrc,WAGX,OAAT6B,IACFA,EAAO,IAAIwa,EAAO3Z,IAEpBb,EAAKa,OAASA,GAGTb,EAaT,SAASwa,EAAQhY,EAAK6Z,EAAkBxb,GACtC,KAAK2Z,EAAOyB,qBAAyBxc,gBAAgB+a,GACnD,OAAO,IAAIA,EAAOhY,EAAK6Z,EAAkBxb,GAI3C,GAAmB,iBAAR2B,EAAkB,CAC3B,GAAgC,iBAArB6Z,EACT,MAAM,IAAIrb,MACR,qEAGJ,OAAOsb,EAAY7c,KAAM+C,GAE3B,OAAOiR,EAAKhU,KAAM+C,EAAK6Z,EAAkBxb,GAW3C,SAAS4S,EAAMzT,EAAMxC,EAAO6e,EAAkBxb,GAC5C,GAAqB,iBAAVrD,EACT,MAAM,IAAIgD,UAAU,yCAGtB,MAA2B,oBAAhB+b,aAA+B/e,aAAiB+e,YA6H7D,SAA0Bvc,EAAM4J,EAAO4S,EAAY3b,GAGjD,GAFA+I,EAAM6S,WAEFD,EAAa,GAAK5S,EAAM6S,WAAaD,EACvC,MAAM,IAAI/Z,WAAW,6BAGvB,GAAImH,EAAM6S,WAAaD,GAAc3b,GAAU,GAC7C,MAAM,IAAI4B,WAAW,6BAIrBmH,OADiBjK,IAAf6c,QAAuC7c,IAAXkB,EACtB,IAAIsb,WAAWvS,QACHjK,IAAXkB,EACD,IAAIsb,WAAWvS,EAAO4S,GAEtB,IAAIL,WAAWvS,EAAO4S,EAAY3b,GAGxC2Z,EAAOyB,qBAETjc,EAAO4J,GACFwS,UAAY5B,EAAOrc,UAGxB6B,EAAO0c,EAAc1c,EAAM4J,GAE7B,OAAO5J,EAvJE2c,CAAgB3c,EAAMxC,EAAO6e,EAAkBxb,GAGnC,iBAAVrD,EAwFb,SAAqBwC,EAAM4c,EAAQC,GACT,iBAAbA,GAAsC,KAAbA,IAClCA,EAAW,QAGb,IAAKrC,EAAOsC,WAAWD,GACrB,MAAM,IAAIrc,UAAU,8CAGtB,IAAIK,EAAwC,EAA/B4b,EAAWG,EAAQC,GAG5BE,GAFJ/c,EAAOkc,EAAalc,EAAMa,IAERmc,MAAMJ,EAAQC,GAE5BE,IAAWlc,IAIbb,EAAOA,EAAK8O,MAAM,EAAGiO,IAGvB,OAAO/c,EA5GEid,CAAWjd,EAAMxC,EAAO6e,GAsJnC,SAAqBrc,EAAMoH,GACzB,GAAIoT,EAAOD,SAASnT,GAAM,CACxB,IAAIhE,EAA4B,EAAtB8Z,EAAQ9V,EAAIvG,QAGtB,OAAoB,KAFpBb,EAAOkc,EAAalc,EAAMoD,IAEjBvC,OACAb,GAGToH,EAAI9E,KAAKtC,EAAM,EAAG,EAAGoD,GACdpD,GAGT,GAAIoH,EAAK,CACP,GAA4B,oBAAhBmV,aACRnV,EAAI+V,kBAAkBZ,aAAgB,WAAYnV,EACpD,MAA0B,iBAAfA,EAAIvG,SA+8CLuc,EA/8CkChW,EAAIvG,SAg9CrCuc,EA/8CFlB,EAAalc,EAAM,GAErB0c,EAAc1c,EAAMoH,GAG7B,GAAiB,WAAbA,EAAIlH,MAAqB2N,EAAQzG,EAAIxB,MACvC,OAAO8W,EAAc1c,EAAMoH,EAAIxB,MAw8CrC,IAAgBwX,EAp8Cd,MAAM,IAAI5c,UAAU,sFA9Kb6c,CAAWrd,EAAMxC,GA4B1B,SAAS8f,EAAY5F,GACnB,GAAoB,iBAATA,EACT,MAAM,IAAIlX,UAAU,oCACf,GAAIkX,EAAO,EAChB,MAAM,IAAIjV,WAAW,wCA4BzB,SAAS6Z,EAAatc,EAAM0X,GAG1B,GAFA4F,EAAW5F,GACX1X,EAAOkc,EAAalc,EAAM0X,EAAO,EAAI,EAAoB,EAAhBwF,EAAQxF,KAC5C8C,EAAOyB,oBACV,IAAK,IAAI1f,EAAI,EAAGA,EAAImb,IAAQnb,EAC1ByD,EAAKzD,GAAK,EAGd,OAAOyD,EAwCT,SAAS0c,EAAe1c,EAAM4J,GAC5B,IAAI/I,EAAS+I,EAAM/I,OAAS,EAAI,EAA4B,EAAxBqc,EAAQtT,EAAM/I,QAClDb,EAAOkc,EAAalc,EAAMa,GAC1B,IAAK,IAAItE,EAAI,EAAGA,EAAIsE,EAAQtE,GAAK,EAC/ByD,EAAKzD,GAAgB,IAAXqN,EAAMrN,GAElB,OAAOyD,EA+DT,SAASkd,EAASrc,GAGhB,GAAIA,GAAUmb,IACZ,MAAM,IAAIvZ,WAAW,0DACauZ,IAAa/Q,SAAS,IAAM,UAEhE,OAAgB,EAATpK,EAsFT,SAAS4b,EAAYG,EAAQC,GAC3B,GAAIrC,EAAOD,SAASqC,GAClB,OAAOA,EAAO/b,OAEhB,GAA2B,oBAAhB0b,aAA6D,mBAAvBA,YAAYgB,SACxDhB,YAAYgB,OAAOX,IAAWA,aAAkBL,aACnD,OAAOK,EAAOH,WAEM,iBAAXG,IACTA,EAAS,GAAKA,GAGhB,IAAIxZ,EAAMwZ,EAAO/b,OACjB,GAAY,IAARuC,EAAW,OAAO,EAItB,IADA,IAAIoa,GAAc,IAEhB,OAAQX,GACN,IAAK,QACL,IAAK,SACL,IAAK,SACH,OAAOzZ,EACT,IAAK,OACL,IAAK,QACL,UAAKzD,EACH,OAAO8d,EAAYb,GAAQ/b,OAC7B,IAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACH,OAAa,EAANuC,EACT,IAAK,MACH,OAAOA,IAAQ,EACjB,IAAK,SACH,OAAOsa,EAAcd,GAAQ/b,OAC/B,QACE,GAAI2c,EAAa,OAAOC,EAAYb,GAAQ/b,OAC5Cgc,GAAY,GAAKA,GAAUc,cAC3BH,GAAc,GAMtB,SAASI,EAAcf,EAAUgB,EAAOzV,GACtC,IAAIoV,GAAc,EAclB,SALc7d,IAAVke,GAAuBA,EAAQ,KACjCA,EAAQ,GAINA,EAAQpe,KAAKoB,OACf,MAAO,GAOT,SAJYlB,IAARyI,GAAqBA,EAAM3I,KAAKoB,UAClCuH,EAAM3I,KAAKoB,QAGTuH,GAAO,EACT,MAAO,GAOT,IAHAA,KAAS,KACTyV,KAAW,GAGT,MAAO,GAKT,IAFKhB,IAAUA,EAAW,UAGxB,OAAQA,GACN,IAAK,MACH,OAAOiB,EAASre,KAAMoe,EAAOzV,GAE/B,IAAK,OACL,IAAK,QACH,OAAO2V,EAAUte,KAAMoe,EAAOzV,GAEhC,IAAK,QACH,OAAO4V,EAAWve,KAAMoe,EAAOzV,GAEjC,IAAK,SACL,IAAK,SACH,OAAO6V,EAAYxe,KAAMoe,EAAOzV,GAElC,IAAK,SACH,OAAO8V,EAAYze,KAAMoe,EAAOzV,GAElC,IAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACH,OAAO+V,EAAa1e,KAAMoe,EAAOzV,GAEnC,QACE,GAAIoV,EAAa,MAAM,IAAIhd,UAAU,qBAAuBqc,GAC5DA,GAAYA,EAAW,IAAIc,cAC3BH,GAAc,GAStB,SAASY,EAAM9P,EAAGtQ,EAAGrB,GACnB,IAAIJ,EAAI+R,EAAEtQ,GACVsQ,EAAEtQ,GAAKsQ,EAAE3R,GACT2R,EAAE3R,GAAKJ,EAmIT,SAAS8hB,EAAsBlB,EAAQC,EAAKZ,EAAYK,EAAUtS,GAEhE,GAAsB,IAAlB4S,EAAOtc,OAAc,OAAQ,EAmBjC,GAhB0B,iBAAf2b,GACTK,EAAWL,EACXA,EAAa,GACJA,EAAa,WACtBA,EAAa,WACJA,GAAc,aACvBA,GAAc,YAEhBA,GAAcA,EACVld,MAAMkd,KAERA,EAAajS,EAAM,EAAK4S,EAAOtc,OAAS,GAItC2b,EAAa,IAAGA,EAAaW,EAAOtc,OAAS2b,GAC7CA,GAAcW,EAAOtc,OAAQ,CAC/B,GAAI0J,EAAK,OAAQ,EACZiS,EAAaW,EAAOtc,OAAS,OAC7B,GAAI2b,EAAa,EAAG,CACzB,IAAIjS,EACC,OAAQ,EADJiS,EAAa,EAUxB,GALmB,iBAARY,IACTA,EAAM5C,EAAO/G,KAAK2J,EAAKP,IAIrBrC,EAAOD,SAAS6C,GAElB,OAAmB,IAAfA,EAAIvc,QACE,EAEHyd,EAAanB,EAAQC,EAAKZ,EAAYK,EAAUtS,GAClD,GAAmB,iBAAR6S,EAEhB,OADAA,GAAY,IACR5C,EAAOyB,qBACiC,mBAAjCE,WAAWhe,UAAU6P,QAC1BzD,EACK4R,WAAWhe,UAAU6P,QAAQtR,KAAKygB,EAAQC,EAAKZ,GAE/CL,WAAWhe,UAAUogB,YAAY7hB,KAAKygB,EAAQC,EAAKZ,GAGvD8B,EAAanB,EAAQ,CAAEC,GAAOZ,EAAYK,EAAUtS,GAG7D,MAAM,IAAI/J,UAAU,wCAGtB,SAAS8d,EAActc,EAAKob,EAAKZ,EAAYK,EAAUtS,GACrD,IA0BIhO,EA1BAiiB,EAAY,EACZC,EAAYzc,EAAInB,OAChB6d,EAAYtB,EAAIvc,OAEpB,QAAiBlB,IAAbkd,IAEe,UADjBA,EAAW5b,OAAO4b,GAAUc,gBACY,UAAbd,GACV,YAAbA,GAAuC,aAAbA,GAAyB,CACrD,GAAI7a,EAAInB,OAAS,GAAKuc,EAAIvc,OAAS,EACjC,OAAQ,EAEV2d,EAAY,EACZC,GAAa,EACbC,GAAa,EACblC,GAAc,EAIlB,SAASmC,EAAMC,EAAKriB,GAClB,OAAkB,IAAdiiB,EACKI,EAAIriB,GAEJqiB,EAAIC,aAAatiB,EAAIiiB,GAKhC,GAAIjU,EAAK,CACP,IAAIuU,GAAc,EAClB,IAAKviB,EAAIigB,EAAYjgB,EAAIkiB,EAAWliB,IAClC,GAAIoiB,EAAK3c,EAAKzF,KAAOoiB,EAAKvB,GAAqB,IAAhB0B,EAAoB,EAAIviB,EAAIuiB,IAEzD,IADoB,IAAhBA,IAAmBA,EAAaviB,GAChCA,EAAIuiB,EAAa,IAAMJ,EAAW,OAAOI,EAAaN,OAEtC,IAAhBM,IAAmBviB,GAAKA,EAAIuiB,GAChCA,GAAc,OAKlB,IADItC,EAAakC,EAAYD,IAAWjC,EAAaiC,EAAYC,GAC5DniB,EAAIigB,EAAYjgB,GAAK,EAAGA,IAAK,CAEhC,IADA,IAAIwiB,GAAQ,EACHC,EAAI,EAAGA,EAAIN,EAAWM,IAC7B,GAAIL,EAAK3c,EAAKzF,EAAIyiB,KAAOL,EAAKvB,EAAK4B,GAAI,CACrCD,GAAQ,EACR,MAGJ,GAAIA,EAAO,OAAOxiB,EAItB,OAAQ,EAeV,SAAS0iB,EAAUL,EAAKhC,EAAQsC,EAAQre,GACtCqe,EAAS7f,OAAO6f,IAAW,EAC3B,IAAIC,EAAYP,EAAI/d,OAASqe,EACxBre,GAGHA,EAASxB,OAAOwB,IACHse,IACXte,EAASse,GAJXte,EAASse,EASX,IAAIC,EAASxC,EAAO/b,OACpB,GAAIue,EAAS,GAAM,EAAG,MAAM,IAAI5e,UAAU,sBAEtCK,EAASue,EAAS,IACpBve,EAASue,EAAS,GAEpB,IAAK,IAAI7iB,EAAI,EAAGA,EAAIsE,IAAUtE,EAAG,CAC/B,IAAI8iB,EAASzS,SAASgQ,EAAO0C,OAAW,EAAJ/iB,EAAO,GAAI,IAC/C,GAAI+C,MAAM+f,GAAS,OAAO9iB,EAC1BqiB,EAAIM,EAAS3iB,GAAK8iB,EAEpB,OAAO9iB,EAGT,SAASgjB,EAAWX,EAAKhC,EAAQsC,EAAQre,GACvC,OAAO2e,EAAW/B,EAAYb,EAAQgC,EAAI/d,OAASqe,GAASN,EAAKM,EAAQre,GAG3E,SAAS4e,EAAYb,EAAKhC,EAAQsC,EAAQre,GACxC,OAAO2e,EAq6BT,SAAuBE,GAErB,IADA,IAAIC,EAAY,GACPpjB,EAAI,EAAGA,EAAImjB,EAAI7e,SAAUtE,EAEhCojB,EAAU/e,KAAyB,IAApB8e,EAAIE,WAAWrjB,IAEhC,OAAOojB,EA36BWE,CAAajD,GAASgC,EAAKM,EAAQre,GAGvD,SAASif,EAAalB,EAAKhC,EAAQsC,EAAQre,GACzC,OAAO4e,EAAWb,EAAKhC,EAAQsC,EAAQre,GAGzC,SAASkf,EAAanB,EAAKhC,EAAQsC,EAAQre,GACzC,OAAO2e,EAAW9B,EAAcd,GAASgC,EAAKM,EAAQre,GAGxD,SAASmf,EAAWpB,EAAKhC,EAAQsC,EAAQre,GACvC,OAAO2e,EAk6BT,SAAyBE,EAAKO,GAG5B,IAFA,IAAIrjB,EAAGsjB,EAAIC,EACPR,EAAY,GACPpjB,EAAI,EAAGA,EAAImjB,EAAI7e,WACjBof,GAAS,GAAK,KADa1jB,EAGhCK,EAAI8iB,EAAIE,WAAWrjB,GACnB2jB,EAAKtjB,GAAK,EACVujB,EAAKvjB,EAAI,IACT+iB,EAAU/e,KAAKuf,GACfR,EAAU/e,KAAKsf,GAGjB,OAAOP,EA/6BWS,CAAexD,EAAQgC,EAAI/d,OAASqe,GAASN,EAAKM,EAAQre,GAkF9E,SAASqd,EAAaU,EAAKf,EAAOzV,GAChC,OAAc,IAAVyV,GAAezV,IAAQwW,EAAI/d,OACtBib,EAAOuE,cAAczB,GAErB9C,EAAOuE,cAAczB,EAAI9P,MAAM+O,EAAOzV,IAIjD,SAAS2V,EAAWa,EAAKf,EAAOzV,GAC9BA,EAAMsJ,KAAKoB,IAAI8L,EAAI/d,OAAQuH,GAI3B,IAHA,IAAIuD,EAAM,GAENpP,EAAIshB,EACDthB,EAAI6L,GAAK,CACd,IAQMkY,EAAYC,EAAWC,EAAYC,EARrCC,EAAY9B,EAAIriB,GAChBokB,EAAY,KACZC,EAAoBF,EAAY,IAAQ,EACvCA,EAAY,IAAQ,EACpBA,EAAY,IAAQ,EACrB,EAEJ,GAAInkB,EAAIqkB,GAAoBxY,EAG1B,OAAQwY,GACN,KAAK,EACCF,EAAY,MACdC,EAAYD,GAEd,MACF,KAAK,EAEyB,MAAV,KADlBJ,EAAa1B,EAAIriB,EAAI,OAEnBkkB,GAA6B,GAAZC,IAAqB,EAAoB,GAAbJ,GACzB,MAClBK,EAAYF,GAGhB,MACF,KAAK,EACHH,EAAa1B,EAAIriB,EAAI,GACrBgkB,EAAY3B,EAAIriB,EAAI,GACQ,MAAV,IAAb+jB,IAAsD,MAAV,IAAZC,KACnCE,GAA6B,GAAZC,IAAoB,IAAoB,GAAbJ,IAAsB,EAAmB,GAAZC,GACrD,OAAUE,EAAgB,OAAUA,EAAgB,SACtEE,EAAYF,GAGhB,MACF,KAAK,EACHH,EAAa1B,EAAIriB,EAAI,GACrBgkB,EAAY3B,EAAIriB,EAAI,GACpBikB,EAAa5B,EAAIriB,EAAI,GACO,MAAV,IAAb+jB,IAAsD,MAAV,IAAZC,IAAsD,MAAV,IAAbC,KAClEC,GAA6B,GAAZC,IAAoB,IAAqB,GAAbJ,IAAsB,IAAmB,GAAZC,IAAqB,EAAoB,GAAbC,GAClF,OAAUC,EAAgB,UAC5CE,EAAYF,GAMJ,OAAdE,GAGFA,EAAY,MACZC,EAAmB,GACVD,EAAY,QAErBA,GAAa,MACbhV,EAAI/K,KAAK+f,IAAc,GAAK,KAAQ,OACpCA,EAAY,MAAqB,KAAZA,GAGvBhV,EAAI/K,KAAK+f,GACTpkB,GAAKqkB,EAGP,OAQF,SAAgCC,GAC9B,IAAIzd,EAAMyd,EAAWhgB,OACrB,GAAIuC,GAAO0d,EACT,OAAO7f,OAAO8f,aAAapiB,MAAMsC,OAAQ4f,GAI3C,IAAIlV,EAAM,GACNpP,EAAI,EACR,KAAOA,EAAI6G,GACTuI,GAAO1K,OAAO8f,aAAapiB,MACzBsC,OACA4f,EAAW/R,MAAMvS,EAAGA,GAAKukB,IAG7B,OAAOnV,EAvBAqV,CAAsBrV,GA98B/BtP,EAAQme,OAASA,EACjBne,EAAQ4kB,WAoTR,SAAqBpgB,IACdA,GAAUA,IACbA,EAAS,GAEX,OAAO2Z,EAAO0G,OAAOrgB,IAvTvBxE,EAAQ8kB,kBAAoB,GA0B5B3G,EAAOyB,yBAAqDtc,IAA/BsF,EAAOgX,oBAChChX,EAAOgX,oBAQX,WACE,IACE,IAAIja,EAAM,IAAIma,WAAW,GAEzB,OADAna,EAAIoa,UAAY,CAACA,UAAWD,WAAWhe,UAAWijB,IAAK,WAAc,OAAO,KACvD,KAAdpf,EAAIof,OACiB,mBAAjBpf,EAAIqf,UACuB,IAAlCrf,EAAIqf,SAAS,EAAG,GAAG5E,WACvB,MAAOzV,GACP,OAAO,GAfPsa,GAKJjlB,EAAQ2f,WAAaA,IAkErBxB,EAAO+G,SAAW,KAGlB/G,EAAOgH,SAAW,SAAUxf,GAE1B,OADAA,EAAIoa,UAAY5B,EAAOrc,UAChB6D,GA2BTwY,EAAO/G,KAAO,SAAUjW,EAAO6e,EAAkBxb,GAC/C,OAAO4S,EAAK,KAAMjW,EAAO6e,EAAkBxb,IAGzC2Z,EAAOyB,sBACTzB,EAAOrc,UAAUie,UAAYD,WAAWhe,UACxCqc,EAAO4B,UAAYD,WACG,oBAAX7e,QAA0BA,OAAOmkB,SACxCjH,EAAOld,OAAOmkB,WAAajH,GAE7Bvd,OAAOC,eAAesd,EAAQld,OAAOmkB,QAAS,CAC5CjkB,MAAO,KACPoH,cAAc,KAiCpB4V,EAAO0G,MAAQ,SAAUxJ,EAAMlE,EAAMqJ,GACnC,OArBF,SAAgB7c,EAAM0X,EAAMlE,EAAMqJ,GAEhC,OADAS,EAAW5F,GACPA,GAAQ,EACHwE,EAAalc,EAAM0X,QAEf/X,IAAT6T,EAIyB,iBAAbqJ,EACVX,EAAalc,EAAM0X,GAAMlE,KAAKA,EAAMqJ,GACpCX,EAAalc,EAAM0X,GAAMlE,KAAKA,GAE7B0I,EAAalc,EAAM0X,GAQnBwJ,CAAM,KAAMxJ,EAAMlE,EAAMqJ,IAiBjCrC,EAAO8B,YAAc,SAAU5E,GAC7B,OAAO4E,EAAY,KAAM5E,IAK3B8C,EAAOkH,gBAAkB,SAAUhK,GACjC,OAAO4E,EAAY,KAAM5E,IAiH3B8C,EAAOD,SAAW,SAAmBjM,GACnC,QAAe,MAALA,IAAaA,EAAEqT,YAG3BnH,EAAOoH,QAAU,SAAkBvT,EAAGC,GACpC,IAAKkM,EAAOD,SAASlM,KAAOmM,EAAOD,SAASjM,GAC1C,MAAM,IAAI9N,UAAU,6BAGtB,GAAI6N,IAAMC,EAAG,OAAO,EAKpB,IAHA,IAAI6K,EAAI9K,EAAExN,OACNwY,EAAI/K,EAAEzN,OAEDtE,EAAI,EAAG6G,EAAMsO,KAAKoB,IAAIqG,EAAGE,GAAI9c,EAAI6G,IAAO7G,EAC/C,GAAI8R,EAAE9R,KAAO+R,EAAE/R,GAAI,CACjB4c,EAAI9K,EAAE9R,GACN8c,EAAI/K,EAAE/R,GACN,MAIJ,OAAI4c,EAAIE,GAAW,EACfA,EAAIF,EAAU,EACX,GAGTqB,EAAOsC,WAAa,SAAqBD,GACvC,OAAQ5b,OAAO4b,GAAUc,eACvB,IAAK,MACL,IAAK,OACL,IAAK,QACL,IAAK,QACL,IAAK,SACL,IAAK,SACL,IAAK,SACL,IAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACH,OAAO,EACT,QACE,OAAO,IAIbnD,EAAOrb,OAAS,SAAiBwE,EAAM9C,GACrC,IAAKgN,EAAQlK,GACX,MAAM,IAAInD,UAAU,+CAGtB,GAAoB,IAAhBmD,EAAK9C,OACP,OAAO2Z,EAAO0G,MAAM,GAGtB,IAAI3kB,EACJ,QAAeoD,IAAXkB,EAEF,IADAA,EAAS,EACJtE,EAAI,EAAGA,EAAIoH,EAAK9C,SAAUtE,EAC7BsE,GAAU8C,EAAKpH,GAAGsE,OAItB,IAAIsc,EAAS3C,EAAO8B,YAAYzb,GAC5BghB,EAAM,EACV,IAAKtlB,EAAI,EAAGA,EAAIoH,EAAK9C,SAAUtE,EAAG,CAChC,IAAIqiB,EAAMjb,EAAKpH,GACf,IAAKie,EAAOD,SAASqE,GACnB,MAAM,IAAIpe,UAAU,+CAEtBoe,EAAItc,KAAK6a,EAAQ0E,GACjBA,GAAOjD,EAAI/d,OAEb,OAAOsc,GA8CT3C,EAAOiC,WAAaA,EA0EpBjC,EAAOrc,UAAUwjB,WAAY,EAQ7BnH,EAAOrc,UAAU2jB,OAAS,WACxB,IAAI1e,EAAM3D,KAAKoB,OACf,GAAIuC,EAAM,GAAM,EACd,MAAM,IAAIX,WAAW,6CAEvB,IAAK,IAAIlG,EAAI,EAAGA,EAAI6G,EAAK7G,GAAK,EAC5B6hB,EAAK3e,KAAMlD,EAAGA,EAAI,GAEpB,OAAOkD,MAGT+a,EAAOrc,UAAU4jB,OAAS,WACxB,IAAI3e,EAAM3D,KAAKoB,OACf,GAAIuC,EAAM,GAAM,EACd,MAAM,IAAIX,WAAW,6CAEvB,IAAK,IAAIlG,EAAI,EAAGA,EAAI6G,EAAK7G,GAAK,EAC5B6hB,EAAK3e,KAAMlD,EAAGA,EAAI,GAClB6hB,EAAK3e,KAAMlD,EAAI,EAAGA,EAAI,GAExB,OAAOkD,MAGT+a,EAAOrc,UAAU6jB,OAAS,WACxB,IAAI5e,EAAM3D,KAAKoB,OACf,GAAIuC,EAAM,GAAM,EACd,MAAM,IAAIX,WAAW,6CAEvB,IAAK,IAAIlG,EAAI,EAAGA,EAAI6G,EAAK7G,GAAK,EAC5B6hB,EAAK3e,KAAMlD,EAAGA,EAAI,GAClB6hB,EAAK3e,KAAMlD,EAAI,EAAGA,EAAI,GACtB6hB,EAAK3e,KAAMlD,EAAI,EAAGA,EAAI,GACtB6hB,EAAK3e,KAAMlD,EAAI,EAAGA,EAAI,GAExB,OAAOkD,MAGT+a,EAAOrc,UAAU8M,SAAW,WAC1B,IAAIpK,EAAuB,EAAdpB,KAAKoB,OAClB,OAAe,IAAXA,EAAqB,GACA,IAArBc,UAAUd,OAAqBkd,EAAUte,KAAM,EAAGoB,GAC/C+c,EAAajf,MAAMc,KAAMkC,YAGlC6Y,EAAOrc,UAAU8jB,OAAS,SAAiB3T,GACzC,IAAKkM,EAAOD,SAASjM,GAAI,MAAM,IAAI9N,UAAU,6BAC7C,OAAIf,OAAS6O,GACsB,IAA5BkM,EAAOoH,QAAQniB,KAAM6O,IAG9BkM,EAAOrc,UAAU+jB,QAAU,WACzB,IAAIxC,EAAM,GACN1M,EAAM3W,EAAQ8kB,kBAKlB,OAJI1hB,KAAKoB,OAAS,IAChB6e,EAAMjgB,KAAKwL,SAAS,MAAO,EAAG+H,GAAKxF,MAAM,SAAS1B,KAAK,KACnDrM,KAAKoB,OAASmS,IAAK0M,GAAO,UAEzB,WAAaA,EAAM,KAG5BlF,EAAOrc,UAAUyjB,QAAU,SAAkBhjB,EAAQif,EAAOzV,EAAK+Z,EAAWC,GAC1E,IAAK5H,EAAOD,SAAS3b,GACnB,MAAM,IAAI4B,UAAU,6BAgBtB,QAbcb,IAAVke,IACFA,EAAQ,QAEEle,IAARyI,IACFA,EAAMxJ,EAASA,EAAOiC,OAAS,QAEflB,IAAdwiB,IACFA,EAAY,QAEExiB,IAAZyiB,IACFA,EAAU3iB,KAAKoB,QAGbgd,EAAQ,GAAKzV,EAAMxJ,EAAOiC,QAAUshB,EAAY,GAAKC,EAAU3iB,KAAKoB,OACtE,MAAM,IAAI4B,WAAW,sBAGvB,GAAI0f,GAAaC,GAAWvE,GAASzV,EACnC,OAAO,EAET,GAAI+Z,GAAaC,EACf,OAAQ,EAEV,GAAIvE,GAASzV,EACX,OAAO,EAQT,GAAI3I,OAASb,EAAQ,OAAO,EAS5B,IAPA,IAAIua,GAJJiJ,KAAa,IADbD,KAAe,GAMX9I,GAPJjR,KAAS,IADTyV,KAAW,GASPza,EAAMsO,KAAKoB,IAAIqG,EAAGE,GAElBgJ,EAAW5iB,KAAKqP,MAAMqT,EAAWC,GACjCE,EAAa1jB,EAAOkQ,MAAM+O,EAAOzV,GAE5B7L,EAAI,EAAGA,EAAI6G,IAAO7G,EACzB,GAAI8lB,EAAS9lB,KAAO+lB,EAAW/lB,GAAI,CACjC4c,EAAIkJ,EAAS9lB,GACb8c,EAAIiJ,EAAW/lB,GACf,MAIJ,OAAI4c,EAAIE,GAAW,EACfA,EAAIF,EAAU,EACX,GA6HTqB,EAAOrc,UAAUokB,SAAW,SAAmBnF,EAAKZ,EAAYK,GAC9D,OAAoD,IAA7Cpd,KAAKuO,QAAQoP,EAAKZ,EAAYK,IAGvCrC,EAAOrc,UAAU6P,QAAU,SAAkBoP,EAAKZ,EAAYK,GAC5D,OAAOwB,EAAqB5e,KAAM2d,EAAKZ,EAAYK,GAAU,IAG/DrC,EAAOrc,UAAUogB,YAAc,SAAsBnB,EAAKZ,EAAYK,GACpE,OAAOwB,EAAqB5e,KAAM2d,EAAKZ,EAAYK,GAAU,IAkD/DrC,EAAOrc,UAAU6e,MAAQ,SAAgBJ,EAAQsC,EAAQre,EAAQgc,GAE/D,QAAeld,IAAXuf,EACFrC,EAAW,OACXhc,EAASpB,KAAKoB,OACdqe,EAAS,OAEJ,QAAevf,IAAXkB,GAA0C,iBAAXqe,EACxCrC,EAAWqC,EACXre,EAASpB,KAAKoB,OACdqe,EAAS,MAEJ,KAAIsD,SAAStD,GAWlB,MAAM,IAAIle,MACR,2EAXFke,GAAkB,EACdsD,SAAS3hB,IACXA,GAAkB,OACDlB,IAAbkd,IAAwBA,EAAW,UAEvCA,EAAWhc,EACXA,OAASlB,GASb,IAAIwf,EAAY1f,KAAKoB,OAASqe,EAG9B,SAFevf,IAAXkB,GAAwBA,EAASse,KAAWte,EAASse,GAEpDvC,EAAO/b,OAAS,IAAMA,EAAS,GAAKqe,EAAS,IAAOA,EAASzf,KAAKoB,OACrE,MAAM,IAAI4B,WAAW,0CAGlBoa,IAAUA,EAAW,QAG1B,IADA,IAAIW,GAAc,IAEhB,OAAQX,GACN,IAAK,MACH,OAAOoC,EAASxf,KAAMmd,EAAQsC,EAAQre,GAExC,IAAK,OACL,IAAK,QACH,OAAO0e,EAAU9f,KAAMmd,EAAQsC,EAAQre,GAEzC,IAAK,QACH,OAAO4e,EAAWhgB,KAAMmd,EAAQsC,EAAQre,GAE1C,IAAK,SACL,IAAK,SACH,OAAOif,EAAYrgB,KAAMmd,EAAQsC,EAAQre,GAE3C,IAAK,SAEH,OAAOkf,EAAYtgB,KAAMmd,EAAQsC,EAAQre,GAE3C,IAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACH,OAAOmf,EAAUvgB,KAAMmd,EAAQsC,EAAQre,GAEzC,QACE,GAAI2c,EAAa,MAAM,IAAIhd,UAAU,qBAAuBqc,GAC5DA,GAAY,GAAKA,GAAUc,cAC3BH,GAAc,IAKtBhD,EAAOrc,UAAUskB,OAAS,WACxB,MAAO,CACLviB,KAAM,SACN0F,KAAM1D,MAAM/D,UAAU2Q,MAAMpS,KAAK+C,KAAKijB,MAAQjjB,KAAM,KAwFxD,IAAIqhB,EAAuB,KAoB3B,SAAS9C,EAAYY,EAAKf,EAAOzV,GAC/B,IAAInG,EAAM,GACVmG,EAAMsJ,KAAKoB,IAAI8L,EAAI/d,OAAQuH,GAE3B,IAAK,IAAI7L,EAAIshB,EAAOthB,EAAI6L,IAAO7L,EAC7B0F,GAAOhB,OAAO8f,aAAsB,IAATnC,EAAIriB,IAEjC,OAAO0F,EAGT,SAASgc,EAAaW,EAAKf,EAAOzV,GAChC,IAAInG,EAAM,GACVmG,EAAMsJ,KAAKoB,IAAI8L,EAAI/d,OAAQuH,GAE3B,IAAK,IAAI7L,EAAIshB,EAAOthB,EAAI6L,IAAO7L,EAC7B0F,GAAOhB,OAAO8f,aAAanC,EAAIriB,IAEjC,OAAO0F,EAGT,SAAS6b,EAAUc,EAAKf,EAAOzV,GAC7B,IAAIhF,EAAMwb,EAAI/d,SAETgd,GAASA,EAAQ,KAAGA,EAAQ,KAC5BzV,GAAOA,EAAM,GAAKA,EAAMhF,KAAKgF,EAAMhF,GAGxC,IADA,IAAIuf,EAAM,GACDpmB,EAAIshB,EAAOthB,EAAI6L,IAAO7L,EAC7BomB,GAAOC,EAAMhE,EAAIriB,IAEnB,OAAOomB,EAGT,SAASxE,EAAcS,EAAKf,EAAOzV,GAGjC,IAFA,IAAIya,EAAQjE,EAAI9P,MAAM+O,EAAOzV,GACzBuD,EAAM,GACDpP,EAAI,EAAGA,EAAIsmB,EAAMhiB,OAAQtE,GAAK,EACrCoP,GAAO1K,OAAO8f,aAAa8B,EAAMtmB,GAAoB,IAAfsmB,EAAMtmB,EAAI,IAElD,OAAOoP,EA0CT,SAASmX,EAAa5D,EAAQ6D,EAAKliB,GACjC,GAAKqe,EAAS,GAAO,GAAKA,EAAS,EAAG,MAAM,IAAIzc,WAAW,sBAC3D,GAAIyc,EAAS6D,EAAMliB,EAAQ,MAAM,IAAI4B,WAAW,yCA+JlD,SAASugB,EAAUpE,EAAKphB,EAAO0hB,EAAQ6D,EAAK/P,EAAKF,GAC/C,IAAK0H,EAAOD,SAASqE,GAAM,MAAM,IAAIpe,UAAU,+CAC/C,GAAIhD,EAAQwV,GAAOxV,EAAQsV,EAAK,MAAM,IAAIrQ,WAAW,qCACrD,GAAIyc,EAAS6D,EAAMnE,EAAI/d,OAAQ,MAAM,IAAI4B,WAAW,sBAkDtD,SAASwgB,EAAmBrE,EAAKphB,EAAO0hB,EAAQgE,GAC1C1lB,EAAQ,IAAGA,EAAQ,MAASA,EAAQ,GACxC,IAAK,IAAIjB,EAAI,EAAGyiB,EAAItN,KAAKoB,IAAI8L,EAAI/d,OAASqe,EAAQ,GAAI3iB,EAAIyiB,IAAKziB,EAC7DqiB,EAAIM,EAAS3iB,IAAMiB,EAAS,KAAS,GAAK0lB,EAAe3mB,EAAI,EAAIA,MAClC,GAA5B2mB,EAAe3mB,EAAI,EAAIA,GA8B9B,SAAS4mB,EAAmBvE,EAAKphB,EAAO0hB,EAAQgE,GAC1C1lB,EAAQ,IAAGA,EAAQ,WAAaA,EAAQ,GAC5C,IAAK,IAAIjB,EAAI,EAAGyiB,EAAItN,KAAKoB,IAAI8L,EAAI/d,OAASqe,EAAQ,GAAI3iB,EAAIyiB,IAAKziB,EAC7DqiB,EAAIM,EAAS3iB,GAAMiB,IAAuC,GAA5B0lB,EAAe3mB,EAAI,EAAIA,GAAU,IAmJnE,SAAS6mB,EAAcxE,EAAKphB,EAAO0hB,EAAQ6D,EAAK/P,EAAKF,GACnD,GAAIoM,EAAS6D,EAAMnE,EAAI/d,OAAQ,MAAM,IAAI4B,WAAW,sBACpD,GAAIyc,EAAS,EAAG,MAAM,IAAIzc,WAAW,sBAGvC,SAAS4gB,EAAYzE,EAAKphB,EAAO0hB,EAAQgE,EAAcI,GAKrD,OAJKA,GACHF,EAAaxE,EAAKphB,EAAO0hB,EAAQ,GAEnCnD,EAAQiB,MAAM4B,EAAKphB,EAAO0hB,EAAQgE,EAAc,GAAI,GAC7ChE,EAAS,EAWlB,SAASqE,EAAa3E,EAAKphB,EAAO0hB,EAAQgE,EAAcI,GAKtD,OAJKA,GACHF,EAAaxE,EAAKphB,EAAO0hB,EAAQ,GAEnCnD,EAAQiB,MAAM4B,EAAKphB,EAAO0hB,EAAQgE,EAAc,GAAI,GAC7ChE,EAAS,EA/clB1E,EAAOrc,UAAU2Q,MAAQ,SAAgB+O,EAAOzV,GAC9C,IAoBIob,EApBApgB,EAAM3D,KAAKoB,OAqBf,IApBAgd,IAAUA,GAGE,GACVA,GAASza,GACG,IAAGya,EAAQ,GACdA,EAAQza,IACjBya,EAAQza,IANVgF,OAAczI,IAARyI,EAAoBhF,IAAQgF,GASxB,GACRA,GAAOhF,GACG,IAAGgF,EAAM,GACVA,EAAMhF,IACfgF,EAAMhF,GAGJgF,EAAMyV,IAAOzV,EAAMyV,GAGnBrD,EAAOyB,qBACTuH,EAAS/jB,KAAK4hB,SAASxD,EAAOzV,IACvBgU,UAAY5B,EAAOrc,cACrB,CACL,IAAIslB,EAAWrb,EAAMyV,EACrB2F,EAAS,IAAIhJ,EAAOiJ,OAAU9jB,GAC9B,IAAK,IAAIpD,EAAI,EAAGA,EAAIknB,IAAYlnB,EAC9BinB,EAAOjnB,GAAKkD,KAAKlD,EAAIshB,GAIzB,OAAO2F,GAWThJ,EAAOrc,UAAUulB,WAAa,SAAqBxE,EAAQzC,EAAY6G,GACrEpE,GAAkB,EAClBzC,GAA0B,EACrB6G,GAAUR,EAAY5D,EAAQzC,EAAYhd,KAAKoB,QAKpD,IAHA,IAAIuc,EAAM3d,KAAKyf,GACXyE,EAAM,EACNpnB,EAAI,IACCA,EAAIkgB,IAAekH,GAAO,MACjCvG,GAAO3d,KAAKyf,EAAS3iB,GAAKonB,EAG5B,OAAOvG,GAGT5C,EAAOrc,UAAUylB,WAAa,SAAqB1E,EAAQzC,EAAY6G,GACrEpE,GAAkB,EAClBzC,GAA0B,EACrB6G,GACHR,EAAY5D,EAAQzC,EAAYhd,KAAKoB,QAKvC,IAFA,IAAIuc,EAAM3d,KAAKyf,IAAWzC,GACtBkH,EAAM,EACHlH,EAAa,IAAMkH,GAAO,MAC/BvG,GAAO3d,KAAKyf,IAAWzC,GAAckH,EAGvC,OAAOvG,GAGT5C,EAAOrc,UAAU0lB,UAAY,SAAoB3E,EAAQoE,GAEvD,OADKA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QACpCpB,KAAKyf,IAGd1E,EAAOrc,UAAU2lB,aAAe,SAAuB5E,EAAQoE,GAE7D,OADKA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QACpCpB,KAAKyf,GAAWzf,KAAKyf,EAAS,IAAM,GAG7C1E,EAAOrc,UAAU0gB,aAAe,SAAuBK,EAAQoE,GAE7D,OADKA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QACnCpB,KAAKyf,IAAW,EAAKzf,KAAKyf,EAAS,IAG7C1E,EAAOrc,UAAU4lB,aAAe,SAAuB7E,EAAQoE,GAG7D,OAFKA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,SAElCpB,KAAKyf,GACTzf,KAAKyf,EAAS,IAAM,EACpBzf,KAAKyf,EAAS,IAAM,IACD,SAAnBzf,KAAKyf,EAAS,IAGrB1E,EAAOrc,UAAU6lB,aAAe,SAAuB9E,EAAQoE,GAG7D,OAFKA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QAEpB,SAAfpB,KAAKyf,IACTzf,KAAKyf,EAAS,IAAM,GACrBzf,KAAKyf,EAAS,IAAM,EACrBzf,KAAKyf,EAAS,KAGlB1E,EAAOrc,UAAU8lB,UAAY,SAAoB/E,EAAQzC,EAAY6G,GACnEpE,GAAkB,EAClBzC,GAA0B,EACrB6G,GAAUR,EAAY5D,EAAQzC,EAAYhd,KAAKoB,QAKpD,IAHA,IAAIuc,EAAM3d,KAAKyf,GACXyE,EAAM,EACNpnB,EAAI,IACCA,EAAIkgB,IAAekH,GAAO,MACjCvG,GAAO3d,KAAKyf,EAAS3iB,GAAKonB,EAM5B,OAFIvG,IAFJuG,GAAO,OAESvG,GAAO1L,KAAKwS,IAAI,EAAG,EAAIzH,IAEhCW,GAGT5C,EAAOrc,UAAUgmB,UAAY,SAAoBjF,EAAQzC,EAAY6G,GACnEpE,GAAkB,EAClBzC,GAA0B,EACrB6G,GAAUR,EAAY5D,EAAQzC,EAAYhd,KAAKoB,QAKpD,IAHA,IAAItE,EAAIkgB,EACJkH,EAAM,EACNvG,EAAM3d,KAAKyf,IAAW3iB,GACnBA,EAAI,IAAMonB,GAAO,MACtBvG,GAAO3d,KAAKyf,IAAW3iB,GAAKonB,EAM9B,OAFIvG,IAFJuG,GAAO,OAESvG,GAAO1L,KAAKwS,IAAI,EAAG,EAAIzH,IAEhCW,GAGT5C,EAAOrc,UAAUimB,SAAW,SAAmBlF,EAAQoE,GAErD,OADKA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QACtB,IAAfpB,KAAKyf,IAC0B,GAA5B,IAAOzf,KAAKyf,GAAU,GADKzf,KAAKyf,IAI3C1E,EAAOrc,UAAUkmB,YAAc,SAAsBnF,EAAQoE,GACtDA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QAC3C,IAAIuc,EAAM3d,KAAKyf,GAAWzf,KAAKyf,EAAS,IAAM,EAC9C,OAAc,MAAN9B,EAAsB,WAANA,EAAmBA,GAG7C5C,EAAOrc,UAAUmmB,YAAc,SAAsBpF,EAAQoE,GACtDA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QAC3C,IAAIuc,EAAM3d,KAAKyf,EAAS,GAAMzf,KAAKyf,IAAW,EAC9C,OAAc,MAAN9B,EAAsB,WAANA,EAAmBA,GAG7C5C,EAAOrc,UAAUomB,YAAc,SAAsBrF,EAAQoE,GAG3D,OAFKA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QAEnCpB,KAAKyf,GACVzf,KAAKyf,EAAS,IAAM,EACpBzf,KAAKyf,EAAS,IAAM,GACpBzf,KAAKyf,EAAS,IAAM,IAGzB1E,EAAOrc,UAAUqmB,YAAc,SAAsBtF,EAAQoE,GAG3D,OAFKA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QAEnCpB,KAAKyf,IAAW,GACrBzf,KAAKyf,EAAS,IAAM,GACpBzf,KAAKyf,EAAS,IAAM,EACpBzf,KAAKyf,EAAS,IAGnB1E,EAAOrc,UAAUsmB,YAAc,SAAsBvF,EAAQoE,GAE3D,OADKA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QACpCkb,EAAQ4C,KAAKlf,KAAMyf,GAAQ,EAAM,GAAI,IAG9C1E,EAAOrc,UAAUumB,YAAc,SAAsBxF,EAAQoE,GAE3D,OADKA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QACpCkb,EAAQ4C,KAAKlf,KAAMyf,GAAQ,EAAO,GAAI,IAG/C1E,EAAOrc,UAAUwmB,aAAe,SAAuBzF,EAAQoE,GAE7D,OADKA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QACpCkb,EAAQ4C,KAAKlf,KAAMyf,GAAQ,EAAM,GAAI,IAG9C1E,EAAOrc,UAAUymB,aAAe,SAAuB1F,EAAQoE,GAE7D,OADKA,GAAUR,EAAY5D,EAAQ,EAAGzf,KAAKoB,QACpCkb,EAAQ4C,KAAKlf,KAAMyf,GAAQ,EAAO,GAAI,IAS/C1E,EAAOrc,UAAU0mB,YAAc,SAAsBrnB,EAAO0hB,EAAQzC,EAAY6G,IAC9E9lB,GAASA,EACT0hB,GAAkB,EAClBzC,GAA0B,EACrB6G,IAEHN,EAASvjB,KAAMjC,EAAO0hB,EAAQzC,EADf/K,KAAKwS,IAAI,EAAG,EAAIzH,GAAc,EACO,GAGtD,IAAIkH,EAAM,EACNpnB,EAAI,EAER,IADAkD,KAAKyf,GAAkB,IAAR1hB,IACNjB,EAAIkgB,IAAekH,GAAO,MACjClkB,KAAKyf,EAAS3iB,GAAMiB,EAAQmmB,EAAO,IAGrC,OAAOzE,EAASzC,GAGlBjC,EAAOrc,UAAU2mB,YAAc,SAAsBtnB,EAAO0hB,EAAQzC,EAAY6G,IAC9E9lB,GAASA,EACT0hB,GAAkB,EAClBzC,GAA0B,EACrB6G,IAEHN,EAASvjB,KAAMjC,EAAO0hB,EAAQzC,EADf/K,KAAKwS,IAAI,EAAG,EAAIzH,GAAc,EACO,GAGtD,IAAIlgB,EAAIkgB,EAAa,EACjBkH,EAAM,EAEV,IADAlkB,KAAKyf,EAAS3iB,GAAa,IAARiB,IACVjB,GAAK,IAAMonB,GAAO,MACzBlkB,KAAKyf,EAAS3iB,GAAMiB,EAAQmmB,EAAO,IAGrC,OAAOzE,EAASzC,GAGlBjC,EAAOrc,UAAU4mB,WAAa,SAAqBvnB,EAAO0hB,EAAQoE,GAMhE,OALA9lB,GAASA,EACT0hB,GAAkB,EACboE,GAAUN,EAASvjB,KAAMjC,EAAO0hB,EAAQ,EAAG,IAAM,GACjD1E,EAAOyB,sBAAqBze,EAAQkU,KAAKsT,MAAMxnB,IACpDiC,KAAKyf,GAAmB,IAAR1hB,EACT0hB,EAAS,GAWlB1E,EAAOrc,UAAU8mB,cAAgB,SAAwBznB,EAAO0hB,EAAQoE,GAUtE,OATA9lB,GAASA,EACT0hB,GAAkB,EACboE,GAAUN,EAASvjB,KAAMjC,EAAO0hB,EAAQ,EAAG,MAAQ,GACpD1E,EAAOyB,qBACTxc,KAAKyf,GAAmB,IAAR1hB,EAChBiC,KAAKyf,EAAS,GAAM1hB,IAAU,GAE9BylB,EAAkBxjB,KAAMjC,EAAO0hB,GAAQ,GAElCA,EAAS,GAGlB1E,EAAOrc,UAAU+mB,cAAgB,SAAwB1nB,EAAO0hB,EAAQoE,GAUtE,OATA9lB,GAASA,EACT0hB,GAAkB,EACboE,GAAUN,EAASvjB,KAAMjC,EAAO0hB,EAAQ,EAAG,MAAQ,GACpD1E,EAAOyB,qBACTxc,KAAKyf,GAAW1hB,IAAU,EAC1BiC,KAAKyf,EAAS,GAAc,IAAR1hB,GAEpBylB,EAAkBxjB,KAAMjC,EAAO0hB,GAAQ,GAElCA,EAAS,GAUlB1E,EAAOrc,UAAUgnB,cAAgB,SAAwB3nB,EAAO0hB,EAAQoE,GAYtE,OAXA9lB,GAASA,EACT0hB,GAAkB,EACboE,GAAUN,EAASvjB,KAAMjC,EAAO0hB,EAAQ,EAAG,WAAY,GACxD1E,EAAOyB,qBACTxc,KAAKyf,EAAS,GAAM1hB,IAAU,GAC9BiC,KAAKyf,EAAS,GAAM1hB,IAAU,GAC9BiC,KAAKyf,EAAS,GAAM1hB,IAAU,EAC9BiC,KAAKyf,GAAmB,IAAR1hB,GAEhB2lB,EAAkB1jB,KAAMjC,EAAO0hB,GAAQ,GAElCA,EAAS,GAGlB1E,EAAOrc,UAAUinB,cAAgB,SAAwB5nB,EAAO0hB,EAAQoE,GAYtE,OAXA9lB,GAASA,EACT0hB,GAAkB,EACboE,GAAUN,EAASvjB,KAAMjC,EAAO0hB,EAAQ,EAAG,WAAY,GACxD1E,EAAOyB,qBACTxc,KAAKyf,GAAW1hB,IAAU,GAC1BiC,KAAKyf,EAAS,GAAM1hB,IAAU,GAC9BiC,KAAKyf,EAAS,GAAM1hB,IAAU,EAC9BiC,KAAKyf,EAAS,GAAc,IAAR1hB,GAEpB2lB,EAAkB1jB,KAAMjC,EAAO0hB,GAAQ,GAElCA,EAAS,GAGlB1E,EAAOrc,UAAUknB,WAAa,SAAqB7nB,EAAO0hB,EAAQzC,EAAY6G,GAG5E,GAFA9lB,GAASA,EACT0hB,GAAkB,GACboE,EAAU,CACb,IAAIgC,EAAQ5T,KAAKwS,IAAI,EAAG,EAAIzH,EAAa,GAEzCuG,EAASvjB,KAAMjC,EAAO0hB,EAAQzC,EAAY6I,EAAQ,GAAIA,GAGxD,IAAI/oB,EAAI,EACJonB,EAAM,EACN4B,EAAM,EAEV,IADA9lB,KAAKyf,GAAkB,IAAR1hB,IACNjB,EAAIkgB,IAAekH,GAAO,MAC7BnmB,EAAQ,GAAa,IAAR+nB,GAAsC,IAAzB9lB,KAAKyf,EAAS3iB,EAAI,KAC9CgpB,EAAM,GAER9lB,KAAKyf,EAAS3iB,IAAOiB,EAAQmmB,GAAQ,GAAK4B,EAAM,IAGlD,OAAOrG,EAASzC,GAGlBjC,EAAOrc,UAAUqnB,WAAa,SAAqBhoB,EAAO0hB,EAAQzC,EAAY6G,GAG5E,GAFA9lB,GAASA,EACT0hB,GAAkB,GACboE,EAAU,CACb,IAAIgC,EAAQ5T,KAAKwS,IAAI,EAAG,EAAIzH,EAAa,GAEzCuG,EAASvjB,KAAMjC,EAAO0hB,EAAQzC,EAAY6I,EAAQ,GAAIA,GAGxD,IAAI/oB,EAAIkgB,EAAa,EACjBkH,EAAM,EACN4B,EAAM,EAEV,IADA9lB,KAAKyf,EAAS3iB,GAAa,IAARiB,IACVjB,GAAK,IAAMonB,GAAO,MACrBnmB,EAAQ,GAAa,IAAR+nB,GAAsC,IAAzB9lB,KAAKyf,EAAS3iB,EAAI,KAC9CgpB,EAAM,GAER9lB,KAAKyf,EAAS3iB,IAAOiB,EAAQmmB,GAAQ,GAAK4B,EAAM,IAGlD,OAAOrG,EAASzC,GAGlBjC,EAAOrc,UAAUsnB,UAAY,SAAoBjoB,EAAO0hB,EAAQoE,GAO9D,OANA9lB,GAASA,EACT0hB,GAAkB,EACboE,GAAUN,EAASvjB,KAAMjC,EAAO0hB,EAAQ,EAAG,KAAO,KAClD1E,EAAOyB,sBAAqBze,EAAQkU,KAAKsT,MAAMxnB,IAChDA,EAAQ,IAAGA,EAAQ,IAAOA,EAAQ,GACtCiC,KAAKyf,GAAmB,IAAR1hB,EACT0hB,EAAS,GAGlB1E,EAAOrc,UAAUunB,aAAe,SAAuBloB,EAAO0hB,EAAQoE,GAUpE,OATA9lB,GAASA,EACT0hB,GAAkB,EACboE,GAAUN,EAASvjB,KAAMjC,EAAO0hB,EAAQ,EAAG,OAAS,OACrD1E,EAAOyB,qBACTxc,KAAKyf,GAAmB,IAAR1hB,EAChBiC,KAAKyf,EAAS,GAAM1hB,IAAU,GAE9BylB,EAAkBxjB,KAAMjC,EAAO0hB,GAAQ,GAElCA,EAAS,GAGlB1E,EAAOrc,UAAUwnB,aAAe,SAAuBnoB,EAAO0hB,EAAQoE,GAUpE,OATA9lB,GAASA,EACT0hB,GAAkB,EACboE,GAAUN,EAASvjB,KAAMjC,EAAO0hB,EAAQ,EAAG,OAAS,OACrD1E,EAAOyB,qBACTxc,KAAKyf,GAAW1hB,IAAU,EAC1BiC,KAAKyf,EAAS,GAAc,IAAR1hB,GAEpBylB,EAAkBxjB,KAAMjC,EAAO0hB,GAAQ,GAElCA,EAAS,GAGlB1E,EAAOrc,UAAUynB,aAAe,SAAuBpoB,EAAO0hB,EAAQoE,GAYpE,OAXA9lB,GAASA,EACT0hB,GAAkB,EACboE,GAAUN,EAASvjB,KAAMjC,EAAO0hB,EAAQ,EAAG,YAAa,YACzD1E,EAAOyB,qBACTxc,KAAKyf,GAAmB,IAAR1hB,EAChBiC,KAAKyf,EAAS,GAAM1hB,IAAU,EAC9BiC,KAAKyf,EAAS,GAAM1hB,IAAU,GAC9BiC,KAAKyf,EAAS,GAAM1hB,IAAU,IAE9B2lB,EAAkB1jB,KAAMjC,EAAO0hB,GAAQ,GAElCA,EAAS,GAGlB1E,EAAOrc,UAAU0nB,aAAe,SAAuBroB,EAAO0hB,EAAQoE,GAapE,OAZA9lB,GAASA,EACT0hB,GAAkB,EACboE,GAAUN,EAASvjB,KAAMjC,EAAO0hB,EAAQ,EAAG,YAAa,YACzD1hB,EAAQ,IAAGA,EAAQ,WAAaA,EAAQ,GACxCgd,EAAOyB,qBACTxc,KAAKyf,GAAW1hB,IAAU,GAC1BiC,KAAKyf,EAAS,GAAM1hB,IAAU,GAC9BiC,KAAKyf,EAAS,GAAM1hB,IAAU,EAC9BiC,KAAKyf,EAAS,GAAc,IAAR1hB,GAEpB2lB,EAAkB1jB,KAAMjC,EAAO0hB,GAAQ,GAElCA,EAAS,GAgBlB1E,EAAOrc,UAAU2nB,aAAe,SAAuBtoB,EAAO0hB,EAAQoE,GACpE,OAAOD,EAAW5jB,KAAMjC,EAAO0hB,GAAQ,EAAMoE,IAG/C9I,EAAOrc,UAAU4nB,aAAe,SAAuBvoB,EAAO0hB,EAAQoE,GACpE,OAAOD,EAAW5jB,KAAMjC,EAAO0hB,GAAQ,EAAOoE,IAWhD9I,EAAOrc,UAAU6nB,cAAgB,SAAwBxoB,EAAO0hB,EAAQoE,GACtE,OAAOC,EAAY9jB,KAAMjC,EAAO0hB,GAAQ,EAAMoE,IAGhD9I,EAAOrc,UAAU8nB,cAAgB,SAAwBzoB,EAAO0hB,EAAQoE,GACtE,OAAOC,EAAY9jB,KAAMjC,EAAO0hB,GAAQ,EAAOoE,IAIjD9I,EAAOrc,UAAUmE,KAAO,SAAe1D,EAAQsnB,EAAarI,EAAOzV,GAQjE,GAPKyV,IAAOA,EAAQ,GACfzV,GAAe,IAARA,IAAWA,EAAM3I,KAAKoB,QAC9BqlB,GAAetnB,EAAOiC,SAAQqlB,EAActnB,EAAOiC,QAClDqlB,IAAaA,EAAc,GAC5B9d,EAAM,GAAKA,EAAMyV,IAAOzV,EAAMyV,GAG9BzV,IAAQyV,EAAO,OAAO,EAC1B,GAAsB,IAAlBjf,EAAOiC,QAAgC,IAAhBpB,KAAKoB,OAAc,OAAO,EAGrD,GAAIqlB,EAAc,EAChB,MAAM,IAAIzjB,WAAW,6BAEvB,GAAIob,EAAQ,GAAKA,GAASpe,KAAKoB,OAAQ,MAAM,IAAI4B,WAAW,6BAC5D,GAAI2F,EAAM,EAAG,MAAM,IAAI3F,WAAW,2BAG9B2F,EAAM3I,KAAKoB,SAAQuH,EAAM3I,KAAKoB,QAC9BjC,EAAOiC,OAASqlB,EAAc9d,EAAMyV,IACtCzV,EAAMxJ,EAAOiC,OAASqlB,EAAcrI,GAGtC,IACIthB,EADA6G,EAAMgF,EAAMyV,EAGhB,GAAIpe,OAASb,GAAUif,EAAQqI,GAAeA,EAAc9d,EAE1D,IAAK7L,EAAI6G,EAAM,EAAG7G,GAAK,IAAKA,EAC1BqC,EAAOrC,EAAI2pB,GAAezmB,KAAKlD,EAAIshB,QAEhC,GAAIza,EAAM,MAASoX,EAAOyB,oBAE/B,IAAK1f,EAAI,EAAGA,EAAI6G,IAAO7G,EACrBqC,EAAOrC,EAAI2pB,GAAezmB,KAAKlD,EAAIshB,QAGrC1B,WAAWhe,UAAUoE,IAAI7F,KACvBkC,EACAa,KAAK4hB,SAASxD,EAAOA,EAAQza,GAC7B8iB,GAIJ,OAAO9iB,GAOToX,EAAOrc,UAAUqV,KAAO,SAAe4J,EAAKS,EAAOzV,EAAKyU,GAEtD,GAAmB,iBAARO,EAAkB,CAS3B,GARqB,iBAAVS,GACThB,EAAWgB,EACXA,EAAQ,EACRzV,EAAM3I,KAAKoB,QACa,iBAARuH,IAChByU,EAAWzU,EACXA,EAAM3I,KAAKoB,QAEM,IAAfuc,EAAIvc,OAAc,CACpB,IAAIslB,EAAO/I,EAAIwC,WAAW,GACtBuG,EAAO,MACT/I,EAAM+I,GAGV,QAAiBxmB,IAAbkd,GAA8C,iBAAbA,EACnC,MAAM,IAAIrc,UAAU,6BAEtB,GAAwB,iBAAbqc,IAA0BrC,EAAOsC,WAAWD,GACrD,MAAM,IAAIrc,UAAU,qBAAuBqc,OAErB,iBAARO,IAChBA,GAAY,KAId,GAAIS,EAAQ,GAAKpe,KAAKoB,OAASgd,GAASpe,KAAKoB,OAASuH,EACpD,MAAM,IAAI3F,WAAW,sBAGvB,GAAI2F,GAAOyV,EACT,OAAOpe,KAQT,IAAIlD,EACJ,GANAshB,KAAkB,EAClBzV,OAAczI,IAARyI,EAAoB3I,KAAKoB,OAASuH,IAAQ,EAE3CgV,IAAKA,EAAM,GAGG,iBAARA,EACT,IAAK7gB,EAAIshB,EAAOthB,EAAI6L,IAAO7L,EACzBkD,KAAKlD,GAAK6gB,MAEP,CACL,IAAIyF,EAAQrI,EAAOD,SAAS6C,GACxBA,EACAK,EAAY,IAAIjD,EAAO4C,EAAKP,GAAU5R,YACtC7H,EAAMyf,EAAMhiB,OAChB,IAAKtE,EAAI,EAAGA,EAAI6L,EAAMyV,IAASthB,EAC7BkD,KAAKlD,EAAIshB,GAASgF,EAAMtmB,EAAI6G,GAIhC,OAAO3D,MAMT,IAAI2mB,EAAoB,qBAmBxB,SAASxD,EAAO5kB,GACd,OAAIA,EAAI,GAAW,IAAMA,EAAEiN,SAAS,IAC7BjN,EAAEiN,SAAS,IAGpB,SAASwS,EAAab,EAAQqD,GAE5B,IAAIU,EADJV,EAAQA,GAASoG,IAMjB,IAJA,IAAIxlB,EAAS+b,EAAO/b,OAChBylB,EAAgB,KAChBzD,EAAQ,GAEHtmB,EAAI,EAAGA,EAAIsE,IAAUtE,EAAG,CAI/B,IAHAokB,EAAY/D,EAAOgD,WAAWrjB,IAGd,OAAUokB,EAAY,MAAQ,CAE5C,IAAK2F,EAAe,CAElB,GAAI3F,EAAY,MAAQ,EAEjBV,GAAS,IAAM,GAAG4C,EAAMjiB,KAAK,IAAM,IAAM,KAC9C,SACK,GAAIrE,EAAI,IAAMsE,EAAQ,EAEtBof,GAAS,IAAM,GAAG4C,EAAMjiB,KAAK,IAAM,IAAM,KAC9C,SAIF0lB,EAAgB3F,EAEhB,SAIF,GAAIA,EAAY,MAAQ,EACjBV,GAAS,IAAM,GAAG4C,EAAMjiB,KAAK,IAAM,IAAM,KAC9C0lB,EAAgB3F,EAChB,SAIFA,EAAkE,OAArD2F,EAAgB,OAAU,GAAK3F,EAAY,YAC/C2F,IAEJrG,GAAS,IAAM,GAAG4C,EAAMjiB,KAAK,IAAM,IAAM,KAMhD,GAHA0lB,EAAgB,KAGZ3F,EAAY,IAAM,CACpB,IAAKV,GAAS,GAAK,EAAG,MACtB4C,EAAMjiB,KAAK+f,QACN,GAAIA,EAAY,KAAO,CAC5B,IAAKV,GAAS,GAAK,EAAG,MACtB4C,EAAMjiB,KACJ+f,GAAa,EAAM,IACP,GAAZA,EAAmB,UAEhB,GAAIA,EAAY,MAAS,CAC9B,IAAKV,GAAS,GAAK,EAAG,MACtB4C,EAAMjiB,KACJ+f,GAAa,GAAM,IACnBA,GAAa,EAAM,GAAO,IACd,GAAZA,EAAmB,SAEhB,MAAIA,EAAY,SASrB,MAAM,IAAI3f,MAAM,sBARhB,IAAKif,GAAS,GAAK,EAAG,MACtB4C,EAAMjiB,KACJ+f,GAAa,GAAO,IACpBA,GAAa,GAAM,GAAO,IAC1BA,GAAa,EAAM,GAAO,IACd,GAAZA,EAAmB,MAOzB,OAAOkC,EA4BT,SAASnF,EAAegC,GACtB,OAAO5D,EAAOyK,YAhIhB,SAAsB7G,GAIpB,IAFAA,EAUF,SAAqBA,GACnB,OAAIA,EAAI8G,KAAa9G,EAAI8G,OAClB9G,EAAIvR,QAAQ,aAAc,IAZ3BsY,CAAW/G,GAAKvR,QAAQiY,EAAmB,KAEzCvlB,OAAS,EAAG,MAAO,GAE3B,KAAO6e,EAAI7e,OAAS,GAAM,GACxB6e,GAAY,IAEd,OAAOA,EAuHmBgH,CAAYhH,IAGxC,SAASF,EAAY5R,EAAKE,EAAKoR,EAAQre,GACrC,IAAK,IAAItE,EAAI,EAAGA,EAAIsE,KACbtE,EAAI2iB,GAAUpR,EAAIjN,QAAYtE,GAAKqR,EAAI/M,UADhBtE,EAE5BuR,EAAIvR,EAAI2iB,GAAUtR,EAAIrR,GAExB,OAAOA,K,+CCvvDT,iBAEuB,IAAZuM,IACNA,EAAQoB,SAC0B,IAAnCpB,EAAQoB,QAAQ8D,QAAQ,QACW,IAAnClF,EAAQoB,QAAQ8D,QAAQ,QAAqD,IAArClF,EAAQoB,QAAQ8D,QAAQ,SAClE1R,EAAOD,QAAU,CAAEiJ,SAKrB,SAAkBqhB,EAAIC,EAAMC,EAAMC,GAChC,GAAkB,mBAAPH,EACT,MAAM,IAAInmB,UAAU,0CAEtB,IACI1B,EAAMvC,EADN6G,EAAMzB,UAAUd,OAEpB,OAAQuC,GACR,KAAK,EACL,KAAK,EACH,OAAO0F,EAAQxD,SAASqhB,GAC1B,KAAK,EACH,OAAO7d,EAAQxD,SAAS,WACtBqhB,EAAGjqB,KAAK,KAAMkqB,KAElB,KAAK,EACH,OAAO9d,EAAQxD,SAAS,WACtBqhB,EAAGjqB,KAAK,KAAMkqB,EAAMC,KAExB,KAAK,EACH,OAAO/d,EAAQxD,SAAS,WACtBqhB,EAAGjqB,KAAK,KAAMkqB,EAAMC,EAAMC,KAE9B,QAGE,IAFAhoB,EAAO,IAAIoD,MAAMkB,EAAM,GACvB7G,EAAI,EACGA,EAAIuC,EAAK+B,QACd/B,EAAKvC,KAAOoF,UAAUpF,GAExB,OAAOuM,EAAQxD,SAAS,WACtBqhB,EAAGhoB,MAAM,KAAMG,QAhCnBxC,EAAOD,QAAUyM,I,+FCHnB,MAAMie,EAAyB,CAC7B,mBACA,oBACA,mBACA,oBACA,mBACA,kBACA,sBAOF,SAAgBxT,EAAaqC,GAC3B,IAAIyC,GAEFA,EADEzC,EACSA,EAAMpF,iBAAiB,gCAEvBhL,SAASgL,iBAAiB,iCAE9BzC,QAAQ0C,IACf,GAAqB,SAAjBA,EAAKuW,SAAuBvW,EAAKgE,QAAQ,UAAUvE,UAAUE,SAAS,YAEnE,CACLK,EAAK6C,gBAAgB,QACrB,IAAI2T,EAAQxW,EAAKD,iBAAiB,wBAClC,IAAKyW,EAAMpmB,OACT,IACEomB,EAAQxW,EAAKgE,QAAQ,aAAajE,iBAAiB,wBACnD,MAAOxJ,GACPigB,EAAQ,GAGZA,EAAMlZ,QAAQ,SAAUmZ,GAClBA,EAAKzS,QAAQ,aAAavE,UAAUE,SAAS,aAC7C8W,EAAKzS,QAAQ,UAAUvE,UAAUE,SAAS,aAC1C8W,EAAKzS,QAAQ,QAAQvE,UAAUE,SAAS,YAC1C8W,EAAK5V,MAAMkC,KAAO,MAElB0T,EAAK5V,MAAMkC,KAAO,OAEpB0T,EAAKhX,UAAUK,OAAO,sBAnBxBE,EAAK4B,aAAa,SAAU,WAsB9B5B,EAAKP,UAAUK,OAAO,iBAO1B,SAAgB4W,IACd5T,IAMF,SAAgBzC,IACdqW,IACoBjlB,MAAMuR,KAAKjO,SAASwM,uBAAuB,gBAC5D4G,OAAQnI,IAAuBA,EAAK6E,cAAcpF,UAAUE,SAAS,aAC5DrC,QAAS0C,IACnBA,EAAK4B,aAAa,OAAQ,MAC1B,IAAI4U,EAAQxW,EAAKD,iBAAiB,wBAC7ByW,EAAMpmB,QACyB,OAA9B4P,EAAKgE,QAAQ,eACfwS,EAAQxW,EAAKgE,QAAQ,aAAajE,iBAAiB,wBAGvDyW,EAAMlZ,QAAQ,SAAUmZ,GAClBA,EAAKzS,QAAQ,aAAavE,UAAUE,SAAS,aAAe8W,EAAKzS,QAAQ,QAAQvE,UAAUE,SAAS,YACtG8W,EAAK5V,MAAMkC,KAAO,MAElB0T,EAAK5V,MAAMkC,KAAO,OAEpB0T,EAAKhX,UAAUK,OAAO,iBAExBE,EAAKP,UAAUK,OAAO,eACtBE,EAAKD,iBAAiB,uBAAuBzC,QAAQmZ,IACnDA,EAAKhX,UAAUK,OAAO,mBAQ5B,SAAgBsF,EAAWD,EAAoBjC,GAC7C,MAAM0E,EAAWnW,MAAMuR,KAAKmC,EAAMyC,UAClC,IAAK,IAAI9b,EAAI,EAAGA,EAAI8b,EAASxX,OAAQtE,IAAK,CACxC,IAAI6qB,EAAQ/O,EAAS9b,GACrB,GAAsB,SAAlB6qB,EAAMJ,QACRI,EAAM/U,aAAa,SAAUsB,OACxB,IAAIyT,EAAMlX,UAAUE,SAAS,gBAA+B,eAAbgX,EAAMrc,IAAuBqc,EAAMlX,UAAUE,SAAS,aAC1G,OACK,GAAIgX,EAAMlX,UAAUE,SAAS,SAClClO,MAAMuR,KAAK2T,EAAM/O,UAAUtK,QAAQsZ,IAAYhP,EAASzX,KAAKymB,UACxD,GAAI7hB,SAASwM,uBAAuB,sBAAsBnR,QACC,oBAAhE2E,SAASwM,uBAAuB,sBAAsB,GAAGjH,IACtDqc,EAAMlX,UAAUE,SAAS,YAC5BlO,MAAMuR,KAAK2T,EAAM/O,UAAUO,OAAOlF,GAAMA,EAAGxD,UAAUE,SAAS,UAAUrC,QAAQsZ,IAAYhP,EAASzX,KAAKymB,SACrG,CACLD,EAAM/U,aAAa,OAAQsB,GAC3B,IAAIsT,EAAQG,EAAM5W,iBAAiB,wBACnC,IAAKyW,EAAMpmB,OACT,IACEomB,EAAQG,EAAM3S,QAAQ,aAAajE,iBAAiB,wBACpD,MAAOxJ,GACPigB,EAAQ,GAGZA,EAAMlZ,QAAQ,SAAUmZ,GAChBA,EAAKzS,QAAQ,aAAavE,UAAUE,SAAS,aAC7C8W,EAAKzS,QAAQ,QAAQvE,UAAUE,SAAS,aACxC8W,EAAKzS,QAAQ,UAAUvE,UAAUE,SAAS,cAC9C8W,EAAK5V,MAAMkC,KAAOG,EAClBuT,EAAKhX,UAAUQ,IAAI,mBAIzB0W,EAAMlX,UAAUQ,IAAI,gBAOxB,SAAgB4W,IACd,MAAMC,EAASrlB,MAAMuR,KAAKjO,SAASwM,uBAAuB,UAC1D,IAAK,IAAIzV,EAAI,EAAGA,EAAIgrB,EAAO1mB,OAAQtE,IAAK,CACtC,MAAMirB,EAAaT,EAAaxqB,EAAIwqB,EAAalmB,QACjDgV,EAAU0R,EAAOhrB,GAAIirB,IAvHzB,gBAsCA,wBAOA,2BA8BA,cAwCA,sBAYA,gCAAgB3W,EAAsBuG,GAEpC,GADAtG,IACiB,UAAbsG,EAEF,YADAkQ,IAEK,GAAiB,cAAblQ,EAA0B,CAEnC,OADa5R,SAAS6L,cAAc,qBAAqBtG,IAEvD,IAAK,WACL,IAAK,YACHqM,EAAW,WACX,MACF,IAAK,aACHA,EAAW,QACX,MACF,QACEA,EAAW,QAIf,YADAvG,EAAqBuG,GAIvB,MAAMI,EAAShS,SAASwM,uBAAuBoF,GAC/C,IAAK,IAAI7a,EAAI,EAAGA,EAAIib,EAAO3W,OAAQtE,IAAK,CACtC,MAAMkrB,EAAaV,EAAaxqB,EAAIwqB,EAAalmB,QACT,OAAnC2W,EAAOjb,GAAGkY,QAAQ,cAA2B+C,EAAOjb,GAAG2T,UAAUE,SAAS,aAgBxEoH,EAAOjb,GAAG2T,UAAUE,SAAS,YAGhCoH,EAAOjb,GAAG8V,aAAa,OAAQ,QAF/BmF,EAAOjb,GAAG8V,aAAa,OAAQ,MAIjCmF,EAAOjb,GAAG2T,UAAUK,OAAO,iBApB3BiH,EAAOjb,GAAG8V,aAAa,OAAQoV,GACjBjQ,EAAOjb,GAAGiU,iBAAiB,wBACnCzC,QAAQ,SAAUmZ,GAClBA,EAAKzS,QAAQ,QAAQvE,UAAUE,SAAS,aACxC8W,EAAKzS,QAAQ,aAAavE,UAAUE,SAAS,aAC7C8W,EAAKzS,QAAQ,UAAUvE,UAAUE,SAAS,cAG9C8W,EAAK5V,MAAMkC,KAAOiU,KAEpBjQ,EAAOjb,GAAG2T,UAAUQ,IAAI,eACxB8G,EAAOjb,GAAGiU,iBAAiB,wBAAwBzC,QAAQmZ,IACzDA,EAAKhX,UAAUQ,IAAI,qB,8ECzL3B,cACA,QACA,QAEA,SAMA,IAAIoE,EAcJ,SAAgB4S,EAAuB3c,GACrC,MAAO,CACL,OAAU,MACV,MAAS,CACP,UAAaA,EACb,SAAY,OACZ,UAAa,KASnB,SAAgB4c,EAAkB5c,GAChC,MAAO,CACL,OAAU,MACV,MAAS,CACP,UAAaA,EACb,SAAY,OACZ,UAAa,KAQnB,SAAgB6c,IACd,MAAMC,EAAW,GACA3lB,MAAMuR,KAAKjO,SAASwM,uBAAuB,aACnDjE,QAAQ0C,IACfoX,EAASjnB,KACP,CACE,OAAU,SACV,MAAS,CACP,UAAa6P,EAAK1F,QAK1B,MAAM+c,EAA4B,CAChC,OAAU,QACV,MAASD,GAEX5T,IACAa,EAASiT,KAAKD,EAAahT,EAASE,KAAKC,qBAAqB+S,KAAK,KAAQlT,EAASmT,yBAMtF,SAAgBC,IACd,MAAMC,EAA2B,GAChBjmB,MAAMuR,KAAKjO,SAASwM,uBAAuB,aACnDjE,QAAQ0C,IACf0X,EAASvnB,KACP,CACE,OAAU,cACV,MAAS,CACP,UAAa6P,EAAK1F,QAK1B,MAAM+c,EAA4B,CAChC,OAAU,QACV,MAASK,GAEXlU,IACAa,EAASiT,KAAKD,EAAahT,EAASE,KAAKC,qBAAqB+S,KAAK,KAAQlT,EAASmT,yBAyYtF,SAAgBhU,IACd,IACE,MAAMmU,EAAW5iB,SAASiK,eAAe,YACzC2Y,EAAS/M,UAAY,GACrB+M,EAASlY,UAAUQ,IAAI,gBACvB,MAAO1J,IACTxB,SAAS6K,KAAKU,oBAAoB,UAAWsX,GAM/C,SAASC,IACP9iB,SAASiK,eAAe,eAAeM,iBAAiB,QAAS,WAC/DtQ,KAAKyQ,UAAUC,OAAO,eAK1B,SAAgBkY,EAAqBrY,GACnB,MAAZA,EAAIlS,KAA2B,cAAZkS,EAAIlS,MAAuB8pB,IAAiB5X,EAAIuY,kBA7ezE,wBAA8BvT,GAC5BF,EAAWE,EACXd,EAASsU,aAAaxT,IAOxB,0BAeA,qBAcA,kBAwBA,uBAwBA,4BAAkCH,GAChCZ,IACA,IACE,MAAMmU,EAAW5iB,SAASiK,eAAe,YACzC2Y,EAASlY,UAAUK,OAAO,gBAC1B6X,EAAS/M,UAAYoN,EAASC,iBAC9B,MAAO1hB,IAETxB,SAAS6L,cAAc,0BACpBtB,iBAAiB,QAAS,KACzB,MAAM4Y,EAAkBjB,EAAsB7S,EAAG9J,IAC3C6d,EAAajB,EAAiB9S,EAAG9J,IACvC+J,EAASiT,KAAK,CAAE,OAAU,QAAS,MAAS,CAAEY,EAAiBC,IAAgB9T,EAASE,KAAKC,qBAAqB+S,KAAMnb,IAClHA,EACF6O,EAAamN,kBAAkB,iBAE/BnN,EAAamN,kBAAkB,uBAEjC5U,IACAa,EAASmT,2BAIfziB,SAAS6L,cAAc,6BACpBtB,iBAAiB,QAAS,KACzB,MAAM+Y,EAAgB,CACpB,OAAU,MACV,MAAS,CACP,UAAajU,EAAG9J,GAChB,SAAY,OACZ,UAAa,OAGjB+J,EAASiT,KAAKe,EAAehU,EAASE,KAAKC,qBAAqB+S,KAAMnb,IAChEA,EACF6O,EAAamN,kBAAkB,iBAE/BnN,EAAamN,kBAAkB,uBAEjC5U,IACAa,EAASmT,2BAIfziB,SAAS6L,cAAc,wBACpBtB,iBAAiB,QAAS,KACzB,MAAM4Y,EAAkBjB,EAAsB7S,EAAG9J,IAC3Cge,EAAW,CACf,OAAU,MACV,MAAS,CACP,UAAalU,EAAG9J,GAChB,SAAY,OACZ,UAAa,MAGjB+J,EAASiT,KAAK,CAAE,OAAU,QAAS,MAAS,CAAEY,EAAiBI,IAAcjU,EAASE,KAAKC,qBAAqB+S,KAAMnb,IAChHA,EACF6O,EAAamN,kBAAkB,iBAE/BnN,EAAamN,kBAAkB,uBAEjC5U,IACAa,EAASmT,2BAGf,IACE,MAAMe,EAAMxjB,SAASiK,eAAe,UACpCuZ,EAAIjY,oBAAoB,QAAS6W,GACjCoB,EAAIjZ,iBAAiB,QAAS6X,GAC9B,MAAO5gB,IACTxB,SAAS6K,KAAKN,iBAAiB,UAAWsY,GAE1CC,KAMF,iCACErU,IACA,IACE,MAAMmU,EAAW5iB,SAASiK,eAAe,YACzC2Y,EAASlY,UAAUK,OAAO,gBAC1B6X,EAAS/M,UAAYoN,EAASQ,oBAC9B,MAAOjiB,IACT,MAAMkiB,EAAQ1jB,SAASgL,iBAAiB,aACxC,GAAqB,IAAjB0Y,EAAMroB,OAAV,CAKA2E,SAAS6L,cAAc,aACpBtB,iBAAiB,QAAU/I,KAK9B,SAA6BmiB,GAC3B,MAAMC,EAAqC,CACzC,OAAU,cACV,MAAS,CACP,UAAaF,EAAM,GAAGne,GACtB,QAAWoe,IAGfrU,EAASiT,KAAKqB,EAAsBtU,EAASE,KAAKC,qBAAqB+S,KAAMnb,IACvEA,EACF6O,EAAamN,kBAAkB,oBAE/BnN,EAAamN,kBAAkB,mBAEjC5U,IACAa,EAASmT,yBAlBToB,CADgBvU,EAASwU,KAAKC,kBAAmBviB,EAAEpI,OAAuBmM,OAsB9E,IACE,MAAMie,EAAMxjB,SAASiK,eAAe,UACpCuZ,EAAIjY,oBAAoB,QAAS6W,GACjCoB,EAAIjZ,iBAAiB,QAAS6X,GAC9B,MAAO5gB,IACTxB,SAAS6K,KAAKN,iBAAiB,UAAWsY,GAE1CC,IACApU,EAASsV,6BApCPpoB,QAAQC,KAAK,4EA0CjB,+BACE4S,IACA,IACE,MAAMmU,EAAW5iB,SAASiK,eAAe,YACzC2Y,EAASlY,UAAUK,OAAO,gBAC1B6X,EAAS/M,UACP,mSAMF7V,SAASiK,eAAe,eAAeM,iBAAiB,QAASmY,GACjE,MAAOlhB,IACT,IACE,MAAMgiB,EAAMxjB,SAASiK,eAAe,UACpCuZ,EAAIjY,oBAAoB,QAAS6W,GACjCoB,EAAIjZ,iBAAiB,QAAS6X,GAC9B,MAAO5gB,IACTxB,SAAS6K,KAAKN,iBAAiB,UAAWsY,GAE1CnU,EAASsV,yBAMX,8BAAoCC,GAClCxV,IACA,IACE,MAAMmU,EAAW5iB,SAASiK,eAAe,YACzC2Y,EAASlY,UAAUK,OAAO,gBAC1B6X,EAAS/M,UAAYoN,EAASiB,mBAC9B,MAAO1iB,IACTxB,SAAS6L,cAAc,wBACpBtB,iBAAiB,QAAS,KACzB,MAAM4Z,EAAyB,CAC7B,OAAU,UACV,MAAS,CACP,UAAaF,EAAK1e,GAClB,MAAS,MAGb+J,EAASiT,KAAK4B,EAAU7U,EAASE,KAAKC,qBAAqB+S,KAAMnb,IAC3DA,EACF6O,EAAamN,kBAAkB,iBAE/BnN,EAAamN,kBAAkB,uBAEjC5U,IACAa,EAASmT,2BAGfziB,SAAS6L,cAAc,wBACpBtB,iBAAiB,QAAS,KACzB,MAAM6Z,EAAyB,CAC7B,OAAU,UACV,MAAS,CACP,UAAaH,EAAK1e,GAClB,MAAS,MAGb+J,EAASiT,KAAK6B,EAAU9U,EAASE,KAAKC,qBAAqB+S,KAAMnb,IAC3DA,EACF6O,EAAamN,kBAAkB,iBAE/BnN,EAAamN,kBAAkB,uBAEjC5U,IACAa,EAASmT,2BAIf,IACE,MAAMe,EAAMxjB,SAASiK,eAAe,UACpCuZ,EAAIjY,oBAAoB,QAAS6W,GACjCoB,EAAIjZ,iBAAiB,QAAS6X,GAC9BpiB,SAASiK,eAAe,eAAeM,iBAAiB,QAASmY,GACjE,MAAOlhB,IACTxB,SAAS6K,KAAKN,iBAAiB,UAAWsY,GAG1CC,KAMF,kCACErU,IACA,IACE,MAAMmU,EAAW5iB,SAASiK,eAAe,YACzC2Y,EAASlY,UAAUK,OAAO,gBAC1B6X,EAAS/M,WAAaoN,EAASoB,qBAC/B,MAAO7iB,IAET,IACExB,SAASiK,eAAe,eACrBM,iBAAiB,QAASmY,GAC7B,MAAOlhB,IAET,IACE,MAAMgiB,EAAMxjB,SAASiK,eAAe,UACpCuZ,EAAIjY,oBAAoB,QAAS6W,GACjCoB,EAAIjZ,iBAAiB,QAAS6X,GAC9BpiB,SAAS6K,KAAKN,iBAAiB,UAAWsY,GAC1C,MAAOrhB,MAMX,iCACEiN,IACA,IACE,MAAMmU,EAAW5iB,SAASiK,eAAe,YACzC2Y,EAASlY,UAAUK,OAAO,gBAC1B6X,EAAS/M,UAAYoN,EAASqB,oBAC9B,MAAO9iB,IAETxB,SAASiK,eAAe,iBACrBM,iBAAiB,QAAS,KACzB,MAAMga,EAAUvkB,SAASgL,iBAAiB,mBACpCwZ,EAAa,GACnBD,EAAQhc,QAAQ6H,IACdoU,EAAWppB,KAAKgV,EAAM7K,MAExB,MAAMkf,EAA6B,CACjC,OAAU,QACV,MAAS,CACP,WAAcD,IAGlBlV,EAASiT,KAAKkC,EAAcnV,EAASE,KAAKC,qBAAqB+S,KAAMnb,IAC/DA,GACF6O,EAAamN,kBAAkB,gBAC/B5U,IACAa,EAASmT,wBAETvM,EAAamN,kBAAkB,oBAKvC,IACE,MAAMG,EAAMxjB,SAASiK,eAAe,UACpCuZ,EAAIjY,oBAAoB,QAAS6W,GACjCoB,EAAIjZ,iBAAiB,QAAS6X,GAC9B,MAAO5gB,IACTxB,SAAS6K,KAAKN,iBAAiB,UAAWsY,IAM5C,iCACEpU,IACA,IACE,MAAMmU,EAAW5iB,SAASiK,eAAe,YACzC2Y,EAASlY,UAAUK,OAAO,gBAC1B6X,EAAS/M,UAAYoN,EAASyB,oBAC9B,MAAOljB,IAGTxB,SAASiK,eAAe,gBACrBM,iBAAiB,QAAS,KACzB,MAAM6F,EAAQpQ,SAAS6L,cAAc,mBACrC,GAAc,OAAVuE,EAAgB,CACJ,IAAI,EAAAuU,aAAarV,EAAUc,GACnCwU,aACNnW,SAEA7S,QAAQ0B,MAAM,0BACdmR,MAINzO,SAASiK,eAAe,cACrBM,iBAAiB,QAAS,KACzB,MAAM6F,EAAQpQ,SAAS6L,cAAc,mBAE/BgZ,EADOzU,EAAMvE,cAAc,eACjB0B,aAAa,UAAUlE,MAAM,KAC7C,IAAIyb,EAAK1d,SAASyd,EAAG,GAAGxb,MAAM,KAAK,IAAMjC,SAASyd,EAAG,GAAGxb,MAAM,KAAK,IACnE,GAAc,OAAV+G,EAAgB,CAClB,MAAMqU,EAA6B,CACjC,OAAU,aACV,MAAS,CACP,UAAarU,EAAM7K,GACnB,GAAMuf,EACN,WAAa,IAGjBxV,EAASiT,KAAKkC,EAAcnV,EAASE,KAAKC,qBAAqB+S,KAAKrT,MAAO9H,IACrEA,SACIiI,EAASyV,gCAGnBtW,SAEA7S,QAAQ0B,MAAM,yBACdmR,MAIN,IACE,MAAM+U,EAAMxjB,SAASiK,eAAe,UACpCuZ,EAAIjY,oBAAoB,QAAS6W,GACjCoB,EAAIjZ,iBAAiB,QAAS6X,GAC9B,MAAO5gB,IACTxB,SAAS6K,KAAKN,iBAAiB,UAAWsY,IAM5C,sCACEpU,IACA,IACE,MAAMmU,EAAW5iB,SAASiK,eAAe,YACzC2Y,EAASlY,UAAUK,OAAO,gBAC1B6X,EAAS/M,UAAYoN,EAAS+B,yBAC9B,MAAOxjB,IAET,IACE,MAAMgiB,EAAMxjB,SAASiK,eAAe,UACpCuZ,EAAIjY,oBAAoB,QAAS6W,GACjCoB,EAAIjZ,iBAAiB,QAAS6X,GAC9B,MAAO5gB,IACTxB,SAAS6K,KAAKN,iBAAiB,UAAWsY,GAC1C,IACE,MAAMoC,EAAcjlB,SAASiK,eAAe,eAC5Cgb,EAAY1Z,oBAAoB,QAASmX,GACzCuC,EAAY1a,iBAAiB,QAASmY,GACtC,MAAMlhB,MAMV,mCACEiN,IACA,IACE,MAAMmU,EAAW5iB,SAASiK,eAAe,YACzC2Y,EAASlY,UAAUK,OAAO,gBAC1B6X,EAAS/M,UAAYoN,EAASiC,sBAC9B,MAAO1jB,IAET,IACE,MAAMgiB,EAAMxjB,SAASiK,eAAe,UACpCuZ,EAAIjY,oBAAoB,QAAS6W,GACjCoB,EAAIjZ,iBAAiB,QAAS6X,GAC9B,MAAO5gB,IACTxB,SAAS6K,KAAKN,iBAAiB,UAAWsY,IAM5C,wBAmBA,yB,8ECzfA,aAyHwB,EAAAsC,QAvHxB,MASE,YAAa7V,EAAoB8V,GAC/BnrB,KAAKqV,SAAWA,EAChBrV,KAAKmrB,SAAWA,EAMlB,WAEE,MAAMC,EAAgBniB,EAAGoiB,OACtBvnB,GAAG,QAaN,WACE9D,KAAKsrB,gBAAkB,CAACriB,EAAGsiB,MAAM7R,EAAGzQ,EAAGsiB,MAAM3R,GAC7C5Z,KAAKwrB,GAAK,EACVxrB,KAAK6qB,GAAK,EACK5hB,EAAGsiB,MAAME,YAAYtsB,OACzBsR,UAAUE,SAAS,UAC5B1H,EAAG2L,OAAO5U,KAAKmrB,UAAUluB,KAAKmuB,IAnBP9sB,KAAK0B,OAC7B8D,GAAG,OAAQ9D,KAAK0rB,SAASptB,KAAK0B,OAC9B8D,GAAG,MAAO9D,KAAK2rB,UAAUrtB,KAAK0B,OAE3B4rB,EAAW3iB,EAAGqL,UAAU,aACxBuX,EAAYppB,MAAMuR,KAAKjO,SAASwM,uBAAuB,aAC7DvS,KAAK6rB,UAAYA,EAAUnsB,OAAO+C,MAAMuR,KAAKjO,SAASwM,uBAAuB,iBAE7EvS,KAAKsrB,gBAAkB,IAAI7oB,MAAMmpB,EAAS3T,QAE1C2T,EAAS3uB,KAAKmuB,GAchB,WACE,MAAMU,EAAY7iB,EAAGsiB,MAAM3R,EAAI5Z,KAAKsrB,gBAAgB,GAC9CS,EAAY9iB,EAAGsiB,MAAM7R,EAAI1Z,KAAKsrB,gBAAgB,GACpDtrB,KAAKwrB,GAAKviB,EAAGsiB,MAAM7R,EAAI1Z,KAAKsrB,gBAAgB,GAC5CtrB,KAAK6qB,GAAK5hB,EAAGsiB,MAAM3R,EAAI5Z,KAAKsrB,gBAAgB,GAC5CtrB,KAAK6rB,UAAUvd,QAAS2F,IACtBhL,EAAG2L,OAAOX,GAAI+X,KAAK,YAAa,WAC9B,MAAO,aAAe,CAACD,EAAWD,GAAa,QAS+C,IAA9F9rB,KAAK6rB,UAAU1S,OAAQrT,GAAyBA,EAAQ2K,UAAUE,SAAS,QAAQvP,QACrF6H,EAAGqL,UAAU,sBAAsBA,UAAU,wBAAwB0X,KAAK,YAAa,WACrF,MAAO,aAAe,EAAE,EAAID,GAAY,EAAID,GAAa,MAK/D,YACE,MAAMG,EAAa,GACnBjsB,KAAK6rB,UAAU1S,OAAQlF,IAAoBA,EAAGxD,UAAUE,SAAS,gBAAgBrC,QAAS2F,IACxF,MACMiY,EAAe,CAAEC,OAAQ,OAC7BC,MAAO,CAAEC,UAFgB,SAAfpY,EAAGsT,QAAsBtT,EAAGe,QAAQ,QAAQ1J,GAAK2I,EAAG3I,GAG5DoO,EAAG1Z,KAAKwrB,GACR5R,GAAgB,EAAZ5Z,KAAO,KAEfisB,EAAW9qB,KAAK+qB,KAElB,MAAM1B,EAA6B,CACjC,OAAU,QACV,MAASyB,GAGLK,EAAQra,KAAK4G,IAAI7Y,KAAKwrB,IACtBe,EAAQta,KAAK4G,IAAI7Y,KAAK6qB,IAExByB,EAAQ,GAAKC,EAAQ,EACvBvsB,KAAKqV,SAASiT,KAAKkC,EAAcxqB,KAAKqV,SAASE,KAAKC,qBAAqB+S,KAAK,KAC5EvoB,KAAKqV,SAASmT,uBACdxoB,KAAKwU,sBACLxU,KAAKwsB,QACLxsB,KAAKkW,cAGPlW,KAAKwsB,QACLxsB,KAAKkW,YAKT,QAASsW,GACPxsB,KAAKysB,cAAgBD,EAIvB,aAC6BtsB,IAAvBF,KAAKysB,eACPxjB,EAAG2L,OAAO5U,KAAKmrB,UAAUluB,KAAK+C,KAAKysB,eAIvC,sBACE,IACE1mB,SAASiK,eAAe,YAAY4L,UAAY,GAChD7V,SAASiK,eAAe,YAAYS,UAAUQ,IAAI,gBAClD,MAAO1J,Q,gBCpHL1K,EAAOD,QAgBb,SAAUsD,GAER,aAeA,IAGIwsB,EAAU,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAQ1F,SAASC,EAASjT,EAAGxK,GACjB,IAAIN,EAAI8K,EAAE,GACN7K,EAAI6K,EAAE,GACNvc,EAAIuc,EAAE,GACNtc,EAAIsc,EAAE,GASV7K,IADAA,KADA1R,IADAA,KADAC,IADAA,KADAwR,IADAA,IAAMC,EAAI1R,GAAK0R,EAAIzR,GAAK8R,EAAE,GAAK,UAAY,IAChC,EAAIN,IAAM,IAAMC,EAAI,GACrBA,GAAKD,EAAIzR,GAAK+R,EAAE,GAAK,UAAY,IAChC,GAAK9R,IAAM,IAAMwR,EAAI,GACtBA,GAAKxR,EAAIyR,GAAKK,EAAE,GAAK,UAAY,IAChC,GAAK/R,IAAM,IAAMC,EAAI,GACtBA,GAAKD,EAAIyR,GAAKM,EAAE,GAAK,WAAa,IACjC,GAAKL,IAAM,IAAM1R,EAAI,EAQhC0R,IADAA,KADA1R,IADAA,KADAC,IADAA,KADAwR,IADAA,IAAMC,EAAI1R,GAAK0R,EAAIzR,GAAK8R,EAAE,GAAK,UAAY,IAChC,EAAIN,IAAM,IAAMC,EAAI,GACrBA,GAAKD,EAAIzR,GAAK+R,EAAE,GAAK,WAAa,IACjC,GAAK9R,IAAM,IAAMwR,EAAI,GACtBA,GAAKxR,EAAIyR,GAAKK,EAAE,GAAK,WAAa,IACjC,GAAK/R,IAAM,IAAMC,EAAI,GACtBA,GAAKD,EAAIyR,GAAKM,EAAE,GAAK,SAAW,IAC/B,GAAKL,IAAM,IAAM1R,EAAI,EAQhC0R,IADAA,KADA1R,IADAA,KADAC,IADAA,KADAwR,IADAA,IAAMC,EAAI1R,GAAK0R,EAAIzR,GAAK8R,EAAE,GAAK,WAAa,IACjC,EAAIN,IAAM,IAAMC,EAAI,GACrBA,GAAKD,EAAIzR,GAAK+R,EAAE,GAAK,WAAa,IACjC,GAAK9R,IAAM,IAAMwR,EAAI,GACtBA,GAAKxR,EAAIyR,GAAKK,EAAE,IAAM,MAAQ,IAC7B,GAAK/R,IAAM,IAAMC,EAAI,GACtBA,GAAKD,EAAIyR,GAAKM,EAAE,IAAM,WAAa,IAClC,GAAKL,IAAM,IAAM1R,EAAI,EAQhC0R,IADAA,KADA1R,IADAA,KADAC,IADAA,KADAwR,IADAA,IAAMC,EAAI1R,GAAK0R,EAAIzR,GAAK8R,EAAE,IAAM,WAAa,IAClC,EAAIN,IAAM,IAAMC,EAAI,GACrBA,GAAKD,EAAIzR,GAAK+R,EAAE,IAAM,SAAW,IAChC,GAAK9R,IAAM,IAAMwR,EAAI,GACtBA,GAAKxR,EAAIyR,GAAKK,EAAE,IAAM,WAAa,IAClC,GAAK/R,IAAM,IAAMC,EAAI,GACtBA,GAAKD,EAAIyR,GAAKM,EAAE,IAAM,WAAa,IAClC,GAAKL,IAAM,IAAM1R,EAAI,EAShC0R,IADAA,KADA1R,IADAA,KADAC,IADAA,KADAwR,IADAA,IAAMC,EAAIzR,EAAID,GAAKC,GAAK8R,EAAE,GAAK,UAAY,IAChC,EAAIN,IAAM,IAAMC,EAAI,GACrB1R,EAAI0R,GAAK1R,GAAK+R,EAAE,GAAK,WAAa,IACjC,EAAI9R,IAAM,IAAMwR,EAAI,GACrBC,EAAID,GAAKC,GAAKK,EAAE,IAAM,UAAY,IACjC,GAAK/R,IAAM,IAAMC,EAAI,GACtBwR,EAAIxR,GAAKwR,GAAKM,EAAE,GAAK,UAAY,IAChC,GAAKL,IAAM,IAAM1R,EAAI,EAQhC0R,IADAA,KADA1R,IADAA,KADAC,IADAA,KADAwR,IADAA,IAAMC,EAAIzR,EAAID,GAAKC,GAAK8R,EAAE,GAAK,UAAY,IAChC,EAAIN,IAAM,IAAMC,EAAI,GACrB1R,EAAI0R,GAAK1R,GAAK+R,EAAE,IAAM,SAAW,IAChC,EAAI9R,IAAM,IAAMwR,EAAI,GACrBC,EAAID,GAAKC,GAAKK,EAAE,IAAM,UAAY,IACjC,GAAK/R,IAAM,IAAMC,EAAI,GACtBwR,EAAIxR,GAAKwR,GAAKM,EAAE,GAAK,UAAY,IAChC,GAAKL,IAAM,IAAM1R,EAAI,EAQhC0R,IADAA,KADA1R,IADAA,KADAC,IADAA,KADAwR,IADAA,IAAMC,EAAIzR,EAAID,GAAKC,GAAK8R,EAAE,GAAK,UAAY,IAChC,EAAIN,IAAM,IAAMC,EAAI,GACrB1R,EAAI0R,GAAK1R,GAAK+R,EAAE,IAAM,WAAa,IAClC,EAAI9R,IAAM,IAAMwR,EAAI,GACrBC,EAAID,GAAKC,GAAKK,EAAE,GAAK,UAAY,IAChC,GAAK/R,IAAM,IAAMC,EAAI,GACtBwR,EAAIxR,GAAKwR,GAAKM,EAAE,GAAK,WAAa,IACjC,GAAKL,IAAM,IAAM1R,EAAI,EAQhC0R,IADAA,KADA1R,IADAA,KADAC,IADAA,KADAwR,IADAA,IAAMC,EAAIzR,EAAID,GAAKC,GAAK8R,EAAE,IAAM,WAAa,IAClC,EAAIN,IAAM,IAAMC,EAAI,GACrB1R,EAAI0R,GAAK1R,GAAK+R,EAAE,GAAK,SAAW,IAC/B,EAAI9R,IAAM,IAAMwR,EAAI,GACrBC,EAAID,GAAKC,GAAKK,EAAE,GAAK,WAAa,IACjC,GAAK/R,IAAM,IAAMC,EAAI,GACtBwR,EAAIxR,GAAKwR,GAAKM,EAAE,IAAM,WAAa,IAClC,GAAKL,IAAM,IAAM1R,EAAI,EAShC0R,IADAA,KADA1R,IADAA,KADAC,IADAA,KADAwR,IADAA,IAAMC,EAAI1R,EAAIC,GAAK8R,EAAE,GAAK,OAAS,IACxB,EAAIN,IAAM,IAAMC,EAAI,GACrBA,EAAI1R,GAAK+R,EAAE,GAAK,WAAa,IAC5B,GAAK9R,IAAM,IAAMwR,EAAI,GACtBA,EAAIC,GAAKK,EAAE,IAAM,WAAa,IAC7B,GAAK/R,IAAM,IAAMC,EAAI,GACtBA,EAAIwR,GAAKM,EAAE,IAAM,SAAW,IAC3B,GAAKL,IAAM,GAAK1R,EAAI,EAQ/B0R,IADAA,KADA1R,IADAA,KADAC,IADAA,KADAwR,IADAA,IAAMC,EAAI1R,EAAIC,GAAK8R,EAAE,GAAK,WAAa,IAC5B,EAAIN,IAAM,IAAMC,EAAI,GACrBA,EAAI1R,GAAK+R,EAAE,GAAK,WAAa,IAC5B,GAAK9R,IAAM,IAAMwR,EAAI,GACtBA,EAAIC,GAAKK,EAAE,GAAK,UAAY,IAC3B,GAAK/R,IAAM,IAAMC,EAAI,GACtBA,EAAIwR,GAAKM,EAAE,IAAM,WAAa,IAC7B,GAAKL,IAAM,GAAK1R,EAAI,EAQ/B0R,IADAA,KADA1R,IADAA,KADAC,IADAA,KADAwR,IADAA,IAAMC,EAAI1R,EAAIC,GAAK8R,EAAE,IAAM,UAAY,IAC5B,EAAIN,IAAM,IAAMC,EAAI,GACrBA,EAAI1R,GAAK+R,EAAE,GAAK,UAAY,IAC3B,GAAK9R,IAAM,IAAMwR,EAAI,GACtBA,EAAIC,GAAKK,EAAE,GAAK,UAAY,IAC3B,GAAK/R,IAAM,IAAMC,EAAI,GACtBA,EAAIwR,GAAKM,EAAE,GAAK,SAAW,IAC1B,GAAKL,IAAM,GAAK1R,EAAI,EAQ/B0R,IADAA,KADA1R,IADAA,KADAC,IADAA,KADAwR,IADAA,IAAMC,EAAI1R,EAAIC,GAAK8R,EAAE,GAAK,UAAY,IAC3B,EAAIN,IAAM,IAAMC,EAAI,GACrBA,EAAI1R,GAAK+R,EAAE,IAAM,UAAY,IAC5B,GAAK9R,IAAM,IAAMwR,EAAI,GACtBA,EAAIC,GAAKK,EAAE,IAAM,UAAY,IAC5B,GAAK/R,IAAM,IAAMC,EAAI,GACtBA,EAAIwR,GAAKM,EAAE,GAAK,UAAY,IAC3B,GAAKL,IAAM,GAAK1R,EAAI,EAS/B0R,IADAA,KAHAzR,IADAA,IAAMyR,IADND,IADAA,IAAMzR,GAAK0R,GAAKzR,IAAM8R,EAAE,GAAK,UAAY,IAC9B,EAAIN,IAAM,IAAMC,EAAI,IACf1R,IAAM+R,EAAE,GAAK,WAAa,IAC/B,GAAK9R,IAAM,IAAMwR,EAAI,KAEhCzR,IADAA,IAAMyR,GAAKxR,GAAKyR,IAAMK,EAAE,IAAM,WAAa,IAChC,GAAK/R,IAAM,IAAMC,EAAI,IAChBwR,IAAMM,EAAE,GAAK,SAAW,IAC7B,GAAIL,IAAM,IAAM1R,EAAI,EAQ/B0R,IADAA,KAHAzR,IADAA,IAAMyR,IADND,IADAA,IAAMzR,GAAK0R,GAAKzR,IAAM8R,EAAE,IAAM,WAAa,IAChC,EAAIN,IAAM,IAAMC,EAAI,IACf1R,IAAM+R,EAAE,GAAK,WAAa,IAC/B,GAAK9R,IAAM,IAAMwR,EAAI,KAEhCzR,IADAA,IAAMyR,GAAKxR,GAAKyR,IAAMK,EAAE,IAAM,QAAU,IAC7B,GAAK/R,IAAM,IAAMC,EAAI,IAChBwR,IAAMM,EAAE,GAAK,WAAa,IAC/B,GAAIL,IAAM,IAAM1R,EAAI,EAQ/B0R,IADAA,KAHAzR,IADAA,IAAMyR,IADND,IADAA,IAAMzR,GAAK0R,GAAKzR,IAAM8R,EAAE,GAAK,WAAa,IAC/B,EAAIN,IAAM,IAAMC,EAAI,IACf1R,IAAM+R,EAAE,IAAM,SAAW,IAC9B,GAAK9R,IAAM,IAAMwR,EAAI,KAEhCzR,IADAA,IAAMyR,GAAKxR,GAAKyR,IAAMK,EAAE,GAAK,WAAa,IAC/B,GAAK/R,IAAM,IAAMC,EAAI,IAChBwR,IAAMM,EAAE,IAAM,WAAa,IAChC,GAAIL,IAAM,IAAM1R,EAAI,EAQ/B0R,IADAA,KAHAzR,IADAA,IAAMyR,IADND,IADAA,IAAMzR,GAAK0R,GAAKzR,IAAM8R,EAAE,GAAK,UAAY,IAC9B,EAAIN,IAAM,IAAMC,EAAI,IACf1R,IAAM+R,EAAE,IAAM,WAAa,IAChC,GAAK9R,IAAM,IAAMwR,EAAI,KAEhCzR,IADAA,IAAMyR,GAAKxR,GAAKyR,IAAMK,EAAE,GAAK,UAAY,IAC9B,GAAK/R,IAAM,IAAMC,EAAI,IAChBwR,IAAMM,EAAE,GAAK,UAAY,IAC9B,GAAKL,IAAM,IAAM1R,EAAI,EAEhCuc,EAAE,GAAK9K,EAAI8K,EAAE,GAAK,EAClBA,EAAE,GAAK7K,EAAI6K,EAAE,GAAK,EAClBA,EAAE,GAAKvc,EAAIuc,EAAE,GAAK,EAClBA,EAAE,GAAKtc,EAAIsc,EAAE,GAAK,EAGtB,SAASkT,EAAO/tB,GACZ,IACI/B,EADA+vB,EAAU,GAGd,IAAK/vB,EAAI,EAAGA,EAAI,GAAIA,GAAK,EACrB+vB,EAAQ/vB,GAAK,GAAK+B,EAAEshB,WAAWrjB,IAAM+B,EAAEshB,WAAWrjB,EAAI,IAAM,IAAM+B,EAAEshB,WAAWrjB,EAAI,IAAM,KAAO+B,EAAEshB,WAAWrjB,EAAI,IAAM,IAE3H,OAAO+vB,EAGX,SAASC,EAAale,GAClB,IACI9R,EADA+vB,EAAU,GAGd,IAAK/vB,EAAI,EAAGA,EAAI,GAAIA,GAAK,EACrB+vB,EAAQ/vB,GAAK,GAAK8R,EAAE9R,IAAM8R,EAAE9R,EAAI,IAAM,IAAM8R,EAAE9R,EAAI,IAAM,KAAO8R,EAAE9R,EAAI,IAAM,IAE/E,OAAO+vB,EAGX,SAASE,EAAKluB,GACV,IAEI/B,EACAsE,EACA4rB,EACAC,EACAvM,EACAD,EAPAliB,EAAIM,EAAEuC,OACNU,EAAQ,CAAC,YAAa,WAAY,WAAY,WAQlD,IAAKhF,EAAI,GAAIA,GAAKyB,EAAGzB,GAAK,GACtB6vB,EAAS7qB,EAAO8qB,EAAO/tB,EAAEquB,UAAUpwB,EAAI,GAAIA,KAK/C,IAFAsE,GADAvC,EAAIA,EAAEquB,UAAUpwB,EAAI,KACTsE,OACX4rB,EAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAChDlwB,EAAI,EAAGA,EAAIsE,EAAQtE,GAAK,EACzBkwB,EAAKlwB,GAAK,IAAM+B,EAAEshB,WAAWrjB,KAAQA,EAAI,GAAM,GAGnD,GADAkwB,EAAKlwB,GAAK,IAAM,MAAUA,EAAI,GAAM,GAChCA,EAAI,GAEJ,IADA6vB,EAAS7qB,EAAOkrB,GACXlwB,EAAI,EAAGA,EAAI,GAAIA,GAAK,EACrBkwB,EAAKlwB,GAAK,EAclB,OARAmwB,GADAA,EAAU,EAAJ1uB,GACIiN,SAAS,IAAIuC,MAAM,kBAC7B2S,EAAKvT,SAAS8f,EAAI,GAAI,IACtBxM,EAAKtT,SAAS8f,EAAI,GAAI,KAAO,EAE7BD,EAAK,IAAMtM,EACXsM,EAAK,IAAMvM,EAEXkM,EAAS7qB,EAAOkrB,GACTlrB,EAmDX,SAASqrB,EAAK5uB,GACV,IACIghB,EADA1gB,EAAI,GAER,IAAK0gB,EAAI,EAAGA,EAAI,EAAGA,GAAK,EACpB1gB,GAAK6tB,EAASnuB,GAAU,EAAJghB,EAAQ,EAAM,IAAQmN,EAASnuB,GAAU,EAAJghB,EAAU,IAEvE,OAAO1gB,EAGX,SAASuuB,EAAI1T,GACT,IAAI5c,EACJ,IAAKA,EAAI,EAAGA,EAAI4c,EAAEtY,OAAQtE,GAAK,EAC3B4c,EAAE5c,GAAKqwB,EAAKzT,EAAE5c,IAElB,OAAO4c,EAAErN,KAAK,IAmElB,SAASghB,EAAOpN,GAKZ,MAJI,kBAAkBpS,KAAKoS,KACvBA,EAAMqN,SAAS7e,mBAAmBwR,KAG/BA,EA6BX,SAASsN,EAAkBH,GACvB,IAEI1T,EAFA0J,EAAQ,GACRhiB,EAASgsB,EAAIhsB,OAGjB,IAAKsY,EAAI,EAAGA,EAAItY,EAAS,EAAGsY,GAAK,EAC7B0J,EAAMjiB,KAAKgM,SAASigB,EAAIvN,OAAOnG,EAAG,GAAI,KAG1C,OAAOlY,OAAO8f,aAAapiB,MAAMsC,OAAQ4hB,GAY7C,SAASoK,IAELxtB,KAAKwsB,QAwTT,OAhbIY,EAAIL,EAAK,UAgBc,oBAAhBjQ,aAAgCA,YAAYpe,UAAU2Q,OAC7D,WACI,SAASoe,EAAM9P,EAAKvc,GAGhB,OAFAuc,EAAa,EAANA,GAAY,GAET,EACC1L,KAAKsB,IAAIoK,EAAMvc,EAAQ,GAG3B6Q,KAAKoB,IAAIsK,EAAKvc,GAGzB0b,YAAYpe,UAAU2Q,MAAQ,SAAU2E,EAAM0Z,GAC1C,IAGIC,EACAxuB,EACAyuB,EACAC,EANAzsB,EAASpB,KAAKgd,WACd8Q,EAAQL,EAAMzZ,EAAM5S,GACpBuH,EAAMvH,EAUV,OAJIssB,IAAOxtB,IACPyI,EAAM8kB,EAAMC,EAAItsB,IAGhB0sB,EAAQnlB,EACD,IAAImU,YAAY,IAG3B6Q,EAAMhlB,EAAMmlB,EACZ3uB,EAAS,IAAI2d,YAAY6Q,GACzBC,EAAc,IAAIlR,WAAWvd,GAE7B0uB,EAAc,IAAInR,WAAW1c,KAAM8tB,EAAOH,GAC1CC,EAAY9qB,IAAI+qB,GAET1uB,IAnCf,GAkHJquB,EAAS9uB,UAAUqvB,OAAS,SAAU9N,GAKlC,OAFAjgB,KAAKguB,aAAaX,EAAOpN,IAElBjgB,MAUXwtB,EAAS9uB,UAAUsvB,aAAe,SAAUC,GACxCjuB,KAAKkuB,OAASD,EACdjuB,KAAKmuB,SAAWF,EAAS7sB,OAEzB,IACItE,EADAsE,EAASpB,KAAKkuB,MAAM9sB,OAGxB,IAAKtE,EAAI,GAAIA,GAAKsE,EAAQtE,GAAK,GAC3B6vB,EAAS3sB,KAAKouB,MAAOxB,EAAO5sB,KAAKkuB,MAAMhB,UAAUpwB,EAAI,GAAIA,KAK7D,OAFAkD,KAAKkuB,MAAQluB,KAAKkuB,MAAMhB,UAAUpwB,EAAI,IAE/BkD,MAWXwtB,EAAS9uB,UAAUiK,IAAM,SAAU0lB,GAC/B,IAEIvxB,EAEA0F,EAJA8rB,EAAOtuB,KAAKkuB,MACZ9sB,EAASktB,EAAKltB,OAEd4rB,EAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAGzD,IAAKlwB,EAAI,EAAGA,EAAIsE,EAAQtE,GAAK,EACzBkwB,EAAKlwB,GAAK,IAAMwxB,EAAKnO,WAAWrjB,KAAQA,EAAI,GAAM,GAYtD,OATAkD,KAAKuuB,QAAQvB,EAAM5rB,GACnBoB,EAAM4qB,EAAIptB,KAAKouB,OAEXC,IACA7rB,EAAM+qB,EAAkB/qB,IAG5BxC,KAAKwsB,QAEEhqB,GAQXgrB,EAAS9uB,UAAU8tB,MAAQ,WAKvB,OAJAxsB,KAAKkuB,MAAQ,GACbluB,KAAKmuB,QAAU,EACfnuB,KAAKouB,MAAQ,CAAC,YAAa,WAAY,WAAY,WAE5CpuB,MAQXwtB,EAAS9uB,UAAU8vB,SAAW,WAC1B,MAAO,CACHF,KAAMtuB,KAAKkuB,MACX9sB,OAAQpB,KAAKmuB,QACbM,KAAMzuB,KAAKouB,QAWnBZ,EAAS9uB,UAAUgwB,SAAW,SAAU5sB,GAKpC,OAJA9B,KAAKkuB,MAAQpsB,EAAMwsB,KACnBtuB,KAAKmuB,QAAUrsB,EAAMV,OACrBpB,KAAKouB,MAAQtsB,EAAM2sB,KAEZzuB,MAOXwtB,EAAS9uB,UAAUiwB,QAAU,kBAClB3uB,KAAKouB,aACLpuB,KAAKkuB,aACLluB,KAAKmuB,SAShBX,EAAS9uB,UAAU6vB,QAAU,SAAUvB,EAAM5rB,GACzC,IACI6rB,EACAvM,EACAD,EAHA3jB,EAAIsE,EAMR,GADA4rB,EAAKlwB,GAAK,IAAM,MAAUA,EAAI,GAAM,GAChCA,EAAI,GAEJ,IADA6vB,EAAS3sB,KAAKouB,MAAOpB,GAChBlwB,EAAI,EAAGA,EAAI,GAAIA,GAAK,EACrBkwB,EAAKlwB,GAAK,EAOlBmwB,GADAA,EAAqB,EAAfjtB,KAAKmuB,SACD3iB,SAAS,IAAIuC,MAAM,kBAC7B2S,EAAKvT,SAAS8f,EAAI,GAAI,IACtBxM,EAAKtT,SAAS8f,EAAI,GAAI,KAAO,EAE7BD,EAAK,IAAMtM,EACXsM,EAAK,IAAMvM,EACXkM,EAAS3sB,KAAKouB,MAAOpB,IAYzBQ,EAASiB,KAAO,SAAUxO,EAAKoO,GAG3B,OAAOb,EAASoB,WAAWvB,EAAOpN,GAAMoO,IAW5Cb,EAASoB,WAAa,SAAUC,EAASR,GACrC,IACI7rB,EAAM4qB,EADCL,EAAK8B,IAGhB,OAAOR,EAAMd,EAAkB/qB,GAAOA,GAU1CgrB,EAAS1Q,YAAc,WAEnB9c,KAAKwsB,SAUTgB,EAAS1Q,YAAYpe,UAAUqvB,OAAS,SAAUxrB,GAC9C,IAEIzF,EAhPyBgyB,EAAOC,EAAQC,EACxC5hB,EA6OAkhB,GA9OyBQ,EA8OM9uB,KAAKkuB,MAAMxQ,OA9OVqR,EA8OkBxsB,EA9OVysB,GA8Oe,GA7OvD5hB,EAAS,IAAIsP,WAAWoS,EAAM9R,WAAa+R,EAAO/R,aAE/Cla,IAAI,IAAI4Z,WAAWoS,IAC1B1hB,EAAOtK,IAAI,IAAI4Z,WAAWqS,GAASD,EAAM9R,YAElCgS,EAAmB5hB,EAASA,EAAOsQ,QAyOtCtc,EAASktB,EAAKltB,OAKlB,IAFApB,KAAKmuB,SAAW5rB,EAAIya,WAEflgB,EAAI,GAAIA,GAAKsE,EAAQtE,GAAK,GAC3B6vB,EAAS3sB,KAAKouB,MAAOtB,EAAawB,EAAK1M,SAAS9kB,EAAI,GAAIA,KAK5D,OAFAkD,KAAKkuB,MAASpxB,EAAI,GAAMsE,EAAS,IAAIsb,WAAW4R,EAAK5Q,OAAOrO,MAAMvS,EAAI,KAAO,IAAI4f,WAAW,GAErF1c,MAWXwtB,EAAS1Q,YAAYpe,UAAUiK,IAAM,SAAU0lB,GAC3C,IAGIvxB,EACA0F,EAJA8rB,EAAOtuB,KAAKkuB,MACZ9sB,EAASktB,EAAKltB,OACd4rB,EAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAIzD,IAAKlwB,EAAI,EAAGA,EAAIsE,EAAQtE,GAAK,EACzBkwB,EAAKlwB,GAAK,IAAMwxB,EAAKxxB,KAAQA,EAAI,GAAM,GAY3C,OATAkD,KAAKuuB,QAAQvB,EAAM5rB,GACnBoB,EAAM4qB,EAAIptB,KAAKouB,OAEXC,IACA7rB,EAAM+qB,EAAkB/qB,IAG5BxC,KAAKwsB,QAEEhqB,GAQXgrB,EAAS1Q,YAAYpe,UAAU8tB,MAAQ,WAKnC,OAJAxsB,KAAKkuB,MAAQ,IAAIxR,WAAW,GAC5B1c,KAAKmuB,QAAU,EACfnuB,KAAKouB,MAAQ,CAAC,YAAa,WAAY,WAAY,WAE5CpuB,MAQXwtB,EAAS1Q,YAAYpe,UAAU8vB,SAAW,WACtC,IAnTyBF,EAmTrBxsB,EAAQ0rB,EAAS9uB,UAAU8vB,SAASvxB,KAAK+C,MAK7C,OAFA8B,EAAMwsB,MAtTmBA,EAsTQxsB,EAAMwsB,KArThC9sB,OAAO8f,aAAapiB,MAAM,KAAM,IAAIwd,WAAW4R,KAuT/CxsB,GAUX0rB,EAAS1Q,YAAYpe,UAAUgwB,SAAW,SAAU5sB,GAIhD,OAFAA,EAAMwsB,KAjVV,SAA6BrO,EAAK+O,GAC9B,IAGGlyB,EAHCsE,EAAS6e,EAAI7e,OACdktB,EAAO,IAAIxR,YAAY1b,GACvBmB,EAAM,IAAIma,WAAW4R,GAGxB,IAAKxxB,EAAI,EAAGA,EAAIsE,EAAQtE,GAAK,EACzByF,EAAIzF,GAAKmjB,EAAIE,WAAWrjB,GAG5B,OAAOkyB,EAAmBzsB,EAAM+rB,EAuUnBW,CAAoBntB,EAAMwsB,MAAM,GAEtCd,EAAS9uB,UAAUgwB,SAASzxB,KAAK+C,KAAM8B,IAGlD0rB,EAAS1Q,YAAYpe,UAAUiwB,QAAUnB,EAAS9uB,UAAUiwB,QAE5DnB,EAAS1Q,YAAYpe,UAAU6vB,QAAUf,EAAS9uB,UAAU6vB,QAU5Df,EAAS1Q,YAAY2R,KAAO,SAAUlsB,EAAK8rB,GACvC,IACI7rB,EAAM4qB,EA7ed,SAAoBxe,GAChB,IAEI9R,EACAsE,EACA4rB,EACAC,EACAvM,EACAD,EAPAliB,EAAIqQ,EAAExN,OACNU,EAAQ,CAAC,YAAa,WAAY,WAAY,WAQlD,IAAKhF,EAAI,GAAIA,GAAKyB,EAAGzB,GAAK,GACtB6vB,EAAS7qB,EAAOgrB,EAAale,EAAEgT,SAAS9kB,EAAI,GAAIA,KAWpD,IAJA8R,EAAK9R,EAAI,GAAMyB,EAAIqQ,EAAEgT,SAAS9kB,EAAI,IAAM,IAAI4f,WAAW,GAEvDtb,EAASwN,EAAExN,OACX4rB,EAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAChDlwB,EAAI,EAAGA,EAAIsE,EAAQtE,GAAK,EACzBkwB,EAAKlwB,GAAK,IAAM8R,EAAE9R,KAAQA,EAAI,GAAM,GAIxC,GADAkwB,EAAKlwB,GAAK,IAAM,MAAUA,EAAI,GAAM,GAChCA,EAAI,GAEJ,IADA6vB,EAAS7qB,EAAOkrB,GACXlwB,EAAI,EAAGA,EAAI,GAAIA,GAAK,EACrBkwB,EAAKlwB,GAAK,EAelB,OATAmwB,GADAA,EAAU,EAAJ1uB,GACIiN,SAAS,IAAIuC,MAAM,kBAC7B2S,EAAKvT,SAAS8f,EAAI,GAAI,IACtBxM,EAAKtT,SAAS8f,EAAI,GAAI,KAAO,EAE7BD,EAAK,IAAMtM,EACXsM,EAAK,IAAMvM,EAEXkM,EAAS7qB,EAAOkrB,GAETlrB,EA+bIotB,CAAW,IAAIxS,WAAWna,KAGrC,OAAO8rB,EAAMd,EAAkB/qB,GAAOA,GAGnCgrB,EA1uBc2B,I,cCczB,IAAIC,EAAQ,GAIRC,EAAY,CACdC,IAAM,MACN,KAAM,OAIR,SAASC,EAASC,GAChB,IAAI1yB,EACAuB,EAAMmxB,EACNC,EAAO,EACP1sB,EAAM,EACN2sB,EAAU,WAEd,IAAK5yB,EAAI,EAAGA,EAAI0yB,EAAUpuB,OAAQtE,IAChC,GAAqB,MAAjB0yB,EAAU1yB,GAGZ,OAFO0yB,EAAU1yB,EAAI,IAGnB,IAAK,IACH4yB,GAAWF,EAAUngB,MAAMogB,EAAM3yB,GAAK,iBAAoBiG,EAAM,QAChE0sB,EAAO3yB,EAAI,EACXiG,IACA,MACF,IAAK,IACH2sB,GAAWF,EAAUngB,MAAMogB,EAAM3yB,GAAK,gCAAmCiG,EAAM,SAC/E0sB,EAAO3yB,EAAI,EACXiG,IACA,MACF,IAAK,IACH2sB,GAAWF,EAAUngB,MAAMogB,EAAM3yB,EAAI,GACrC2yB,EAAO3yB,EAAI,EACXA,SAKKuyB,EAAUG,EAAU1yB,MAC7B4yB,GAAWF,EAAUngB,MAAMogB,EAAM3yB,GAAKuyB,EAAUG,EAAU1yB,IAC1D2yB,EAAO3yB,EAAI,GAIf4yB,GAAWF,EAAUngB,MAAMogB,GAAQ,KACnCL,EAAM/wB,GAAO,IAAIiB,SAASowB,GAe5B9yB,EAAQ+yB,QAAU,SAASH,EAAWI,GAKpC,OAJKR,EAAMI,IACTD,EAASC,GAGJJ,EAAMI,GAAWtwB,MAAM,KAAMgD,a,iBCpFtC,YAqBA,IAAI2tB,EAA4BryB,OAAOqyB,2BACrC,SAAmCloB,GAGjC,IAFA,IAAIhD,EAAOnH,OAAOmH,KAAKgD,GACnBmoB,EAAc,GACThzB,EAAI,EAAGA,EAAI6H,EAAKvD,OAAQtE,IAC/BgzB,EAAYnrB,EAAK7H,IAAMU,OAAOuyB,yBAAyBpoB,EAAKhD,EAAK7H,IAEnE,OAAOgzB,GAGPE,EAAe,WACnBpzB,EAAQ+Q,OAAS,SAASsiB,GACxB,IAAK7V,EAAS6V,GAAI,CAEhB,IADA,IAAIC,EAAU,GACLpzB,EAAI,EAAGA,EAAIoF,UAAUd,OAAQtE,IACpCozB,EAAQ/uB,KAAKshB,EAAQvgB,UAAUpF,KAEjC,OAAOozB,EAAQ7jB,KAAK,KAGlBvP,EAAI,EAmBR,IAnBA,IACIuC,EAAO6C,UACPyB,EAAMtE,EAAK+B,OACX6e,EAAMze,OAAOyuB,GAAGvhB,QAAQshB,EAAc,SAAStW,GACjD,GAAU,OAANA,EAAY,MAAO,IACvB,GAAI5c,GAAK6G,EAAK,OAAO+V,EACrB,OAAQA,GACN,IAAK,KAAM,OAAOlY,OAAOnC,EAAKvC,MAC9B,IAAK,KAAM,OAAO8C,OAAOP,EAAKvC,MAC9B,IAAK,KACH,IACE,OAAOkR,KAAKC,UAAU5O,EAAKvC,MAC3B,MAAOqzB,GACP,MAAO,aAEX,QACE,OAAOzW,KAGJA,EAAIra,EAAKvC,GAAIA,EAAI6G,EAAK+V,EAAIra,IAAOvC,GACpCmd,EAAOP,KAAOe,EAASf,GACzBuG,GAAO,IAAMvG,EAEbuG,GAAO,IAAMwC,EAAQ/I,GAGzB,OAAOuG,GAOTrjB,EAAQwzB,UAAY,SAASlJ,EAAI3a,GAC/B,QAAuB,IAAZlD,IAAqD,IAA1BA,EAAQgnB,cAC5C,OAAOnJ,EAIT,QAAuB,IAAZ7d,EACT,OAAO,WACL,OAAOzM,EAAQwzB,UAAUlJ,EAAI3a,GAAKrN,MAAMc,KAAMkC,YAIlD,IAAIb,GAAS,EAeb,OAdA,WACE,IAAKA,EAAQ,CACX,GAAIgI,EAAQinB,iBACV,MAAM,IAAI/uB,MAAMgL,GACPlD,EAAQknB,iBACjB5uB,QAAQ6uB,MAAMjkB,GAEd5K,QAAQ0B,MAAMkJ,GAEhBlL,GAAS,EAEX,OAAO6lB,EAAGhoB,MAAMc,KAAMkC,aAO1B,IACIuuB,EADAC,EAAS,GA6Bb,SAASjO,EAAQ9a,EAAKgpB,GAEpB,IAAIjlB,EAAM,CACRklB,KAAM,GACNC,QAASC,GAkBX,OAfI5uB,UAAUd,QAAU,IAAGsK,EAAIqlB,MAAQ7uB,UAAU,IAC7CA,UAAUd,QAAU,IAAGsK,EAAIslB,OAAS9uB,UAAU,IAC9C8X,EAAU2W,GAEZjlB,EAAIulB,WAAaN,EACRA,GAET/zB,EAAQs0B,QAAQxlB,EAAKilB,GAGnBrW,EAAY5O,EAAIulB,cAAavlB,EAAIulB,YAAa,GAC9C3W,EAAY5O,EAAIqlB,SAAQrlB,EAAIqlB,MAAQ,GACpCzW,EAAY5O,EAAIslB,UAAStlB,EAAIslB,QAAS,GACtC1W,EAAY5O,EAAIylB,iBAAgBzlB,EAAIylB,eAAgB,GACpDzlB,EAAIslB,SAAQtlB,EAAImlB,QAAUO,GACvBC,EAAY3lB,EAAK/D,EAAK+D,EAAIqlB,OAoCnC,SAASK,EAAiBnR,EAAKqR,GAC7B,IAAIzf,EAAQ4Q,EAAQ8O,OAAOD,GAE3B,OAAIzf,EACK,KAAY4Q,EAAQuO,OAAOnf,GAAO,GAAK,IAAMoO,EAC7C,KAAYwC,EAAQuO,OAAOnf,GAAO,GAAK,IAEvCoO,EAKX,SAAS6Q,EAAe7Q,EAAKqR,GAC3B,OAAOrR,EAeT,SAASoR,EAAY3lB,EAAK3N,EAAOyzB,GAG/B,GAAI9lB,EAAIylB,eACJpzB,GACA6c,EAAW7c,EAAM0kB,UAEjB1kB,EAAM0kB,UAAY7lB,EAAQ6lB,WAExB1kB,EAAMkH,aAAelH,EAAMkH,YAAYvG,YAAcX,GAAQ,CACjE,IAAIyE,EAAMzE,EAAM0kB,QAAQ+O,EAAc9lB,GAItC,OAHK0O,EAAS5X,KACZA,EAAM6uB,EAAY3lB,EAAKlJ,EAAKgvB,IAEvBhvB,EAIT,IAAIivB,EA+FN,SAAyB/lB,EAAK3N,GAC5B,GAAIuc,EAAYvc,GACd,OAAO2N,EAAImlB,QAAQ,YAAa,aAClC,GAAIzW,EAASrc,GAAQ,CACnB,IAAI2zB,EAAS,IAAO1jB,KAAKC,UAAUlQ,GAAO2Q,QAAQ,SAAU,IAClBA,QAAQ,KAAM,OACdA,QAAQ,OAAQ,KAAO,IACjE,OAAOhD,EAAImlB,QAAQa,EAAQ,UAE7B,GAAIvX,EAASpc,GACX,OAAO2N,EAAImlB,QAAQ,GAAK9yB,EAAO,UACjC,GAAIic,EAAUjc,GACZ,OAAO2N,EAAImlB,QAAQ,GAAK9yB,EAAO,WAEjC,GAAIkc,EAAOlc,GACT,OAAO2N,EAAImlB,QAAQ,OAAQ,QA9Gbc,CAAgBjmB,EAAK3N,GACrC,GAAI0zB,EACF,OAAOA,EAIT,IAAI9sB,EAAOnH,OAAOmH,KAAK5G,GACnB6zB,EApCN,SAAqBznB,GACnB,IAAIskB,EAAO,GAMX,OAJAtkB,EAAMmE,QAAQ,SAASqP,EAAKkU,GAC1BpD,EAAK9Q,IAAO,IAGP8Q,EA6BWqD,CAAYntB,GAQ9B,GANI+G,EAAIulB,aACNtsB,EAAOnH,OAAOiC,oBAAoB1B,IAKhC4c,EAAQ5c,KACJ4G,EAAK4J,QAAQ,YAAc,GAAK5J,EAAK4J,QAAQ,gBAAkB,GACrE,OAAOwjB,EAAYh0B,GAIrB,GAAoB,IAAhB4G,EAAKvD,OAAc,CACrB,GAAIwZ,EAAW7c,GAAQ,CACrB,IAAIV,EAAOU,EAAMV,KAAO,KAAOU,EAAMV,KAAO,GAC5C,OAAOqO,EAAImlB,QAAQ,YAAcxzB,EAAO,IAAK,WAE/C,GAAIkd,EAASxc,GACX,OAAO2N,EAAImlB,QAAQxjB,OAAO3O,UAAU8M,SAASvO,KAAKc,GAAQ,UAE5D,GAAI2c,EAAO3c,GACT,OAAO2N,EAAImlB,QAAQmB,KAAKtzB,UAAU8M,SAASvO,KAAKc,GAAQ,QAE1D,GAAI4c,EAAQ5c,GACV,OAAOg0B,EAAYh0B,GAIvB,IA2CIk0B,EA3CAvlB,EAAO,GAAIvC,GAAQ,EAAO+nB,EAAS,CAAC,IAAK,MAGzC9jB,EAAQrQ,KACVoM,GAAQ,EACR+nB,EAAS,CAAC,IAAK,MAIbtX,EAAW7c,MAEb2O,EAAO,cADC3O,EAAMV,KAAO,KAAOU,EAAMV,KAAO,IACf,KAkB5B,OAdIkd,EAASxc,KACX2O,EAAO,IAAMW,OAAO3O,UAAU8M,SAASvO,KAAKc,IAI1C2c,EAAO3c,KACT2O,EAAO,IAAMslB,KAAKtzB,UAAUyzB,YAAYl1B,KAAKc,IAI3C4c,EAAQ5c,KACV2O,EAAO,IAAMqlB,EAAYh0B,IAGP,IAAhB4G,EAAKvD,QAAkB+I,GAAyB,GAAhBpM,EAAMqD,OAItCowB,EAAe,EACbjX,EAASxc,GACJ2N,EAAImlB,QAAQxjB,OAAO3O,UAAU8M,SAASvO,KAAKc,GAAQ,UAEnD2N,EAAImlB,QAAQ,WAAY,YAInCnlB,EAAIklB,KAAKzvB,KAAKpD,GAIZk0B,EADE9nB,EAsCN,SAAqBuB,EAAK3N,EAAOyzB,EAAcI,EAAajtB,GAE1D,IADA,IAAIstB,EAAS,GACJn1B,EAAI,EAAGC,EAAIgB,EAAMqD,OAAQtE,EAAIC,IAAKD,EACrC6B,EAAeZ,EAAOyD,OAAO1E,IAC/Bm1B,EAAO9wB,KAAKixB,EAAe1mB,EAAK3N,EAAOyzB,EAAcI,EACjDpwB,OAAO1E,IAAI,IAEfm1B,EAAO9wB,KAAK,IAShB,OANAwD,EAAK2J,QAAQ,SAASjQ,GACfA,EAAI0P,MAAM,UACbkkB,EAAO9wB,KAAKixB,EAAe1mB,EAAK3N,EAAOyzB,EAAcI,EACjDvzB,GAAK,MAGN4zB,EArDII,CAAY3mB,EAAK3N,EAAOyzB,EAAcI,EAAajtB,GAEnDA,EAAKyH,IAAI,SAAS/N,GACzB,OAAO+zB,EAAe1mB,EAAK3N,EAAOyzB,EAAcI,EAAavzB,EAAK8L,KAItEuB,EAAIklB,KAAKrsB,MA6GX,SAA8B0tB,EAAQvlB,EAAMwlB,GAQ1C,GANaD,EAAOK,OAAO,SAAS7C,EAAM8C,GAGxC,OAFAC,EACID,EAAIhkB,QAAQ,OAAS,GAAGikB,EACrB/C,EAAO8C,EAAI7jB,QAAQ,kBAAmB,IAAItN,OAAS,GACzD,GAEU,GACX,OAAO8wB,EAAO,IACG,KAATxlB,EAAc,GAAKA,EAAO,OAC3B,IACAulB,EAAO5lB,KAAK,SACZ,IACA6lB,EAAO,GAGhB,OAAOA,EAAO,GAAKxlB,EAAO,IAAMulB,EAAO5lB,KAAK,MAAQ,IAAM6lB,EAAO,GA5H1DO,CAAqBR,EAAQvlB,EAAMwlB,IAxBjCA,EAAO,GAAKxlB,EAAOwlB,EAAO,GA+CrC,SAASH,EAAYh0B,GACnB,MAAO,IAAMwD,MAAM7C,UAAU8M,SAASvO,KAAKc,GAAS,IAwBtD,SAASq0B,EAAe1mB,EAAK3N,EAAOyzB,EAAcI,EAAavzB,EAAK8L,GAClE,IAAI9M,EAAM4iB,EAAKyS,EAsCf,IArCAA,EAAOl1B,OAAOuyB,yBAAyBhyB,EAAOM,IAAQ,CAAEN,MAAOA,EAAMM,KAC5DV,IAELsiB,EADEyS,EAAK5vB,IACD4I,EAAImlB,QAAQ,kBAAmB,WAE/BnlB,EAAImlB,QAAQ,WAAY,WAG5B6B,EAAK5vB,MACPmd,EAAMvU,EAAImlB,QAAQ,WAAY,YAG7BlyB,EAAeizB,EAAavzB,KAC/BhB,EAAO,IAAMgB,EAAM,KAEhB4hB,IACCvU,EAAIklB,KAAKriB,QAAQmkB,EAAK30B,OAAS,GAE/BkiB,EADEhG,EAAOuX,GACHH,EAAY3lB,EAAKgnB,EAAK30B,MAAO,MAE7BszB,EAAY3lB,EAAKgnB,EAAK30B,MAAOyzB,EAAe,IAE5CjjB,QAAQ,OAAS,IAErB0R,EADE9V,EACI8V,EAAI7Q,MAAM,MAAMhD,IAAI,SAASumB,GACjC,MAAO,KAAOA,IACbtmB,KAAK,MAAMwT,OAAO,GAEf,KAAOI,EAAI7Q,MAAM,MAAMhD,IAAI,SAASumB,GACxC,MAAO,MAAQA,IACdtmB,KAAK,OAIZ4T,EAAMvU,EAAImlB,QAAQ,aAAc,YAGhCvW,EAAYjd,GAAO,CACrB,GAAI8M,GAAS9L,EAAI0P,MAAM,SACrB,OAAOkS,GAET5iB,EAAO2Q,KAAKC,UAAU,GAAK5P,IAClB0P,MAAM,iCACb1Q,EAAOA,EAAKwiB,OAAO,EAAGxiB,EAAK+D,OAAS,GACpC/D,EAAOqO,EAAImlB,QAAQxzB,EAAM,UAEzBA,EAAOA,EAAKqR,QAAQ,KAAM,OACdA,QAAQ,OAAQ,KAChBA,QAAQ,WAAY,KAChCrR,EAAOqO,EAAImlB,QAAQxzB,EAAM,WAI7B,OAAOA,EAAO,KAAO4iB,EA2BvB,SAAS7R,EAAQwkB,GACf,OAAOnwB,MAAM2L,QAAQwkB,GAIvB,SAAS5Y,EAAUjX,GACjB,MAAsB,kBAARA,EAIhB,SAASkX,EAAOlX,GACd,OAAe,OAARA,EAST,SAASoX,EAASpX,GAChB,MAAsB,iBAARA,EAIhB,SAASqX,EAASrX,GAChB,MAAsB,iBAARA,EAShB,SAASuX,EAAYvX,GACnB,YAAe,IAARA,EAIT,SAASwX,EAASC,GAChB,OAAOC,EAASD,IAA8B,oBAAvBT,EAAeS,GAIxC,SAASC,EAAS1X,GAChB,MAAsB,iBAARA,GAA4B,OAARA,EAIpC,SAAS2X,EAAOtd,GACd,OAAOqd,EAASrd,IAA4B,kBAAtB2c,EAAe3c,GAIvC,SAASud,EAAQpT,GACf,OAAOkT,EAASlT,KACW,mBAAtBwS,EAAexS,IAA2BA,aAAahG,OAI9D,SAASqZ,EAAW7X,GAClB,MAAsB,mBAARA,EAgBhB,SAASgX,EAAexc,GACtB,OAAOC,OAAOkB,UAAU8M,SAASvO,KAAKM,GAIxC,SAASs1B,EAAIt0B,GACX,OAAOA,EAAI,GAAK,IAAMA,EAAEiN,SAAS,IAAMjN,EAAEiN,SAAS,IApbpD5O,EAAQk2B,SAAW,SAAShwB,GAI1B,GAHIwX,EAAYmW,KACdA,EAAepnB,EAAQkB,IAAIwoB,YAAc,IAC3CjwB,EAAMA,EAAIkwB,eACLtC,EAAO5tB,GACV,GAAI,IAAIuK,OAAO,MAAQvK,EAAM,MAAO,KAAK+K,KAAK4iB,GAAe,CAC3D,IAAIwC,EAAM5pB,EAAQ4pB,IAClBvC,EAAO5tB,GAAO,WACZ,IAAIyJ,EAAM3P,EAAQ+Q,OAAOzO,MAAMtC,EAASsF,WACxCP,QAAQ0B,MAAM,YAAaP,EAAKmwB,EAAK1mB,SAGvCmkB,EAAO5tB,GAAO,aAGlB,OAAO4tB,EAAO5tB,IAoChBlG,EAAQ6lB,QAAUA,EAIlBA,EAAQuO,OAAS,CACf,KAAS,CAAC,EAAG,IACb,OAAW,CAAC,EAAG,IACf,UAAc,CAAC,EAAG,IAClB,QAAY,CAAC,EAAG,IAChB,MAAU,CAAC,GAAI,IACf,KAAS,CAAC,GAAI,IACd,MAAU,CAAC,GAAI,IACf,KAAS,CAAC,GAAI,IACd,KAAS,CAAC,GAAI,IACd,MAAU,CAAC,GAAI,IACf,QAAY,CAAC,GAAI,IACjB,IAAQ,CAAC,GAAI,IACb,OAAW,CAAC,GAAI,KAIlBvO,EAAQ8O,OAAS,CACf,QAAW,OACX,OAAU,SACV,QAAW,SACX,UAAa,OACb,KAAQ,OACR,OAAU,QACV,KAAQ,UAER,OAAU,OAkRZ30B,EAAQwR,QAAUA,EAKlBxR,EAAQod,UAAYA,EAKpBpd,EAAQqd,OAASA,EAKjBrd,EAAQsd,kBAHR,SAA2BnX,GACzB,OAAc,MAAPA,GAOTnG,EAAQud,SAAWA,EAKnBvd,EAAQwd,SAAWA,EAKnBxd,EAAQyd,SAHR,SAAkBtX,GAChB,MAAsB,iBAARA,GAOhBnG,EAAQ0d,YAAcA,EAKtB1d,EAAQ2d,SAAWA,EAKnB3d,EAAQ6d,SAAWA,EAKnB7d,EAAQ8d,OAASA,EAMjB9d,EAAQ+d,QAAUA,EAKlB/d,EAAQge,WAAaA,EAUrBhe,EAAQie,YARR,SAAqB9X,GACnB,OAAe,OAARA,GACe,kBAARA,GACQ,iBAARA,GACQ,iBAARA,GACQ,iBAARA,QACQ,IAARA,GAIhBnG,EAAQke,SAAW,EAAQ,IAY3B,IAAIoY,EAAS,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACxD,MAAO,MAAO,OAG5B,SAASC,IACP,IAAI/1B,EAAI,IAAI40B,KACRoB,EAAO,CAACP,EAAIz1B,EAAEi2B,YACNR,EAAIz1B,EAAEk2B,cACNT,EAAIz1B,EAAEm2B,eAAelnB,KAAK,KACtC,MAAO,CAACjP,EAAEo2B,UAAWN,EAAO91B,EAAEq2B,YAAaL,GAAM/mB,KAAK,KAqCxD,SAAS1N,EAAegJ,EAAK+rB,GAC3B,OAAOl2B,OAAOkB,UAAUC,eAAe1B,KAAK0K,EAAK+rB,GAjCnD92B,EAAQ+2B,IAAM,WACZhyB,QAAQgyB,IAAI,UAAWR,IAAav2B,EAAQ+Q,OAAOzO,MAAMtC,EAASsF,aAiBpEtF,EAAQkL,SAAW,EAAQ,IAE3BlL,EAAQs0B,QAAU,SAAS0C,EAAQ3iB,GAEjC,IAAKA,IAAQwJ,EAASxJ,GAAM,OAAO2iB,EAInC,IAFA,IAAIjvB,EAAOnH,OAAOmH,KAAKsM,GACnBnU,EAAI6H,EAAKvD,OACNtE,KACL82B,EAAOjvB,EAAK7H,IAAMmU,EAAItM,EAAK7H,IAE7B,OAAO82B,GAOT,IAAIC,EAA6C,oBAAXh2B,OAAyBA,OAAO,8BAA2BqC,EA0DjG,SAAS4zB,EAAsBC,EAAQ/qB,GAKrC,IAAK+qB,EAAQ,CACX,IAAIC,EAAY,IAAIzyB,MAAM,2CAC1ByyB,EAAUD,OAASA,EACnBA,EAASC,EAEX,OAAOhrB,EAAG+qB,GAlEZn3B,EAAQq3B,UAAY,SAAmBC,GACrC,GAAwB,mBAAbA,EACT,MAAM,IAAInzB,UAAU,oDAEtB,GAAI8yB,GAA4BK,EAASL,GAA2B,CAClE,IAAI3M,EACJ,GAAkB,mBADdA,EAAKgN,EAASL,IAEhB,MAAM,IAAI9yB,UAAU,iEAKtB,OAHAvD,OAAOC,eAAeypB,EAAI2M,EAA0B,CAClD91B,MAAOmpB,EAAIxpB,YAAY,EAAOwH,UAAU,EAAOC,cAAc,IAExD+hB,EAGT,SAASA,IAQP,IAPA,IAAIiN,EAAgBC,EAChBC,EAAU,IAAIC,QAAQ,SAAU1nB,EAAS2nB,GAC3CJ,EAAiBvnB,EACjBwnB,EAAgBG,IAGdl1B,EAAO,GACFvC,EAAI,EAAGA,EAAIoF,UAAUd,OAAQtE,IACpCuC,EAAK8B,KAAKe,UAAUpF,IAEtBuC,EAAK8B,KAAK,SAAUoC,EAAKxF,GACnBwF,EACF6wB,EAAc7wB,GAEd4wB,EAAep2B,KAInB,IACEm2B,EAASh1B,MAAMc,KAAMX,GACrB,MAAOkE,GACP6wB,EAAc7wB,GAGhB,OAAO8wB,EAQT,OALA72B,OAAOg3B,eAAetN,EAAI1pB,OAAOyF,eAAeixB,IAE5CL,GAA0Br2B,OAAOC,eAAeypB,EAAI2M,EAA0B,CAChF91B,MAAOmpB,EAAIxpB,YAAY,EAAOwH,UAAU,EAAOC,cAAc,IAExD3H,OAAOi3B,iBACZvN,EACA2I,EAA0BqE,KAI9Bt3B,EAAQq3B,UAAUS,OAASb,EAiD3Bj3B,EAAQ+3B,YAlCR,SAAqBT,GACnB,GAAwB,mBAAbA,EACT,MAAM,IAAInzB,UAAU,oDAMtB,SAAS6zB,IAEP,IADA,IAAIv1B,EAAO,GACFvC,EAAI,EAAGA,EAAIoF,UAAUd,OAAQtE,IACpCuC,EAAK8B,KAAKe,UAAUpF,IAGtB,IAAI+3B,EAAUx1B,EAAKkF,MACnB,GAAuB,mBAAZswB,EACT,MAAM,IAAI9zB,UAAU,8CAEtB,IAAI2H,EAAO1I,KACPgJ,EAAK,WACP,OAAO6rB,EAAQ31B,MAAMwJ,EAAMxG,YAI7BgyB,EAASh1B,MAAMc,KAAMX,GAClBkpB,KAAK,SAAS/lB,GAAO6G,EAAQxD,SAASmD,EAAI,KAAMxG,IAC3C,SAASsyB,GAAOzrB,EAAQxD,SAASiuB,EAAuBgB,EAAK9rB,KAMvE,OAHAxL,OAAOg3B,eAAeI,EAAep3B,OAAOyF,eAAeixB,IAC3D12B,OAAOi3B,iBAAiBG,EACA/E,EAA0BqE,IAC3CU,K,kCC5rBTh4B,EAAUC,EAAOD,QAAU,EAAQ,KAC3Bm4B,OAASn4B,EACjBA,EAAQmL,SAAWnL,EACnBA,EAAQoL,SAAW,EAAQ,IAC3BpL,EAAQgL,OAAS,EAAQ,GACzBhL,EAAQo4B,UAAY,EAAQ,IAC5Bp4B,EAAQq4B,YAAc,EAAQ,K,gBCL9B,IAAIvX,EAAS,EAAQ,IACjB3C,EAAS2C,EAAO3C,OAGpB,SAASma,EAAW/mB,EAAKE,GACvB,IAAK,IAAIhQ,KAAO8P,EACdE,EAAIhQ,GAAO8P,EAAI9P,GAWnB,SAAS82B,EAAYpyB,EAAK6Z,EAAkBxb,GAC1C,OAAO2Z,EAAOhY,EAAK6Z,EAAkBxb,GATnC2Z,EAAO/G,MAAQ+G,EAAO0G,OAAS1G,EAAO8B,aAAe9B,EAAOkH,gBAC9DplB,EAAOD,QAAU8gB,GAGjBwX,EAAUxX,EAAQ9gB,GAClBA,EAAQme,OAASoa,GAQnBD,EAAUna,EAAQoa,GAElBA,EAAWnhB,KAAO,SAAUjR,EAAK6Z,EAAkBxb,GACjD,GAAmB,iBAAR2B,EACT,MAAM,IAAIhC,UAAU,iCAEtB,OAAOga,EAAOhY,EAAK6Z,EAAkBxb,IAGvC+zB,EAAW1T,MAAQ,SAAUxJ,EAAMlE,EAAMqJ,GACvC,GAAoB,iBAATnF,EACT,MAAM,IAAIlX,UAAU,6BAEtB,IAAIoe,EAAMpE,EAAO9C,GAUjB,YATa/X,IAAT6T,EACsB,iBAAbqJ,EACT+B,EAAIpL,KAAKA,EAAMqJ,GAEf+B,EAAIpL,KAAKA,GAGXoL,EAAIpL,KAAK,GAEJoL,GAGTgW,EAAWtY,YAAc,SAAU5E,GACjC,GAAoB,iBAATA,EACT,MAAM,IAAIlX,UAAU,6BAEtB,OAAOga,EAAO9C,IAGhBkd,EAAWlT,gBAAkB,SAAUhK,GACrC,GAAoB,iBAATA,EACT,MAAM,IAAIlX,UAAU,6BAEtB,OAAO2c,EAAO8D,WAAWvJ,K,8BC5D3B,gBA6BA,IAAIxQ,EAAM,EAAQ,IAelB,SAAS2tB,EAActzB,GACrB,IAAIuzB,EAAQr1B,KAEZA,KAAKs1B,KAAO,KACZt1B,KAAKu1B,MAAQ,KACbv1B,KAAKw1B,OAAS,YAolBhB,SAAwBC,EAAS3zB,EAAOyB,GACtC,IAAIgyB,EAAQE,EAAQF,MACpBE,EAAQF,MAAQ,KAChB,KAAOA,GAAO,CACZ,IAAIvsB,EAAKusB,EAAMG,SACf5zB,EAAM6zB,YACN3sB,EAAGzF,GACHgyB,EAAQA,EAAMD,KAEZxzB,EAAM8zB,mBACR9zB,EAAM8zB,mBAAmBN,KAAOG,EAEhC3zB,EAAM8zB,mBAAqBH,EA/lB3BI,CAAeR,EAAOvzB,IAlB1BjF,EAAOD,QAAUoL,EAwBjB,IAIIJ,EAJAkuB,GAAczsB,EAAQiB,SAAW,CAAC,QAAS,SAASiE,QAAQlF,EAAQoB,QAAQ4E,MAAM,EAAG,KAAO,EAAIjJ,EAAeqB,EAAI5B,SAOvHmC,EAAS+tB,cAAgBA,EAGzB,IAAIluB,EAAO,EAAQ,IACnBA,EAAKC,SAAW,EAAQ,GAIxB,IAAIkuB,EAAe,CACjB5F,UAAW,EAAQ,KAKjB2E,EAAS,EAAQ,IAKjBha,EAAS,EAAQ,IAAeA,OAChCkb,EAAgBzwB,EAAOkX,YAAc,aAUzC,IA2IIwZ,EA3IAC,EAAc,EAAQ,IAI1B,SAASC,KAET,SAASL,EAAc5tB,EAASkuB,GAC9BzuB,EAASA,GAAU,EAAQ,GAE3BO,EAAUA,GAAW,GAOrB,IAAImuB,EAAWD,aAAkBzuB,EAIjC5H,KAAKu2B,aAAepuB,EAAQouB,WAExBD,IAAUt2B,KAAKu2B,WAAav2B,KAAKu2B,cAAgBpuB,EAAQquB,oBAK7D,IAAIC,EAAMtuB,EAAQS,cACd8tB,EAAcvuB,EAAQwuB,sBACtBC,EAAa52B,KAAKu2B,WAAa,GAAK,MAElBv2B,KAAK4I,cAAvB6tB,GAAe,IAARA,EAAgCA,EAAaH,IAAaI,GAA+B,IAAhBA,GAAyCA,EAAsCE,EAGnK52B,KAAK4I,cAAgBqJ,KAAKsT,MAAMvlB,KAAK4I,eAGrC5I,KAAK62B,aAAc,EAGnB72B,KAAK82B,WAAY,EAEjB92B,KAAK+2B,QAAS,EAEd/2B,KAAKwI,OAAQ,EAEbxI,KAAKg3B,UAAW,EAGhBh3B,KAAK8I,WAAY,EAKjB,IAAImuB,GAAqC,IAA1B9uB,EAAQ+uB,cACvBl3B,KAAKk3B,eAAiBD,EAKtBj3B,KAAKm3B,gBAAkBhvB,EAAQgvB,iBAAmB,OAKlDn3B,KAAKoB,OAAS,EAGdpB,KAAKo3B,SAAU,EAGfp3B,KAAKq3B,OAAS,EAMdr3B,KAAKs3B,MAAO,EAKZt3B,KAAKu3B,kBAAmB,EAGxBv3B,KAAKw3B,QAAU,SAAUl0B,IA4R3B,SAAiB+yB,EAAQ/yB,GACvB,IAAIxB,EAAQu0B,EAAO9tB,eACf+uB,EAAOx1B,EAAMw1B,KACbtuB,EAAKlH,EAAM21B,QAIf,GAdF,SAA4B31B,GAC1BA,EAAMs1B,SAAU,EAChBt1B,EAAM21B,QAAU,KAChB31B,EAAMV,QAAUU,EAAM41B,SACtB51B,EAAM41B,SAAW,EAQjBC,CAAmB71B,GAEfwB,GAtCN,SAAsB+yB,EAAQv0B,EAAOw1B,EAAMh0B,EAAI0F,KAC3ClH,EAAM6zB,UAEJ2B,GAGF7vB,EAAI5B,SAASmD,EAAI1F,GAGjBmE,EAAI5B,SAAS+xB,EAAavB,EAAQv0B,GAClCu0B,EAAO9tB,eAAesvB,cAAe,EACrCxB,EAAOp1B,KAAK,QAASqC,KAIrB0F,EAAG1F,GACH+yB,EAAO9tB,eAAesvB,cAAe,EACrCxB,EAAOp1B,KAAK,QAASqC,GAGrBs0B,EAAYvB,EAAQv0B,IAkBdg2B,CAAazB,EAAQv0B,EAAOw1B,EAAMh0B,EAAI0F,OAAS,CAErD,IAAIguB,EAAWe,EAAWj2B,GAErBk1B,GAAal1B,EAAMu1B,QAAWv1B,EAAMy1B,mBAAoBz1B,EAAMk2B,iBACjEC,EAAY5B,EAAQv0B,GAGlBw1B,EAEFxB,EAAWoC,EAAY7B,EAAQv0B,EAAOk1B,EAAUhuB,GAGhDkvB,EAAW7B,EAAQv0B,EAAOk1B,EAAUhuB,IA/StCwuB,CAAQnB,EAAQ/yB,IAIlBtD,KAAKy3B,QAAU,KAGfz3B,KAAK03B,SAAW,EAEhB13B,KAAKg4B,gBAAkB,KACvBh4B,KAAKm4B,oBAAsB,KAI3Bn4B,KAAK21B,UAAY,EAIjB31B,KAAKo4B,aAAc,EAGnBp4B,KAAK63B,cAAe,EAGpB73B,KAAKq4B,qBAAuB,EAI5Br4B,KAAK41B,mBAAqB,IAAIR,EAAcp1B,MA0C9C,SAASgI,EAASG,GAUhB,GATAP,EAASA,GAAU,EAAQ,KAStBsuB,EAAgBj5B,KAAK+K,EAAUhI,OAAWA,gBAAgB4H,GAC7D,OAAO,IAAII,EAASG,GAGtBnI,KAAKuI,eAAiB,IAAIwtB,EAAc5tB,EAASnI,MAGjDA,KAAKkF,UAAW,EAEZiD,IAC2B,mBAAlBA,EAAQoV,QAAsBvd,KAAKs4B,OAASnwB,EAAQoV,OAEjC,mBAAnBpV,EAAQowB,SAAuBv4B,KAAKw4B,QAAUrwB,EAAQowB,QAElC,mBAApBpwB,EAAQwmB,UAAwB3uB,KAAK+I,SAAWZ,EAAQwmB,SAEtC,mBAAlBxmB,EAAQswB,QAAsBz4B,KAAK04B,OAASvwB,EAAQswB,QAGjE1D,EAAO93B,KAAK+C,MAgJd,SAAS24B,EAAQtC,EAAQv0B,EAAOy2B,EAAQ50B,EAAKi1B,EAAOxb,EAAUpU,GAC5DlH,EAAM41B,SAAW/zB,EACjB7B,EAAM21B,QAAUzuB,EAChBlH,EAAMs1B,SAAU,EAChBt1B,EAAMw1B,MAAO,EACTiB,EAAQlC,EAAOmC,QAAQI,EAAO92B,EAAM01B,SAAcnB,EAAOiC,OAAOM,EAAOxb,EAAUtb,EAAM01B,SAC3F11B,EAAMw1B,MAAO,EA2Df,SAASY,EAAW7B,EAAQv0B,EAAOk1B,EAAUhuB,GACtCguB,GASP,SAAsBX,EAAQv0B,GACP,IAAjBA,EAAMV,QAAgBU,EAAMg1B,YAC9Bh1B,EAAMg1B,WAAY,EAClBT,EAAOp1B,KAAK,UAZC43B,CAAaxC,EAAQv0B,GACpCA,EAAM6zB,YACN3sB,IACA4uB,EAAYvB,EAAQv0B,GActB,SAASm2B,EAAY5B,EAAQv0B,GAC3BA,EAAMy1B,kBAAmB,EACzB,IAAIhC,EAAQzzB,EAAMk2B,gBAElB,GAAI3B,EAAOmC,SAAWjD,GAASA,EAAMD,KAAM,CAEzC,IAAIv4B,EAAI+E,EAAMu2B,qBACV3a,EAAS,IAAIjb,MAAM1F,GACnB+7B,EAASh3B,EAAM8zB,mBACnBkD,EAAOvD,MAAQA,EAIf,IAFA,IAAI7zB,EAAQ,EACRq3B,GAAa,EACVxD,GACL7X,EAAOhc,GAAS6zB,EACXA,EAAMyD,QAAOD,GAAa,GAC/BxD,EAAQA,EAAMD,KACd5zB,GAAS,EAEXgc,EAAOqb,WAAaA,EAEpBJ,EAAQtC,EAAQv0B,GAAO,EAAMA,EAAMV,OAAQsc,EAAQ,GAAIob,EAAOtD,QAI9D1zB,EAAM6zB,YACN7zB,EAAMq2B,oBAAsB,KACxBW,EAAOxD,MACTxzB,EAAM8zB,mBAAqBkD,EAAOxD,KAClCwD,EAAOxD,KAAO,MAEdxzB,EAAM8zB,mBAAqB,IAAIR,EAActzB,GAE/CA,EAAMu2B,qBAAuB,MACxB,CAEL,KAAO9C,GAAO,CACZ,IAAIqD,EAAQrD,EAAMqD,MACdxb,EAAWmY,EAAMnY,SACjBpU,EAAKusB,EAAMG,SAUf,GAPAiD,EAAQtC,EAAQv0B,GAAO,EAFbA,EAAMy0B,WAAa,EAAIqC,EAAMx3B,OAEJw3B,EAAOxb,EAAUpU,GACpDusB,EAAQA,EAAMD,KACdxzB,EAAMu2B,uBAKFv2B,EAAMs1B,QACR,MAIU,OAAV7B,IAAgBzzB,EAAMq2B,oBAAsB,MAGlDr2B,EAAMk2B,gBAAkBzC,EACxBzzB,EAAMy1B,kBAAmB,EAiC3B,SAASQ,EAAWj2B,GAClB,OAAOA,EAAMi1B,QAA2B,IAAjBj1B,EAAMV,QAA0C,OAA1BU,EAAMk2B,kBAA6Bl2B,EAAMk1B,WAAal1B,EAAMs1B,QAE3G,SAAS6B,EAAU5C,EAAQv0B,GACzBu0B,EAAOqC,OAAO,SAAUn1B,GACtBzB,EAAM6zB,YACFpyB,GACF8yB,EAAOp1B,KAAK,QAASsC,GAEvBzB,EAAMs2B,aAAc,EACpB/B,EAAOp1B,KAAK,aACZ22B,EAAYvB,EAAQv0B,KAgBxB,SAAS81B,EAAYvB,EAAQv0B,GAC3B,IAAIo3B,EAAOnB,EAAWj2B,GAQtB,OAPIo3B,KAfN,SAAmB7C,EAAQv0B,GACpBA,EAAMs2B,aAAgBt2B,EAAM+0B,cACF,mBAAlBR,EAAOqC,QAChB52B,EAAM6zB,YACN7zB,EAAM+0B,aAAc,EACpBpvB,EAAI5B,SAASozB,EAAW5C,EAAQv0B,KAEhCA,EAAMs2B,aAAc,EACpB/B,EAAOp1B,KAAK,eAQdk4B,CAAU9C,EAAQv0B,GACM,IAApBA,EAAM6zB,YACR7zB,EAAMk1B,UAAW,EACjBX,EAAOp1B,KAAK,YAGTi4B,EAzhBTrxB,EAAKC,SAASE,EAAU+sB,GAmHxBgB,EAAcr3B,UAAU06B,UAAY,WAGlC,IAFA,IAAIC,EAAUr5B,KAAKg4B,gBACf9U,EAAM,GACHmW,GACLnW,EAAI/hB,KAAKk4B,GACTA,EAAUA,EAAQ/D,KAEpB,OAAOpS,GAGT,WACE,IACE1lB,OAAOC,eAAes4B,EAAcr3B,UAAW,SAAU,CACvDf,IAAKq4B,EAAa5F,UAAU,WAC1B,OAAOpwB,KAAKo5B,aACX,6EAAmF,aAExF,MAAOjJ,KAPX,GAasB,mBAAXtyB,QAAyBA,OAAOy7B,aAAiE,mBAA3Ch6B,SAASZ,UAAUb,OAAOy7B,cACzFpD,EAAkB52B,SAASZ,UAAUb,OAAOy7B,aAC5C97B,OAAOC,eAAeuK,EAAUnK,OAAOy7B,YAAa,CAClDv7B,MAAO,SAAUS,GACf,QAAI03B,EAAgBj5B,KAAK+C,KAAMxB,IAC3BwB,OAASgI,IAENxJ,GAAUA,EAAO+J,0BAA0BwtB,OAItDG,EAAkB,SAAU13B,GAC1B,OAAOA,aAAkBwB,MAqC7BgI,EAAStJ,UAAU66B,KAAO,WACxBv5B,KAAKiB,KAAK,QAAS,IAAIM,MAAM,+BA8B/ByG,EAAStJ,UAAU6e,MAAQ,SAAUqb,EAAOxb,EAAUpU,GACpD,IAnOqBrB,EAmOjB7F,EAAQ9B,KAAKuI,eACb/F,GAAM,EACNw2B,GAASl3B,EAAMy0B,aArOE5uB,EAqO0BixB,EApOxC7d,EAAOD,SAASnT,IAAQA,aAAesuB,GAwP9C,OAlBI+C,IAAUje,EAAOD,SAAS8d,KAC5BA,EA3OJ,SAA6BA,GAC3B,OAAO7d,EAAO/G,KAAK4kB,GA0OTY,CAAoBZ,IAGN,mBAAbxb,IACTpU,EAAKoU,EACLA,EAAW,MAGT4b,EAAO5b,EAAW,SAAmBA,IAAUA,EAAWtb,EAAMq1B,iBAElD,mBAAPnuB,IAAmBA,EAAKotB,GAE/Bt0B,EAAM0G,MA7CZ,SAAuB6tB,EAAQrtB,GAC7B,IAAI1F,EAAK,IAAI/B,MAAM,mBAEnB80B,EAAOp1B,KAAK,QAASqC,GACrBmE,EAAI5B,SAASmD,EAAI1F,GAyCAm2B,CAAcz5B,KAAMgJ,IAAagwB,GAnCpD,SAAoB3C,EAAQv0B,EAAO82B,EAAO5vB,GACxC,IAAI0wB,GAAQ,EACRp2B,GAAK,EAYT,OAVc,OAAVs1B,EACFt1B,EAAK,IAAIvC,UAAU,uCACO,iBAAV63B,QAAgC14B,IAAV04B,GAAwB92B,EAAMy0B,aACpEjzB,EAAK,IAAIvC,UAAU,oCAEjBuC,IACF+yB,EAAOp1B,KAAK,QAASqC,GACrBmE,EAAI5B,SAASmD,EAAI1F,GACjBo2B,GAAQ,GAEHA,EAqBoDC,CAAW35B,KAAM8B,EAAO82B,EAAO5vB,MACxFlH,EAAM6zB,YACNnzB,EAkDJ,SAAuB6zB,EAAQv0B,EAAOk3B,EAAOJ,EAAOxb,EAAUpU,GAC5D,IAAKgwB,EAAO,CACV,IAAIY,EAtBR,SAAqB93B,EAAO82B,EAAOxb,GAC5Btb,EAAMy0B,aAAsC,IAAxBz0B,EAAMo1B,eAA4C,iBAAV0B,IAC/DA,EAAQ7d,EAAO/G,KAAK4kB,EAAOxb,IAE7B,OAAOwb,EAkBUiB,CAAY/3B,EAAO82B,EAAOxb,GACrCwb,IAAUgB,IACZZ,GAAQ,EACR5b,EAAW,SACXwb,EAAQgB,GAGZ,IAAIj2B,EAAM7B,EAAMy0B,WAAa,EAAIqC,EAAMx3B,OAEvCU,EAAMV,QAAUuC,EAEhB,IAAInB,EAAMV,EAAMV,OAASU,EAAM8G,cAE1BpG,IAAKV,EAAMg1B,WAAY,GAE5B,GAAIh1B,EAAMs1B,SAAWt1B,EAAMu1B,OAAQ,CACjC,IAAIyC,EAAOh4B,EAAMq2B,oBACjBr2B,EAAMq2B,oBAAsB,CAC1BS,MAAOA,EACPxb,SAAUA,EACV4b,MAAOA,EACPtD,SAAU1sB,EACVssB,KAAM,MAEJwE,EACFA,EAAKxE,KAAOxzB,EAAMq2B,oBAElBr2B,EAAMk2B,gBAAkBl2B,EAAMq2B,oBAEhCr2B,EAAMu2B,sBAAwB,OAE9BM,EAAQtC,EAAQv0B,GAAO,EAAO6B,EAAKi1B,EAAOxb,EAAUpU,GAGtD,OAAOxG,EAtFCu3B,CAAc/5B,KAAM8B,EAAOk3B,EAAOJ,EAAOxb,EAAUpU,IAGpDxG,GAGTwF,EAAStJ,UAAUs7B,KAAO,WACZh6B,KAAKuI,eAEX8uB,UAGRrvB,EAAStJ,UAAUu7B,OAAS,WAC1B,IAAIn4B,EAAQ9B,KAAKuI,eAEbzG,EAAMu1B,SACRv1B,EAAMu1B,SAEDv1B,EAAMs1B,SAAYt1B,EAAMu1B,QAAWv1B,EAAMk1B,UAAal1B,EAAMy1B,mBAAoBz1B,EAAMk2B,iBAAiBC,EAAYj4B,KAAM8B,KAIlIkG,EAAStJ,UAAUw7B,mBAAqB,SAA4B9c,GAGlE,GADwB,iBAAbA,IAAuBA,EAAWA,EAASc,iBAChD,CAAC,MAAO,OAAQ,QAAS,QAAS,SAAU,SAAU,OAAQ,QAAS,UAAW,WAAY,OAAO3P,SAAS6O,EAAW,IAAIc,gBAAkB,GAAI,MAAM,IAAInd,UAAU,qBAAuBqc,GAEpM,OADApd,KAAKuI,eAAe4uB,gBAAkB/Z,EAC/Bpd,MAUTxC,OAAOC,eAAeuK,EAAStJ,UAAW,wBAAyB,CAIjEhB,YAAY,EACZC,IAAK,WACH,OAAOqC,KAAKuI,eAAeK,iBA8L/BZ,EAAStJ,UAAU45B,OAAS,SAAUM,EAAOxb,EAAUpU,GACrDA,EAAG,IAAIzH,MAAM,iCAGfyG,EAAStJ,UAAU85B,QAAU,KAE7BxwB,EAAStJ,UAAUiK,IAAM,SAAUiwB,EAAOxb,EAAUpU,GAClD,IAAIlH,EAAQ9B,KAAKuI,eAEI,mBAAVqwB,GACT5vB,EAAK4vB,EACLA,EAAQ,KACRxb,EAAW,MACkB,mBAAbA,IAChBpU,EAAKoU,EACLA,EAAW,MAGTwb,SAAuC54B,KAAKud,MAAMqb,EAAOxb,GAGzDtb,EAAMu1B,SACRv1B,EAAMu1B,OAAS,EACfr3B,KAAKi6B,UAIFn4B,EAAMi1B,QAAWj1B,EAAMk1B,UA0C9B,SAAqBX,EAAQv0B,EAAOkH,GAClClH,EAAMi1B,QAAS,EACfa,EAAYvB,EAAQv0B,GAChBkH,IACElH,EAAMk1B,SAAUvvB,EAAI5B,SAASmD,GAASqtB,EAAOryB,KAAK,SAAUgF,IAElElH,EAAM0G,OAAQ,EACd6tB,EAAOnxB,UAAW,EAjDoBi1B,CAAYn6B,KAAM8B,EAAOkH,IAoEjExL,OAAOC,eAAeuK,EAAStJ,UAAW,YAAa,CACrDf,IAAK,WACH,YAA4BuC,IAAxBF,KAAKuI,gBAGFvI,KAAKuI,eAAeO,WAE7BhG,IAAK,SAAU/E,GAGRiC,KAAKuI,iBAMVvI,KAAKuI,eAAeO,UAAY/K,MAIpCiK,EAAStJ,UAAUiwB,QAAUwH,EAAYxH,QACzC3mB,EAAStJ,UAAU07B,WAAajE,EAAYkE,UAC5CryB,EAAStJ,UAAUqK,SAAW,SAAUxF,EAAKyF,GAC3ChJ,KAAK2I,MACLK,EAAGzF,M,sECppBL,IAAIwX,EAAS,EAAQ,IAAeA,OAGhCsC,EAAatC,EAAOsC,YAAc,SAAUD,GAE9C,QADAA,EAAW,GAAKA,IACIA,EAASc,eAC3B,IAAK,MAAM,IAAK,OAAO,IAAK,QAAQ,IAAK,QAAQ,IAAK,SAAS,IAAK,SAAS,IAAK,OAAO,IAAK,QAAQ,IAAK,UAAU,IAAK,WAAW,IAAK,MACxI,OAAO,EACT,QACE,OAAO,IA4Cb,SAASoc,EAAcld,GAErB,IAAImd,EACJ,OAFAv6B,KAAKod,SAXP,SAA2Bod,GACzB,IAAIC,EA/BN,SAA4BD,GAC1B,IAAKA,EAAK,MAAO,OAEjB,IADA,IAAIE,IAEF,OAAQF,GACN,IAAK,OACL,IAAK,QACH,MAAO,OACT,IAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACH,MAAO,UACT,IAAK,SACL,IAAK,SACH,MAAO,SACT,IAAK,SACL,IAAK,QACL,IAAK,MACH,OAAOA,EACT,QACE,GAAIE,EAAS,OACbF,GAAO,GAAKA,GAAKtc,cACjBwc,GAAU,GAQLC,CAAmBH,GAC9B,GAAoB,iBAATC,IAAsB1f,EAAOsC,aAAeA,IAAeA,EAAWmd,IAAO,MAAM,IAAIj5B,MAAM,qBAAuBi5B,GAC/H,OAAOC,GAAQD,EAQCI,CAAkBxd,GAE1Bpd,KAAKod,UACX,IAAK,UACHpd,KAAK66B,KAAOC,EACZ96B,KAAK2I,IAAMoyB,EACXR,EAAK,EACL,MACF,IAAK,OACHv6B,KAAKg7B,SAAWC,EAChBV,EAAK,EACL,MACF,IAAK,SACHv6B,KAAK66B,KAAOK,EACZl7B,KAAK2I,IAAMwyB,EACXZ,EAAK,EACL,MACF,QAGE,OAFAv6B,KAAKud,MAAQ6d,OACbp7B,KAAK2I,IAAM0yB,GAGfr7B,KAAKs7B,SAAW,EAChBt7B,KAAKu7B,UAAY,EACjBv7B,KAAKw7B,SAAWzgB,EAAO8B,YAAY0d,GAoCrC,SAASkB,EAAcC,GACrB,OAAIA,GAAQ,IAAa,EAAWA,GAAQ,GAAM,EAAa,EAAWA,GAAQ,GAAM,GAAa,EAAWA,GAAQ,GAAM,GAAa,EACpIA,GAAQ,GAAM,GAAQ,GAAK,EA2DpC,SAAST,EAAa9b,GACpB,IAAIvgB,EAAIoB,KAAKu7B,UAAYv7B,KAAKs7B,SAC1B19B,EAtBN,SAA6B8K,EAAMyW,EAAKvgB,GACtC,GAAwB,MAAV,IAATugB,EAAI,IAEP,OADAzW,EAAK4yB,SAAW,EACT,IAET,GAAI5yB,EAAK4yB,SAAW,GAAKnc,EAAI/d,OAAS,EAAG,CACvC,GAAwB,MAAV,IAAT+d,EAAI,IAEP,OADAzW,EAAK4yB,SAAW,EACT,IAET,GAAI5yB,EAAK4yB,SAAW,GAAKnc,EAAI/d,OAAS,GACZ,MAAV,IAAT+d,EAAI,IAEP,OADAzW,EAAK4yB,SAAW,EACT,KASLK,CAAoB37B,KAAMmf,GAClC,YAAUjf,IAANtC,EAAwBA,EACxBoC,KAAKs7B,UAAYnc,EAAI/d,QACvB+d,EAAItc,KAAK7C,KAAKw7B,SAAU58B,EAAG,EAAGoB,KAAKs7B,UAC5Bt7B,KAAKw7B,SAAShwB,SAASxL,KAAKod,SAAU,EAAGpd,KAAKu7B,aAEvDpc,EAAItc,KAAK7C,KAAKw7B,SAAU58B,EAAG,EAAGugB,EAAI/d,aAClCpB,KAAKs7B,UAAYnc,EAAI/d,SA2BvB,SAAS05B,EAAU3b,EAAKriB,GACtB,IAAKqiB,EAAI/d,OAAStE,GAAK,GAAM,EAAG,CAC9B,IAAIc,EAAIuhB,EAAI3T,SAAS,UAAW1O,GAChC,GAAIc,EAAG,CACL,IAAIT,EAAIS,EAAEuiB,WAAWviB,EAAEwD,OAAS,GAChC,GAAIjE,GAAK,OAAUA,GAAK,MAKtB,OAJA6C,KAAKs7B,SAAW,EAChBt7B,KAAKu7B,UAAY,EACjBv7B,KAAKw7B,SAAS,GAAKrc,EAAIA,EAAI/d,OAAS,GACpCpB,KAAKw7B,SAAS,GAAKrc,EAAIA,EAAI/d,OAAS,GAC7BxD,EAAEyR,MAAM,GAAI,GAGvB,OAAOzR,EAKT,OAHAoC,KAAKs7B,SAAW,EAChBt7B,KAAKu7B,UAAY,EACjBv7B,KAAKw7B,SAAS,GAAKrc,EAAIA,EAAI/d,OAAS,GAC7B+d,EAAI3T,SAAS,UAAW1O,EAAGqiB,EAAI/d,OAAS,GAKjD,SAAS25B,EAAS5b,GAChB,IAAIvhB,EAAIuhB,GAAOA,EAAI/d,OAASpB,KAAKud,MAAM4B,GAAO,GAC9C,GAAInf,KAAKs7B,SAAU,CACjB,IAAI3yB,EAAM3I,KAAKu7B,UAAYv7B,KAAKs7B,SAChC,OAAO19B,EAAIoC,KAAKw7B,SAAShwB,SAAS,UAAW,EAAG7C,GAElD,OAAO/K,EAGT,SAASs9B,EAAW/b,EAAKriB,GACvB,IAAIyB,GAAK4gB,EAAI/d,OAAStE,GAAK,EAC3B,OAAU,IAANyB,EAAgB4gB,EAAI3T,SAAS,SAAU1O,IAC3CkD,KAAKs7B,SAAW,EAAI/8B,EACpByB,KAAKu7B,UAAY,EACP,IAANh9B,EACFyB,KAAKw7B,SAAS,GAAKrc,EAAIA,EAAI/d,OAAS,IAEpCpB,KAAKw7B,SAAS,GAAKrc,EAAIA,EAAI/d,OAAS,GACpCpB,KAAKw7B,SAAS,GAAKrc,EAAIA,EAAI/d,OAAS,IAE/B+d,EAAI3T,SAAS,SAAU1O,EAAGqiB,EAAI/d,OAAS7C,IAGhD,SAAS48B,EAAUhc,GACjB,IAAIvhB,EAAIuhB,GAAOA,EAAI/d,OAASpB,KAAKud,MAAM4B,GAAO,GAC9C,OAAInf,KAAKs7B,SAAiB19B,EAAIoC,KAAKw7B,SAAShwB,SAAS,SAAU,EAAG,EAAIxL,KAAKs7B,UACpE19B,EAIT,SAASw9B,EAAYjc,GACnB,OAAOA,EAAI3T,SAASxL,KAAKod,UAG3B,SAASie,EAAUlc,GACjB,OAAOA,GAAOA,EAAI/d,OAASpB,KAAKud,MAAM4B,GAAO,GAzN/CviB,EAAQ09B,cAAgBA,EA6BxBA,EAAc57B,UAAU6e,MAAQ,SAAU4B,GACxC,GAAmB,IAAfA,EAAI/d,OAAc,MAAO,GAC7B,IAAIxD,EACAd,EACJ,GAAIkD,KAAKs7B,SAAU,CAEjB,QAAUp7B,KADVtC,EAAIoC,KAAKg7B,SAAS7b,IACG,MAAO,GAC5BriB,EAAIkD,KAAKs7B,SACTt7B,KAAKs7B,SAAW,OAEhBx+B,EAAI,EAEN,OAAIA,EAAIqiB,EAAI/d,OAAexD,EAAIA,EAAIoC,KAAK66B,KAAK1b,EAAKriB,GAAKkD,KAAK66B,KAAK1b,EAAKriB,GAC/Dc,GAAK,IAGd08B,EAAc57B,UAAUiK,IAwGxB,SAAiBwW,GACf,IAAIvhB,EAAIuhB,GAAOA,EAAI/d,OAASpB,KAAKud,MAAM4B,GAAO,GAC9C,OAAInf,KAAKs7B,SAAiB19B,EAAI,IACvBA,GAxGT08B,EAAc57B,UAAUm8B,KA0FxB,SAAkB1b,EAAKriB,GACrB,IAAI8+B,EArEN,SAA6BlzB,EAAMyW,EAAKriB,GACtC,IAAIyiB,EAAIJ,EAAI/d,OAAS,EACrB,GAAIme,EAAIziB,EAAG,OAAO,EAClB,IAAIy9B,EAAKkB,EAActc,EAAII,IAC3B,GAAIgb,GAAM,EAER,OADIA,EAAK,IAAG7xB,EAAK4yB,SAAWf,EAAK,GAC1BA,EAET,KAAMhb,EAAIziB,IAAa,IAARy9B,EAAW,OAAO,EAEjC,IADAA,EAAKkB,EAActc,EAAII,MACb,EAER,OADIgb,EAAK,IAAG7xB,EAAK4yB,SAAWf,EAAK,GAC1BA,EAET,KAAMhb,EAAIziB,IAAa,IAARy9B,EAAW,OAAO,EAEjC,IADAA,EAAKkB,EAActc,EAAII,MACb,EAIR,OAHIgb,EAAK,IACI,IAAPA,EAAUA,EAAK,EAAO7xB,EAAK4yB,SAAWf,EAAK,GAE1CA,EAET,OAAO,EA+CKsB,CAAoB77B,KAAMmf,EAAKriB,GAC3C,IAAKkD,KAAKs7B,SAAU,OAAOnc,EAAI3T,SAAS,OAAQ1O,GAChDkD,KAAKu7B,UAAYK,EACjB,IAAIjzB,EAAMwW,EAAI/d,QAAUw6B,EAAQ57B,KAAKs7B,UAErC,OADAnc,EAAItc,KAAK7C,KAAKw7B,SAAU,EAAG7yB,GACpBwW,EAAI3T,SAAS,OAAQ1O,EAAG6L,IA7FjC2xB,EAAc57B,UAAUs8B,SAAW,SAAU7b,GAC3C,GAAInf,KAAKs7B,UAAYnc,EAAI/d,OAEvB,OADA+d,EAAItc,KAAK7C,KAAKw7B,SAAUx7B,KAAKu7B,UAAYv7B,KAAKs7B,SAAU,EAAGt7B,KAAKs7B,UACzDt7B,KAAKw7B,SAAShwB,SAASxL,KAAKod,SAAU,EAAGpd,KAAKu7B,WAEvDpc,EAAItc,KAAK7C,KAAKw7B,SAAUx7B,KAAKu7B,UAAYv7B,KAAKs7B,SAAU,EAAGnc,EAAI/d,QAC/DpB,KAAKs7B,UAAYnc,EAAI/d,S,6BCtIvB,SAAS06B,EAAa31B,GACpB,GAAoB,KAAhBA,EAAK/E,OACP,MAAO,GAGT,SAAS4H,EAAI+yB,EAAkB1C,GAC7B,OAAO0C,EAAW1C,EAAQ7tB,SAAS,IAAIwwB,SAAS,EAAG,KAGrD,OAAO71B,EAAKkJ,MAAM,EAAG,GAAGijB,OAAOtpB,EAAI,IACjC,IAAM7C,EAAKkJ,MAAM,EAAG,GAAGijB,OAAOtpB,EAAI,IAClC,IAAM7C,EAAKkJ,MAAM,EAAG,GAAGijB,OAAOtpB,EAAI,IAClC,IAAM7C,EAAKkJ,MAAM,EAAG,IAAIijB,OAAOtpB,EAAI,IACnC,IAAM7C,EAAKkJ,MAAM,IAAIijB,OAAOtpB,EAAI,I,iDAGpC,oBAEE,QAAsB9I,IAAlBsH,OAAOy0B,OACT,OAAOH,EAAY,IAAIpf,WAAW,KAIpC,MAAMwf,EAAS,IAAIxf,WAAW,IACxByf,EAAYzf,WAAW1I,KAAK,CAChC7G,SAAS,WAAY,GACrBA,SAAS,WAAY,GACrBA,SAAS,WAAY,GACrBA,SAAS,WAAY,KAOvB,OALA3F,OAAOy0B,OAAOG,gBAAgBF,GAE9BA,EAAO,GAAMA,EAAO,GAAKC,EAAU,GAAMA,EAAU,GACnDD,EAAO,GAAMA,EAAO,GAAKC,EAAU,GAAMA,EAAU,GAE5CL,EAAYI,K,6BCZrB,IAAIG,EAAW,EAAQ,IACnBx0B,EAAO,EAAQ,IASnB,SAASy0B,IACPt8B,KAAKu8B,SAAW,KAChBv8B,KAAKw8B,QAAU,KACfx8B,KAAKy8B,KAAO,KACZz8B,KAAK08B,KAAO,KACZ18B,KAAK28B,KAAO,KACZ38B,KAAK48B,SAAW,KAChB58B,KAAKyuB,KAAO,KACZzuB,KAAKoc,OAAS,KACdpc,KAAK68B,MAAQ,KACb78B,KAAK88B,SAAW,KAChB98B,KAAKiX,KAAO,KACZjX,KAAK+8B,KAAO,KAnBdngC,EAAQogC,MAAQC,EAChBrgC,EAAQgQ,QA0ZR,SAAoBswB,EAAQC,GAC1B,OAAOF,EAASC,GAAQ,GAAO,GAAMtwB,QAAQuwB,IA1Z/CvgC,EAAQwgC,cAiaR,SAA0BF,EAAQC,GAChC,OAAKD,EACED,EAASC,GAAQ,GAAO,GAAME,cAAcD,GAD/BA,GAjatBvgC,EAAQ+Q,OAsVR,SAAmBhG,GAKbE,EAAKuS,SAASzS,KAAMA,EAAMs1B,EAASt1B,IACvC,OAAMA,aAAe20B,EACd30B,EAAIgG,SADuB2uB,EAAI59B,UAAUiP,OAAO1Q,KAAK0K,IA1V9D/K,EAAQ0/B,IAAMA,EAqBd,IAAIe,EAAkB,oBAClBC,EAAc,WAGdC,EAAoB,qCAOpBC,EAAS,CAAC,IAAK,IAAK,IAAK,KAAM,IAAK,KAAK99B,OAHhC,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,OAM/C+9B,EAAa,CAAC,KAAM/9B,OAAO89B,GAK3BE,EAAe,CAAC,IAAK,IAAK,IAAK,IAAK,KAAKh+B,OAAO+9B,GAChDE,EAAkB,CAAC,IAAK,IAAK,KAE7BC,EAAsB,yBACtBC,EAAoB,+BAEpBC,EAAiB,CACf,YAAc,EACd,eAAe,GAGjBC,EAAmB,CACjB,YAAc,EACd,eAAe,GAGjBC,EAAkB,CAChB,MAAQ,EACR,OAAS,EACT,KAAO,EACP,QAAU,EACV,MAAQ,EACR,SAAS,EACT,UAAU,EACV,QAAQ,EACR,WAAW,EACX,SAAS,GAEXC,EAAc,EAAQ,IAE1B,SAAShB,EAASiB,EAAKC,EAAkBC,GACvC,GAAIF,GAAOr2B,EAAK4S,SAASyjB,IAAQA,aAAe5B,EAAK,OAAO4B,EAE5D,IAAIG,EAAI,IAAI/B,EAEZ,OADA+B,EAAErB,MAAMkB,EAAKC,EAAkBC,GACxBC,EAGT/B,EAAI59B,UAAUs+B,MAAQ,SAASkB,EAAKC,EAAkBC,GACpD,IAAKv2B,EAAKuS,SAAS8jB,GACjB,MAAM,IAAIn9B,UAAU,gDAAkDm9B,GAMxE,IAAII,EAAaJ,EAAI3vB,QAAQ,KACzBgwB,GACqB,IAAhBD,GAAqBA,EAAaJ,EAAI3vB,QAAQ,KAAQ,IAAM,IACjEiwB,EAASN,EAAI9uB,MAAMmvB,GAEvBC,EAAO,GAAKA,EAAO,GAAG9vB,QADL,MACyB,KAG1C,IAAI+vB,EAFJP,EAAMM,EAAOnyB,KAAKkyB,GAQlB,GAFAE,EAAOA,EAAK1X,QAEPqX,GAA+C,IAA1BF,EAAI9uB,MAAM,KAAKhO,OAAc,CAErD,IAAIs9B,EAAanB,EAAkBoB,KAAKF,GACxC,GAAIC,EAeF,OAdA1+B,KAAKiX,KAAOwnB,EACZz+B,KAAK+8B,KAAO0B,EACZz+B,KAAK88B,SAAW4B,EAAW,GACvBA,EAAW,IACb1+B,KAAKoc,OAASsiB,EAAW,GAEvB1+B,KAAK68B,MADHsB,EACWF,EAAYjB,MAAMh9B,KAAKoc,OAAOyD,OAAO,IAErC7f,KAAKoc,OAAOyD,OAAO,IAEzBse,IACTn+B,KAAKoc,OAAS,GACdpc,KAAK68B,MAAQ,IAER78B,KAIX,IAAI4+B,EAAQvB,EAAgBsB,KAAKF,GACjC,GAAIG,EAAO,CAET,IAAIC,GADJD,EAAQA,EAAM,IACS1gB,cACvBle,KAAKu8B,SAAWsC,EAChBJ,EAAOA,EAAK5e,OAAO+e,EAAMx9B,QAO3B,GAAIg9B,GAAqBQ,GAASH,EAAK1wB,MAAM,wBAAyB,CACpE,IAAIyuB,EAAgC,OAAtBiC,EAAK5e,OAAO,EAAG,IACzB2c,GAAaoC,GAASb,EAAiBa,KACzCH,EAAOA,EAAK5e,OAAO,GACnB7f,KAAKw8B,SAAU,GAInB,IAAKuB,EAAiBa,KACjBpC,GAAYoC,IAAUZ,EAAgBY,IAAU,CAmBnD,IADA,IASInC,EAAMqC,EATNC,GAAW,EACNjiC,EAAI,EAAGA,EAAI6gC,EAAgBv8B,OAAQtE,IAAK,EAElC,KADTkiC,EAAMP,EAAKlwB,QAAQovB,EAAgB7gC,QACP,IAAbiiC,GAAkBC,EAAMD,KACzCA,EAAUC,IAiBE,KATdF,GAFe,IAAbC,EAEON,EAAK3f,YAAY,KAIjB2f,EAAK3f,YAAY,IAAKigB,MAM/BtC,EAAOgC,EAAKpvB,MAAM,EAAGyvB,GACrBL,EAAOA,EAAKpvB,MAAMyvB,EAAS,GAC3B9+B,KAAKy8B,KAAOntB,mBAAmBmtB,IAIjCsC,GAAW,EACX,IAASjiC,EAAI,EAAGA,EAAI4gC,EAAat8B,OAAQtE,IAAK,CAC5C,IAAIkiC,GACS,KADTA,EAAMP,EAAKlwB,QAAQmvB,EAAa5gC,QACJ,IAAbiiC,GAAkBC,EAAMD,KACzCA,EAAUC,IAGG,IAAbD,IACFA,EAAUN,EAAKr9B,QAEjBpB,KAAK08B,KAAO+B,EAAKpvB,MAAM,EAAG0vB,GAC1BN,EAAOA,EAAKpvB,MAAM0vB,GAGlB/+B,KAAKi/B,YAILj/B,KAAK48B,SAAW58B,KAAK48B,UAAY,GAIjC,IAAIsC,EAAoC,MAArBl/B,KAAK48B,SAAS,IACe,MAA5C58B,KAAK48B,SAAS58B,KAAK48B,SAASx7B,OAAS,GAGzC,IAAK89B,EAEH,IADA,IAAIC,EAAYn/B,KAAK48B,SAASxtB,MAAM,MACpBrS,GAAPD,EAAI,EAAOqiC,EAAU/9B,QAAQtE,EAAIC,EAAGD,IAAK,CAChD,IAAIsiC,EAAOD,EAAUriC,GACrB,GAAKsiC,IACAA,EAAKrxB,MAAM6vB,GAAsB,CAEpC,IADA,IAAIyB,EAAU,GACL9f,EAAI,EAAGrQ,EAAIkwB,EAAKh+B,OAAQme,EAAIrQ,EAAGqQ,IAClC6f,EAAKjf,WAAWZ,GAAK,IAIvB8f,GAAW,IAEXA,GAAWD,EAAK7f,GAIpB,IAAK8f,EAAQtxB,MAAM6vB,GAAsB,CACvC,IAAI0B,EAAaH,EAAU9vB,MAAM,EAAGvS,GAChCyiC,EAAUJ,EAAU9vB,MAAMvS,EAAI,GAC9B0iC,EAAMJ,EAAKrxB,MAAM8vB,GACjB2B,IACFF,EAAWn+B,KAAKq+B,EAAI,IACpBD,EAAQr+B,QAAQs+B,EAAI,KAElBD,EAAQn+B,SACVq9B,EAAO,IAAMc,EAAQlzB,KAAK,KAAOoyB,GAEnCz+B,KAAK48B,SAAW0C,EAAWjzB,KAAK,KAChC,QAMJrM,KAAK48B,SAASx7B,OAjND,IAkNfpB,KAAK48B,SAAW,GAGhB58B,KAAK48B,SAAW58B,KAAK48B,SAAS1e,cAG3BghB,IAKHl/B,KAAK48B,SAAWP,EAASoD,QAAQz/B,KAAK48B,WAGxC,IAAIh+B,EAAIoB,KAAK28B,KAAO,IAAM38B,KAAK28B,KAAO,GAClC+C,EAAI1/B,KAAK48B,UAAY,GACzB58B,KAAK08B,KAAOgD,EAAI9gC,EAChBoB,KAAK+8B,MAAQ/8B,KAAK08B,KAIdwC,IACFl/B,KAAK48B,SAAW58B,KAAK48B,SAAS/c,OAAO,EAAG7f,KAAK48B,SAASx7B,OAAS,GAC/C,MAAZq9B,EAAK,KACPA,EAAO,IAAMA,IAOnB,IAAKX,EAAee,GAKlB,IAAS/hC,EAAI,EAAGC,EAAI0gC,EAAWr8B,OAAQtE,EAAIC,EAAGD,IAAK,CACjD,IAAI6iC,EAAKlC,EAAW3gC,GACpB,IAA0B,IAAtB2hC,EAAKlwB,QAAQoxB,GAAjB,CAEA,IAAIC,EAAMnxB,mBAAmBkxB,GACzBC,IAAQD,IACVC,EAAMC,OAAOF,IAEflB,EAAOA,EAAKrvB,MAAMuwB,GAAItzB,KAAKuzB,IAM/B,IAAInR,EAAOgQ,EAAKlwB,QAAQ,MACV,IAAVkgB,IAEFzuB,KAAKyuB,KAAOgQ,EAAK5e,OAAO4O,GACxBgQ,EAAOA,EAAKpvB,MAAM,EAAGof,IAEvB,IAAIqR,EAAKrB,EAAKlwB,QAAQ,KAoBtB,IAnBY,IAARuxB,GACF9/B,KAAKoc,OAASqiB,EAAK5e,OAAOigB,GAC1B9/B,KAAK68B,MAAQ4B,EAAK5e,OAAOigB,EAAK,GAC1B3B,IACFn+B,KAAK68B,MAAQoB,EAAYjB,MAAMh9B,KAAK68B,QAEtC4B,EAAOA,EAAKpvB,MAAM,EAAGywB,IACZ3B,IAETn+B,KAAKoc,OAAS,GACdpc,KAAK68B,MAAQ,IAEX4B,IAAMz+B,KAAK88B,SAAW2B,GACtBT,EAAgBa,IAChB7+B,KAAK48B,WAAa58B,KAAK88B,WACzB98B,KAAK88B,SAAW,KAId98B,KAAK88B,UAAY98B,KAAKoc,OAAQ,CAC5Bxd,EAAIoB,KAAK88B,UAAY,GAAzB,IACIj+B,EAAImB,KAAKoc,QAAU,GACvBpc,KAAKiX,KAAOrY,EAAIC,EAKlB,OADAmB,KAAK+8B,KAAO/8B,KAAK2N,SACV3N,MAcTs8B,EAAI59B,UAAUiP,OAAS,WACrB,IAAI8uB,EAAOz8B,KAAKy8B,MAAQ,GACpBA,IAEFA,GADAA,EAAOhuB,mBAAmBguB,IACd/tB,QAAQ,OAAQ,KAC5B+tB,GAAQ,KAGV,IAAIF,EAAWv8B,KAAKu8B,UAAY,GAC5BO,EAAW98B,KAAK88B,UAAY,GAC5BrO,EAAOzuB,KAAKyuB,MAAQ,GACpBiO,GAAO,EACPG,EAAQ,GAER78B,KAAK08B,KACPA,EAAOD,EAAOz8B,KAAK08B,KACV18B,KAAK48B,WACdF,EAAOD,IAAwC,IAAhCz8B,KAAK48B,SAASruB,QAAQ,KACjCvO,KAAK48B,SACL,IAAM58B,KAAK48B,SAAW,KACtB58B,KAAK28B,OACPD,GAAQ,IAAM18B,KAAK28B,OAInB38B,KAAK68B,OACLh1B,EAAK4S,SAASza,KAAK68B,QACnBr/B,OAAOmH,KAAK3E,KAAK68B,OAAOz7B,SAC1By7B,EAAQoB,EAAYhwB,UAAUjO,KAAK68B,QAGrC,IAAIzgB,EAASpc,KAAKoc,QAAWygB,GAAU,IAAMA,GAAW,GAsBxD,OApBIN,GAAoC,MAAxBA,EAAS1c,QAAQ,KAAY0c,GAAY,KAIrDv8B,KAAKw8B,WACHD,GAAYyB,EAAgBzB,MAAuB,IAATG,GAC9CA,EAAO,MAAQA,GAAQ,IACnBI,GAAmC,MAAvBA,EAASiD,OAAO,KAAYjD,EAAW,IAAMA,IACnDJ,IACVA,EAAO,IAGLjO,GAA2B,MAAnBA,EAAKsR,OAAO,KAAYtR,EAAO,IAAMA,GAC7CrS,GAA+B,MAArBA,EAAO2jB,OAAO,KAAY3jB,EAAS,IAAMA,GAOhDmgB,EAAWG,GALlBI,EAAWA,EAASpuB,QAAQ,QAAS,SAASX,GAC5C,OAAOU,mBAAmBV,OAE5BqO,EAASA,EAAO1N,QAAQ,IAAK,QAEgB+f,GAO/C6N,EAAI59B,UAAUkO,QAAU,SAASuwB,GAC/B,OAAOn9B,KAAKo9B,cAAcH,EAASE,GAAU,GAAO,IAAOxvB,UAQ7D2uB,EAAI59B,UAAU0+B,cAAgB,SAASD,GACrC,GAAIt1B,EAAKuS,SAAS+iB,GAAW,CAC3B,IAAI6C,EAAM,IAAI1D,EACd0D,EAAIhD,MAAMG,GAAU,GAAO,GAC3BA,EAAW6C,EAKb,IAFA,IAAI5yB,EAAS,IAAIkvB,EACb2D,EAAQziC,OAAOmH,KAAK3E,MACfkgC,EAAK,EAAGA,EAAKD,EAAM7+B,OAAQ8+B,IAAM,CACxC,IAAIC,EAAOF,EAAMC,GACjB9yB,EAAO+yB,GAAQngC,KAAKmgC,GAQtB,GAHA/yB,EAAOqhB,KAAO0O,EAAS1O,KAGD,KAAlB0O,EAASJ,KAEX,OADA3vB,EAAO2vB,KAAO3vB,EAAOO,SACdP,EAIT,GAAI+vB,EAASX,UAAYW,EAASZ,SAAU,CAG1C,IADA,IAAI6D,EAAQ5iC,OAAOmH,KAAKw4B,GACfkD,EAAK,EAAGA,EAAKD,EAAMh/B,OAAQi/B,IAAM,CACxC,IAAIC,EAAOF,EAAMC,GACJ,aAATC,IACFlzB,EAAOkzB,GAAQnD,EAASmD,IAU5B,OANItC,EAAgB5wB,EAAOmvB,WACvBnvB,EAAOwvB,WAAaxvB,EAAO0vB,WAC7B1vB,EAAO6J,KAAO7J,EAAO0vB,SAAW,KAGlC1vB,EAAO2vB,KAAO3vB,EAAOO,SACdP,EAGT,GAAI+vB,EAASZ,UAAYY,EAASZ,WAAanvB,EAAOmvB,SAAU,CAS9D,IAAKyB,EAAgBb,EAASZ,UAAW,CAEvC,IADA,IAAI53B,EAAOnH,OAAOmH,KAAKw4B,GACdl1B,EAAI,EAAGA,EAAItD,EAAKvD,OAAQ6G,IAAK,CACpC,IAAIiH,EAAIvK,EAAKsD,GACbmF,EAAO8B,GAAKiuB,EAASjuB,GAGvB,OADA9B,EAAO2vB,KAAO3vB,EAAOO,SACdP,EAIT,GADAA,EAAOmvB,SAAWY,EAASZ,SACtBY,EAAST,MAASqB,EAAiBZ,EAASZ,UAS/CnvB,EAAO0vB,SAAWK,EAASL,aAT+B,CAE1D,IADA,IAAIyD,GAAWpD,EAASL,UAAY,IAAI1tB,MAAM,KACvCmxB,EAAQn/B,UAAY+7B,EAAST,KAAO6D,EAAQl8B,WAC9C84B,EAAST,OAAMS,EAAST,KAAO,IAC/BS,EAASP,WAAUO,EAASP,SAAW,IACzB,KAAf2D,EAAQ,IAAWA,EAAQr/B,QAAQ,IACnCq/B,EAAQn/B,OAAS,GAAGm/B,EAAQr/B,QAAQ,IACxCkM,EAAO0vB,SAAWyD,EAAQl0B,KAAK,KAWjC,GAPAe,EAAOgP,OAAS+gB,EAAS/gB,OACzBhP,EAAOyvB,MAAQM,EAASN,MACxBzvB,EAAOsvB,KAAOS,EAAST,MAAQ,GAC/BtvB,EAAOqvB,KAAOU,EAASV,KACvBrvB,EAAOwvB,SAAWO,EAASP,UAAYO,EAAST,KAChDtvB,EAAOuvB,KAAOQ,EAASR,KAEnBvvB,EAAO0vB,UAAY1vB,EAAOgP,OAAQ,CACpC,IAAIxd,EAAIwO,EAAO0vB,UAAY,GACvBj+B,EAAIuO,EAAOgP,QAAU,GACzBhP,EAAO6J,KAAOrY,EAAIC,EAIpB,OAFAuO,EAAOovB,QAAUpvB,EAAOovB,SAAWW,EAASX,QAC5CpvB,EAAO2vB,KAAO3vB,EAAOO,SACdP,EAGT,IAAIozB,EAAepzB,EAAO0vB,UAA0C,MAA9B1vB,EAAO0vB,SAASiD,OAAO,GACzDU,EACItD,EAAST,MACTS,EAASL,UAA4C,MAAhCK,EAASL,SAASiD,OAAO,GAElDW,EAAcD,GAAYD,GACXpzB,EAAOsvB,MAAQS,EAASL,SACvC6D,EAAgBD,EAChBE,EAAUxzB,EAAO0vB,UAAY1vB,EAAO0vB,SAAS1tB,MAAM,MAAQ,GAE3DyxB,GADAN,EAAUpD,EAASL,UAAYK,EAASL,SAAS1tB,MAAM,MAAQ,GACnDhC,EAAOmvB,WAAayB,EAAgB5wB,EAAOmvB,WA2B3D,GApBIsE,IACFzzB,EAAOwvB,SAAW,GAClBxvB,EAAOuvB,KAAO,KACVvvB,EAAOsvB,OACU,KAAfkE,EAAQ,GAAWA,EAAQ,GAAKxzB,EAAOsvB,KACtCkE,EAAQ1/B,QAAQkM,EAAOsvB,OAE9BtvB,EAAOsvB,KAAO,GACVS,EAASZ,WACXY,EAASP,SAAW,KACpBO,EAASR,KAAO,KACZQ,EAAST,OACQ,KAAf6D,EAAQ,GAAWA,EAAQ,GAAKpD,EAAST,KACxC6D,EAAQr/B,QAAQi8B,EAAST,OAEhCS,EAAST,KAAO,MAElBgE,EAAaA,IAA8B,KAAfH,EAAQ,IAA4B,KAAfK,EAAQ,KAGvDH,EAEFrzB,EAAOsvB,KAAQS,EAAST,MAA0B,KAAlBS,EAAST,KAC3BS,EAAST,KAAOtvB,EAAOsvB,KACrCtvB,EAAOwvB,SAAYO,EAASP,UAAkC,KAAtBO,EAASP,SAC/BO,EAASP,SAAWxvB,EAAOwvB,SAC7CxvB,EAAOgP,OAAS+gB,EAAS/gB,OACzBhP,EAAOyvB,MAAQM,EAASN,MACxB+D,EAAUL,OAEL,GAAIA,EAAQn/B,OAGZw/B,IAASA,EAAU,IACxBA,EAAQr8B,MACRq8B,EAAUA,EAAQlhC,OAAO6gC,GACzBnzB,EAAOgP,OAAS+gB,EAAS/gB,OACzBhP,EAAOyvB,MAAQM,EAASN,WACnB,IAAKh1B,EAAKqS,kBAAkBijB,EAAS/gB,QAAS,CAInD,GAAIykB,EACFzzB,EAAOwvB,SAAWxvB,EAAOsvB,KAAOkE,EAAQv8B,SAIpCy8B,KAAa1zB,EAAOsvB,MAAQtvB,EAAOsvB,KAAKnuB,QAAQ,KAAO,IAC1CnB,EAAOsvB,KAAKttB,MAAM,QAEjChC,EAAOqvB,KAAOqE,EAAWz8B,QACzB+I,EAAOsvB,KAAOtvB,EAAOwvB,SAAWkE,EAAWz8B,SAW/C,OARA+I,EAAOgP,OAAS+gB,EAAS/gB,OACzBhP,EAAOyvB,MAAQM,EAASN,MAEnBh1B,EAAKoS,OAAO7M,EAAO0vB,WAAcj1B,EAAKoS,OAAO7M,EAAOgP,UACvDhP,EAAO6J,MAAQ7J,EAAO0vB,SAAW1vB,EAAO0vB,SAAW,KACpC1vB,EAAOgP,OAAShP,EAAOgP,OAAS,KAEjDhP,EAAO2vB,KAAO3vB,EAAOO,SACdP,EAGT,IAAKwzB,EAAQx/B,OAWX,OARAgM,EAAO0vB,SAAW,KAEd1vB,EAAOgP,OACThP,EAAO6J,KAAO,IAAM7J,EAAOgP,OAE3BhP,EAAO6J,KAAO,KAEhB7J,EAAO2vB,KAAO3vB,EAAOO,SACdP,EAcT,IARA,IAAI0sB,EAAO8G,EAAQvxB,OAAO,GAAG,GACzB0xB,GACC3zB,EAAOsvB,MAAQS,EAAST,MAAQkE,EAAQx/B,OAAS,KACxC,MAAT04B,GAAyB,OAATA,IAA2B,KAATA,EAInCkH,EAAK,EACAlkC,EAAI8jC,EAAQx/B,OAAQtE,GAAK,EAAGA,IAEtB,OADbg9B,EAAO8G,EAAQ9jC,IAEb8jC,EAAQK,OAAOnkC,EAAG,GACA,OAATg9B,GACT8G,EAAQK,OAAOnkC,EAAG,GAClBkkC,KACSA,IACTJ,EAAQK,OAAOnkC,EAAG,GAClBkkC,KAKJ,IAAKN,IAAeC,EAClB,KAAOK,IAAMA,EACXJ,EAAQ1/B,QAAQ,OAIhBw/B,GAA6B,KAAfE,EAAQ,IACpBA,EAAQ,IAA+B,MAAzBA,EAAQ,GAAGb,OAAO,IACpCa,EAAQ1/B,QAAQ,IAGd6/B,GAAsD,MAAjCH,EAAQv0B,KAAK,KAAKwT,QAAQ,IACjD+gB,EAAQz/B,KAAK,IAGf,IAUM2/B,EAVFI,EAA4B,KAAfN,EAAQ,IACpBA,EAAQ,IAA+B,MAAzBA,EAAQ,GAAGb,OAAO,GAGjCc,IACFzzB,EAAOwvB,SAAWxvB,EAAOsvB,KAAOwE,EAAa,GACbN,EAAQx/B,OAASw/B,EAAQv8B,QAAU,IAI/Dy8B,KAAa1zB,EAAOsvB,MAAQtvB,EAAOsvB,KAAKnuB,QAAQ,KAAO,IAC1CnB,EAAOsvB,KAAKttB,MAAM,QAEjChC,EAAOqvB,KAAOqE,EAAWz8B,QACzB+I,EAAOsvB,KAAOtvB,EAAOwvB,SAAWkE,EAAWz8B,UAyB/C,OArBAq8B,EAAaA,GAAetzB,EAAOsvB,MAAQkE,EAAQx/B,UAEhC8/B,GACjBN,EAAQ1/B,QAAQ,IAGb0/B,EAAQx/B,OAIXgM,EAAO0vB,SAAW8D,EAAQv0B,KAAK,MAH/Be,EAAO0vB,SAAW,KAClB1vB,EAAO6J,KAAO,MAMXpP,EAAKoS,OAAO7M,EAAO0vB,WAAcj1B,EAAKoS,OAAO7M,EAAOgP,UACvDhP,EAAO6J,MAAQ7J,EAAO0vB,SAAW1vB,EAAO0vB,SAAW,KACpC1vB,EAAOgP,OAAShP,EAAOgP,OAAS,KAEjDhP,EAAOqvB,KAAOU,EAASV,MAAQrvB,EAAOqvB,KACtCrvB,EAAOovB,QAAUpvB,EAAOovB,SAAWW,EAASX,QAC5CpvB,EAAO2vB,KAAO3vB,EAAOO,SACdP,GAGTkvB,EAAI59B,UAAUugC,UAAY,WACxB,IAAIvC,EAAO18B,KAAK08B,KACZC,EAAOW,EAAYqB,KAAKjC,GACxBC,IAEW,OADbA,EAAOA,EAAK,MAEV38B,KAAK28B,KAAOA,EAAK9c,OAAO,IAE1B6c,EAAOA,EAAK7c,OAAO,EAAG6c,EAAKt7B,OAASu7B,EAAKv7B,SAEvCs7B,IAAM18B,KAAK48B,SAAWF,K,gBCztB5B,IAAIyE,EAAS,EAAQ,IACjBC,EAAU,EAAQ,GAGtB,SAASC,EAAiB/hB,EAAOgiB,GAC/BthC,KAAKsL,GAAKgU,EACVtf,KAAKshC,IAAMA,EAHbzkC,EAAOD,QAAQykC,iBAAmBA,EAYlCxkC,EAAOD,QAAQ2kC,KAAO,SAAc70B,EAAMvB,GACxC,SAASq2B,EAAWC,EAASt2B,GAC3B,GAAIA,GAAyB,iBAARA,EAErB,GAAGA,EAAOu2B,KAAV,CACE,IAAIC,EAAcR,EAAOv0B,QAAQ60B,EAASt2B,EAAOu2B,MACjDJ,EAAIK,GAAeL,EAAIK,GAAeL,EAAIK,GAAa,EAAI,MAF7D,CAKA,IAAIC,EAAUz2B,EAAOG,GAAK61B,EAAOv0B,QAAQ60B,EAASt2B,EAAOG,IAAMm2B,EAC/D,GAAIG,EAAS,CAGX,GADGA,EAAQrzB,QAAQ,KAAK,IAAGqzB,GAAW,KACnCtiB,EAAMsiB,GAAS,CAChB,IAAIR,EAAQzyB,kBAAkB2Q,EAAMsiB,GAAUz2B,GAC5C,MAAM,IAAI5J,MAAM,WAAW4J,EAAO,8CAEpC,OAAOmU,EAAMsiB,GAEftiB,EAAMsiB,GAAWz2B,EAEa,KAA3By2B,EAAQA,EAAQxgC,OAAO,KACxBke,EAAMsiB,EAAQ1U,UAAU,EAAG0U,EAAQxgC,OAAO,IAAM+J,GAGpD02B,EAAUD,EAAQ,SAAYz2B,EAAO22B,iBAAiBr/B,MAAO0I,EAAO22B,MAAM,CAAC32B,EAAO22B,QAClFD,EAAUD,EAAQ,WAAcz2B,EAAO42B,mBAAmBt/B,MAAO0I,EAAO42B,QAAQ,CAAC52B,EAAO42B,UACxFP,EAAWI,EAAQ,mBAAoBz2B,EAAO62B,iBAC9CC,EAAWL,EAAQ,cAAez2B,EAAO+2B,YACzCV,EAAWI,EAAQ,wBAAyBz2B,EAAOg3B,sBACnDF,EAAWL,EAAQ,eAAgBz2B,EAAOi3B,aAC1CH,EAAWL,EAAQ,qBAAsBz2B,EAAOk3B,mBAChDJ,EAAWL,EAAQ,gBAAiBz2B,EAAOm3B,cAC3CT,EAAUD,EAAQ,YAAaz2B,EAAOo3B,UACtCV,EAAUD,EAAQ,SAAUz2B,EAAOq3B,OACnCX,EAAUD,EAAQ,SAAUz2B,EAAOs3B,OACnCZ,EAAUD,EAAQ,SAAUz2B,EAAOu3B,OACnClB,EAAWI,EAAQ,OAAQz2B,EAAOw3B,MAEpC,SAASd,EAAUJ,EAAS90B,GAC1B,GAAKA,aAAmBlK,MACxB,IAAI,IAAI3F,EAAE,EAAGA,EAAE6P,EAAQvL,OAAQtE,IAC7B0kC,EAAWC,EAAQ,IAAI3kC,EAAG6P,EAAQ7P,IAGtC,SAASmlC,EAAWR,EAAS90B,GAC3B,GAAIA,GAA2B,iBAATA,EACtB,IAAI,IAAI/N,KAAK+N,EACX60B,EAAWC,EAAQ,IAAI7iC,EAAG+N,EAAQ/N,IAItC,IAAI0gB,EAAQ,GACRgiB,EAAM,GAGV,OADAE,EAAW90B,EAAMvB,GACV,IAAIk2B,EAAiB/hB,EAAOgiB,K,8ECrExB,EAAAsB,cAAwC,CACnDC,aAAc,68BAgBdC,YAAa,ioCAcbC,UAAW,gOAgBA,EAAAC,oBACT,qhBAcS,EAAAC,kBACT,40BAsBS,EAAAha,iBACL,mqBAiBK,EAAAO,oBACL,0hDA8BK,EAAAa,oBACT,kLAQS,EAAAY,sBACT,uFAOU,EAAAF,yBACV,qKAOS,EAAAX,qBACT,qKAQS,EAAAK,oBACT,0OASS,EAAAR,mBACT,iuBAiBS,EAAAiZ,aAAuB,CAClC,GAAM,yLAIN,MAAS,kLAIT,IAAO,iQAKP,WAAc,qSAMd,SAAY,+LAIZ,cAAiB,qM,8EC7NnB,cAGA,QAMA,OAEA,IAAIruB,EAA0BQ,EAAoBwU,EAAqBhX,EACnEswB,EAAc,EAgBlB,SAASC,EAAmB7yB,GACV,WAAZA,EAAIlS,MACF0H,SAASwM,uBAAuB,YAAYnR,OAAS,GACvDyoB,EAAKwZ,gBAEP,EAAA1vB,YAIJ,SAAS2vB,IACP,MAAMC,EAAYx9B,SAASiK,eAAe,aAC1C,QAAIuzB,GACKA,EAAU9yB,UAAUE,SAAS,aAKxC,SAAS6yB,EAAiBjzB,GAAaA,EAAIC,kBA4B3C,SAASizB,EAAclzB,GACrB,IAAK8E,EAAU,OAIf,GAAa,WAHAA,EAASquB,gBAGGnzB,EAAIozB,SAE7B,GAAqB,QAAjB3jC,KAAKunB,SAA4C,cAAvB,EAAA7T,oBAC5B,GAAkC,OAA9B1T,KAAKgV,QAAQ,aAAuB,CACtC,IAAI6W,EAAY,CAAC7rB,MAEjB,MAAM4jC,EAAoB,aACpBC,EAAqB,YAC3B,GAAI7jC,KAAKsT,aAAa,cAAcvF,MAAM81B,GAAqB,CAE7D,MAAMzuB,EAAKpV,KAAKgV,QAAQ,OAClByU,EAAQzpB,KAAKgV,QAAQ,UACrB8uB,EAAUrhC,MAAMuR,KAAKyV,EAAM7Q,UAAUrK,QAAQ6G,GAC7C2uB,EAAWta,EAAM7Q,SAASkrB,EAAU,GAAGlrB,SAAS,GACtDjX,QAAQqiC,OAAOD,EAASzwB,aAAa,cAAcvF,MAAM61B,GAAoB,uCACvC,OAAlCG,EAAS/uB,QAAQ,cACnB6W,EAAU3qB,QAAQ6iC,QAEf,GAAI/jC,KAAKsT,aAAa,cAAcvF,MAAM61B,GAAoB,CAEnE,MAAMxuB,EAAKpV,KAAKgV,QAAQ,OAClByU,EAAQzpB,KAAKgV,QAAQ,UACrB8uB,EAAUrhC,MAAMuR,KAAKyV,EAAM7Q,UAAUrK,QAAQ6G,GAC7C6uB,EAAYxa,EAAM7Q,SAASkrB,EAAU,GAAGlrB,SAAS,GACvDjX,QAAQqiC,OAAOC,EAAU3wB,aAAa,cAAcvF,MAAM81B,GAAqB,wCACxC,OAAnCI,EAAUjvB,QAAQ,cACpB6W,EAAU1qB,KAAK8iC,IAGfz8B,OAAO08B,UAAUC,UAAUp2B,MAAM,OAASwC,EAAI6zB,QAAU7zB,EAAI8zB,WAC9DxY,EAAYA,EAAUnsB,OAAO+C,MAAMuR,KAAKjO,SAASwM,uBAAuB,eAE1E,EAAA+B,UAAUuX,EAAWxW,EAAUR,GAC3BA,GACFA,EAAYqB,iBAGX,GAA4C,SAAvC3F,EAAIpR,OAAuBooB,SAA6C,cAAvB,EAAA7T,oBAC3D,GAAkC,OAA9B1T,KAAKgV,QAAQ,aAAuB,CACtC,IAAI6W,EAAY,CAACtb,EAAIpR,SACjBqI,OAAO08B,UAAUC,UAAUp2B,MAAM,OAASwC,EAAI6zB,QAAU7zB,EAAI8zB,WAC9DxY,EAAYA,EAAUnsB,OAAO+C,MAAMuR,KAAKjO,SAASwM,uBAAuB,eAE1E,EAAA+B,UAAUuX,EAAWxW,EAAUR,GAC3BA,GACFA,EAAYqB,gBAGX,CAEL,GAA2B,eAAvB,EAAAxC,mBAEF,YADAmW,EAAKwZ,gBAKP,MAAMiB,EAAYv+B,SAASwM,uBAAuB,eAAe,GAAGA,uBAAuB,oBAAoB,GAC/G,IAAIgyB,EAAKD,EAAUE,iBACnBD,EAAG7qB,EAAInJ,EAAIk0B,QACXF,EAAG3qB,EAAIrJ,EAAIm0B,QACX,MAAMC,EAAmBL,EAAU/xB,uBAAuB,UAAU,GAA0BqyB,eAC9FL,EAAKA,EAAGM,gBAAgBF,EAAgBG,WAExC,MAAMC,EAAiBtiC,MAAMuR,KAAKjO,SAASwM,uBAAuB,UAC/D4G,OAAQhD,IACP,MAAMJ,EAAO,EAAAivB,aAAa7uB,GAC1B,IAAIS,EAAMb,EAAKa,IACXC,EAAMd,EAAKc,IACXC,EAAMf,EAAKe,IACXC,EAAMhB,EAAKgB,IACXC,EAAOjB,EAAKiB,KAEhB,OAAQutB,EAAG7qB,EAAI9C,GAAO2tB,EAAG7qB,EAAI5C,GAC1BytB,EAAG3qB,EAAK/C,GAAO0tB,EAAG7qB,EAAI9C,GAAO3E,KAAKgzB,IAAIjuB,IACtCutB,EAAG3qB,EAAK7C,GAAOD,EAAMytB,EAAG7qB,GAAKzH,KAAKgzB,IAAIjuB,KAI7C,GADA,EAAArD,WAC6B,GAAzBoxB,EAAe3jC,OACjB,OAIF,MAAM+U,EAAQ4uB,EAAe,GAClB,EAAAC,aAAa7uB,GACnBA,EAAM1F,UAAUE,SAAS,cAE5B,EAAAmE,YAAYqB,EAAOtB,GACnB,EAAAoB,OAAOE,EAAOd,EAAUR,GACpBA,GACFA,EAAYqB,YAIhBC,EAAM+uB,cAAc,IAAIC,WAAW,YAAa,CAC9CC,QAAS70B,EAAI60B,QACbC,QAAS90B,EAAI80B,QACbZ,QAASl0B,EAAIk0B,QACbC,QAASn0B,EAAIm0B,QACbL,QAAS9zB,EAAI8zB,QACbV,SAAUpzB,EAAIozB,SACd2B,OAAQ/0B,EAAI+0B,OACZlB,QAAS7zB,EAAI6zB,QACb7uB,KAAMhF,EAAIgF,SAvKhB,gCAAsCgwB,GACpCpC,EAAcoC,GAMhB,kCAAwCC,EAAcC,GACpD5wB,EAAc4wB,EAEd5b,GADAxU,EAAWmwB,GACK3b,KAChBhX,EAAcwC,EAASE,KAAK1C,aA0B9B,uBAA6BsY,GAC3BplB,SAASgL,iBAAiBoa,GAAU7c,QAAQo3B,IAC1CA,EAAIp0B,oBAAoB,YAAamyB,GACrCiC,EAAIp1B,iBAAiB,YAAamzB,KAIpC19B,SAAS6K,KAAKU,oBAAoB,UAAW8xB,GAC7Cr9B,SAAS6K,KAAKN,iBAAiB,UAAW8yB,GAE1Cr9B,SAASiK,eAAe,aACrBM,iBAAiB,cAAgBC,IAAUA,EAAIuY,mBAElD/iB,SAASgL,iBAAiB,sBAAsBzC,QAAQo3B,IACtDA,EAAIp0B,oBAAoB,QAASkyB,GACjCkC,EAAIp1B,iBAAiB,QAASkzB,MA4HlC,sBAA4BrY,GAC1B,IAAIwa,EAAW,EACXC,EAAW,EACXC,GAAU,EACVC,GAAgB,EAEpB78B,EAAGqL,UAAU6W,EAASzc,QAAQ,eAAgB,IAAIqY,QAC/CjjB,GAAG,QAAS,MACf,MAAMiiC,EAAS98B,EAAG2L,OAAOuW,GACnB6a,EAAmB/8B,EAAGoiB,OACzBvnB,GAAG,QAQN,WACE,IAAKuR,EAAU,OACf,MAAM4wB,EAAW5wB,EAASquB,cAC1B,GAA6C,QAAzCz6B,EAAGsiB,MAAME,YAAYtsB,OAAO+mC,UAAmC,WAAbD,GAAkE,SAAzCh9B,EAAGsiB,MAAME,YAAYtsB,OAAO+mC,UACzG,GAAKj9B,EAAGsiB,MAAME,YAAYkY,SAWxBkC,GAAU,OACU3lC,IAAhB2S,GACFA,EAAYszB,iBAZd,IAAKpgC,SAASiK,eAAe,cAAcS,UAAUE,SAAS,eA2B1C4zB,EA1BFt7B,EAAGm9B,MAAMpmC,MAwCH,IAbbyC,MAAMuR,KAAKjO,SAASwM,uBAAuB,UAClC4G,OAAQhD,IAC9B,MAAMJ,EAAO,EAAAivB,aAAa7uB,GACxB,IAAIS,EAAMb,EAAKa,IACXC,EAAMd,EAAKc,IACXC,EAAMf,EAAKe,IACXC,EAAMhB,EAAKgB,IACXC,EAAOjB,EAAKiB,KAEhB,OAAQutB,EAAG,GAAK3tB,GAAO2tB,EAAG,GAAKztB,GAC5BytB,EAAG,GAAM1tB,GAAO0tB,EAAG,GAAK3tB,GAAO3E,KAAKgzB,IAAIjuB,IACxCutB,EAAG,GAAMxtB,GAAOD,EAAMytB,EAAG,IAAMtyB,KAAKgzB,IAAIjuB,KAE9B5V,QAxCsB,CACjC,EAAAuS,WACAmyB,GAAgB,EAChB,MAAMO,EAAWp9B,EAAGm9B,MAAMpmC,MAC1B2lC,EAAWU,EAAS,GACpBT,EAAWS,EAAS,GAyJTzvB,EAxJF+uB,EAwJe9uB,EAxJL+uB,EAyJzBG,EAAOhY,OAAO,QACX/B,KAAK,IAAKpV,GACVoV,KAAK,IAAKnV,GACVmV,KAAK,QAAS,GACdA,KAAK,SAAU,GACfA,KAAK,KAAM,cACXA,KAAK,SAAU,SACfA,KAAK,eAAgBmX,GACrBnX,KAAK,OAAQ,cAzJL/iB,EAAGsiB,MAAME,YAAYkY,WAC9BkC,GAAU,OACU3lC,IAAhB2S,GACFA,EAAYszB,aA6IlB,IAAmBvvB,EAAaC,EApIhC,IAA0B0tB,IAvCvBzgC,GAAG,OAwDN,WACE,IAAK+hC,GAAWC,EAAe,CAC7B,MAAMQ,EAAYr9B,EAAGm9B,MAAMpmC,MACrBumC,EAAOD,EAAU,GACjBE,EAAOF,EAAU,IAkI3B,SAAqBG,EAAcC,EAAcC,EAAsBC,GACrE39B,EAAG2L,OAAO,eACPoX,KAAK,IAAKya,GACVza,KAAK,IAAK0a,GACV1a,KAAK,QAAS2a,GACd3a,KAAK,SAAU4a,GAhIhBC,CALaN,EAAOZ,EAAWY,EAAOZ,EACzBa,EAAOZ,EAAWY,EAAOZ,EACxBW,EAAOZ,EAAWA,EAAWY,EAAOA,EAAOZ,EAC1Ca,EAAOZ,EAAWA,EAAWY,EAAOA,EAAOZ,QAGjDC,QACW3lC,IAAhB2S,GACFA,EAAY6Y,aArEf5nB,GAAG,MA0EN,WACE,IAAK+hC,GAAWC,EAAe,CAC7B,MAAMgB,EAAK35B,SAASpH,SAASiK,eAAe,cAAcsD,aAAa,MACjEyzB,EAAK55B,SAASpH,SAASiK,eAAe,cAAcsD,aAAa,MACjE0zB,EAAK75B,SAASpH,SAASiK,eAAe,cAAcsD,aAAa,MACrEnG,SAASpH,SAASiK,eAAe,cAAcsD,aAAa,UACxD2zB,EAAK95B,SAASpH,SAASiK,eAAe,cAAcsD,aAAa,MACrEnG,SAASpH,SAASiK,eAAe,cAAcsD,aAAa,WAExD4zB,EAAOnB,EAAOmB,OACpB,IAAIC,EAAKD,EAAK1C,iBACd2C,EAAGztB,EAAIotB,EACPK,EAAGvtB,EAAImtB,EACP,IAAIK,EAAKF,EAAK1C,iBACd4C,EAAG1tB,EAAIstB,EACPI,EAAGxtB,EAAIqtB,EACP,MAAMI,EAAYH,EAAKtC,eAAeE,UACnCwC,SAAUvB,EAAOnxB,OAAO,WAAWsyB,OACjCtC,gBAAgBE,UAIrB,IAAI1vB,EAHJ+xB,EAAKA,EAAGtC,gBAAgBwC,GACxBD,EAAKA,EAAGvC,gBAAgBwC,GAItBjyB,EADErP,SAASiK,eAAe,cAAcS,UAAUE,SAAS,aACtD5K,SAASgL,iBAAiBoa,EAAW,SAAWA,EAAW,WACvDmY,IACJv9B,SAASgL,iBAAiBoa,EAAW,yBAErCplB,SAASgL,iBAAiBoa,EAAW,QAE5C,MAEMzV,EAFMjT,MAAMuR,KAAKoB,GAEF+D,OAAO,SAAU/b,GACpC,IAAIwZ,EAAKC,EAAKC,EAAKC,EACnB,GAAIusB,IAKF,OAJA1sB,EAAMhX,OAAOxC,EAAEkW,aAAa,MAC5BuD,EAAMjX,OAAOxC,EAAEkW,aAAa,MAC5BwD,GAAOF,IAAQxZ,EAAEkW,aAAa,SAASjE,MAAM,GAAI,GACjD0H,GAAOF,IAAQzZ,EAAEkW,aAAa,UAAUjE,MAAM,GAAI,KACvC83B,EAAGztB,EAAI9C,GAAOwwB,EAAG1tB,EAAI9C,GAASuwB,EAAGztB,EAAI5C,GAAOswB,EAAG1tB,EAAI5C,GAAWqwB,EAAGvtB,EAAI/C,GAAOuwB,EAAGxtB,EAAI/C,GAASswB,EAAGvtB,EAAI7C,GAAOqwB,EAAGxtB,EAAI7C,GACvH,GAAkB,QAAd3Z,EAAEmqB,QAAmB,CAC9B,MAAMggB,EAAOnqC,EAAEqJ,WAA2B+gC,UAK1C,OAJA5wB,EAAM2wB,EAAI7tB,EACV7C,EAAM0wB,EAAI3tB,EACV9C,EAAMywB,EAAI7tB,EAAI6tB,EAAIhC,MAClBxuB,EAAMwwB,EAAI3tB,EAAI2tB,EAAIE,SACPN,EAAGztB,EAAI9C,GAAOwwB,EAAG1tB,EAAI9C,GAASuwB,EAAGztB,EAAI5C,GAAOswB,EAAG1tB,EAAI5C,GAAWqwB,EAAGvtB,EAAI/C,GAAOuwB,EAAGxtB,EAAI/C,GAASswB,EAAGvtB,EAAI7C,GAAOqwB,EAAGxtB,EAAI7C,GACvH,CACL,MAAMwwB,EAAM,EAAAvC,aAAa5nC,GACzB,QAAU+pC,EAAGztB,EAAI6tB,EAAI3wB,KAAOwwB,EAAG1tB,EAAI6tB,EAAI3wB,KAC9BuwB,EAAGztB,EAAI6tB,EAAIzwB,KAAOswB,EAAG1tB,EAAI6tB,EAAIzwB,KAC7BqwB,EAAGvtB,EAAK2tB,EAAI1wB,IAAM5E,KAAK4G,IAAI0uB,EAAI3wB,IAAMuwB,EAAGztB,GAAKzH,KAAKgzB,IAAIsC,EAAIvwB,OACzDowB,EAAGxtB,EAAK2tB,EAAI1wB,IAAM5E,KAAK4G,IAAI0uB,EAAI3wB,IAAMuwB,EAAGztB,GAAKzH,KAAKgzB,IAAIsC,EAAIvwB,OAC3DmwB,EAAGvtB,EAAK2tB,EAAIxwB,IAAM9E,KAAK4G,IAAI0uB,EAAIxwB,IAAMqwB,EAAGxtB,GAAK3H,KAAKgzB,IAAIsC,EAAIvwB,OACzDowB,EAAGxtB,EAAK2tB,EAAIxwB,IAAM9E,KAAK4G,IAAI0uB,EAAIxwB,IAAMqwB,EAAGxtB,GAAK3H,KAAKgzB,IAAIsC,EAAIvwB,UAKxEtB,EAASpH,QAASxI,IAChB,GAAwB,QAApBA,EAAQyhB,SAAqBzhB,EAAQwN,aAAa,cAAcvF,MAAM,kBAAmB,CAC3F,MAAM0b,EAAQ3jB,EAAQkP,QAAQ,UACxB8uB,EAAUrhC,MAAMuR,KAAKyV,EAAM7Q,UAAUrK,QAAQzI,EAAQkP,QAAQ,QACnE,GAAIlP,EAAQwN,aAAa,cAAcvF,MAAM,cAAe,CAE1D,MACMk2B,EADWxa,EAAM7Q,SAASkrB,EAAU,GACflyB,cAAc,OACrC8D,EAASnH,QAAQ01B,GAAa,GAChCvuB,EAASvU,KAAK8iC,OAEX,CAEL,MACMF,EADUta,EAAM7Q,SAASkrB,EAAU,GAChBlyB,cAAc,OACnC8D,EAASnH,QAAQw1B,GAAY,GAC/BruB,EAASvU,KAAK4iC,OAKtB,EAAAzvB,UAAUoB,EAAUL,EAAUR,GAE1BA,GACFA,EAAYqB,WAEdjN,EAAGqL,UAAU,eAAexD,SAC5Bg1B,GAAgB,EAElBD,GAAU,IAjKZE,EAAO9oC,KAAK+oC,GACRnxB,GACFA,EAAY6yB,QAAQ1B,K,6BC/MxB,yBA4FI2B,EACAC,EA7FJ,0GAQA,SAASC,EAAOxpC,GACd,MAAO,IAAMA,EAEf,SAASypC,EAASzpC,GAChB,OAAOA,EAAI6uB,UAAU,GAEvB,SAAS6a,IACP/nC,KAAKgoC,OAAS,GAoChB,SAASC,EAAM99B,GAIb,GAHAnK,KAAKgoC,OAAS,IAAID,EAGd59B,GAAS1H,MAAM2L,QAAQjE,GACzB,IAAK,IAAIrN,EAAI,EAAG6G,EAAMwG,EAAM/I,OAAQtE,EAAI6G,EAAK7G,IAC3CkD,KAAKiR,IAAI9G,EAAMrN,IAiErB,SAASorC,EAAkB1pC,GACzB,GAAIA,aAAkBse,YACpB,OAdJ,SAA0BwR,GACxB,GAA0B,mBAAfA,EAAKjf,MACd,OAAOif,EAAKjf,MAAM,GAGpB,IAAIlQ,EAAS,IAAI2d,YAAYwR,EAAKtR,YAC9B4Q,EAAc,IAAIlR,WAAWvd,GAC7B0uB,EAAc,IAAInR,WAAW4R,GAEjC,OADAV,EAAY9qB,IAAI+qB,GACT1uB,EAKEgpC,CAAiB3pC,GAE1B,IAAIyZ,EAAOzZ,EAAOyZ,KACdxX,EAAOjC,EAAOiC,KAElB,MAA4B,mBAAjBjC,EAAO6Q,MACT7Q,EAAO6Q,MAAM,EAAG4I,EAAMxX,GAGxBjC,EAAO4pC,YAAY,EAAGnwB,EAAMxX,GApHrCsnC,EAAMrpC,UAAUf,IAAM,SAAUU,GAC9B,IAAIgqC,EAAUR,EAAOxpC,GACrB,OAAO2B,KAAKgoC,OAAOK,IAErBN,EAAMrpC,UAAUoE,IAAM,SAAUzE,EAAKN,GACnC,IAAIsqC,EAAUR,EAAOxpC,GAErB,OADA2B,KAAKgoC,OAAOK,GAAWtqC,GAChB,GAETgqC,EAAMrpC,UAAU4pC,IAAM,SAAUjqC,GAE9B,OADcwpC,EAAOxpC,KACH2B,KAAKgoC,QAEzBD,EAAMrpC,UAAU6pC,OAAS,SAAUlqC,GACjC,IAAIgqC,EAAUR,EAAOxpC,GACjB6N,EAAMm8B,KAAWroC,KAAKgoC,OAE1B,cADOhoC,KAAKgoC,OAAOK,GACZn8B,GAET67B,EAAMrpC,UAAU4P,QAAU,SAAUtF,GAElC,IADA,IAAIrE,EAAOnH,OAAOmH,KAAK3E,KAAKgoC,QACnBlrC,EAAI,EAAG6G,EAAMgB,EAAKvD,OAAQtE,EAAI6G,EAAK7G,IAAK,CAC/C,IAAIuB,EAAMsG,EAAK7H,GAGfkM,EAFYhJ,KAAKgoC,OAAO3pC,GACxBA,EAAMypC,EAASzpC,MAInBb,OAAOC,eAAesqC,EAAMrpC,UAAW,OAAQ,CAC7Cf,IAAK,WACH,OAAOH,OAAOmH,KAAK3E,KAAKgoC,QAAQ5mC,UAcpC6mC,EAAMvpC,UAAUuS,IAAM,SAAU5S,GAC9B,OAAO2B,KAAKgoC,OAAOllC,IAAIzE,GAAK,IAE9B4pC,EAAMvpC,UAAU4pC,IAAM,SAAUjqC,GAC9B,OAAO2B,KAAKgoC,OAAOM,IAAIjqC,IAEzB4pC,EAAMvpC,UAAU4P,QAAU,SAAUtF,GAClChJ,KAAKgoC,OAAO15B,QAAQ,SAAUvQ,EAAOM,GACnC2K,EAAG3K,MAGPb,OAAOC,eAAewqC,EAAMvpC,UAAW,OAAQ,CAC7Cf,IAAK,WACH,OAAOqC,KAAKgoC,OAAO/vB,SAQvB,WACE,GAAsB,oBAAXpa,QAAyC,oBAAR2qC,KAAsC,oBAAR9wB,IACxE,OAAO,EAET,IAAIgc,EAAOl2B,OAAOuyB,yBAAyByY,IAAK3qC,OAAOmkB,SACvD,OAAO0R,GAAQ,QAASA,GAAQ8U,IAAI3qC,OAAOmkB,WAAawmB,IASpDC,IAIFd,EAAcM,EACdL,EAAcG,IAJdJ,EAAcjwB,IACdkwB,EAAcY,KA0ClB,IAAIE,EAAeppC,SAASZ,UAAU8M,SAClCm9B,EAAmBD,EAAazrC,KAAKO,QAazC,SAASorC,EAAMpqC,GACb,IAAIqqC,EACA/rC,EACA6G,EAEJ,IAAKnF,GAA4B,iBAAXA,EACpB,OAAOA,EAGT,GAAIiE,MAAM2L,QAAQ5P,GAAS,CAEzB,IADAqqC,EAAY,GACP/rC,EAAI,EAAG6G,EAAMnF,EAAO4C,OAAQtE,EAAI6G,EAAK7G,IACxC+rC,EAAU/rC,GAAK8rC,EAAMpqC,EAAO1B,IAE9B,OAAO+rC,EAKT,GAAIrqC,aAAkBwzB,KACpB,OAAOxzB,EAAOsqC,cAGhB,GAxEF,SAAwBtqC,GACtB,MAA+B,oBAAhBse,aAA+Bte,aAAkBse,aAC7C,oBAATisB,MAAwBvqC,aAAkBuqC,KAsEhDC,CAAexqC,GACjB,OAAO0pC,EAAkB1pC,GAG3B,IAtCF,SAAuBT,GACrB,IAAI6gC,EAAQphC,OAAOyF,eAAelF,GAElC,GAAc,OAAV6gC,EACF,OAAO,EAET,IAAIqK,EAAOrK,EAAM35B,YACjB,MAAuB,mBAARgkC,GACbA,aAAgBA,GAAQP,EAAazrC,KAAKgsC,IAASN,EA8BhDO,CAAc1qC,GACjB,OAAOA,EAIT,IAAK1B,KADL+rC,EAAY,GACFrqC,EAER,GAAIhB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQ1B,GAAI,CACnD,IAAIiB,EAAQ6qC,EAAMpqC,EAAO1B,SACJ,IAAViB,IACT8qC,EAAU/rC,GAAKiB,GAIrB,OAAO8qC,EAGT,SAAS7kC,EAAKkF,GACZ,IAAIvD,GAAS,EACb,OAAO,IAAa,SAAUtG,GAE5B,GAAIsG,EAEF,MAAM,IAAIpE,MAAM,8BAEhBoE,GAAS,EACTuD,EAAIhK,MAAMc,KAAMX,KAKtB,SAAS8pC,EAAUC,GAEjB,OAAO,IAAa,SAAU/pC,GAE5BA,EAAOupC,EAAMvpC,GACb,IAAIqJ,EAAO1I,KAEPqpC,EAA2C,mBAA1BhqC,EAAKA,EAAK+B,OAAS,IAAqB/B,EAAKkF,MAC9D8vB,EAAU,IAAIC,QAAQ,SAAUgV,EAAS/U,GAC3C,IAAIgV,EACJ,IACE,IAAI7T,EAAW1xB,EAAK,SAAUT,EAAKimC,GAC7BjmC,EACFgxB,EAAOhxB,GAEP+lC,EAAQE,KAKZnqC,EAAK8B,KAAKu0B,IACV6T,EAAOH,EAAKlqC,MAAMwJ,EAAMrJ,KACS,mBAAdkqC,EAAKhhB,MACtB+gB,EAAQC,GAEV,MAAOhiC,GACPgtB,EAAOhtB,MASX,OALI8hC,GACFhV,EAAQ9L,KAAK,SAAUnb,GACrBi8B,EAAO,KAAMj8B,IACZi8B,GAEEhV,IA0BX,SAASoV,EAAWpsC,EAAMq4B,GACxB,OAAOyT,EAAU,IAAa,SAAU9pC,GACtC,GAAIW,KAAK0pC,QACP,OAAOpV,QAAQC,OAAO,IAAIhzB,MAAM,uBAElC,GAAIvB,KAAK2pC,WACP,OAAOrV,QAAQC,OAAO,IAAIhzB,MAAM,0BAElC,IAAImH,EAAO1I,KAEX,OAhCJ,SAAoB0I,EAAMrL,EAAMgC,GAE9B,GAAIqJ,EAAKzD,YAAYrB,UAAU,SAASxC,OAAQ,CAE9C,IADA,IAAIwoC,EAAU,CAAC,MAAOlhC,EAAKrL,KAAMA,GACxBP,EAAI,EAAGA,EAAIuC,EAAK+B,OAAS,EAAGtE,IACnC8sC,EAAQzoC,KAAK9B,EAAKvC,IAEpB4L,EAAKzD,YAAYhE,KAAK,QAAS2oC,GAG/B,IAAIC,EAAexqC,EAAKA,EAAK+B,OAAS,GACtC/B,EAAKA,EAAK+B,OAAS,GAAK,SAAUmC,EAAK2I,GACrC,IAAI49B,EAAe,CAAC,MAAOphC,EAAKrL,KAAMA,GACtCysC,EAAeA,EAAapqC,OAC1B6D,EAAM,CAAC,QAASA,GAAO,CAAC,UAAW2I,IAErCxD,EAAKzD,YAAYhE,KAAK,QAAS6oC,GAC/BD,EAAatmC,EAAK2I,KAcpB69B,CAAWrhC,EAAMrL,EAAMgC,GAClBW,KAAKgqC,UAAUC,QAWbvU,EAASx2B,MAAMc,KAAMX,GAVnB,IAAIi1B,QAAQ,SAAUgV,EAAS/U,GACpC7rB,EAAKshC,UAAUE,QAAQ,SAAUC,GAC3BA,EACF5V,EAAO4V,GAEPb,EAAQ5gC,EAAKrL,GAAM6B,MAAMwJ,EAAMrJ,WAU3C,SAAS+qC,EAAKziC,EAAKpF,GAEjB,IADA,IAAI2J,EAAM,GACDpP,EAAI,EAAG6G,EAAMpB,EAAInB,OAAQtE,EAAI6G,EAAK7G,IAAK,CAC9C,IAAI42B,EAAOnxB,EAAIzF,GACX42B,KAAQ/rB,IACVuE,EAAIwnB,GAAQ/rB,EAAI+rB,IAGpB,OAAOxnB,EAMT,IAgIIm+B,EAhIAC,EAA8B,EAElC,SAASC,EAAiB7wB,GACxB,OAAOA,EAGT,SAAS8wB,EAA2Bp9B,GAClC,MAAO,CAAC,CACNq9B,GAAIr9B,IAKR,SAASs9B,EAAQC,EAAIha,EAAM+E,GACzB,IAAIkV,EAAWja,EAAKka,KAGhBC,EAAe,IAAIlD,EACvBgD,EAASt8B,QAAQ,SAAUy8B,GACrBD,EAAaxC,IAAIyC,EAAQz/B,IAC3Bw/B,EAAantC,IAAIotC,EAAQz/B,IAAInK,KAAK4pC,GAElCD,EAAahoC,IAAIioC,EAAQz/B,GAAI,CAACy/B,MAIlC,IAAIC,EAAUF,EAAa7yB,KACvBgzB,EAAU,EACVC,EAAgB,IAAIzoC,MAAMuoC,GAe9B,SAASG,IAbT,IACMC,IAaEH,IAAYD,IAbdI,EAAU,GACdF,EAAc58B,QAAQ,SAAUpC,GAC9BA,EAAI2+B,KAAKv8B,QAAQ,SAAUub,GACzBuhB,EAAQjqC,KAAK,CACXmK,GAAIY,EAAIZ,GACRu/B,KAAM,CAAChhB,SAIb6L,EAAS,KAAM,CAAC0V,QAASA,KAc3B,IAAIC,EAAc,GAClBP,EAAax8B,QAAQ,SAAUvQ,EAAOM,GACpCgtC,EAAYlqC,KAAK9C,KAGnB,IAAIvB,EAAI,EAER,SAASwuC,IAEP,KAAIxuC,GAAKuuC,EAAYjqC,QAArB,CAIA,IAAImqC,EAAOt5B,KAAKoB,IAAIvW,EAAIwtC,EAA6Be,EAAYjqC,QAC7DoqC,EAAQH,EAAYh8B,MAAMvS,EAAGyuC,IAKnC,SAAsBC,EAAO/rB,GAC3B+rB,EAAMl9B,QAAQ,SAAUm9B,EAAOlsB,GAC7B,IAAImsB,EAASjsB,EAASF,EAClBosB,EAAcb,EAAantC,IAAI8tC,GAQ/BG,EAAUxB,EAAKuB,EAAY,GAAI,CAAC,aAAc,gBAClDC,EAAQC,UAAYF,EAAYv/B,IAAI,SAAU2+B,GAE5C,OAAOA,EAAQe,MAIjBF,EAAQC,UAAYD,EAAQC,UAAU1yB,OAAOoxB,GAE7C,IAAIwB,EAAexB,EAEc,IAA7BqB,EAAQC,UAAUzqC,gBACbwqC,EAAQC,UAKfE,EAAevB,GAIjB,CAAC,OAAQ,cAAe,SAAU,OAAQ,UAAUl8B,QAAQ,SAAU8d,GAChEA,KAASuE,IACXib,EAAQxf,GAASuE,EAAKvE,MAG1Bue,EAAGhtC,IAAI8tC,EAAOG,EAAS,SAAUroC,EAAK2I,GACpC,IAAIkB,EA9DmB9B,EAAIu/B,EAiEzBz9B,EADE7J,EACO,CAAC,CAACF,MAAOE,IAETwoC,EAAa7/B,GAnEDZ,EAqELmgC,EArESZ,EAqEFz9B,EApE7B89B,EAoEcQ,GApEY,CAACpgC,GAAIA,EAAIu/B,KAAMA,GACzCM,IAoEIG,QAlDJU,CAAaR,EAAO1uC,GACpBA,GAAK0uC,EAAMpqC,QAsDbkqC,IAMF,IACEW,aAAaC,QAAQ,4BAA6B,GAClD7B,IAAa4B,aAAaE,QAAQ,6BAClC,MAAO5kC,GACP8iC,GAAW,EAGb,SAAS+B,IACP,OAAO/B,EAgBT,SAASgC,IACP,eAAapvC,KAAK+C,MAClBA,KAAKoC,WAAa,GAVpB,SAA6BsG,GACvB0jC,KACF97B,iBAAiB,UAAW,SAAU/I,GACpCmB,EAAKzH,KAAKsG,EAAElJ,OAShBiuC,CAAoBtsC,MAsEtB,SAASusC,EAAerkC,GAEtB,GAAuB,oBAAZvG,SAAsD,mBAApBA,QAAQuG,GAAwB,CAC3E,IAAI7I,EAAOoD,MAAM/D,UAAU2Q,MAAMpS,KAAKiF,UAAW,GACjDP,QAAQuG,GAAQhJ,MAAMyC,QAAStC,IAwBnC,SAASmtC,EAAen5B,GACtB,IAAIE,EAAM,EAIV,OAHKF,IACHE,EAAM,KAvBV,SAAsBF,EAAKE,GAiBzB,OAfAF,EAAMlG,SAASkG,EAAK,KAAO,GAC3BE,EAAMpG,SAASoG,EAAK,MACRA,GAAOA,GAAOF,EACxBE,GAAOF,GAAO,IAAM,EAEpBE,GAAY,EAGVA,EATa,MAUfF,EAAMo5B,IACNl5B,EAXe,SAcLA,EAAMF,GADNpB,KAAKy6B,SAGSr5B,GAQnBs5B,CAAat5B,EAAKE,GAK3B,SAASq5B,EAAaC,EAAQ5sB,GAC5BssB,EAAe,OAAQ,aAAeM,EAAS,uBAAyB5sB,GA5H1E,IAASosB,EAAS,gBAiBlBA,EAAQ3tC,UAAUmF,YAAc,SAAUipC,EAAQxhC,EAAIq/B,EAAIha,GAExD,IAAI3wB,KAAKoC,WAAWkJ,GAApB,CAGA,IAAI5C,EAAO1I,KACP+sC,GAAa,EAiCjB/sC,KAAKoC,WAAWkJ,GAAM0hC,EACtBhtC,KAAK8D,GAAGgpC,EAAQE,GAjChB,SAASA,IAEP,GAAKtkC,EAAKtG,WAAWkJ,GAGrB,GAAIyhC,EACFA,EAAa,cADf,CAIAA,GAAa,EACb,IAAIE,EAAc7C,EAAKzZ,EAAM,CAC3B,QAAS,eAAgB,cAAe,YAAa,SACrD,UAAW,OAAQ,QAAS,eAAgB,SAAU,gBAQxDga,EAAGuC,QAAQD,GAAanpC,GAAG,SAAU,SAAU3G,GACzCA,EAAEgwC,IAAMxc,EAAKyc,QAAUzc,EAAK0c,YAC9B1c,EAAKyc,MAAQjwC,EAAEgwC,IACfxc,EAAK2c,SAASnwC,MAEf2G,GAAG,WAAY,WACG,YAAfipC,GACF,IAAUC,GAEZD,GAAa,IACZjpC,GAAG,QAdN,WACEipC,GAAa,OAmBnBV,EAAQ3tC,UAAUyD,eAAiB,SAAU2qC,EAAQxhC,GAE7CA,KAAMtL,KAAKoC,aAGjB,eAAa1D,UAAUyD,eAAelF,KAAK+C,KAAM8sC,EAC/C9sC,KAAKoC,WAAWkJ,WACXtL,KAAKoC,WAAWkJ,KAKzB+gC,EAAQ3tC,UAAU6uC,mBAAqB,SAAUT,GAG3CV,MACFH,aAAaa,GAAoC,MAAzBb,aAAaa,GAAmB,IAAM,MAIlET,EAAQ3tC,UAAU8uC,OAAS,SAAUV,GACnC9sC,KAAKiB,KAAK6rC,GACV9sC,KAAKutC,mBAAmBT,IAwE1B,IAAIW,EAzB2B,mBAAlBjwC,OAAOkwC,OACPlwC,OAAOkwC,OAIP,SAAUvuC,GAGjB,IAFA,IAAIuuB,EAAKlwB,OAAO2B,GAEPmF,EAAQ,EAAGA,EAAQpC,UAAUd,OAAQkD,IAAS,CACrD,IAAIqpC,EAAazrC,UAAUoC,GAE3B,GAAkB,MAAdqpC,EACF,IAAK,IAAIC,KAAWD,EAEdnwC,OAAOkB,UAAUC,eAAe1B,KAAK0wC,EAAYC,KACnDlgB,EAAGkgB,GAAWD,EAAWC,IAKjC,OAAOlgB,GASb,SAASmgB,EAAWhB,EAAQxpC,EAAO0wB,GACjCxyB,MAAMtE,KAAK+C,KAAM+zB,GACjB/zB,KAAK6sC,OAASA,EACd7sC,KAAK3C,KAAOgG,EACZrD,KAAKwD,QAAUuwB,EACf/zB,KAAKqD,OAAQ,EAPf,IAASwqC,EAAYtsC,OAUrBssC,EAAWnvC,UAAU8M,SAAW,WAC9B,OAAOwC,KAAKC,UAAU,CACpB4+B,OAAQ7sC,KAAK6sC,OACbxvC,KAAM2C,KAAK3C,KACXmG,QAASxD,KAAKwD,QACduwB,OAAQ/zB,KAAK+zB,UAIE,IAAI8Z,EAAW,IAAK,eAAgB,kCAAvD,IACIC,EAAoB,IAAID,EAAW,IAAK,cAAe,+BACvDE,EAAc,IAAIF,EAAW,IAAK,YAAa,WAC/CG,EAAe,IAAIH,EAAW,IAAK,WAAY,4BAC/CI,EAAa,IAAIJ,EAAW,IAAK,cAAe,mCAChDK,EAAa,IAAIL,EAAW,IAAK,aAAc,4BAC/CM,EAAc,IAAIN,EAAW,IAAK,cAAe,yDAEjDO,GADW,IAAIP,EAAW,IAAK,sBAAuB,qBACtC,IAAIA,EAAW,IAAK,gBAAiB,0CACrDQ,EAAU,IAAIR,EAAW,IAAK,SAAU,kCAExCS,GADkB,IAAIT,EAAW,IAAK,kBAAmB,uBACrC,IAAIA,EAAW,IAAK,oBAAqB,oCAC7DU,EAAiB,IAAIV,EAAW,IAAK,iBAAkB,+BACvDW,EAAc,IAAIX,EAAW,IAAK,cAAe,oCACjDY,GAAgB,IAAIZ,EAAW,IAAK,cAAe,kCAEnDa,IADa,IAAIb,EAAW,IAAK,YAAa,sBAClC,IAAIA,EAAW,IAAK,sBAAuB,YAIvDc,IAHY,IAAId,EAAW,IAAK,mBAAoB,WACxC,IAAIA,EAAW,IAAK,wBAAyB,WAC7C,IAAIA,EAAW,IAAK,YAAa,wDAC/B,IAAIA,EAAW,IAAK,cAAe,uBAEjDe,IADc,IAAIf,EAAW,IAAK,cAAe,+DAClC,IAAIA,EAAW,IAAK,eAAgB,gDACrC,IAAIA,EAAW,IAAK,cAAe,2BAErD,SAASgB,GAAYxrC,EAAO0wB,GAC1B,SAAS+a,EAAiB/a,GAIxB,IAAK,IAAIn1B,KAAKyE,EACY,mBAAbA,EAAMzE,KACfoB,KAAKpB,GAAKyE,EAAMzE,SAILsB,IAAX6zB,IACF/zB,KAAK+zB,OAASA,GAIlB,OADA+a,EAAiBpwC,UAAYmvC,EAAWnvC,UACjC,IAAIowC,EAAiB/a,GAG9B,SAASgb,GAA0BxrC,GAEjC,GAAmB,iBAARA,EAAkB,CAC3B,IAAI4C,EAAO5C,GACXA,EAAM6qC,GACFjoC,KAAOA,EAoBb,MAjBI,UAAW5C,GAAqB,aAAdA,EAAIF,QACxBE,EAAIlG,KAAO,WACXkG,EAAIspC,OAAS,KAGT,SAAUtpC,IACdA,EAAIlG,KAAOkG,EAAIF,OAAS,WAGpB,WAAYE,IAChBA,EAAIspC,OAAS,KAGT,YAAatpC,IACjBA,EAAIC,QAAUD,EAAIC,SAAWD,EAAIwwB,QAG5BxwB,EAYT,SAASyrC,GAAare,GACpB,IAAIse,EAAM,GACNC,EAAYve,EAAKxX,QAAiC,mBAAhBwX,EAAKxX,OAG3C,OAFA81B,EAAIpS,MAAQlM,EAAKwe,aAEV,SAAgBC,GAChBA,EAAOC,MAGVD,EAAOC,IAAM,IAGf,IAAIC,EAAeJ,GArBvB,SAAmB/1B,EAAQk2B,EAAKJ,GAC9B,IACE,OAAQ91B,EAAOk2B,EAAKJ,GACpB,MAAO1rC,GACP,IAAIgJ,EAAM,0BAA4BhJ,EAAIiI,WAC1C,OAAOqjC,GAAYL,EAAajiC,IAgBAgjC,CAAU5e,EAAKxX,OAAQi2B,EAAOC,IAAKJ,GAEnE,GAA4B,iBAAjBK,EACT,OAAOA,EAGT,GAAIA,EACF,OAAO,EAGT,GAAK3e,EAAK6e,cAEH,IAAK7e,EAAK8e,YACf,IAAK,IAAIC,KAAON,EAAOC,IAAIM,aAErBP,EAAOC,IAAIM,aAAahxC,eAAe+wC,KACzCN,EAAOC,IAAIM,aAAaD,GAAKE,MAAO,eALjCR,EAAOC,IAShB,OAAO,GAIX,SAASQ,GAAQC,GAEf,IADA,IAAI5jC,EAAM,GACDpP,EAAI,EAAG6G,EAAMmsC,EAAK1uC,OAAQtE,EAAI6G,EAAK7G,IAC1CoP,EAAMA,EAAIxM,OAAOowC,EAAKhzC,IAExB,OAAOoP,EAUT,SAAS6jC,GAAezkC,GACtB,IAAI/H,EAQJ,GAPK+H,EAEoB,iBAAPA,EAChB/H,EAAMsrC,GAAYZ,GACT,KAAKpgC,KAAKvC,KAAQ,mBAAqBuC,KAAKvC,KACrD/H,EAAMsrC,GAAYV,IAJlB5qC,EAAMsrC,GAAYX,GAMhB3qC,EACF,MAAMA,EAMV,SAASysC,GAASrF,GAChB,MAA0B,kBAAfA,EAAGsF,QACLtF,EAAGsF,QAGW,mBAAZtF,EAAGlqC,OACZ8rC,EAAe,OACb,8EAEmB,SAAd5B,EAAGlqC,QAWd,SAASyvC,GAA2BrxC,GAClC,IAAKA,EACH,OAAO,KAET,IAAIsQ,EAAQtQ,EAAEuQ,MAAM,KACpB,OAAqB,IAAjBD,EAAM/N,OACD+N,EAEY,IAAjBA,EAAM/N,OACD,CAACvC,EAAGA,GAEN,KAGT,SAASsxC,GAA+BtxC,GACtC,IAAIuxC,EAAaF,GAA2BrxC,GAC5C,OAAOuxC,EAAaA,EAAW/jC,KAAK,KAAO,KAM7C,IAAI1H,GAAO,CAAC,SAAU,WAAY,YAAa,WAAY,OAAQ,WAC/D,OAAQ,OAAQ,WAAY,OAAQ,YAAa,OAAQ,QAAS,UAClE0rC,GAAO,WACPC,GAAU,4BAIVC,GAAS,mMAEb,SAASC,GAASvwB,GAKhB,IAJA,IAAI/iB,EAAIqzC,GAAO5R,KAAK1e,GAChBjV,EAAM,GACNlO,EAAI,GAEDA,KAAK,CACV,IAAIuB,EAAMsG,GAAK7H,GACXiB,EAAQb,EAAEJ,IAAM,GAChB2zC,GAAiD,IAAvC,CAAC,OAAQ,YAAYliC,QAAQlQ,GAC3C2M,EAAI3M,GAAOoyC,EAAUnhC,mBAAmBvR,GAASA,EAUnD,OAPAiN,EAAIqlC,IAAS,GACbrlC,EAAIrG,GAAK,KAAK+J,QAAQ4hC,GAAS,SAAUI,EAAIC,EAAIC,GAC3CD,IACF3lC,EAAIqlC,IAAOM,GAAMC,KAId5lC,EAOT,SAAS6lC,GAAU3T,EAAQ4T,GACzB,IAAInsC,EAAO,GACPqT,EAAS,GACb,IAAK,IAAI3Z,KAAOyyC,EACVA,EAAMnyC,eAAeN,KACvBsG,EAAKxD,KAAK9C,GACV2Z,EAAO7W,KAAK2vC,EAAMzyC,KAItB,OADAsG,EAAKxD,KAAK+7B,GACH59B,SAASJ,MAAM,KAAMyF,GAAMzF,MAAM,KAAM8Y,GAMhD,SAAS+4B,GAAOpG,EAAIc,EAAOuF,GACzB,OAAO,IAAI1c,QAAQ,SAAUgV,EAAS/U,GACpCoW,EAAGhtC,IAAI8tC,EAAO,SAAUloC,EAAK8rC,GAC3B,GAAI9rC,EAAK,CAEP,GAAmB,MAAfA,EAAIspC,OACN,OAAOtY,EAAOhxB,GAEhB8rC,EAAM,GAIR,IAAI4B,EAAS5B,EAAI6B,KACbC,EAASH,EAAQ3B,GAErB,IAAK8B,EAGH,OAAO7H,EAAQ,CAAC8H,SAAS,EAAOtF,IAAKmF,IAKvCE,EAAOE,IAAM5F,EACb0F,EAAOD,KAAOD,EACd3H,EAKN,SAAmBqB,EAAI0E,EAAK2B,GAC1B,OAAOrG,EAAG2G,IAAIjC,GAAK9mB,KAAK,SAAUrc,GAChC,MAAO,CACLklC,SAAS,EACTtF,IAAK5/B,EAAI4/B,MAEV,SAAUvoC,GAEX,GAAmB,MAAfA,EAAIspC,OACN,MAAMtpC,EAER,OAAOwtC,GAAOpG,EAAI0E,EAAIgC,IAAKL,KAhBjBO,CAAU5G,EAAIwG,EAAQH,QAoBpC,IAAIQ,GAAW,SAAUvxB,GACvB,OAAOwxB,KAAKxxB,IAGVyxB,GAAW,SAAUzxB,GACvB,OAAO0xB,KAAK1xB,IAMd,SAAS2xB,GAAWziC,EAAO+yB,GAEzB/yB,EAAQA,GAAS,GACjB+yB,EAAaA,GAAc,GAC3B,IACE,OAAO,IAAI6G,KAAK55B,EAAO+yB,GACvB,MAAO36B,GACP,GAAe,cAAXA,EAAElK,KACJ,MAAMkK,EAOR,IALA,IAIImoB,EAAU,IAJuB,oBAAhBmiB,YAA8BA,YACZ,oBAAlBC,cAAgCA,cACb,oBAAnBC,eAAiCA,eACxCC,mBAELl1C,EAAI,EAAGA,EAAIqS,EAAM/N,OAAQtE,GAAK,EACrC4yB,EAAQ3B,OAAO5e,EAAMrS,IAEvB,OAAO4yB,EAAQuiB,QAAQ/P,EAAWzhC,OAMtC,SAASyxC,GAA0BC,GAIjC,IAHA,IAAI/wC,EAAS+wC,EAAI/wC,OACb+d,EAAM,IAAIrC,YAAY1b,GACtBmB,EAAM,IAAIma,WAAWyC,GAChBriB,EAAI,EAAGA,EAAIsE,EAAQtE,IAC1ByF,EAAIzF,GAAKq1C,EAAIhyB,WAAWrjB,GAE1B,OAAOqiB,EAGT,SAASizB,GAAmBC,EAAW5xC,GACrC,OAAOmxC,GAAW,CAACM,GAA0BG,IAAa,CAAC5xC,KAAMA,IAGnE,SAAS6xC,GAAaC,EAAK9xC,GACzB,OAAO2xC,GAAmBZ,GAASe,GAAM9xC,GAiB3C,SAAS+xC,GAAmBC,EAAM/c,GAChC,IAAIgd,EAAS,IAAIC,WACbC,EAAuD,mBAA9BF,EAAOF,mBACpCE,EAAOG,UAAY,SAAUtrC,GAC3B,IAAI6F,EAAS7F,EAAEpI,OAAOiO,QAAU,GAChC,GAAIwlC,EACF,OAAOld,EAAStoB,GAElBsoB,EAnBJ,SAAmChY,GAIjC,IAHA,IAAIo1B,EAAS,GACT1vB,EAAQ,IAAI1G,WAAWgB,GACvBtc,EAASgiB,EAAMpG,WACVlgB,EAAI,EAAGA,EAAIsE,EAAQtE,IAC1Bg2C,GAAUtxC,OAAO8f,aAAa8B,EAAMtmB,IAEtC,OAAOg2C,EAYIC,CAA0B3lC,KAEjCwlC,EACFF,EAAOF,mBAAmBC,GAE1BC,EAAOM,kBAAkBP,GAI7B,SAASQ,GAAmBC,EAAcxd,GACxC8c,GAAmBU,EAAc,SAAUf,GACzCzc,EAASyc,KAIb,SAASgB,GAAaD,EAAcxd,GAClCud,GAAmBC,EAAc,SAAU72B,GACzCqZ,EAASgc,GAASr1B,MAgBtB,IAAI+2B,GAAmB5tC,EAAOY,cAAgBZ,EAAOqB,WACjDwsC,GAAiB,MAarB,SAASC,GAAW51B,EAAQ+0B,EAAMr0B,EAAOzV,EAAK+sB,IACxCtX,EAAQ,GAAKzV,EAAM8pC,EAAKx6B,QAE1Bw6B,EAVJ,SAAmBA,EAAMr0B,EAAOzV,GAC9B,OAAI8pC,EAAKrK,YACAqK,EAAKrK,YAAYhqB,EAAOzV,GAE1B8pC,EAAKpjC,MAAM+O,EAAOzV,GAMhB4qC,CAAUd,EAAMr0B,EAAOzV,IA5BlC,SAA2B8pC,EAAM/c,GAC/B,IAAIgd,EAAS,IAAIC,WACjBD,EAAOG,UAAY,SAAUtrC,GAC3B,IAAI6F,EAAS7F,EAAEpI,OAAOiO,QAAU,IAAI0P,YAAY,GAChD4Y,EAAStoB,IAEXslC,EAAOM,kBAAkBP,GAwBzBO,CAAkBP,EAAM,SAAUe,GAChC91B,EAAOqQ,OAAOylB,GACd9d,MAIJ,SAAS+d,GAAa/1B,EAAQP,EAAQiB,EAAOzV,EAAK+sB,IAC5CtX,EAAQ,GAAKzV,EAAMwU,EAAO/b,UAE5B+b,EAASA,EAAO+P,UAAU9O,EAAOzV,IAEnC+U,EAAOsQ,aAAa7Q,GACpBuY,IAGF,SAASge,GAAUvtC,EAAMuvB,GACvB,IAAIie,EAAgC,iBAATxtC,EACvBxC,EAAMgwC,EAAgBxtC,EAAK/E,OAAS+E,EAAK8R,KACzC27B,EAAY3hC,KAAKoB,IAAIggC,GAAgB1vC,GACrCkwC,EAAS5hC,KAAK6hC,KAAKnwC,EAAMiwC,GACzBG,EAAe,EACfr2B,EAASi2B,EAAgB,IAAI,IAAQ,IAAI,IAAI72B,YAE7CiR,EAAS4lB,EAAgBF,GAAeH,GAE5C,SAAShe,IACP8d,GAAiBY,GAGnB,SAASC,IACP,IACI53B,EA/CR,SAAqBgS,GACnB,OAAOqjB,GAASrjB,GA8CD6lB,CADHx2B,EAAO/U,KAAI,IAErB+sB,EAASrZ,GACTqB,EAAOiR,UAGT,SAASqlB,IACP,IAAI51B,EAAQ21B,EAAeH,EACvBjrC,EAAMyV,EAAQw1B,EAGhB7lB,EAAOrQ,EAAQvX,EAAMiY,EAAOzV,IAF9BorC,EACmBF,EACgBve,EAEA2e,GAGrCD,IAGF,SAASG,GAAUh3B,GACjB,OAAO,IAAIsR,KAAKtR,GAGlB,SAAS2uB,GAAIuD,EAAK+E,GAChB,IAAIC,EAAYzL,EAAMyG,GACtB,OAAK+E,UAIEC,EAAUC,UACVH,GAAUnmC,KAAKC,UAAUomC,KAJvB,IAAOE,KAAK7lC,QAAQ,KAAM,IAAIwP,cAOzC,IAAIs2B,GAAO,IAAOD,GAOlB,SAASE,GAAWC,GAMlB,IALA,IAAIC,EACAC,EACAC,EAEA3N,EADA4N,EAAUJ,EAASK,SAAS1lC,QAExB63B,EAAO4N,EAAQvwC,OAAQ,CAC7B,IAAIywC,EAAO9N,EAAK+N,IACZC,EAAWF,EAAK,GAChB5yB,EAAM8kB,EAAK9kB,IACf,GAAI8yB,EAAS9zC,OACX,IAAK,IAAItE,EAAI,EAAG6G,EAAMuxC,EAAS9zC,OAAQtE,EAAI6G,EAAK7G,IAC9Cg4C,EAAQ3zC,KAAK,CAACihB,IAAKA,EAAM,EAAG6yB,IAAKC,EAASp4C,SAF9C,CAMA,IAAIq4C,IAAYH,EAAK,GAAGG,QACpB7pC,EAAK0pC,EAAK,GAETL,KAAcE,IAAmBM,EAAUN,EAC5CD,IAAexyB,EAAMwyB,EAAaxyB,EAAMuyB,EAAYrpC,KACtDqpC,EAAYrpC,EACZspC,EAAaxyB,EACbyyB,EAAiBM,IAIrB,OAAOP,EAAa,IAAMD,EAO5B,SAASS,GAAgBC,EAAM3f,GAI7B,IAHA,IAEIwR,EAFA4N,EAAUO,EAAKhmC,QAGX63B,EAAO4N,EAAQvwC,OAMrB,IALA,IAAI6d,EAAM8kB,EAAK9kB,IACX4yB,EAAO9N,EAAK+N,IACZC,EAAWF,EAAK,GAChBM,EACF5f,EAA6B,IAApBwf,EAAS9zC,OAAcghB,EAAK4yB,EAAK,GAAI9N,EAAKx7B,IAAKspC,EAAK,IACtDl4C,EAAI,EAAG6G,EAAMuxC,EAAS9zC,OAAQtE,EAAI6G,EAAK7G,IAC9Cg4C,EAAQ3zC,KAAK,CAACihB,IAAKA,EAAM,EAAG6yB,IAAKC,EAASp4C,GAAI4O,IAAK4pC,IAKzD,SAASC,GAAU3mC,EAAGC,GACpB,OAAOD,EAAEwT,IAAMvT,EAAEuT,IAGnB,SAASozB,GAAcH,GACrB,IAAII,EAAS,GACbL,GAAgBC,EAAM,SAAUK,EAAQtzB,EAAK9W,EAAIqqC,EAAKhlB,GAChD+kB,GACFD,EAAOt0C,KAAK,CAAC2qC,IAAK1pB,EAAM,IAAM9W,EAAI8W,IAAKA,EAAKuO,KAAMA,MAGtD8kB,EAAOG,KAAKL,IAAWM,UACvB,IAAK,IAAI/4C,EAAI,EAAG6G,EAAM8xC,EAAOr0C,OAAQtE,EAAI6G,EAAK7G,WACrC24C,EAAO34C,GAAGslB,IAEnB,OAAOqzB,EAMT,SAASK,GAAiBpB,GAIxB,IAHA,IAAIqB,EAAMtB,GAAWC,GACjBe,EAASD,GAAcd,EAASK,UAChCiB,EAAY,GACPl5C,EAAI,EAAG6G,EAAM8xC,EAAOr0C,OAAQtE,EAAI6G,EAAK7G,IAAK,CACjD,IAAIm5C,EAAOR,EAAO34C,GACdm5C,EAAKnK,MAAQiK,GAAQE,EAAKtlB,KAAKwkB,SACjCa,EAAU70C,KAAK80C,EAAKnK,KAGxB,OAAOkK,EAkBT,SAASE,GAAWb,GAIlB,IAHA,IAEInO,EAFAiP,EAAQ,GACRrB,EAAUO,EAAKhmC,QAEX63B,EAAO4N,EAAQvwC,OAAQ,CAC7B,IAAI6d,EAAM8kB,EAAK9kB,IACX4yB,EAAO9N,EAAK+N,IACZ3pC,EAAK0pC,EAAK,GACVrkB,EAAOqkB,EAAK,GACZE,EAAWF,EAAK,GAChBU,EAA6B,IAApBR,EAAS9zC,OAElBg1C,EAAUlP,EAAKkP,QAAUlP,EAAKkP,QAAQ/mC,QAAU,GACpD+mC,EAAQj1C,KAAK,CAACmK,GAAIA,EAAIqlB,KAAMA,IACxB+kB,GACFS,EAAMh1C,KAAK,CAACihB,IAAMA,EAAM,EAAIg0B,EAAQh1C,OAAS6zC,IAAKmB,IAEpD,IAAK,IAAIt5C,EAAI,EAAG6G,EAAMuxC,EAAS9zC,OAAQtE,EAAI6G,EAAK7G,IAC9Cg4C,EAAQ3zC,KAAK,CAACihB,IAAKA,EAAM,EAAG6yB,IAAKC,EAASp4C,GAAIs5C,QAASA,IAG3D,OAAOD,EAAMN,UAKf,SAASQ,GAAYznC,EAAGC,GACtB,OAAOD,EAAEwT,IAAMvT,EAAEuT,IAoBnB,SAASk0B,GAAa/zC,EAAKg0C,EAAMC,GAC/B,IAAI3kB,EAjBN,SAAsBtvB,EAAKg0C,EAAMC,GAI/B,IAHA,IAEIC,EAFAC,EAAM,EACNC,EAAOp0C,EAAInB,OAERs1C,EAAMC,GAEPH,EAAWj0C,EADfk0C,EAAOC,EAAMC,IAAU,GACEJ,GAAQ,EAC/BG,EAAMD,EAAM,EAEZE,EAAOF,EAGX,OAAOC,EAKGE,CAAar0C,EAAKg0C,EAAMC,GAClCj0C,EAAI0+B,OAAOpP,EAAK,EAAG0kB,GAMrB,SAASM,GAAW5/B,EAAM6/B,GAGxB,IAFA,IAAIC,EACAd,EACKn5C,EAAIg6C,EAAYnzC,EAAMsT,EAAK7V,OAAQtE,EAAI6G,EAAK7G,IAAK,CACxD,IAAIoqC,EAAOjwB,EAAKna,GACZk6C,EAAc,CAAC9P,EAAK57B,GAAI47B,EAAKvW,KAAM,IACnCslB,GACFA,EAAK,GAAG90C,KAAK61C,GACbf,EAAOe,GAEPD,EAAOd,EAAOe,EAGlB,OAAOD,EAIT,SAASE,GAAYroC,EAAGC,GACtB,OAAOD,EAAE,GAAKC,EAAE,IAAM,EAAI,EAK5B,SAASqoC,GAAUC,EAAUC,GAG3B,IAFA,IAAIjwC,EAAQ,CAAC,CAACkwC,MAAOF,EAAUG,MAAOF,IAClCpB,GAAY,EACT7uC,EAAM/F,OAAS,GAAG,CACvB,IAAIm1C,EAAOpvC,EAAM5C,MACb8yC,EAAQd,EAAKc,MACbC,EAAQf,EAAKe,OAEbD,EAAM,GAAGxK,QAAUyK,EAAM,GAAGzK,UAC9BwK,EAAM,GAAGxK,OACe,cAArBwK,EAAM,GAAGxK,QACU,cAApByK,EAAM,GAAGzK,OAA0B,YAAc,WAGrD,IAAK,IAAI/vC,EAAI,EAAGA,EAAIw6C,EAAM,GAAGl2C,OAAQtE,IACnC,GAAKu6C,EAAM,GAAG,GAAd,CAOA,IADA,IAAIE,GAAS,EACJh4B,EAAI,EAAGA,EAAI83B,EAAM,GAAGj2C,OAAQme,IAC/B83B,EAAM,GAAG93B,GAAG,KAAO+3B,EAAM,GAAGx6C,GAAG,KACjCqK,EAAMhG,KAAK,CAACk2C,MAAOA,EAAM,GAAG93B,GAAI+3B,MAAOA,EAAM,GAAGx6C,KAChDy6C,GAAS,GAGRA,IACHvB,EAAY,aACZM,GAAae,EAAM,GAAIC,EAAM,GAAGx6C,GAAIm6C,UAdpCjB,EAAY,WACZqB,EAAM,GAAG,GAAKC,EAAM,GAAGx6C,GAiB7B,MAAO,CAACk5C,UAAWA,EAAWhB,KAAMmC,GAGtC,SAASK,GAAQxC,EAAM/9B,EAAMwgC,GAC3B,IAGIvrC,EAHAwrC,EAAU,GACV1B,GAAY,EACZuB,GAAS,EAGb,IAAKvC,EAAK5zC,OACR,MAAO,CAAC4zC,KAAM,CAAC/9B,GAAO++B,UAAW,YAGnC,IAAK,IAAIl5C,EAAI,EAAG6G,EAAMqxC,EAAK5zC,OAAQtE,EAAI6G,EAAK7G,IAAK,CAC/C,IAAI66C,EAAS3C,EAAKl4C,GAClB,GAAI66C,EAAOv1B,MAAQnL,EAAKmL,KAAOu1B,EAAO1C,IAAI,KAAOh+B,EAAKg+B,IAAI,GAGxD/oC,EAAMgrC,GAAUS,EAAO1C,IAAKh+B,EAAKg+B,KACjCyC,EAAQv2C,KAAK,CAACihB,IAAKu1B,EAAOv1B,IAAK6yB,IAAK/oC,EAAI8oC,OACxCgB,EAAYA,GAAa9pC,EAAI8pC,UAC7BuB,GAAS,OACJ,IAAmB,IAAfE,EAAqB,CAM9B,IAAIG,EAAKD,EAAOv1B,IAAMnL,EAAKmL,IAAMu1B,EAAS1gC,EACtC4gC,EAAKF,EAAOv1B,IAAMnL,EAAKmL,IAAMnL,EAAO0gC,EACpCG,EAAOD,EAAGz1B,IAAMw1B,EAAGx1B,IAEnB21B,EAAmB,GAEnBC,EAAQ,GAEZ,IADAA,EAAM72C,KAAK,CAAC8zC,IAAK2C,EAAG3C,IAAK6C,KAAMA,EAAMzhC,OAAQ,KAAM4hC,UAAW,OACvDD,EAAM52C,OAAS,GAAG,CACvB,IAAIm1C,EAAOyB,EAAMzzC,MACjB,GAAkB,IAAdgyC,EAAKuB,KAOT,IADA,IAAIpiC,EAAW6gC,EAAKtB,IAAI,GACf11B,EAAI,EAAG24B,EAAcxiC,EAAStU,OAAQme,EAAI24B,EAAa34B,IAC9Dy4B,EAAM72C,KAAK,CACT8zC,IAAKv/B,EAAS6J,GACdu4B,KAAMvB,EAAKuB,KAAO,EAClBzhC,OAAQkgC,EAAKtB,IACbgD,UAAW14B,SAXTg3B,EAAKtB,IAAI,KAAO4C,EAAG5C,IAAI,IACzB8C,EAAiB52C,KAAKo1C,GAe5B,IAAItiC,EAAK8jC,EAAiB,GAErB9jC,GAGH/H,EAAMgrC,GAAUjjC,EAAGghC,IAAK4C,EAAG5C,KAC3BhhC,EAAGoC,OAAO,GAAGpC,EAAGgkC,WAAa/rC,EAAI8oC,KACjC0C,EAAQv2C,KAAK,CAACihB,IAAKw1B,EAAGx1B,IAAK6yB,IAAK2C,EAAG3C,MACnCe,EAAYA,GAAa9pC,EAAI8pC,UAC7BuB,GAAS,GANTG,EAAQv2C,KAAKw2C,QASfD,EAAQv2C,KAAKw2C,GAWjB,OANKJ,GACHG,EAAQv2C,KAAK8V,GAGfygC,EAAQ9B,KAAKS,IAEN,CACLrB,KAAM0C,EACN1B,UAAWA,GAAa,iBA8D5B,SAASmC,GAAMnD,EAAM/9B,EAAM8Z,GACzB,IAAIqnB,EAAUZ,GAAQxC,EAAM/9B,GACxBohC,EA3DN,SAAcrD,EAAMjkB,GAMlB,IAJA,IACIunB,EAEAlrC,EAHA+oC,EAAQD,GAAWlB,GAIdl4C,EAAI,EAAG6G,EAAMwyC,EAAM/0C,OAAQtE,EAAI6G,EAAK7G,IAAK,CAGhD,IAEIoqC,EAFAjwB,EAAOk/B,EAAMr5C,GACbu7C,EAAUphC,EAAKg+B,IAEnB,GAAIoD,EAAQj3C,OAAS2vB,EAAO,CAErBunB,IACHA,EAAc,IAEhB,IAAIxB,EAAauB,EAAQj3C,OAAS2vB,EAClCmW,EAAO,CACL9kB,IAAKnL,EAAKmL,IAAM00B,EAChB7B,IAAK4B,GAAWwB,EAASvB,IAG3B,IAAK,IAAIj4C,EAAI,EAAGA,EAAIi4C,EAAYj4C,IAAK,CACnC,IAAIitC,EAAO70B,EAAKmL,IAAMvjB,EAAK,IAAMw5C,EAAQx5C,GAAGyM,GAC5CgtC,EAAYxM,IAAO,QAGrB5E,EAAO,CACL9kB,IAAKnL,EAAKmL,IACV6yB,IAAK4B,GAAWwB,EAAS,IAO3BjrC,EADEA,EACOoqC,GAAQpqC,EAAQ85B,GAAM,GAAM8N,KAE5B,CAAC9N,GAYd,OAPIoR,GACFlD,GAAgBhoC,EAAQ,SAAUsoC,EAAQtzB,EAAKm2B,UAEtCD,EAAYl2B,EAAM,IAAMm2B,KAI5B,CACLvD,KAAM5nC,EACNioC,KAAMiD,EAAc96C,OAAOmH,KAAK2zC,GAAe,IAMnCE,CAAKJ,EAAQpD,KAAMjkB,GACjC,MAAO,CACLikB,KAAMqD,EAAQrD,KACdsD,YAAaD,EAAQhD,KACrBW,UAAWoC,EAAQpC,WAwBvB,SAASyC,GAASvR,GAChB,OAAOA,EAAK+N,IAMd,SAASyD,GAAUhE,EAAU5I,GACtBA,IACHA,EAAM2I,GAAWC,IAMnB,IAJA,IAGIM,EAHA1pC,EAAKwgC,EAAI5e,UAAU4e,EAAIv9B,QAAQ,KAAO,GACtCumC,EAAUJ,EAASK,SAAS3oC,IAAIqsC,IAG5BzD,EAAOF,EAAQvwC,OAAQ,CAC7B,GAAIywC,EAAK,KAAO1pC,EACd,QAAS0pC,EAAK,GAAGG,QAEnBL,EAAUA,EAAQp1C,OAAOs1C,EAAK,KAIlC,SAAS2D,GAAUrtC,GACjB,MAAO,UAAYuC,KAAKvC,GAkD1B,SAASstC,GAAUjO,EAAIha,EAAM+E,GAC3B,eAAaz4B,KAAK+C,MAClB,IAAI0I,EAAO1I,KACXA,KAAK2qC,GAAKA,EAEV,IAAIkO,GADJloB,EAAOA,EAAOiY,EAAMjY,GAAQ,IACRkoB,SAAW70C,EAAK,SAAUT,EAAKgmC,GA9wBrD,IAAuBuP,EAAIr4C,EA+wBnB8C,GA/wBmB9C,EAgxBG,SA/wBrB,kBADcq4C,EAgxBCpwC,GA/wBSowC,EAAGl2C,cAAcnC,GACjB,eAAamC,cAAck2C,EAAIr4C,IA8wBvB,GACjCiI,EAAKzH,KAAK,QAASsC,IAGrBmF,EAAKzH,KAAK,WAAYsoC,GAExB7gC,EAAKhE,qBACLimC,EAAGxoC,eAAe,YAAa42C,KAQjC,SAASA,IACPrwC,EAAKswC,SAPHtjB,IACFhtB,EAAK5E,GAAG,WAAY,SAAUylC,GAC5B7T,EAAS,KAAM6T,KAEjB7gC,EAAK5E,GAAG,QAAS4xB,IAKnBiV,EAAG3mC,KAAK,YAAa+0C,GAErBpoB,EAAK2c,SAAW,SAAU8B,EAAQ6J,EAASC,GAErCxwC,EAAKywC,aAtCb,SAAkCzwC,EAAM0mC,EAAQ6J,EAASC,GAEvD,IACExwC,EAAKzH,KAAK,SAAUmuC,EAAQ6J,EAASC,GACrC,MAAO3xC,GACPglC,EAAe,QAAS,oCAAqChlC,IAoC7D6xC,CAAyB1wC,EAAM0mC,EAAQ6J,EAASC,IAGlD,IAAI7kB,EAAU,IAAIC,QAAQ,SAAUgV,EAAS/U,GAC3C5D,EAAKkoB,SAAW,SAAUt1C,EAAK2I,GACzB3I,EACFgxB,EAAOhxB,GAEP+lC,EAAQp9B,MAIdxD,EAAK1E,KAAK,SAAU,WAClB2mC,EAAGxoC,eAAe,YAAa42C,GAC/BpoB,EAAKkoB,SAAS,KAAM,CAAChM,OAAQ,gBAE/B7sC,KAAKuoB,KAAO8L,EAAQ9L,KAAKjqB,KAAK+1B,GAC9Br0B,KAAY,MAAIq0B,EAAe,MAAE/1B,KAAK+1B,GACtCr0B,KAAKuoB,KAAK,SAAUnb,GAClByrC,EAAS,KAAMzrC,IACdyrC,GAIElO,EAAGX,UAAUC,QAWhBvhC,EAAK2wC,gBAAgB1oB,GAVrBga,EAAGX,UAAUE,QAAQ,SAAUC,GACzBA,EACFxZ,EAAKkoB,SAAS1O,GACLzhC,EAAKywC,YACdzwC,EAAKzH,KAAK,UAEVyH,EAAK2wC,gBAAgB1oB,KAa7B,SAAS2oB,GAAcjK,EAAKqF,EAAU/jB,GACpC,IAAI4oB,EAAa,CAAC,CAACzN,IAAKuD,EAAI6B,OACT,aAAfvgB,EAAK9e,QACP0nC,EAAa/D,GAAcd,EAASK,UACnC3oC,IAAI,SAAUsN,GAAK,MAAO,CAACoyB,IAAKpyB,EAAEoyB,QAErC,IAAIsD,EAAS,CACX9jC,GAAIopC,EAASppC,GACb4hC,QAASqM,EACTlK,IAAKA,GAYP,OATIqJ,GAAUhE,EAAUrF,EAAI6B,QAC1B9B,EAAO+F,SAAU,GAEfxkB,EAAKqlB,YACP5G,EAAOC,IAAImK,WAAa1D,GAAiBpB,GACpCtF,EAAOC,IAAImK,WAAWp4C,eAClBguC,EAAOC,IAAImK,YAGfpK,EAyFT,SAASjtB,GAAQs3B,EAAMC,GACrB,OAAOD,EAAOC,GAAS,EAAID,EAAOC,EAAQ,EAAI,EAKhD,SAASC,GAAUjkB,EAAU+V,GAC3B,OAAO,SAAUloC,EAAK6nC,GAChB7nC,GAAQ6nC,EAAQ,IAAMA,EAAQ,GAAG/nC,QACnCE,EAAMA,GAAO6nC,EAAQ,IACjBK,MAAQA,EACZ/V,EAASnyB,IAETmyB,EAAS,KAAM0V,EAAQhqC,OAASgqC,EAAQ,GAAMA,IAwBpD,SAASwO,GAAmBhrC,EAAGC,GAC7B,IAAIgrC,EAAY13B,GAAQvT,EAAEyiC,IAAKxiC,EAAEwiC,KACjC,OAAkB,IAAdwI,EACKA,EAIF13B,GAFMvT,EAAEkrC,WAAalrC,EAAEkrC,WAAW17B,MAAQ,EACpCvP,EAAEirC,WAAajrC,EAAEirC,WAAW17B,MAAQ,GAmFnD,SAAS27B,KAIP,IAAK,IAAIn7C,KAHT,eAAa3B,KAAK+C,MAGJ+5C,GAAgBr7C,UACL,mBAAZsB,KAAKpB,KACdoB,KAAKpB,GAAKoB,KAAKpB,GAAGN,KAAK0B,OA6xB7B,SAASg6C,KACPh6C,KAAKiqC,SAAU,EACfjqC,KAAKmqC,QAAS,EACdnqC,KAAKmH,MAAQ,GA2Gf,SAAS8yC,GAAQ58C,EAAMszB,GAGrB,KAAM3wB,gBAAgBi6C,IACpB,OAAO,IAAIA,GAAQ58C,EAAMszB,GAG3B,IAAIjoB,EAAO1I,KAkBX,GAjBA2wB,EAAOA,GAAQ,GAEXtzB,GAAwB,iBAATA,IAEjBA,GADAszB,EAAOtzB,GACKA,YACLszB,EAAKtzB,WAGkB6C,IAA5BywB,EAAKyjB,qBACPzjB,EAAKyjB,oBAAqB,GAG5Bp0C,KAAKk6C,OAASvpB,EAAOiY,EAAMjY,GAE3BjoB,EAAKyxC,gBAAkBxpB,EAAKwpB,gBAC5BzxC,EAAK0xC,OAASH,GAAQG,OAEF,iBAAT/8C,EACT,MAAM,IAAIkE,MAAM,2BAGlB,IACI84C,EAvGN,SAAsBh9C,EAAMszB,GAC1B,IAAI5iB,EAAQ1Q,EAAK0Q,MAAM,sBACvB,GAAIA,EAEF,MAAO,CACL1Q,KAAM,SAASwQ,KAAKE,EAAM,IAAMA,EAAM,GAAK,MAAQA,EAAM,GAAKA,EAAM,GACpEusC,QAASvsC,EAAM,IAInB,IAAIwsC,EAAWN,GAAQM,SACnBC,EAAoBP,GAAQO,kBAC5BJ,EAASH,GAAQG,OACjBK,EAAc9pB,EAAK2pB,QAEvB,IAAKG,EACH,IAAK,IAAI39C,EAAI,EAAGA,EAAI09C,EAAkBp5C,SAIhB,SAHpBq5C,EAAcD,EAAkB19C,KAGH,WAAYy9C,GACrCnO,KAAqBH,aAAa,oBAAsBmO,EAAS/8C,MALvBP,EAO5CyvC,EAAe,MAAO,2BAA6BlvC,EAAO,8EAQhE,IAAIi9C,EAAUC,EAASE,GAMvB,MAAO,CACLp9C,OAJei9C,GAAW,eAAgBA,IAC1CA,EAAQI,WAGWN,EAAS/8C,EAAQA,EACpCi9C,QAASG,GAgEGE,EADMhqB,EAAKypB,QAAU,IAAM/8C,EACAszB,GASzC,GAPAA,EAAKtzB,KAAOg9C,EAAQh9C,KACpBszB,EAAK2pB,QAAU3pB,EAAK2pB,SAAWD,EAAQC,QAEvC5xC,EAAKrL,KAAOA,EACZqL,EAAKkyC,SAAWjqB,EAAK2pB,QACrBL,GAAQh5C,KAAK,QAAS,CAAC,UAAW,mBAAoB0vB,EAAK2pB,WAEtDL,GAAQM,SAAS5pB,EAAK2pB,WACtBL,GAAQM,SAAS5pB,EAAK2pB,SAAS5gB,QAClC,MAAM,IAAIn4B,MAAM,oBAAsBovB,EAAK2pB,SAG7CP,GAAgB98C,KAAKyL,GACrBA,EAAKshC,UAAY,IAAIgQ,GAErBtxC,EAAK4xC,QAAU3pB,EAAK2pB,QAEpBL,GAAQM,SAAS5pB,EAAK2pB,SAASr9C,KAAKyL,EAAMioB,EAAM,SAAUptB,GACxD,GAAIA,EACF,OAAOmF,EAAKshC,UAAU6Q,KAAKt3C,IAvEjC,SAA+BmF,GAE7B,SAASoyC,EAAYC,GACnBryC,EAAKvG,eAAe,SAAU64C,GACzBD,GACHryC,EAAKzD,YAAYhE,KAAK,YAAayH,EAAKrL,MAI5C,SAAS29C,IACPtyC,EAAKvG,eAAe,YAAa24C,GACjCpyC,EAAKzD,YAAYhE,KAAK,QAASyH,GAGjCA,EAAK1E,KAAK,YAAa82C,GACvBpyC,EAAK1E,KAAK,SAAUg3C,GACpBtyC,EAAKzD,YAAYhE,KAAK,MAAOyH,GAyD3BuyC,CAAsBvyC,GAEtBA,EAAKzH,KAAK,UAAWyH,GACrBuxC,GAAQh5C,KAAK,UAAWyH,EAAKrL,MAC7BqL,EAAKshC,UAAUkR,MAAMxyC,KA7wCzB,IAASkwC,GAAW,gBAiFpBA,GAAUl6C,UAAUs6C,OAAS,WAC3Bh5C,KAAKm5C,aAAc,EACfn5C,KAAK2qC,GAAGX,UAAUC,SACpBjqC,KAAKiB,KAAK,WA2Bd23C,GAAUl6C,UAAU26C,gBAAkB,SAAU1oB,GAC9C,IAAI+E,EAAW/E,EAAKkoB,SAChBnwC,EAAO1I,KAGPi6C,GAAQkB,qBACVlB,GAAQkB,qBAAqBC,SAASzqB,EAAM,SAAUptB,GACpD,GAAIA,EACF,OAAOmyB,EAASnyB,GAElBmF,EAAK2yC,UAAU1qB,KAGjBjoB,EAAK2yC,UAAU1qB,IAInBioB,GAAUl6C,UAAU28C,UAAY,SAAU1qB,GACxC,IAAIjoB,EAAO1I,KACP01B,EAAW/E,EAAKkoB,SAcpB,GAXI,SADJloB,EAAOiY,EAAMjY,OACW,eAAgBA,KACtCA,EAAK2qB,WAAa3qB,EAAK4qB,MAEzB5qB,EAAK2oB,cAAgBA,GAEF,WAAf3oB,EAAKyc,QACPzc,EAAKyc,MAAQ,OAEVzc,EAAKyc,QACRzc,EAAKyc,MAAQ,GAEI,QAAfzc,EAAKyc,MAAT,CAcA,GAAI6M,GAAQkB,sBAEV,GADAlB,GAAQkB,qBAAqBK,UAAU7qB,GACnCspB,GAAQkB,qBAAqBM,aAAaz7C,KAAM2wB,GAClD,OAAOspB,GAAQkB,qBAAqBhiC,OAAOnZ,KAAM2wB,OAGnD,CAAC,UAAW,SAAU,WAAY,QAAQriB,QAAQ,SAAUjQ,GACtDA,KAAOsyB,GACT4b,EAAe,OACb,QAAUluC,EAAM,wKAQlB,eAAgBsyB,IACpBA,EAAK+qB,YAAa,GAIpB/qB,EAAK9K,MAAuB,IAAf8K,EAAK9K,MAAc,EAAI8K,EAAK9K,MACzC8K,EAAKkoB,SAAWnjB,EAChB,IAAIimB,EAAa37C,KAAK2qC,GAAGiR,SAASjrB,GAElC,GAAIgrB,GAA2C,mBAAtBA,EAAW3C,OAAuB,CACzD,IAAIA,EAAStwC,EAAKswC,OAClBtwC,EAAKswC,OAAS,IAAa,SAAU35C,GACnCs8C,EAAW3C,SACXA,EAAO95C,MAAMc,KAAMX,WA3CrBW,KAAK2qC,GAAG9gB,OAAOtB,KAAK,SAAUsB,GAExBnhB,EAAKywC,YACPzjB,EAAS,KAAM,CAACmX,OAAQ,eAG1Blc,EAAKyc,MAAQvjB,EAAKgyB,WAClBnzC,EAAK2yC,UAAU1qB,KACd+E,IAwKP,IAASqkB,GAAiB,gBAa1BA,GAAgBr7C,UAAUo9C,KACxBrS,EAAW,OAAQ,SAAU4F,EAAK1e,EAAM+E,GAKxC,GAJoB,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,IAEU,iBAAR0e,GAAoB5sC,MAAM2L,QAAQihC,GAC3C,OAAO3Z,EAASmZ,GAAYJ,KAE9BzuC,KAAK+7C,SAAS,CAAClR,KAAM,CAACwE,IAAO1e,EAAMgpB,GAAUjkB,EAAU2Z,EAAIgC,QAG7D0I,GAAgBr7C,UAAU4yC,IAAM7H,EAAW,MAAO,SAAU4F,EAAK1e,EAAM3nB,GAKrE,GAJoB,mBAAT2nB,IACT3nB,EAAK2nB,EACLA,EAAO,IAEU,iBAAR0e,GAAoB5sC,MAAM2L,QAAQihC,GAC3C,OAAOrmC,EAAG6lC,GAAYJ,KAGxB,GADAsB,GAAeV,EAAIgC,KACfsH,GAAUtJ,EAAIgC,MAAkC,mBAAnBrxC,KAAKg8C,UACpC,OAAI3M,EAAI4M,SACCj8C,KAAKk8C,aAAa7M,EAAKrmC,GAEvBhJ,KAAKg8C,UAAU3M,EAAKrmC,GAG/B,IAYMmG,EACAgtC,EAGAC,EACAC,EAjBF3zC,EAAO1I,KA0BX,SAASs8C,EAAOhnB,GACW,mBAAd5sB,EAAK6zC,OAA0C,IAAnB5rB,EAAK6rB,UAC1C9zC,EAAK6zC,KAAKlN,EAAK1e,EAAM2E,GAErB5sB,EAAKqzC,SAAS,CAAClR,KAAM,CAACwE,IAAO1e,EAAMgpB,GAAUrkB,EAAM+Z,EAAIgC,MA7BvD1gB,EAAK8rB,OAASpN,EAAI6B,MAWhB/hC,EAAQkgC,EAAI6B,KAAK9hC,MAAM,KACvB+sC,EAAWhtC,EAAM,GAGjBitC,EAFYjvC,SAASgC,EAAM,GAAI,IAEP,EACxBktC,EAAWvQ,KAEfuD,EAAIyK,WAAa,CACf17B,MAAOg+B,EACPnH,IAAK,CAACoH,EAAUF,IAElB9M,EAAI6B,KAAOkL,EAAY,IAAMC,EAC7B1rB,EAAK6rB,WAAY,EArBjBF,EAAO,SAAU/4C,GACf,IAAI6J,EAAS7J,EAAM,KAAO,CAACknC,IAAI,EAAMn/B,GAAI+jC,EAAIgC,IAAKvF,IAAKuD,EAAI6B,MAC3DloC,EAAGzF,EAAK6J,MAGVkvC,EAAOtzC,KA2BX+wC,GAAgBr7C,UAAUg+C,cACxBjT,EAAW,gBAAiB,SAAUgC,EAAOkR,EAAcC,EACfnK,EAAMhyC,GAClD,IAAIo8C,EAAM78C,KAiBV,SAAS88C,EAAiBzN,GACxB,IAAI0N,EAAa,SAAU1N,EAAMliC,SAASkiC,EAAI6B,KAAM,IAAM,EAO1D,OANA7B,EAAIM,aAAeN,EAAIM,cAAgB,GACvCN,EAAIM,aAAagN,GAAgB,CAC/BK,aAAcv8C,EACd0F,KAAMssC,EACNwK,SAAUF,GAELF,EAAIvL,IAAIjC,GAGjB,MA3BoB,mBAAT5uC,IACTA,EAAOgyC,EACPA,EAAOmK,EACPA,EAAS,WAIS,IAATn8C,IACTA,EAAOgyC,EACPA,EAAOmK,EACPA,EAAS,MAENn8C,GACH8rC,EAAe,OAAQ,aAAcoQ,EAAc,cAAelR,EAAO,2BAcpEoR,EAAIl/C,IAAI8tC,GAAOljB,KAAK,SAAU8mB,GACnC,GAAIA,EAAI6B,OAAS0L,EACf,MAAM/N,GAAYb,GAGpB,OAAO8O,EAAiBzN,IACvB,SAAU9rC,GAGX,GAAIA,EAAIwwB,SAAWga,EAAYvqC,QAC7B,OAAOs5C,EAAiB,CAACzL,IAAK5F,IAE9B,MAAMloC,MAKZw2C,GAAgBr7C,UAAUw+C,iBACxBzT,EAAW,mBAAoB,SAAUgC,EAAOkR,EAAcC,EACflnB,GAC/C,IAAIhtB,EAAO1I,KACX0I,EAAK/K,IAAI8tC,EAAO,SAAUloC,EAAKoE,GAE7B,GAAIpE,EACFmyB,EAASnyB,QAGX,GAAIoE,EAAIupC,OAAS0L,EAAjB,CAKA,IAAKj1C,EAAIgoC,aACP,OAAOja,WAEF/tB,EAAIgoC,aAAagN,GACqB,IAAzCn/C,OAAOmH,KAAKgD,EAAIgoC,cAAcvuC,eACzBuG,EAAIgoC,aAEbjnC,EAAK4oC,IAAI3pC,EAAK+tB,QAXZA,EAASmZ,GAAYb,QAe3B+L,GAAgBr7C,UAAUoS,OACxB24B,EAAW,SAAU,SAAU0T,EAASC,EAAWzsB,EAAM+E,GACzD,IAAI2Z,EACqB,iBAAd+N,GAET/N,EAAM,CACJgC,IAAK8L,EACLjM,KAAMkM,GAEY,mBAATzsB,IACT+E,EAAW/E,EACXA,EAAO,MAIT0e,EAAM8N,EACmB,mBAAdC,GACT1nB,EAAW0nB,EACXzsB,EAAO,KAEP+E,EAAW/E,EACXA,EAAOysB,KAGXzsB,EAAOA,GAAQ,IACV0sB,YAAa,EAClB,IAAIlM,EAAS,CAACE,IAAKhC,EAAIgC,IAAKH,KAAO7B,EAAI6B,MAAQvgB,EAAKmb,IACpD,UAAkB,GAClB,GAAI6M,GAAUxH,EAAOE,MAAqC,mBAAtBrxC,KAAKk8C,aACvC,OAAOl8C,KAAKk8C,aAAa7M,EAAK3Z,GAEhC11B,KAAK+7C,SAAS,CAAClR,KAAM,CAACsG,IAAUxgB,EAAMgpB,GAAUjkB,EAAUyb,EAAOE,QAGnE0I,GAAgBr7C,UAAU4+C,SACxB7T,EAAW,WAAY,SAAUwF,EAAKte,EAAM+E,GACxB,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,IAET,IAAIskB,EAAMz3C,OAAOmH,KAAKsqC,GAEtB,IAAKgG,EAAI7zC,OACP,OAAOs0B,EAAS,KAAM,IAGxB,IAAIh0B,EAAQ,EACR67C,EAAU,IAAI3V,EAElB,SAAS4V,EAAalyC,EAAImyC,GACnBF,EAAQjV,IAAIh9B,IACfiyC,EAAQz6C,IAAIwI,EAAI,CAACiyC,QAAS,KAE5BA,EAAQ5/C,IAAI2N,GAAIiyC,QAAQp8C,KAAKs8C,GA4B/BxI,EAAI7oC,IAAI,SAAUd,GAChBtL,KAAK09C,iBAAiBpyC,EAAI,SAAU/H,EAAKwxC,GACvC,GAAIxxC,GAAsB,MAAfA,EAAIspC,QAAkC,YAAhBtpC,EAAIC,QACnC+5C,EAAQz6C,IAAIwI,EAAI,CAACiyC,QAAStO,EAAI3jC,SACzB,IAAI/H,EAET,OAAOmyB,EAASnyB,IA/BtB,SAAoB+H,EAAIypC,GAEtB,IAAI4I,EAAe1O,EAAI3jC,GAAI+D,MAAM,GACjC+lC,GAAgBL,EAAU,SAAUW,EAAQtzB,EAAKm2B,EAAS7sC,EACxDilB,GACE,IAAIisB,EAASx6B,EAAM,IAAMm2B,EACrB1mB,EAAM8rB,EAAapvC,QAAQquC,IAClB,IAAT/qB,IAIJ8rB,EAAa1c,OAAOpP,EAAK,GAEL,cAAhBlB,EAAKkc,QACP2Q,EAAalyC,EAAIsxC,MAMvBe,EAAarvC,QAAQ,SAAUsuC,GAC7BY,EAAalyC,EAAIsxC,KAYfgB,CAAWtyC,EAAIypC,GAGjB,KAAMrzC,IAAUuzC,EAAI7zC,OAAQ,CAE1B,IAAIy8C,EAAa,GAIjB,OAHAN,EAAQjvC,QAAQ,SAAUvQ,EAAOM,GAC/Bw/C,EAAWx/C,GAAON,IAEb23B,EAAS,KAAMmoB,OAGzB79C,QAUL+5C,GAAgBr7C,UAAUgsC,QACxBjB,EAAW,UAAW,SAAU9Y,EAAM+E,GACtCgV,EAAQ1qC,KAAM2wB,EAAM+E,KAMtBqkB,GAAgBr7C,UAAUo/C,gBACxBrU,EAAW,kBAAmB,SAAUgC,EAAOsS,EAAWroB,GAC1D,IAAIhtB,EAAO1I,KACXA,KAAK09C,iBAAiBjS,EAAO,SAAUloC,EAAKy6C,GAE1C,GAAIz6C,EACF,OAAOmyB,EAASnyB,GAElB,IAAIkkC,EAhWR,SAAuB4N,GACrB,IAAI5N,EAAS,GACTwW,EAAQ,GAoBZ,OAnBA7I,GAAgBC,EAAM,SAAUK,EAAQtzB,EAAK9W,EAAI4yC,GAC/C,IAAItB,EAASx6B,EAAM,IAAM9W,EAOzB,OANIoqC,IACFjO,EAAOmV,GAAU,QAEN18C,IAATg+C,GACFD,EAAM98C,KAAK,CAAC6S,KAAMkqC,EAAMxwB,GAAIkvB,IAEvBA,IAGTqB,EAAMpI,UACNoI,EAAM3vC,QAAQ,SAAU6vC,QACIj+C,IAAtBunC,EAAO0W,EAAKnqC,MACdyzB,EAAO0W,EAAKnqC,MAAQ,EAAIyzB,EAAO0W,EAAKzwB,IAEpC+Z,EAAO0W,EAAKnqC,MAAQ/B,KAAKoB,IAAIo0B,EAAO0W,EAAKnqC,MAAO,EAAIyzB,EAAO0W,EAAKzwB,OAG7D+Z,EA0UQ2W,CAAcJ,GACvBK,EAAa,GACbhJ,EAAO,GACX73C,OAAOmH,KAAK8iC,GAAQn5B,QAAQ,SAAUsuC,GAChCnV,EAAOmV,GAAUmB,GACnBM,EAAWl9C,KAAKy7C,KAIpBxH,GAAgB4I,EAAS,SAAUtI,EAAQtzB,EAAKm2B,EAAS7sC,EAAKilB,GAC5D,IAAIisB,EAASx6B,EAAM,IAAMm2B,EACL,cAAhB5nB,EAAKkc,SAA0D,IAAhCwR,EAAW9vC,QAAQquC,IACpDvH,EAAKl0C,KAAKy7C,KAGdl0C,EAAK41C,cAAc7S,EAAO4J,EAAM3f,OAMpCqkB,GAAgBr7C,UAAU6/C,QACxB9U,EAAW,UAAW,SAAU9Y,EAAM+E,GAClB,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,IAITA,EAAOA,GAAQ,GADJ3wB,KAGNw+C,iBAHMx+C,KAGkBw+C,kBAAoB,GAHtCx+C,KAINw+C,iBAAiBr9C,KAAK,CAACwvB,KAAMA,EAAM+E,SAAUA,IACb,IAL1B11B,KAKFw+C,iBAAiBp9C,QAzV5B,SAASq9C,EAAiB/1C,GACxB,IAAIrB,EAAOqB,EAAK81C,iBAAiB,GAC7B7tB,EAAOtpB,EAAKspB,KACZ+E,EAAWruB,EAAKquB,SACpBhtB,EAAK/K,IAAI,qBAAqB+gD,MAAM,WAClC,OAAO,IACNn2B,KAAK,SAAU8mB,GACZA,GAAOA,EAAIsP,WACbhuB,EAAKguB,SAAWtP,EAAIsP,UAEtBj2C,EAAKk2C,SAASjuB,EAAM,SAAUptB,EAAK2I,GAE7B3I,EACFmyB,EAASnyB,GAETmyB,EAAS,KAAMxpB,GAEjB,IAAU,WACRxD,EAAK81C,iBAAiBn6C,QAClBqE,EAAK81C,iBAAiBp9C,QACxBq9C,EAAiB/1C,SAsUvB+1C,CANSz+C,QASb+5C,GAAgBr7C,UAAUkgD,SAAW,SAAUjuB,EAAM+E,GACnD,IAAIhtB,EAAO1I,KACPitC,EAAc,CAChB4R,aAAa,EACbF,SAAUhuB,EAAKguB,UAAY,GAEzBG,EAAW,GAmBfp2C,EAAKwkC,QAAQD,GACVnpC,GAAG,SAlBN,SAAkBi7C,GAChBD,EAAS39C,KAAKuH,EAAKo1C,gBAAgBiB,EAAIzzC,GAAI,MAkB1CxH,GAAG,WAhBN,SAAoBylC,GAClB,IAAI2P,EAAU3P,EAAKoV,SACnBrqB,QAAQ0qB,IAAIF,GAAUv2B,KAAK,WACzB,OAAOwoB,GAAOroC,EAAM,oBAAqB,SAAmB2mC,GAC1D,QAAKA,EAAIsP,UAAYtP,EAAIsP,SAAWzF,KAClC7J,EAAIsP,SAAWzF,EACR7J,OAIV9mB,KAAK,WACNmN,EAAS,KAAM,CAAC+U,IAAI,MACnBiU,MAAMhpB,KAKR5xB,GAAG,QAAS4xB,IAKjBqkB,GAAgBr7C,UAAUf,IAAM8rC,EAAW,MAAO,SAAUn+B,EAAIqlB,EAAM3nB,GAKpE,GAJoB,mBAAT2nB,IACT3nB,EAAK2nB,EACLA,EAAO,IAES,iBAAPrlB,EACT,OAAOtC,EAAG6lC,GAAYZ,IAExB,GAAI0K,GAAUrtC,IAAiC,mBAAnBtL,KAAKi/C,UAC/B,OAAOj/C,KAAKi/C,UAAU3zC,EAAItC,GAE5B,IAAIysC,EAAS,GAAI/sC,EAAO1I,KAExB,SAASk/C,IACP,IAAI9xC,EAAS,GACT1L,EAAQ+zC,EAAOr0C,OAEnB,IAAKM,EACH,OAAOsH,EAAG,KAAMoE,GAIlBqoC,EAAOnnC,QAAQ,SAAU2nC,GACvBvtC,EAAK/K,IAAI2N,EAAI,CACXwgC,IAAKmK,EACLZ,KAAM1kB,EAAK0kB,KACX8J,OAAQxuB,EAAKwuB,OACb1P,YAAa9e,EAAK8e,YAClBqD,OAAQniB,EAAKmiB,QACZ,SAAUvvC,EAAK8rC,GAChB,GAAK9rC,EAaH6J,EAAOjM,KAAK,CAACo8C,QAAStH,QAbd,CAGR,IADA,IAAIp1C,EACK/D,EAAI,EAAGC,EAAIqQ,EAAOhM,OAAQtE,EAAIC,EAAGD,IACxC,GAAIsQ,EAAOtQ,GAAG2tC,IAAMr9B,EAAOtQ,GAAG2tC,GAAGyG,OAAS7B,EAAI6B,KAAM,CAClDrwC,GAAW,EACX,MAGCA,GACHuM,EAAOjM,KAAK,CAACspC,GAAI4E,MAKrB3tC,GAEEsH,EAAG,KAAMoE,OAMjB,IAAIujB,EAAKkb,UA8BT,OAAO7rC,KAAKo/C,KAAK9zC,EAAIqlB,EAAM,SAAUptB,EAAK6J,GACxC,GAAI7J,EAEF,OADAA,EAAIkoC,MAAQngC,EACLtC,EAAGzF,GAGZ,IAAI8rC,EAAMjiC,EAAOiiC,IACbqF,EAAWtnC,EAAOsnC,SAClBhpC,EAAM0B,EAAO1B,IAEjB,GAAIilB,EAAKqlB,UAAW,CAClB,IAAIA,EAAYF,GAAiBpB,GAC7BsB,EAAU50C,SACZiuC,EAAImK,WAAaxD,GAQrB,GAJI0C,GAAUhE,EAAUrF,EAAI6B,QAC1B7B,EAAI4M,UAAW,GAGbtrB,EAAK0kB,MAAQ1kB,EAAK0uB,UAAW,CAQ/B,IAPA,IAAIC,EAAcjQ,EAAI6B,KAAK9hC,MAAM,KAC7BmwC,EAAcpyC,SAASmyC,EAAY,GAAI,IACvC/G,EAAc+G,EAAY,GAE1BnJ,EAAQD,GAAWxB,EAASK,UAC5B99B,EAAO,KAEFna,EAAI,EAAGA,EAAIq5C,EAAM/0C,OAAQtE,IAAK,CACrC,IAAI0iD,EAAcrJ,EAAMr5C,GACpB2iD,EAAYD,EAAYvK,IAAI7oC,IAAI,SAAUsN,GAAK,OAAOA,EAAEpO,KACzDiD,QAAQgqC,IACakH,IAAeF,EAAQ,IAEpBtoC,IAAuB,IAAfwoC,KACjCxoC,EAAOuoC,GAKX,IAAKvoC,EAGH,OAFA1T,EAAM,IAAIhC,MAAM,qBACZkqC,MAAQngC,EACLtC,EAAGzF,GAGZ,IAAIm8C,EAAazoC,EAAKg+B,IAAI7oC,IAAI,SAAUsN,GAAK,OAAOA,EAAEpO,KACnDiD,QAAQ8gC,EAAI6B,KAAK9hC,MAAM,KAAK,IAAM,EACjCuwC,EAAU1oC,EAAKg+B,IAAI7zC,OAASs+C,EAYhC,GAXAzoC,EAAKg+B,IAAIhU,OAAOye,EAAYC,GAC5B1oC,EAAKg+B,IAAIY,UAELllB,EAAK0kB,OACPhG,EAAIyK,WAAa,CACf17B,MAAQnH,EAAKmL,IAAMnL,EAAKg+B,IAAI7zC,OAAU,EACtC6zC,IAAKh+B,EAAKg+B,IAAI7oC,IAAI,SAAUwwC,GAC1B,OAAOA,EAAOtxC,OAIhBqlB,EAAK0uB,UAAW,CAClB,IAAIj9B,EAAOnL,EAAKmL,IAAMnL,EAAKg+B,IAAI7zC,OAC/BiuC,EAAIuQ,WAAa3oC,EAAKg+B,IAAI7oC,IAAI,SAAUwwC,GAEtC,MAAO,CACL9Q,MAFF1pB,EAEa,IAAMw6B,EAAOtxC,GACxBuhC,OAAQ+P,EAAOjsB,KAAKkc,WAM5B,GAAIlc,EAAK8e,aAAeJ,EAAIM,aAAc,CACxC,IAAIF,EAAcJ,EAAIM,aAClBjuC,EAAQlE,OAAOmH,KAAK8qC,GAAaruC,OACrC,GAAc,IAAVM,EACF,OAAOsH,EAAG,KAAMqmC,GAElB7xC,OAAOmH,KAAK8qC,GAAanhC,QAAQ,SAAUjQ,GACzC2B,KAAK6/C,eAAexQ,EAAIgC,IAAKhzC,EAAKoxC,EAAYpxC,GAAM,CAIlDytC,IAAKuD,EAAI6B,KACT4B,OAAQniB,EAAKmiB,OACbpnC,IAAKA,GACJ,SAAUnI,EAAK4C,GAChB,IAAIupC,EAAML,EAAIM,aAAatxC,GAC3BqxC,EAAIvpC,KAAOA,SACJupC,EAAIE,YACJF,EAAItuC,SACJM,GACLsH,EAAG,KAAMqmC,MAGZ3mC,OACE,CACL,GAAI2mC,EAAIM,aACN,IAAK,IAAItxC,KAAOgxC,EAAIM,aAEdN,EAAIM,aAAahxC,eAAeN,KAClCgxC,EAAIM,aAAatxC,GAAKuxC,MAAO,GAInC5mC,EAAG,KAAMqmC,MAvIX,GAAuB,QAAnB1e,EAAKkb,UACP7rC,KAAK09C,iBAAiBpyC,EAAI,SAAU/H,EAAKwxC,GAEvC,GAAIxxC,EACF,OAAOyF,EAAGzF,GAEZkyC,EAASD,GAAcT,GAAU3oC,IAAI,SAAU6pC,GAC7C,OAAOA,EAAKnK,MAEdoT,UAEG,CACL,IAAIz8C,MAAM2L,QAAQuiB,EAAKkb,WAWrB,OAAO7iC,EAAG6lC,GAAYT,EAAe,oBAVrCqH,EAAS9kB,EAAKkb,UACd,IAAK,IAAI/uC,EAAI,EAAGA,EAAI24C,EAAOr0C,OAAQtE,IAAK,CACtC,IAAIC,EAAI04C,EAAO34C,GAEf,GAAqB,iBAAR,IAAoB,QAAQ+Q,KAAK9Q,GAC5C,OAAOiM,EAAG6lC,GAAYF,KAG1BuQ,OA0HRnF,GAAgBr7C,UAAUohD,cACxBrW,EAAW,gBAAiB,SAAUgC,EAAOkR,EAAchsB,EAAM+E,GACjE,IAAIhtB,EAAO1I,KACP2wB,aAAgBrxB,WAClBo2B,EAAW/E,EACXA,EAAO,IAET3wB,KAAKo/C,KAAK3T,EAAO9a,EAAM,SAAUptB,EAAK2I,GACpC,OAAI3I,EACKmyB,EAASnyB,GAEd2I,EAAImjC,IAAIM,cAAgBzjC,EAAImjC,IAAIM,aAAagN,IAC/ChsB,EAAKjlB,IAAMQ,EAAIR,IACfilB,EAAKmiB,QAAS,OACdpqC,EAAKm3C,eAAepU,EAAOkR,EACPzwC,EAAImjC,IAAIM,aAAagN,GAAehsB,EAAM+E,IAEvDA,EAASmZ,GAAYd,QAKlCgM,GAAgBr7C,UAAUqhD,QACxBtW,EAAW,UAAW,SAAU9Y,EAAM+E,GAYtC,GAXoB,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,IAETA,EAAKqvB,UAA4B,IAAdrvB,EAAKqvB,KAAuBrvB,EAAKqvB,KAAO,EACvDrvB,EAAKsvB,YACPtvB,EAAKuvB,SAAWvvB,EAAKsvB,WAEnBtvB,EAAKwvB,UACPxvB,EAAKyvB,OAASzvB,EAAKwvB,SAEjB,SAAUxvB,EAAM,CAClB,IAAKluB,MAAM2L,QAAQuiB,EAAKhsB,MACtB,OAAO+wB,EAAS,IAAI30B,UAAU,kCAEhC,IAAIs/C,EACF,CAAC,WAAY,SAAU,OAAOlnC,OAAO,SAAUknC,GAC/C,OAAOA,KAAmB1vB,IACzB,GACH,GAAI0vB,EAKF,YAJA3qB,EAASmZ,GAAYP,EACnB,oBAAsB+R,EACtB,uCAIJ,IAAKrQ,GAAShwC,QApoBlB,SAA0B2wB,GACxB,IAAIhsB,EAAS,UAAWgsB,EACtBA,EAAKhsB,KAAK0K,MAAMshB,EAAKqvB,KAAMrvB,EAAK9K,MAAQ8K,EAAKqvB,MAC5CrvB,EAAKqvB,KAAO,EAAKrvB,EAAKhsB,KAAK0K,MAAMshB,EAAKqvB,MAAQrvB,EAAKhsB,KACtDgsB,EAAKhsB,KAAOA,EACZgsB,EAAKqvB,KAAO,SACLrvB,EAAK9K,MACR8K,EAAK+qB,aACP/2C,EAAKkxC,UACLllB,EAAK+qB,YAAa,GA4nBhB4E,CAAiB3vB,GACQ,IAArBA,EAAKhsB,KAAKvD,QACZ,OAAOpB,KAAKugD,SAAS,CAAC16B,MAAO,GAAI6P,GAKvC,OAAO11B,KAAKugD,SAAS5vB,EAAM+E,KAG7BqkB,GAAgBr7C,UAAUwuC,QAAU,SAAUvc,EAAM+E,GAalD,MAZoB,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,KAGTA,EAAOA,GAAQ,IAKVkuB,YAAe,gBAAiBluB,EAAQA,EAAKkuB,aAAeluB,EAAK4qB,KAE/D,IAAI3C,GAAU54C,KAAM2wB,EAAM+E,IAGnCqkB,GAAgBr7C,UAAU8hD,MAAQ/W,EAAW,QAAS,SAAU/T,GAG9D,OAFA11B,KAAK0pC,SAAU,EACf1pC,KAAKiB,KAAK,UACHjB,KAAKygD,OAAO/qB,KAGrBqkB,GAAgBr7C,UAAUmrB,KAAO4f,EAAW,OAAQ,SAAU/T,GAC5D,IAAIhtB,EAAO1I,KACXA,KAAK0gD,MAAM,SAAUn9C,EAAKsmB,GACxB,GAAItmB,EACF,OAAOmyB,EAASnyB,GAGlBsmB,EAAK82B,QAAU92B,EAAK82B,SAAWj4C,EAAKrL,KACpCwsB,EAAKswB,mBAAqBzxC,EAAKyxC,iBAAoBnK,GAAStnC,IAC5DmhB,EAAKywB,QAAU5xC,EAAK4xC,QACpB5kB,EAAS,KAAM7L,OAInBkwB,GAAgBr7C,UAAU4M,GAAKm+B,EAAW,KAAM,SAAU/T,GACxD,OAAO11B,KAAKqxC,IAAI3b,KAIlBqkB,GAAgBr7C,UAAU+B,KAAO,WAC/B,MAA8B,mBAAfT,KAAK4gD,MAAwB5gD,KAAK4gD,QAAU5gD,KAAKs6C,SAGlEP,GAAgBr7C,UAAUq9C,SACxBtS,EAAW,WAAY,SAAUwF,EAAKte,EAAM+E,GAc5C,GAboB,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,IAGTA,EAAOA,GAAQ,GAEXluB,MAAM2L,QAAQ6gC,KAChBA,EAAM,CACJpE,KAAMoE,KAILA,IAAQA,EAAIpE,OAASpoC,MAAM2L,QAAQ6gC,EAAIpE,MAC1C,OAAOnV,EAASmZ,GAAYf,IAG9B,IAAK,IAAIhxC,EAAI,EAAGA,EAAImyC,EAAIpE,KAAKzpC,SAAUtE,EACrC,GAA2B,iBAAhBmyC,EAAIpE,KAAK/tC,IAAmB2F,MAAM2L,QAAQ6gC,EAAIpE,KAAK/tC,IAC5D,OAAO44B,EAASmZ,GAAYJ,KAIhC,IAAIoS,EAYJ,GAXA5R,EAAIpE,KAAKv8B,QAAQ,SAAU+gC,GACrBA,EAAIM,cACNnyC,OAAOmH,KAAK0qC,EAAIM,cAAcrhC,QAAQ,SAAUjR,GAC9CwjD,EAAkBA,GA/qB1B,SAA6BxjD,GAC3B,MAAuB,MAAnBA,EAAK0iC,OAAO,IACP1iC,EAAO,0EA6qB2ByjD,CAAoBzjD,GACpDgyC,EAAIM,aAAatyC,GAAM2/C,cAC1BzQ,EAAe,OAAQ,aAAclvC,EAAM,cAAegyC,EAAIgC,IAAK,+BAMvEwP,EACF,OAAOnrB,EAASmZ,GAAYL,EAAaqS,IAGrC,cAAelwB,IAEjBA,EAAK6rB,YADH,cAAevN,IACAA,EAAIuN,WAMzB,IAAIlC,EAAUt6C,KACT2wB,EAAK6rB,WAAcxM,GAASsK,IAG/BrL,EAAIpE,KAAK+K,KAAKgE,IAxyBlB,SAAmB/O,GACjB,IAAK,IAAI/tC,EAAI,EAAGA,EAAI+tC,EAAKzpC,OAAQtE,IAAK,CACpC,IAAIuyC,EAAMxE,EAAK/tC,GACf,GAAIuyC,EAAI4M,gBACC5M,EAAIM,kBACN,GAAIN,EAAIM,aAGb,IADA,IAAIoR,EAAOvjD,OAAOmH,KAAK0qC,EAAIM,cAClBpwB,EAAI,EAAGA,EAAIwhC,EAAK3/C,OAAQme,IAAK,CACpC,IAAImwB,EAAMqR,EAAKxhC,GACf8vB,EAAIM,aAAaD,GAAOtF,EAAKiF,EAAIM,aAAaD,GAC5C,CAAC,OAAQ,SAAU,eAAgB,SAAU,SAAU,WAgyB/DsR,CAAU/R,EAAIpE,MAKd,IAAIoK,EAAMhG,EAAIpE,KAAKz+B,IAAI,SAAUijC,GAC/B,OAAOA,EAAIgC,MAGb,OAAOrxC,KAAKihD,UAAUhS,EAAKte,EAAM,SAAUptB,EAAK2I,GAC9C,GAAI3I,EACF,OAAOmyB,EAASnyB,GASlB,GAPKotB,EAAK6rB,YAERtwC,EAAMA,EAAIiN,OAAO,SAAUO,GACzB,OAAOA,EAAErW,UAIR2sC,GAASsK,GACZ,IAAK,IAAIx9C,EAAI,EAAGC,EAAImP,EAAI9K,OAAQtE,EAAIC,EAAGD,IACrCoP,EAAIpP,GAAGwO,GAAKY,EAAIpP,GAAGwO,IAAM2pC,EAAIn4C,GAIjC44B,EAAS,KAAMxpB,OAInB6tC,GAAgBr7C,UAAUwiD,0BACxBzX,EAAW,4BAA6B,SAAU0X,EACMzrB,GACxD,IAAI0rB,EAAQ,IAAIphD,KAAKiF,YAAYk8C,EAAanhD,KAAKk6C,QAUnDnJ,GAAO/wC,KAAM,6BARb,SAAiBqvC,GAEf,OADAA,EAAIgS,aAAehS,EAAIgS,cAAgB,IACnChS,EAAIgS,aAAaF,KAGrB9R,EAAIgS,aAAaF,IAAe,EACzB9R,KAGN9mB,KAAK,WACJmN,EAAS,KAAM,CAACiV,GAAIyW,MACnB1C,MAAMhpB,KAGbqkB,GAAgBr7C,UAAUiwB,QACxB8a,EAAW,UAAW,SAAU9Y,EAAM+E,GAElB,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,IAGT,IAAIjoB,EAAO1I,KACPshD,IAAY,eAAgB54C,IAAOA,EAAKgyC,WAE5C,SAAS6G,IAEP74C,EAAKK,SAAS4nB,EAAM,SAAUptB,EAAKgmC,GACjC,GAAIhmC,EACF,OAAOmyB,EAASnyB,GAElBmF,EAAKihC,YAAa,EAClBjhC,EAAKzH,KAAK,aACVy0B,EAAS,KAAM6T,GAAQ,CAAE,IAAM,MAInC,GAAIyG,GAAStnC,GAEX,OAAO64C,IAGT74C,EAAK/K,IAAI,6BAA8B,SAAU4F,EAAKi+C,GACpD,GAAIj+C,EAEF,OAAmB,MAAfA,EAAIspC,OACCnX,EAASnyB,GAETg+C,IAGX,IAAIF,EAAeG,EAASH,aACxBpH,EAAUvxC,EAAKzD,YACfw8C,EAAajkD,OAAOmH,KAAK08C,GAAcj1C,IAAI,SAAU/O,GAGvD,IAAIqkD,EAAWJ,EACbjkD,EAAKqR,QAAQ,IAAIrB,OAAO,IAAM4sC,EAAQG,QAAS,IAAM/8C,EACvD,OAAO,IAAI48C,EAAQyH,EAAUh5C,EAAKwxC,QAAQvrB,YAE5C2F,QAAQ0qB,IAAIyC,GAAYl5B,KAAKg5B,EAAW7rB,OAU5CskB,GAAUt7C,UAAUijD,QAAU,WAC5B,IAAIz4C,EACJ,GAAIlJ,KAAKmqC,OACP,KAAQjhC,EAAMlJ,KAAKmH,MAAM9C,SACvB6E,EAAIlJ,KAAKmqC,aAGX,KAAQjhC,EAAMlJ,KAAKmH,MAAM9C,SACvB6E,KAKN8wC,GAAUt7C,UAAUm8C,KAAO,SAAUt3C,GACnCvD,KAAKmqC,OAAS5mC,EACdvD,KAAK2hD,WAGP3H,GAAUt7C,UAAUw8C,MAAQ,SAAUvQ,GACpC3qC,KAAKiqC,SAAU,EACfjqC,KAAK2qC,GAAKA,EACV3qC,KAAK2hD,WAGP3H,GAAUt7C,UAAUwrC,QAAU,SAAUhhC,GACtClJ,KAAKmH,MAAMhG,KAAK+H,GACZlJ,KAAKmqC,QACPnqC,KAAK2hD,WA4ET,IAAS1H,GAASF,IAiElB,IAAInrC,GAAgC,oBAApBgzC,gBACVA,gBACA,WAAc,MAAO,CAACC,MAAO,eAE/BC,GAAMC,MACNriB,GAAIsiB,QAER/H,GAAQM,SAAW,GACnBN,GAAQO,kBAAoB,GAE5BP,GAAQG,OAAS,UAEjB,IAAI6H,GAAe,IAAI,gBAEvB,SAA2BC,GACzB1kD,OAAOmH,KAAK,eAAajG,WAAW4P,QAAQ,SAAUjQ,GACT,mBAAhC,eAAaK,UAAUL,KAChC6jD,EAAM7jD,GAAO4jD,GAAa5jD,GAAKC,KAAK2jD,OAMxC,IAAIE,EAAoBD,EAAME,sBAAwB,IAAIxa,EAE1Dsa,EAAMp+C,GAAG,MAAO,SAA0B6mC,GACnCwX,EAAkB7Z,IAAIqC,EAAGttC,OAC5B8kD,EAAkBr/C,IAAI6nC,EAAGttC,KAAM,IAEjC8kD,EAAkBxkD,IAAIgtC,EAAGttC,MAAM8D,KAAKwpC,KAGtCuX,EAAMp+C,GAAG,QAAS,SAA4B6mC,GAC5C,GAAKwX,EAAkB7Z,IAAIqC,EAAGttC,MAA9B,CAGA,IAAIglD,EAASF,EAAkBxkD,IAAIgtC,EAAGttC,MAClC+kB,EAAMigC,EAAO9zC,QAAQo8B,GACrBvoB,EAAM,IAIVigC,EAAOphB,OAAO7e,EAAK,GACfigC,EAAOjhD,OAAS,EAElB+gD,EAAkBr/C,IAAI6nC,EAAGttC,KAAMglD,GAE/BF,EAAkB5Z,OAAOoC,EAAGttC,UAIhC6kD,EAAMp+C,GAAG,YAAa,SAAgCzG,GACpD,GAAK8kD,EAAkB7Z,IAAIjrC,GAA3B,CAGA,IAAIglD,EAASF,EAAkBxkD,IAAIN,GACnC8kD,EAAkB5Z,OAAOlrC,GACzBglD,EAAO/zC,QAAQ,SAAUq8B,GACvBA,EAAG1pC,KAAK,aAAY,QAK1BqhD,CAAkBrI,IAElBA,GAAQK,QAAU,SAAUhvC,EAAI3D,EAAK46C,GAE/B56C,EAAI+xB,UACNugB,GAAQM,SAASjvC,GAAM3D,EACnB46C,GACFtI,GAAQO,kBAAkBr5C,KAAKmK,KAKrC2uC,GAAQuI,OAAS,SAAU76C,GACzB,GAAmB,mBAARA,EACTA,EAAIsyC,QACC,IAAmB,iBAARtyC,GAAgD,IAA5BnK,OAAOmH,KAAKgD,GAAKvG,OACrD,MAAM,IAAIG,MAAM,wBAA0BoG,EAAM,uCAEhDnK,OAAOmH,KAAKgD,GAAK2G,QAAQ,SAAUhD,GACjC2uC,GAAQv7C,UAAU4M,GAAM3D,EAAI2D,KAMhC,OAHItL,KAAKyiD,aACPxI,GAAQwI,WAAahV,EAAsB,GAAIztC,KAAKyiD,aAE/CxI,IAGTA,GAAQyI,SAAW,SAAUC,GAC3B,SAASC,EAASvlD,EAAMszB,GACtB,KAAM3wB,gBAAgB4iD,GACpB,OAAO,IAAIA,EAASvlD,EAAMszB,GAG5BA,EAAOA,GAAQ,GAEXtzB,GAAwB,iBAATA,IAEjBA,GADAszB,EAAOtzB,GACKA,YACLszB,EAAKtzB,MAGdszB,EAAO8c,EAAsB,GAAImV,EAASH,WAAY9xB,GACtDspB,GAAQh9C,KAAK+C,KAAM3C,EAAMszB,GAgB3B,OAbA,IAASiyB,EAAU3I,IAEnB2I,EAASpI,kBAAoBP,GAAQO,kBAAkBnrC,QACvD7R,OAAOmH,KAAKs1C,IAAS3rC,QAAQ,SAAUjQ,GAC/BA,KAAOukD,IACXA,EAASvkD,GAAO47C,GAAQ57C,MAM5BukD,EAASH,WAAahV,EAAsB,GAAIztC,KAAKyiD,WAAYE,GAE1DC,GAGT3I,GAAQ8H,MAAQ,SAAU7jB,EAAKvN,GAC7B,OAAOmxB,GAAI5jB,EAAKvN,IAQlB,SAASkyB,GAAgBxT,EAAKyT,GAE5B,IADA,IAAI/kD,EAAQsxC,EACHvyC,EAAI,EAAG6G,EAAMm/C,EAAY1hD,OAAQtE,EAAI6G,EAAK7G,IAAK,CAGtD,KADAiB,EAAQA,EADE+kD,EAAYhmD,KAGpB,MAGJ,OAAOiB,EAQT,SAASglD,GAAWC,GAIlB,IAFA,IAAIC,EAAS,GACT5pB,EAAU,GACLv8B,EAAI,EAAG6G,EAAMq/C,EAAU5hD,OAAQtE,EAAI6G,EAAK7G,IAAK,CACpD,IAAIomD,EAAKF,EAAUlmD,GACR,MAAPomD,EACEpmD,EAAI,GAA0B,OAArBkmD,EAAUlmD,EAAI,GACzBu8B,EAAUA,EAAQnM,UAAU,EAAGmM,EAAQj4B,OAAS,GAAK,KAErD6hD,EAAO9hD,KAAKk4B,GACZA,EAAU,IAGZA,GAAW6pB,EAIf,OADAD,EAAO9hD,KAAKk4B,GACL4pB,EAGT,IAAIE,GAAoB,CAAC,MAAO,OAAQ,QACxC,SAASC,GAAqBC,GAC5B,OAAOF,GAAkB50C,QAAQ80C,IAAU,EAG7C,SAASC,GAAO37C,GACd,OAAOnK,OAAOmH,KAAKgD,GAAK,GAS1B,SAAS47C,GAAoBC,GAK3B,IAAIt3C,EAAM,GAqCV,OAnCAs3C,EAAUl1C,QAAQ,SAAU6c,GAC1B3tB,OAAOmH,KAAKwmB,GAAU7c,QAAQ,SAAU+0C,GACtC,IAAII,EAAUt4B,EAASk4B,GAKvB,GAJuB,iBAAZI,IACTA,EAAU,CAACC,IAAKD,IAGdL,GAAqBC,GACnBI,aAAmBhhD,MACrByJ,EAAIm3C,GAASI,EAAQr3C,IAAI,SAAUlP,GACjC,OAAOqmD,GAAoB,CAACrmD,MAG9BgP,EAAIm3C,GAASE,GAAoB,CAACE,QAE/B,CACL,IAAIE,EAAgBz3C,EAAIm3C,GAASn3C,EAAIm3C,IAAU,GAC/C7lD,OAAOmH,KAAK8+C,GAASn1C,QAAQ,SAAUs1C,GACrC,IAAI7lD,EAAQ0lD,EAAQG,GAEpB,MAAiB,QAAbA,GAAmC,SAAbA,EAqBpC,SAAoBA,EAAU7lD,EAAO4lD,GACnC,QAAiC,IAAtBA,EAAcD,IACvB,YAEgC,IAAvBC,EAAcE,KACN,SAAbD,EACE7lD,EAAQ4lD,EAAcE,OACxBF,EAAcE,KAAO9lD,GAGnBA,GAAS4lD,EAAcE,cAClBF,EAAcE,KACrBF,EAAcG,IAAM/lD,QAGc,IAAtB4lD,EAAcG,IACb,SAAbF,EACE7lD,EAAQ4lD,EAAcG,aACjBH,EAAcG,IACrBH,EAAcE,KAAO9lD,GAGnBA,EAAQ4lD,EAAcG,MACxBH,EAAcG,IAAM/lD,GAIxB4lD,EAAcC,GAAY7lD,EA/CXgmD,CAAWH,EAAU7lD,EAAO4lD,GACb,QAAbC,GAAmC,SAAbA,EAmD3C,SAAoBA,EAAU7lD,EAAO4lD,GACnC,QAAiC,IAAtBA,EAAcD,IACvB,YAEgC,IAAvBC,EAAcK,KACN,SAAbJ,EACE7lD,EAAQ4lD,EAAcK,OACxBL,EAAcK,KAAOjmD,GAGnBA,GAAS4lD,EAAcK,cAClBL,EAAcK,KACrBL,EAAcM,IAAMlmD,QAGc,IAAtB4lD,EAAcM,IACb,SAAbL,EACE7lD,EAAQ4lD,EAAcM,aACjBN,EAAcM,IACrBN,EAAcK,KAAOjmD,GAGnBA,EAAQ4lD,EAAcM,MACxBN,EAAcM,IAAMlmD,GAIxB4lD,EAAcC,GAAY7lD,EA7EXmmD,CAAWN,EAAU7lD,EAAO4lD,GACb,QAAbC,EAiFrB,SAAiB7lD,EAAO4lD,GAClB,QAASA,EAEXA,EAAcQ,IAAIhjD,KAAKpD,GAEvB4lD,EAAcQ,IAAM,CAACpmD,GArFNqmD,CAAQrmD,EAAO4lD,GACA,QAAbC,EAyFrB,SAAiB7lD,EAAO4lD,UAGfA,EAAcG,WACdH,EAAcE,YACdF,EAAcM,WACdN,EAAcK,YACdL,EAAcQ,IACrBR,EAAcD,IAAM3lD,EAhGHsmD,CAAQtmD,EAAO4lD,QAExBA,EAAcC,GAAY7lD,UAM3BmO,EA8HT,SAASo4C,GAAgBr3C,GACvB,IAAIG,EAASw7B,EAAM37B,GACfs3C,GAAW,GAlBjB,SAASC,EAAgB78C,EAAK88C,GAC1B,IAAK,IAAI/wB,KAAQ/rB,EAAK,CACL,SAAT+rB,IACA+wB,GAAQ,GAEZ,IAAI1mD,EAAQ4J,EAAI+rB,GACK,iBAAV31B,IACP0mD,EAAQD,EAAgBzmD,EAAO0mD,IAGvC,OAAOA,GAUHD,CAAgBp3C,GAAQ,KAEpB,SADJA,EAvCR,SAASs3C,EAA0B/8C,GAC/B,IAAK,IAAI+rB,KAAQ/rB,EAAK,CAClB,GAAIlF,MAAM2L,QAAQzG,GACd,IAAK,IAAI7K,KAAK6K,EACNA,EAAI7K,GAAS,OACb6K,EAAI7K,GAAKymD,GAAoB57C,EAAI7K,GAAS,OAItD,IAAIiB,EAAQ4J,EAAI+rB,GACK,iBAAV31B,GACP2mD,EAA0B3mD,GAGlC,OAAO4J,EAyBM+8C,CAA0Bt3C,MAE/BA,EAASm2C,GAAoBn2C,EAAa,OAE9Cm3C,GAAW,GAGjB,CAAC,MAAO,QAAQj2C,QAAQ,SAAUq2C,GAC5BA,KAAWv3C,GAGbA,EAAOu3C,GAASr2C,QAAQ,SAAUs2C,GAEhC,IADA,IAAI3B,EAASzlD,OAAOmH,KAAKigD,GAChB9nD,EAAI,EAAGA,EAAImmD,EAAO7hD,OAAQtE,IAAK,CACtC,IAAIumD,EAAQJ,EAAOnmD,GACf2mD,EAAUmB,EAAYvB,GACH,iBAAZI,GAAoC,OAAZA,IACjCmB,EAAYvB,GAAS,CAACK,IAAKD,SAOjC,SAAUr2C,IAGZA,EAAa,KAAIm2C,GAAoB,CAACn2C,EAAa,QAKrD,IAFA,IAAI61C,EAASzlD,OAAOmH,KAAKyI,GAEhBtQ,EAAI,EAAGA,EAAImmD,EAAO7hD,OAAQtE,IAAK,CACtC,IAAIumD,EAAQJ,EAAOnmD,GACf2mD,EAAUr2C,EAAOi2C,GAEE,iBAAZI,GAAoC,OAAZA,EACjCA,EAAU,CAACC,IAAKD,GACP,QAASA,IAAYc,IAG9Bd,EAAQU,IAAM,CAACV,EAAQU,MAEzB/2C,EAAOi2C,GAASI,EAGlB,OAAOr2C,EAkBT,IAAIy3C,IAAiB,IACjBC,GAAmB,EACnBC,GAAM,GAEV,SAASC,GAAQp2C,EAAGC,GAElB,GAAID,IAAMC,EACR,OAAO,EAGTD,EAAIq2C,GAAar2C,GACjBC,EAAIo2C,GAAap2C,GAEjB,IAAIq2C,EAAKC,GAAev2C,GACpBw2C,EAAKD,GAAet2C,GACxB,GAAKq2C,EAAKE,GAAQ,EAChB,OAAOF,EAAKE,EAEd,cAAex2C,GACb,IAAK,SACH,OAAOA,EAAIC,EACb,IAAK,UACH,OAAOD,EAAIC,GAAK,EAAI,EACtB,IAAK,SACH,OAsPN,SAAuBD,EAAGC,GAIxB,OAAQD,IAAMC,EAAK,EAAMD,EAAIC,EAAK,GAAK,EA1P5Bw2C,CAAcz2C,EAAGC,GAE5B,OAAOpM,MAAM2L,QAAQQ,GAyOvB,SAAsBA,EAAGC,GAEvB,IADA,IAAIlL,EAAMsO,KAAKoB,IAAIzE,EAAExN,OAAQyN,EAAEzN,QACtBtE,EAAI,EAAGA,EAAI6G,EAAK7G,IAAK,CAC5B,IAAI84C,EAAOoP,GAAQp2C,EAAE9R,GAAI+R,EAAE/R,IAC3B,GAAa,IAAT84C,EACF,OAAOA,EAGX,OAAQhnC,EAAExN,SAAWyN,EAAEzN,OAAU,EAC9BwN,EAAExN,OAASyN,EAAEzN,OAAU,GAAK,EAlPLkkD,CAAa12C,EAAGC,GA0P5C,SAAuBD,EAAGC,GAGxB,IAFA,IAAI02C,EAAK/nD,OAAOmH,KAAKiK,GAAI42C,EAAKhoD,OAAOmH,KAAKkK,GACtClL,EAAMsO,KAAKoB,IAAIkyC,EAAGnkD,OAAQokD,EAAGpkD,QACxBtE,EAAI,EAAGA,EAAI6G,EAAK7G,IAAK,CAE5B,IAAI84C,EAAOoP,GAAQO,EAAGzoD,GAAI0oD,EAAG1oD,IAC7B,GAAa,IAAT84C,EACF,OAAOA,EAIT,GAAa,KADbA,EAAOoP,GAAQp2C,EAAE22C,EAAGzoD,IAAK+R,EAAE22C,EAAG1oD,MAE5B,OAAO84C,EAIX,OAAQ2P,EAAGnkD,SAAWokD,EAAGpkD,OAAU,EAChCmkD,EAAGnkD,OAASokD,EAAGpkD,OAAU,GAAK,EA3QcqkD,CAAc72C,EAAGC,GAKlE,SAASo2C,GAAa5mD,GACpB,cAAeA,GACb,IAAK,YACH,OAAO,KACT,IAAK,SACH,OAAIA,IAAQuoB,KAAYvoB,KAASuoB,KAAY/mB,MAAMxB,GAC1C,KAEFA,EACT,IAAK,SACH,IAAIqnD,EAAUrnD,EACd,GAAIoE,MAAM2L,QAAQ/P,GAAM,CACtB,IAAIsF,EAAMtF,EAAI+C,OACd/C,EAAM,IAAIoE,MAAMkB,GAChB,IAAK,IAAI7G,EAAI,EAAGA,EAAI6G,EAAK7G,IACvBuB,EAAIvB,GAAKmoD,GAAaS,EAAQ5oD,QAG3B,IAAIuB,aAAe2zB,KACxB,OAAO3zB,EAAI2kB,SACN,GAAY,OAAR3kB,EAET,IAAK,IAAI6Q,KADT7Q,EAAM,GACQqnD,EACZ,GAAIA,EAAQ/mD,eAAeuQ,GAAI,CAC7B,IAAIyO,EAAM+nC,EAAQx2C,QACC,IAARyO,IACTtf,EAAI6Q,GAAK+1C,GAAatnC,MAMlC,OAAOtf,EAGT,SAASsnD,GAAStnD,GAChB,GAAY,OAARA,EACF,cAAeA,GACb,IAAK,UACH,OAAOA,EAAM,EAAI,EACnB,IAAK,SACH,OA2PR,SAA8BsvB,GAE5B,GAAY,IAARA,EACF,MAAO,IAKT,IAAIi4B,EAAYj4B,EAAIk4B,gBAAgBz2C,MAAM,QACtC02C,EAAY34C,SAASy4C,EAAU,GAAI,IAEnCG,EAAMp4B,EAAM,EAEZvgB,EAAS24C,EAAM,IAAM,IAKrBC,GA1VW/lC,IAyVU8lC,GAAOD,EAAYA,GAAajB,IACdr5C,WA1VvBy6C,EA0VmC,IA1V1BC,EA0V+BpB,GApW9D,SAAa7kC,EAAKgmC,EAASC,GAIzB,IAHA,IAAIC,EAAU,GACVC,EAAeF,EAAajmC,EAAI7e,OAE7B+kD,EAAQ/kD,OAASglD,GACtBD,GAAWF,EAEb,OAAOE,EAIOtzB,CAAI5S,EAAKgmC,EAASC,GACfjmC,GAFnB,IAAiBA,EAAKgmC,EAASC,EA4V7B94C,GAAU23C,GAAMiB,EAGhB,IAAIK,EAASp0C,KAAK4G,IAAI3L,WAAW04C,EAAU,KAEvCG,IACFM,EAAS,GAAKA,GAGhB,IAAIC,EAAYD,EAAOE,QAAQ,IAO/B,OAJAD,EAAYA,EAAU53C,QAAQ,SAAU,IAExCtB,GAAU23C,GAAMuB,EA7RHE,CAAqBnoD,GAC9B,IAAK,SAOH,OAAOA,EACJqQ,QAAQ,UAAW,MACnBA,QAAQ,UAAW,MACnBA,QAAQ,UAAW,MAExB,IAAK,SACH,IAAIN,EAAU3L,MAAM2L,QAAQ/P,GACxBkE,EAAM6L,EAAU/P,EAAMb,OAAOmH,KAAKtG,GAClCvB,GAAK,EACL6G,EAAMpB,EAAInB,OACVgM,EAAS,GACb,GAAIgB,EACF,OAAStR,EAAI6G,GACXyJ,GAAUq5C,GAAkBlkD,EAAIzF,SAGlC,OAASA,EAAI6G,GAAK,CAChB,IAAI+iD,EAASnkD,EAAIzF,GACjBsQ,GAAUq5C,GAAkBC,GACxBD,GAAkBpoD,EAAIqoD,IAG9B,OAAOt5C,EAGb,MAAO,GAMT,SAASq5C,GAAkBpoD,GAGzB,OAAO8mD,GADP9mD,EAAM4mD,GAAa5mD,IACU0mD,GAAMY,GAAStnD,GAFjC,KAKb,SAASsoD,GAAY1mC,EAAKnjB,GACxB,IACI6wB,EADAi5B,EAAc9pD,EAGlB,GADsB,MAAXmjB,EAAInjB,GAEb6wB,EAAM,EACN7wB,QACK,CACL,IAAIipD,EAAiB,MAAX9lC,EAAInjB,GACdA,IACA,IAAI+pD,EAAc,GACdC,EAAc7mC,EAAIiN,UAAUpwB,EAAGA,EAAIgoD,IACnCgB,EAAY34C,SAAS25C,EAAa,IAAMjC,GAM5C,IAJIkB,IACFD,GAAaA,GAEfhpD,GAAKgoD,KACQ,CACX,IAAI5B,EAAKjjC,EAAInjB,GACb,GAAW,OAAPomD,EACF,MAEA2D,GAAe3D,EAEjBpmD,IAIA6wB,EADyB,KAD3Bk5B,EAAcA,EAAYz3C,MAAM,MAChBhO,OACR+L,SAAS05C,EAAa,IAGtB35C,WAAW25C,EAAY,GAAK,IAAMA,EAAY,IAGlDd,IACFp4B,GAAY,IAGI,IAAdm4B,IAIFn4B,EAAMzgB,WAAWygB,EAAM,IAAMm4B,IAGjC,MAAO,CAACn4B,IAAKA,EAAKvsB,OAAStE,EAAI8pD,GAKjC,SAASriD,GAAIgH,EAAOw7C,GAClB,IAAIp/C,EAAM4D,EAAMhH,MAEhB,GAAIwiD,EAAU3lD,OAAQ,CACpB,IAAI4lD,EAAkBD,EAAUA,EAAU3lD,OAAS,GAC/CuG,IAAQq/C,EAAgBlhD,UAE1BihD,EAAUxiD,MACVyiD,EAAkBD,EAAUA,EAAU3lD,OAAS,IAEjD,IAAI0E,EAAUkhD,EAAgBlhD,QAC1BmhD,EAAmBD,EAAgB1iD,MACvC,GAAI7B,MAAM2L,QAAQtI,GAChBA,EAAQ3E,KAAKwG,QACR,GAAIs/C,IAAqB17C,EAAMnK,OAAS,EAAG,CAEhD0E,EADUyF,EAAMhH,OACDoD,OAEf4D,EAAMpK,KAAKwG,IAiHjB,SAASw9C,GAAezrC,GACtB,IACImY,EADK,CAAC,UAAW,SAAU,SAAU,UAC5BtjB,eAAemL,GAE5B,OAAKmY,EACO,OAANnY,EACK,EAELjX,MAAM2L,QAAQsL,GACT,EAEFmY,EAAM,EAAKA,EAAM,EAAMA,EAAM,EAGlCpvB,MAAM2L,QAAQsL,GACT,OADT,EAyEF,SAASwtC,GAAqBC,EAAMC,EAAYC,GAK9C,GAJAF,EAAOA,EAAKhuC,OAAO,SAAU4lC,GAC3B,OAAOuI,GAAUvI,EAAI1P,IAAK+X,EAAWj8B,SAAUk8B,KAG7CD,EAAWxR,KAAM,CAEnB,IAAI2R,EA9BR,SAA2B3R,GAEzB,SAAS4R,EAAsBnY,GAC7B,OAAOuG,EAAKxpC,IAAI,SAAUq7C,GACxB,IACI3E,EAAcC,GADFO,GAAOmE,IAGvB,OADoB5E,GAAgBxT,EAAKyT,KAK7C,OAAO,SAAU4E,EAAMC,GACrB,IA7oBelO,EAAMC,EA+oBjBkO,EAAY5C,GAFGwC,EAAsBE,EAAKrY,KAC3BmY,EAAsBG,EAAKtY,MAE9C,OAAkB,IAAduY,EACKA,GAjpBMnO,EAopBEiO,EAAKrY,IAAIgC,IAppBLqI,EAopBUiO,EAAKtY,IAAIgC,IAnpBnCoI,EAAOC,GAAS,EAAID,EAAOC,EAAQ,EAAI,IA8pB1BmO,CAAkBT,EAAWxR,MAC/CuR,EAAOA,EAAKvR,KAAK2R,GACiB,iBAAvBH,EAAWxR,KAAK,IACU,UA/nBvBjuC,EA+nBDy/C,EAAWxR,KAAK,IA9nBpB0N,GAAO37C,MA+nBdw/C,EAAOA,EAAKtR,WAhoBlB,IAAkBluC,EAooBhB,GAAI,UAAWy/C,GAAc,SAAUA,EAAY,CAEjD,IAAIpH,EAAOoH,EAAWpH,MAAQ,EAC1Bn6B,GAAS,UAAWuhC,EAAaA,EAAWvhC,MAAQshC,EAAK/lD,QAAU4+C,EACvEmH,EAAOA,EAAK93C,MAAM2wC,EAAMn6B,GAE1B,OAAOshC,EAGT,SAASG,GAAUjY,EAAKlkB,EAAUk8B,GAChC,OAAOA,EAAev4C,MAAM,SAAUu0C,GACpC,IAAII,EAAUt4B,EAASk4B,GACnBP,EAAcC,GAAWM,GACzByE,EAAgBjF,GAAgBxT,EAAKyT,GACzC,OAAIM,GAAqBC,GA0B7B,SAAmCA,EAAOI,EAASpU,GAEjD,GAAc,QAAVgU,EACF,OAAOI,EAAQsE,KAAK,SAAUC,GAC5B,OAAOV,GAAUjY,EAAK2Y,EAAYxqD,OAAOmH,KAAKqjD,MAIlD,GAAc,SAAV3E,EACF,OAAQiE,GAAUjY,EAAKoU,EAASjmD,OAAOmH,KAAK8+C,IAI9C,OAAQA,EAAQwE,KAAK,SAAUD,GAC7B,OAAOV,GAAUjY,EAAK2Y,EAAYxqD,OAAOmH,KAAKqjD,MAvCrCE,CAA0B7E,EAAOI,EAASpU,GAG5C8Y,GAAc1E,EAASpU,EAAKyT,EAAagF,KAIpD,SAASK,GAAc1E,EAASpU,EAAKyT,EAAagF,GAChD,OAAKrE,IAMkB,iBAAZA,EACFjmD,OAAOmH,KAAK8+C,GAAS30C,MAAM,SAAUs5C,GAC1C,IAAIC,EAAY5E,EAAQ2E,GACxB,OA2BN,SAAeA,EAAc/Y,EAAKgZ,EAAWvF,EAAagF,GACxD,IAAKQ,GAASF,GACZ,MAAM,IAAI7mD,MAAM,qBAAuB6mD,EACrC,sIAGJ,OAAOE,GAASF,GAAc/Y,EAAKgZ,EAAWvF,EAAagF,GAjChD/5C,CAAMq6C,EAAc/Y,EAAKgZ,EAAWvF,EAAagF,KAKrDrE,IAAYqE,GA+BrB,SAASS,GAAYT,GACnB,OAAO,MAAOA,EAGhB,SAASU,GAAoBV,GAC3B,YAAgC,IAAlBA,EAyBhB,SAASW,GAAmBX,EAAeO,GACzC,OAAOA,EAAUN,KAAK,SAAUpqC,GAC9B,OAAImqC,aAAyBrlD,MACpBqlD,EAAcv5C,QAAQoP,IAAQ,EAGhCmqC,IAAkBnqC,IA0C7B,IAAI2qC,GAAW,CAEb,WAAc,SAAUjZ,EAAKgZ,EAAWvF,EAAagF,GACnD,QAAKrlD,MAAM2L,QAAQ05C,KAIU,IAAzBA,EAAc1mD,SAIc,iBAArB0mD,EAAc,GAChBA,EAAcC,KAAK,SAAUpqC,GAClC,OAAO2pC,GAAU3pC,EAAK0qC,EAAW7qD,OAAOmH,KAAK0jD,MAI1CP,EAAcC,KAAK,SAAUpqC,GAClC,OAAOwqC,GAAcE,EAAWhZ,EAAKyT,EAAanlC,QAItD,UAAa,SAAU0xB,EAAKgZ,EAAWvF,EAAagF,GAClD,QAAKrlD,MAAM2L,QAAQ05C,KAKU,IAAzBA,EAAc1mD,SAIc,iBAArB0mD,EAAc,GAChBA,EAAch5C,MAAM,SAAU6O,GACnC,OAAO2pC,GAAU3pC,EAAK0qC,EAAW7qD,OAAOmH,KAAK0jD,MAI1CP,EAAch5C,MAAM,SAAU6O,GACnC,OAAOwqC,GAAcE,EAAWhZ,EAAKyT,EAAanlC,QAItD,IAAO,SAAU0xB,EAAKgZ,EAAWvF,EAAagF,GAC5C,OAAOU,GAAoBV,IAAwD,IAAtC9C,GAAQ8C,EAAeO,IAGtE,KAAQ,SAAUhZ,EAAKgZ,EAAWvF,EAAagF,GAC7C,OAAOU,GAAoBV,IAAkB9C,GAAQ8C,EAAeO,IAAc,GAGpF,IAAO,SAAUhZ,EAAKgZ,EAAWvF,EAAagF,GAC5C,OAAOU,GAAoBV,IAAkB9C,GAAQ8C,EAAeO,GAAa,GAGnF,KAAQ,SAAUhZ,EAAKgZ,EAAWvF,EAAagF,GAC7C,OAAOU,GAAoBV,IAAkB9C,GAAQ8C,EAAeO,IAAc,GAGpF,IAAO,SAAUhZ,EAAKgZ,EAAWvF,EAAagF,GAC5C,OAAOU,GAAoBV,IAAkB9C,GAAQ8C,EAAeO,GAAa,GAGnF,QAAW,SAAUhZ,EAAKgZ,EAAWvF,EAAagF,GAEhD,OAAIO,EACKG,GAAoBV,IAGrBU,GAAoBV,IAG9B,KAAQ,SAAUzY,EAAKgZ,EAAWvF,EAAagF,GAC7C,OAAOS,GAAYT,IA/IvB,SAAkBA,EAAeO,GAC/B,IAAIK,EAAUL,EAAU,GACpBM,EAAMN,EAAU,GACpB,GAAgB,IAAZK,EACF,MAAM,IAAInnD,MAAM,sCAGlB,GAAI4L,SAASu7C,EAAS,MAAQA,EAC5B,MAAM,IAAInnD,MAAM,6BAGlB,GAAI4L,SAASw7C,EAAK,MAAQA,EACxB,MAAM,IAAIpnD,MAAM,6BAGlB,OAAI4L,SAAS26C,EAAe,MAAQA,GAI7BA,EAAgBY,IAAYC,EA4HIC,CAASd,EAAeO,IAG/D,IAAO,SAAUhZ,EAAKgZ,EAAWvF,EAAagF,GAC5C,OAAOO,EAAUv5C,MAAM,SAAU+5C,GAC/B,OAA2C,IAApC7D,GAAQ8C,EAAee,MAGlC,IAAO,SAAUxZ,EAAKgZ,EAAWvF,EAAagF,GAC5C,OAAOS,GAAYT,IAAkBW,GAAmBX,EAAeO,IAGzE,KAAQ,SAAUhZ,EAAKgZ,EAAWvF,EAAagF,GAC7C,OAAOS,GAAYT,KAAmBW,GAAmBX,EAAeO,IAG1E,MAAS,SAAUhZ,EAAKgZ,EAAWvF,EAAagF,GAC9C,OAAOS,GAAYT,IA1HvB,SAAmBA,EAAeO,GAChC,OAAOP,EAAc1mD,SAAWinD,EAyHOS,CAAUhB,EAAeO,IAGhE,KAAQ,SAAUhZ,EAAKgZ,EAAWvF,EAAagF,GAC7C,OAAOrlD,MAAM2L,QAAQ05C,IApIzB,SAAgCA,EAAeO,GAC7C,OAAOA,EAAUv5C,MAAM,SAAU6O,GAC/B,OAAOmqC,EAAcv5C,QAAQoP,IAAQ,IAkIEorC,CAAuBjB,EAAeO,IAG/E,OAAU,SAAUhZ,EAAKgZ,EAAWvF,EAAagF,GAC/C,OAAOS,GAAYT,IA9HvB,SAAoBA,EAAeO,GAGjC,OAFS,IAAIh7C,OAAOg7C,GAEVx6C,KAAKi6C,GA2HwBkB,CAAWlB,EAAeO,IAGjE,MAAS,SAAUhZ,EAAKgZ,EAAWvF,EAAagF,GAC9C,OA5HJ,SAAmBA,EAAeO,GAEhC,OAAQA,GACN,IAAK,OACH,OAAyB,OAAlBP,EACT,IAAK,UACH,MAAkC,kBAApB,EAChB,IAAK,SACH,MAAkC,iBAApB,EAChB,IAAK,SACH,MAAkC,iBAApB,EAChB,IAAK,QACH,OAAOA,aAAyBrlD,MAClC,IAAK,SACH,MAA6C,oBAAtC,GAAK+I,SAASvO,KAAK6qD,GAG9B,MAAM,IAAIvmD,MAAM8mD,EAAY,8FA2GnBY,CAAUnB,EAAeO,KA4CpC,SAASjN,GAASzqB,EAAM+E,GACtB,GAAI/E,EAAKxF,UACHwF,EAAKxX,QAA0B,cAAhBwX,EAAKxX,OAAwB,CAC9C,IAAI+vC,EAAoC,iBAAhBv4B,EAAKxX,OAC3BwX,EAAKxX,OAAS,WAChB,OAAOuc,EAAS,IAAIn0B,MAAM,gCAAkC2nD,EAAa,MAG7ExzB,IAGF,SAAS8lB,GAAU7qB,GACbA,EAAKpb,OAASob,EAAKxX,SACrBwX,EAAKxX,OAAS,SAGZwX,EAAKxF,WAAawF,EAAKxX,SACzBwX,EAAKxX,OAAS,aAGZwX,EAAKxX,QAAiC,iBAAhBwX,EAAKxX,SACT,UAAhBwX,EAAKxX,OACPwX,EAAKpb,KAAO46B,GAA+Bxf,EAAKpb,MAEhDob,EAAKxX,OAASg3B,GAA+Bxf,EAAKxX,SAKxD,SAASsiC,GAAa0N,EAAgBx4B,GACpC,OAAOA,EAAKxX,QAAiC,iBAAhBwX,EAAKxX,SAC/BwX,EAAKy4B,UAAYpZ,GAASmZ,EAAexe,IAG9C,SAASxxB,GAAOgwC,EAAgBx4B,GAC9B,IAAI+E,EAAW/E,EAAKkoB,SACpB,GAAoB,UAAhBloB,EAAKxX,OAAoB,CAC3B,IAAKwX,EAAKpb,MAA6B,iBAAdob,EAAKpb,KAAmB,CAC/C,IAAIhS,EAAMsrC,GAAYL,EACpB,iDACF,OAAO9Y,EAASnyB,GAGlB,IAAI8lD,EAAWnZ,GAA2Bvf,EAAKpb,MAC/C4zC,EAAexe,GAAGhtC,IAAI,WAAa0rD,EAAS,GAAI,SAAU9lD,EAAK+lD,GAE7D,GAAIH,EAAehQ,YACjB,OAAOzjB,EAAS,KAAM,CAACmX,OAAQ,cAGjC,GAAItpC,EACF,OAAOmyB,EAASqZ,GAA0BxrC,IAE5C,IAAIgmD,EAASD,GAAQA,EAAKE,OAASF,EAAKE,MAAMH,EAAS,KACrDC,EAAKE,MAAMH,EAAS,IAAIj9C,IAC1B,IAAKm9C,EACH,OAAO7zB,EAASmZ,GAAYd,EACzBub,EAAKE,MAAQ,qBAAuBH,EAAS,GAC5C,4BAEN14B,EAAKxX,OA/DF03B,GAfI,CACT,yBACA,kBACA,yBACA,iCACA,sBACA,OACA,gBAuEyB0Y,EAvEC,IAC1B,eACA,mBACA,mBACA,MACA,MACAl9C,KAAK,MAEgB,IAgEnB88C,EAAe9N,UAAU1qB,UAEtB,GAAIA,EAAKxF,SACdwF,EAAKxX,OAAS,SAAUk2B,GACtB,OAxGN,SAAyBA,EAAKlkB,GAE5B,GAAwB,iBAAbA,EAET,MAAM,IAAI5pB,MAAM,0CAIlB,IAIIkoD,EAAcvC,GAAqB,CAJ7B,CACR,IAAO7X,IAGqC,CAAE,SALhDlkB,EAAWm5B,GAAgBn5B,IAK6C3tB,OAAOmH,KAAKwmB,IACpF,OAAOs+B,GAAsC,IAAvBA,EAAYroD,OA2FvBsoD,CAAgBra,EAAK1e,EAAKxF,WAEnCg+B,EAAe9N,UAAU1qB,OACpB,CAEL,IAAIu4B,EAAahZ,GAA2Bvf,EAAKxX,QACjDgwC,EAAexe,GAAGhtC,IAAI,WAAaurD,EAAW,GAAI,SAAU3lD,EAAK+lD,GAE/D,GAAIH,EAAehQ,YACjB,OAAOzjB,EAAS,KAAM,CAACmX,OAAQ,cAGjC,GAAItpC,EACF,OAAOmyB,EAASqZ,GAA0BxrC,IAE5C,IAAIomD,EAAYL,GAAQA,EAAKM,SAAWN,EAAKM,QAAQV,EAAW,IAChE,IAAKS,EACH,OAAOj0B,EAASmZ,GAAYd,EACxBub,GAAQA,EAAKM,QAAW,qBAAuBV,EAAW,GACxD,8BAERv4B,EAAKxX,OA5GF03B,GAAU,yBA4GY8Y,EA5GuB,IAAK,IA6GrDR,EAAe9N,UAAU1qB,MAmB/B,SAASk5B,GAAS1/C,GAChB,OAAOA,EAAMmoB,OAAO,SAAU3qB,EAAK4uC,GAEjC,OADA5uC,EAAI4uC,IAAQ,EACL5uC,GACN,IARLsyC,GAAQuI,OAVR,SAAkCvI,GAChCA,EAAQkB,qBAAuB,CAC7BC,SAAUA,GACVI,UAAWA,GACXC,aAAcA,GACdtiC,OAAQA,MAOZ8gC,GAAQxvC,QAnkCM,QA4kCd,IAAIq/C,GAAgBD,GAAS,CAC3B,MACA,OACA,eACA,WACA,aACA,aACA,aACA,qBACA,aACA,YAEA,kBACA,qBACA,0BACA,4BACA,qBAEA,aAIEE,GAAYF,GAAS,CACvB,eAEA,kBACA,qBACA,0BACA,4BACA,uBAGF,SAASG,GAAkBpN,GACzB,IAAK,SAAS/uC,KAAK+uC,GACjB,OAAO/N,GAAYF,IAErB,IAAI9c,EAAM+qB,EAAOruC,QAAQ,KACrBkrC,EAAOmD,EAAO1vB,UAAU,EAAG2E,GAC3B6nB,EAAQkD,EAAO1vB,UAAU2E,EAAM,GACnC,MAAO,CACLuoB,OAAQjtC,SAASssC,EAAM,IACvBnuC,GAAIouC,GAsBR,SAASuQ,GAAS5a,EAAK6a,EAAUC,GAO/B,IAAIC,EACA/N,EACAgO,EARCF,IACHA,EAAS,CACP/V,oBAAoB,IAOxB,IAAIzjB,EAAO,CAACkc,OAAQ,aAKpB,GAJIwC,EAAI4M,WACNtrB,EAAKwkB,SAAU,GAGb+U,EAKF,GAJK7a,EAAIgC,MACPhC,EAAIgC,IAAMmD,MAEZ6H,EAAWvQ,GAAIuD,EAAK8a,EAAO/V,oBACvB/E,EAAI6B,KAAM,CAEZ,IADAmZ,EAAUL,GAAkB3a,EAAI6B,OACpB7tC,MACV,OAAOgnD,EAEThb,EAAIiF,UAAY,CAAC,CACflyB,IAAKioC,EAAQjQ,OACbnF,IAAK,CAACoV,EAAQ/+C,GAAI,CAACuhC,OAAQ,WAAY,CAAC,CAACwP,EAAU1rB,EAAM,QAE3Dy5B,EAAUC,EAAQjQ,OAAS,OAE3B/K,EAAIiF,UAAY,CAAC,CACflyB,IAAK,EACL6yB,IAAM,CAACoH,EAAU1rB,EAAM,MAEzBy5B,EAAU,OAQZ,GALI/a,EAAIyK,aACNzK,EAAIiF,UAzDV,SAAkCgW,EAAW35B,GAM3C,IALA,IAAIvO,EAAMkoC,EAAUlsC,MAAQksC,EAAUrV,IAAI7zC,OAAS,EAE/CmpD,EAAcD,EAAUrV,IACxBA,EAAM,CAACsV,EAAY,GAAI55B,EAAM,IAExB7zB,EAAI,EAAG6G,EAAM4mD,EAAYnpD,OAAQtE,EAAI6G,EAAK7G,IACjDm4C,EAAM,CAACsV,EAAYztD,GAAI,CAAC+vC,OAAQ,WAAY,CAACoI,IAG/C,MAAO,CAAC,CACN7yB,IAAKA,EACL6yB,IAAKA,IA6CauV,CAAyBnb,EAAIyK,WAAYnpB,GACzDy5B,EAAU/a,EAAIyK,WAAW17B,MACzBi+B,EAAWhN,EAAIyK,WAAW7E,IAAI,KAE3B5F,EAAIiF,UAAW,CAElB,IADA+V,EAAUL,GAAkB3a,EAAI6B,OACpB7tC,MACV,OAAOgnD,EAETD,EAAUC,EAAQjQ,OAClBiC,EAAWgO,EAAQ/+C,GACnB+jC,EAAIiF,UAAY,CAAC,CACflyB,IAAKgoC,EACLnV,IAAK,CAACoH,EAAU1rB,EAAM,MAK5Bof,GAAeV,EAAIgC,KAEnBhC,EAAI6B,KAAOkZ,EAAU,IAAM/N,EAE3B,IAAIjvC,EAAS,CAACsnC,SAAW,GAAIvuC,KAAO,IACpC,IAAK,IAAI9H,KAAOgxC,EAEd,GAAI7xC,OAAOkB,UAAUC,eAAe1B,KAAKoyC,EAAKhxC,GAAM,CAClD,IAAIosD,EAAwB,MAAXpsD,EAAI,GACrB,GAAIosD,IAAeX,GAAczrD,GAAM,CACrC,IAAIgF,EAAQwrC,GAAYN,EAAgBlwC,GAExC,MADAgF,EAAMG,QAAU+qC,EAAe/qC,QAAU,KAAOnF,EAC1CgF,EACGonD,IAAeV,GAAU1rD,GAClC+O,EAAOsnC,SAASr2C,EAAIgR,MAAM,IAAMggC,EAAIhxC,GAEpC+O,EAAOjH,KAAK9H,GAAOgxC,EAAIhxC,GAI7B,OAAO+O,EAaT,SAASs9C,GAAiBhb,EAAKib,EAAUj1B,GACvC,IAAIk1B,EAXN,SAAqBzkD,GACnB,IACE,OAAOqrC,GAASrrC,GAChB,MAAOoB,GAGP,MAAO,CAAClE,MAFEwrC,GAAYR,EACpB,6CAMWwc,CAAYnb,EAAIvpC,MAC/B,GAAIykD,EAASvnD,MACX,OAAOqyB,EAASk1B,EAASvnD,OAG3BqsC,EAAItuC,OAASwpD,EAASxpD,OAEpBsuC,EAAIvpC,KADW,SAAbwkD,EACSvY,GAAmBwY,EAAUlb,EAAIsN,cACtB,WAAb2N,EACEjZ,GAASkZ,GAETA,EAEblX,GAAUkX,EAAU,SAAUx9C,GAC5BsiC,EAAIob,OAAS,OAAS19C,EACtBsoB,MAyBJ,SAASq1B,GAAqBrb,EAAKib,EAAUj1B,GAC3C,GAAIga,EAAIE,KACN,OAAOla,IAEe,iBAAbga,EAAIvpC,KACbukD,GAAiBhb,EAAKib,EAAUj1B,GA1BpC,SAAwBga,EAAKib,EAAUj1B,GACrCge,GAAUhE,EAAIvpC,KAAM,SAAU6kD,GAC5Btb,EAAIob,OAAS,OAASE,EAEtBtb,EAAItuC,OAASsuC,EAAIvpC,KAAK8R,MAAQy3B,EAAIvpC,KAAK/E,QAAU,EAChC,WAAbupD,EACF1X,GAAmBvD,EAAIvpC,KAAM,SAAUksC,GACrC3C,EAAIvpC,KAAOksC,EACX3c,MAEoB,WAAbi1B,EACTxX,GAAazD,EAAIvpC,KAAM,SAAUosC,GAC/B7C,EAAIvpC,KAAOosC,EACX7c,MAGFA,MAYFu1B,CAAevb,EAAKib,EAAUj1B,GAkDlC,SAASw1B,GAAUC,EAAU17B,EAAM27B,EAAShgB,EACzBtuC,EAAGkM,EAAIqiD,EAAUnB,GAElC,GAlzFF,SAAmB7U,EAAMvJ,GAOvB,IANA,IAKI5E,EALA4N,EAAUO,EAAKhmC,QACfi8C,EAAWxf,EAAI18B,MAAM,KACrBm8C,EAAYp+C,SAASm+C,EAAS,GAAI,IAClCE,EAAWF,EAAS,GAGhBpkB,EAAO4N,EAAQvwC,OAAQ,CAC7B,GAAI2iC,EAAK9kB,MAAQmpC,GAAarkB,EAAK+N,IAAI,KAAOuW,EAC5C,OAAO,EAGT,IADA,IAAItW,EAAWhO,EAAK+N,IAAI,GACfn4C,EAAI,EAAG6G,EAAMuxC,EAAS9zC,OAAQtE,EAAI6G,EAAK7G,IAC9Cg4C,EAAQ3zC,KAAK,CAACihB,IAAK8kB,EAAK9kB,IAAM,EAAG6yB,IAAKC,EAASp4C,KAGnD,OAAO,EAkyFH2uD,CAAUh8B,EAAKslB,SAAUqW,EAAQ1W,SAAS5I,OAASoe,EAErD,OADA9e,EAAQtuC,GAAKsuD,EACNpiD,IAIT,IAAI0iD,EAAqBj8B,EAAKglB,YAAcA,GAAWhlB,GACnDk8B,EAAoB,YAAal8B,EAAOA,EAAK0lB,QAC/CuD,GAAUjpB,EAAMi8B,GACdvW,EAAU,YAAaiW,EAAQ1W,SAAW0W,EAAQ1W,SAASS,QAC7DuD,GAAU0S,EAAQ1W,UAChBkX,EAAS,MAAM/9C,KAAKu9C,EAAQ1W,SAAS5I,KAEzC,GAAI6f,IAAsBxW,GAAW+U,GAAY0B,EAAQ,CACvD,IAAIza,EAASia,EAAQjlD,KACrBgrC,EAAOD,KAAOwa,EACdva,EAAOE,IAAM+Z,EAAQ1W,SAASppC,GAC9B8/C,EAAUnB,GAAS9Y,EAAQ+Y,GAG7B,IAAI3S,EAASY,GAAM1oB,EAAKslB,SAAUqW,EAAQ1W,SAASK,SAAS,GAAIoW,GAOhE,GALiBjB,IACdyB,GAAqBxW,GAAgC,aAArBoC,EAAOvB,YACtC2V,GAA0C,aAArBpU,EAAOvB,WAC7B2V,IAAsBxW,GAAgC,eAArBoC,EAAOvB,WAE3B,CACd,IAAIzyC,EAAMsrC,GAAYb,GAEtB,OADA5C,EAAQtuC,GAAKyG,EACNyF,IAGT,IAAI6iD,EAAST,EAAQ1W,SAAS5I,IAC9Bsf,EAAQ1W,SAASK,SAAWwC,EAAOvC,KACnCoW,EAAQ9S,YAAcf,EAAOe,aAAe,GAExC7oB,EAAKq8B,UACPV,EAAQ1W,SAASoX,QAAUr8B,EAAKq8B,SAIlC,IAAIC,EAAgBtX,GAAW2W,EAAQ1W,UACnCsX,EAAsBtT,GAAU0S,EAAQ1W,SAAUqX,GAIlDE,EAASN,IAAsBK,EAAuB,EACxDL,EAAoBK,GAAuB,EAAI,EAWjDX,EAASD,EAASW,EAAeC,EAR7BH,IAAWE,EAEKC,EAGAtT,GAAU0S,EAAQ1W,SAAUmX,IAI9C,EAAMI,EAAOnvD,EAAGkM,GAOpB,SAASkjD,GAAYf,EAAUgB,EAAUtP,EAAKuP,EAAaC,EAAIjhB,EAC1CigB,EAAU16B,EAAM27B,GAGnCnB,EAAWA,GAAY,IA0BvB,IAAIjB,EAAWv5B,EAAK6rB,UAChB+P,EAAY,IAAI3kB,EAEhB4kB,EAAW,EACXC,EAAWN,EAAS/qD,OAExB,SAASsrD,MACDF,IAAaC,GAAYH,GAC7BA,IAIJH,EAAS79C,QAAQ,SAAUq+C,EAAYC,GAErC,GAAID,EAAWtb,KAAOsH,GAAUgU,EAAWtb,KAA3C,CACE,IAAInoC,EAAMyjD,EAAW1Q,SAAW,eAAiB,YACjDY,EAAI3zC,GAAKyjD,EAAY,CAACjhD,IAAK2gD,GAAK,SAAU9oD,EAAK2I,GAC7Ck/B,EAAQwhB,GAAcrpD,GAAO2I,EAC7BwgD,UAJJ,CASA,IAAIphD,EAAKqhD,EAAWjY,SAASppC,GACzBihD,EAAUjkB,IAAIh9B,IAChBmhD,IACAF,EAAU5uD,IAAI2N,GAAInK,KAAK,CAACwrD,EAAYC,KAEpCL,EAAUzpD,IAAIwI,EAAI,CAAC,CAACqhD,EAAYC,QAMpCL,EAAUj+C,QAAQ,SAAUu8B,EAAMv/B,GAChC,IAAI2/B,EAAU,EAEd,SAAS4hB,MACD5hB,EAAUJ,EAAKzpC,OACnB0rD,IAEAJ,IAGJ,SAASI,IACP,IAAI/uD,EAAQ8sC,EAAKI,GACb0hB,EAAa5uD,EAAM,GACnB6uD,EAAa7uD,EAAM,GAEvB,GAAIquD,EAAY9jB,IAAIh9B,GAClB4/C,GAAUC,EAAUiB,EAAYzuD,IAAI2N,GAAKqhD,EAAYvhB,EACnDwhB,EAAYC,EAAYxB,EAAUnB,OAC/B,CAEL,IAAI3S,EAASY,GAAM,GAAIwU,EAAWjY,SAASK,SAAS,GAAIoW,GACxDwB,EAAWjY,SAASK,SAAWwC,EAAOvC,KACtC2X,EAAWrU,YAAcf,EAAOe,aAAe,GAhFrD,SAAmB8S,EAASwB,EAAYl3B,GAEtC,IAAIq2B,EAAgBtX,GAAW2W,EAAQ1W,UACnCS,EAAUuD,GAAU0S,EAAQ1W,SAAUqX,GAC1C,GAAI,eAAgBp7B,GAAQwkB,EAE1B,OADA/J,EAAQwhB,GAAc/d,GAAYd,EAAa,WACxCrY,IAMT,GAFiBw0B,GApBrB,SAAuBkB,GACrB,MAAsD,YAA/CA,EAAQ1W,SAASK,SAAS,GAAGE,IAAI,GAAGpI,OAmBZkgB,CAAc3B,GAE3B,CACd,IAAI7nD,EAAMsrC,GAAYb,GAEtB,OADA5C,EAAQwhB,GAAcrpD,EACfmyB,IAKT21B,EAASD,EAASW,EAAe5W,EAASA,GAAS,EAFvCA,EAAU,EAAI,EAGjByX,EAAYl3B,GA4DjBs3B,CAAUL,EAAYC,EAAYC,IAGtCC,MAMJ,IAAIG,GAAkB,EAKlBC,GAAY,iBAGZC,GAAe,cAEfC,GAAe,eAGfC,GAAuB,mBAIvBC,GAAa,aAEbC,GAAc,cAEdC,GAA4B,sBAchC,SAASC,GAAkBC,GACzB,IACE,OAAO1/C,KAAKC,UAAUy/C,GACtB,MAAOnmD,GAEP,OAAO,IAAS0G,UAAUy/C,IAI9B,SAASC,GAASj4B,GAChB,OAAO,SAAUnlB,GACf,IAAI/M,EAAU,gBACV+M,EAAIpR,QAAUoR,EAAIpR,OAAOkE,QAC3BG,EAAU+M,EAAIpR,OAAOkE,MAAMhG,MAAQkT,EAAIpR,OAAOkE,MAAMG,SAEtDkyB,EAASmZ,GAAYH,GAAWlrC,EAAS+M,EAAI9P,QAWjD,SAASmtD,GAAelZ,EAAUD,EAAYU,GAC5C,MAAO,CACLhvC,KAAMsnD,GAAkB/Y,GACxBD,WAAYA,EACZoZ,eAAgB1Y,EAAU,IAAM,IAChChI,IAAKuH,EAASvH,IACd7hC,GAAIopC,EAASppC,IAIjB,SAASwiD,GAAeC,GACtB,IAAKA,EACH,OAAO,KAET,IAAIrZ,EApDN,SAAuBz0B,GAIrB,IACE,OAAOjS,KAAKgvB,MAAM/c,GAClB,MAAO1Y,GAEP,OAAO,IAASy1B,MAAM/c,IA4CT+tC,CAAcD,EAAa5nD,MAI1C,OAHAuuC,EAASD,WAAasZ,EAAatZ,WACnCC,EAASS,QAA0C,MAAhC4Y,EAAaF,eAChCnZ,EAASvH,IAAM4gB,EAAa5gB,IACrBuH,EAKT,SAASuZ,GAAU5e,GACjB,IAAKA,EACH,OAAOA,EAET,IAAIxd,EAAMwd,EAAI6e,YAAYpvC,YAAY,KAItC,OAHAuwB,EAAIgC,IAAMhC,EAAI6e,YAAYhhC,UAAU,EAAG2E,EAAM,GAC7Cwd,EAAI6B,KAAO7B,EAAI6e,YAAYhhC,UAAU2E,EAAM,UACpCwd,EAAI6e,YACJ7e,EAMT,SAAS8e,GAAav9C,EAAMnQ,EAAM2tD,EAAQ14B,GACpC04B,EAIA14B,EAHG9kB,EAEsB,iBAATA,EACPA,EAEA0hC,GAAa1hC,EAAMnQ,GAJnBmxC,GAAW,CAAC,IAAK,CAACnxC,KAAMA,KAO9BmQ,EAEsB,iBAATA,EAChB4hC,GAAmB5hC,EAAM,SAAUkiC,GACjCpd,EAASgc,GAASoB,MAGpBpd,EAAS9kB,GANT8kB,EAAS,IAWf,SAAS24B,GAA4Bhf,EAAK1e,EAAM29B,EAAKtlD,GACnD,IAAIymC,EAAcjyC,OAAOmH,KAAK0qC,EAAIM,cAAgB,IAClD,IAAKF,EAAYruC,OACf,OAAO4H,GAAMA,IAEf,IAAIiiC,EAAU,EAEd,SAASE,MACDF,IAAYwE,EAAYruC,QAAU4H,GACtCA,IAcJymC,EAAYnhC,QAAQ,SAAUohC,GACxB/e,EAAK8e,aAAe9e,EAAK6e,aAX/B,SAAyBH,EAAKK,GAC5B,IAAI6e,EAASlf,EAAIM,aAAaD,GAC1Bob,EAASyD,EAAOzD,OACVwD,EAAIE,YAAYpB,IAAczvD,IAAImtD,GACxC2D,UAAY,SAAUlnD,GACxBgnD,EAAO39C,KAAOrJ,EAAEpI,OAAOiO,OAAOwD,KAC9Bu6B,KAMAujB,CAAgBrf,EAAKK,IAErBL,EAAIM,aAAaD,GAAKE,MAAO,EAC7BzE,OASN,SAASwjB,GAAuBvjB,EAASgjB,GACvC,OAAO95B,QAAQ0qB,IAAI5T,EAAQh/B,IAAI,SAAU2yC,GACvC,GAAIA,EAAI1P,KAAO0P,EAAI1P,IAAIM,aAAc,CACnC,IAAIif,EAAWpxD,OAAOmH,KAAKo6C,EAAI1P,IAAIM,cACnC,OAAOrb,QAAQ0qB,IAAI4P,EAASxiD,IAAI,SAAUsjC,GACxC,IAAI6e,EAASxP,EAAI1P,IAAIM,aAAaD,GAClC,GAAM,SAAU6e,EAAhB,CAGA,IAAI39C,EAAO29C,EAAO39C,KACdnQ,EAAO8tD,EAAOvR,aAClB,OAAO,IAAI1oB,QAAQ,SAAU1nB,GAC3BuhD,GAAav9C,EAAMnQ,EAAM2tD,EAAQ,SAAUjoD,GACzC44C,EAAI1P,IAAIM,aAAaD,GAAOjC,EAC1BrD,EAAKmkB,EAAQ,CAAC,SAAU,iBACxB,CAACpoD,KAAMA,IAETyG,gBAQZ,SAASiiD,GAAYxZ,EAAM5J,EAAO6iB,GAEhC,IAAIQ,EAA0B,GAC1BC,EAAWT,EAAIE,YAAYrB,IAC3B6B,EAAWV,EAAIE,YAAYpB,IAC3B6B,EAAiBX,EAAIE,YAAYnB,IACjC3rD,EAAQ2zC,EAAKj0C,OAEjB,SAAS+pC,MACPzpC,GAMF,WACE,IAAKotD,EAAwB1tD,OAC3B,OAEF0tD,EAAwBxgD,QAAQ,SAAUw8C,GACzBmE,EAAe3qD,MAAM,aAAa5C,MAC/CwtD,YAAYC,MACVrE,EAAS,KAAMA,EAAS,OAAY,GAAO,IACtC2D,UAAY,SAAUlnD,GACjBA,EAAEpI,OAAOiO,QAGnB4hD,EAASzmB,OAAOuiB,MAhBpBsE,GAsBJ/Z,EAAK/mC,QAAQ,SAAUsuC,GACrB,IAAIt4C,EAAQyqD,EAASzqD,MAAM,eACvBjG,EAAMotC,EAAQ,KAAOmR,EACzBt4C,EAAMg/C,OAAOjlD,GAAKowD,UAAY,SAAUlnD,GACtC,IAAI4lC,EAAM5lC,EAAEpI,OAAOiO,OACnB,GAAmB,iBAAR+/B,EACT,OAAOhC,IAET4jB,EAASxmB,OAAO4E,GAEH8hB,EAAe3qD,MAAM,OAC/B+qD,WAAWH,YAAYI,KAAKniB,IAExBshB,UAAY,SAAUljC,GAC3B,IAAIgkC,EAAShkC,EAAMpsB,OAAOiO,OAC1B,GAAImiD,EAAQ,CACV,IAAIzE,EAASyE,EAAOxxD,MAAMyxD,UAAUpgD,MAAM,MAAM,GAChD0/C,EAAwB3tD,KAAK2pD,GAC7BmE,EAAe1mB,OAAOgnB,EAAOE,YAC7BF,EAAOG,gBAEPvkB,QAOV,SAASwkB,GAAsBC,EAAKC,EAAQ5xD,GAC1C,IACE,MAAO,CACLqwD,IAAKsB,EAAIE,YAAYD,EAAQ5xD,IAE/B,MAAOsF,GACP,MAAO,CACLF,MAAOE,IAKb,IAAI4lD,GAAiB,IAAI9c,EAEzB,SAAS0jB,GAAY5F,EAAQlb,EAAKte,EAAMksB,EAAK+S,EAAKl6B,GAWhD,IAVA,IACI44B,EACA0B,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EARAnE,EAAWld,EAAIpE,KAUV/tC,EAAI,EAAG6G,EAAMwoD,EAAS/qD,OAAQtE,EAAI6G,EAAK7G,IAAK,CACnD,IAAIuyC,EAAM8c,EAASrvD,GACfuyC,EAAIgC,KAAOsH,GAAUtJ,EAAIgC,OAG7BhC,EAAM8c,EAASrvD,GAAKmtD,GAAS5a,EAAK1e,EAAK6rB,UAAW2N,IAC1C9mD,QAAUgtD,IAChBA,EAAehhB,GAInB,GAAIghB,EACF,OAAO36B,EAAS26B,GAGlB,IAAIE,GAAmB,EACnBC,EAAgB,EAChBplB,EAAU,IAAI3oC,MAAM0pD,EAAS/qD,QAC7BgrD,EAAc,IAAIxkB,EAClB6oB,GAAsB,EACtB9F,EAAW9N,EAAI6T,MAAMC,YAAc,OAAS,SA6ChD,SAASC,IACPL,GAAmB,EACnBM,IAQF,SAASA,IACFP,GAAYC,IAKjBD,EAAQQ,UAAYN,EACpBJ,EAAU9e,IAAIgf,IAqChB,SAASzX,IACH4X,IAIJtH,GAAe3b,OAAOqP,EAAI6T,MAAMrzD,MAChCq4B,EAAS,KAAM0V,IAsDjB,SAASigB,EAASD,EAASW,EAAeC,EAAqB+E,EAC7CC,EAAU/E,EAAOW,EAAYl3B,GAE7C01B,EAAQ1W,SAASD,WAAasX,EAC9BX,EAAQ1W,SAASS,QAAU6W,EAE3B,IAAI3c,EAAM+b,EAAQjlD,KAUlB,GATAkpC,EAAIgC,IAAM+Z,EAAQ1W,SAASppC,GAC3B+jC,EAAI6B,KAAOka,EAAQ1W,SAAS5I,IAExBilB,IACF1hB,EAAI4M,UAAW,GAGI5M,EAAIM,cACvBnyC,OAAOmH,KAAK0qC,EAAIM,cAAcvuC,OAE9B,OAqEJ,SAA0BgqD,EAASW,EAAeC,EACxBgF,EAAUpE,EAAYl3B,GAG9C,IAAI2Z,EAAM+b,EAAQjlD,KAEd8kC,EAAU,EACVwE,EAAcjyC,OAAOmH,KAAK0qC,EAAIM,cAElC,SAASshB,IACHhmB,IAAYwE,EAAYruC,QAC1B8vD,EAAU9F,EAASW,EAAeC,EAChCgF,EAAUpE,EAAYl3B,GAI5B,SAASy7B,IACPlmB,IACAgmB,IAGFxhB,EAAYnhC,QAAQ,SAAUjQ,GAC5B,IAAIqxC,EAAM0b,EAAQjlD,KAAKwpC,aAAatxC,GACpC,GAAKqxC,EAAIE,KAOP3E,IACAgmB,QARa,CACb,IAAI9qD,EAAOupC,EAAIvpC,YACRupC,EAAIvpC,KACXupC,EAAIuN,OAAS9vC,SAAS4+C,EAAe,IAiD3C,SAAwBjB,EAAQ3kD,EAAMuvB,GAGpBw6B,EAAYxuD,MAAMopD,GACxB2D,UAAY,SAAUlnD,GAE9B,GADYA,EAAEpI,OAAOiO,OAEnB,OAAOsoB,IAET,IAAI07B,EAAS,CACXtG,OAAQA,EACRl6C,KAAMzK,GAEK+pD,EAAY5e,IAAI8f,GACtB3C,UAAY/4B,GA7DjB27B,CADa3hB,EAAIob,OACM3kD,EAAMgrD,MAjGxBG,CAAiBlG,EAASW,EAAeC,EAC9CgF,EAAUpE,EAAYl3B,GAG1B86B,GAAiBvE,EACjB4E,IAEAK,EAAU9F,EAASW,EAAeC,EAChCgF,EAAUpE,EAAYl3B,GAG1B,SAASw7B,EAAU9F,EAASW,EAAeC,EACxBgF,EAAUpE,EAAYl3B,GAEvC,IAAI2Z,EAAM+b,EAAQjlD,KACduuC,EAAW0W,EAAQ1W,SAMvB,SAAS6c,EAAYhqD,GACnB,IAAIiqD,EAAepG,EAAQ9S,aAAe,GAEtC0Y,GAAYnU,EAAI1C,kBAClBqX,EAAeA,EAAa9xD,OAptHpC,SAAqBg1C,GACnB,IAAIW,EAAO,GAQX,OAPAD,GAAgBV,EAASK,SAAU,SAAUW,EAAQtzB,EACRm2B,EAAS7sC,EAAKilB,GACrC,cAAhBA,EAAKkc,QAA2B6I,IAClCL,EAAKl0C,KAAKihB,EAAM,IAAMm2B,GACtB5nB,EAAKkc,OAAS,aAGXwI,EA2sHkCoc,CAAYrG,EAAQ1W,YAGrD8c,GAAgBA,EAAapwD,QAC/BytD,GAAY2C,EAAcpG,EAAQ1W,SAASppC,GAAIgjD,GAGjD5Z,EAASvH,IAAM5lC,EAAEpI,OAAOiO,OAGxB,IAAIskD,EAAkB9D,GAAelZ,EAAUqX,EAC7CC,GACgBgE,EAAS1e,IAAIogB,GACnBjD,UAAYkD,EAe1B,SAASA,IACPvmB,EAAQwhB,GAAc,CACpBniB,IAAI,EACJn/B,GAAIopC,EAASppC,GACbwgC,IAAK4I,EAAS5I,KAEhBsgB,EAAYtpD,IAAIsoD,EAAQ1W,SAASppC,GAAI8/C,EAAQ1W,UAgDjD,SAAkC0W,EAASje,EAAKzX,GAE9C,IAAIk8B,EAAY,EACZC,EAAYr0D,OAAOmH,KAAKymD,EAAQjlD,KAAKwpC,cAAgB,IAEzD,IAAKkiB,EAAUzwD,OACb,OAAOs0B,IAGT,SAASyV,MACDymB,IAAcC,EAAUzwD,QAC5Bs0B,IAIJ,SAASzkB,EAAIy+B,GACX,IAAIob,EAASM,EAAQjlD,KAAKwpC,aAAaD,GAAKob,OACxC7b,EAAMkhB,EAAkB7e,IAAI,CAC9BnE,IAAKA,EACLqiB,UAAW1E,EAAS,KAAO3d,IAG7B8B,EAAIwf,UAAYtjB,EAChB8D,EAAI6iB,QAAU,SAAUvqD,GAItBA,EAAEuhB,iBACFvhB,EAAEiJ,kBACF26B,KAGJ,IAAK,IAAIruC,EAAI,EAAGA,EAAI+0D,EAAUzwD,OAAQtE,IACpCmU,EAAI4gD,EAAU/0D,IAhFdi1D,CAAyB3G,EAAS1W,EAASvH,IAAKzX,GA3ClD2Z,EAAI6e,YAAcxZ,EAASppC,GAAK,KAAOopC,EAAS5I,WACzCuD,EAAIgC,WACJhC,EAAI6B,KA4CX,IAAI8gB,EAAS/B,EAAW3e,IAAIjC,GAE5B2iB,EAAOvD,UAAY8C,EACnBS,EAAOF,QAzBP,SAA0BvqD,GAExBA,EAAEuhB,iBACFvhB,EAAEiJ,kBACUy/C,EAAW3rD,MAAM,eACPg/C,OAAOjU,EAAI6e,aACvBO,UAAY,SAAUlnD,GACjB0oD,EAAW3e,IAAIjC,EAAK9nC,EAAEpI,OAAOiO,QACnCqhD,UAAY8C,KArtB3B,SAA+BpF,EAAUxB,EAAUj1B,GAEjD,IAAKy2B,EAAS/qD,OACZ,OAAOs0B,IAGT,IACIu8B,EADAC,EAAO,EA4BX,SAASje,IACPie,IACI/F,EAAS/qD,SAAW8wD,IAClBD,EACFv8B,EAASu8B,GAETv8B,KA/BNy2B,EAAS79C,QAAQ,SAAU88C,GACzB,IAAI3b,EAAc2b,EAAQjlD,MAAQilD,EAAQjlD,KAAKwpC,aAC7CnyC,OAAOmH,KAAKymD,EAAQjlD,KAAKwpC,cAAgB,GACvCwiB,EAAO,EAEX,IAAK1iB,EAAYruC,OACf,OAAO6yC,IAGT,SAASme,EAAoB7uD,GAC3B0uD,EAAa1uD,IACb4uD,IACa1iB,EAAYruC,QACvB6yC,IAIJ,IAAK,IAAI51C,KAAO+sD,EAAQjlD,KAAKwpC,aACvByb,EAAQjlD,KAAKwpC,aAAahxC,eAAeN,IAC3C0sD,GAAqBK,EAAQjlD,KAAKwpC,aAAatxC,GAC7CssD,EAAUyH,KAydlBC,CAAsBlG,EAAUxB,EAAU,SAAUpnD,GAClD,GAAIA,EACF,OAAOmyB,EAASnyB,IAKpB,WAEE,IAMI+uD,EAAY3C,GAAsBC,EANzB,CACX1C,GAAWC,GACXC,GACAG,GAAaF,GACbC,IAEiD,aACnD,GAAIgF,EAAUjvD,MACZ,OAAOqyB,EAAS48B,EAAUjvD,QAE5BirD,EAAMgE,EAAUhE,KACZiE,QAAU5E,GAASj4B,GACvB44B,EAAIkE,UAAY7E,GAASj4B,GACzB44B,EAAImE,WAAa5Z,EACjBmX,EAAW1B,EAAIE,YAAYtB,IAC3B+C,EAAa3B,EAAIE,YAAYrB,IAC7B+C,EAAc5B,EAAIE,YAAYpB,IAC9B+C,EAAoB7B,EAAIE,YAAYnB,KACpC+C,EAAY9B,EAAIE,YAAYlB,KAElB3vD,IAAI2vD,IAAYmB,UAAY,SAAUlnD,GAC9C+oD,EAAU/oD,EAAEpI,OAAOiO,OACnByjD,KA2FJ,SAA2Br7B,GAGzB,IAAIk9B,EAAU,GAWd,GAVAvG,EAAS79C,QAAQ,SAAU88C,GACrBA,EAAQjlD,MAAQilD,EAAQjlD,KAAKwpC,cAC/BnyC,OAAOmH,KAAKymD,EAAQjlD,KAAKwpC,cAAcrhC,QAAQ,SAAUqkD,GACvD,IAAIjjB,EAAM0b,EAAQjlD,KAAKwpC,aAAagjB,GAChCjjB,EAAIE,MACN8iB,EAAQvxD,KAAKuuC,EAAIob,aAKpB4H,EAAQtxD,OACX,OAAOo0B,IAET,IACIjyB,EADA0nC,EAAU,EAQdynB,EAAQpkD,QAAQ,SAAUw8C,IAzC5B,SAA0BA,EAAQp1B,GAEtBw6B,EAAYvyD,IAAImtD,GACtB2D,UAAY,SAAUlnD,GACxB,GAAKA,EAAEpI,OAAOiO,OAOZsoB,QAPoB,CACpB,IAAInyB,EAAMsrC,GAAYD,GACpB,uCACAkc,GACFvnD,EAAIspC,OAAS,IACbnX,EAASnyB,KAiCXqvD,CAAiB9H,EAAQ,SAAU+H,GAC7BA,IAAWtvD,IACbA,EAAMsvD,KAPJ5nB,IAAYynB,EAAQtxD,QACxBo0B,EAAOjyB,OA9GXuvD,CAAkB,SAAUvvD,GAC1B,GAAIA,EAEF,OADAktD,GAAsB,EACf/6B,EAASnyB,IA0BtB,WAEE,IAAK4oD,EAAS/qD,OACZ,OAGF,IAAI2xD,EAAa,EAEjB,SAAS5nB,MACD4nB,IAAe5G,EAAS/qD,QAvBhC8qD,GAAY/B,EAAO6I,WAAY7G,EAAUtP,EAAKuP,EAClCkC,EAAKljB,EAASigB,EAAU16B,EAAMigC,GA2B1C,SAASqC,EAAa1nC,GACpB,IAAImpB,EAAWoZ,GAAeviC,EAAMpsB,OAAOiO,QAEvCsnC,GACF0X,EAAYtpD,IAAI4xC,EAASppC,GAAIopC,GAE/BvJ,IAGF,IAAK,IAAIruC,EAAI,EAAG6G,EAAMwoD,EAAS/qD,OAAQtE,EAAI6G,EAAK7G,IAAK,CACnD,IAAIsuD,EAAUe,EAASrvD,GACvB,GAAIsuD,EAAQ/Z,KAAOsH,GAAUyS,EAAQ/Z,KACnClG,SAGQ6kB,EAASryD,IAAIytD,EAAQ1W,SAASppC,IACpCmjD,UAAYwE,GAtDhBC,KAnCFC,KAiVJ,SAASC,GAAiB5E,EAAa6E,EAAU3X,EAAY4X,EAAWC,GAWtE,IAIIC,EACAC,EACAC,EAEJ,SAASC,EAASpsD,GAChBksD,EAAclsD,EAAEpI,OAAOiO,OACnBomD,GACFD,EAAQC,EAAWC,EAAaC,GAIpC,SAASE,EAAarsD,GACpBisD,EAAYjsD,EAAEpI,OAAOiO,OACjBqmD,GACFF,EAAQC,EAAWC,EAAaC,GA8BpC,SAASG,EAAStsD,GAChB,IAAIgoD,EAAShoD,EAAEpI,OAAOiO,OACtB,IAAKmiD,EACH,OAAOgE,IAGTA,EAAQ,CAAChE,EAAOlxD,KAAM,CAACkxD,EAAOxxD,OAAQwxD,IA/DrB,IAAf+D,IACFA,EAAY,KAQgC,mBAAvB9E,EAAYsF,QACC,mBAA3BtF,EAAYuF,YACnBT,EAAY,IAAM5X,GAwDlBgY,EAAe,CAAC,SApClB,WACE,IAAKF,EAAUpyD,OACb,OAAOmyD,IAGT,IACIS,EADAC,EAAUT,EAAUA,EAAUpyD,OAAS,GAE3C,GAAIiyD,GAAYA,EAASa,MACvB,IACEF,EAAc9E,YAAYC,MAAM8E,EAASZ,EAASa,OAChD,EAAMb,EAASc,WACjB,MAAO5sD,GACP,GAAe,cAAXA,EAAElK,MAAmC,IAAXkK,EAAEmf,KAC9B,OAAO6sC,SAIXS,EAAc9E,YAAYkF,WAAWH,GAAS,GAEhDZ,EAAWW,EACXR,EAAY,KACZC,EAAc,KACdjF,EAAYsF,OAAOT,EAAUC,GAAW7E,UAAYkF,EACpDnF,EAAYuF,WAAWV,EAAUC,GAAW7E,UAAYmF,IAcxDpF,EAAYsF,OAAOT,EAAUC,GAAW7E,UAAYkF,EACpDnF,EAAYuF,WAAWV,EAAUC,GAAW7E,UAAYmF,GAC/ClY,EACT8S,EAAYa,WAAWgE,EAAU,QAAQ5E,UAAYoF,EAErDrF,EAAYa,WAAWgE,GAAU5E,UAAYoF,EA+EjD,SAASQ,GAAW1jC,EAAMi/B,EAAKl6B,GAC7B,IAQI29B,EACAiB,EATAl2C,EAAQ,aAAcuS,GAAOA,EAAKuvB,SAClCv3C,EAAM,WAAYgoB,GAAOA,EAAKyvB,OAC9B/hD,EAAM,QAASsyB,GAAOA,EAAKtyB,IAC3BsG,EAAO,SAAUgsB,GAAOA,EAAKhsB,KAC7Bq7C,EAAOrvB,EAAKqvB,MAAQ,EACpBn6B,EAA8B,iBAAf8K,EAAK9K,MAAqB8K,EAAK9K,OAAS,EACvD0uC,GAAsC,IAAvB5jC,EAAK6jC,cAIxB,IAAK7vD,IAEH2vD,GADAjB,EAzCJ,SAAwBj1C,EAAOzV,EAAK4rD,EAAcl2D,EAAKq9C,GACrD,IACE,GAAIt9B,GAASzV,EACX,OAAI+yC,EACKwT,YAAYC,MAAMxmD,EAAKyV,GAAQm2C,GAAc,GAE7CrF,YAAYC,MAAM/wC,EAAOzV,GAAK,GAAQ4rD,GAE1C,GAAIn2C,EACT,OAAIs9B,EACKwT,YAAYuF,WAAWr2C,GAEvB8wC,YAAYkF,WAAWh2C,GAE3B,GAAIzV,EACT,OAAI+yC,EACKwT,YAAYkF,WAAWzrD,GAAM4rD,GAE7BrF,YAAYuF,WAAW9rD,GAAM4rD,GAEjC,GAAIl2D,EACT,OAAO6wD,YAAYI,KAAKjxD,GAE1B,MAAOkJ,GACP,MAAO,CAAClE,MAAOkE,GAEjB,OAAO,KAeMmtD,CAAet2C,EAAOzV,EAAK4rD,EAAcl2D,EAAKsyB,EAAK+qB,cAClC2X,EAAShwD,SAEV,cAAvBixD,EAAcj3D,MAA+C,IAAvBi3D,EAAc5tC,MAGtD,OAAOgP,EAASmZ,GAAYH,GAC1B4lB,EAAcj3D,KAAMi3D,EAAc9wD,UAIxC,IAAIqsD,EAAS,CAAC3C,GAAWC,GAAcG,IAEnC38B,EAAK8e,aACPogB,EAAO1uD,KAAKisD,IAEd,IAAIkF,EAAY3C,GAAsBC,EAAKC,EAAQ,YACnD,GAAIyC,EAAUjvD,MACZ,OAAOqyB,EAAS48B,EAAUjvD,OAE5B,IAAIirD,EAAMgE,EAAUhE,IACpBA,EAAImE,WAgIJ,WACM9hC,EAAK8e,YACPkf,GAAuBvjB,EAASza,EAAKmiB,QAAQvqB,KAAKosC,GAElDA,KAnIJrG,EAAIiE,QAAU5E,GAASj4B,GACvB,IAKIo7B,EACA8D,EAekCC,EArBlC7E,EAAW1B,EAAIE,YAAYtB,IAC3B6B,EAAWT,EAAIE,YAAYrB,IAC3BiD,EAAY9B,EAAIE,YAAYlB,IAC5BwH,EAAgB/F,EAASzqD,MAAM,eAC/B8mC,EAAU,GAiDd,SAAS2pB,EAAahJ,EAAerX,GACnC,IAAIqK,EAAM,CACRzzC,GAAIopC,EAASppC,GACbjN,IAAKq2C,EAASppC,GACdvN,MAAO,CACL+tC,IAAKigB,IAGKrX,EAASS,QAEjBxwC,IACFymC,EAAQjqC,KAAK49C,GAEbA,EAAIhhD,MAAMo3C,SAAU,EACpB4J,EAAI1P,IAAM,MAEH2Q,KAAU,IACnB5U,EAAQjqC,KAAK49C,GACTpuB,EAAK6e,cAhCb,SAAgCkF,EAAUqK,EAAKgN,GAC7C,IAAI1tD,EAAMq2C,EAASppC,GAAK,KAAOygD,EAC/B+I,EAAcn3D,IAAIU,GAAKowD,UAAa,SAAkBlnD,GAEpD,GADAw3C,EAAI1P,IAAM4e,GAAU1mD,EAAEpI,OAAOiO,SAAW,GACpCujB,EAAKqlB,UAAW,CAClB,IAAIA,EAAYF,GAAiBpB,GAC7BsB,EAAU50C,SACZ29C,EAAI1P,IAAImK,WAAaxD,GAGzBqY,GAA4BtP,EAAI1P,IAAK1e,EAAM29B,IAuBzC0G,CAAuBtgB,EAAUqK,EAAKgN,IAK5C,SAAS/f,EAAaipB,GACpB,IAAK,IAAIn4D,EAAI,EAAG6G,EAAMsxD,EAAY7zD,OAAQtE,EAAI6G,GACxCynC,EAAQhqC,SAAWykB,EAD0B/oB,IAAK,CAItD,IAAIo4D,EAAaD,EAAYn4D,GAC7B,GAAIo4D,EAAW7xD,OAASsB,EAEtBymC,EAAQjqC,KAAK+zD,OAFf,CAKA,IAAIxgB,EAAWoZ,GAAeoH,GAE9BH,EADoBrgB,EAASD,WACDC,KAIhC,SAAS6e,EAAQ4B,EAAWF,EAAa1F,GAClCA,IAGLvjB,EAAaipB,GACT7pB,EAAQhqC,OAASykB,GACnB0pC,EAAOG,YAYX,SAASiF,IACP,IAAIS,EAAY,CACdC,WAAYvE,EACZrxC,OAAQkR,EAAKqvB,KACbmH,KAAM/b,GAIJza,EAAKkrB,iBAA4B37C,IAAd00D,IACrBQ,EAAUvZ,WAAa+Y,GAEzBl/B,EAAS,KAAM0/B,GAYjB,OA/HAhF,EAAUzyD,IAAI2vD,IAAYmB,UAAY,SAAUlnD,GAC9CupD,EAAWvpD,EAAEpI,OAAOiO,OAAO0jD,UAIzBngC,EAAKkrB,aAQ6BgZ,EAPV,SAAUttD,GAC9BA,EAAEpI,OAAOiO,QAAU7F,EAAEpI,OAAOiO,OAAOhM,OAAS,IAC9CwzD,EAAYrtD,EAAEpI,OAAOiO,OAAO,KAFhB2hD,EAoBJM,WAAW,KAAM,QAAQZ,UAZrC,SAAkBlnD,GAChB,IAAIgoD,EAAShoD,EAAEpI,OAAOiO,OAClBkoD,OAASp1D,EAIb,OAHIqvD,GAAUA,EAAOlxD,MACnBi3D,EAAS/F,EAAOlxD,KAEXw2D,EAAU,CACf11D,OAAQ,CACNiO,OAAQ,CAACkoD,QAyGbhB,GAA2B,IAAVzuC,OAArB,EAGIlhB,EA7NN,SAAqBA,EAAMqrD,EAAUuD,GAEnC,IAAIE,EAAc,IAAIhxD,MAAMkC,EAAKvD,QAC7BM,EAAQ,EACZiD,EAAK2J,QAAQ,SAAUjQ,EAAKiG,GAC1B0rD,EAASryD,IAAIU,GAAKowD,UAAY,SAAUljC,GAClCA,EAAMpsB,OAAOiO,OACfqmD,EAAYnvD,GAASinB,EAAMpsB,OAAOiO,OAElCqmD,EAAYnvD,GAAS,CAACjG,IAAKA,EAAKgF,MAAO,eAEzC3B,IACciD,EAAKvD,QACjBmyD,EAAQ5uD,EAAM8uD,EAAa,OAiNxB8B,CAAY5kC,EAAKhsB,KAAMqrD,EAAUuD,IAE3B,IAAX1tC,EA1PN,SAAgB2oC,EAAa6E,EAAUwB,GACrC,GAAkC,mBAAvBrG,EAAYsF,OAAvB,CAMA,IAAI97C,EAAS,GAgBbw2C,EAAYa,WAAWgE,GAAU5E,UAdjC,SAAkBlnD,GAChB,IAAIgoD,EAAShoD,EAAEpI,OAAOiO,OAClBmiD,GACFv3C,EAAO7W,KAAKouD,EAAOxxD,OACnBwxD,EAAOG,YAEPmF,EAAU,CACR11D,OAAQ,CACNiO,OAAQ4K,WAddw2C,EAAYsF,OAAOT,GAAU5E,UAAYoG,EAwPlCf,CAAO9D,EAAUqD,EAtC1B,SAAkB9rD,GAChB,IAAIyQ,EAASzQ,EAAEpI,OAAOiO,OAClBujB,EAAK+qB,aACP1jC,EAASA,EAAO69B,WAElB7J,EAAah0B,UAqCfo7C,GAAiBpD,EAAUqD,EAAU1iC,EAAK+qB,WAAY71B,EAAQm6B,EAAMuT,GAkDtE,IAAIiC,IAAU,EACVruD,GAAQ,GAaZ,SAASsuD,MACHD,IAAYruD,GAAM/F,SAGtBo0D,IAAU,EACVruD,GAAM9C,OAAN8C,IAgBF,SAAS+lC,GAAQvc,EAAMksB,EAAK/P,EAAQ8iB,GAGlC,IAFAj/B,EAAOiY,EAAMjY,IAEJ2qB,WAAY,CACnB,IAAIhwC,EAAKwhC,EAAS,IAAM0H,KAGxB,OAFA2U,GAAetlD,YAAYipC,EAAQxhC,EAAIuxC,EAAKlsB,GAC5Cw4B,GAAe3b,OAAOV,GACf,CACLkM,OAAQ,WACNmQ,GAAehnD,eAAe2qC,EAAQxhC,KAK5C,IAAIoqD,EAAS/kC,EAAKy4B,SAAW,IAAIzhB,EAAYhX,EAAKy4B,SAElDz4B,EAAKyc,MAAQzc,EAAKyc,OAAS,EAC3B,IAAI8L,EAAUvoB,EAAKyc,MAEfvnB,EAAQ,UAAW8K,EAAOA,EAAK9K,OAAS,EAC9B,IAAVA,IACFA,EAAQ,GAGV,IAKIyoC,EACA2B,EACAD,EACA8E,EARA1pB,EAAU,GACVuqB,EAAa,EACbx8C,EAAS61B,GAAare,GACtBilC,EAAmB,IAAIhuB,EA0F3B,SAASiuB,EAAcxmB,EAAKlC,EAAKuH,EAAU1rC,GACzC,GAAI0rC,EAASvH,MAAQA,EAEnB,OAAOnkC,IAGT,GAAI0rC,EAASD,aAAepF,EAAI6B,KAE9B,OAAOloC,EAAG0rC,EAAUrF,GAItB,IAAIymB,EAAWzmB,EAAIgC,IAAM,KAAOqD,EAASD,WAC/BqgB,EAAcn3D,IAAIm4D,GACxBrH,UAAY,SAAUlnD,GACxByB,EAAG0rC,EAAUuZ,GAAU1mD,EAAEpI,OAAOiO,UAqBpC,SAASooB,IACP7E,EAAKkoB,SAAS,KAAM,CAClBzN,QAASA,EACTuT,SAAUzF,IAcd,IAAI6c,EAAe,CAAC7I,GAAWC,IAC3Bx8B,EAAK8e,aACPsmB,EAAa50D,KAAKisD,IAEpB,IAAIkF,EAAY3C,GAAsBC,EAAKmG,EAAc,YACzD,GAAIzD,EAAUjvD,MACZ,OAAOstB,EAAKkoB,SAASyZ,EAAUjvD,QAEjCirD,EAAMgE,EAAUhE,KACZiE,QAAU5E,GAASh9B,EAAKkoB,UAC5ByV,EAAImE,WApBJ,YACO9hC,EAAK2qB,YAAc3qB,EAAK8e,YAG3Bkf,GAAuBvjB,GAAS7iB,KAAKiN,GAErCA,KAgBJy6B,EAAa3B,EAAIE,YAAYrB,IAC7B6C,EAAW1B,EAAIE,YAAYtB,IAC3B4H,EAAgB7E,EAAW3rD,MAAM,eAKjC8uD,GAAiBnD,EAHDt/B,EAAKyc,QAAUzc,EAAK+qB,WAClCwT,YAAYkF,WAAWzjC,EAAKyc,OAAO,GAAQ,KAENzc,EAAK+qB,WAAY71B,EA3JxD,SAAiBsvC,EAAWF,EAAa1F,GACvC,GAAKA,GAAW4F,EAAU/zD,OAA1B,CAIA,IAAI40D,EAAc,IAAIvzD,MAAM0yD,EAAU/zD,QAClC60D,EAAY,IAAIxzD,MAAM0yD,EAAU/zD,QA+DhC6pC,EAAU,EACdgqB,EAAY3mD,QAAQ,SAAUvQ,EAAOjB,IAgCvC,SAAoCuyC,EAAKlC,EAAKnkC,GAC5C,GAAI0sD,IAAWA,EAAOptB,IAAI+G,EAAIgC,KAC5B,OAAOroC,IAGT,IAAI0rC,EAAWkhB,EAAiBj4D,IAAI0xC,EAAIgC,KACxC,GAAIqD,EACF,OAAOmhB,EAAcxmB,EAAKlC,EAAKuH,EAAU1rC,GAG3CgnD,EAASryD,IAAI0xC,EAAIgC,KAAKod,UAAY,SAAUlnD,GAC1CmtC,EAAWoZ,GAAevmD,EAAEpI,OAAOiO,QACnCwoD,EAAiB9yD,IAAIusC,EAAIgC,IAAKqD,GAC9BmhB,EAAcxmB,EAAKlC,EAAKuH,EAAU1rC,IA1ClCktD,CAFUjI,GAAUlwD,GACVo3D,EAAUr4D,GACiB,SAAU43C,EAAUyhB,GACvDF,EAAUn5D,GAAK43C,EACfshB,EAAYl5D,GAAKq5D,IACXlrB,IAAYkqB,EAAU/zD,QArChC,WAEE,IADA,IAAI09C,EAAW,GACNhiD,EAAI,EAAG6G,EAAMqyD,EAAY50D,OAAQtE,EAAI6G,GACxCgyD,IAAe9vC,EAD8B/oB,IAAK,CAItD,IAAIq5D,EAAaH,EAAYl5D,GAC7B,GAAKq5D,EAAL,CAGA,IAAIzhB,EAAWuhB,EAAUn5D,GACzBgiD,EAAS39C,KAAKi1D,EAA6B1hB,EAAUyhB,KAGvD7hC,QAAQ0qB,IAAIF,GAAUv2B,KAAK,SAAU2kB,GACnC,IAAK,IAAIpwC,EAAI,EAAG6G,EAAMupC,EAAQ9rC,OAAQtE,EAAI6G,EAAK7G,IACzCowC,EAAQpwC,IACV6zB,EAAK2c,SAASJ,EAAQpwC,MAGzB4hD,MAAM/tB,EAAKkoB,UAEV8c,IAAe9vC,GACjB0pC,EAAOG,WAeL2G,OArEN,SAASD,EAA6B1hB,EAAUyhB,GAC9C,IAAI/mB,EAASze,EAAK2oB,cAAc6c,EAAYzhB,EAAU/jB,GACtDuoB,EAAU9J,EAAOjC,IAAMuH,EAASvH,IAEhC,IAAImpB,EAAWn9C,EAAOi2B,GACtB,MAAwB,iBAAbknB,EACFhiC,QAAQC,OAAO+hC,GAGnBA,GAGLX,IACIhlC,EAAKkuB,aACPzT,EAAQjqC,KAAKiuC,GAIXze,EAAK8e,aAAe9e,EAAK6e,aACpB,IAAIlb,QAAQ,SAAU1nB,GAC3ByhD,GAA4B8H,EAAYxlC,EAAM29B,EAAK,WACjDK,GAAuB,CAACvf,GAASze,EAAKmiB,QAAQvqB,KAAK,WACjD3b,EAAQwiC,SAKP9a,QAAQ1nB,QAAQwiC,IAjBhB9a,QAAQ1nB,aA4IvB,IACI2pD,GADAC,GAAY,IAAI5uB,EAEhB6uB,GAAc,IAAI7uB,EAEtB,SAAS8uB,GAAS/lC,EAAM+E,GACtB,IAAImnB,EAAM78C,MAlNZ,SAAqBmsB,EAAQuJ,EAAUukB,GACrC9yC,GAAMhG,KAAK,WACTgrB,EAAO,SAAqB5oB,EAAK2I,IArBrC,SAAiBhD,EAAK3F,EAAK2I,EAAK+tC,GAC9B,IACE/wC,EAAI3F,EAAK2I,GACT,MAAO3I,GAIP02C,EAAQh5C,KAAK,QAASsC,IAepBozD,CAAQjhC,EAAUnyB,EAAK2I,EAAK+tC,GAC5Bub,IAAU,EACV,IAAU,WACRC,WAINA,KA0MAmB,CAAY,SAAUC,IAKxB,SAAcha,EAAKlsB,EAAM+E,GAEvB,IAAIoX,EAASnc,EAAKtzB,KAEduyD,EAAM,KA4BV,SAASkH,EAAuBxI,EAAK54B,GACnC,IAAIs6B,EAAW1B,EAAIE,YAAYtB,IAC/B8C,EAAS+G,YAAY,iBAAkB,iBAAkB,CAACC,QAAS,IAEnEhH,EAASX,aAAaZ,UAAY,SAAUljC,GAC1C,IAAIgkC,EAAShkC,EAAMpsB,OAAOiO,OAC1B,GAAImiD,EAAQ,CACV,IAAI7a,EAAW6a,EAAOxxD,MAClBo3C,EAAUuD,GAAUhE,GACxBA,EAASmZ,eAAiB1Y,EAAU,IAAM,IAC1C6a,EAAS1e,IAAIoD,GACb6a,EAAOG,gBAEPh6B,KAYN,SAASuhC,EAAkB3I,EAAKtlD,GAC9B,IAAIkuD,EAAa5I,EAAIE,YAAYjB,IAC7ByC,EAAW1B,EAAIE,YAAYtB,IAC3B6B,EAAWT,EAAIE,YAAYrB,IAElB6C,EAASX,aACfZ,UAAY,SAAUljC,GAC3B,IAAIgkC,EAAShkC,EAAMpsB,OAAOiO,OAC1B,GAAImiD,EAAQ,CACV,IAAI7a,EAAW6a,EAAOxxD,MAClB0tC,EAAQiJ,EAASppC,GACjB6rD,EAAQxe,GAAUlN,GAClBmR,EAASnI,GAAWC,GACxB,GAAIyiB,EAAO,CACT,IAAIrB,EAAWrqB,EAAQ,KAAOmR,EAG1Bx+B,EAAQqtB,EAAQ,KAChB9iC,EAAM8iC,EAAQ,MACdnnC,EAAQyqD,EAASzqD,MAAM,eACvB8yD,EAAQlI,YAAYC,MAAM/wC,EAAOzV,GAAK,GAAO,GAC7C0uD,EAAY/yD,EAAM+qD,WAAW+H,GACjCC,EAAU5I,UAAY,SAAUlnD,GAE9B,GADA8vD,EAAY9vD,EAAEpI,OAAOiO,OAKd,CACL,IAAIjH,EAAOkxD,EAAUt5D,MACjBoI,EAAK+nD,cAAgB4H,GACvBoB,EAAW5lB,IAAInrC,GAEjB4oD,EAASxmB,OAAO8uB,EAAU5H,YAC1B4H,EAAU3H,gBARVM,EAASznB,OAAOgnB,EAAOE,YACvBF,EAAOG,iBAWXH,EAAOG,gBAEA1mD,GACTA,KAcN,SAASsuD,EAAmBhJ,EAAK54B,GAC/B,IAAIq5B,EAAWT,EAAIE,YAAYrB,IAC3B6B,EAAWV,EAAIE,YAAYpB,IAC3B6B,EAAiBX,EAAIE,YAAYnB,IAK3B2B,EAASttD,QACf+sD,UAAY,SAAUlnD,GAExB,IADYA,EAAEpI,OAAOiO,OAEnB,OAAOsoB,IAGTq5B,EAASM,aAAaZ,UAAY,SAAUlnD,GAC1C,IAAIgoD,EAAShoD,EAAEpI,OAAOiO,OACtB,IAAKmiD,EACH,OAAO75B,IAMT,IAJA,IAAI2Z,EAAMkgB,EAAOxxD,MACbovC,EAAMoiB,EAAOE,WACb1O,EAAOvjD,OAAOmH,KAAK0qC,EAAIM,cAAgB,IACvC4nB,EAAY,GACPh4C,EAAI,EAAGA,EAAIwhC,EAAK3/C,OAAQme,IAAK,CAEpCg4C,EADUloB,EAAIM,aAAaoR,EAAKxhC,IAClBurC,SAAU,EAE1B,IAAI4H,EAAUl1D,OAAOmH,KAAK4yD,GAC1B,IAAKh4C,EAAI,EAAGA,EAAImzC,EAAQtxD,OAAQme,IAAK,CACnC,IAAIurC,EAAS4H,EAAQnzC,GACrB0vC,EAAe3d,IAAI,CACjBnE,IAAKA,EACLqiB,UAAW1E,EAAS,KAAO3d,IAG/BoiB,EAAOG,aAWb,SAAS8H,EAAgBlJ,GAavB,IAAI2B,EAAa3B,EAAIE,YAAYrB,IAC7B6C,EAAW1B,EAAIE,YAAYtB,IAClB8C,EAASX,aACfZ,UAAY,SAAUlnD,GAC3B,IAAIgoD,EAAShoD,EAAEpI,OAAOiO,OACtB,GAAKmiD,EAAL,CAGA,IAnB4BxB,EAmBxBrZ,GAnBwBqZ,EAmBQwB,EAAOxxD,OAlBzBoI,KAKX2nD,GAAeC,IAHpBA,EAAa5Y,QAA0C,MAAhC4Y,EAAaF,eAC7BE,GAqDT,GApCArZ,EAASD,WAAaC,EAASD,YAC7BA,GAAWC,GAmCTA,EAASvH,IACX,OAAOsqB,KAlCT,WAGE,IAAIr5C,EAAQs2B,EAASppC,GAAK,KACtB3C,EAAM+rC,EAASppC,GAAK,MACpB2jC,EAAMghB,EAAW3rD,MAAM,eAAe+qD,WACxCH,YAAYC,MAAM/wC,EAAOzV,IAEvB+uD,EAAc,EAClBzoB,EAAIwf,UAAY,SAAUlnD,GACxB,IAAIgoD,EAAShoD,EAAEpI,OAAOiO,OACtB,IAAKmiD,EAEH,OADA7a,EAASvH,IAAMuqB,EACRD,IAET,IAAItqB,EAAMoiB,EAAOE,WACbtiB,EAAMuqB,IACRA,EAAcvqB,GAEhBoiB,EAAOG,YAkBXiI,GAdA,SAASF,IACP,IAAI/F,EAAkB9D,GAAelZ,EACnCA,EAASD,WAAYC,EAASS,SAEtB6a,EAAS1e,IAAIogB,GACnBjD,UAAY,WACdc,EAAOG,cAjNf7S,EAAI6T,MAAQ,KA8NZ7T,EAAI5M,SAAU,EACd4M,EAAIp8C,KAAO,WACT,MAAO,OAGTo8C,EAAIxL,IAAMlI,EAAU,SAAUzT,GAC5BA,EAAS,KAAMmnB,EAAI6T,MAAMkH,cAG3B/a,EAAIoE,UAAY,SAAsBhS,EAAK4oB,EAASniC,GAClDq6B,GAAYp/B,EAAMse,EAAK4oB,EAAShb,EAAK+S,EAAKl6B,IAK5CmnB,EAAIuC,KAAO,SAAiB9zC,EAAIqlB,EAAM+E,GACpC,IAAI2Z,EACAqF,EACAnxC,EACA+qD,EAAM39B,EAAKjlB,IACf,IAAK4iD,EAAK,CACR,IAAIgE,EAAY3C,GAAsBC,EACpC,CAAC1C,GAAWC,GAAcC,IAAe,YAC3C,GAAIkF,EAAUjvD,MACZ,OAAOqyB,EAAS48B,EAAUjvD,OAE5BirD,EAAMgE,EAAUhE,IAGlB,SAAS94B,IACPE,EAASnyB,EAAK,CAAC8rC,IAAKA,EAAKqF,SAAUA,EAAUhpC,IAAK4iD,IAGpDA,EAAIE,YAAYtB,IAAWvvD,IAAI2N,GAAImjD,UAAY,SAAUlnD,GAOvD,KANAmtC,EAAWoZ,GAAevmD,EAAEpI,OAAOiO,SAQjC,OADA7J,EAAMsrC,GAAYd,EAAa,WACxBvY,IAGT,IAAIonB,EACJ,GAAKjsB,EAAKmb,IAQR8Q,EAASjsB,EAAKwuB,OAt6ItB,SAAgBrT,EAAK4I,GAGnB,IAFA,IACIxN,EADA4N,EAAUJ,EAASK,SAAS1lC,QAExB63B,EAAO4N,EAAQvwC,OAAQ,CAC7B,IAAI6d,EAAM8kB,EAAK9kB,IACX4yB,EAAO9N,EAAK+N,IACZ3pC,EAAK0pC,EAAK,GACVrkB,EAAOqkB,EAAK,GACZE,EAAWF,EAAK,GAChBU,EAA6B,IAApBR,EAAS9zC,OAElBg1C,EAAUlP,EAAKkP,QAAUlP,EAAKkP,QAAQ/mC,QAAU,GAGpD,GAFA+mC,EAAQj1C,KAAK,CAACmK,GAAIA,EAAI8W,IAAKA,EAAKuO,KAAMA,IAElC+kB,EACF,IAAK,IAAI54C,EAAI,EAAG6G,EAAMyyC,EAAQh1C,OAAQtE,EAAI6G,EAAK7G,IAAK,CAClD,IAAIg7D,EAAc1hB,EAAQt5C,GAG1B,GAFiBg7D,EAAY11C,IAAM,IAAM01C,EAAYxsD,KAElCwgC,EAEjB,OAAO1pB,EAAM,IAAM9W,EAKzB,IAAK,IAAIiU,EAAI,EAAGxiB,EAAIm4C,EAAS9zC,OAAQme,EAAIxiB,EAAGwiB,IAC1Cu1B,EAAQ3zC,KAAK,CAACihB,IAAKA,EAAM,EAAG6yB,IAAKC,EAAS31B,GAAI62B,QAASA,IAK3D,MAAM,IAAI70C,MAAM,4CAA8CmzC,EAASppC,GAAK,SAAWwgC,GAs4I1DqT,CAAOxuB,EAAKmb,IAAK4I,GAAY/jB,EAAKmb,SALzD,GAFA8Q,EAASlI,EAASD,WACJiE,GAAUhE,GAGtB,OADAnxC,EAAMsrC,GAAYd,EAAa,WACxBvY,IAMX,IAAIg5B,EAAcF,EAAIE,YAAYrB,IAC9B9uD,EAAMq2C,EAASppC,GAAK,KAAOsxC,EAE/B4R,EAAYlqD,MAAM,eAAe3G,IAAIU,GAAKowD,UAAY,SAAUlnD,GAK9D,IAJA8nC,EAAM9nC,EAAEpI,OAAOiO,UAEbiiC,EAAM4e,GAAU5e,KAEbA,EAEH,OADA9rC,EAAMsrC,GAAYd,EAAa,WACxBvY,IAETA,OAKNqnB,EAAIgD,eAAiB,SAAUpU,EAAOssB,EAAUC,EAAYrnC,EAAM+E,GAChE,IAAI44B,EACJ,GAAI39B,EAAKjlB,IACP4iD,EAAM39B,EAAKjlB,QACN,CACL,IAAI4mD,EAAY3C,GAAsBC,EACpC,CAAC1C,GAAWC,GAAcC,IAAe,YAC3C,GAAIkF,EAAUjvD,MACZ,OAAOqyB,EAAS48B,EAAUjvD,OAE5BirD,EAAMgE,EAAUhE,IAElB,IAAIxD,EAASkN,EAAWlN,OACpBrqD,EAAOu3D,EAAWhb,aAEtBsR,EAAIE,YAAYpB,IAAczvD,IAAImtD,GAAQ2D,UAAY,SAAUlnD,GAE9D4mD,GADW5mD,EAAEpI,OAAOiO,OAAOwD,KACRnQ,EAAMkwB,EAAKmiB,OAAQ,SAAUmlB,GAC9CviC,EAAS,KAAMuiC,OAKrBpb,EAAI6D,MAAQ,SAAkBhrB,GAC5B,IAAIk/B,EACA9D,EAEAwB,EAAY3C,GAAsBC,EAAK,CAACtC,GAAYH,IAAe,YACvE,GAAImF,EAAUjvD,MACZ,OAAOqyB,EAAS48B,EAAUjvD,OAE5B,IAAIirD,EAAMgE,EAAUhE,IACpBA,EAAIE,YAAYlB,IAAY3vD,IAAI2vD,IAAYmB,UAAY,SAAUlnD,GAChEupD,EAAWvpD,EAAEpI,OAAOiO,OAAO0jD,UAE7BxC,EAAIE,YAAYrB,IAAckC,WAAW,KAAM,QAAQZ,UAAY,SAAUlnD,GAC3E,IAAIgoD,EAAShoD,EAAEpI,OAAOiO,OACtBwnD,EAAYrF,EAASA,EAAOlxD,IAAM,GAGpCiwD,EAAImE,WAAa,WACf/8B,EAAS,KAAM,CACbwiC,UAAWpH,EACXjV,WAAY+Y,EAEZuD,sBAAwBtb,EAAI6T,MAAMC,YAAc,SAAW,aAKjE9T,EAAI0D,SAAW,SAAqB5vB,EAAM+E,GACxC2+B,GAAW1jC,EAAMi/B,EAAKl6B,IAGxBmnB,EAAIjB,SAAW,SAAoBjrB,GACjC,OAAOuc,GAAQvc,EAAMksB,EAAK/P,EAAQ8iB,IAGpC/S,EAAI4D,OAAS,SAAU/qB,GAGrBk6B,EAAIpP,QACJgW,GAAUjuB,OAAOuE,GACjBpX,KAGFmnB,EAAIa,iBAAmB,SAAUjS,EAAO/V,GACtC,IAAI48B,EAAY3C,GAAsBC,EAAK,CAAC1C,IAAY,YACxD,GAAIoF,EAAUjvD,MACZ,OAAOqyB,EAAS48B,EAAUjvD,OAElBivD,EAAUhE,IACNE,YAAYtB,IAAWvvD,IAAI8tC,GACrCgjB,UAAY,SAAUljC,GACxB,IAAI8jB,EAAMye,GAAeviC,EAAMpsB,OAAOiO,QACjCiiC,EAGH3Z,EAAS,KAAM2Z,EAAI0F,UAFnBrf,EAASmZ,GAAYd,MAU3B8O,EAAIyB,cAAgB,SAAU7S,EAAO4J,EAAM3f,GACzC,IAMI48B,EAAY3C,GAAsBC,EANzB,CACX1C,GACAC,GACAC,GACAC,IAEiD,aACnD,GAAIiF,EAAUjvD,MACZ,OAAOqyB,EAAS48B,EAAUjvD,OAE5B,IAAIirD,EAAMgE,EAAUhE,IAELA,EAAIE,YAAYtB,IAEtBvvD,IAAI8tC,GAAOgjB,UAAY,SAAUljC,GACxC,IAAImpB,EAAWoZ,GAAeviC,EAAMpsB,OAAOiO,QAC3CgoC,GAAgBV,EAASK,SAAU,SAAUW,EAAQtzB,EACFm2B,EAAS7sC,EAAKilB,GAC/D,IAAIisB,EAASx6B,EAAM,IAAMm2B,GACK,IAA1BlD,EAAK9mC,QAAQquC,KACfjsB,EAAKkc,OAAS,aAGlBgiB,GAAYxZ,EAAM5J,EAAO6iB,GACzB,IAAIvC,EAAgBrX,EAASD,WACzBU,EAAUT,EAASS,QACvBmZ,EAAIE,YAAYtB,IAAW5b,IACzBsc,GAAelZ,EAAUqX,EAAe5W,KAE5CmZ,EAAIiE,QAAU5E,GAASj4B,GACvB44B,EAAImE,WAAa,WACf/8B,MAKJmnB,EAAIoC,UAAY,SAAU3zC,EAAIoqB,GAC5B,IAAI48B,EAAY3C,GAAsBC,EAAK,CAACrC,IAAc,YAC1D,GAAI+E,EAAUjvD,MACZ,OAAOqyB,EAAS48B,EAAUjvD,OAE5B,IACI4rC,EADKqjB,EAAUhE,IACNE,YAAYjB,IAAa5vD,IAAI2N,GAE1C2jC,EAAI6iB,QAAUnE,GAASj4B,GACvBuZ,EAAIwf,UAAY,SAAUlnD,GACxB,IAAI8nC,EAAM9nC,EAAEpI,OAAOiO,OACdiiC,UAGIA,EAAiB,YACxB3Z,EAAS,KAAM2Z,IAHf3Z,EAASmZ,GAAYd,MAQ3B8O,EAAIb,UAAY,SAAU3M,EAAK1e,EAAM+E,GACf,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,WAEF0e,EAAIyK,WACX,IAAIse,EAAS/oB,EAAI6B,KACb5lC,EAAK+jC,EAAIgC,IAIXhC,EAAI6B,KAHDknB,EAGQ,MAAQjrD,SAASirD,EAAOhpD,MAAM,KAAK,GAAI,IAAM,GAF7C,MAKb,IACI5M,EADA6pD,EAAK17B,EAAKjlB,IAEd,IAAK2gD,EAAI,CACP,IAAIiG,EAAY3C,GAAsBC,EAAK,CAACrC,IAAc,aAC1D,GAAI+E,EAAUjvD,MACZ,OAAOqyB,EAAS48B,EAAUjvD,QAE5BgpD,EAAKiG,EAAUhE,KACZwD,QAAUnE,GAASj4B,GACtB22B,EAAGoG,WAAa,WACVjwD,GACFkzB,EAAS,KAAMlzB,IAKrB,IACIysC,EADAopB,EAAShM,EAAGmC,YAAYjB,IAExB6K,GACFnpB,EAAMopB,EAAO16D,IAAI2N,IACbmjD,UAAY,SAAUlnD,GACxB,IAAI+wD,EAAS/wD,EAAEpI,OAAOiO,OACjBkrD,GAAUA,EAAOpnB,OAASknB,EAGnBC,EAAO/mB,IAAIjC,GACjBof,UAAY,WACdjsD,EAAM,CAACioC,IAAI,EAAMn/B,GAAI+jC,EAAIgC,IAAKvF,IAAKuD,EAAI6B,MACnCvgB,EAAKjlB,KACPgqB,EAAS,KAAMlzB,IANnBkzB,EAASmZ,GAAYb,OAYzBiB,EAAMopB,EAAOpnD,IAAIo+B,IACbyiB,QAAU,SAAUvqD,GAEtBmuB,EAASmZ,GAAYb,IACrBzmC,EAAEuhB,iBACFvhB,EAAEiJ,mBAEJy+B,EAAIwf,UAAY,WACdjsD,EAAM,CAACioC,IAAI,EAAMn/B,GAAI+jC,EAAIgC,IAAKvF,IAAKuD,EAAI6B,MACnCvgB,EAAKjlB,KACPgqB,EAAS,KAAMlzB,MAMvBq6C,EAAIX,aAAe,SAAU7M,EAAK1e,EAAM+E,GAClB,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,IAET,IAaInuB,EAbA6pD,EAAK17B,EAAKjlB,IACd,IAAK2gD,EAAI,CACP,IAAIiG,EAAY3C,GAAsBC,EAAK,CAACrC,IAAc,aAC1D,GAAI+E,EAAUjvD,MACZ,OAAOqyB,EAAS48B,EAAUjvD,QAE5BgpD,EAAKiG,EAAUhE,KACZmE,WAAa,WACVjwD,GACFkzB,EAAS,KAAMlzB,IAKrB,IAAI8I,EAAK+jC,EAAIgC,IACTgnB,EAAShM,EAAGmC,YAAYjB,IACxBte,EAAMopB,EAAO16D,IAAI2N,GAErB2jC,EAAI6iB,QAAUnE,GAASj4B,GACvBuZ,EAAIwf,UAAY,SAAUlnD,GACxB,IAAI+wD,EAAS/wD,EAAEpI,OAAOiO,OACjBkrD,GAAUA,EAAOpnB,OAAS7B,EAAI6B,MAGjCmnB,EAAO9vB,OAAOj9B,GACd9I,EAAM,CAACioC,IAAI,EAAMn/B,GAAIA,EAAIwgC,IAAK,OAC1Bnb,EAAKjlB,KACPgqB,EAAS,KAAMlzB,IALjBkzB,EAASmZ,GAAYd,MAW3B8O,EAAI9zC,SAAW,SAAU4nB,EAAM+E,GAC7ByzB,GAAezkD,mBAAmBooC,GAGlC,IAAIyrB,EAAU9B,GAAY94D,IAAImvC,GAC1ByrB,GAAWA,EAAQnrD,SACrBmrD,EAAQnrD,OAAOozC,QACfgW,GAAUjuB,OAAOuE,IAEnB,IAAImC,EAAMupB,UAAUC,eAAe3rB,GAEnCmC,EAAIwf,UAAY,WAEdgI,GAAYluB,OAAOuE,GACfV,KAAsBU,KAAUb,qBAC3BA,aAAaa,GAEtBpX,EAAS,KAAM,CAAE,IAAM,KAGzBuZ,EAAI6iB,QAAUnE,GAASj4B,IAGzB,IAAIgjC,EAASlC,GAAU74D,IAAImvC,GAE3B,GAAI4rB,EAGF,OAFA9I,EAAM8I,EAAO9I,IACb/S,EAAI6T,MAAQgI,EAAOlzD,OACZ,IAAU,WACfkwB,EAAS,KAAMmnB,KAInB,IAAI5N,EAAMupB,UAAUG,KAAK7rB,EAAQmgB,IACjCwJ,GAAY3zD,IAAIgqC,EAAQmC,GAExBA,EAAI2pB,gBAAkB,SAAUrxD,GAC9B,IAAIojC,EAAKpjC,EAAEpI,OAAOiO,OAClB,GAAI7F,EAAEsxD,WAAa,EACjB,OAlkBJ,SAAsBluB,GACpB,IAAIqlB,EAAWrlB,EAAGmuB,kBAAkB5L,GAAW,CAAC6L,QAAU,OAC1DpuB,EAAGmuB,kBAAkB3L,GAAc,CAAC6L,eAAe,IAChDjC,YAAY,cAAe,cAAe,CAACC,QAAQ,IACtDrsB,EAAGmuB,kBAAkB1L,GAAc,CAAC2L,QAAS,WAC7CpuB,EAAGmuB,kBAAkBxL,GAAY,CAACyL,QAAS,KAAMC,eAAe,IAChEruB,EAAGmuB,kBAAkBtL,IAGrBwC,EAAS+G,YAAY,iBAAkB,iBAAkB,CAACC,QAAS,IAGnErsB,EAAGmuB,kBAAkBvL,GAAa,CAACwL,QAAS,QAG5C,IAAI9J,EAAiBtkB,EAAGmuB,kBAAkBzL,GACxC,CAAC2L,eAAe,IAClB/J,EAAe8H,YAAY,MAAO,OAClC9H,EAAe8H,YAAY,YAAa,YAAa,CAACC,QAAQ,IAgjBrDiC,CAAatuB,GAItB,IAAI2jB,EAAM/mD,EAAE2xD,cAAcpJ,YAItBvoD,EAAEsxD,WAAa,GA/hBrB,SAAgCluB,GAC9BA,EAAGmuB,kBAAkBvL,GAAa,CAACwL,QAAS,QACzChC,YAAY,cAAe,cAAe,CAACC,QAAQ,IA8hBpDmC,CAAuBxuB,GAErBpjC,EAAEsxD,WAAa,GA7erB,SAA8BluB,GAC5B,IAAIskB,EAAiBtkB,EAAGmuB,kBAAkBzL,GACxC,CAAC2L,eAAe,IAClB/J,EAAe8H,YAAY,MAAO,OAClC9H,EAAe8H,YAAY,YAAa,YAAa,CAACC,QAAQ,IA0e5DoC,CAAqBzuB,GAGvB,IAAI0uB,EAAa,CACfvC,EACAG,EACAK,EACAE,GAGE16D,EAAIyK,EAAEsxD,YAEV,SAASvjC,IACP,IAAIgkC,EAAYD,EAAWv8D,EAAI,GAC/BA,IACIw8D,GACFA,EAAUhL,EAAKh5B,GAInBA,IAGF2Z,EAAIwf,UAAY,SAAUlnD,IAExBqoD,EAAMroD,EAAEpI,OAAOiO,QAEXmsD,gBAAkB,WACpB3J,EAAIpP,QACJgW,GAAUjuB,OAAOuE,IAGnB8iB,EAAI2C,QAAU,SAAUhrD,GACtBglC,EAAe,QAAS,gCAAiChlC,EAAEpI,OAAOkE,OAClEusD,EAAIpP,QACJgW,GAAUjuB,OAAOuE,IAUnB,IAOIwjB,EACAQ,EACAH,EACAiH,EAVAtJ,EAAMsB,EAAIE,YAAY,CACxBxC,GACAE,GACAN,IACC,aAECsM,GAAgB,EAMpB,SAASC,SACoB,IAAhB9I,GAAgC6I,IAG3C3c,EAAI6T,MAAQ,CACVrzD,KAAMyvC,EACN8qB,WAAYA,EACZjH,YAAaA,GAGf6F,GAAU1zD,IAAIgqC,EAAQ,CACpB8iB,IAAKA,EACLpqD,OAAQq3C,EAAI6T,QAEdh7B,EAAS,KAAMmnB,IAGjB,SAAS6c,IACP,QAAwB,IAAb5I,QAA+C,IAAZR,EAA9C,CAGA,IAAIqJ,EAAc7sB,EAAS,MACvB6sB,KAAerJ,EACjBsH,EAAatH,EAAQqJ,GAErBrJ,EAAQqJ,GAAe/B,EAAapjB,KAEtC8b,EAAQQ,SAAWA,EACnBxC,EAAIE,YAAYlB,IAAYhc,IAAIgf,IAMlChC,EAAIE,YAAYlB,IAAY3vD,IAAI2vD,IAAYmB,UAAY,SAAUlnD,GAChE+oD,EAAU/oD,EAAEpI,OAAOiO,QAAU,CAAE9B,GAAIgiD,IACnCoM,KA36BN,SAAmBpL,EAAKtlD,GACVslD,EAAIE,YAAYtB,IAAW5oD,MAAM,kBACvC5C,MAAMwtD,YAAYI,KAAK,MAAMb,UAAY,SAAUlnD,GACvDyB,EAAGzB,EAAEpI,OAAOiO,SA86BZwsD,CAAUtL,EAAK,SAAU5sD,GACvBovD,EAAWpvD,EACXg4D,MAMGnD,KAEHA,GAr9BN,SAA0BjI,GACxB,OAAO,IAAIh6B,QAAQ,SAAU1nB,GAC3B,IAAIitD,EAAUjoB,GAAW,CAAC,KACtB3C,EAAMqf,EAAIE,YAAYhB,IAA2Blc,IAAIuoB,EAAS,OAElE5qB,EAAIwf,UAAY,WACd,IAAIqL,EAAgB51B,UAAUC,UAAUp2B,MAAM,iBAC1CgsD,EAAc71B,UAAUC,UAAUp2B,MAAM,UAG5CnB,EAAQmtD,IAAgBD,GACtB3sD,SAAS2sD,EAAc,GAAI,KAAO,KAGtC7qB,EAAI6iB,QAAUxD,EAAIiE,QAAU,SAAUhrD,GAGpCA,EAAEuhB,iBACFvhB,EAAEiJ,kBACF5D,GAAQ,MAET8xC,MAAM,WACP,OAAO,IA+7BgBsb,CAAiB1L,IAGxCiI,GAAmBhuC,KAAK,SAAU5K,GAChCgzC,EAAchzC,EACd87C,MAKFnL,EAAImE,WAAa,WACf+G,GAAgB,EAChBC,KAEFnL,EAAIiE,QAAU5E,GAASj4B,IAGzBuZ,EAAI6iB,QAAU,WACZ,IAAIvlD,EAAM,8DACVggC,EAAe,QAAShgC,GACxBmpB,EAASmZ,GAAYH,GAAWniC,KA3tBhCxM,CAAK88C,EAAKlsB,EAAMkmC,IACfnhC,EAAUmnB,EAAI53C,aA8tBnByxD,GAASh9B,MAAQ,WAMf,IAGE,MAA4B,oBAAd8+B,WAAoD,oBAAhBtJ,YAClD,MAAO3nD,GACP,OAAO,IA4DX,IAAI0yD,GAAqB,GACrBC,GAAwB,GACxBC,GAAyB,IACzBC,GAAoB,IAEpBC,GAAqB,GAEzB,SAASC,GAA8Bvb,GACrC,IAAI1P,EAAM0P,EAAI1P,KAAO0P,EAAItU,GACrBsW,EAAO1R,GAAOA,EAAIM,aACjBoR,GAGLvjD,OAAOmH,KAAKo8C,GAAMzyC,QAAQ,SAAUqkD,GAClC,IAAIjjB,EAAMqR,EAAK4R,GACfjjB,EAAIvpC,KAAOmsC,GAAa5C,EAAIvpC,KAAMupC,EAAIsN,gBAI1C,SAASud,GAAYjvD,GACnB,MAAI,WAAWuC,KAAKvC,GACX,WAAamD,mBAAmBnD,EAAG+D,MAAM,IAE9C,UAAUxB,KAAKvC,GACV,UAAYmD,mBAAmBnD,EAAG+D,MAAM,IAE1CZ,mBAAmBnD,GAG5B,SAASkvD,GAAwBnrB,GAC/B,OAAKA,EAAIM,cAAiBnyC,OAAOmH,KAAK0qC,EAAIM,cAInCrb,QAAQ0qB,IAAIxhD,OAAOmH,KAAK0qC,EAAIM,cAAcvjC,IAAI,SAAU/N,GAC7D,IAAI25D,EAAa3oB,EAAIM,aAAatxC,GAClC,GAAI25D,EAAW7xD,MAAmC,iBAApB6xD,EAAW7xD,KACvC,OAAO,IAAImuB,QAAQ,SAAU1nB,GAC3BumC,GAAa6kB,EAAW7xD,KAAMyG,KAC7B2b,KAAK,SAAUgqB,GAChBylB,EAAW7xD,KAAOosC,OATfje,QAAQ1nB,UAyBnB,SAAS6tD,GAAQp9D,EAAMszB,GAErB,GAZF,SAAsBA,GACpB,IAAKA,EAAKypB,OACR,OAAO,EAET,IAAI7d,EAAWiU,GAAS7f,EAAKypB,QAAQ7d,SACrC,MAAoB,SAAbA,GAAoC,UAAbA,EAO1Bm+B,CAAa/pC,GAAO,CACtB,IAAImc,EAASnc,EAAKtzB,KAAKwiB,OAAO8Q,EAAKypB,OAAOh5C,QAG1C/D,EADaszB,EAAKypB,OAAO1rC,QAAQ,OAAQ,KACzBD,mBAAmBq+B,GAGrC,IAAI9hC,EAAMwlC,GAASnzC,IACf2N,EAAI2vD,MAAQ3vD,EAAI4vD,YAClB5vD,EAAIyxB,KAAO,CAACo+B,SAAU7vD,EAAI2vD,KAAMC,SAAU5vD,EAAI4vD,WAKhD,IAAIzrD,EAAQnE,EAAIiM,KAAKvI,QAAQ,aAAc,IAAIU,MAAM,KAUrD,OARApE,EAAI2/B,GAAKx7B,EAAM5K,OAEc,IAAzByG,EAAI2/B,GAAGp8B,QAAQ,OACjBvD,EAAI2/B,GAAKl8B,mBAAmBzD,EAAI2/B,KAGlC3/B,EAAIiM,KAAO9H,EAAM9C,KAAK,KAEfrB,EAIT,SAAS8vD,GAASnqC,EAAM1Z,GACtB,OAAO8jD,GAAOpqC,EAAMA,EAAKga,GAAK,IAAM1zB,GAItC,SAAS8jD,GAAOpqC,EAAM1Z,GAGpB,IAAI+jD,EAAWrqC,EAAK1Z,KAAY,IAAL,GAI3B,OAAO0Z,EAAK4L,SAAW,MAAQ5L,EAAK+L,MAC5B/L,EAAKgM,KAAQ,IAAMhM,EAAKgM,KAAQ,IACjC,IAAMhM,EAAK1Z,KAAO+jD,EAAU/jD,EAGrC,SAASgkD,GAAYC,GACnB,MAAO,IAAM19D,OAAOmH,KAAKu2D,GAAQ9uD,IAAI,SAAU8C,GAC7C,OAAOA,EAAI,IAAMT,mBAAmBysD,EAAOhsD,MAC1C7C,KAAK,KAcV,SAAS8uD,GAAUxqC,EAAM+E,GAGvB,IAAImnB,EAAM78C,KAEN08B,EAAO+9B,GAAQ9pC,EAAKtzB,KAAMszB,GAC1ByqC,EAAQN,GAASp+B,EAAM,IAE3B/L,EAAOiY,EAAMjY,GAEb,IAuFI0qC,EAvFAC,EAAW,SAAUp9B,EAAK/1B,GAO5B,IALAA,EAAUA,GAAW,IACbozD,QAAUpzD,EAAQozD,SAAW,IAAI77B,GAEzCv3B,EAAQqzD,YAAc,UAElB7qC,EAAK8L,MAAQC,EAAKD,KAAM,CAC1B,IAAIg/B,EAAQ9qC,EAAK8L,MAAQC,EAAKD,KAC1Bxc,EAAMw7C,EAAMZ,SAAW,IAAMY,EAAMb,SACnCc,EAAQhqB,GAASpkB,SAAS7e,mBAAmBwR,KACjD9X,EAAQozD,QAAQz4D,IAAI,gBAAiB,SAAW44D,GAGlD,IAAIH,EAAU5qC,EAAK4qC,SAAW,GAW9B,OAVA/9D,OAAOmH,KAAK42D,GAASjtD,QAAQ,SAAUjQ,GACrC8J,EAAQozD,QAAQxtC,OAAO1vB,EAAKk9D,EAAQl9D,MArC1C,SAAyBsyB,GACvB,IAAIgrC,EAA2B,oBAAdz3B,WAA6BA,UAAUC,UACpDD,UAAUC,UAAUjmB,cAAgB,GACpC09C,GAA+B,IAAxBD,EAAGptD,QAAQ,QAClBstD,GAAuC,IAA3BF,EAAGptD,QAAQ,WACvButD,GAAiC,IAAxBH,EAAGptD,QAAQ,QACpBwtD,IAAU,WAAYprC,IAAyB,QAAhBA,EAAKzoB,OACxC,OAAQ0zD,GAAQC,GAAaC,IAAWC,EAkClCC,CAAgB7zD,KAClB+1B,KAA8B,IAAtBA,EAAI3vB,QAAQ,KAAc,IAAM,KAAO,UAAYyjB,KAAKiqC,QAGnDtrC,EAAKoxB,OAASD,IACb5jB,EAAK/1B,IAGvB,SAAS+zD,EAAc7+D,EAAM6L,GAC3B,OAAOugC,EAAWpsC,EAAM,IAAa,SAAUgC,GAC7C88D,IAAQ5zC,KAAK,WACX,OAAOrf,EAAIhK,MAAMc,KAAMX,KACtBq/C,MAAM,SAAUn3C,GACFlI,EAAKkF,KACpBmxB,CAASnuB,QAETjJ,KAAKu+C,GAGX,SAASuf,EAAUl+B,EAAK/1B,EAASutB,GAE/B,IAAItoB,EAAS,GAYb,OAVAjF,EAAUA,GAAW,IACbozD,QAAUpzD,EAAQozD,SAAW,IAAI77B,GAEpCv3B,EAAQozD,QAAQ59D,IAAI,iBACvBwK,EAAQozD,QAAQz4D,IAAI,eAAgB,oBAEjCqF,EAAQozD,QAAQ59D,IAAI,WACvBwK,EAAQozD,QAAQz4D,IAAI,SAAU,oBAGzBw4D,EAASp9B,EAAK/1B,GAASogB,KAAK,SAAU8zC,GAG3C,OAFAjvD,EAAOq9B,GAAK4xB,EAAS5xB,GACrBr9B,EAAOy/B,OAASwvB,EAASxvB,OAClBwvB,EAAS3O,SACfnlC,KAAK,SAAUmlC,GAEhB,GADAtgD,EAAOjH,KAAOunD,GACTtgD,EAAOq9B,GAAI,CACdr9B,EAAOjH,KAAK0mC,OAASz/B,EAAOy/B,OAC5B,IAAItpC,EAAMwrC,GAA0B3hC,EAAOjH,MAC3C,GAAIuvB,EACF,OAAOA,EAASnyB,GAEhB,MAAMA,EAcV,GAVId,MAAM2L,QAAQhB,EAAOjH,QACvBiH,EAAOjH,KAAOiH,EAAOjH,KAAKiG,IAAI,SAAUnE,GACtC,OAAIA,EAAE5E,OAAS4E,EAAEs1C,QACRxO,GAA0B9mC,GAE1BA,MAKTytB,EAGF,OAAOtoB,EAFPsoB,EAAS,KAAMtoB,EAAOjH,QAS5B,SAASg2D,IACP,OAAIxrC,EAAK2rC,WACAhoC,QAAQ1nB,UAMbyuD,KAIJA,EAAee,EAAUhB,GAAO1c,MAAM,SAAUn7C,GAC9C,OAAIA,GAAOA,EAAIspC,QAAyB,MAAftpC,EAAIspC,QAE3BD,EAAa,IAAK,mDACXwvB,EAAUhB,EAAO,CAAClzD,OAAQ,SAE1BosB,QAAQC,OAAOhxB,KAEvBm7C,MAAM,SAAUn7C,GAIjB,SAAIA,IAAOA,EAAIspC,QAAyB,MAAftpC,EAAIspC,SAGtBvY,QAAQC,OAAOhxB,MAGXm7C,MAAM,WACjB2c,EAAe,OAGVA,GA2TT,SAASkB,EAAmB5f,GAC1B,OAAOA,EAAavtC,MAAM,KAAKhD,IAAIqC,oBAAoBpC,KAAK,KAzT9D,IAAU,WACRqpB,EAAS,KAAMmnB,KAGjBA,EAAI5M,SAAU,EAGd4M,EAAIp8C,KAAO,WACT,MAAO,QAGTo8C,EAAIvxC,GAAK4wD,EAAc,KAAM,SAAUxmC,GACrC4lC,EAASP,GAAOr+B,EAAM,KAAKnU,KAAK,SAAU8zC,GACxC,OAAOA,EAAS3O,SACfhP,MAAM,WACP,MAAO,KACNn2B,KAAK,SAAUnb,GAEhB,IAAIovD,EAAWpvD,GAAUA,EAAOonC,KAC3BpnC,EAAOonC,KAAO9X,EAAKiO,GAAMmwB,GAASp+B,EAAM,IAC7ChH,EAAS,KAAM8mC,OAMnB3f,EAAI0B,QAAU2d,EAAc,UAAW,SAAUvrC,EAAM+E,GACjC,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,IAETA,EAAOiY,EAAMjY,GAEbyrC,EAAUtB,GAASp+B,EAAM,YAAa,CAACx0B,OAAQ,SAASqgB,KAAK,YAC3D,SAASk0C,IACP5f,EAAIhzB,KAAK,SAAUtmB,EAAK2I,GAIlBA,IAAQA,EAAIwwD,gBACdhnC,EAAS,KAAM,CAAC+U,IAAI,IAEpB5jC,WAAW41D,EAAM9rC,EAAKgsC,UAAY,OAKxCF,OAIJ5f,EAAInS,QAAUjB,EAAW,UAAW,SAAU9Y,EAAM+E,GAClD,IAAIhtB,EAAO1I,KAEX,SAAS48D,EAAU5zD,GACjB,IAAIkyD,EAAS,GACTvqC,EAAK0kB,OACP6lB,EAAO7lB,MAAO,GAEZ1kB,EAAK8e,cAEPyrB,EAAOzrB,aAAc,GAEnB9e,EAAKwuB,SACP+b,EAAO/b,QAAS,GAElBid,EAAUtB,GAASp+B,EAAM,YAAcu+B,GAAYC,IAAU,CAC3DhzD,OAAQ,OACR0I,KAAM5C,KAAKC,UAAU,CAAE48B,KAAMla,EAAKka,SACjCtiB,KAAK,SAAUnb,GACZujB,EAAK8e,aAAe9e,EAAKmiB,QAC3B1lC,EAAOjH,KAAKilC,QAAQ98B,QAAQ,SAAUpC,GACpCA,EAAI2+B,KAAKv8B,QAAQgsD,MAGrBtxD,EAAG,KAAMoE,EAAOjH,QACfu4C,MAAM11C,GAIX,SAAS6zD,IAEP,IAAIvJ,EAAY4G,GACZ4C,EAAa7qD,KAAK6hC,KAAKnjB,EAAKka,KAAKzpC,OAASkyD,GAC1CroB,EAAU,EACVG,EAAU,IAAI3oC,MAAMq6D,GAExB,SAASC,EAASC,GAChB,OAAO,SAAUz5D,EAAK2I,GAEpBk/B,EAAQ4xB,GAAY9wD,EAAIk/B,UAClBH,IAAY6xB,GAChBpnC,EAAS,KAAM,CAAC0V,QAASyE,GAAQzE,MAKvC,IAAK,IAAItuC,EAAI,EAAGA,EAAIggE,EAAYhgE,IAAK,CACnC,IAAImgE,EAAU7yB,EAAKzZ,EAAM,CAAC,OAAQ,cAAe,SAAU,WAC3DssC,EAAQpyB,KAAOla,EAAKka,KAAKx7B,MAAMvS,EAAIw2D,EACjCrhD,KAAKoB,IAAIsd,EAAKka,KAAKzpC,QAAStE,EAAI,GAAKw2D,IACvC5oB,EAAQhiC,EAAMu0D,EAASF,EAASjgE,KAKpC,IAAIs+D,EAAQL,GAAOr+B,EAAM,IACrBwgC,EAAkB7C,GAAmBe,GAGV,kBAApB8B,EAETN,EAAU,SAAUr5D,EAAK2I,GACnB3I,GACF82D,GAAmBe,IAAS,EAC5BxuB,EACErpC,EAAIspC,OACJ,uEAGFgwB,MAEAxC,GAAmBe,IAAS,EAC5B1lC,EAAS,KAAMxpB,MAGVgxD,EACTN,EAAUlnC,GAEVmnC,MAOJhgB,EAAI6D,MAAQ,SAAUhrB,GACpBymC,IAAQ5zC,KAAK,WACX,OAAO+yC,EAASR,GAASp+B,EAAM,OAC9BnU,KAAK,SAAU8zC,GAChB,OAAOA,EAAS3O,SACfnlC,KAAK,SAAUsB,GAChBA,EAAK6S,KAAOo+B,GAASp+B,EAAM,IAC3BhH,EAAS,KAAM7L,KACd60B,MAAMhpB,IAGXmnB,EAAIkF,MAAQ,SAAU9qC,EAAM9O,GAC1B,OAAOg0D,IAAQ5zC,KAAK,WAClB,IAAI2V,EAA+B,MAAzBjnB,EAAKiW,UAAU,EAAG,GAC1B6tC,GAAOr+B,EAAMzlB,EAAKiW,UAAU,IAC5B4tC,GAASp+B,EAAMzlB,GACjB,OAAOqkD,EAASp9B,EAAK/1B,MAOzB00C,EAAIl/C,IAAMu+D,EAAc,MAAO,SAAU5wD,EAAIqlB,EAAM+E,GAE7B,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,IAKT,IAAIuqC,EAAS,GAoCb,SAASiC,EAAiB9tB,GACxB,IAAI0R,EAAO1R,EAAIM,aACXytB,EAAYrc,GAAQvjD,OAAOmH,KAAKo8C,GACpC,GAAKA,GAASqc,EAAUh8D,OA4CxB,OA3iBN,SAAci8D,EAAkBx3C,GAC9B,OAAO,IAAIyO,QAAQ,SAAU1nB,EAAS2nB,GACpC,IAIIhxB,EAJAiyD,EAAU,EACVn8B,EAAU,EACV4a,EAAO,EACPtwC,EAAM05D,EAAiBj8D,OAQ3B,SAASk8D,MACDrpB,IAAStwC,EAETJ,EACFgxB,EAAOhxB,GAEPqJ,IAGF2wD,IAIJ,SAAS1I,IACPW,IACA8H,IAIF,SAASE,EAAQC,GACfjI,IACAjyD,EAAMA,GAAOk6D,EACbH,IAGF,SAASC,IACP,KAAO/H,EAAU3vC,GAASwT,EAAU11B,GA9BpC6xD,IACA6H,EAAiBhkC,OAAa9Q,KAAKssC,EAAW2I,GAkChDD,MA+fSG,CARgBN,EAAUhxD,IAAI,SAAUumD,GAC7C,OAAO,WACL,OA/BJ,SAAmBA,GACjB,IAAIjjB,EAAMqR,EAAK4R,GACX17C,EAAOsjD,GAAYlrB,EAAIgC,KAAO,IAAMkrB,EAAmB5J,GACvD,QAAUtjB,EAAI6B,KAClB,OAAOoqB,EAASR,GAASp+B,EAAMzlB,IAAOsR,KAAK,SAAU8zC,GACnD,YAAuB,IAAZhzD,GAA4BA,EAAQiB,QAItC+xD,EAAS5pB,OAHT4pB,EAAS3+C,WAKjB6K,KAAK,SAAUkqB,GAChB,OAAI9hB,EAAKmiB,aAEgB,IAAZzpC,GAA4BA,EAAQiB,UAC7CmoC,EAAKhyC,KAAOivC,EAAIsN,cAEXvK,GAEF,IAAIne,QAAQ,SAAU1nB,GAC3BumC,GAAaV,EAAM7lC,OAEpB2b,KAAK,SAAUpiB,UACTupC,EAAIE,YACJF,EAAItuC,OACXsuC,EAAIvpC,KAAOA,IAMJw3D,CAAUhL,MAMS,IAtFhChiC,EAAOiY,EAAMjY,IAKJ0kB,OACP6lB,EAAO7lB,MAAO,GAGZ1kB,EAAK0uB,YACP6b,EAAO7b,WAAY,GAGjB1uB,EAAKwuB,SACP+b,EAAO/b,QAAS,GAGdxuB,EAAKkb,YACgB,QAAnBlb,EAAKkb,YACPlb,EAAKkb,UAAY79B,KAAKC,UAAU0iB,EAAKkb,YAEvCqvB,EAAOrvB,UAAYlb,EAAKkb,WAGtBlb,EAAKmb,MACPovB,EAAOpvB,IAAMnb,EAAKmb,KAGhBnb,EAAKqlB,YACPklB,EAAOllB,UAAYrlB,EAAKqlB,WAItBrlB,EAAKkrB,aACPqf,EAAOrf,WAAalrB,EAAKkrB,YAG3BvwC,EAAKivD,GAAYjvD,GAgEjB8wD,EADUtB,GAASp+B,EAAMpxB,EAAK2vD,GAAYC,KAC3B3yC,KAAK,SAAUrc,GAC5B,OAAOooB,QAAQ1nB,UAAU2b,KAAK,WAC5B,GAAIoI,EAAK8e,YACP,OAfuBmuB,EAeI1xD,EAAI/F,KAd/B1D,MAAM2L,QAAQwvD,GACTtpC,QAAQ0qB,IAAI4e,EAAUxxD,IAAI,SAAUijC,GACzC,GAAIA,EAAI5E,GACN,OAAO0yB,EAAiB9tB,EAAI5E,OAI3B0yB,EAAiBS,GAR1B,IAA6BA,IAiBxBr1C,KAAK,WACNmN,EAAS,KAAMxpB,EAAI/F,UAEpBu4C,MAAM,SAAUn3C,GACjBA,EAAEkkC,MAAQngC,EACVoqB,EAASnuB,OAMbs1C,EAAI/rC,OAASorD,EAAc,SAAU,SAAU/e,EAASC,EAAWzsB,EAAM3nB,GACvE,IAAIqmC,EACqB,iBAAd+N,GAET/N,EAAM,CACJgC,IAAK8L,EACLjM,KAAMkM,GAEY,mBAATzsB,IACT3nB,EAAK2nB,EACLA,EAAO,MAIT0e,EAAM8N,EACmB,mBAAdC,GACTp0C,EAAKo0C,EACLzsB,EAAO,KAEP3nB,EAAK2nB,EACLA,EAAOysB,IAIX,IAAIR,EAAUvN,EAAI6B,MAAQvgB,EAAKmb,IAG/BswB,EAFUtB,GAASp+B,EAAM69B,GAAYlrB,EAAIgC,MAAQ,QAAUuL,EAE5C,CAAC10C,OAAQ,UAAWc,GAAI01C,MAAM11C,KAQ/C6zC,EAAIiD,cAAgBoc,EAAc,gBAAiB,SAAUzwB,EAAOkR,EACVhsB,EAAM+E,GAC1C,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,IAET,IAGIktC,EAHA3C,EAASvqC,EAAKmb,IAAO,QAAUnb,EAAKmb,IAAO,GAC3C5N,EAAM48B,GAASp+B,EAAM69B,GAAY9uB,IAAU,IAC3C8wB,EAAmB5f,GAAgBue,EAEvCI,EAASp9B,EAAK,CAACh2B,OAAQ,QAAQqgB,KAAK,SAAU8zC,GAE5C,GADAwB,EAAcxB,EAASd,QAAQ59D,IAAI,gBAC9B0+D,EAAS5xB,GAGZ,YAAuB,IAAZphC,GAA4BA,EAAQiB,QAItC+xD,EAAS5pB,OAHT4pB,EAAS3+C,SAHlB,MAAM2+C,IASP9zC,KAAK,SAAUkqB,QAEO,IAAZppC,GAA4BA,EAAQiB,UAC7CmoC,EAAKhyC,KAAOo9D,GAEdnoC,EAAS,KAAM+c,KACdiM,MAAM,SAAUn7C,GACjBmyB,EAASnyB,OAKbs5C,EAAIK,iBAAoBgf,EAAc,mBAAoB,SAAUzwB,EACHkR,EACAC,EACAlnB,GAG/D0mC,EAFUtB,GAASp+B,EAAM69B,GAAY9uB,GAAS,IAC3B8wB,EAAmB5f,IAAiB,QAAUC,EAClD,CAAC10C,OAAQ,UAAWwtB,GAAUgpB,MAAMhpB,KAMrDmnB,EAAIH,cAAgBwf,EAAc,gBAAiB,SAAUzwB,EAAOkR,EACVC,EAAQnK,EACRhyC,EAAMi1B,GAC1C,mBAATj1B,IACTi1B,EAAWj1B,EACXA,EAAOgyC,EACPA,EAAOmK,EACPA,EAAS,MAEX,IAAItxC,EAAKivD,GAAY9uB,GAAS,IAAM8wB,EAAmB5f,GACnDze,EAAM48B,GAASp+B,EAAMpxB,GAKzB,GAJIsxC,IACF1e,GAAO,QAAU0e,GAGC,iBAATnK,EAAmB,CAE5B,IAAIK,EACJ,IACEA,EAAStB,GAASiB,GAClB,MAAOlvC,GACP,OAAOmyB,EAASmZ,GAAYR,EACZ,4CAElBoE,EAAOK,EAASV,GAAmBU,EAAQryC,GAAQ,GAIrD27D,EAAUl+B,EAAK,CACbq9B,QAAS,IAAI77B,GAAE,CAAC,eAAgBj/B,IAChCyH,OAAQ,MACR0I,KAAM6hC,GACL/c,GAAUgpB,MAAMhpB,KAKrBmnB,EAAIoE,UAAY,SAAUhS,EAAKte,EAAM+E,GAInCuZ,EAAIuN,UAAY7rB,EAAK6rB,UAErB2f,IAAQ5zC,KAAK,WACX,OAAO+L,QAAQ0qB,IAAI/P,EAAIpE,KAAKz+B,IAAIouD,OAC/BjyC,KAAK,WAEN,OAAO6zC,EAAUtB,GAASp+B,EAAM,cAAe,CAC7Cx0B,OAAQ,OACR0I,KAAM5C,KAAKC,UAAUghC,IACpBvZ,KACFgpB,MAAMhpB,IAKXmnB,EAAIN,KAAO,SAAUlN,EAAK1e,EAAM+E,GAC9BymC,IAAQ5zC,KAAK,WACX,OAAOiyC,GAAwBnrB,KAC9B9mB,KAAK,WACN,OAAO6zC,EAAUtB,GAASp+B,EAAM69B,GAAYlrB,EAAIgC,MAAO,CACrDnpC,OAAQ,MACR0I,KAAM5C,KAAKC,UAAUohC,OAEtB9mB,KAAK,SAAUnb,GAChBsoB,EAAS,KAAMtoB,EAAOjH,QACrBu4C,MAAM,SAAUn7C,GACjBA,EAAIkoC,MAAQ4D,GAAOA,EAAIgC,IACvB3b,EAASnyB,MAObs5C,EAAIkD,QAAUmc,EAAc,UAAW,SAAUvrC,EAAM+E,GACjC,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,IAKT,IACI/f,EADAsqD,EAAS,GAEThzD,EAAS,OALbyoB,EAAOiY,EAAMjY,IAOJqlB,YACPklB,EAAOllB,WAAY,GAIjBrlB,EAAKkrB,aACPqf,EAAOrf,YAAa,GAGlBlrB,EAAK+qB,aACPwf,EAAOxf,YAAa,GAGlB/qB,EAAK6e,eACP0rB,EAAO1rB,cAAe,GAIpB7e,EAAK8e,cACPyrB,EAAOzrB,aAAc,GAGnB9e,EAAKtyB,MACP68D,EAAO78D,IAAM2P,KAAKC,UAAU0iB,EAAKtyB,MAG/BsyB,EAAKsvB,YACPtvB,EAAKuvB,SAAWvvB,EAAKsvB,WAGnBtvB,EAAKuvB,WACPgb,EAAOhb,SAAWlyC,KAAKC,UAAU0iB,EAAKuvB,WAGpCvvB,EAAKwvB,UACPxvB,EAAKyvB,OAASzvB,EAAKwvB,SAGjBxvB,EAAKyvB,SACP8a,EAAO9a,OAASpyC,KAAKC,UAAU0iB,EAAKyvB,cAGJ,IAAvBzvB,EAAK6jC,gBACd0G,EAAO1G,gBAAkB7jC,EAAK6jC,oBAGN,IAAf7jC,EAAK9K,QACdq1C,EAAOr1C,MAAQ8K,EAAK9K,YAGG,IAAd8K,EAAKqvB,OACdkb,EAAOlb,KAAOrvB,EAAKqvB,MAGrB,IAAI8d,EAAW7C,GAAYC,QAEF,IAAdvqC,EAAKhsB,OACduD,EAAS,OACT0I,EAAO,CAACjM,KAAMgsB,EAAKhsB,OAGrBy3D,EAAUtB,GAASp+B,EAAM,YAAcohC,GAAW,CAC/C51D,OAAQA,EACT0I,KAAM5C,KAAKC,UAAU2C,KACpB2X,KAAK,SAAUnb,GACZujB,EAAK6e,cAAgB7e,EAAK8e,aAAe9e,EAAKmiB,QAChD1lC,EAAOjH,KAAKghD,KAAK74C,QAAQgsD,IAE3B5kC,EAAS,KAAMtoB,EAAOjH,QACrBu4C,MAAMhpB,KAMXmnB,EAAIjB,SAAW,SAAUjrB,GAMvB,IAAI2iC,EAAY,eAAgB3iC,EAAOA,EAAKotC,WAAa9D,KAEzDtpC,EAAOiY,EAAMjY,IAEJ2qB,YAAgB,cAAe3qB,IACtCA,EAAKqtC,UAAY5D,IAGnB,IAAI6D,EAAkB,YAAattC,EAAQA,EAAK7mB,QAAU,IAGtD,YAAa6mB,GAAQA,EAAK7mB,SAC3Bm0D,EAAiBttC,EAAK7mB,QAAWqwD,KAChC8D,EAAiBttC,EAAK7mB,QAAUqwD,IAIhC,cAAexpC,GAAQA,EAAKqtC,WAC5BC,EAAiBttC,EAAKqtC,UAAa7D,KACnC8D,EAAiBttC,EAAKqtC,UAAY7D,IAGtC,IAAIe,EAAS,GACT,YAAavqC,GAAQA,EAAK7mB,UAC5BoxD,EAAOpxD,QAAU6mB,EAAK7mB,SAGxB,IAAI+b,OAA+B,IAAf8K,EAAK9K,OAAyB8K,EAAK9K,MACnDq4C,EAAcr4C,EAqDlB,GAnDI8K,EAAK9e,QACPqpD,EAAOrpD,MAAQ8e,EAAK9e,QAGlB8e,EAAK6e,cAAgB7e,EAAKxX,QAAiC,mBAAhBwX,EAAKxX,UAClD+hD,EAAO1rB,cAAe,GAGpB7e,EAAK8e,cACPyrB,EAAOzrB,aAAc,GAGnB9e,EAAK2qB,aACP4f,EAAOiD,KAAO,YAGZxtC,EAAKytC,eACPlD,EAAOkD,aAAeztC,EAAKytC,cAGzBztC,EAAKqlB,YACPklB,EAAOllB,WAAY,GAGjBrlB,EAAK+qB,aACPwf,EAAOxf,YAAa,GAIlB/qB,EAAKkrB,aACPqf,EAAOrf,YAAa,GAGlB,cAAelrB,GAEbA,EAAKqtC,YACP9C,EAAO8C,UAAYrtC,EAAKqtC,WAIxBrtC,EAAKxX,QAAiC,iBAAhBwX,EAAKxX,SAC7B+hD,EAAO/hD,OAASwX,EAAKxX,QAGnBwX,EAAKpb,MAA6B,iBAAdob,EAAKpb,OAC3B2lD,EAAO/hD,OAAS,QAChB+hD,EAAO3lD,KAAOob,EAAKpb,MAKjBob,EAAKwe,cAA6C,iBAAtBxe,EAAKwe,aACnC,IAAK,IAAIkvB,KAAc1tC,EAAKwe,aAEtBxe,EAAKwe,aAAaxwC,eAAe0/D,KACnCnD,EAAOmD,GAAc1tC,EAAKwe,aAAakvB,IAK7C,IACIztD,EADA1I,EAAS,MAGTyoB,EAAKy4B,SAGP8R,EAAO/hD,OAAS,WAChBjR,EAAS,OACT0I,EAAO,CAACw4C,QAASz4B,EAAKy4B,UAGfz4B,EAAKxF,WAEZ+vC,EAAO/hD,OAAS,YAChBjR,EAAS,OACT0I,EAAO,CAACua,SAAUwF,EAAKxF,WAGzB,IACImzC,EADAC,EAAa,IAAI3vD,GAKjB+uD,EAAY,SAAUvwB,EAAO1X,GAC/B,IAAI/E,EAAK6tC,QAAT,CAGAtD,EAAO9tB,MAAQA,EAGa,iBAAjB8tB,EAAO9tB,QAChB8tB,EAAO9tB,MAAQp/B,KAAKC,UAAUitD,EAAO9tB,QAGnCzc,EAAK+qB,WACH71B,IACFq1C,EAAOr1C,MAAQq4C,GAGjBhD,EAAOr1C,OAAUA,GAASq4C,EAAc5K,EACtCA,EAAY4K,EAIhB,IAAIhgC,EAAM48B,GAASp+B,EAAM,WAAau+B,GAAYC,IAC9CuD,EAAY,CACdC,OAAQH,EAAWG,OACnBx2D,OAAQA,EACR0I,KAAM5C,KAAKC,UAAU2C,IAEvB0tD,EAAiBlxB,EAGbzc,EAAK6tC,SAKTrC,IAAQ5zC,KAAK,WACX,OAAO6zC,EAAUl+B,EAAKugC,EAAW/oC,KAChCgpB,MAAMhpB,KAMP0V,EAAU,CAACA,QAAS,IAEpBuzB,EAAU,SAAUp7D,EAAK2I,GAC3B,IAAIykB,EAAK6tC,QAAT,CAGA,IAAII,EAAqB,EAEzB,GAAI1yD,GAAOA,EAAIk/B,QAAS,CACtBwzB,EAAqB1yD,EAAIk/B,QAAQhqC,OACjCgqC,EAAQuT,SAAWzyC,EAAIyyC,SACvB,IAAI1F,EAAU,KACVC,EAAU,KAGa,iBAAhBhtC,EAAI+sC,UACbA,EAAU/sC,EAAI+sC,SAEgB,iBAArB7N,EAAQuT,UAAqD,iBAArBvT,EAAQuT,WACzDzF,EAAU9N,EAAQuT,UAIRhuB,EAAKwe,aACjBjjC,EAAIk/B,QAAUl/B,EAAIk/B,QAAQjyB,OAAO,SAAUhc,GACzC+gE,IACA,IAAI17D,EAAMwsC,GAAare,EAAbqe,CAAmB7xC,GAU7B,OATIqF,IACEmuB,EAAK6e,cAAgB7e,EAAK8e,aAAe9e,EAAKmiB,QAChDwnB,GAA8Bn9D,GAE5BwzB,EAAKkuB,aACPzT,EAAQA,QAAQjqC,KAAKhE,GAEvBwzB,EAAK2c,SAASnwC,EAAG87C,EAASC,IAErB12C,SAEJ,GAAIe,EAKT,OAFAotB,EAAK6tC,SAAU,OACf7tC,EAAKkoB,SAASt1C,GAMZ2I,GAAOA,EAAIyyC,WACb2f,EAAiBpyD,EAAIyyC,UAGvB,IAAI3nB,EAAYnR,GAASq4C,GAAe,GACrChyD,GAAO0yD,EAAqBtL,GAC5B3iC,EAAe,aAEbA,EAAK2qB,YAAgBz1B,GAASq4C,GAAe,IAAQlnC,EAKxDrG,EAAKkoB,SAAS,KAAMzN,GAHpB,IAAU,WAAcuyB,EAAUW,EAAgBK,OAUtD,OAHAhB,EAAUhtC,EAAKyc,OAAS,EAAGuxB,GAGpB,CACL3lB,OAAQ,WACNroB,EAAK6tC,SAAU,EACfD,EAAW1c,WAQjBhF,EAAIS,SAAW4e,EAAc,WAAY,SAAUjtB,EAAKte,EAAM+E,GAExC,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,IAITyrC,EAAUtB,GAASp+B,EAAM,cAAe,CACtCx0B,OAAQ,OACR0I,KAAM5C,KAAKC,UAAUghC,IACpBvZ,GAAUgpB,MAAMhpB,KAGrBmnB,EAAI4D,OAAS,SAAU/qB,GACrBA,KAGFmnB,EAAI9zC,SAAW,SAAUZ,EAASutB,GAChC0mC,EAAUtB,GAASp+B,EAAM,IAAK,CAACx0B,OAAQ,WAAWqgB,KAAK,SAAUmlC,GAC/Dh4B,EAAS,KAAMg4B,KACdhP,MAAM,SAAUn7C,GAEE,MAAfA,EAAIspC,OACNnX,EAAS,KAAM,CAAC+U,IAAI,IAEpB/U,EAASnyB,MAgBjB,SAASs7D,GAAgBr7D,GACvBxD,KAAK6sC,OAAS,IACd7sC,KAAK3C,KAAO,oBACZ2C,KAAKwD,QAAUA,EACfxD,KAAKqD,OAAQ,EACb,IACE9B,MAAMiL,kBAAkBxM,KAAM6+D,IAC9B,MAAOt3D,KAKX,SAASu3D,GAAct7D,GACrBxD,KAAK6sC,OAAS,IACd7sC,KAAK3C,KAAO,YACZ2C,KAAKwD,QAAUA,EACfxD,KAAKqD,OAAQ,EACb,IACE9B,MAAMiL,kBAAkBxM,KAAM8+D,IAC9B,MAAOv3D,KAKX,SAASw3D,GAAav7D,GACpBxD,KAAK6sC,OAAS,IACd7sC,KAAK3C,KAAO,gBACZ2C,KAAKwD,QAAUA,EACfxD,KAAKqD,OAAQ,EACb,IACE9B,MAAMiL,kBAAkBxM,KAAM++D,IAC9B,MAAOx3D,KAKX,SAASy3D,GAAiB3qC,EAASqB,GAYjC,OAXIA,GACFrB,EAAQ9L,KAAK,SAAUrc,GACrB,IAAU,WACRwpB,EAAS,KAAMxpB,MAEhB,SAAU6nB,GACX,IAAU,WACR2B,EAAS3B,OAIRM,EA2BT,SAAS4qC,GAAc93D,EAAO+3D,GAC5B,OAAO,WACL,IAAI7/D,EAAO6C,UACP3B,EAAOP,KACX,OAAOmH,EAAM8J,IAAI,WACf,OAAOiuD,EAAehgE,MAAMqB,EAAMlB,MAOxC,SAAS8/D,GAAK58D,GACZ,IAAI68D,EAAS,IAAIz3B,EAAYplC,GACzB6K,EAAS,IAAI3K,MAAM28D,EAAOnnD,MAC1B3T,GAAS,EAIb,OAHA86D,EAAO9wD,QAAQ,SAAUvQ,GACvBqP,IAAS9I,GAASvG,IAEbqP,EAGT,SAASiyD,GAAejzD,GACtB,IAAIgB,EAAS,IAAI3K,MAAM2J,EAAI6L,MACvB3T,GAAS,EAIb,OAHA8H,EAAIkC,QAAQ,SAAUvQ,EAAOM,GAC3B+O,IAAS9I,GAASjG,IAEb+O,EAGT,SAASkyD,GAAmBjiE,GAI1B,OAAO,IAAI0hE,GAHG,WAAa1hE,EACzB,gEAKJ,SAASkiE,GAAIvnD,GAEX,IADA,IAAI5K,EAAS,EACJtQ,EAAI,EAAG6G,EAAMqU,EAAO5W,OAAQtE,EAAI6G,EAAK7G,IAAK,CACjD,IAAI6wB,EAAM3V,EAAOlb,GACjB,GAAmB,iBAAR6wB,EAAkB,CAC3B,IAAIlrB,MAAM2L,QAAQuf,GAchB,MAAM2xC,GAAmB,QAZzBlyD,EAA2B,iBAAXA,EAAsB,CAACA,GAAUA,EACjD,IAAK,IAAImS,EAAI,EAAGigD,EAAO7xC,EAAIvsB,OAAQme,EAAIigD,EAAMjgD,IAAK,CAChD,IAAIkgD,EAAO9xC,EAAIpO,GACf,GAAoB,iBAATkgD,EACT,MAAMH,GAAmB,aACK,IAAdlyD,EAAOmS,GACvBnS,EAAOjM,KAAKs+D,GAEZryD,EAAOmS,IAAMkgD,OAMQ,iBAAXryD,EAChBA,GAAUugB,EAEVvgB,EAAO,IAAMugB,EAGjB,OAAOvgB,EArJT+tD,GAAUzhC,MAAQ,WAChB,OAAO,GAkBT,IAASmlC,GAAiBt9D,OAY1B,IAASu9D,GAAev9D,OAYxB,IAASw9D,GAAcx9D,OA6GvB,IAAIoyB,GAAM4Y,EAAejuC,KAAK,KAAM,OAChC8P,GAAU3L,MAAM2L,QAChB4U,GAAShV,KAAKgvB,MAElB,SAAS0iC,GAAqBt2B,EAAMnoC,GAClC,OAAO4vC,GACL,WAAazH,EAAK16B,QAAQ,QAAS,IAAM,KACzC,CACEzN,KAAMA,EACNs+D,IAAKA,GACL5rC,IAAKA,GACLvlB,QAASA,GACT4U,OAAQA,KAWd,SAAS28C,KACP3/D,KAAKq0B,QAAU,IAAIC,QAAQ,SAAUgV,GAAUA,MAcjD,SAASr7B,GAAUhB,GACjB,IAAKA,EACH,MAAO,YAIT,cAAeA,GACb,IAAK,WAGL,IAAK,SAEH,OAAOA,EAAMzB,WACf,QAEE,OAAOwC,KAAKC,UAAUhB,IAU5B,SAAS2yD,GAAWC,EAAUxW,EAAUE,EAAQuW,EAAWC,EAAWC,GACpE,IAEIC,EAFAC,EANN,SAA6B3W,EAAQuW,GAEnC,OAAO7xD,GAAUs7C,GAAUt7C,GAAU6xD,GAAa,YAI9BK,CAAoB5W,EAAQuW,GAGhD,IAAKC,IAEHE,EAAcJ,EAASO,aAAeP,EAASO,cAAgB,IAC/CF,GACd,OAAOD,EAAYC,GAIvB,IAAIG,EAAiBR,EAASh2C,OAAOtB,KAAK,SAAUsB,GAElD,IAAIy2C,EAAYz2C,EAAK82B,QAAU,YAC5Bof,EAAY,OAAS5rB,GAAU+rB,IAkBlC,OAAOnvB,GAAO8uB,EAAU,UAAYG,EAdpC,SAAsB3wB,GACpBA,EAAIma,MAAQna,EAAIma,OAAS,GACzB,IAAI+W,EAAelX,GACgB,IAA/BkX,EAAahyD,QAAQ,OACvBgyD,EAAelX,EAAW,IAAMA,GAElC,IAAImX,EAASnxB,EAAIma,MAAM+W,GAAgBlxB,EAAIma,MAAM+W,IAAiB,GAElE,IAAIC,EAAOF,GAIX,OADAE,EAAOF,IAAa,EACbjxB,IAEuD9mB,KAAK,WACnE,OAAOs3C,EAAS3e,0BAA0Bof,GAAW/3C,KAAK,SAAUrc,GAClE,IAAIy+B,EAAKz+B,EAAIy+B,GACbA,EAAGwP,iBAAkB,EACrB,IAAI5kC,EAAO,CACTlY,KAAMijE,EACN31B,GAAIA,EACJk1B,SAAUA,EACVvlB,QAASulB,EAASvlB,QAClBiP,OAAQA,EACRuW,UAAWA,GAEb,OAAOvqD,EAAKo1B,GAAGhtC,IAAI,kBAAkB+gD,MAAM,SAAUn7C,GAEnD,GAAmB,MAAfA,EAAIspC,OACN,MAAMtpC,IAEPglB,KAAK,SAAUk4C,GAOhB,OANAlrD,EAAK43B,IAAMszB,EAAaA,EAAWtzB,IAAM,EACrC8yB,GACF1qD,EAAKo1B,GAAG3mC,KAAK,YAAa,kBACjBi8D,EAAYC,KAGhB3qD,UASf,OAHI0qD,IACFA,EAAYC,GAAiBG,GAExBA,EAvGTV,GAAYjhE,UAAUuS,IAAM,SAAUiuD,GAMpC,OALAl/D,KAAKq0B,QAAUr0B,KAAKq0B,QAAQqqB,MAAM,cAE/Bn2B,KAAK,WACN,OAAO22C,MAEFl/D,KAAKq0B,SAEdsrC,GAAYjhE,UAAU82B,OAAS,WAC7B,OAAOx1B,KAAKq0B,SAiGd,IAAIqsC,GAAmB,GACnBC,GAAgB,IAAIhB,GACpBiB,GAAuB,GAE3B,SAASC,GAAcxjE,GAGrB,OAA8B,IAAvBA,EAAKkR,QAAQ,KAAc,CAAClR,EAAMA,GAAQA,EAAK+R,MAAM,KAS9D,SAAS0xD,GAAUn2B,EAAIpjC,GACrB,IACEojC,EAAG1pC,KAAK,QAASsG,GACjB,MAAOhE,GACPgpC,EAAe,QACb,qMAIFA,EAAe,QAAShlC,IA+4B5B,IAAIw5D,GAAgB,CAClBC,KAAM,SAAUr8D,EAAMqT,GACpB,OAAOunD,GAAIvnD,IAGbipD,OAAQ,SAAUt8D,EAAMqT,GACtB,OAAOA,EAAO5W,QAGhB8/D,OAAQ,SAAUv8D,EAAMqT,GAWtB,MAAO,CACLunD,IAAUA,GAAIvnD,GACd3E,IAAUpB,KAAKoB,IAAInU,MAAM,KAAM8Y,GAC/BzE,IAAUtB,KAAKsB,IAAIrU,MAAM,KAAM8Y,GAC/BtW,MAAUsW,EAAO5W,OACjB+/D,OAbF,SAAgBnpD,GAEd,IADA,IAAIopD,EAAU,EACLtkE,EAAI,EAAG6G,EAAMqU,EAAO5W,OAAQtE,EAAI6G,EAAK7G,IAAK,CACjD,IAAI6wB,EAAM3V,EAAOlb,GACjBskE,GAAYzzC,EAAMA,EAEpB,OAAOyzC,EAOED,CAAOnpD,MA+CtB,IACIqpD,GA17BJ,SAAiCrB,EAAcsB,EAAQC,EAASC,GAE9D,SAASC,EAAO92B,EAAIzhC,EAAKmmC,GAGvB,IACEnmC,EAAImmC,GACJ,MAAO9nC,GACPu5D,GAAUn2B,EAAIpjC,IAIlB,SAASm6D,EAAU/2B,EAAIzhC,EAAKvE,EAAMqT,EAAQ2pD,GAKxC,IACE,MAAO,CAAC1vC,OAAS/oB,EAAIvE,EAAMqT,EAAQ2pD,IACnC,MAAOp6D,GAEP,OADAu5D,GAAUn2B,EAAIpjC,GACP,CAAClE,MAAOkE,IAInB,SAASq6D,EAAmBloD,EAAGE,GAC7B,IAAIioD,EAAa7c,GAAQtrC,EAAErb,IAAKub,EAAEvb,KAClC,OAAsB,IAAfwjE,EAAmBA,EAAa7c,GAAQtrC,EAAE3b,MAAO6b,EAAE7b,OAG5D,SAAS+jE,EAAa12B,EAASvlB,EAAOm6B,GAEpC,OADAA,EAAOA,GAAQ,EACM,iBAAVn6B,EACFulB,EAAQ/7B,MAAM2wC,EAAMn6B,EAAQm6B,GAC1BA,EAAO,EACT5U,EAAQ/7B,MAAM2wC,GAEhB5U,EAGT,SAAS22B,EAAWhjB,GAClB,IAAIphC,EAAMohC,EAAIhhD,MAId,OADa4f,GAAsB,iBAARA,GAAoBA,EAAI0zB,KAAQ0N,EAAIzzC,GAiBjE,SAAS02D,EAAuBrxC,GAC9B,OAAO,SAAUzkB,GAIf,OAHIykB,EAAK6e,cAAgB7e,EAAK8e,aAAe9e,EAAKmiB,QAftD,SAAuC5mC,GACrCA,EAAIi7C,KAAK74C,QAAQ,SAAUywC,GACzB,IAAIgC,EAAOhC,EAAI1P,KAAO0P,EAAI1P,IAAIM,aACzBoR,GAGLvjD,OAAOmH,KAAKo8C,GAAMzyC,QAAQ,SAAUqkD,GAClC,IAAIjjB,EAAMqR,EAAK4R,GACf5R,EAAK4R,GAAUxsD,KAAOmsC,GAAa5C,EAAIvpC,KAAMupC,EAAIsN,kBAQjDsd,CAA8BpuD,GAEzBA,GAIX,SAAS+1D,EAAaC,EAAWvxC,EAAMuqC,EAAQiH,GAE7C,IAAIxkD,EAAMgT,EAAKuxC,QACI,IAARvkD,IACLwkD,IACFxkD,EAAMlP,mBAAmBT,KAAKC,UAAU0P,KAE1Cu9C,EAAO/5D,KAAK+gE,EAAY,IAAMvkD,IAIlC,SAASykD,EAAcC,GACrB,QAAgC,IAArBA,EAAkC,CAC3C,IAAIC,EAAW1iE,OAAOyiE,GAEtB,OAAKxiE,MAAMyiE,IAAaA,IAAan1D,SAASk1D,EAAkB,IAGvDA,EAFAC,GA2Bb,SAASC,EAAqBp6D,EAASe,GACrC,IAAIs5D,EAAer6D,EAAQuzC,WAAa,SAAW,WAC/C+mB,EAAat6D,EAAQuzC,WAAa,WAAa,SAEnD,QAAqC,IAA1BvzC,EAAQq6D,SACc,IAAxBr6D,EAAQs6D,IACfzd,GAAQ78C,EAAQq6D,GAAer6D,EAAQs6D,IAAe,EACtD,MAAM,IAAI5D,GAAgB,mGAErB,GAAI31D,EAAIopB,SAA6B,IAAnBnqB,EAAQmqB,OAAkB,CACjD,GAAInqB,EAAQqnC,aACV,MAAM,IAAIqvB,GAAgB,6CACrB,GAAI12D,EAAQxD,MAAQwD,EAAQxD,KAAKvD,OAAS,IAC9C+G,EAAQ2P,QAAU3P,EAAQu6D,YAC3B,MAAM,IAAI7D,GAAgB,6DAI9B,CAAC,cAAe,QAAS,QAAQvwD,QAAQ,SAAUq0D,GACjD,IAAIt/D,EAhCR,SAA8BoM,GAC5B,GAAIA,EAAQ,CACV,GAAsB,iBAAXA,EACT,OAAQ,IAAIovD,GAAgB,+BAC1BpvD,EAAS,KAEb,GAAIA,EAAS,EACX,OAAO,IAAIovD,GAAgB,wCACnBpvD,EAAS,MAwBPmzD,CAAqBz6D,EAAQw6D,IACzC,GAAIt/D,EACF,MAAMA,IA+IZ,SAASw/D,EAAW9kE,GAClB,OAAO,SAAUg2B,GAEf,GAAsB,MAAlBA,EAAO8Y,OACT,OAAO9uC,EAEP,MAAMg2B,GAQZ,SAAS+uC,EAAiBr3B,EAAOl2B,EAAMwtD,GACrC,IAAIC,EAAY,cAAgBv3B,EAC5Bw3B,EAAiB,CAAC5xB,IAAK2xB,EAAWr+D,KAAM,IACxCu+D,EAAUH,EAAwBplE,IAAI8tC,GACtC03B,EAA2BD,EAAQ,GA+DvC,OAnZJ,SAAkBh2B,GAGhB,OAA0B,IAAnBA,EAAQ9rC,QAAgB,MAAMyM,KAAKq/B,EAAQ,GAAGpB,KAqV7Cs3B,CAHQF,EAAQ,IAMX5uC,QAAQ1nB,QAAQq2D,GAElB1tD,EAAKo1B,GAAGhtC,IAAIqlE,GAAWtkB,MAAMmkB,EAAWI,KAsD7B16C,KAAK,SAAU+nC,GACjC,OApDF,SAAyBA,GACvB,OAAKA,EAAQ3rD,KAAKvD,OAIXmU,EAAKo1B,GAAGoV,QAAQ,CACrBp7C,KAAM2rD,EAAQ3rD,KACd6qC,cAAc,IAJPlb,QAAQ1nB,QAAQ,CAACu6C,KAAM,KAiDzBkc,CAAgB/S,GAAS/nC,KAAK,SAAU+6C,GAC7C,OA1CJ,SAA6BhT,EAASgT,GAIpC,IAHA,IAAIC,EAAS,GACTC,EAAU,IAAI77B,EAET7qC,EAAI,EAAG6G,EAAM2/D,EAAUnc,KAAK/lD,OAAQtE,EAAI6G,EAAK7G,IAAK,CACzD,IACIuyC,EADMi0B,EAAUnc,KAAKrqD,GACXuyC,IACd,GAAKA,IAGLk0B,EAAOpiE,KAAKkuC,GACZm0B,EAAQvyD,IAAIo+B,EAAIgC,KAChBhC,EAAI4M,UAAYknB,EAAyB76B,IAAI+G,EAAIgC,MAC5ChC,EAAI4M,UAAU,CACjB,IAAIwnB,EAAWN,EAAyBxlE,IAAI0xC,EAAIgC,KAC5C,UAAWoyB,IACbp0B,EAAItxC,MAAQ0lE,EAAS1lE,QAI3B,IAAI2lE,EAAUrE,GAAe8D,GAiB7B,OAhBAO,EAAQp1D,QAAQ,SAAUjQ,GACxB,IAAKmlE,EAAQl7B,IAAIjqC,GAAM,CAErB,IAAIslE,EAAQ,CACVtyB,IAAKhzC,GAEHolE,EAAWN,EAAyBxlE,IAAIU,GACxC,UAAWolE,IACbE,EAAM5lE,MAAQ0lE,EAAS1lE,OAEzBwlE,EAAOpiE,KAAKwiE,MAGhBrT,EAAQ3rD,KAAOw6D,GAAKuE,EAAQhkE,OAAO4wD,EAAQ3rD,OAC3C4+D,EAAOpiE,KAAKmvD,GAELiT,EAKEK,CAAoBtT,EAASgT,OAyB1C,SAASO,EAAStuD,GAChB,IAAI8zC,EAA2B,iBAAT9zC,EAAoBA,EAAOA,EAAKlY,KAClD8J,EAAQu5D,GAAiBrX,GAI7B,OAHKliD,IACHA,EAAQu5D,GAAiBrX,GAAY,IAAIsW,IAEpCx4D,EAGT,SAAS28D,EAAWvuD,GAClB,OAAO0pD,GAAc4E,EAAStuD,GAAO,WACnC,OAIJ,SAA2BA,GAEzB,IAAIwuD,EACA10B,EAYJ,IAAIka,EAAS+X,EAAO/rD,EAAKg0C,OAVzB,SAAclrD,EAAKN,GACjB,IAAIk0B,EAAS,CAAC3mB,GAAI+jC,EAAIgC,IAAKhzC,IAAK4mD,GAAa5mD,IAGzC,MAAON,IACTk0B,EAAOl0B,MAAQknD,GAAalnD,IAE9BgmE,EAAW5iE,KAAK8wB,KAKd+xC,EAAazuD,EAAK43B,KAAO,EAE7B,SAASmM,EAAcypB,EAAyB51B,GAC9C,OAAO,WACL,OAtDN,SAAuB53B,EAAMwtD,EAAyB51B,GAEpD,OAAO53B,EAAKo1B,GAAGhtC,IADA,kBAEZ+gD,MAAMmkB,EAAW,CAACxxB,IAFN,iBAEqBlE,IAAK,KACtC5kB,KAAK,SAAUk4C,GACd,IAAI/K,EAAS2J,GAAe0D,GAC5B,OAAOzuC,QAAQ0qB,IAAI0W,EAAOtpD,IAAI,SAAUq/B,GACtC,OAAOq3B,EAAiBr3B,EAAOl2B,EAAMwtD,MACnCx6C,KAAK,SAAU07C,GACjB,IAAIC,EAAgBr0B,GAAQo0B,GAI5B,OAHAxD,EAAWtzB,IAAMA,EACjB+2B,EAAc/iE,KAAKs/D,GAEZlrD,EAAKo1B,GAAGoR,SAAS,CAAClR,KAAOq5B,QAyC3BC,CAAc5uD,EAAMwtD,EAAyB51B,IAIxD,IAAIhmC,EAAQ,IAAIw4D,GAEhB,SAASyE,IACP,OAAO7uD,EAAKsqD,SAAS3yB,QAAQ,CAC3B2R,aAAa,EACb7I,WAAW,EACXxG,cAAc,EACd39B,MAAO,WACPu7B,MAAO42B,EACPn+C,MAAO+6C,KACNr4C,KAAKyjB,GAGV,SAASA,EAAaqwB,GACpB,IAAIjxB,EAAUixB,EAASjxB,QACvB,GAAKA,EAAQhqC,OAAb,CAGA,IAAI2hE,EAQN,SAAuC33B,GAErC,IADA,IAAI23B,EAA0B,IAAIn7B,EACzB9qC,EAAI,EAAG6G,EAAMynC,EAAQhqC,OAAQtE,EAAI6G,EAAK7G,IAAK,CAClD,IAAIsyC,EAAShE,EAAQtuC,GACrB,GAA0B,MAAtBsyC,EAAOC,IAAIgC,IAAI,GAAY,CAC7B0yB,EAAa,IACb10B,EAAMD,EAAOC,KAEJ4M,UACPwlB,EAAOlsD,EAAKsqD,SAAUtW,EAAQla,GAEhC00B,EAAWnuB,KAAKgsB,GAEhB,IAAIuB,EAA2BkB,EAA+BN,GAC9DhB,EAAwBjgE,IAAIssC,EAAOC,IAAIgC,IAAK,CAC1C8xB,EACA/zB,EAAOlC,UAGX82B,EAAa50B,EAAOjC,IAEtB,OAAO41B,EA7BuBuB,CAA8Bl5B,GAE5D,GADAjkC,EAAM8J,IAAIqoC,EAAcypB,EAAyBiB,MAC7C54B,EAAQhqC,OAASw/D,IAGrB,OAAOwD,KA2BT,SAASC,EAA+BN,GAGtC,IAFA,IACI9P,EADAkP,EAA2B,IAAIv7B,EAE1B9qC,EAAI,EAAG6G,EAAMogE,EAAW3iE,OAAQtE,EAAI6G,EAAK7G,IAAK,CACrD,IAAIynE,EAAkBR,EAAWjnE,GAC7B0nE,EAAa,CAACD,EAAgBlmE,IAAKkmE,EAAgBj5D,IACnDxO,EAAI,GAA+C,IAA1CkoD,GAAQuf,EAAgBlmE,IAAK41D,IACxCuQ,EAAWrjE,KAAKrE,GAElBqmE,EAAyBrgE,IAAI2jD,GAAkB+d,GAAaD,GAC5DtQ,EAAUsQ,EAAgBlmE,IAE5B,OAAO8kE,EAGT,OAAOiB,IAAmB77C,KAAK,WAC7B,OAAOphB,EAAMquB,WACZjN,KAAK,WACNhT,EAAK43B,IAAM62B,IAjGJS,CAAkBlvD,IADpB0pD,GAwJT,SAASyF,EAAUnvD,EAAMob,GACvB,OAAOsuC,GAAc4E,EAAStuD,GAAO,WACnC,OAIJ,SAA0BA,EAAMob,GAC9B,IAAIg0C,EACAC,EAAervD,EAAKuqD,YAA6B,IAAhBnvC,EAAK2B,OACtC0tB,EAAOrvB,EAAKqvB,MAAQ,OACC,IAAdrvB,EAAKhsB,MAAyBgsB,EAAKhsB,KAAKvD,SAEjDuvB,EAAK9K,MAAQ,SACN8K,EAAKhsB,MAGd,SAASkgE,EAAcC,GAErB,OADAA,EAASt1B,cAAe,EACjBj6B,EAAKo1B,GAAGoV,QAAQ+kB,GAAUv8C,KAAK,SAAUrc,GAE9C,OADAy4D,EAAYz4D,EAAImpD,WACTnpD,EAAIi7C,KAAK/6C,IAAI,SAAUgB,GAM5B,GAAI,UAAWA,EAAOiiC,KAAmC,iBAArBjiC,EAAOiiC,IAAItxC,OACxB,OAArBqP,EAAOiiC,IAAItxC,MAAgB,CAC3B,IAAI4G,EAAOnH,OAAOmH,KAAKyI,EAAOiiC,IAAItxC,OAAO63C,OAGrCmvB,EAAe,CAAC,KAAM,MAAO,SACjC,KAAMpgE,EAAOogE,GAAgBpgE,EAAOogE,GAClC,OAAO33D,EAAOiiC,IAAItxC,MAItB,IAAIinE,EA38Jd,SAA8B/kD,GAM5B,IALA,IAAI1U,EAAQ,GACRw7C,EAAY,GACZjqD,EAAI,IAGK,CACX,IAAIqoD,EAAiBllC,EAAInjB,KACzB,GAAuB,OAAnBqoD,EAQJ,OAAQA,GACN,IAAK,IACH55C,EAAMpK,KAAK,MACX,MACF,IAAK,IACHoK,EAAMpK,KAAgB,MAAX8e,EAAInjB,IACfA,IACA,MACF,IAAK,IACH,IAAImoE,EAAYte,GAAY1mC,EAAKnjB,GACjCyO,EAAMpK,KAAK8jE,EAAUt3C,KACrB7wB,GAAKmoE,EAAU7jE,OACf,MACF,IAAK,IAGH,IAFA,IAAI8jE,EAAY,KAEH,CACX,IAAIhiB,EAAKjjC,EAAInjB,GACb,GAAW,OAAPomD,EACF,MAEFgiB,GAAahiB,EACbpmD,IAKFooE,EAAYA,EAAUx2D,QAAQ,gBAAiB,MAC5CA,QAAQ,gBAAiB,KACzBA,QAAQ,gBAAiB,KAE5BnD,EAAMpK,KAAK+jE,GACX,MACF,IAAK,IACH,IAAIC,EAAe,CAAEr/D,QAAS,GAAIxB,MAAOiH,EAAMnK,QAC/CmK,EAAMpK,KAAKgkE,EAAar/D,SACxBihD,EAAU5lD,KAAKgkE,GACf,MACF,IAAK,IACH,IAAIC,EAAa,CAAEt/D,QAAS,GAAIxB,MAAOiH,EAAMnK,QAC7CmK,EAAMpK,KAAKikE,EAAWt/D,SACtBihD,EAAU5lD,KAAKikE,GACf,MAEF,QACE,MAAM,IAAI7jE,MACR,4DACE4jD,OAvDR,CACE,GAAqB,IAAjB55C,EAAMnK,OACR,OAAOmK,EAAMhH,MAEbA,GAAIgH,EAAOw7C,KA+7Jese,CAAqBj4D,EAAOiiC,IAAIgC,KACxD,MAAO,CACLhzC,IAAK2mE,EAAkB,GACvB15D,GAAI05D,EAAkB,GACtBjnE,MAAQ,UAAWqP,EAAOiiC,IAAMjiC,EAAOiiC,IAAItxC,MAAQ,UAM3D,SAASunE,EAAkBne,GACzB,IAAIoe,EAcJ,GAZEA,EADEX,EAnGR,SAAoBrvD,EAAM61B,EAASjjC,GACL,IAAxBA,EAAQu6D,oBACHv6D,EAAQu6D,YAGjB,IAAI8C,EAAcr9D,EAAQ2P,OAAS3P,EAAQu6D,YAEvC5C,EAAYyB,EAAQhsD,EAAKuqD,WAEzB/nD,EAAS,GACT0tD,EAAM5lE,MAAMsI,EAAQu6D,aAAe9iE,OAAO8lE,kBAC5Cv9D,EAAQu6D,YACVt3B,EAAQ98B,QAAQ,SAAU/G,GACxB,IAAIuyB,EAAO/hB,EAAOA,EAAO3W,OAAS,GAC9BukE,EAAWH,EAAcj+D,EAAElJ,IAAM,KAOrC,GAJImnE,GAAe/iE,MAAM2L,QAAQu3D,KAC/BA,EAAWA,EAASt2D,MAAM,EAAGo2D,IAG3B3rC,GAA6C,IAArCkrB,GAAQlrB,EAAK6rC,SAAUA,GAGjC,OAFA7rC,EAAKn1B,KAAKxD,KAAK,CAACoG,EAAElJ,IAAKkJ,EAAE+D,UACzBwuB,EAAK9hB,OAAO7W,KAAKoG,EAAExJ,OAGrBga,EAAO5W,KAAK,CACVwD,KAAM,CAAC,CAAC4C,EAAElJ,IAAKkJ,EAAE+D,KACjB0M,OAAQ,CAACzQ,EAAExJ,OACX4nE,SAAUA,MAGdv6B,EAAU,GACV,IAAK,IAAItuC,EAAI,EAAG6G,EAAMoU,EAAO3W,OAAQtE,EAAI6G,EAAK7G,IAAK,CACjD,IAAIyK,EAAIwQ,EAAOjb,GACX8oE,EAAYlE,EAAUnsD,EAAKsqD,SAAUC,EAAWv4D,EAAE5C,KAAM4C,EAAEyQ,QAAQ,GACtE,GAAI4tD,EAAUviE,OAASuiE,EAAUviE,iBAAiB07D,GAEhD,MAAM6G,EAAUviE,MAElB+nC,EAAQjqC,KAAK,CAEXpD,MAAO6nE,EAAUviE,MAAQ,KAAOuiE,EAAU3zC,OAC1C5zB,IAAKkJ,EAAEo+D,WAIX,MAAO,CAACxe,KAAM2a,EAAa12B,EAASjjC,EAAQ0d,MAAO1d,EAAQ63C,OAqDxC6lB,CAAWtwD,EAAM4xC,EAAMx2B,GAEvB,CACb0kC,WAAYsP,EACZllD,OAAQugC,EACRmH,KAAMA,GAINx2B,EAAKkrB,aACP0pB,EAAa1pB,WAAatmC,EAAK43B,KAE7Bxc,EAAK6e,aAAc,CACrB,IAAIkmB,EAASyJ,GAAKhY,EAAK/6C,IAAI21D,IAE3B,OAAOxsD,EAAKsqD,SAAS9f,QAAQ,CAC3Bp7C,KAAM+wD,EACNlmB,cAAc,EACdwG,UAAWrlB,EAAKqlB,UAChBvG,YAAa9e,EAAK8e,YAClBqD,OAAQniB,EAAKmiB,SACZvqB,KAAK,SAAUu9C,GAChB,IAAIC,EAAe,IAAIn+B,EAWvB,OAVAk+B,EAAW3e,KAAK74C,QAAQ,SAAUywC,GAChCgnB,EAAajjE,IAAIi8C,EAAIzzC,GAAIyzC,EAAI1P,OAE/B8X,EAAK74C,QAAQ,SAAUywC,GACrB,IAAItT,EAAQs2B,EAAWhjB,GACnB1P,EAAM02B,EAAapoE,IAAI8tC,GACvB4D,IACF0P,EAAI1P,IAAMA,KAGPk2B,IAGT,OAAOA,EAIX,QAAyB,IAAd50C,EAAKhsB,KAAsB,CACpC,IACIqhE,EADOr1C,EAAKhsB,KACSyH,IAAI,SAAU/N,GACrC,IAAIymE,EAAW,CACb5kB,SAAWuG,GAAkB,CAACpoD,IAC9B+hD,OAAWqG,GAAkB,CAACpoD,EAAK,MAMrC,OAHIsyB,EAAKkrB,aACPipB,EAASjpB,YAAa,GAEjBgpB,EAAcC,KAEvB,OAAOxwC,QAAQ0qB,IAAIgnB,GAAez9C,KAAKsnB,IAAStnB,KAAK+8C,GAErD,IAOIplB,EACAE,EARA0kB,EAAW,CACbppB,WAAa/qB,EAAK+qB,YAyBpB,GAtBI/qB,EAAKkrB,aACPipB,EAASjpB,YAAa,GAIpB,cAAelrB,IACjBuvB,EAAWvvB,EAAKsvB,WAEd,aAActvB,IAChBuvB,EAAWvvB,EAAKuvB,UAEd,YAAavvB,IACfyvB,EAASzvB,EAAKwvB,SAEZ,WAAYxvB,IACdyvB,EAASzvB,EAAKyvB,aAEQ,IAAbF,IACT4kB,EAAS5kB,SAAWvvB,EAAK+qB,WACvB+K,GAAkB,CAACvG,EAAU,KAC7BuG,GAAkB,CAACvG,UAED,IAAXE,EAAwB,CACjC,IAAImU,GAAsC,IAAvB5jC,EAAK6jC,cACpB7jC,EAAK+qB,aACP6Y,GAAgBA,GAGlBuQ,EAAS1kB,OAASqG,GAChB8N,EAAe,CAACnU,EAAQ,IAAM,CAACA,IAEnC,QAAwB,IAAbzvB,EAAKtyB,IAAqB,CACnC,IAAI4nE,EAAWxf,GAAkB,CAAC91B,EAAKtyB,MACnC6nE,EAASzf,GAAkB,CAAC91B,EAAKtyB,IAAK,KACtCymE,EAASppB,YACXopB,EAAS1kB,OAAS6lB,EAClBnB,EAAS5kB,SAAWgmB,IAEpBpB,EAAS5kB,SAAW+lB,EACpBnB,EAAS1kB,OAAS8lB,GAStB,OANKtB,IACuB,iBAAfj0C,EAAK9K,QACdi/C,EAASj/C,MAAQ8K,EAAK9K,OAExBi/C,EAAS9kB,KAAOA,GAEX6kB,EAAcC,GAAUv8C,KAAK+8C,GA3J7Ba,CAAiB5wD,EAAMob,IADzBsuC,GA+NT,SAASmH,EAAcz7B,EAAIzhC,EAAKynB,GAE9B,GAAyB,mBAAdga,EAAG07B,OACZ,OA1gBJ,SAAqB17B,EAAIzhC,EAAKynB,GAC5B,OAAO,IAAI2D,QAAQ,SAAU1nB,EAAS2nB,GACpCoW,EAAG07B,OAAOn9D,EAAKynB,EAAM,SAAUptB,EAAK2I,GAClC,GAAI3I,EACF,OAAOgxB,EAAOhxB,GAEhBqJ,EAAQV,OAogBHo6D,CAAY37B,EAAIzhC,EAAKynB,GAE9B,GAAIqf,GAASrF,GACX,OA9nBJ,SAAmBA,EAAIzhC,EAAKynB,GAE1B,IACI/f,EAEA65B,EAAIoC,EAHJquB,EAAS,GAEThzD,EAAS,MA+Bb,GAxBA+5D,EAAa,SAAUtxC,EAAMuqC,GAC7B+G,EAAa,eAAgBtxC,EAAMuqC,GACnC+G,EAAa,cAAetxC,EAAMuqC,GAClC+G,EAAa,QAAStxC,EAAMuqC,GAC5B+G,EAAa,aAActxC,EAAMuqC,GACjC+G,EAAa,QAAStxC,EAAMuqC,GAC5B+G,EAAa,cAAetxC,EAAMuqC,GAClC+G,EAAa,OAAQtxC,EAAMuqC,GAC3B+G,EAAa,QAAStxC,EAAMuqC,GAC5B+G,EAAa,YAAatxC,EAAMuqC,GAChC+G,EAAa,WAAYtxC,EAAMuqC,GAAQ,GACvC+G,EAAa,YAAatxC,EAAMuqC,GAAQ,GACxC+G,EAAa,SAAUtxC,EAAMuqC,GAAQ,GACrC+G,EAAa,UAAWtxC,EAAMuqC,GAAQ,GACtC+G,EAAa,gBAAiBtxC,EAAMuqC,GACpC+G,EAAa,MAAOtxC,EAAMuqC,GAAQ,GAClC+G,EAAa,aAActxC,EAAMuqC,GAIjCA,EAAoB,MADpBA,EAASA,EAAO7uD,KAAK,MACI,GAAK,IAAM6uD,OAIX,IAAdvqC,EAAKhsB,KAAsB,CACpC,IAII4hE,EACF,QAAU93D,mBAAmBT,KAAKC,UAAU0iB,EAAKhsB,OAC/C4hE,EAAanlE,OAAS85D,EAAO95D,OAAS,GANrB,IASnB85D,IAAyB,MAAdA,EAAO,GAAa,IAAM,KAAOqL,GAE5Cr+D,EAAS,OACU,iBAARgB,EACT0H,EAAO,CAACjM,KAAMgsB,EAAKhsB,MAEnBuE,EAAIvE,KAAOgsB,EAAKhsB,MAMtB,GAAmB,iBAARuE,EAAkB,CAC3B,IAAIiG,EAAQ0xD,GAAc33D,GAC1B,OAAOyhC,EAAGoX,MAAM,WAAa5yC,EAAM,GAAK,UAAYA,EAAM,GAAK+rD,EAAQ,CACrEK,QAAS,IAAI77B,GAAE,CAAC,eAAgB,qBAChCx3B,OAAQA,EACR0I,KAAM5C,KAAKC,UAAU2C,KACpB2X,KAAK,SAAU8zC,GAGhB,OAFA5xB,EAAK4xB,EAAS5xB,GACdoC,EAASwvB,EAASxvB,OACXwvB,EAAS3O,SACfnlC,KAAK,SAAUnb,GAChB,IAAKq9B,EAEH,MADAr9B,EAAOy/B,OAASA,EACVkC,GAA0B3hC,GASlC,OANAA,EAAO+5C,KAAK74C,QAAQ,SAAUywC,GAE5B,GAAIA,EAAIhhD,OAASghD,EAAIhhD,MAAMsF,OAA6B,yBAApB07C,EAAIhhD,MAAMsF,MAC5C,MAAM,IAAI9B,MAAMw9C,EAAIhrB,UAGjB3mB,IACNmb,KAAKy5C,EAAuBrxC,IAajC,OATA/f,EAAOA,GAAQ,GACfpT,OAAOmH,KAAKuE,GAAKoF,QAAQ,SAAUjQ,GAC7BoE,MAAM2L,QAAQlF,EAAI7K,IACpBuS,EAAKvS,GAAO6K,EAAI7K,GAEhBuS,EAAKvS,GAAO6K,EAAI7K,GAAKmN,aAIlBm/B,EAAGoX,MAAM,aAAemZ,EAAQ,CACrCK,QAAS,IAAI77B,GAAE,CAAC,eAAgB,qBAChCx3B,OAAQ,OACR0I,KAAM5C,KAAKC,UAAU2C,KACpB2X,KAAK,SAAU8zC,GAGhB,OAFE5xB,EAAK4xB,EAAS5xB,GACdoC,EAASwvB,EAASxvB,OACbwvB,EAAS3O,SACfnlC,KAAK,SAAUnb,GAChB,IAAKq9B,EAEH,MADAr9B,EAAOy/B,OAASA,EACVkC,GAA0B3hC,GAElC,OAAOA,IACNmb,KAAKy5C,EAAuBrxC,IAmhBtB61C,CAAU77B,EAAIzhC,EAAKynB,GAG5B,GAAmB,iBAARznB,EAoBT,OAlBAq5D,EAAqB5xC,EAAMznB,GAE3By3D,GAAc1vD,IAAI,WAQhB,OAPwB2uD,GACPj1B,EACA,sBACFzhC,EAAIkD,IACDlD,EAAIopB,QACJ,EACG0tC,GACIz3C,KAAK,SAAUhT,GACtC,OApiCG8e,EAoiCQyvC,EAAWvuD,GAAMgT,KAAK,WAC/B,OAAOm8C,EAAUnvD,EAAMob,KAriCb81C,EAsiCR,WACF,OAAOlxD,EAAKo1B,GAAGhc,WAtiClB0F,EAAQ9L,KAAK,SAAUrc,GAC5B,OAAOu6D,IAAsBl+C,KAAK,WAChC,OAAOrc,KAER,SAAU6nB,GACX,OAAO0yC,IAAsBl+C,KAAK,WAChC,MAAMwL,MAPZ,IAAaM,EAASoyC,MA2iCT9F,GAAcnrC,SAGrB,IAAI+qC,EAAer3D,EACfiG,EAAQ0xD,GAAcN,GACtBmG,EAAgBv3D,EAAM,GACtBk6C,EAAWl6C,EAAM,GACrB,OAAOw7B,EAAGhtC,IAAI,WAAa+oE,GAAen+C,KAAK,SAAU8mB,GACvD,IAAInmC,EAAMmmC,EAAIma,OAASna,EAAIma,MAAMH,GAEjC,IAAKngD,EAEH,MAAM,IAAI41D,GAAc,QAAUzvB,EAAIgC,IAAM,sBAC1CgY,GAaJ,OAVAmY,EAAcnyB,EAAKga,GACnBkZ,EAAqB5xC,EAAMznB,GAEH02D,GACPj1B,EACA41B,EACFr3D,EAAIkD,IACDlD,EAAIopB,QACJ,EACG0tC,GACIz3C,KAAK,SAAUhT,GACtC,MAAmB,OAAfob,EAAKg2C,OAAiC,iBAAfh2C,EAAKg2C,OACX,iBAAfh2C,EAAKg2C,OACP,IAAU,WACR7C,EAAWvuD,KAGRmvD,EAAUnvD,EAAMob,IAEhBmzC,EAAWvuD,GAAMgT,KAAK,WAC3B,OAAOm8C,EAAUnvD,EAAMob,SA2BnC,IAtnCmBznB,EAkoCnB,MAAO,CACL2zB,MAhCF,SAAuB3zB,EAAKynB,EAAM+E,GAChC,IAAIiV,EAAK3qC,KACW,mBAAT2wB,IACT+E,EAAW/E,EACXA,EAAO,IAETA,EAAOA,EArvBT,SAAuBA,GAIrB,OAHAA,EAAK+xC,YAAcN,EAAczxC,EAAK+xC,aACtC/xC,EAAK9K,MAAQu8C,EAAczxC,EAAK9K,OAChC8K,EAAKqvB,KAAOoiB,EAAczxC,EAAKqvB,MACxBrvB,EAivBOi2C,CAAcj2C,GAAQ,GAEjB,mBAARznB,IACTA,EAAM,CAACkD,IAAMlD,IAGf,IAAImrB,EAAUC,QAAQ1nB,UAAU2b,KAAK,WACnC,OAAO69C,EAAcz7B,EAAIzhC,EAAKynB,KAGhC,OADAquC,GAAiB3qC,EAASqB,GACnBrB,GAiBPwyC,aApoCiB39D,EAsnCmB,WACpC,IAAIyhC,EAAK3qC,KAET,MAA+B,mBAApB2qC,EAAGm8B,aAxlBhB,SAA2Bn8B,GACzB,OAAO,IAAIrW,QAAQ,SAAU1nB,EAAS2nB,GACpCoW,EAAGm8B,aAAa,SAAUvjE,EAAK2I,GAC7B,GAAI3I,EACF,OAAOgxB,EAAOhxB,GAEhBqJ,EAAQV,OAmlBH66D,CAAkBp8B,GAEvBqF,GAASrF,GAjKf,SAAyBA,GACvB,OAAOA,EAAGoX,MAAM,gBAAiB,CAC/BwZ,QAAS,IAAI77B,GAAE,CAAC,eAAgB,qBAChCx3B,OAAQ,SACPqgB,KAAK,SAAU8zC,GAChB,OAAOA,EAAS3O,SA6JTsZ,CAAgBr8B,GAzJ3B,SAA0BA,GACxB,OAAOA,EAAGhtC,IAAI,UAAYqiE,GAAcz3C,KAAK,SAAU+nC,GACrD,IAAI2W,EAAc,IAAIr/B,EACtBpqC,OAAOmH,KAAK2rD,EAAQ9G,OAAOl7C,QAAQ,SAAUiyD,GAC3C,IAAIpxD,EAAQ0xD,GAAcN,GACtBmG,EAAgB,WAAav3D,EAAM,GACnCk6C,EAAWl6C,EAAM,GACjBq6C,EAAQyd,EAAYtpE,IAAI+oE,GACvBld,IACHA,EAAQ,IAAI7hB,EACZs/B,EAAYnkE,IAAI4jE,EAAeld,IAEjCA,EAAMv4C,IAAIo4C,KAEZ,IAAI14B,EAAO,CACThsB,KAAO06D,GAAe4H,GACtBz3B,cAAe,GAEjB,OAAO7E,EAAGoV,QAAQpvB,GAAMpI,KAAK,SAAUrc,GACrC,IAAIg7D,EAAgB,GACpBh7D,EAAIi7C,KAAK74C,QAAQ,SAAUywC,GACzB,IAAIooB,EAAWpoB,EAAI1gD,IAAI6uB,UAAU,GACjC+5C,EAAYtpE,IAAIohD,EAAI1gD,KAAKiQ,QAAQ,SAAU+6C,GACzC,IAAIkX,EAAe4G,EAAW,IAAM9d,EAE/BiH,EAAQ9G,MAAM+W,KAGjBA,EAAelX,GAEjB,IAAI+d,EAAc5pE,OAAOmH,KAAK2rD,EAAQ9G,MAAM+W,IAExC8G,EAAetoB,EAAI1P,KAAO0P,EAAI1P,IAAIma,OACpCzK,EAAI1P,IAAIma,MAAMH,GAChB+d,EAAY94D,QAAQ,SAAUg5D,GAC5BJ,EAAcI,GACZJ,EAAcI,IAAeD,QAIrC,IAEIE,EAFc/pE,OAAOmH,KAAKuiE,GAAe/tD,OAC3C,SAAUmuD,GAAc,OAAQJ,EAAcI,KACdl7D,IAAI,SAAUk7D,GAC9C,OAAOrI,GAAc4E,EAASyD,GAAa,WACzC,OAAO,IAAI38B,EAAG1lC,YAAYqiE,EAAY38B,EAAGuP,QAAQvrB,WAD5CswC,KAIT,OAAO3qC,QAAQ0qB,IAAIuoB,GAAiBh/C,KAAK,WACvC,MAAO,CAACkiB,IAAI,QAGfo4B,EAAW,CAACp4B,IAAI,KAwGZ+8B,CAAiB78B,IA9nCnB,IAAa,SAAUtrC,GAC5B,IAAI2J,EAAK3J,EAAKkF,MACV8vB,EAAUnrB,EAAIhK,MAAMc,KAAMX,GAI9B,MAHkB,mBAAP2J,GACTg2D,GAAiB3qC,EAASrrB,GAErBqrB,MA0sCIozC,CADI,UA9BnB,SAAgBle,EAAQtoD,GAEtB,GAAsB,mBAAXsoD,GAA2C,IAAlBA,EAAOnoD,OAAc,CACvD,IAAIsmE,EAAUne,EACd,OAAO,SAAUla,GACf,OAAOq4B,EAAQr4B,EAAKpuC,IAGtB,OAAOy+D,GAAqBnW,EAAO/9C,WAAYvK,IAInD,SAAiB6+D,GACf,IAAI6H,EAAkB7H,EAAUt0D,WAC5Bo8D,EA1BN,SAAoBD,GAClB,GAAI,QAAQ95D,KAAK85D,GACf,OAAO5G,GAAcC,KAChB,GAAI,UAAUnzD,KAAK85D,GACxB,OAAO5G,GAAcE,OAChB,GAAI,UAAUpzD,KAAK85D,GACxB,OAAO5G,GAAcG,OAChB,GAAI,KAAKrzD,KAAK85D,GACnB,MAAM,IAAIpmE,MAAMomE,EAAkB,wCAkBtBE,CAAWF,GACzB,OAAIC,GAGKlI,GAAqBiI,IAIhC,SAAuBre,EAAMD,GAC3B,IAAIngD,EAAMogD,EAAKE,OAASF,EAAKE,MAAMH,GACnC,GAAuB,iBAAZngD,EAAIkD,IACb,MAAM,IAAI0yD,GAAc,QAAUxV,EAAKjY,IAAM,6BAC3CgY,EAAW,0CAA4CngD,EAAIkD,OAejE,IAAI07D,GAAY,CACdjrC,MATF,SAAe3zB,EAAKynB,EAAM+E,GACxB,OAAO2rC,GAASxkC,MAAM5/B,KAAK+C,KAAMkJ,EAAKynB,EAAM+E,IAS5CmxC,YANF,SAAqBnxC,GACnB,OAAO2rC,GAASwF,YAAY5pE,KAAK+C,KAAM01B,KAQzC,SAASqyC,GAAWnrB,GAClB,MAAO,MAAM/uC,KAAK+uC,GASpB,SAASorB,GAAkBr9B,EAAI0E,GAC7B,IAAI+tB,EAAY5/D,OAAOmH,KAAK0qC,EAAIM,cAChC,OAAOrb,QAAQ0qB,IAAIoe,EAAUhxD,IAAI,SAAUumD,GACzC,OAAOhoB,EAAGmV,cAAczQ,EAAIgC,IAAKshB,EAAU,CAAC7mB,IAAKuD,EAAI6B,UAuDzD,SAAS+2B,GAAQ95D,EAAKhP,EAAQ+oE,EAAOpmE,GACnComE,EAAQt/B,EAAMs/B,GAEd,IAAIC,EAAa,GACb19B,GAAK,EA2DT,SAAS29B,EAAqBnzB,GAG5B,OAAO9mC,EAAI4xC,QAAQ,CACjBp7C,KAAMswC,EACNzF,cAAc,EACdwG,WAAW,IACVztB,KAAK,SAAUrc,GAChB,GAAIpK,EAAMurC,UACR,MAAM,IAAI9rC,MAAM,aAElB2K,EAAIi7C,KAAK74C,QAAQ,SAAUywC,GAnB/B,IAAwB1P,EAoBd0P,EAAI5J,UAAY4J,EAAI1P,MAAQ04B,GAAWhpB,EAAIhhD,MAAM+tC,OApBnCuD,EAqBC0P,EAAI1P,IApBpBA,EAAIM,cAAgBnyC,OAAOmH,KAAK0qC,EAAIM,cAAcvuC,OAAS,IAGpE,SAAsBiuC,GACpB,OAAOA,EAAImK,YAAcnK,EAAImK,WAAWp4C,OAAS,EAgBdinE,CAAatpB,EAAI1P,OAO5C0P,EAAI1P,IAAImK,mBACHuF,EAAI1P,IAAImK,WAIjB2uB,EAAWhnE,KAAK49C,EAAI1P,YACb64B,EAAMnpB,EAAIzzC,SAqBvB,OAAOgpB,QAAQ1nB,UACZ2b,KAjBH,WAGE,IAAI0sB,EAAMz3C,OAAOmH,KAAKujE,GAAO/uD,OAAO,SAAU7N,GAC5C,IAAIiyC,EAAU2qB,EAAM58D,GAAIiyC,QACxB,OAA0B,IAAnBA,EAAQn8C,QAAgB2mE,GAAWxqB,EAAQ,MAEpD,GAAItI,EAAI7zC,OAAS,EACf,OAAOgnE,EAAqBnzB,KAU7B1sB,KA1GH,WAEE,IAAI+/C,EAjCR,SAA2BJ,GACzB,IAAIt9B,EAAW,GAWf,OAVAptC,OAAOmH,KAAKujE,GAAO55D,QAAQ,SAAUhD,GACjB48D,EAAM58D,GAAIiyC,QAChBjvC,QAAQ,SAAUi6D,GAC5B39B,EAASzpC,KAAK,CACZmK,GAAIA,EACJwgC,IAAKy8B,QAKJ,CACL19B,KAAMD,EACNyK,MAAM,EACN8J,QAAQ,GAkBUqpB,CAAkBN,GAEpC,GAAKI,EAAYz9B,KAAKzpC,OAItB,OAAO+M,EAAIu8B,QAAQ49B,GAAa//C,KAAK,SAAUkgD,GAE7C,GAAI3mE,EAAMurC,UACR,MAAM,IAAI9rC,MAAM,aAElB,OAAO+yB,QAAQ0qB,IAAIypB,EAAgBr9B,QAAQh/B,IAAI,SAAUs8D,GACvD,OAAOp0C,QAAQ0qB,IAAI0pB,EAAY79B,KAAKz+B,IAAI,SAAUijC,GAChD,IAAIs5B,EAAYt5B,EAAI5E,GAQpB,OANI4E,EAAIhsC,QAGNonC,GAAK,GAGFk+B,GAAcA,EAAUh5B,aAhFvC,SAA6CxwC,EAAQgP,EAAKkhC,GACxD,IAAIu5B,EAA6B54B,GAAS7hC,KAAS6hC,GAAS7wC,GACxDi+D,EAAY5/D,OAAOmH,KAAK0qC,EAAIM,cAEhC,OAAKi5B,EAIEzpE,EAAOxB,IAAI0xC,EAAIgC,KAAK9oB,KAAK,SAAUi5B,GACxC,OAAOltB,QAAQ0qB,IAAIoe,EAAUhxD,IAAI,SAAUumD,GACzC,OAvBN,SAAwBnR,EAAUmnB,EAAWhW,GAC3C,OAAQnR,EAAS7R,eACT6R,EAAS7R,aAAagjB,IACvBnR,EAAS7R,aAAagjB,GAAU7H,SAAW6d,EAAUh5B,aAAagjB,GAAU7H,OAoB3E+d,CAAernB,EAAUnS,EAAKsjB,GACzBxkD,EAAI2xC,cAAczQ,EAAIgC,IAAKshB,GAG7BxzD,EAAO2gD,cAAc0B,EAASnQ,IAAKshB,QAE3CjU,MAAM,SAAUr7C,GAEjB,GAAqB,MAAjBA,EAAMwpC,OACR,MAAMxpC,EAGR,OAAO2kE,GAAkB75D,EAAKkhC,KAjBvB24B,GAAkB75D,EAAKkhC,GA+EjBy5B,CAAoC3pE,EAAQgP,EAAKw6D,GAC9CpgD,KAAK,SAAUknB,GACR,IAAI2tB,EAAY5/D,OAAOmH,KAAKgkE,EAAUh5B,cAS3B,OARXF,EACGnhC,QAAQ,SAAU0pD,EAAYl7D,GACpB,IAAI4yC,EAAMi5B,EAAUh5B,aAAaytB,EAAUtgE,WACpC4yC,EAAIE,YACJF,EAAItuC,OACXsuC,EAAIvpC,KAAO6xD,IAGN2Q,IAd1BA,QAmBZpgD,KAAK,SAAU6iB,GACd+8B,EAAaA,EAAWzoE,OAAOmwC,GAAQzE,GAASjyB,OAAO4vD,gBA+D1DxgD,KAPH,WACE,MAAO,CAAEkiB,GAAGA,EAAII,KAAKs9B,KASzB,IAAIa,GAAqB,EACrBC,GAAa,UAQbC,GAA0B,EAC1BC,GAAa,EAEjB,SAASC,GAAiBz+B,EAAIr/B,EAAI+9D,EAAYC,EAASC,GACrD,OAAO5+B,EAAGhtC,IAAI2N,GAAIozC,MAAM,SAAUn7C,GAChC,GAAmB,MAAfA,EAAIspC,OAMN,MALmB,SAAflC,EAAG2P,SAAqC,UAAf3P,EAAG2P,SAC9B1N,EACE,IAAK,2DAGF,CACL48B,WAAYF,EACZj4B,IAAK/lC,EACL8qC,QAAS,GACTqzB,WAAYR,GACZx+D,QAASu+D,IAGb,MAAMzlE,IACLglB,KAAK,SAAU8mB,GAChB,IAAIk6B,EAAYl8B,WAKZgC,EAAIsP,WAAa0qB,EA0BrB,OArBAh6B,EAAI+G,SAAW/G,EAAI+G,SAAW,IAAIj9B,OAAO,SAAUo9B,GACjD,OAAOA,EAAKizB,aAAeF,IAI7Bj6B,EAAI+G,QAAQl1C,QAAQ,CAClBy9C,SAAU0qB,EACVG,WAAYF,IAMdj6B,EAAI+G,QAAU/G,EAAI+G,QAAQ/mC,MAAM,EAAG65D,IAEnC75B,EAAI5kC,QAAUu+D,GACd35B,EAAIo6B,WAAaR,GAEjB55B,EAAIm6B,WAAaF,EACjBj6B,EAAIsP,SAAW0qB,EAER1+B,EAAG2G,IAAIjC,GAAKqP,MAAM,SAAUn7C,GACjC,GAAmB,MAAfA,EAAIspC,OAEN,OAAOu8B,GAAiBz+B,EAAIr/B,EAAI+9D,EAAYC,EAASC,GAEvD,MAAMhmE,MAKZ,SAASmmE,GAAav7D,EAAKhP,EAAQmM,EAAIi+D,EAAa54C,GAClD3wB,KAAKmO,IAAMA,EACXnO,KAAKb,OAASA,EACda,KAAKsL,GAAKA,EACVtL,KAAKupE,YAAcA,EACnBvpE,KAAK2wB,KAAOA,GAAQ,GAGtB+4C,GAAahrE,UAAUirE,gBAAkB,SAAUN,EAAYC,GAC7D,IAAI5gE,EAAO1I,KACX,OAAOA,KAAK4pE,aAAaP,EAAYC,GAAS/gD,KAAK,WACjD,OAAO7f,EAAKmhE,aAAaR,EAAYC,MAIzCI,GAAahrE,UAAUkrE,aAAe,SAAUP,EAAYC,GAC1D,OAAItpE,KAAK2wB,KAAKm5C,sBACLV,GAAiBppE,KAAKb,OAAQa,KAAKsL,GAAI+9D,EAC5CC,EAAStpE,KAAKupE,aAETj1C,QAAQ1nB,SAAQ,IAI3B88D,GAAahrE,UAAUmrE,aAAe,SAAUR,EAAYC,GAC1D,GAAItpE,KAAK2wB,KAAKo5C,sBAAuB,CACnC,IAAIrhE,EAAO1I,KACX,OAAOopE,GAAiBppE,KAAKmO,IAAKnO,KAAKsL,GAAI+9D,EACzCC,EAAStpE,KAAKupE,aACb7qB,MAAM,SAAUn7C,GACf,GAAIymE,GAAiBzmE,GAEnB,OADAmF,EAAKioB,KAAKo5C,uBAAwB,GAC3B,EAET,MAAMxmE,IAGV,OAAO+wB,QAAQ1nB,SAAQ,IAI3B,IAAIq9D,GAAc,CAChB,UAAa,SAAUC,EAAWC,GAEhC,OAAwD,IAApDnlB,GAAQklB,EAAUvrB,SAAUwrB,EAAUxrB,UACjCwrB,EAAUxrB,SAGZ,GAET,EAAK,SAAUurB,EAAWC,GAExB,OAyEJ,SAAgCC,EAAQC,GACtC,GAAID,EAAOZ,aAAea,EAAOb,WAC/B,MAAO,CACL7qB,SAAUyrB,EAAOzrB,SACjBvI,QAASg0B,EAAOh0B,SAIpB,OAGF,SAASk0B,EAA0BC,EAAeC,GAGhD,IAAIC,EAAIF,EAAc,GACtB,IAAIG,EAAaH,EAAcl7D,MAAM,GACrC,IAAIs7D,EAAIH,EAAc,GACtB,IAAII,EAAaJ,EAAcn7D,MAAM,GAErC,IAAKo7D,GAA8B,IAAzBD,EAAcppE,OACtB,MAAO,CACLu9C,SAAUwqB,GACV/yB,QAAS,IAIb,IAAIy0B,EAAWJ,EAAEjB,WAEjB,GAAIsB,GAAaD,EAAUL,GACzB,MAAO,CACL7rB,SAAU8rB,EAAE9rB,SACZvI,QAASm0B,GAIb,IAAI/e,EAAWmf,EAAEnB,WACjB,GAAIsB,GAAatf,EAAUkf,GACzB,MAAO,CACL/rB,SAAUgsB,EAAEhsB,SACZvI,QAASw0B,GAIb,OAAON,EAA0BI,EAAYE,GAnCtCN,CAA0BF,EAAOh0B,QAASi0B,EAAOj0B,SAjF/C20B,CAAuBZ,EAAWD,GAAWvrB,WAuHxD,SAASmsB,GAAaE,EAAW50B,GAC/B,IAAI60B,EAAQ70B,EAAQ,GAChB3X,EAAO2X,EAAQ/mC,MAAM,GAEzB,SAAK27D,GAAgC,IAAnB50B,EAAQh1C,UAItB4pE,IAAcC,EAAMzB,YAIjBsB,GAAaE,EAAWvsC,IAGjC,SAASurC,GAAiBzmE,GACxB,MAA6B,iBAAfA,EAAIspC,QAAwD,IAAjC56B,KAAKsT,MAAMhiB,EAAIspC,OAAS,KAnInE68B,GAAahrE,UAAUwsE,cAAgB,WACrC,IAAIxiE,EAAO1I,KAEX,OAAI0I,EAAKioB,MAAQjoB,EAAKioB,KAAKo5C,wBAA0BrhE,EAAKioB,KAAKm5C,sBACtDphE,EAAKyF,IAAIxQ,IAAI+K,EAAK4C,IAAIid,KAAK,SAAU4hD,GAC1C,OAAOA,EAAUxrB,UAAYwqB,KAC5BzqB,MAAM,SAAUn7C,GAEjB,GAAmB,MAAfA,EAAIspC,OACN,MAAMtpC,EAER,OAAO4lE,KAIJzgE,EAAKvJ,OAAOxB,IAAI+K,EAAK4C,IAAIid,KAAK,SAAU2hD,GAC7C,OAAIxhE,EAAKioB,MAAQjoB,EAAKioB,KAAKm5C,wBAA0BphE,EAAKioB,KAAKo5C,sBACtDG,EAAUvrB,UAAYwqB,GAGxBzgE,EAAKyF,IAAIxQ,IAAI+K,EAAK4C,IAAIid,KAAK,SAAU4hD,GAI1C,OAAID,EAAUz/D,UAAY0/D,EAAU1/D,QAC3B0+D,IAKP1+D,EADEy/D,EAAUz/D,QACFy/D,EAAUz/D,QAAQe,WAElB,eAGGy+D,GACNA,GAAYx/D,GAASy/D,EAAWC,GAGlChB,GAXP,IAAI1+D,GAYH,SAAUlH,GACX,GAAmB,MAAfA,EAAIspC,QAAkBq9B,EAAUvrB,SAClC,OAAOj2C,EAAKyF,IAAImjC,IAAI,CAClBD,IAAK3oC,EAAK4C,GACVqzC,SAAUwqB,KACT5gD,KAAK,WACN,OAAO4gD,IACN,SAAU5lE,GACX,OAAIymE,GAAiBzmE,IACnBmF,EAAKioB,KAAKo5C,uBAAwB,EAC3BG,EAAUvrB,UAGZwqB,KAGX,MAAM5lE,MAEPm7C,MAAM,SAAUn7C,GACjB,GAAmB,MAAfA,EAAIspC,OACN,MAAMtpC,EAER,OAAO4lE,MAwEX,IAAIgC,GAAoB,EAwCxB,SAASC,GAAsBj9D,EAAKhP,EAAQwxB,GAC1C,IAAI+kC,EAAS/kC,EAAKy4B,QAAUz4B,EAAKy4B,QAAQxT,KAAKoP,IAAW,GACrD2E,EAAYh5B,EAAKxX,OAASwX,EAAKxX,OAAO3N,WAAa,GACnD6/D,EAAc,GACdC,EAAkB,GAClBngD,EAAW,GAiBf,OAZIwF,EAAKxF,WACPA,EAAWnd,KAAKC,UAAU0iB,EAAKxF,WAG7BwF,EAAKxX,QAAUwX,EAAKwe,eACtBk8B,EAAcr9D,KAAKC,UAxBvB,SAAmCo9D,GACjC,OAAO7tE,OAAOmH,KAAK0mE,GAAaz1B,KAAKoP,IAAS1yB,OAAO,SAAUllB,EAAQ/O,GAErE,OADA+O,EAAO/O,GAAOgtE,EAAYhtE,GACnB+O,GACN,IAoB4Bm+D,CAA0B56C,EAAKwe,gBAG1Dxe,EAAKxX,QAA0B,UAAhBwX,EAAKxX,SACtBmyD,EAAiB36C,EAAKpb,KAAK/J,YAGtB8oB,QAAQ0qB,IAAI,CAAC7wC,EAAI7C,KAAMnM,EAAOmM,OAAOid,KAAK,SAAUrc,GACzD,IAAIs/D,EAAYt/D,EAAI,GAAKA,EAAI,GAAKy9C,EAAY2hB,EAC5CD,EAAc3V,EAASvqC,EACzB,OAAO,IAAImJ,QAAQ,SAAU1nB,GAC3B8mC,GAAU83B,EAAW5+D,OAEtB2b,KAAK,SAAUkjD,GAKhB,MAAO,WADPA,EAASA,EAAO/8D,QAAQ,MAAO,KAAKA,QAAQ,MAAO,QAKvD,SAASg9D,GAAUv9D,EAAKhP,EAAQwxB,EAAM44C,EAAan8D,GACjD,IACIu+D,EAgBAC,EACAC,EAlBAC,EAAU,GAEVC,EAAe,CACjB5+B,IAAK,EACLD,QAAS,GACTrC,KAAM,IAEJmhC,GAAoB,EACpBC,GAAmB,EACnBC,GAAuB,EACvBvtB,EAAW,EACXrD,EAAa3qB,EAAK2qB,YAAc3qB,EAAK4qB,OAAQ,EAC7CwiB,EAAaptC,EAAKotC,YAAc,IAChCoO,EAAgBx7C,EAAKw7C,eAAiB,GACtCC,GAAiB,EACjBhjB,EAAUz4B,EAAKy4B,QACfj+B,EAAWwF,EAAKxF,SAGhBkhD,EAAc,GAEd/C,EAAU90B,KAEdpnC,EAASA,GAAU,CACjBq9B,IAAI,EACJ6hC,YAAY,IAAIt6C,MAAO8W,cACvByjC,UAAW,EACXC,aAAc,EACdC,mBAAoB,EACpB9gE,OAAQ,IAGV,IAAIshC,EAAc,GAGlB,SAASy/B,IACP,OAAIb,EACKv3C,QAAQ1nB,UAEVw+D,GAAsBj9D,EAAKhP,EAAQwxB,GAAMpI,KAAK,SAAUrc,GAC7D0/D,EAAQ1/D,EAER,IAAIygE,EAAiB,GAEnBA,GADsB,IAApBh8C,EAAK04C,WACU,CAAEU,uBAAuB,EAAOD,uBAAuB,GAC3C,WAApBn5C,EAAK04C,WACG,CAAEU,uBAAuB,EAAMD,uBAAuB,GAC1C,WAApBn5C,EAAK04C,WACG,CAAEU,uBAAuB,EAAOD,uBAAuB,GAEvD,CAAEC,uBAAuB,EAAMD,uBAAuB,GAGzE+B,EAAe,IAAInC,GAAav7D,EAAKhP,EAAQysE,EAAOrC,EAAaoD,KAIrE,SAASC,IAGP,GAFAP,EAAc,GAEmB,IAA7BV,EAAa9gC,KAAKzpC,OAAtB,CAGA,IAAIypC,EAAO8gC,EAAa9gC,KACpBgiC,EAAW,CAAC/iE,QAAS6mB,EAAK7mB,SAC9B,OAAO3K,EAAO48C,SAAS,CAAClR,KAAMA,EAAM2R,WAAW,GAAQqwB,GAAUtkD,KAAK,SAAUrc,GAE9E,GAAIq9D,EAAYl8B,UAEd,MADAy/B,IACM,IAAIvrE,MAAM,aAKlB,IAAIwrE,EAAavvE,OAAOY,OAAO,MAC/B8N,EAAIoC,QAAQ,SAAUpC,GAChBA,EAAI7I,QACN0pE,EAAW7gE,EAAIZ,IAAMY,KAIzB,IAAI8gE,EAAWxvE,OAAOmH,KAAKooE,GAAY3rE,OACvCgM,EAAOq/D,oBAAsBO,EAC7B5/D,EAAOo/D,cAAgB3hC,EAAKzpC,OAAS4rE,EAErCniC,EAAKv8B,QAAQ,SAAU+gC,GACrB,IAAIhsC,EAAQ0pE,EAAW19B,EAAIgC,KAC3B,GAAIhuC,EAAO,CACT+J,EAAOzB,OAAOxK,KAAKkC,GAEnB,IAAI4pE,GAAa5pE,EAAMhG,MAAQ,IAAI6gB,cACnC,GAAkB,iBAAd+uD,GAA8C,cAAdA,EAGlC,MAAM5pE,EAFNkmE,EAAYtoE,KAAK,SAAU2nC,EAAMvlC,SAKnCgpE,EAAYlrE,KAAKkuC,MAIpB,SAAU9rC,GAEX,MADA6J,EAAOq/D,oBAAsB5hC,EAAKzpC,OAC5BmC,KAIV,SAAS2pE,IACP,GAAIvB,EAAatoE,MACf,MAAM,IAAI9B,MAAM,qCAElB6L,EAAOuxC,SAAWA,EAAWgtB,EAAax+B,IAC1C,IAAIggC,EAAYvkC,EAAMx7B,GAYtB,OAXIi/D,EAAYjrE,SACd+rE,EAAUtiC,KAAOwhC,EAGmB,iBAAzBV,EAAa1yB,UACtBk0B,EAAUl0B,QAAU0yB,EAAa1yB,eAC1B0yB,EAAa1yB,SAEtBswB,EAAYtoE,KAAK,SAAUksE,IAE7BnB,GAAoB,EACbH,EAAalC,gBAAgBgC,EAAax+B,IAC7Cm8B,GAAS/gD,KAAK,WAGhB,GAFAyjD,GAAoB,EAEhBzC,EAAYl8B,UAEd,MADAy/B,IACM,IAAIvrE,MAAM,aAElBoqE,OAAezrE,EACfktE,MACC1uB,MAAM,SAAUn7C,GAEjB,MADA8pE,EAAkB9pE,GACZA,IA2BV,SAAS+pE,IACP,OAAOrF,GAAQ95D,EAAKhP,EAAQwsE,EAAazD,MAAOqB,GAAahhD,KAAK,SAAUglD,GAC1E5B,EAAatoE,OAASkqE,EAAI9iC,GAC1B8iC,EAAI1iC,KAAKv8B,QAAQ,SAAU+gC,UAClBs8B,EAAazD,MAAM74B,EAAIgC,KAC9BjkC,EAAOm/D,YACPZ,EAAa9gC,KAAK1pC,KAAKkuC,OAK7B,SAASm+B,IAlCT,IACM11B,EAkCAyxB,EAAYl8B,WAAas+B,IAGN,IAAnBG,EAAQ1qE,QAIZuqE,EAAeG,EAAQznE,SAzCnByzC,EAAO,GACX6zB,EAAaz+B,QAAQ5+B,QAAQ,SAAU8gC,GAGnB,WAAdA,EAAO9jC,KAGXwsC,EAAK1I,EAAO9jC,IAAM8jC,EAAOlC,QAAQ9gC,IAAI,SAAUsN,GAC7C,OAAOA,EAAEoyB,SAGN3sC,EAAOm+C,SAASxF,GAAMvvB,KAAK,SAAU2/C,GAE1C,GAAIqB,EAAYl8B,UAEd,MADAy/B,IACM,IAAIvrE,MAAM,aAGlBoqE,EAAazD,MAAQA,KAyBpB3/C,KAAK+kD,GACL/kD,KAAKqkD,GACLrkD,KAAK2kD,GACL3kD,KAAKilD,GACL9uB,MAAM,SAAUn7C,GACfkqE,EAAiB,yCAA0ClqE,MAV7DmqE,GAAoB,IAexB,SAASA,EAAoBC,GACS,IAAhC5B,EAAa7+B,QAAQ9rC,QAavBusE,GACA1B,GACAF,EAAa7+B,QAAQ9rC,QAAU28D,KAE/B+N,EAAQ3qE,KAAK4qE,GACbA,EAAe,CACb5+B,IAAK,EACLD,QAAS,GACTrC,KAAM,IAEkB,YAAtB0+B,EAAYznE,OAA6C,YAAtBynE,EAAYznE,QACjDynE,EAAYznE,MAAQ,SACpBynE,EAAYtoE,KAAK,WAEnBusE,KA1BuB,IAAnB1B,EAAQ1qE,QAAiBuqE,KACtBrwB,GAAcrO,EAAYsO,MAAS0wB,KACtC1C,EAAYznE,MAAQ,UACpBynE,EAAYtoE,KAAK,WAEfgrE,GACFa,KAyBR,SAASW,EAAiB15C,EAAQxwB,GAC5B2oE,IAGC3oE,EAAIC,UACPD,EAAIC,QAAUuwB,GAEhB3mB,EAAOq9B,IAAK,EACZr9B,EAAOy/B,OAAS,WAChBi/B,EAAU,GACVC,EAAe,CACb5+B,IAAK,EACLD,QAAS,GACTrC,KAAM,IAERiiC,EAAoBvpE,IAItB,SAASupE,EAAoBc,GAC3B,KAAI1B,GAIA3C,EAAYl8B,YACdjgC,EAAOy/B,OAAS,YACZm/B,IASN,GALA5+D,EAAOy/B,OAASz/B,EAAOy/B,QAAU,WACjCz/B,EAAOygE,UAAW,IAAI77C,MAAO8W,cAC7B17B,EAAOuxC,SAAWA,EAClButB,GAAuB,EAEnB0B,EAAY,EAEdA,EAAa/+B,GAAY++B,IACdxgE,OAASA,EAGpB,IAAI6/D,GAAaW,EAAWvwE,MAAQ,IAAI6gB,cACtB,iBAAd+uD,GAA8C,cAAdA,GAClC1D,EAAYtoE,KAAK,QAAS2sE,GAC1BrE,EAAY7kE,sBA3VpB,SAAiBisB,EAAM44C,EAAalmE,EAAOqyB,GACzC,IAAmB,IAAf/E,EAAKm9C,MAGP,OAFAvE,EAAYtoE,KAAK,QAASoC,QAC1BkmE,EAAY7kE,qBAQd,GAJsC,mBAA3BisB,EAAKo9C,oBACdp9C,EAAKo9C,kBAAoBvhC,GAE3B+8B,EAAYtoE,KAAK,eAAgBoC,GACP,WAAtBkmE,EAAYznE,OAA4C,YAAtBynE,EAAYznE,MAAqB,CACrEynE,EAAYtoE,KAAK,SAAUoC,GAC3BkmE,EAAYznE,MAAQ,UACpB,IAAIksE,EAAa,WACfr9C,EAAKs9C,iBAAmB9C,IAK1B5B,EAAYvlE,KAAK,SAHS,WACxBulE,EAAYpnE,eAAe,SAAU6rE,KAGvCzE,EAAYvlE,KAAK,SAAUgqE,GAG7Br9C,EAAKs9C,iBAAmBt9C,EAAKs9C,kBAAoB9C,GACjDx6C,EAAKs9C,iBAAmBt9C,EAAKo9C,kBAAkBp9C,EAAKs9C,kBACpDpnE,WAAW6uB,EAAU/E,EAAKs9C,kBAmUpBC,CAAQv9C,EAAM44C,EAAaqE,EAAY,WACrClC,GAAUv9D,EAAKhP,EAAQwxB,EAAM44C,UAIjCA,EAAYtoE,KAAK,WAAYmM,GAC7Bm8D,EAAY7kE,qBAKhB,SAAS4oC,EAAS8B,EAAQ6J,EAASC,GAEjC,GAAIqwB,EAAYl8B,UACd,OAAOy/B,IAIc,iBAAZ7zB,IACT8yB,EAAa9yB,QAAUA,GAGZjK,GAAare,EAAbqe,CAAmBI,KAIhC28B,EAAa5+B,IAAMiC,EAAOjC,KAAO+L,EACjC6yB,EAAa7+B,QAAQ/rC,KAAKiuC,GAC1B,IAAU,WACRs+B,EAAuC,IAAnB5B,EAAQ1qE,QAAgB6rC,EAAYsO,SAK5D,SAAS4yB,EAAkBjhC,GAGzB,GAFAk/B,GAAiB,EAEb7C,EAAYl8B,UACd,OAAOy/B,IAKT,GAAI5/B,EAAQ9B,QAAQhqC,OAAS,EAC3B6rC,EAAYG,MAAQF,EAAQ9B,QAAQ8B,EAAQ9B,QAAQhqC,OAAS,GAAG+rC,IAChEigC,IACAM,GAAoB,OACf,CAEL,IAAI70B,EAAW,WACTyC,GACFrO,EAAYsO,MAAO,EACnB6xB,KAEAnB,GAAmB,EAErByB,GAAoB,IAIjB/B,GAA2C,IAA3Bz+B,EAAQ9B,QAAQhqC,OAUnCy3C,KATAmzB,GAAoB,EACpBH,EAAalC,gBAAgBz8B,EAAQyR,SACjC2qB,GAAS/gD,KAAK,WAChByjD,GAAoB,EACpB5+D,EAAOuxC,SAAWA,EAAWzR,EAAQyR,SACrC9F,MAED6F,MAAM2uB,KAQb,SAASe,EAAe7qE,GAGtB,GAFA6oE,GAAiB,EAEb7C,EAAYl8B,UACd,OAAOy/B,IAETW,EAAiB,mBAAoBlqE,GAIvC,SAAS6pE,IACP,IACGhB,IACAH,GACDH,EAAQ1qE,OAAS+qE,EAHnB,CAOAC,GAAiB,EAQb7C,EAAY3tB,WACd2tB,EAAYpnE,eAAe,SAAUonE,EAAY8E,eACjD9E,EAAY3tB,SAAS5C,UAEvBuwB,EAAYvlE,KAAK,SAAUsqE,GAE3B,IAAIphC,EAAU/+B,EAAI++B,QAAQD,GACvBnpC,GAAG,SAAUwpC,GAChBJ,EAAQ3kB,KAAKpmB,EAAgBA,GAC7B+qC,EAAQ3kB,KAAK4lD,GACVzvB,MAAM0vB,GAELz9C,EAAKm9C,QAEPvE,EAAY3tB,SAAW1O,EACvBq8B,EAAY8E,cAAgBC,GAtB9B,SAASA,IACPphC,EAAQ8L,SAEV,SAAS72C,IACPonE,EAAYpnE,eAAe,SAAUmsE,IAuBzC,SAASC,IACP7B,IAAmBnkD,KAAK,WAEtB,IAAIghD,EAAYl8B,UAIhB,OAAOw+B,EAAaX,gBAAgB3iD,KAAK,SAAU8gD,GAEjDp8B,EAAc,CACZG,MAFFuR,EAAW0qB,EAGTxjD,MAAOk4C,EACPA,WAAYA,EACZlsD,MAAO,WACPu3C,QAASA,EACTj+B,SAAUA,EACV0zB,aAAa,GAEXluB,EAAKxX,SACoB,iBAAhBwX,EAAKxX,OAEd8zB,EAAYuC,cAAe,EAE3BvC,EAAY9zB,OAASwX,EAAKxX,QAG1B,cAAewX,IACjBsc,EAAY+wB,UAAYrtC,EAAKqtC,WAE3B,YAAartC,IACfsc,EAAYnjC,QAAU6mB,EAAK7mB,SAEzB6mB,EAAKwe,eACPlC,EAAYkC,aAAexe,EAAKwe,cAE9Bxe,EAAKpb,OACP03B,EAAY13B,KAAOob,EAAKpb,MAE1B63D,MAlCAN,MAoCDpuB,MAAM,SAAUn7C,GACjBkqE,EAAiB,+BAAgClqE,KAKrD,SAAS8pE,EAAkB9pE,GACzByoE,GAAoB,EACpByB,EAAiB,uCAAwClqE,GA1Z3DgmE,EAAYruB,MAAM/sC,EAAKhP,GA8ZnBoqE,EAAYl8B,UACdy/B,KAIGvD,EAAYiF,kBACfjF,EAAYvlE,KAAK,SAAU8oE,GAEE,mBAAlBn8C,EAAKkoB,WACd0wB,EAAYvlE,KAAK,QAAS2sB,EAAKkoB,UAC/B0wB,EAAYvlE,KAAK,WAAY,SAAUoJ,GACrCujB,EAAKkoB,SAAS,KAAMzrC,MAGxBm8D,EAAYiF,iBAAkB,QAGN,IAAf79C,EAAKyc,MACdmhC,IAEA7B,IAAmBnkD,KAAK,WAEtB,OADAyjD,GAAoB,EACbH,EAAalC,gBAAgBh5C,EAAKyc,MAAOk8B,KAC/C/gD,KAAK,WACNyjD,GAAoB,EAEhBzC,EAAYl8B,UACdy/B,KAGFnuB,EAAWhuB,EAAKyc,MAChBmhC,OACC7vB,MAAM2uB,IAOb,SAASoB,KACP,eAAaxxE,KAAK+C,MAClBA,KAAKqtC,WAAY,EACjBrtC,KAAK8B,MAAQ,UACb,IAAI4G,EAAO1I,KACPq0B,EAAU,IAAIC,QAAQ,SAAUgV,EAAS/U,GAC3C7rB,EAAK1E,KAAK,WAAYslC,GACtB5gC,EAAK1E,KAAK,QAASuwB,KAErB7rB,EAAK6f,KAAO,SAAU3b,EAAS2nB,GAC7B,OAAOF,EAAQ9L,KAAK3b,EAAS2nB,IAE/B7rB,EAAKg2C,MAAQ,SAAUnqB,GACrB,OAAOF,EAAQqqB,MAAMnqB,IAIvB7rB,EAAKg2C,MAAM,cA4Bb,SAASgwB,GAAQ/jC,EAAIha,GACnB,IAAIg+C,EAAmBh+C,EAAKg+C,iBAC5B,MAAkB,iBAAPhkC,EACF,IAAIgkC,EAAiBhkC,EAAIha,GAEzBga,EAIX,SAASikC,GAAiBzgE,EAAKhP,EAAQwxB,EAAM+E,GAU3C,GARoB,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,SAEW,IAATA,IACTA,EAAO,IAGLA,EAAKy4B,UAAY3mD,MAAM2L,QAAQuiB,EAAKy4B,SACtC,MAAMva,GAAYL,EACC,6CAGrB7d,EAAKkoB,SAAWnjB,GAChB/E,EAAOiY,EAAMjY,IACR2qB,WAAa3qB,EAAK2qB,YAAc3qB,EAAK4qB,KAC1C5qB,EAAKm9C,MAAS,UAAWn9C,GAAQA,EAAKm9C,MAEtCn9C,EAAKg+C,iBAAmBh+C,EAAKg+C,kBAAoB3uE,KACjD,IAAI6uE,EAAe,IAAIJ,GAAY99C,GAInC,OADA+6C,GAFegD,GAAQvgE,EAAKwiB,GACV+9C,GAAQvvE,EAAQwxB,GACDA,EAAMk+C,GAChCA,EAIT,SAASv3C,GAAKnpB,EAAKhP,EAAQwxB,EAAM+E,GAa/B,MAZoB,mBAAT/E,IACT+E,EAAW/E,EACXA,EAAO,SAEW,IAATA,IACTA,EAAO,KAETA,EAAOiY,EAAMjY,IAERg+C,iBAAmBh+C,EAAKg+C,kBAAoB3uE,KAG1C,IAAI8uE,GAFX3gE,EAAMugE,GAAQvgE,EAAKwiB,GACnBxxB,EAASuvE,GAAQvvE,EAAQwxB,GACIA,EAAM+E,GAGrC,SAASo5C,GAAK3gE,EAAKhP,EAAQwxB,EAAM+E,GAC/B,IAAIhtB,EAAO1I,KACXA,KAAK+uE,UAAW,EAEhB,IAAIC,EAAWr+C,EAAKxvB,KAAOssC,EAAsB,GAAI9c,EAAMA,EAAKxvB,MAAQwvB,EACpEs+C,EAAWt+C,EAAKu+C,KAAOzhC,EAAsB,GAAI9c,EAAMA,EAAKu+C,MAAQv+C,EAQxE,SAASw+C,EAAW//B,GAClB1mC,EAAKzH,KAAK,SAAU,CAClBmuE,UAAW,OACXhgC,OAAQA,IAGZ,SAASigC,EAAWjgC,GAClB1mC,EAAKzH,KAAK,SAAU,CAClBmuE,UAAW,OACXhgC,OAAQA,IAGZ,SAASkgC,EAAWjgC,GAClB3mC,EAAKzH,KAAK,SAAU,CAClBmuE,UAAW,OACX//B,IAAKA,IAGT,SAASkgC,EAAWlgC,GAClB3mC,EAAKzH,KAAK,SAAU,CAClBmuE,UAAW,OACX//B,IAAKA,IAGT,SAASmgC,IACP9mE,EAAK8mE,YAAa,EAEd9mE,EAAK+mE,YACP/mE,EAAKzH,KAAK,UAGd,SAASwuE,IACP/mE,EAAK+mE,YAAa,EAEd/mE,EAAK8mE,YACP9mE,EAAKzH,KAAK,UAGd,SAASyuE,IACPhnE,EAAK8mE,YAAa,EAEd9mE,EAAK+mE,YACP/mE,EAAKzH,KAAK,SAAU,CAClBmuE,UAAW,SAIjB,SAASO,IACPjnE,EAAK+mE,YAAa,EAEd/mE,EAAK8mE,YACP9mE,EAAKzH,KAAK,SAAU,CAClBmuE,UAAW,SA1DjBpvE,KAAKmB,KAAOytE,GAAiBzgE,EAAKhP,EAAQ6vE,GAC1ChvE,KAAKkvE,KAAON,GAAiBzvE,EAAQgP,EAAK8gE,GAE1CjvE,KAAKwvE,YAAa,EAClBxvE,KAAKyvE,YAAa,EA2DlB,IAAIG,EAAU,GAEd,SAASC,EAAUpvE,GACjB,OAAO,SAAU8qB,EAAO6d,IACG,WAAV7d,IACZ6d,IAAS+lC,GAAc/lC,IAASimC,IACV,WAAV9jD,IACZ6d,IAASmmC,GAAcnmC,IAASkmC,IACV,WAAV/jD,IACZ6d,IAASqmC,GAAcrmC,IAASomC,IACV,WAAVjkD,IACZ6d,IAASumC,GAAcvmC,IAASsmC,MAG3BnkD,KAASqkD,IACbA,EAAQrkD,GAAS,IAEnBqkD,EAAQrkD,GAAO9qB,IAAQ,EACoB,IAAvCjD,OAAOmH,KAAKirE,EAAQrkD,IAAQnqB,QAE9BsH,EAAKhE,mBAAmB6mB,KAWhC,SAASukD,EAAeh3B,EAAIvtB,EAAO7qB,IACa,GAA1Co4C,EAAGl1C,UAAU2nB,GAAOhd,QAAQ7N,IAC9Bo4C,EAAGh1C,GAAGynB,EAAO7qB,GAPbiwB,EAAK4qB,OACPv7C,KAAKmB,KAAK2C,GAAG,WAAY4E,EAAKwmE,KAAKl2B,OAAO16C,KAAKoK,EAAKwmE,OACpDlvE,KAAKkvE,KAAKprE,GAAG,WAAY4E,EAAKvH,KAAK63C,OAAO16C,KAAKoK,EAAKvH,QAStDnB,KAAK8D,GAAG,cAAe,SAAUynB,GACjB,WAAVA,GACFukD,EAAepnE,EAAKwmE,KAAM,SAAUC,GACpCW,EAAepnE,EAAKvH,KAAM,SAAUkuE,IACjB,WAAV9jD,GACTukD,EAAepnE,EAAKwmE,KAAM,SAAUK,GACpCO,EAAepnE,EAAKvH,KAAM,SAAUmuE,IACjB,WAAV/jD,GACTukD,EAAepnE,EAAKwmE,KAAM,SAAUS,GACpCG,EAAepnE,EAAKvH,KAAM,SAAUuuE,IACjB,WAAVnkD,IACTukD,EAAepnE,EAAKwmE,KAAM,SAAUO,GACpCK,EAAepnE,EAAKvH,KAAM,SAAUquE,MAIxCxvE,KAAK8D,GAAG,iBAAkB,SAAUynB,GACpB,WAAVA,GACF7iB,EAAKwmE,KAAK/sE,eAAe,SAAUgtE,GACnCzmE,EAAKvH,KAAKgB,eAAe,SAAUktE,IAChB,WAAV9jD,GACT7iB,EAAKwmE,KAAK/sE,eAAe,SAAUotE,GACnC7mE,EAAKvH,KAAKgB,eAAe,SAAUmtE,IAChB,WAAV/jD,GACT7iB,EAAKwmE,KAAK/sE,eAAe,SAAUwtE,GACnCjnE,EAAKvH,KAAKgB,eAAe,SAAUutE,IAChB,WAAVnkD,IACT7iB,EAAKwmE,KAAK/sE,eAAe,SAAUstE,GACnC/mE,EAAKvH,KAAKgB,eAAe,SAAUqtE,MAIvCxvE,KAAKkvE,KAAKprE,GAAG,iBAAkB+rE,EAAU,SACzC7vE,KAAKmB,KAAK2C,GAAG,iBAAkB+rE,EAAU,SAEzC,IAAIx7C,EAAUC,QAAQ0qB,IAAI,CACxBh/C,KAAKmB,KACLnB,KAAKkvE,OACJ3mD,KAAK,SAAUghB,GAChB,IAAIrmB,EAAM,CACR/hB,KAAMooC,EAAK,GACX2lC,KAAM3lC,EAAK,IAOb,OALA7gC,EAAKzH,KAAK,WAAYiiB,GAClBwS,GACFA,EAAS,KAAMxS,GAEjBxa,EAAKhE,qBACEwe,GACN,SAAU3f,GAaX,GAZAmF,EAAKswC,SACDtjB,EAGFA,EAASnyB,GAKTmF,EAAKzH,KAAK,QAASsC,GAErBmF,EAAKhE,qBACDgxB,EAEF,MAAMnyB,IAIVvD,KAAKuoB,KAAO,SAAUwnD,EAASxsE,GAC7B,OAAO8wB,EAAQ9L,KAAKwnD,EAASxsE,IAG/BvD,KAAK0+C,MAAQ,SAAUn7C,GACrB,OAAO8wB,EAAQqqB,MAAMn7C,IAxRzB,IAASkrE,GAAa,gBAqBtBA,GAAY/vE,UAAUs6C,OAAS,WAC7Bh5C,KAAKqtC,WAAY,EACjBrtC,KAAK8B,MAAQ,YACb9B,KAAKiB,KAAK,WAGZwtE,GAAY/vE,UAAUw8C,MAAQ,SAAU/sC,EAAKhP,GAC3C,IAAIuJ,EAAO1I,KAMX,SAAS+4C,IACPrwC,EAAKswC,SANHtwC,EAAKsnE,eAGTtnE,EAAKsnE,cAAe,EAKpB7hE,EAAInK,KAAK,YAAa+0C,GACtB55C,EAAO6E,KAAK,YAAa+0C,GAKzBrwC,EAAK1E,KAAK,WAJV,WACEmK,EAAIhM,eAAe,YAAa42C,GAChC55C,EAAOgD,eAAe,YAAa42C,OA0CvC,IAAS+1B,GAAM,gBAyMfA,GAAKpwE,UAAUs6C,OAAS,WACjBh5C,KAAK+uE,WACR/uE,KAAK+uE,UAAW,EAChB/uE,KAAKmB,KAAK63C,SACVh5C,KAAKkvE,KAAKl2B,WA8BdiB,GAAQuI,OAjqHR,SAAmBvI,GACjBA,EAAQK,QAAQ,MAAOoc,IAAU,KAiqHhClU,OAvkFH,SAAsBvI,GACpBA,EAAQK,QAAQ,OAAQ6gB,IAAW,GACnClhB,EAAQK,QAAQ,QAAS6gB,IAAW,KAskFnC3Y,OAAOslB,IACPtlB,OA7BH,SAAqBvI,GACnBA,EAAQyxB,UAAYkD,GACpB30B,EAAQ3iB,KAAOA,GAEf95B,OAAOC,eAAew8C,EAAQv7C,UAAW,YAAa,CACpDf,IAAK,WACH,IAAI+K,EAAO1I,KAWX,YAVqC,IAA1BA,KAAKiwE,mBACdjwE,KAAKiwE,iBAAmB,CACtBj8D,KAAM,SAAUk8D,EAAOv/C,EAAM+E,GAC3B,OAAOhtB,EAAKzD,YAAYymE,UAAUwE,EAAOxnE,EAAMioB,EAAM+E,IAEvDhI,GAAI,SAAUwiD,EAAOv/C,EAAM+E,GACzB,OAAOhtB,EAAKzD,YAAYymE,UAAUhjE,EAAMwnE,EAAOv/C,EAAM+E,MAIpD11B,KAAKiwE,oBAIhBh2B,EAAQv7C,UAAU44B,KAAO,SAAUwV,EAAQnc,EAAM+E,GAC/C,OAAO11B,KAAKiF,YAAYqyB,KAAKt3B,KAAM8sC,EAAQnc,EAAM+E,MAWtC,c,oGCphUf,cAEA,QACA,SACA,SAyNqB,EAAAxK,QAhNrB,MAwBE,YAAagwC,GACN,EAAAiV,cAAcjV,EAAOkV,WACxBzuE,QAAQ0B,MAAM,gCAGhBrD,KAAKk7D,OAASA,EACdl7D,KAAKowE,SAAWlV,EAAOkV,SAMzB,UAAUlV,SACiBh7D,IAArBg7D,EAAOmV,gBAAgDnwE,IAApBg7D,EAAOoV,eAA8CpwE,IAApBg7D,EAAOqV,WAE7E,EAAAC,gBAAgBxwE,WAGOE,IAArBg7D,EAAOmV,YACTrwE,KAAKqwE,UAAY,IAAInV,EAAOmV,UAAUrwE,YAEhBE,IAApBg7D,EAAOqV,WACTvwE,KAAKywE,SAAW,IAAIvV,EAAOqV,SAASvwE,WACZE,IAApBg7D,EAAOoV,WACTtwE,KAAKswE,SAAW,IAAIpV,EAAOoV,SAAStwE,QAQ1C,QASE,YAAUuoB,KAAK,KACbvoB,KAAKuV,KAAO,IAAIvV,KAAKk7D,OAAOwV,KAAK1wE,KAAMA,KAAKk7D,OAAOyV,QAAS3wE,KAAKowE,SAASQ,OAC1E5wE,KAAK3C,KAAO2C,KAAKowE,SAAS/lE,MAE1BrK,KAAK6wE,KAAO,IAAI,UAAS7wE,KAAKowE,UAC9BpwE,KAAK6pB,KAAO,IAAI7pB,KAAKk7D,OAAO4V,KAAK9wE,MAEjCwH,OAAOX,WAAW7G,KAAK+wE,UAAUzyE,KAAK0B,MAAO,IAAMA,KAAKk7D,QACjDl7D,KAAK6wE,KAAKG,WAChBzoD,KAAK,KACNvoB,KAAKwoB,sBAAqB,KAQ9B,qBAAsByoD,GAAQ,GAC5B,MAAMC,EAASlxE,KAAKuV,KAAK47D,iBACzBnxE,KAAKuV,KAAK67D,WAAWF,EAAQD,GAM/B,4BAA6BA,GAAQ,GACnC,MAAMC,EAASlxE,KAAKuV,KAAK47D,iBACzB,OAAO78C,QAAQ1nB,QAAQ5M,KAAKuV,KAAK67D,WAAWF,EAAQD,IAMtD,OACE,OAAOjxE,KAAK6wE,KAAKQ,KAAKrxE,KAAKuV,KAAKC,qBAMlC,OACE,OAAOxV,KAAK6wE,KAAKS,KAAKtxE,KAAKuV,KAAKC,qBAOlC,cACE,YAAuBtV,IAAnBF,KAAKqwE,UACArwE,KAAKqwE,UAAU3sC,mBACKxjC,IAAlBF,KAAKswE,SACP,OAEA,SASX,KAAMnkD,EAA4BolD,GAChC,OAAOvxE,KAAK6wE,KAAKvoD,KAAK6D,EAAQolD,GAQhC,eAAgBC,EAAmBD,GACjC,OAAOvxE,KAAK6wE,KAAKv7D,eAAek8D,EAAWD,GAO7C,SACE,OAAO,IAAKj9C,QAAQ,CAAC1nB,EAAS2nB,KAC5Bv0B,KAAK6wE,KAAKY,iBAAiBlpD,KAAK,KAC9BvoB,KAAKowE,SAA0B,gBAAIpwE,KAAK6wE,KAAKa,iBAC7C1xE,KAAKowE,SAASj9C,WAAY,IAAKnB,MAAQ8W,cACvC,MAAM3iC,EAAO,IAAIqB,OAAOuhC,KAAK,CAAC/6B,KAAKC,UAAUjO,KAAKowE,SAAU,KAAM,IAAK,CAAE3vE,KAAM,wBACzEiyC,EAAS,IAAIC,WACnBD,EAAOpiC,iBAAiB,OAAQ,KAC9B1D,EAAQ8lC,EAAOtlC,UAEjBslC,EAAOi/B,cAAcxrE,KACpBu4C,MAAMn7C,IAASgxB,EAAOhxB,OAO7B,OACE,OAAOvD,KAAK6wE,KAAKY,iBAMnB,WACE,OAAOzxE,KAAK6wE,KAAKe,WAQnB,WAAYV,GAIV,YAHehxE,IAAXgxE,IACFA,EAASlxE,KAAKuV,KAAKC,qBAEd,IAAI8e,QAAS1nB,IAClB5M,KAAK6wE,KAAKgB,OAAOX,GAAQ3oD,KAAMupD,IAC7BllE,EAAQ,0CAA4C6B,mBAAmBqjE,QAS7E,WAAYZ,GACV,OAAOlxE,KAAK6wE,KAAKgB,OAAOX,GAO1B,WAAYA,GACV,OAAOlxE,KAAK6wE,KAAKkB,OAAOb,M,gBCzN5B,IAAIc,EAAK,EAAQ,IACbz9B,EAAK,EAAQ,IAEbC,EAAOD,EACXC,EAAKw9B,GAAKA,EACVx9B,EAAKD,GAAKA,EAEV13C,EAAOD,QAAU43C,G,6BCgDjB,SAASjwC,EAAIoD,EAAK4D,EAAOw7C,GACvB,IAAIC,EAAkBD,EAAUA,EAAU3lD,OAAS,GAC/CuG,IAAQq/C,EAAgBlhD,UAE1BihD,EAAUxiD,MACVyiD,EAAkBD,EAAUA,EAAU3lD,OAAS,IAEjD,IAAI0E,EAAUkhD,EAAgBlhD,QAC1BmhD,EAAmBD,EAAgB1iD,MACvC,GAAI7B,MAAM2L,QAAQtI,GAChBA,EAAQ3E,KAAKwG,QACR,GAAIs/C,IAAqB17C,EAAMnK,OAAS,EAAG,CAEhD0E,EADUyF,EAAMhH,OACDoD,OAEf4D,EAAMpK,KAAKwG,GA/Df/K,EAAQqR,UAAY,SAAmBhB,GACrC,IAAI9F,EAAQ,GACZA,EAAMhG,KAAK,CAACwG,IAAKsF,IAIjB,IAFA,IACIqoB,EAAM3tB,EAAagW,EAAK7gB,EAAGm1E,EAAattE,EAAMuK,EAAG7Q,EAAKN,EAAOm0E,EAD7DhmE,EAAM,GAEFopB,EAAOnuB,EAAM5C,OAKnB,GAJAoD,EAAM2tB,EAAK3tB,IAGXuE,GAFSopB,EAAK8kB,QAAU,GACxBz8B,EAAM2X,EAAK3X,KAAO,GAGhBzR,GAAOyR,OACF,GAAmB,iBAARhW,EAChBuE,QAAsB,IAARvE,EAAsB,KAAOqG,KAAKC,UAAUtG,QACrD,GAAY,OAARA,EACTuE,GAAO,YACF,GAAIzJ,MAAM2L,QAAQzG,GAAM,CAE7B,IADAR,EAAMhG,KAAK,CAACwc,IAAK,MACZ7gB,EAAI6K,EAAIvG,OAAS,EAAGtE,GAAK,EAAGA,IAC/Bm1E,EAAoB,IAANn1E,EAAU,GAAK,IAC7BqK,EAAMhG,KAAK,CAACwG,IAAKA,EAAI7K,GAAIs9C,OAAQ63B,IAEnC9qE,EAAMhG,KAAK,CAACwc,IAAK,UACZ,CAEL,IAAKzO,KADLvK,EAAO,GACGgD,EACJA,EAAIhJ,eAAeuQ,IACrBvK,EAAKxD,KAAK+N,GAId,IADA/H,EAAMhG,KAAK,CAACwc,IAAK,MACZ7gB,EAAI6H,EAAKvD,OAAS,EAAGtE,GAAK,EAAGA,IAEhCiB,EAAQ4J,EADRtJ,EAAMsG,EAAK7H,IAEXo1E,EAAap1E,EAAI,EAAI,IAAM,GAC3Bo1E,GAAalkE,KAAKC,UAAU5P,GAAO,IACnC8I,EAAMhG,KAAK,CAACwG,IAAK5J,EAAOq8C,OAAQ83B,IAElC/qE,EAAMhG,KAAK,CAACwc,IAAK,MAGrB,OAAOzR,GAyBTtP,EAAQogC,MAAQ,SAAU/c,GAOxB,IANA,IAGIklC,EAAe8f,EAAUkN,EACzBC,EAAaC,EAAOC,EAAsBpvB,EAC1CiiB,EAAcC,EALd75D,EAAQ,GACRw7C,EAAY,GACZjqD,EAAI,IAMN,GAAuB,OADvBqoD,EAAiBllC,EAAInjB,OAEE,MAAnBqoD,QAC0B,IAAnBA,EAQX,OAAQA,GACN,IAAK,IACL,IAAK,KACL,IAAK,KACL,IAAK,IACL,IAAK,IACH,MACF,IAAK,IACHroD,GAAK,EACLyH,EAAI,KAAMgH,EAAOw7C,GACjB,MACF,IAAK,IACHjqD,GAAK,EACLyH,GAAI,EAAMgH,EAAOw7C,GACjB,MACF,IAAK,IACHjqD,GAAK,EACLyH,GAAI,EAAOgH,EAAOw7C,GAClB,MACF,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IAGH,IAFAke,EAAY,GACZnoE,MACa,CAEX,GADAq1E,EAAUlyD,EAAInjB,MACV,cAAc+Q,KAAKskE,GAEhB,CACLr1E,IACA,MAHAmoE,GAAakN,EAMjB5tE,EAAI2I,WAAW+3D,GAAY15D,EAAOw7C,GAClC,MACF,IAAK,IAIH,IAHAqrB,EAAe,GACfC,OAAS,EACTC,EAAwB,EAGX,OADXpvB,EAAKjjC,EAAInjB,OACqB,OAAXu1E,GACfC,EAAwB,GAAM,GAChCF,GAAgBlvB,EAED,QADfmvB,EAASnvB,GAEPovB,IAEAA,EAAwB,EAM9B/tE,EAAIyJ,KAAKgvB,MAAM,IAAMo1C,EAAe,KAAM7mE,EAAOw7C,GACjD,MACF,IAAK,IACHoe,EAAe,CAAEr/D,QAAS,GAAIxB,MAAOiH,EAAMnK,QAC3CmK,EAAMpK,KAAKgkE,EAAar/D,SACxBihD,EAAU5lD,KAAKgkE,GACf,MACF,IAAK,IACHC,EAAa,CAAEt/D,QAAS,GAAIxB,MAAOiH,EAAMnK,QACzCmK,EAAMpK,KAAKikE,EAAWt/D,SACtBihD,EAAU5lD,KAAKikE,GACf,MACF,QACE,MAAM,IAAI7jE,MACR,sCAAwC4jD,OAtF9C,CAGE,GAAqB,IAAjB55C,EAAMnK,OACR,OAAOmK,EAAMhH,MAEbA,EAAIgH,EAAMhH,MAAOgH,EAAOw7C,M,8ECzFhC,cAyFyB,EAAA77B,QA7CzB,MAaE,YAAa3V,EAAqBg9D,EAChC/gE,EAAoBqB,GACpB7S,KAAKuV,KAAOA,EACZvV,KAAKuyE,UAAYA,EACjBvyE,KAAKwR,WAAaA,EAClBxR,KAAK6S,YAAcA,EAEE9M,SAASiK,eAAe,oBAChC4L,UAxDjB,SAA+B42D,GAC7B,IAAIvkD,EACJ,wNA0BA,YAvBmB/tB,IAAfsyE,IACFvkD,GACA,mQAIFA,GACA,41CA4C2BwkD,CAAqBzyE,KAAK6S,aACnD7S,KAAKuV,KAAKm9D,kBAAkB1yE,KAAK2yE,oBAAoBr0E,KAAK0B,OAM5D,sBACMA,KAAK6S,aAEP+/D,EAAgBC,gBAAgB7yE,KAAK6S,aAEvC+/D,EAAgBE,oBAAoB9yE,KAAKuyE,UAAWvyE,KAAKwR,YAM3D,sBACEohE,EAAgBG,qBAAqB/yE,KAAKuyE,WAC1CK,EAAgBj+D,qB,8ECmKC,EAAAuW,QA7OrB,MAaE,YAAa7V,EAAoBs7D,EAA+BP,GAC9DpwE,KAAKqV,SAAWA,EAChBrV,KAAKgzE,gBAAkB,GACvBhzE,KAAKizE,WAAY,EACjBjzE,KAAKkzE,KAAO,IAAIC,KAAK,YAAa,CAChCC,WAAYhD,IAEdrqE,SAASiK,eAAe,aAAa6B,MAAMwhE,UAAY,OACvDrzE,KAAKszE,SAAW,IAAI9qC,IACpBxoC,KAAKkzE,KAAKK,wBACVvzE,KAAKwzE,aAAe,IAAI7C,EAAQ3wE,KAAM,iBAAkB,sBACxDA,KAAKyzE,UAAY,IACjBzzE,KAAK0zE,iBACL1zE,KAAK2zE,uBAELnsE,OAAOosE,SAAW,KAChB,MAAMnsC,EAASjgC,OAAOqsE,YAChBtuC,EAAQ/9B,OAAOssE,WAErBtsE,OAAOX,WAAW,KACX4gC,IAAWjgC,OAAOqsE,aAAiBtuC,IAAU/9B,OAAOssE,YACvD9zE,KAAKoxE,WAAWpxE,KAAKmxE,kBAAkB,IAExCnxE,KAAKyzE,YAOZ,iBACEN,KAAKY,OAAOC,UAAU,kBAAmBh0E,KAAKmwE,cAAc7xE,KAAK0B,MAAOA,KAAKkzE,KAAKe,SAASC,IAC3Ff,KAAKY,OAAOC,UAAU,gBAAiBh0E,KAAKm0E,QAAQ71E,KAAK0B,MAAOA,KAAKkzE,KAAKe,SAASC,IACnFf,KAAKY,OAAOC,UAAU,sBAAuBh0E,KAAKoxE,WAAW9yE,KAAK0B,MAAOA,KAAKkzE,KAAKe,SAASC,IAC5Ff,KAAKY,OAAOC,UAAU,qBAAsBh0E,KAAKo0E,WAAW91E,KAAK0B,MAAOA,KAAKkzE,KAAKe,SAASC,IAQ7F,iBAAkBG,EAAmBpD,GAAQ,GAC3C,SAASqD,EAAcC,GACrB,GAAIA,IAASv0E,KAAKmxE,iBAAkB,CAClC,MAAMI,EAAUvxE,KAAKszE,SAAS31E,IAAI42E,GAClCv0E,KAAKqV,SAASm/D,WAAWjD,GAAShpD,KAAMksD,IACtCz0E,KAAK00E,UAAUD,EAAKF,GACpB,MAAMI,EAAc,kBAAoBJ,EAClCjwC,EAAYv+B,SAASiK,eAAe2kE,GACxB,OAAdrwC,GACFA,EAAU7zB,UAAUQ,IAAI,eAE1BjR,KAAKgzE,gBAAgB1kE,QAASonB,GAAuBA,OACpDgpB,MAAOn7C,IACS,cAAbA,EAAIlG,MAAqC,gBAAbkG,EAAIlG,MAClCsE,QAAQ0B,MAAME,MAMtB,MAAMqxE,EAAc,CAACP,GACrB5xE,MAAMuR,KAAKjO,SAASwM,uBAAuB,gBAAgBjE,QAAQ0C,IACjEA,EAAKP,UAAUK,OAAO,iBAExB,IAAK,MAAMyjE,KAAQK,EACb3D,EACFzpE,OAAOX,WAAWytE,EAAah2E,KAAK0B,MAAQA,KAAc,UAAGu0E,GAE7DD,EAAah2E,KAAK0B,KAAlBs0E,CAAwBC,GAQ9B,iBACE,OAAOv0E,KAAKkzE,KAAK2B,qBAMnB,oBACE,OAAO70E,KAAKszE,SAAS31E,IAAIqC,KAAKmxE,kBAMhC,aACE,IAAK78C,QAAS1nB,IACZnK,MAAMuR,KAAKjO,SAASwM,uBAAuB,mBACxCjE,QAAS0C,IAAwBA,EAAKa,MAAMc,QAAU,SACzD9L,WAAW+F,EAAS5M,KAAKkzE,KAAKe,SAASa,aAAe,OACpDvsD,KAAK,KACPvoB,KAAKoxE,WAAWpxE,KAAKkzE,KAAK2B,sBAAsB,GAChDpyE,MAAMuR,KAAKjO,SAASwM,uBAAuB,mBACxCjE,QAAS0C,IACR,MAAMyjE,EAAMzjE,EAAK+jE,WACX7D,EAAS/jE,SAAS6D,EAAK1F,GAAGyC,MAAM,OAAO,IAC7C/N,KAAK00E,UAAUD,EAAKvD,GACpBlgE,EAAKa,MAAMc,QAAU,OAS7B,UAAW8hE,EAAoBvD,GAC7B,MAAM8D,EAAQjvE,SAASiK,eAAe,gBAChCilE,EAAaj1E,KAAKkzE,KAAKgC,oCAAoChE,GAC3DzxD,EAASzf,KAAKkzE,KAAKe,SAASkB,YAAYC,YAAYC,cAAcnE,EAAQ,CAC9EoE,gBAAgB,EAChBC,qBAAqB,IAEjBC,EAAahuE,OAAOiuE,iBAAiBT,EAAO,MAC/CU,iBAAiB,eAEdf,EAAc,kBAAoBzD,EAAO1lE,WAC/C,IAAI84B,EAAYv+B,SAASiK,eAAe2kE,GAQxC,IAPkB,OAAdrwC,KACFA,EAAYv+B,SAASO,cAAc,QACzBgF,GAAKqpE,EACfrwC,EAAU7zB,UAAUQ,IAAI,kBACxB+jE,EAAMpuE,YAAY09B,IAGbA,EAAUywC,YACfzwC,EAAU59B,YAAY49B,EAAUywC,YAGlCN,EAAI7hE,aAAa,QAASqiE,EAAW1vC,OACrCkvC,EAAI7hE,aAAa,SAAUqiE,EAAWxtC,QACtCnD,EAAUzyB,MAAM1N,SAAW,WAC3BmgC,EAAUzyB,MAAM8jE,OAASl2D,EAAOk2D,QAChCrxC,EAAUzyB,MAAM4nC,QAAUh6B,EAAOg6B,KAAOtsC,SAASqoE,OAEjDlxC,EAAU19B,YAAY6tE,GAMxB,UACEz0E,KAAKizE,WAAY,EACjBjzE,KAAKwzE,aAAaoC,sBAClB7vE,SAASiK,eAAe,WAAW6B,MAAMc,QAAU,OACnDhR,QAAQgyB,IAAI3zB,KAAKkzE,MAMnB,kBAAmBlqE,GACjBhJ,KAAKgzE,gBAAgB7xE,KAAK6H,GAM5B,qBAAsBA,GACpB,MAAM1E,EAAQtE,KAAKgzE,gBAAgB6C,UAAW7kE,GACrCA,IAAShI,IAEH,IAAX1E,GACFtE,KAAKgzE,gBAAgB/xC,OAAO38B,EAAO,GAOvC,uBACEyB,SAAS6K,KAAKN,iBAAiB,UAAYC,IACzC,OAAQA,EAAIlS,KACV,IAAK,IACH,IAAK,MAAMimC,KAAav+B,SAASwM,uBAAuB,kBACtD+xB,EAAUzyB,MAAMikE,WAAa,YAOrC/vE,SAAS6K,KAAKN,iBAAiB,QAAUC,IACvC,OAAQA,EAAIlS,KACV,IAAK,IACH,IAAK,MAAMimC,KAAav+B,SAASwM,uBAAuB,kBACtD+xB,EAAUzyB,MAAMikE,WAAa,MAYvC,cAAe1F,GACbpwE,KAAKszE,SAASyC,QACd,IAAK,MAAMC,KAAY5F,EAAS6F,UAC9B,IAAK,MAAMlwC,KAAUiwC,EAASE,SAC5Bl2E,KAAKszE,SAASxwE,IAAIkzE,EAASE,SAAS3nE,QAAQw3B,GAASA,EAAO,QAQlE,cAGE,OAFuB/lC,KAAKkzE,KAAKe,SAAS7D,SAAS+F,UAE3B,MADPn2E,KAAKkzE,KAAKe,SAAS7D,SAASgG,MAAMp2E,KAAKmxE,kBAAkBp0E,K,8ECnP9E,cAGA,SAGA,OA0LuB,EAAAmuB,QArLvB,MAcE,YAAa7V,EAAoBghE,EAA6BzF,GAC5D5wE,KAAKqV,SAAWA,EAChBrV,KAAKskC,UAAYv+B,SAASiK,eAAe,aACzChQ,KAAKgzE,gBAAkB,IAAIvwE,MAAM,GAEjCzC,KAAK8X,MAAQ/R,SAASuwE,gBAAgB,6BAA8B,OACpEt2E,KAAK8X,MAAMxM,GAAK,YAChBtL,KAAK8X,MAAMlF,aAAa,SAAUpL,OAAOqsE,YAAYroE,YACrDxL,KAAK8X,MAAMlF,aAAa,QAAS,QAEjC5S,KAAKu2E,GAAKxwE,SAASuwE,gBAAgB,6BAA8B,SACjEt2E,KAAKu2E,GAAGjrE,GAAK,QACbtL,KAAKu2E,GAAG9lE,UAAUQ,IAAI,cACtBjR,KAAKu2E,GAAGC,eAAe,+BAAgC,OAAQ5F,GAC/D5wE,KAAKu2E,GAAG3jE,aAAa,IAAK,KAC1B5S,KAAKu2E,GAAG3jE,aAAa,IAAK,KAE1B5S,KAAK8xE,IAAM/rE,SAASuwE,gBAAgB,wBAAyB,OAC7Dt2E,KAAK8xE,IAAIxmE,GAAK,aACdtL,KAAK8xE,IAAIrhE,UAAUQ,IAAI,iBAAkB,eAEzCjR,KAAK8X,MAAMlR,YAAY5G,KAAKu2E,IAC5Bv2E,KAAK8X,MAAMlR,YAAY5G,KAAK8xE,KAC5B9xE,KAAKskC,UAAU19B,YAAY5G,KAAK8X,OAEhC9X,KAAK6S,YAAc,IAAI,UACvB7S,KAAKwzE,aAAe,IAAI6C,EAAMr2E,KAAM,iBAAkB,aAAcA,KAAK6S,aAEzE7S,KAAK2zE,uBACL3zE,KAAKwzE,aAAaoC,sBAElB51E,KAAKuxE,QAAUX,EAEf7qE,SAASiK,eAAe,WAAW6B,MAAMc,QAAU,OAMrD,UAAW8hE,GACTz0E,KAAK8X,MAAM2+D,aAAahC,EAAKz0E,KAAK8xE,KAClC9xE,KAAK8xE,IAAM2C,EACXz0E,KAAK8xE,IAAIxmE,GAAK,aACdtL,KAAK8xE,IAAIrhE,UAAUQ,IAAI,iBAAkB,eACzC,MAAMw2B,EAASt6B,SAASnN,KAAK8xE,IAAIx+D,aAAa,WACxCiyB,EAAQp4B,SAASnN,KAAK8xE,IAAIx+D,aAAa,UAE7CtT,KAAKu2E,GAAG3jE,aAAa,SAAU60B,EAAOj8B,YACtCxL,KAAKu2E,GAAG3jE,aAAa,QAAS2yB,EAAM/5B,YACpCxL,KAAK8X,MAAMlF,aAAa,UAAW,OAAS2yB,EAAQ,IAAMkC,GAC1D,EAAA9yB,kBACA3U,KAAK02E,uBACL12E,KAAKgzE,gBAAgB1kE,QAAQonB,GAAYA,KAO3C,iBAAkBihD,EAAeC,GAC/B,MAAMnC,QAAYz0E,KAAKqV,SAASm/D,WAAWx0E,KAAKwV,qBAChDxV,KAAK00E,UAAUD,GAMjB,kBAAmBzrE,GACjBhJ,KAAKgzE,gBAAgB7xE,KAAK6H,GAM5B,qBAAsBA,GACpB,MAAM1E,EAAQtE,KAAKgzE,gBAAgB6C,UAAW7kE,GACrCA,IAAShI,IAEH,IAAX1E,GACFtE,KAAKgzE,gBAAgB/xC,OAAO38B,EAAO,GAOvC,uBACEtE,KAAKwzE,aAAa3gE,YAAYgkE,wBAC9B,EAAA9D,uBAMF,iBACE,OAAO,EAMT,oBACE,OAAO/yE,KAAKuxE,QAMd,uBACExrE,SAAS6K,KAAKN,iBAAiB,UAAYC,IACzC,OAAQA,EAAIlS,KACV,IAAK,QACH4K,EAAG2L,OAAO,cAAc9Q,GAAG,QAAS,MACpCmF,EAAG2L,OAAO,cAAc3X,KACtBgM,EAAGoiB,OAAOvnB,GAAG,QAAS9D,KAAKwzE,aAAa3gE,YAAYszB,UAAU7nC,KAAK0B,KAAKwzE,aAAa3gE,cAClF/O,GAAG,OAAQ9D,KAAKwzE,aAAa3gE,YAAY6Y,SAASptB,KAAK0B,KAAKwzE,aAAa3gE,eAE9E,MACF,IAAK,IACH9M,SAASiK,eAAe,cAAc4C,aAAa,aAAc,aAKvE7M,SAAS6K,KAAKN,iBAAiB,QAAUC,IACvC,OAAQA,EAAIlS,KACV,IAAK,QACH4K,EAAG2L,OAAO,cAAc9Q,GAAG,QAAS,MACA,WAAhC9D,KAAKqV,SAASquB,eAChB1jC,KAAKqV,SAASg7D,UAAUyG,qBAE1B,MACF,IAAK,IACH/wE,SAASiK,eAAe,cAAc4C,aAAa,aAAc,cAMvE3J,EAAG2L,OAAO,cAAc9Q,GAAG,aAAc,KACP,IAA5BmF,EAAGsiB,MAAMwrD,QAAQ31E,SACnBpB,KAAKwzE,aAAa3gE,YAAYszB,YAC9Bl9B,EAAG2L,OAAO,cAAc9Q,GAAG,YAAa9D,KAAKwzE,aAAa3gE,YAAY6Y,SAASptB,KAAK0B,KAAKwzE,aAAa3gE,cACtG5J,EAAG2L,OAAO,cAAc9Q,GAAG,WAAY,KACrCmF,EAAG2L,OAAO,cAAc9Q,GAAG,YAAa,WAI9CmF,EAAG2L,OAAO,cAAc9Q,GAAG,QAAS9D,KAAKwzE,aAAa3gE,YAAYmkE,WAAW14E,KAAK0B,KAAKwzE,aAAa3gE,cAAc,GAElHrL,OAAOosE,SAAW,KAChB,MAAMqD,EAAYzvE,OAAOqsE,YACnBvvC,EAAYv+B,SAASiK,eAAe,aACtCinE,EAAYr3E,OAAO0kC,EAAUhxB,aAAa,YAC5CgxB,EAAU1xB,aAAa,SAAUqkE,EAAUzrE,aAQjD,cACE,OAAOxL,KAAKqV,SAAShY,Q,8EC5LzB,cACA,QACA,QAEA,QACA,QACA,QAuDqB,EAAA6tB,QApDrB,MAIE,YAAa7V,GACXrV,KAAKqV,SAAWA,EAChB,EAAA6hE,qBAAqBl3E,MAGvB,eACEA,KAAK6U,YAAc,IAAI,UAAY7U,KAAKqV,SAAU,sBAClDrV,KAAKm3E,cAAgB,IAAI,UAAcn3E,KAAKqV,SAAU,sBACtD,EAAA+hE,eAAep3E,KAAKm3E,eACpBpxE,SAASiK,eAAe,gBAAgBqnE,QACxCC,EAAOC,uBAAuBv3E,KAAKqV,SAAUrV,KAAK6U,aAClD7U,KAAK82E,qBAELviE,EAAcwU,aAAa/oB,KAAKqV,UAChC,EAAAmiE,yBACA,MAAMC,EAAW1xE,SAASiK,eAAe,YACzCynE,EAAS5lE,MAAM6lE,gBAAkB,UACjCD,EAAS5lE,MAAMsC,WAAa,OAE5BmjE,EAAOK,qBAAqB,GAE5B,EAAAC,uBAEA,EAAAC,gCAEA73E,KAAKqV,SAASE,KAAKm9D,kBAAkB1yE,KAAK82E,mBAAmBx4E,KAAK0B,OAOpE,cACE,YAA2BE,IAAvBF,KAAKm3E,cACHn3E,KAAKm3E,cAAcW,eACd,SAEF,OAEF,SAGT,qBACER,EAAOS,YAAY,yFACnBT,EAAOU,WAAW,uB,8ECzDtB,cACA,QACA,QACA,QAEA,QACA,QAgE2B,EAAA9sD,QAzD3B,MAQE,YAAa7V,GACXrV,KAAKqV,SAAWA,EAChB,EAAA6hE,qBAAqBl3E,MAMvB,eACEA,KAAK6U,YAAc,IAAI,UAAY7U,KAAKqV,SAAU,cAClDrV,KAAKm3E,cAAgB,IAAI,UAAcn3E,KAAKqV,SAAU,cACtD,EAAA+hE,eAAep3E,KAAKm3E,eACpBpxE,SAASiK,eAAe,gBAAgBqnE,QACxCC,EAAOC,uBAAuBv3E,KAAKqV,SAAUrV,KAAK6U,aAClD7U,KAAK82E,qBAELviE,EAAcwU,aAAa/oB,KAAKqV,UAChC,EAAAmiE,yBACA,MAAMC,EAAW1xE,SAASiK,eAAe,YACzCynE,EAAS5lE,MAAM6lE,gBAAkB,UACjCD,EAAS5lE,MAAMsC,WAAa,OAE5B,EAAAyjE,uBAEA,EAAAC,gCAEA73E,KAAKqV,SAASE,KAAKm9D,kBAAkB1yE,KAAK82E,mBAAmBx4E,KAAK0B,OAOpE,cACE,YAA2BE,IAAvBF,KAAKm3E,cACHn3E,KAAKm3E,cAAcW,eACd,SAEF,OAEF,SAGT,qBACER,EAAOS,YAAY,+CACnBT,EAAOU,WAAW,iB,8ECzDtB,MAAMC,EAAc,IAAIzvC,IACtB,CAAC,CAAC,GAAI,WAAY,CAAC,IAAK,OAAQ,CAAC,IAAK,UAAW,CAAC,KAAM,aAAc,CAAC,KAAM,YAAa,CAAC,KAAM,aAAc,CAAC,IAAK,aAAc,CAAC,KAAM,aACxI,CAAC,KAAM,WAAY,CAAC,KAAM,YAAa,CAAC,MAAO,sBAAuB,CAAC,MAAO,sBAAuB,CAAC,MAAO,oBAC7G,CAAC,MAAO,kBAAmB,CAAC,MAAO,oBAAqB,CAAC,OAAQ,wBAAyB,CAAC,OAAQ,0BAavG,SAAS0vC,IACP,MAAMC,EAAYpyE,SAASiK,eAAe,cACrCjK,SAASiK,eAAe,eAAoCyN,QAC/D06D,EAAUvlE,aAAa,QAAS,IAEhCulE,EAAUvlE,aAAa,QAAS,iBAOpC,SAASwlE,IArBPryE,SAASiK,eAAe,cAAc4L,UACpC,qGAEF7V,SAASiK,eAAe,cAAc4C,aAAa,QAAS,iBAoB5DslE,IACAnyE,SAASiK,eAAe,eAAeM,iBAAiB,QAAS4nE,GA2N5C,EAAAhtD,QArNvB,MAOE,YAAa7V,GACXrV,KAAKqV,SAAWA,EAEhB,MAAMgjE,EAAQtyE,SAASiK,eAAe,oBAChCsoE,EAAQvyE,SAASO,cAAc,SACrCgyE,EAAM7nE,UAAUQ,IAAI,YACpBqnE,EAAMpnE,YAAc,iBACpB,MAAMjE,EAAQlH,SAASO,cAAc,SACrC2G,EAAMwD,UAAUQ,IAAI,YACpBhE,EAAM3B,GAAK,cACX2B,EAAMxM,KAAO,WACbwM,EAAMwQ,SAAU,EAChB66D,EAAM1xE,YAAYqG,GAClBorE,EAAM13E,QAAQ23E,GAEdt4E,KAAKqV,SAASE,KAAKm9D,kBAAkB1yE,KAAKu4E,mBAAmBj6E,KAAK0B,OAClEo4E,IACAp4E,KAAKu4E,qBAMP,gBACE,IACExyE,SAASwM,uBAAuB,eAAe,GAC5CxB,iBAAiB,wBACjBzC,QAAQ44B,IACPA,EAAK52B,iBAAiB,YAAatQ,KAAKw4E,WAAWl6E,KAAK0B,SAE5D,MAAOuH,KAMX,gBACExB,SAASgL,iBAAiB,wBAAwBzC,QAAQ44B,IACxDA,EAAK51B,oBAAoB,YAAatR,KAAKw4E,WAAWl6E,KAAK0B,SAO/D,qBACEA,KAAKy4E,gBACLz4E,KAAKqjC,gBAOP,iBAAkB9X,GAGhB,MAAMjgB,EAAMigB,EAAM2tC,cAA8B5tD,GAChD,GAAW,KAAPA,EAKF,OAJA7I,MAAMuR,KAAKjO,SAASiK,eAAe,cAAc4I,UAAUtK,QAAQqZ,IACjEA,EAAM7W,gBAERnP,QAAQgyB,IAAI,UAId,MAAM7tB,EAAUC,SAASiK,eAAe1E,GAElCotE,EAAe5yE,EAAQwN,aAAa,SAASvF,MADnC,8BACkD,GAClE,IACI4qE,EADA/nE,EAAO,GAIX,OAAQ8nE,GACN,IAAK,QAEH,MAAME,EAAM9yE,EAAQiL,iBAAiB,OACrC,IAAI2Y,QAAgB1pB,KAAK64E,WAAWD,GACpC,GAAgB,WAAZlvD,EAAsB,QACO1pB,KAAKqV,SAASC,eAAesjE,EAAI,GAAGttE,GAAItL,KAAKqV,SAASE,KAAKC,sBACjFsjE,UACPpvD,EAAU,YAGd,IAAIqvD,QAAgB/4E,KAAKg5E,WAAWJ,GAGpChoE,EAAO,gBAAyB1Q,IAAZwpB,EAAwB,WAAaA,GAAW,mBADpEqvD,EAAUA,EAAQhyD,OAAOiM,eAGzB,MACF,IAAK,SAEHpiB,GAAQ,WADR+nE,QAAmB34E,KAAKqV,SAASC,eAAehK,EAAItL,KAAKqV,SAASE,KAAKC,sBAC/B,MAAEwd,cAAgB2lD,EAAgB,IAC1E,MACF,IAAK,OAEH/nE,GAAQ,WADR+nE,QAAmB34E,KAAKqV,SAASC,eAAehK,EAAItL,KAAKqV,SAASE,KAAKC,sBACjC,MAAI,aACvBmjE,EAAiB,KACpC,MACF,QACE/nE,GAAQ,UAGZ5Q,KAAKi5E,iBAAiBP,EAAc9nE,GAQtC,iBAAkBgoE,GAChB,IAAIG,EAAU,GACd,IAAK,MAAM3jE,KAAMwjE,EAAK,CACpB,MAAMD,QAA+B34E,KAAKqV,SAASC,eAAeF,EAAG9J,GAAItL,KAAKqV,SAASE,KAAKC,qBAC5FujE,GAAWJ,EAAkB,MAAIA,EAAgB,IAAI,IAEvD,OAAOI,EAOT,iBAAkBH,GAChB,IAAIlvD,EAAU,GACVqS,EAAuB,KAC3B,IAAK,MAAM3mB,KAAMwjE,EAAK,CACpB,MAAMD,QAA+B34E,KAAKqV,SAASC,eAAeF,EAAG9J,GAAItL,KAAKqV,SAASE,KAAKC,qBAC3E,OAAbumB,IACEA,EAAc,IAAI48C,EAAgB,IACpCjvD,GAAW,IACFqS,EAAc,IAAI48C,EAAgB,IAC3CjvD,GAAW,IAEP1pB,KAAKk5E,eAAen9C,EAAgB,OAAK/7B,KAAKk5E,eAAeP,EAAkB,OACjFjvD,GAAW,IACF1pB,KAAKk5E,eAAen9C,EAAgB,OAAK/7B,KAAKk5E,eAAeP,EAAkB,OACxFjvD,GAAW,IAEXA,GAAW,KAIjBqS,EAAW48C,EAKb,YAHiCz4E,IAA7B+3E,EAAYt6E,IAAI+rB,IAClB/nB,QAAQC,KAAK,oBAAsB8nB,GAE9BuuD,EAAYt6E,IAAI+rB,GAQzB,iBAAkBrf,EAAeuG,GAC/B7K,SAASwM,uBAAuB,kBAAkB,GAAGX,cAAc,KAChEV,YAAc7G,EAChBtE,SAASwM,uBAAuB,gBAAgB,GAAmB4mE,UAAYvoE,EAE3E7K,SAASiK,eAAe,eAAoCyN,UAC9D1X,SAASwM,uBAAuB,WAAW,GAAmBV,MAAMc,QAAU,IASnF,eAAgBymE,GACd,OAAQA,GACN,IAAK,IACH,OAAO,EACT,IAAK,IACH,OAAO,EACT,IAAK,IACH,OAAO,EACT,IAAK,IACH,OAAO,EACT,IAAK,IACH,OAAO,EACT,IAAK,IACH,OAAO,EACT,IAAK,IACH,OAAO,EACT,QACEz3E,QAAQgyB,IAAI,uBAQlB,kBAAmB51B,GACjB,IAAK,MAAOs7E,EAAMpxE,KAAMgwE,EAAYqB,UAClC,GAAIrxE,IAAMlK,EACR,OAAOs7E,K,8EC7Pf,cAEA,QACA,QAqLqB,EAAAnuD,QA/KrB,MAQE,YAAa7V,GACXrV,KAAKqV,SAAWA,EAChBrV,KAAKu5E,kBAAmB,EAGxB,MAAMlB,EAAQtyE,SAASiK,eAAe,oBAChCwpE,EAAYzzE,SAASO,cAAc,SACnCmzE,EAAY1zE,SAASO,cAAc,SACnCozE,EAAa3zE,SAASO,cAAc,SACpCqzE,EAAa5zE,SAASO,cAAc,SAC1CkzE,EAAU/oE,UAAUQ,IAAI,YACxBwoE,EAAUhpE,UAAUQ,IAAI,YACxBuoE,EAAUtoE,YAAc,iBACxBuoE,EAAUvoE,YAAc,wBACxBwoE,EAAWjpE,UAAUQ,IAAI,YACzB0oE,EAAWlpE,UAAUQ,IAAI,YACzByoE,EAAWpuE,GAAK,cAChBouE,EAAWj5E,KAAO,WAClBk5E,EAAWruE,GAAK,cAChBquE,EAAWl5E,KAAO,WAClBi5E,EAAWj8D,SAAU,EACrBk8D,EAAWl8D,SAAU,EACrB+7D,EAAU5yE,YAAY8yE,GACtBD,EAAU7yE,YAAY+yE,GACtBtB,EAAM13E,QAAQ84E,GACdpB,EAAM13E,QAAQ64E,GAEdx5E,KAAK45E,sBACL55E,KAAKqV,SAASE,KAAKm9D,kBAAkB1yE,KAAK65E,yBAAyBv7E,KAAK0B,OACxEA,KAAKqV,SAASE,KAAKm9D,kBAAkB1yE,KAAK85E,yBAAyBx7E,KAAK0B,OAM1E,sBAIEA,KAAK65E,2BACL75E,KAAK85E,2BACL/zE,SAASiK,eAAe,eACrBM,iBAAiB,QANpB,WAAgCtQ,KAAK65E,4BAMIv7E,KAAK0B,OAC9C+F,SAASiK,eAAe,eACrBM,iBAAiB,QAPpB,WAAgCtQ,KAAK85E,4BAOIx7E,KAAK0B,OAMhD,2BACE,GAAK+F,SAASiK,eAAe,eAAmCyN,QAC9D1X,SAASgL,iBAAiB,gBAAgBzC,QAAQmZ,IAChDA,EAAKhX,UAAUQ,IAAI,uBACnBwW,EAAKhX,UAAUK,OAAO,iBAExB/K,SAASgL,iBAAiB,sCACvBzC,QAASmZ,IAAwBA,EAAK5V,MAAMkC,KAAO,QAElB,WAAhC/T,KAAKqV,SAASquB,oBAAyDxjC,IAA3BF,KAAKqV,SAASi7D,UAC5DtwE,KAAKqV,SAASi7D,SAASyJ,6BAEpB,CACyC,OAAzCh0E,SAASiK,eAAe,cAC3BjK,SAASiK,eAAe,aAAaS,UAAUE,SAAS,eACxD,EAAAgD,WACA5N,SAASiK,eAAe,aAAaS,UAAUK,OAAO,aACtD/K,SAASiK,eAAe,YAAYS,UAAUQ,IAAI,cAEpDlL,SAASgL,iBAAiB,wBAAwBzC,QAAQmZ,IACxDA,EAAKhX,UAAUQ,IAAI,eACnBwW,EAAKhX,UAAUK,OAAO,yBAExB/K,SAASgL,iBAAiB,8BAA8BzC,QAASmZ,IAC/DA,EAAK5V,MAAMkC,KAAO,SAEpB,IACEhO,SAASiK,eAAe,aAAa6B,MAAMc,QAAU,OACrD,MAAOpL,KAEX,EAAAoN,kBAOF,2BACE,GAAK5O,SAASiK,eAAe,eAAoCyN,QAAS,CACxE,MAAMu8D,EAAUj0E,SAASiK,eAAe,YACxCgqE,EAAQnoE,MAAMc,QAAU,GACxBqnE,EAAQp+D,UAAY,MAAQ5b,KAAKi6E,aAAe,OAClCD,EAAQjpE,iBAAiB,YACjCzC,QAAQ2G,IACZ,MAAMZ,EAAWtO,SAASiK,eAAeiF,EAAKs9D,WACxCv8D,EAAM3B,EAASzC,cAAc,QAC7BipB,EAAO7kB,EAAIpE,cAAc,QACzB6V,EAAOzR,EAAIpE,cAAc,QACD,IAA1BipB,EAAKpqB,UAAUrP,QACjBy5B,EAAKpqB,UAAUQ,IAAI,QAGrBgE,EAAK3E,iBAAiB,YAAa,KACjC+D,EAAS5D,UAAUQ,IAAI,YACvBoD,EAAStD,iBAAiB,UAAUzC,QAAQmb,IAC1CA,EAAMhZ,UAAUQ,IAAI,cAET,OAATwW,IACFA,EAAK5V,MAAMkC,KAAO,UAMtBkB,EAAK3E,iBAAiB,aAAc,KAClC+D,EAAS5D,UAAUK,OAAO,YAC1BuD,EAAStD,iBAAiB,UAAUzC,QAAQmb,IAC1CA,EAAMhZ,UAAUK,OAAO,cAEZ,OAAT2W,IAC0B,iBAAxBpT,EAASxC,MAAMkC,KACjB0T,EAAK5V,MAAMkC,KAAOM,EAASf,aAAa,QAExCmU,EAAK5V,MAAMkC,KAAO,YAOU,WAAhC/T,KAAKqV,SAASquB,oBAAyDxjC,IAA3BF,KAAKqV,SAASi7D,UAC5DtwE,KAAKqV,SAASi7D,SAAS4J,oBAGzBn0E,SAASiK,eAAe,YAAY6B,MAAMc,QAAU,OAOxD,aACE,IAAIwnE,EAAS,GAqBb,OAnBkBp0E,SAASgL,iBAAiB,0BAClCzC,QAAQ+F,IAChB,GAAuC,OAAnCA,EAASzC,cAAc,QAAkB,CAC3C,MAAMoE,EAAM3B,EAASzC,cAAc,QACnCuoE,GAAU,gBAAmB9lE,EAAS/I,GAAK,KACZ,KAA3B0K,EAAI9E,YAAY6V,OAClBozD,GAAU,YAEV13E,MAAMuR,KAAKgC,EAAI4C,SAAS,GAAGA,SAAS,GAAGA,UAAUtK,QAAQusB,IACvDs/C,GAA+B,KAArBt/C,EAAK3pB,YAAqB2pB,EAAK3pB,YAAc,cAG3DipE,GAAU,cAGTn6E,KAAKu5E,mBACRt9D,EAAamN,kBAAkB,gDAC/BppB,KAAKu5E,kBAAmB,GAEnBY,EAAOzrE,QApBI,UAoBe,Q,8ECpLrC,cACA,QAEA,QACA,QAYA,SAAS0rE,IACP,IAAKr0E,SAASiK,eAAe,aAAaS,UAAUE,SAAS,aAAc,CACzE,EAAAgD,WACA,IACE5N,SAASiK,eAAe,YAAY4L,UAAY,GAChD,MAAOrU,IACTxB,SAASiK,eAAe,aAAaS,UAAUQ,IAAI,aACnD,IACElL,SAASiK,eAAe,WAAWS,UAAUK,OAAO,aACpD/K,SAASiK,eAAe,cAAcS,UAAUK,OAAO,aACvD/K,SAASiK,eAAe,cAAcS,UAAUK,OAAO,aACvD/K,SAASiK,eAAe,YAAYS,UAAUK,OAAO,aACrD,MAAOvJ,IACT,IAC2D,wBAArDxB,SAAS6L,cAAc,uBAAuBtG,IAChD,EAAA8F,qBAAqB,YAEvB,MAAO7J,KAEXvH,KAAKq6E,mBAMP,gBAQE,YAAahlE,GACXrV,KAAKqV,SAAWA,EAChBrV,KAAKk3E,uBAMP,uBACEnxE,SAASiK,eAAe,aAAaM,iBAAiB,QAAS,KAC7DtQ,KAAKk6E,eACAn0E,SAASiK,eAAe,eAAoCyN,SAC/Dzd,KAAK+5E,2BAQX,eACgBh0E,SAASiK,eAAe,YAAYe,iBAAiB,YAC7DzC,QAAQ2G,IACZ,SAASqlE,IACPt6E,KAAKs6E,cAAcrlE,GAGrBA,EAAK3D,oBAAoB,QAASgpE,EAAch8E,KAAK0B,OACrDiV,EAAK3E,iBAAiB,QAASgqE,EAAch8E,KAAK0B,SAUtD,yBACE,QAAgCE,IAA5BF,KAAKqV,SAASg7D,UAAyB,CACzC,MAAM9sC,EAAYx9B,SAASiK,eAAe,aAC1C,GAAIuzB,EAEF,YADAA,EAAU1xB,MAAMc,QAAU,IAI5B,MAAM0lE,EAAQtyE,SAASiK,eAAe,YACnCgF,QAAQ,YACRA,QAAQ,UACLpW,EAAImH,SAASO,cAAc,KACjC1H,EAAE6R,UAAUQ,IAAI,WAChB,MAAMspE,EAASx0E,SAASO,cAAc,UACtCi0E,EAAO9pE,UAAUQ,IAAI,SAAU,UAC/BspE,EAAOjvE,GAAK,YACZivE,EAAOrpE,YAAc,OACrBtS,EAAEgI,YAAY2zE,GACdlC,EAAMzxE,YAAYhI,GAClB27E,EAAOjqE,iBAAiB,QAAS8pE,EAAiB97E,KAAK0B,OACvD+F,SAAS6K,KAAKN,iBAAiB,UAAYC,IACzB,MAAZA,EAAIlS,KACqD,KAAvD0H,SAASiK,eAAe,aAAa6B,MAAMc,SAC7CynE,EAAiB97E,KAAK0B,KAAtBo6E,KAINp6E,KAAKqV,SAASE,KAAKm9D,kBAAkB1yE,KAAKq6E,iBAAiB/7E,KAAK0B,WAC3D,CACL,MAAMq4E,EAAQtyE,SAASiK,eAAe,QAAQgF,QAAQ,YAChDpW,EAAImH,SAASO,cAAc,KACjC1H,EAAE6R,UAAUQ,IAAI,WAChB,MAAMspE,EAASx0E,SAASO,cAAc,UACtCi0E,EAAO9pE,UAAUQ,IAAI,SAAU,UAC/BspE,EAAOjvE,GAAK,YACZivE,EAAOrpE,YAAc,OACrBtS,EAAEgI,YAAY2zE,GACdlC,EAAMzxE,YAAYhI,GAClB27E,EAAO9pE,UAAUQ,IAAI,aACrBspE,EAAO1oE,MAAMc,QAAU,OACvB3S,KAAKq6E,mBACLr6E,KAAKqV,SAASE,KAAKm9D,kBAAkB1yE,KAAKq6E,iBAAiB/7E,KAAK0B,QAOpE,mBACM+F,SAASiK,eAAe,aAAaS,UAAUE,SAAS,eAC1D,EAAAgD,gBACgCzT,IAA5BF,KAAKqV,SAASg7D,YAEhBrwE,KAAK6U,YAAc,IAAI,UAAY7U,KAAKqV,SAAU,wBAClD,EAAAkiE,uBAAuBv3E,KAAKqV,SAAUrV,KAAK6U,aACC,eAAxC7U,KAAKqV,SAASE,KAAKtQ,YAAY5H,MACjC,EAAA06E,YAAY,iCACZ,EAAAC,WAAW,gBAEX,EAAAD,YAAY,2DACZ,EAAAC,WAAW,uBASnB,cAAe/iE,GACb,MAAMulE,EAAiBvlE,EAAK/D,YAhJbxC,QADI,YACkB,IAAIqY,OAiJzC,MAAM0zD,EAAYjzE,OAAOkzE,OAAO,GAAIF,GACpC,GAAkB,OAAdC,GAAsBA,IAAcD,EAAM,CAC5C,MAAMhwD,EAAe,CACnB,OAAU,UACV,MAAS,CACP,UAAa,IAAIvV,EAAKxE,UAAU6oE,WAAWngE,OAAO5R,GAAc,gBAATA,EAAE,IAAsB,GAAG,GAClF,KAAQkzE,IAGZz6E,KAAKqV,SAASiT,KAAKkC,EAAcxqB,KAAKqV,SAASE,KAAKC,qBAAqB+S,KAAM8zC,IACzEA,GACFr8D,KAAKqV,SAASmT,6B,8ECzKxB,cACA,QAyJA,SAASmyD,EAAKC,EAAoBC,GAChC,MAAMztE,EAAS,GACf,IAAK,IAAItQ,EAAI,EAAGA,GAAK89E,EAAOx5E,OAASy5E,EAAOz5E,OAASy5E,EAAOz5E,OAASw5E,EAAOx5E,QAAStE,IACnFsQ,EAAOjM,KAAK,CAACy5E,EAAO99E,GAAI+9E,EAAO/9E,KAEjC,OAAOsQ,EA5JT0tE,EAAGC,mBAAmB,MAAO,wCAC7BD,EAAGC,mBAAmB,GAAI,wCAE1B,4BAAkCC,GAChC,MAAMC,EAAUH,EAAG99C,MAAMg+C,GACnBE,EAASD,EAAQE,UACvB,IAAK,MAAMC,KAAWF,EAAOG,QAAQ,cAAe,CAClD,MAAMC,EAAWR,EAAGS,QAAQ,QAAS,CAAE,EAAK,MACtCj3C,EAAiBw2C,EAAGU,WAAWF,EAAU,SAE/Ch3C,EAAUxhC,IAAI,IAAK,KAEnB,IAAK,MAAMqT,KAASilE,EAAQK,cAC1B,IAAK,MAAMC,KAASvlE,EAAMslE,cAAe,CAEvC,MAAME,EAAKb,EAAGS,QAAQ,KAAM,CAC1B,EAAKplE,EAAMxY,IAAI,KACf,KAAQwY,EAAMxY,IAAI,QAClB,SAAUwY,EAAMxY,IAAI,YAIlB2mC,EAAU3gC,MAAQ,GAC+B,WAA/C2gC,EAAU6H,QAAQ7H,EAAU3gC,MAAQ,GAAGi4E,MACzCD,EAAG5tD,OAAOuW,EAAU6H,QAAQ7H,EAAU3gC,MAAQ,IAC9C2gC,EAAUxzB,OAAOwzB,EAAU6H,QAAQ7H,EAAU3gC,MAAQ,KAKzD,IAAI2V,EAAgBoiE,EAAMzzB,KAAK,YAC3B4zB,EAAa,GACjB,GAAIviE,EACF,GAAIA,EAAc3b,IAAI,WAAY,CAChCk+E,EAAaviE,EAAc3b,IAAI,WAC/B,IAAK,MAAMqY,KAAOsD,EAAc+hE,QAAQ,OACtC/hE,EAAcxI,OAAOkF,GAEvB0lE,EAAM5qE,OAAOwI,QAEbA,OAAgBpZ,EAIpB,GAAKoZ,EAEE,CACL,MAAMjF,EAAgBiwB,EAAU2jB,KAC9B,iBAAoB4zB,EAAa,MAEnCxnE,EAAS0Z,OAAO4tD,GAChBtnE,EAASynE,UAAYznE,EAASynE,UAAUp8E,OAAO4Z,EAAcmiE,oBAN7Dn3C,EAAUvW,OAAO4tD,GAQnBr3C,EAAUw3C,UAAYx3C,EAAUw3C,UAAUp8E,OAAOg8E,EAAMD,eAG3D,MAAMM,EAAYX,EAAQz9E,IAAI,UAC9By9E,EAAQrF,QACRqF,EAAQt4E,IAAI,SAAUi5E,GACtBX,EAAQrtD,OAAOutD,GAGjB,OAAOL,EAAQ19D,MAAM,CAAE,iBAAmB,EAAMy+D,OAAQ,KAG1D,4BAAkCC,GAChC,MAAMhB,EAAUH,EAAG99C,MAAMi/C,GACnBf,EAASD,EAAQE,UAEvB,IAAK,MAAMC,KAAWF,EAAOG,QAAQ,cAAsB,CACzD,MAAMa,EAAa,GACnB,IAAK,MAAM/lE,KAASilE,EAAQK,cAC1B,IAAK,MAAMC,KAASvlE,EAAMslE,cAAe,CACvC,MAAMU,EAAY,GAClB,IAAK,MAAMR,KAAMD,EAAML,QAAQ,MAC7Bc,EAAUh7E,KAAKu6E,EAAMD,cAAcltE,QAAQotE,IAG7C,IAAK,MAAOS,EAAS79E,KAAMo8E,EAAIwB,EAAW,IAAI15E,MAAM05E,EAAU/6E,QAAQuD,SAAU,CAC9E,MAAMg3E,EAAKD,EAAMvvC,QAAQiwC,GACnBd,EAAWR,EAAGS,QAAQ,QAASI,EAAGU,QAClC/3C,EAAiBw2C,EAAGS,QAAQ,QAAS,CAAE,EAAK,MAGlD,IAAK,IAAIz+E,EAAI,EAAGA,EAAI6+E,EAAGh4E,MAAO7G,IAAK,CACjC,MAAMw/E,EAASX,EAAGxvC,QAAQ,GACpBowC,EAAYL,EAAWA,EAAW96E,OAAS,GACjDm7E,EAAUpwC,QAAQowC,EAAU54E,MAAQ,GAAGoqB,OAAOuuD,GAIhD,MAAME,EAAYj+E,EAAI,IAAM49E,EAAU/6E,OAASs6E,EAAM/3E,MAAQw4E,EAAU59E,EAAI,GAC3E+lC,EAAUw3C,UAAYx3C,EAAUw3C,UAAUp8E,OAAOg8E,EAAMe,SAASL,EAAU,EAAGI,IAC7ElB,EAASvtD,OAAOuW,GAChB43C,EAAW/6E,KAAKm6E,IAItB,MAAMS,EAAYX,EAAQz9E,IAAI,UAC9By9E,EAAQrF,QACRqF,EAAQt4E,IAAI,SAAUi5E,GACtBX,EAAQU,UAAYV,EAAQU,UAAUp8E,OAAOw8E,GAG7C,MAAMQ,EAAc,EACpB,IAAK,MAAOvmE,EAAOwmE,KAAehC,EAAIS,EAAQK,cAAe,IAAIh5E,MAAM24E,EAAQz3E,OAAOgB,SACpF,IAAK,MAAM+2E,KAASvlE,EAAMslE,cACxB,IAAK,MAAMpnE,KAAYqnE,EAAML,QAAQ,eAAgB,CACnD,MAAMM,EAAKtnE,EAAS4zC,KAAK,MACzB,IAAK0zB,EACH,SAEF,MAAML,EAAWR,EAAGS,QAAQ,QAASI,EAAGU,QAClCO,EAAgB9B,EAAGU,WAAWF,EAAU,SAC9CsB,EAAS95E,IAAI,IAAK,KAElB,MAAM+5E,EAAgB,EAAA1gE,SAChB2gE,EAAmBhC,EAAGU,WAAWoB,EAAU,YACjDE,EAAYh6E,IAAI,UAAWuR,EAAS1W,IAAI,WACxCm/E,EAAYh6E,IAAI,SAAU+5E,GAC1BxoE,EAASvR,IAAI,WAAY+5E,GACzBC,EAAYhB,UAAYgB,EAAYhB,UAAUp8E,OAAO2U,EAASooE,SAASpoE,EAASonE,cAAcltE,QAAQotE,GAAM,EAAGtnE,EAAS1Q,QAExH,MAAMo5E,EAAqB1oE,EAASooE,SAAS,EAAGpoE,EAASonE,cAAcltE,QAAQotE,IACzEqB,EAAiB3oE,EAASgoE,OAGhCO,EAASd,UAAYc,EAASd,UAAUp8E,OAAOg8E,EAAMe,SAASf,EAAMD,cAAcltE,QAAQ8F,GAAY,EAAGqnE,EAAM/3E,QAC/G,MAAMs5E,EAAcvB,EAAMW,OACpBa,EAAexB,EAAMe,SAAS,EAAGf,EAAMD,cAAcltE,QAAQ8F,GAAY,GAC/EqnE,EAAM3F,QACN2F,EAAMW,OAASY,EACfvB,EAAMI,UAAYJ,EAAMI,UAAUp8E,OAAOw9E,GAGzCxB,EAAMI,UAAYJ,EAAMI,UAAUp8E,OAAOi8E,EAAGF,eAG5CpnE,EAAS0hE,QACT1hE,EAASgoE,OAASW,EAClB3oE,EAASynE,UAAYznE,EAASynE,UAAUp8E,OAAOq9E,GAE/C3B,EAAQU,UAAU76C,OAAO07C,EAAaD,EAAc,EAAG,EAAGpB,IAMlE,OAAOL,EAAQ19D,MAAM,CAAE,iBAAmB,EAAMy+D,OAAQ,M,gBCtI1D,IAAIrsD,EAAU,EAAQ,IAAaA,QAE/BwtD,EAAQ,EAAQ,IAChBC,EAAc,EAAQ,IACtBC,EAAc,EAAQ,IAAiBA,YACvCC,EAAa,EAAQ,IAAYA,WACjCC,EAAY,EAAQ,IAEpBC,EAAc,EAElB,SAASjC,EAAQK,EAAKS,GAEpBr8E,KAAKqxC,IAAMmsC,IACXx9E,KAAK47E,IAAMA,EACX57E,KAAKq8E,OAAS,GACdr8E,KAAK66B,KAAO,KACZ76B,KAAKgtB,KAAO,KACZhtB,KAAK87E,UAAY,GAEbO,IACFr8E,KAAKq8E,OAASc,EAAMhlC,MAAMn4C,KAAKq8E,OAAQA,IAgL3C,SAASoB,EAAQ5iD,GACf,IAAI/0B,EAAU,IAAIy1E,EAAQkC,GAI1B,OAHI5iD,IACF/0B,EAAQ+0B,KAAOA,GAEV/0B,EAGT,SAAS43E,EAAM7iD,GACb,IAAI/0B,EAAU,IAAIy1E,EAAQmC,GAI1B,OAHI7iD,IACF/0B,EAAQ+0B,KAAOA,GAEV/0B,EAGT,SAAS63E,EAAsBx+E,EAAQ07B,GAErC,IAAI/0B,EAAU,IAAIy1E,EAAQoC,GAK1B,OAJA73E,EAAQ+0B,KAAO17B,EACX07B,IACF/0B,EAAQ+0B,KAAO/0B,EAAQ+0B,KAAO,IAAMA,GAE/B/0B,EAGT,SAAS83E,EAAMC,EAAajC,GAEtBA,IACFiC,EAAcluD,EAAQ,SAAUkuD,EAAajC,IAE/C57E,KAAK66B,KAAOgjD,EAOd,SAASC,EAAYh4E,GAEnB9F,KAAK+9E,MAAQj4E,EApNfy1E,EAAQ78E,UAAU8M,SAAW,WAE3B,OAAOmkB,EAAQ,qBAAsB3vB,KAAK47E,IAAK57E,KAAKqxC,MAGtDkqC,EAAQ78E,UAAUs/E,YAAc,SAASpC,EAAKS,GAE5C,OAAO,IAAId,EAAQK,EAAKS,IAG1Bd,EAAQ78E,UAAUiF,IAAM,WAEtB,OAAO3D,KAAK87E,UAAU16E,QAGxBm6E,EAAQ78E,UAAUytC,QAAU,SAAS7nC,GAEnC,OAAOtE,KAAK87E,UAAUx3E,IAGxBi3E,EAAQ78E,UAAUwtC,QAAU,SAAS5nC,EAAOwB,GAE1C9F,KAAK87E,UAAUx3E,GAASwB,GAG1By1E,EAAQ78E,UAAUu/E,QAAU,SAAS35E,GAEnCtE,KAAK87E,UAAU76C,OAAO38B,EAAO,IAG/Bi3E,EAAQ78E,UAAU+9E,SAAW,SAASr+D,EAAO8/D,GAE3C,OAAOl+E,KAAK87E,UAAUzsE,MAAM+O,EAAO8/D,IAGrC3C,EAAQ78E,UAAUy/E,SAAW,SAAS//D,EAAO8/D,EAAMxoE,GAEjD,IAAI5Y,EACAoS,EAAI,EACR,IAAKpS,EAAIshB,EAAOthB,EAAIohF,EAAMphF,IAAKoS,IAC7BlP,KAAK87E,UAAUh/E,GAAK4Y,EAASxG,IAIjCqsE,EAAQ78E,UAAU0/E,SAAW,SAAShgE,EAAO8/D,GAE3Cl+E,KAAK87E,UAAU76C,OAAO7iB,EAAO8/D,EAAO9/D,IAGtCm9D,EAAQ78E,UAAUqvB,OAAS,SAASjoB,GAElC9F,KAAK87E,UAAU36E,KAAK2E,IAGtBy1E,EAAQ78E,UAAU2/E,OAAS,SAAS3oE,GAElC1V,KAAK87E,UAAUp8E,OAAOgW,IAGxB6lE,EAAQ78E,UAAU4/E,OAAS,SAASh6E,EAAOwB,GAEzC9F,KAAK87E,UAAUx3E,GAASwB,GAG1By1E,EAAQ78E,UAAUoS,OAAS,SAAShL,GAElC9F,KAAK87E,UAAY97E,KAAK87E,UAAU3iE,OAAO,SAAS5R,GAE9C,OAAIA,EAAE8pC,MAAQvrC,EAAQurC,OAO1BkqC,EAAQ78E,UAAU+8E,YAAc,WAC9B,OAAOz7E,KAAK87E,WAGdP,EAAQ78E,UAAUupD,KAAO,SAAShxC,GAEhC,OAAOmmE,EAAYn1B,KAAKjoD,KAAMiX,IAGhCskE,EAAQ78E,UAAU6/E,SAAW,SAAStnE,EAAMunE,GAE1C,OAAOpB,EAAYmB,SAASv+E,KAAMiX,EAAMunE,IAG1CjD,EAAQ78E,UAAU28E,QAAU,SAASpkE,EAAMunE,GAEzC,OAAOpB,EAAY/B,QAAQr7E,KAAMiX,EAAMunE,IAGzCjD,EAAQ78E,UAAUq3E,MAAQ,WAExB/1E,KAAKq8E,OAAS,GACdr8E,KAAK87E,UAAY,GACjB97E,KAAK66B,KAAO,KACZ76B,KAAKgtB,KAAO,MAGduuD,EAAQ78E,UAAUf,IAAM,SAASU,EAAKmgF,GAEpC,YAAyBt+E,IAArBF,KAAKq8E,OAAOh+E,GACP2B,KAAKq8E,OAAOh+E,GAGZmgF,GAIXjD,EAAQ78E,UAAUoE,IAAM,SAASzE,EAAKN,GAEpCiC,KAAKq8E,OAAOh+E,GAAON,GAGrBw9E,EAAQ78E,UAAUiG,KAAO,WAEvB,OAAOnH,OAAOmH,KAAK3E,KAAKq8E,SAG1Bd,EAAQ78E,UAAUojC,MAAQ,WAExB,OAAOq7C,EAAMr7C,MAAM9hC,KAAKq8E,SAO1Bd,EAAQ78E,UAAU+/E,KAAO,SAAS7C,EAAKlmD,GAErC,IACI54B,EAUJ,IARY,MAAR8+E,IACFA,EAAM,MAGI,OAARA,GAAgB57E,KAAK47E,MAAQA,GAC/BlmD,EARS11B,MAWNlD,EAAI,EAAGA,EAAIkD,KAAK87E,UAAU16E,OAAQtE,IAC7BkD,KAAK87E,UAAUh/E,GACjB2hF,KAAK7C,EAAK,SAASr0E,GACvBmuB,EAASnuB,MAKfg0E,EAAQ78E,UAAUggF,SAAW,SAAShpD,GAEpC11B,KAAKy+E,KAAK,KAAM,SAASl3E,GACnBA,EAAEszB,MACJnF,EAASnuB,EAAEszB,MAGTtzB,EAAEylB,MACJ0I,EAASnuB,EAAEylB,SA8CjB4wD,EAAMl/E,UAAU8M,SAAW,WACzB,OAAOxL,KAAK66B,MAQdijD,EAAYp/E,UAAUy8E,QAAU,WAC9B,OAAOn7E,KAAK+9E,OAGdD,EAAYp/E,UAAUigF,SAAW,SAAS74E,GACxC9F,KAAK+9E,MAAQj4E,GAGfg4E,EAAYp/E,UAAUs+B,MAAQ,SAASE,EAAQqT,GAQ7C,OAPKA,IAEHA,EAAS,KADTA,EAAS+sC,EAAWC,EAAUqB,iBACVC,WAAU,IAAIxB,IAGpC9sC,EAAO4tB,KAAKjhC,GACZl9B,KAAK+9E,MAAQxtC,EAAOiQ,QACbxgD,KAAK+9E,OAGdD,EAAYp/E,UAAU+/E,KAAO,SAAS7C,EAAKlmD,GACzC11B,KAAK+9E,MAAMU,KAAK7C,EAAKlmD,IAGvBooD,EAAYp/E,UAAUupD,KAAO,SAAShxC,GACpC,OAAOjX,KAAK+9E,MAAM91B,KAAKhxC,IAGzB6mE,EAAYp/E,UAAU6/E,SAAW,SAAStnE,EAAMunE,GAC9C,OAAOx+E,KAAK+9E,MAAMQ,SAAStnE,EAAMunE,IAGnCV,EAAYp/E,UAAU28E,QAAU,SAASpkE,GACvC,OAAOjX,KAAK+9E,MAAM1C,QAAQpkE,IAM5B6mE,EAAYp/E,UAAU6e,MAAQ,SAASpV,GACrC,IAAIwzE,EAAK,GAWT,IAJgC,KANhCxzE,EAAUg1E,EAAMhlC,MAAM,CACpB/6B,SAAU,QACV0hE,gBAAiB,KACjBC,kBAAmB,KACnB72E,OAAQ,OAAQC,IAEN22E,iBACVnD,EAAGx6E,KAAK,iCAAiCgH,EAAQiV,SAAU,SAGtC,SAAnBjV,EAAQD,OACV82E,gBAAgBrD,EAAIjzE,KAAKq1E,MAAO3gE,cAE7B,CACH,IAAI6hE,EAAQC,EAAYlD,EAAQmD,EAC5BzlE,EAkFR,SAAqB1I,EAAMoM,EAAU2hE,GACnC,IAAIE,EAAS,GACTC,EAAa,GAEbH,IACFG,EAAWH,GAAqB,IAOlC,SAASK,EAAUC,GACjB,GAAiB,MAAbA,EAAM,GAAY,CACpB,IAAIpyD,EAAMoyD,EAAMnyD,UAAU,GAAG9d,MAAM,IAAK,GACpCpE,EAAMiiB,EAAI,GACV2uD,EAAM3uD,EAAI,GACVmtB,EAAS8kC,EAAWl0E,QAET9K,IAAXk6C,SAEal6C,KADfk6C,EAASklC,EAAet0E,MAEtBovC,EAAS,KAAO58C,OAAOmH,KAAKu6E,GAAY99E,QAE3B,QAAXg5C,IACF8kC,EAAWl0E,GAAOovC,IAKpB6kC,EAAOI,GADLjlC,EACczqB,EAAQ,QAASyqB,EAAQwhC,GAGzBA,MAGf,CACH,GAAImD,EACF,MAAM,IAAIx9E,MAAM,gEAGlB09E,EAAOI,GAASA,GAyCpB,OApCAruE,EAAKytE,KAAK,KAAM,SAASl3E,GACvB,IACIq0E,EAAMr0E,EAAEq0E,IACR/gD,EAAOtzB,EAAEszB,KACTiH,EAAQv6B,EAAEu6B,QAEd,GAAI85C,aAAegC,QAA8B19E,IAArB++E,EAAOrD,EAAI/gD,MACrCukD,EAAUxD,EAAI/gD,WAEX,GAAoB,iBAAV,EACbukD,EAAUxD,QAEP,GAAY,OAARA,GAAgBA,IAAQ6B,GAAW7B,IAAQ8B,GAAS9B,IAAQ+B,EACnE,MAAM,IAAIp8E,MAAM,uCAAwCq6E,GAGtD/gD,aAAgB+iD,QAA+B19E,IAAtB++E,EAAOpkD,EAAKA,OACvCukD,EAAUvkD,EAAKA,MAGjBiH,EAAMxzB,QAAQ,SAASioC,GACrB,IAAIl4C,EAAMk4C,EAAK,GACXx4C,EAAQw4C,EAAK,GACbl4C,aAAeu/E,IACjBv/E,EAAMA,EAAIw8B,WAGQ36B,IAAhB++E,EAAO5gF,IACT+gF,EAAU/gF,GAGRN,aAAiB6/E,QAAgC19E,IAAvB++E,EAAOlhF,EAAM88B,OACzCukD,EAAUrhF,EAAM88B,UAIf,CAACokD,EAAQC,GApKNK,CAAYv/E,KAAK+9E,MAAO51E,EAAQiV,SAAUjV,EAAQ42E,mBAY1D,GAXAE,EAASvlE,EAAE,GACXwlE,EAAaxlE,EAAE,GAEXvR,EAAQxJ,eAAe,WACzBq9E,EAAS,EACTmD,EAAgB,IAAI18E,MAAM0F,EAAQ6zE,OAAS,GAAG3vE,KAAK,MAGnD2vE,GAAS,EAGY,QAAnB7zE,EAAQD,OAOV,MAAM,IAAI3G,MAAM,gCAAiC4G,EAAQD,SAoJ/D,SAASs3E,EAAejiE,EAAOvM,EAAMoM,EAAU6hE,EAAQC,EAAYlD,EAAQmD,GACzE,IAAIvD,EAAM5qE,EAAK4qE,IACf,IAAI/gD,EAAO7pB,EAAK6pB,KAChB,IAAIiH,EAGJ,IAAI29C,EAAWzD,GAAsB,IAAXA,EAC1Bz+D,EAAM9a,MAAMu5E,EAAS,GAAG3vE,KAAK8yE,IAEzBvD,IAAQ6B,EACVlgE,EAAMoS,EAAQ,kBAAa+vD,EAAc7kD,EAAMzd,KAExCw+D,IAAQ+B,EACfpgE,EAAMoS,EAAQ,SAAU+vD,EAAc7kD,EAAMzd,KAErCw+D,IAAQ8B,EAEfngE,EAAMoS,EAAQ,iBADdkL,EAAOA,GAAQ,UAKH36B,KADZ07E,EAAMqD,EAAOrD,KAEP/gD,GACFtd,EAAMoiE,EAAa9kD,EAAMzd,IAE3BpM,EAAKytE,KAAK,SAASl3E,GACjBi4E,EAAejiE,EAAOhW,EAAG6V,EAAU6hE,EAAQ,OAAMQ,GAAWzD,EAAS,EAAWmD,OAIlF5hE,EAAM,IAAMq+D,KACZ95C,EAAQ9wB,EAAK8wB,UAEAo9C,KACXp9C,EAAM8T,OAEN9T,EAAMxzB,QAAQ,SAASioC,GACrB,IAAIrnC,EAAIqnC,EAAK,GACTtuC,EAAIsuC,EAAK,GAEPrnC,aAAa0uE,IACf1uE,EAAIA,EAAE2rB,MAIN5yB,EADEA,aAAa21E,EACXqB,EAAOh3E,EAAE4yB,MAGT+kD,EAAe33E,EAAGmV,GAExBG,EAAMoS,EAAQ,WAAcsvD,EAAO/vE,GAAIjH,MAGvCi3E,KACFp9C,EAAQq7C,EAAMr7C,MAAMo9C,IACdtpC,KAAK,SAAShnC,EAAGC,GAAK,OAAOD,EAAE,GAAKC,EAAE,KAE5CizB,EAAMxzB,QAAQ,SAASioC,GACrB,IAAIrnC,EAAIqnC,EAAK,GACTtuC,EAAIsuC,EAAK,GAETrnC,IACFA,EAAI,IAAMA,GAGZqO,EAAMoS,EAAQ,gBAAmBzgB,EAAG0wE,EAAe33E,EAAGmV,SAKxDyd,GAAQ7pB,EAAKrN,OACXk3B,GAAQA,EAAKrvB,WAAWuC,MAAM,WAC9B8sB,EAAO,MAGXtd,EAAM,MACDsd,GAAQ4kD,GACXliE,EAAM,MAGJsd,GACFtd,EAAMoiE,EAAa9kD,EAAMzd,IAE3BpM,EAAK8qE,UAAUxtE,QAAQ,SAAS/G,GAC9Bi4E,EAAejiE,EAAOhW,EAAG6V,EAAU6hE,EAAQ,OAAMQ,GAAWzD,EAAS,EAAWmD,MAG7EtkD,GAAQmhD,GACXz+D,EAAM9a,MAAMu5E,EAAS,GAAG3vE,KAAK8yE,IAE/B5hE,EAAM,KAAOq+D,EAAM,MAGnBr+D,EAAM,QAKRkiE,GACFliE,EAAM,MA7PJiiE,CAAe,SAASr5E,GACtBw1E,EAAGx6E,KAAKgF,IACPnG,KAAK+9E,MAAO51E,EAAQiV,SAAU6hE,EAAQC,EAAYlD,EAAQmD,GAQjE,OAAOxD,EAAGtvE,KAAK,KAGjB,IAAIizE,EAAiB,CAEjB,uCAAwC,MACxC,+BAAgC,OAChC,8CAA+C,MAC/C,mCAAoC,OAEpC,mCAAoC,KACpC,4CAA6C,MAE7C,mCAAoC,MAgBxC,SAASO,EAAQhlD,EAAMzd,EAAU0iE,EAAaC,GAc5C,OAbIllD,IAIFA,GADAA,GADAA,GADAA,EAAOA,EAAKrvB,YACAkD,QAAQ,KAAM,UACdA,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACrBqxE,IAEDllD,GADAA,EAAOA,EAAKnsB,QAAQ,MAAO,UACfA,QAAQ,MAAO,UAE3BoxE,IACFjlD,EAAOA,EAAKnsB,QAAQ,KAAM,YAGvBmsB,EAIT,SAAS+kD,EAAe/kD,EAAMzd,GAC5B,OAAOyiE,EAAQhlD,EAAMzd,GAAU,GAGjC,SAASsiE,EAAc7kD,EAAMzd,GAC3B,OAAOyiE,EAAQhlD,EAAMzd,GAAU,GAGjC,SAASuiE,EAAa9kD,EAAMzd,GAC1B,OAAOyiE,EAAQhlD,EAAMzd,GAAU,GAAO,GAyMxCxgB,EAAQojF,GAAKrC,EACb/gF,EAAQ6gF,QAAUA,EAClB7gF,EAAQ8gF,MAAQA,EAChB9gF,EAAQ+gF,sBAAwBA,EAChC/gF,EAAQ4+E,WApYR,SAAoBnlE,EAAQulE,EAAKS,GAC/B,IAAIv2E,EAAUuQ,EAAO2nE,YAAYpC,EAAKS,GAEtC,OADAhmE,EAAO0X,OAAOjoB,GACPA,GAkYTlJ,EAAQghF,MAAQA,EAChBhhF,EAAQkhF,YAAcA,EACtBlhF,EAAQwgF,YAAcA,EACtBxgF,EAAQ2+E,QAAU,SAASK,EAAKS,GAC9B,OAAO,IAAId,EAAQK,EAAKS,IAG1Bz/E,EAAQqjF,IAAM,SAAS95E,GAErB,OADS,IAAI23E,GACH9gD,MAAM72B,IAGlBvJ,EAAQogC,MA3BR,SAAeE,EAAQqT,GACrB,IAAIyE,EAAO,IAAI8oC,EAEf,OADA9oC,EAAKhY,MAAME,EAAQqT,GACZyE,GAyBTp4C,EAAQm+E,mBAnQR,SAA4B3gC,EAAQpvC,GAClC,GAAI,SAAS6C,KAAKusC,GAChB,MAAM,IAAI74C,MAAM,2CAGd+9E,EAAe3gF,eAAeqM,IAAQs0E,EAAet0E,KAASovC,UACzDklC,EAAet0E,GAGxBs0E,EAAet0E,GAAOovC,GA2PxBx9C,EAAQsjF,SAvBR,SAAkBp6E,EAASqC,GACzB,OAAO,IAAI21E,EAAYh4E,GAASyX,MAAMpV,K,cCvgBxCvL,EAAQklC,MAhDR,SAAerT,EAAM0xD,GACnBA,EAAUA,GAAW,KACrB,IAAIjxE,EAEgB7Q,EAFb+hF,EAAK,GAUZ,IAAKlxE,KAAKuf,GACJA,EAAK9vB,eAAeuQ,KATN7Q,EASyB8hF,EARtCA,GAA8B,IAAnBA,EAAQ/+E,QAIjB++E,EAAQ5xE,QAAQlQ,KAKrB+hF,EAAGj/E,KAAK,CAAC+N,EAAGuf,EAAKvf,KAIrB,OAAOkxE,GA+BTxjF,EAAQy+E,QA3BR,SAAiB7gE,EAAIyF,GAGnB,IAFA,IAAIlS,EAAOsyE,EAAU,GAEbtyE,EAAQyM,EAAGmkB,KAAK1e,IACpBogE,EAAQl/E,KAAK4M,GAGjB,OAAOsyE,GAqBTzjF,EAAQu7C,MAlBR,SAAevpC,EAAGC,GAChB,IAAYyxE,EAARnjF,EAAI,GAER,IAAKmjF,KAAY1xE,EACXA,EAAEjQ,eAAe2hF,KACnBnjF,EAAEmjF,GAAY1xE,EAAE0xE,IAGpB,IAAKA,KAAYzxE,EACXA,EAAElQ,eAAe2hF,KACnBnjF,EAAEmjF,GAAYzxE,EAAEyxE,IAGpB,OAAOnjF,I,gBClET,SAASkgF,EAAYkD,GACnBvgF,KAAKwgF,MAAQ,GACbxgF,KAAKygF,MAAQ,GACbzgF,KAAK0gF,MAAQ,KACb1gF,KAAK2gF,MAAQ,KACRJ,IAEHA,EAAkB,EAAQ,IAAiBhF,SAE7Cv7E,KAAK4gF,SAAWL,EAGlBlD,EAAY3+E,UAAU8hD,MAAQ,WAC5B,OAAOxgD,KAAK0gF,OAGdrD,EAAY3+E,UAAUmiF,OAAS,WAC7B,GAAI7gF,KAAKwgF,MAAO,CACd,GAAmB,OAAfxgF,KAAK0gF,MAAgB,CACvB,IAAI7lD,EAAO76B,KAAKwgF,MAAMn0E,KAAK,IACvBrM,KAAK2gF,MACP3gF,KAAK0gF,MAAM1zD,KAAO6N,EAGlB76B,KAAK0gF,MAAM7lD,KAAOA,EAGtB76B,KAAKwgF,MAAQ,KAIjBnD,EAAY3+E,UAAUyH,KAAO,SAASA,GACpCnG,KAAKwgF,MAAMr/E,KAAKgF,IAGlBk3E,EAAY3+E,UAAU0f,MAAQ,SAASw9D,EAAKkF,GAC1C9gF,KAAK6gF,SACL,IAAI7vE,EAAOhR,KAAK4gF,SAAShF,EAAKkF,GAC9B9gF,KAAK0gF,MAAQ1vE,EAEThR,KAAKygF,MAAMr/E,QACbpB,KAAKygF,MAAMzgF,KAAKygF,MAAMr/E,OAAS,GAAG2sB,OAAO/c,GAG3ChR,KAAKygF,MAAMt/E,KAAK6P,GAEhBhR,KAAK2gF,MAAQ,MAGftD,EAAY3+E,UAAUiK,IAAM,SAASizE,GAGnC,GAFA57E,KAAK6gF,SACL7gF,KAAK0gF,MAAQ1gF,KAAKygF,MAAMl8E,MACpBvE,KAAK0gF,MAAM9E,MAAQA,EACrB,MAAM,IAAIr6E,MAAM,oBAGlB,OADAvB,KAAK2gF,MAAQ,EACN3gF,KAAK0gF,OAGd9jF,EAAQygF,YAAcA,G,8BC3DtB,cAyBA,IAAI51E,EAAM,EAAQ,IAGlB5K,EAAOD,QAAUmL,EAGjB,IAIIH,EAJAwG,EAAU,EAAQ,IAOtBrG,EAASg5E,cAAgBA,EAGhB,EAAQ,GAAUjhF,aAA3B,IAEIkhF,EAAkB,SAAUv/E,EAAShB,GACvC,OAAOgB,EAAQmC,UAAUnD,GAAMW,QAK7B2zB,EAAS,EAAQ,IAKjBha,EAAS,EAAQ,IAAeA,OAChCkb,EAAgBzwB,EAAOkX,YAAc,aAWzC,IAAI7U,EAAO,EAAQ,IACnBA,EAAKC,SAAW,EAAQ,GAIxB,IAAIm5E,EAAY,EAAQ,IACpBC,OAAQ,EAEVA,EADED,GAAaA,EAAUnuD,SACjBmuD,EAAUnuD,SAAS,UAEnB,aAIV,IAEIwH,EAFA6mD,EAAa,EAAQ,IACrBhrD,EAAc,EAAQ,IAG1BtuB,EAAKC,SAASC,EAAUgtB,GAExB,IAAIqsD,EAAe,CAAC,QAAS,QAAS,UAAW,QAAS,UAc1D,SAASL,EAAc54E,EAASkuB,GAG9BluB,EAAUA,GAAW,GAOrB,IAAImuB,EAAWD,aATfzuB,EAASA,GAAU,EAAQ,IAa3B5H,KAAKu2B,aAAepuB,EAAQouB,WAExBD,IAAUt2B,KAAKu2B,WAAav2B,KAAKu2B,cAAgBpuB,EAAQk5E,oBAI7D,IAAI5qD,EAAMtuB,EAAQS,cACd04E,EAAcn5E,EAAQo5E,sBACtB3qD,EAAa52B,KAAKu2B,WAAa,GAAK,MAElBv2B,KAAK4I,cAAvB6tB,GAAe,IAARA,EAAgCA,EAAaH,IAAagrD,GAA+B,IAAhBA,GAAyCA,EAAsC1qD,EAGnK52B,KAAK4I,cAAgBqJ,KAAKsT,MAAMvlB,KAAK4I,eAKrC5I,KAAK0d,OAAS,IAAIyjE,EAClBnhF,KAAKoB,OAAS,EACdpB,KAAKwhF,MAAQ,KACbxhF,KAAKyhF,WAAa,EAClBzhF,KAAK0hF,QAAU,KACf1hF,KAAKwI,OAAQ,EACbxI,KAAK2hF,YAAa,EAClB3hF,KAAK4hF,SAAU,EAMf5hF,KAAKs3B,MAAO,EAIZt3B,KAAK6hF,cAAe,EACpB7hF,KAAK8hF,iBAAkB,EACvB9hF,KAAK+hF,mBAAoB,EACzB/hF,KAAKgiF,iBAAkB,EAGvBhiF,KAAK8I,WAAY,EAKjB9I,KAAKm3B,gBAAkBhvB,EAAQgvB,iBAAmB,OAGlDn3B,KAAKiiF,WAAa,EAGlBjiF,KAAKkiF,aAAc,EAEnBliF,KAAKmiF,QAAU,KACfniF,KAAKod,SAAW,KACZjV,EAAQiV,WACLkd,IAAeA,EAAgB,EAAQ,IAAmBA,eAC/Dt6B,KAAKmiF,QAAU,IAAI7nD,EAAcnyB,EAAQiV,UACzCpd,KAAKod,SAAWjV,EAAQiV,UAI5B,SAASrV,EAASI,GAGhB,GAFAP,EAASA,GAAU,EAAQ,KAErB5H,gBAAgB+H,GAAW,OAAO,IAAIA,EAASI,GAErDnI,KAAK6I,eAAiB,IAAIk4E,EAAc54E,EAASnI,MAGjDA,KAAKoI,UAAW,EAEZD,IAC0B,mBAAjBA,EAAQ+W,OAAqBlf,KAAKoiF,MAAQj6E,EAAQ+W,MAE9B,mBAApB/W,EAAQwmB,UAAwB3uB,KAAK+I,SAAWZ,EAAQwmB,UAGrEoG,EAAO93B,KAAK+C,MA2Dd,SAASqiF,EAAiBhsD,EAAQuC,EAAOxb,EAAUklE,EAAYC,GAC7D,IAKMj/E,EALFxB,EAAQu0B,EAAOxtB,eACL,OAAV+vB,GACF92B,EAAM8/E,SAAU,EA0NpB,SAAoBvrD,EAAQv0B,GAC1B,GAAIA,EAAM0G,MAAO,OACjB,GAAI1G,EAAMqgF,QAAS,CACjB,IAAIvpD,EAAQ92B,EAAMqgF,QAAQx5E,MACtBiwB,GAASA,EAAMx3B,SACjBU,EAAM4b,OAAOvc,KAAKy3B,GAClB92B,EAAMV,QAAUU,EAAMy0B,WAAa,EAAIqC,EAAMx3B,QAGjDU,EAAM0G,OAAQ,EAGdg6E,EAAansD,GArOXosD,CAAWpsD,EAAQv0B,KAGdygF,IAAgBj/E,EA2CzB,SAAsBxB,EAAO82B,GAC3B,IAAIt1B,EApPiBqE,EAqPFixB,EApPZ7d,EAAOD,SAASnT,IAAQA,aAAesuB,GAoPA,iBAAV2C,QAAgC14B,IAAV04B,GAAwB92B,EAAMy0B,aACtFjzB,EAAK,IAAIvC,UAAU,oCAtPvB,IAAuB4G,EAwPrB,OAAOrE,EAhDqBo/E,CAAa5gF,EAAO82B,IAC1Ct1B,EACF+yB,EAAOp1B,KAAK,QAASqC,GACZxB,EAAMy0B,YAAcqC,GAASA,EAAMx3B,OAAS,GAChC,iBAAVw3B,GAAuB92B,EAAMy0B,YAAc/4B,OAAOyF,eAAe21B,KAAW7d,EAAOrc,YAC5Fk6B,EAhNR,SAA6BA,GAC3B,OAAO7d,EAAO/G,KAAK4kB,GA+MLY,CAAoBZ,IAG1B0pD,EACExgF,EAAM6/E,WAAYtrD,EAAOp1B,KAAK,QAAS,IAAIM,MAAM,qCAA0CohF,EAAStsD,EAAQv0B,EAAO82B,GAAO,GACrH92B,EAAM0G,MACf6tB,EAAOp1B,KAAK,QAAS,IAAIM,MAAM,6BAE/BO,EAAM8/E,SAAU,EACZ9/E,EAAMqgF,UAAY/kE,GACpBwb,EAAQ92B,EAAMqgF,QAAQ5kE,MAAMqb,GACxB92B,EAAMy0B,YAA+B,IAAjBqC,EAAMx3B,OAAcuhF,EAAStsD,EAAQv0B,EAAO82B,GAAO,GAAYgqD,EAAcvsD,EAAQv0B,IAE7G6gF,EAAStsD,EAAQv0B,EAAO82B,GAAO,KAGzB0pD,IACVxgF,EAAM8/E,SAAU,IAIpB,OAgCF,SAAsB9/E,GACpB,OAAQA,EAAM0G,QAAU1G,EAAM+/E,cAAgB//E,EAAMV,OAASU,EAAM8G,eAAkC,IAAjB9G,EAAMV,QAjCnFyhF,CAAa/gF,GAGtB,SAAS6gF,EAAStsD,EAAQv0B,EAAO82B,EAAO0pD,GAClCxgF,EAAM4/E,SAA4B,IAAjB5/E,EAAMV,SAAiBU,EAAMw1B,MAChDjB,EAAOp1B,KAAK,OAAQ23B,GACpBvC,EAAOnX,KAAK,KAGZpd,EAAMV,QAAUU,EAAMy0B,WAAa,EAAIqC,EAAMx3B,OACzCkhF,EAAYxgF,EAAM4b,OAAOxc,QAAQ03B,GAAY92B,EAAM4b,OAAOvc,KAAKy3B,GAE/D92B,EAAM+/E,cAAcW,EAAansD,IAEvCusD,EAAcvsD,EAAQv0B,GAvGxBtE,OAAOC,eAAesK,EAASrJ,UAAW,YAAa,CACrDf,IAAK,WACH,YAA4BuC,IAAxBF,KAAK6I,gBAGF7I,KAAK6I,eAAeC,WAE7BhG,IAAK,SAAU/E,GAGRiC,KAAK6I,iBAMV7I,KAAK6I,eAAeC,UAAY/K,MAIpCgK,EAASrJ,UAAUiwB,QAAUwH,EAAYxH,QACzC5mB,EAASrJ,UAAU07B,WAAajE,EAAYkE,UAC5CtyB,EAASrJ,UAAUqK,SAAW,SAAUxF,EAAKyF,GAC3ChJ,KAAKmB,KAAK,MACV6H,EAAGzF,IAOLwE,EAASrJ,UAAUyC,KAAO,SAAUy3B,EAAOxb,GACzC,IACImlE,EADAzgF,EAAQ9B,KAAK6I,eAgBjB,OAbK/G,EAAMy0B,WAUTgsD,GAAiB,EATI,iBAAV3pD,KACTxb,EAAWA,GAAYtb,EAAMq1B,mBACZr1B,EAAMsb,WACrBwb,EAAQ7d,EAAO/G,KAAK4kB,EAAOxb,GAC3BA,EAAW,IAEbmlE,GAAiB,GAMdF,EAAiBriF,KAAM44B,EAAOxb,GAAU,EAAOmlE,IAIxDx6E,EAASrJ,UAAUwC,QAAU,SAAU03B,GACrC,OAAOypD,EAAiBriF,KAAM44B,EAAO,MAAM,GAAM,IAwEnD7wB,EAASrJ,UAAUokF,SAAW,WAC5B,OAAuC,IAAhC9iF,KAAK6I,eAAe64E,SAI7B35E,EAASrJ,UAAUqkF,YAAc,SAAUvoD,GAIzC,OAHKF,IAAeA,EAAgB,EAAQ,IAAmBA,eAC/Dt6B,KAAK6I,eAAes5E,QAAU,IAAI7nD,EAAcE,GAChDx6B,KAAK6I,eAAeuU,SAAWod,EACxBx6B,MAIT,IAAIgjF,EAAU,QAoBd,SAASC,EAAc1kF,EAAGuD,GACxB,OAAIvD,GAAK,GAAsB,IAAjBuD,EAAMV,QAAgBU,EAAM0G,MAAc,EACpD1G,EAAMy0B,WAAmB,EACzBh4B,GAAMA,EAEJuD,EAAM4/E,SAAW5/E,EAAMV,OAAeU,EAAM4b,OAAOwlE,KAAK/8E,KAAK/E,OAAmBU,EAAMV,QAGxF7C,EAAIuD,EAAM8G,gBAAe9G,EAAM8G,cA3BrC,SAAiCrK,GAc/B,OAbIA,GAAKykF,EACPzkF,EAAIykF,GAIJzkF,IACAA,GAAKA,IAAM,EACXA,GAAKA,IAAM,EACXA,GAAKA,IAAM,EACXA,GAAKA,IAAM,EACXA,GAAKA,IAAM,GACXA,KAEKA,EAa4C4kF,CAAwB5kF,IACvEA,GAAKuD,EAAMV,OAAe7C,EAEzBuD,EAAM0G,MAIJ1G,EAAMV,QAHXU,EAAM+/E,cAAe,EACd,IA4HX,SAASW,EAAansD,GACpB,IAAIv0B,EAAQu0B,EAAOxtB,eACnB/G,EAAM+/E,cAAe,EAChB//E,EAAMggF,kBACTZ,EAAM,eAAgBp/E,EAAM4/E,SAC5B5/E,EAAMggF,iBAAkB,EACpBhgF,EAAMw1B,KAAM7vB,EAAI5B,SAASu9E,EAAe/sD,GAAa+sD,EAAc/sD,IAI3E,SAAS+sD,EAAc/sD,GACrB6qD,EAAM,iBACN7qD,EAAOp1B,KAAK,YACZoiF,EAAKhtD,GASP,SAASusD,EAAcvsD,EAAQv0B,GACxBA,EAAMogF,cACTpgF,EAAMogF,aAAc,EACpBz6E,EAAI5B,SAASy9E,EAAgBjtD,EAAQv0B,IAIzC,SAASwhF,EAAejtD,EAAQv0B,GAE9B,IADA,IAAI6B,EAAM7B,EAAMV,QACRU,EAAM8/E,UAAY9/E,EAAM4/E,UAAY5/E,EAAM0G,OAAS1G,EAAMV,OAASU,EAAM8G,gBAC9Es4E,EAAM,wBACN7qD,EAAOnX,KAAK,GACRvb,IAAQ7B,EAAMV,SAELuC,EAAM7B,EAAMV,OAE3BU,EAAMogF,aAAc,EAyOtB,SAASqB,EAAiB76E,GACxBw4E,EAAM,4BACNx4E,EAAKwW,KAAK,GAsBZ,SAASskE,EAAQntD,EAAQv0B,GAClBA,EAAM8/E,UACTV,EAAM,iBACN7qD,EAAOnX,KAAK,IAGdpd,EAAMkgF,iBAAkB,EACxBlgF,EAAMmgF,WAAa,EACnB5rD,EAAOp1B,KAAK,UACZoiF,EAAKhtD,GACDv0B,EAAM4/E,UAAY5/E,EAAM8/E,SAASvrD,EAAOnX,KAAK,GAanD,SAASmkE,EAAKhtD,GACZ,IAAIv0B,EAAQu0B,EAAOxtB,eAEnB,IADAq4E,EAAM,OAAQp/E,EAAM4/E,SACb5/E,EAAM4/E,SAA6B,OAAlBrrD,EAAOnX,UAmFjC,SAASukE,EAASllF,EAAGuD,GAEnB,OAAqB,IAAjBA,EAAMV,OAAqB,MAG3BU,EAAMy0B,WAAY/zB,EAAMV,EAAM4b,OAAOrZ,SAAkB9F,GAAKA,GAAKuD,EAAMV,QAEtDoB,EAAfV,EAAMqgF,QAAergF,EAAM4b,OAAOrR,KAAK,IAAqC,IAAxBvK,EAAM4b,OAAOtc,OAAoBU,EAAM4b,OAAOwlE,KAAK/8E,KAAgBrE,EAAM4b,OAAOhe,OAAOoC,EAAMV,QACrJU,EAAM4b,OAAOq4D,SAGbvzE,EASJ,SAAyBjE,EAAG2F,EAAMw/E,GAChC,IAAIlhF,EACAjE,EAAI2F,EAAKg/E,KAAK/8E,KAAK/E,QAErBoB,EAAM0B,EAAKg/E,KAAK/8E,KAAKkJ,MAAM,EAAG9Q,GAC9B2F,EAAKg/E,KAAK/8E,KAAOjC,EAAKg/E,KAAK/8E,KAAKkJ,MAAM9Q,IAGtCiE,EAFSjE,IAAM2F,EAAKg/E,KAAK/8E,KAAK/E,OAExB8C,EAAKG,QAGLq/E,EASV,SAA8BnlF,EAAG2F,GAC/B,IAAItF,EAAIsF,EAAKg/E,KACT/lF,EAAI,EACJqF,EAAM5D,EAAEuH,KACZ5H,GAAKiE,EAAIpB,OACT,KAAOxC,EAAIA,EAAE02B,MAAM,CACjB,IAAIrV,EAAMrhB,EAAEuH,KACRo0B,EAAKh8B,EAAI0hB,EAAI7e,OAAS6e,EAAI7e,OAAS7C,EAGvC,GAFIg8B,IAAOta,EAAI7e,OAAQoB,GAAOyd,EAASzd,GAAOyd,EAAI5Q,MAAM,EAAG9Q,GAEjD,KADVA,GAAKg8B,GACQ,CACPA,IAAOta,EAAI7e,UACXjE,EACEyB,EAAE02B,KAAMpxB,EAAKg/E,KAAOtkF,EAAE02B,KAAUpxB,EAAKg/E,KAAOh/E,EAAK8oB,KAAO,OAE5D9oB,EAAKg/E,KAAOtkF,EACZA,EAAEuH,KAAO8Z,EAAI5Q,MAAMkrB,IAErB,QAEAp9B,EAGJ,OADA+G,EAAK9C,QAAUjE,EACRqF,EAhCcmhF,CAAqBplF,EAAG2F,GAsC/C,SAAwB3F,EAAG2F,GACzB,IAAI1B,EAAMuY,EAAO8B,YAAYte,GACzBK,EAAIsF,EAAKg/E,KACT/lF,EAAI,EACRyB,EAAEuH,KAAKtD,KAAKL,GACZjE,GAAKK,EAAEuH,KAAK/E,OACZ,KAAOxC,EAAIA,EAAE02B,MAAM,CACjB,IAAInW,EAAMvgB,EAAEuH,KACRo0B,EAAKh8B,EAAI4gB,EAAI/d,OAAS+d,EAAI/d,OAAS7C,EAGvC,GAFA4gB,EAAItc,KAAKL,EAAKA,EAAIpB,OAAS7C,EAAG,EAAGg8B,GAEvB,KADVh8B,GAAKg8B,GACQ,CACPA,IAAOpb,EAAI/d,UACXjE,EACEyB,EAAE02B,KAAMpxB,EAAKg/E,KAAOtkF,EAAE02B,KAAUpxB,EAAKg/E,KAAOh/E,EAAK8oB,KAAO,OAE5D9oB,EAAKg/E,KAAOtkF,EACZA,EAAEuH,KAAOgZ,EAAI9P,MAAMkrB,IAErB,QAEAp9B,EAGJ,OADA+G,EAAK9C,QAAUjE,EACRqF,EA9D8CohF,CAAerlF,EAAG2F,GAEvE,OAAO1B,EAtBCqhF,CAAgBtlF,EAAGuD,EAAM4b,OAAQ5b,EAAMqgF,SAGxC3/E,GAVP,IAAIA,EA4FN,SAASshF,EAAYztD,GACnB,IAAIv0B,EAAQu0B,EAAOxtB,eAInB,GAAI/G,EAAMV,OAAS,EAAG,MAAM,IAAIG,MAAM,8CAEjCO,EAAM6/E,aACT7/E,EAAM0G,OAAQ,EACdf,EAAI5B,SAASk+E,EAAejiF,EAAOu0B,IAIvC,SAAS0tD,EAAcjiF,EAAOu0B,GAEvBv0B,EAAM6/E,YAA+B,IAAjB7/E,EAAMV,SAC7BU,EAAM6/E,YAAa,EACnBtrD,EAAOjuB,UAAW,EAClBiuB,EAAOp1B,KAAK,QAIhB,SAASsN,EAAQy1E,EAAItqE,GACnB,IAAK,IAAI5c,EAAI,EAAGC,EAAIinF,EAAG5iF,OAAQtE,EAAIC,EAAGD,IACpC,GAAIknF,EAAGlnF,KAAO4c,EAAG,OAAO5c,EAE1B,OAAQ,EApoBViL,EAASrJ,UAAUwgB,KAAO,SAAU3gB,GAClC2iF,EAAM,OAAQ3iF,GACdA,EAAI4O,SAAS5O,EAAG,IAChB,IAAIuD,EAAQ9B,KAAK6I,eACbo7E,EAAQ1lF,EAOZ,GALU,IAANA,IAASuD,EAAMggF,iBAAkB,GAK3B,IAANvjF,GAAWuD,EAAM+/E,eAAiB//E,EAAMV,QAAUU,EAAM8G,eAAiB9G,EAAM0G,OAGjF,OAFA04E,EAAM,qBAAsBp/E,EAAMV,OAAQU,EAAM0G,OAC3B,IAAjB1G,EAAMV,QAAgBU,EAAM0G,MAAOs7E,EAAY9jF,MAAWwiF,EAAaxiF,MACpE,KAMT,GAAU,KAHVzB,EAAI0kF,EAAc1kF,EAAGuD,KAGNA,EAAM0G,MAEnB,OADqB,IAAjB1G,EAAMV,QAAc0iF,EAAY9jF,MAC7B,KA0BT,IA4BIwC,EA5BA0hF,EAASpiF,EAAM+/E,aAiDnB,OAhDAX,EAAM,gBAAiBgD,IAGF,IAAjBpiF,EAAMV,QAAgBU,EAAMV,OAAS7C,EAAIuD,EAAM8G,gBAEjDs4E,EAAM,6BADNgD,GAAS,GAMPpiF,EAAM0G,OAAS1G,EAAM8/E,QAEvBV,EAAM,mBADNgD,GAAS,GAEAA,IACThD,EAAM,WACNp/E,EAAM8/E,SAAU,EAChB9/E,EAAMw1B,MAAO,EAEQ,IAAjBx1B,EAAMV,SAAcU,EAAM+/E,cAAe,GAE7C7hF,KAAKoiF,MAAMtgF,EAAM8G,eACjB9G,EAAMw1B,MAAO,EAGRx1B,EAAM8/E,UAASrjF,EAAI0kF,EAAcgB,EAAOniF,KAMnC,QAFDU,EAAPjE,EAAI,EAASklF,EAASllF,EAAGuD,GAAkB,OAG7CA,EAAM+/E,cAAe,EACrBtjF,EAAI,GAEJuD,EAAMV,QAAU7C,EAGG,IAAjBuD,EAAMV,SAGHU,EAAM0G,QAAO1G,EAAM+/E,cAAe,GAGnCoC,IAAU1lF,GAAKuD,EAAM0G,OAAOs7E,EAAY9jF,OAGlC,OAARwC,GAAcxC,KAAKiB,KAAK,OAAQuB,GAE7BA,GAkETuF,EAASrJ,UAAU0jF,MAAQ,SAAU7jF,GACnCyB,KAAKiB,KAAK,QAAS,IAAIM,MAAM,gCAG/BwG,EAASrJ,UAAU66B,KAAO,SAAU4qD,EAAMC,GACxC,IAAIj2E,EAAMnO,KACN8B,EAAQ9B,KAAK6I,eAEjB,OAAQ/G,EAAM2/E,YACZ,KAAK,EACH3/E,EAAM0/E,MAAQ2C,EACd,MACF,KAAK,EACHriF,EAAM0/E,MAAQ,CAAC1/E,EAAM0/E,MAAO2C,GAC5B,MACF,QACEriF,EAAM0/E,MAAMrgF,KAAKgjF,GAGrBriF,EAAM2/E,YAAc,EACpBP,EAAM,wBAAyBp/E,EAAM2/E,WAAY2C,GAEjD,IAEIC,IAFUD,IAA6B,IAAjBA,EAASz7E,MAAkBw7E,IAAS96E,EAAQi7E,QAAUH,IAAS96E,EAAQk7E,OAE7Ej8E,EAAQk8E,EAI5B,SAASC,EAASr8E,EAAUs8E,GAC1BxD,EAAM,YACF94E,IAAa+F,GACXu2E,IAAwC,IAA1BA,EAAWC,aAC3BD,EAAWC,YAAa,EAoB5BzD,EAAM,WAENiD,EAAKhiF,eAAe,QAASyiF,GAC7BT,EAAKhiF,eAAe,SAAU0iF,GAC9BV,EAAKhiF,eAAe,QAAS2iF,GAC7BX,EAAKhiF,eAAe,QAAS2vD,GAC7BqyB,EAAKhiF,eAAe,SAAUsiF,GAC9Bt2E,EAAIhM,eAAe,MAAOmG,GAC1B6F,EAAIhM,eAAe,MAAOqiF,GAC1Br2E,EAAIhM,eAAe,OAAQ4iF,GAE3BC,GAAY,GAORljF,EAAMmgF,YAAgBkC,EAAK57E,iBAAkB47E,EAAK57E,eAAeuuB,WAAYguD,KAhCnF,SAASx8E,IACP44E,EAAM,SACNiD,EAAKx7E,MAfH7G,EAAM6/E,WAAYl6E,EAAI5B,SAASw+E,GAAYl2E,EAAInK,KAAK,MAAOqgF,GAE/DF,EAAKrgF,GAAG,SAAU2gF,GAoBlB,IAAIK,EA4FN,SAAqB32E,GACnB,OAAO,WACL,IAAIrM,EAAQqM,EAAItF,eAChBq4E,EAAM,cAAep/E,EAAMmgF,YACvBngF,EAAMmgF,YAAYngF,EAAMmgF,aACH,IAArBngF,EAAMmgF,YAAoBjB,EAAgB7yE,EAAK,UACjDrM,EAAM4/E,SAAU,EAChB2B,EAAKl1E,KAnGK82E,CAAY92E,GAC1Bg2E,EAAKrgF,GAAG,QAASghF,GAEjB,IAAIE,GAAY,EA2BhB,IAAIE,GAAsB,EAE1B,SAASH,EAAOnsD,GACdsoD,EAAM,UACNgE,GAAsB,GAElB,IADMf,EAAK5mE,MAAMqb,IACCssD,KAKM,IAArBpjF,EAAM2/E,YAAoB3/E,EAAM0/E,QAAU2C,GAAQriF,EAAM2/E,WAAa,IAAqC,IAAhClzE,EAAQzM,EAAM0/E,MAAO2C,MAAkBa,IACpH9D,EAAM,8BAA+B/yE,EAAItF,eAAeo5E,YACxD9zE,EAAItF,eAAeo5E,aACnBiD,GAAsB,GAExB/2E,EAAIg3E,SAMR,SAASrzB,EAAQxuD,GACf49E,EAAM,UAAW59E,GACjBkhF,IACAL,EAAKhiF,eAAe,QAAS2vD,GACU,IAAnCkvB,EAAgBmD,EAAM,UAAgBA,EAAKljF,KAAK,QAASqC,GAO/D,SAASshF,IACPT,EAAKhiF,eAAe,SAAU0iF,GAC9BL,IAGF,SAASK,IACP3D,EAAM,YACNiD,EAAKhiF,eAAe,QAASyiF,GAC7BJ,IAIF,SAASA,IACPtD,EAAM,UACN/yE,EAAIq2E,OAAOL,GAYb,OA1DAh2E,EAAIrK,GAAG,OAAQihF,GA9gBjB,SAAyBtjF,EAAS8pB,EAAOrE,GAGvC,GAAuC,mBAA5BzlB,EAAQsC,gBAAgC,OAAOtC,EAAQsC,gBAAgBwnB,EAAOrE,GAMpFzlB,EAAQxB,SAAYwB,EAAQxB,QAAQsrB,GAAuCnd,EAAQ3M,EAAQxB,QAAQsrB,IAAS9pB,EAAQxB,QAAQsrB,GAAOrqB,QAAQgmB,GAASzlB,EAAQxB,QAAQsrB,GAAS,CAACrE,EAAIzlB,EAAQxB,QAAQsrB,IAAtJ9pB,EAAQqC,GAAGynB,EAAOrE,GAkiBnEnjB,CAAgBogF,EAAM,QAASryB,GAO/BqyB,EAAKngF,KAAK,QAAS4gF,GAMnBT,EAAKngF,KAAK,SAAU6gF,GAQpBV,EAAKljF,KAAK,OAAQkN,GAGbrM,EAAM4/E,UACTR,EAAM,eACN/yE,EAAIi3E,UAGCjB,GAeTp8E,EAASrJ,UAAU8lF,OAAS,SAAUL,GACpC,IAAIriF,EAAQ9B,KAAK6I,eACb67E,EAAa,CAAEC,YAAY,GAG/B,GAAyB,IAArB7iF,EAAM2/E,WAAkB,OAAOzhF,KAGnC,GAAyB,IAArB8B,EAAM2/E,WAER,OAAI0C,GAAQA,IAASriF,EAAM0/E,MAAcxhF,MAEpCmkF,IAAMA,EAAOriF,EAAM0/E,OAGxB1/E,EAAM0/E,MAAQ,KACd1/E,EAAM2/E,WAAa,EACnB3/E,EAAM4/E,SAAU,EACZyC,GAAMA,EAAKljF,KAAK,SAAUjB,KAAM0kF,GAC7B1kF,MAKT,IAAKmkF,EAAM,CAET,IAAIkB,EAAQvjF,EAAM0/E,MACd79E,EAAM7B,EAAM2/E,WAChB3/E,EAAM0/E,MAAQ,KACd1/E,EAAM2/E,WAAa,EACnB3/E,EAAM4/E,SAAU,EAEhB,IAAK,IAAI5kF,EAAI,EAAGA,EAAI6G,EAAK7G,IACvBuoF,EAAMvoF,GAAGmE,KAAK,SAAUjB,KAAM0kF,GAC/B,OAAO1kF,KAIV,IAAIsE,EAAQiK,EAAQzM,EAAM0/E,MAAO2C,GACjC,OAAe,IAAX7/E,EAAqBtE,MAEzB8B,EAAM0/E,MAAMvgD,OAAO38B,EAAO,GAC1BxC,EAAM2/E,YAAc,EACK,IAArB3/E,EAAM2/E,aAAkB3/E,EAAM0/E,MAAQ1/E,EAAM0/E,MAAM,IAEtD2C,EAAKljF,KAAK,SAAUjB,KAAM0kF,GAEnB1kF,OAKT+H,EAASrJ,UAAUoF,GAAK,SAAUwhF,EAAIp+D,GACpC,IAAIhb,EAAM6oB,EAAOr2B,UAAUoF,GAAG7G,KAAK+C,KAAMslF,EAAIp+D,GAE7C,GAAW,SAAPo+D,GAEkC,IAAhCtlF,KAAK6I,eAAe64E,SAAmB1hF,KAAKolF,cAC3C,GAAW,aAAPE,EAAmB,CAC5B,IAAIxjF,EAAQ9B,KAAK6I,eACZ/G,EAAM6/E,YAAe7/E,EAAMigF,oBAC9BjgF,EAAMigF,kBAAoBjgF,EAAM+/E,cAAe,EAC/C//E,EAAMggF,iBAAkB,EACnBhgF,EAAM8/E,QAEA9/E,EAAMV,QACfohF,EAAaxiF,MAFbyH,EAAI5B,SAAS09E,EAAkBvjF,OAOrC,OAAOkM,GAETnE,EAASrJ,UAAUmF,YAAckE,EAASrJ,UAAUoF,GASpDiE,EAASrJ,UAAU0mF,OAAS,WAC1B,IAAItjF,EAAQ9B,KAAK6I,eAMjB,OALK/G,EAAM4/E,UACTR,EAAM,UACNp/E,EAAM4/E,SAAU,EAMpB,SAAgBrrD,EAAQv0B,GACjBA,EAAMkgF,kBACTlgF,EAAMkgF,iBAAkB,EACxBv6E,EAAI5B,SAAS29E,EAASntD,EAAQv0B,IAR9BsjF,CAAOplF,KAAM8B,IAER9B,MAuBT+H,EAASrJ,UAAUymF,MAAQ,WAOzB,OANAjE,EAAM,wBAAyBlhF,KAAK6I,eAAe64E,UAC/C,IAAU1hF,KAAK6I,eAAe64E,UAChCR,EAAM,SACNlhF,KAAK6I,eAAe64E,SAAU,EAC9B1hF,KAAKiB,KAAK,UAELjB,MAYT+H,EAASrJ,UAAU6mF,KAAO,SAAUlvD,GAClC,IAAIhB,EAAQr1B,KAER8B,EAAQ9B,KAAK6I,eACb28E,GAAS,EA4Bb,IAAK,IAAI1oF,KA1BTu5B,EAAOvyB,GAAG,MAAO,WAEf,GADAo9E,EAAM,eACFp/E,EAAMqgF,UAAYrgF,EAAM0G,MAAO,CACjC,IAAIowB,EAAQ92B,EAAMqgF,QAAQx5E,MACtBiwB,GAASA,EAAMx3B,QAAQi0B,EAAMl0B,KAAKy3B,GAGxCvD,EAAMl0B,KAAK,QAGbk1B,EAAOvyB,GAAG,OAAQ,SAAU80B,IAC1BsoD,EAAM,gBACFp/E,EAAMqgF,UAASvpD,EAAQ92B,EAAMqgF,QAAQ5kE,MAAMqb,IAG3C92B,EAAMy0B,YAAc,MAACqC,KAAyD92B,EAAMy0B,YAAgBqC,GAAUA,EAAMx3B,UAE9Gi0B,EAAMl0B,KAAKy3B,KAEnB4sD,GAAS,EACTnvD,EAAO8uD,YAMG9uD,OACIn2B,IAAZF,KAAKlD,IAAyC,mBAAdu5B,EAAOv5B,KACzCkD,KAAKlD,GAAK,SAAUoL,GAClB,OAAO,WACL,OAAOmuB,EAAOnuB,GAAQhJ,MAAMm3B,EAAQn0B,YAF9B,CAIRpF,IAKN,IAAK,IAAIyB,EAAI,EAAGA,EAAI6iF,EAAahgF,OAAQ7C,IACvC83B,EAAOvyB,GAAGs9E,EAAa7iF,GAAIyB,KAAKiB,KAAK3C,KAAK0B,KAAMohF,EAAa7iF,KAa/D,OARAyB,KAAKoiF,MAAQ,SAAU7jF,GACrB2iF,EAAM,gBAAiB3iF,GACnBinF,IACFA,GAAS,EACTnvD,EAAO+uD,WAIJplF,MAGTxC,OAAOC,eAAesK,EAASrJ,UAAW,wBAAyB,CAIjEhB,YAAY,EACZC,IAAK,WACH,OAAOqC,KAAK6I,eAAeD,iBAK/Bb,EAAS09E,UAAYhC,I,sCCz3BrB5mF,EAAOD,QAAU,EAAQ,GAAUkD,c,6BCInC,IAAI2H,EAAM,EAAQ,IA8DlB,SAASi+E,EAAYh9E,EAAMnF,GACzBmF,EAAKzH,KAAK,QAASsC,GAGrB1G,EAAOD,QAAU,CACf+xB,QA/DF,SAAiBprB,EAAKyF,GACpB,IAAIqsB,EAAQr1B,KAER2lF,EAAoB3lF,KAAK6I,gBAAkB7I,KAAK6I,eAAeC,UAC/D88E,EAAoB5lF,KAAKuI,gBAAkBvI,KAAKuI,eAAeO,UAEnE,OAAI68E,GAAqBC,GACnB58E,EACFA,EAAGzF,IACMA,GAASvD,KAAKuI,gBAAmBvI,KAAKuI,eAAesvB,cAC9DpwB,EAAI5B,SAAS6/E,EAAa1lF,KAAMuD,GAE3BvD,OAMLA,KAAK6I,iBACP7I,KAAK6I,eAAeC,WAAY,GAI9B9I,KAAKuI,iBACPvI,KAAKuI,eAAeO,WAAY,GAGlC9I,KAAK+I,SAASxF,GAAO,KAAM,SAAUA,IAC9ByF,GAAMzF,GACTkE,EAAI5B,SAAS6/E,EAAarwD,EAAO9xB,GAC7B8xB,EAAM9sB,iBACR8sB,EAAM9sB,eAAesvB,cAAe,IAE7B7uB,GACTA,EAAGzF,KAIAvD,OA0BPq6B,UAvBF,WACMr6B,KAAK6I,iBACP7I,KAAK6I,eAAeC,WAAY,EAChC9I,KAAK6I,eAAe+4E,SAAU,EAC9B5hF,KAAK6I,eAAeL,OAAQ,EAC5BxI,KAAK6I,eAAe84E,YAAa,GAG/B3hF,KAAKuI,iBACPvI,KAAKuI,eAAeO,WAAY,EAChC9I,KAAKuI,eAAeC,OAAQ,EAC5BxI,KAAKuI,eAAewuB,QAAS,EAC7B/2B,KAAKuI,eAAeyuB,UAAW,EAC/Bh3B,KAAKuI,eAAesvB,cAAe,M,6BCGvCh7B,EAAOD,QAAUo4B,EAEjB,IAAIptB,EAAS,EAAQ,GAGjBC,EAAO,EAAQ,IAMnB,SAASg+E,EAAeviF,EAAI6C,GAC1B,IAAI2/E,EAAK9lF,KAAK+lF,gBACdD,EAAGE,cAAe,EAElB,IAAIh9E,EAAK88E,EAAGruD,QAEZ,IAAKzuB,EACH,OAAOhJ,KAAKiB,KAAK,QAAS,IAAIM,MAAM,yCAGtCukF,EAAGG,WAAa,KAChBH,EAAGruD,QAAU,KAED,MAARtxB,GACFnG,KAAKmB,KAAKgF,GAEZ6C,EAAG1F,GAEH,IAAI4iF,EAAKlmF,KAAK6I,eACdq9E,EAAGtE,SAAU,GACTsE,EAAGrE,cAAgBqE,EAAG9kF,OAAS8kF,EAAGt9E,gBACpC5I,KAAKoiF,MAAM8D,EAAGt9E,eAIlB,SAASosB,EAAU7sB,GACjB,KAAMnI,gBAAgBg1B,GAAY,OAAO,IAAIA,EAAU7sB,GAEvDP,EAAO3K,KAAK+C,KAAMmI,GAElBnI,KAAK+lF,gBAAkB,CACrBF,eAAgBA,EAAevnF,KAAK0B,MACpCmmF,eAAe,EACfH,cAAc,EACdvuD,QAAS,KACTwuD,WAAY,KACZG,cAAe,MAIjBpmF,KAAK6I,eAAeg5E,cAAe,EAKnC7hF,KAAK6I,eAAeyuB,MAAO,EAEvBnvB,IAC+B,mBAAtBA,EAAQk/B,YAA0BrnC,KAAKqmF,WAAal+E,EAAQk/B,WAE1C,mBAAlBl/B,EAAQm+E,QAAsBtmF,KAAK6gF,OAAS14E,EAAQm+E,QAIjEtmF,KAAK8D,GAAG,YAAaq1B,GAGvB,SAASA,IACP,IAAI9D,EAAQr1B,KAEe,mBAAhBA,KAAK6gF,OACd7gF,KAAK6gF,OAAO,SAAUv9E,EAAI6C,GACxB8tC,EAAK5e,EAAO/xB,EAAI6C,KAGlB8tC,EAAKj0C,KAAM,KAAM,MA2DrB,SAASi0C,EAAK5d,EAAQ/yB,EAAI6C,GACxB,GAAI7C,EAAI,OAAO+yB,EAAOp1B,KAAK,QAASqC,GAOpC,GALY,MAAR6C,GACFkwB,EAAOl1B,KAAKgF,GAIVkwB,EAAO9tB,eAAenH,OAAQ,MAAM,IAAIG,MAAM,8CAElD,GAAI80B,EAAO0vD,gBAAgBC,aAAc,MAAM,IAAIzkF,MAAM,kDAEzD,OAAO80B,EAAOl1B,KAAK,MA7IrB0G,EAAKC,SAAW,EAAQ,GAGxBD,EAAKC,SAASktB,EAAWptB,GAuEzBotB,EAAUt2B,UAAUyC,KAAO,SAAUy3B,EAAOxb,GAE1C,OADApd,KAAK+lF,gBAAgBI,eAAgB,EAC9Bv+E,EAAOlJ,UAAUyC,KAAKlE,KAAK+C,KAAM44B,EAAOxb,IAajD4X,EAAUt2B,UAAU2nF,WAAa,SAAUztD,EAAOxb,EAAUpU,GAC1D,MAAM,IAAIzH,MAAM,oCAGlByzB,EAAUt2B,UAAU45B,OAAS,SAAUM,EAAOxb,EAAUpU,GACtD,IAAI88E,EAAK9lF,KAAK+lF,gBAId,GAHAD,EAAGruD,QAAUzuB,EACb88E,EAAGG,WAAartD,EAChBktD,EAAGM,cAAgBhpE,GACd0oE,EAAGE,aAAc,CACpB,IAAIE,EAAKlmF,KAAK6I,gBACVi9E,EAAGK,eAAiBD,EAAGrE,cAAgBqE,EAAG9kF,OAAS8kF,EAAGt9E,gBAAe5I,KAAKoiF,MAAM8D,EAAGt9E,iBAO3FosB,EAAUt2B,UAAU0jF,MAAQ,SAAU7jF,GACpC,IAAIunF,EAAK9lF,KAAK+lF,gBAEQ,OAAlBD,EAAGG,YAAuBH,EAAGruD,UAAYquD,EAAGE,cAC9CF,EAAGE,cAAe,EAClBhmF,KAAKqmF,WAAWP,EAAGG,WAAYH,EAAGM,cAAeN,EAAGD,iBAIpDC,EAAGK,eAAgB,GAIvBnxD,EAAUt2B,UAAUqK,SAAW,SAAUxF,EAAKyF,GAC5C,IAAIu9E,EAASvmF,KAEb4H,EAAOlJ,UAAUqK,SAAS9L,KAAK+C,KAAMuD,EAAK,SAAUijF,GAClDx9E,EAAGw9E,GACHD,EAAOtlF,KAAK,a,cC9LhB,IAAIm7B,EAAqC,oBAAZ,QAA2BH,OAAOG,gBAAgB99B,KAAK29B,SACzC,oBAAd,UAA6BwqD,SAASrqD,gBAAgB99B,KAAKmoF,UACxF,GAAIrqD,EAAiB,CAEnB,IAAIsqD,EAAQ,IAAIhqE,WAAW,IAE3B7f,EAAOD,QAAU,WAEf,OADAw/B,EAAgBsqD,GACTA,OAEJ,CAKL,IAAIC,EAAO,IAAIlkF,MAAM,IAErB5F,EAAOD,QAAU,WACf,IAAK,IAAWgB,EAAPd,EAAI,EAAMA,EAAI,GAAIA,IACN,IAAV,EAAJA,KAAiBc,EAAoB,WAAhBqU,KAAKy6B,UAC/Bi6C,EAAK7pF,GAAKc,MAAY,EAAJd,IAAa,GAAK,IAGtC,OAAO6pF,K,cCxBX,IADA,IAAIC,EAAY,GACP9pF,EAAI,EAAGA,EAAI,MAAOA,EACzB8pF,EAAU9pF,IAAMA,EAAI,KAAO0O,SAAS,IAAIqU,OAAO,GAgBjDhjB,EAAOD,QAbP,SAAqBuiB,EAAKM,GACxB,IAAI3iB,EAAI2iB,GAAU,EACdonE,EAAMD,EACV,OAAOC,EAAI1nE,EAAIriB,MAAQ+pF,EAAI1nE,EAAIriB,MACvB+pF,EAAI1nE,EAAIriB,MAAQ+pF,EAAI1nE,EAAIriB,MAAQ,IAChC+pF,EAAI1nE,EAAIriB,MAAQ+pF,EAAI1nE,EAAIriB,MAAQ,IAChC+pF,EAAI1nE,EAAIriB,MAAQ+pF,EAAI1nE,EAAIriB,MAAQ,IAChC+pF,EAAI1nE,EAAIriB,MAAQ+pF,EAAI1nE,EAAIriB,MAAQ,IAChC+pF,EAAI1nE,EAAIriB,MAAQ+pF,EAAI1nE,EAAIriB,MACxB+pF,EAAI1nE,EAAIriB,MAAQ+pF,EAAI1nE,EAAIriB,MACxB+pF,EAAI1nE,EAAIriB,MAAQ+pF,EAAI1nE,EAAIriB,Q,8ECjBlC,cACA,QACA,QAmFA,SAASgqF,EAAUx7E,EAAY6rE,GAC7BpxE,SAASiK,eAAe1E,GAAImF,UAAUQ,IAAI,aACtClL,SAASiK,eAAe1E,GAAImF,UAAUE,SAAS,aACjDwmE,EAAc4P,aAAaz7E,GAQ/B,SAAS07E,EAAYvmF,GACJsF,SAASgL,iBAAiBtQ,GAClC6N,QAAQ2F,IACbA,EAAGxD,UAAUK,OAAO,eA1FxB,gCAAsCm2E,GACpClhF,SAASiK,eAAe,aAAaM,iBAAiB,QAAS,WAC7DvK,SAASiK,eAAe,mBAAmB4L,WAAaoN,EAASga,oBACjEj9B,SAASiK,eAAe,iBAAiB4L,WAAaoN,EAASia,kBAC/DgkD,EAASC,kBAOb,0BAAgC/P,GAC9B,MACMgQ,EADwB1kF,MAAMuR,KAAKjO,SAASwM,uBAAuB,cACrCnG,IAAKg7E,GAAiBA,EAAI97E,IAE9DvF,SAAS6K,KAAKN,iBAAiB,UAAYC,IACzC,GAAIA,EAAImW,KAAK3Y,MAAM,cAAgBwC,EAAIozB,SACrC,IACE,MAAMr/B,EAAQ1E,OAAO2Q,EAAImW,KAAKnW,EAAImW,KAAKtlB,OAAS,IAAM,EAEhDimF,EADgBthF,SAASwM,uBAAuB,YACjBjO,GACrC0iF,EAAW,aACX7P,EAAcmQ,iBACdR,EAASO,EAAe/7E,GAAI6rE,GAC5B,MAAO5vE,GACP5F,QAAQu/E,MAAM35E,MAKpB4/E,EAAO74E,QAAS84E,IACdrhF,SAASiK,eAAeo3E,GAAK92E,iBAAiB,QAAS,KACrD02E,EAAW,cACXF,EAASM,EAAKjQ,GACdpxE,SAASiK,eAAe,eAAe4L,UAAYoN,EAAS4Z,cAAcwkD,GA+DhF,SAAuBjQ,GACE10E,MAAMuR,KAAKjO,SAASwM,uBAAuB,aAChCnG,IAAI6H,GAAMA,EAAG3I,IACpCgD,QAAQ2F,IACjBlO,SAASiK,eAAeiE,GAAI3D,iBAAiB,QAAS,KACpD02E,EAAW,aACXF,EAAS7yE,EAAIkjE,OApEboQ,CAAapQ,GACb6P,EAAW,aAEXF,EADoB/gF,SAASwM,uBAAuB,YAAY,GAC3CjH,GAAI6rE,QAQ/B,oCACE,MAAMqQ,EAAezhF,SAASiK,eAAe,gBACvCy3E,EAAa1hF,SAASiK,eAAe,cACrC03E,EAAiB3hF,SAASiK,eAAe,kBACzC23E,EAAe5hF,SAASiK,eAAe,gBAC7Cw3E,EAAal3E,iBAAiB,QAAS,KACA,SAAjCo3E,EAAe71E,MAAMc,SACvB+0E,EAAe71E,MAAMc,QAAU,GAC/B60E,EAAa50E,aAAa,aAAc,sDAExC80E,EAAe71E,MAAMc,QAAU,OAC/B60E,EAAa50E,aAAa,aAAc,uDAI5C60E,EAAWn3E,iBAAiB,QAAS,KACA,SAA/Bq3E,EAAa91E,MAAMc,SACrBg1E,EAAa91E,MAAMc,QAAU,GAC7B80E,EAAW70E,aAAa,aAAc,sDAEtC+0E,EAAa91E,MAAMc,QAAU,OAC7B80E,EAAW70E,aAAa,aAAc,wDA4C5C,kCACE,MAAMg1E,EAAW7hF,SAASiK,eAAe,YACnC63E,EAAa9hF,SAASiK,eAAe,cACrC83E,EAAU/hF,SAASiK,eAAe,WAClC+3E,EAAahiF,SAASiK,eAAe,cA8B3C,SAASg4E,IACP,IAAKJ,EAASn3E,UAAUE,SAAS,aAAc,CAC7C,EAAAgD,WACA5N,SAASiK,eAAe,YAAY4L,UAAY,GAChDgsE,EAASn3E,UAAUQ,IAAI,aACvB42E,EAAWp3E,UAAUK,OAAO,aAC5Bg3E,EAAQr3E,UAAUK,OAAO,aACzBi3E,EAAWt3E,UAAUK,OAAO,aAC5B,IACE/K,SAASiK,eAAe,aAAaS,UAAUK,OAAO,aACtD,MAAOvJ,IACT,IAC2D,wBAArDxB,SAAS6L,cAAc,uBAAuBtG,IAChD,EAAA8F,qBAAqB,YAEvB,MAAO7J,MAIb,SAAS0gF,IACP,IAAKJ,EAAWp3E,UAAUE,SAAS,aAAc,CAC/C,EAAAgD,WACA5N,SAASiK,eAAe,YAAY4L,UAAY,GAChDisE,EAAWp3E,UAAUQ,IAAI,aACzB62E,EAAQr3E,UAAUK,OAAO,aACzB82E,EAASn3E,UAAUK,OAAO,aAC1Bi3E,EAAWt3E,UAAUK,OAAO,aAC5B,IACE/K,SAASiK,eAAe,aAAaS,UAAUK,OAAO,aACtD,MAAOvJ,IACT,IAC2D,wBAArDxB,SAAS6L,cAAc,uBAAuBtG,IAChD,EAAA8F,qBAAqB,SAEvB,MAAO7J,MAIb,SAAS2gF,IACP,IAAKJ,EAAQr3E,UAAUE,SAAS,aAAc,CAC5C,EAAAgD,WACA5N,SAASiK,eAAe,YAAY4L,UAAY,GAChDksE,EAAQr3E,UAAUQ,IAAI,aACtB42E,EAAWp3E,UAAUK,OAAO,aAC5B82E,EAASn3E,UAAUK,OAAO,aAC1Bi3E,EAAWt3E,UAAUK,OAAO,aAC5B,IACE/K,SAASiK,eAAe,aAAaS,UAAUK,OAAO,aACtD,MAAOvJ,IACT,IAC2D,wBAArDxB,SAAS6L,cAAc,uBAAuBtG,IAChD,EAAA8F,qBAAqB,SAEvB,MAAO7J,MAIb,SAAS4gF,IACP,IAAKJ,EAAWt3E,UAAUE,SAAS,aAAc,CAC/C,EAAAgD,WACA5N,SAASiK,eAAe,YAAY4L,UAAY,GAChDmsE,EAAWt3E,UAAUQ,IAAI,aACzB42E,EAAWp3E,UAAUK,OAAO,aAC5Bg3E,EAAQr3E,UAAUK,OAAO,aACzB82E,EAASn3E,UAAUK,OAAO,aAC1B,IACE/K,SAASiK,eAAe,aAAaS,UAAUK,OAAO,aACtD,MAAOvJ,IACT,IAC2D,wBAArDxB,SAAS6L,cAAc,uBAAuBtG,IAChD,EAAA8F,qBAAqB,SAEvB,MAAO7J,MApGbqgF,EAASt3E,iBAAiB,QAAS03E,GACnCjiF,SAAS6K,KAAKN,iBAAiB,UAAYC,IACzB,MAAZA,EAAIlS,KACN2pF,MAIJH,EAAWv3E,iBAAiB,QAAS23E,GACrCliF,SAAS6K,KAAKN,iBAAiB,UAAYC,IACzB,MAAZA,EAAIlS,KACN4pF,MAIJH,EAAQx3E,iBAAiB,QAAS43E,GAClCniF,SAAS6K,KAAKN,iBAAiB,UAAYC,IACzB,MAAZA,EAAIlS,KACN6pF,MAIJH,EAAWz3E,iBAAiB,QAAS63E,GACrCpiF,SAAS6K,KAAKN,iBAAiB,UAAYC,IACzB,MAAZA,EAAIlS,KACN8pF,Q,8ECxJN,cACA,SACA,QAGA,QAKA,IAAI9yE,EAwBJ,SAAgBX,IACd,MAAMiU,EAAW5iB,SAASiK,eAAe,YACzC2Y,EAAS/M,UAAY,GACrB+M,EAASlY,UAAUQ,IAAI,gBACvBlL,SAAS6K,KAAKU,oBAAoB,UAAW,EAAAsX,qBAM/C,SAAgBmB,IACd,MAAMR,EAAMxjB,SAASiK,eAAe,UACpCuZ,EAAIjY,oBAAoB,QAAS,EAAA6W,eACjCoB,EAAIjZ,iBAAiB,QAAS,EAAA6X,eAC9BpiB,SAAS6K,KAAKN,iBAAiB,UAAW,EAAAsY,qBAC1C,IACE7iB,SAASiK,eAAe,aAAaM,iBAAiB,QAAS,KAI7D83E,EAAe,QAAS,QAHLC,IAAiBlvE,OAAO5R,GACzCxB,SAASiK,eAAezI,GAAGkJ,UAAUE,SAAS,aAIlD,MAAOpJ,IAET,IACExB,SAASiK,eAAe,eAAeM,iBAAiB,QAAS,KAE/D83E,EAAe,QAAS,QADLE,OAGrB,MAAO/gF,IAET,IACExB,SAASiK,eAAe,YAAYM,iBAAiB,QAAS,KAE5D83E,EAAe,QAAS,KADLE,OAGrB,MAAO/gF,IAET,IACExB,SAASiK,eAAe,iBAAiBM,iBAAiB,QAAS,KAEjE83E,EAAe,UAAW,QADPC,OAGrB,MAAO9gF,IAET,IACExB,SAASiK,eAAe,cAAcM,iBAAiB,QAAS,KAE9D83E,EAAe,UAAW,KADPC,OAGrB,MAAO9gF,IAET,IACExB,SAASiK,eAAe,mBAAmBM,iBAAiB,QAAS4E,UACnE,MAAMqV,EAAa+9D,IACnB,IAAInzE,EAEJ,GADsB,YACHtH,KAAK9H,SAASiK,eAAeua,EAAW,IAAI3R,SAAS,GAAGtF,aAAa,eAEjF,CACL6B,GAAa,EACb,MAAMkT,EAA4B,CAAE,OAAU,QAC5C,MAAS,CACP,EAAAJ,sBAAsBsC,EAAW,IAAK,EAAArC,iBAAiBqC,EAAW,IAClE,EAAAtC,sBAAsBsC,EAAW,IAAK,EAAArC,iBAAiBqC,EAAW,YAEhElV,EAASiT,KAAKD,EAAahT,EAASE,KAAKC,0BAR/CL,GAAa,EAWf,MAAMqV,EAA6B,CACjC,OAAU,iBACV,MAAS,CACP,WAAcD,EACd,WAAcpV,EAAW3J,aAG7B6J,EAASiT,KAAKkC,EAAcnV,EAASE,KAAKC,qBAAqB+S,KAAMnb,IAC/DA,EACF6O,EAAamN,kBAAkB,oBAE/BnN,EAAamN,kBAAkB,0BAEjC1U,IACAW,EAASmT,2BAGb,MAAOjhB,IAET,IACExB,SAASiK,eAAe,eAAeM,iBAAiB,QAAS,KAC/D,MAAMia,EAAa+9D,IACbjgE,EAA4B,CAChC,OAAU,QACV,MAAS,IAEL+D,EAAQ,IAAI3pB,MAClB,GAAIsD,SAASiK,eAAeua,EAAW,IAAIjX,aAAa,gBACtD8Y,EAAMjrB,KAAK,CACT,OAAU,MACV,MAAS,CACP,UAAaopB,EAAW,GACxB,SAAY,WACZ,UAAa,MAGjB6B,EAAMjrB,KAAK,CACT,OAAU,MACV,MAAS,CACP,UAAaopB,EAAW,GACxB,SAAY,UACZ,UAAa,MAGjB6B,EAAMjrB,KAAK,CACT,OAAU,UACV,MAAS,CACP,UAAaopB,EAAW,GACxB,KAAQ,WAGP,GAAIxkB,SAASiK,eAAeua,EAAW,IAAIjX,aAAa,eAC7D8Y,EAAMjrB,KAAK,CACT,OAAU,MACV,MAAS,CACP,UAAaopB,EAAW,GACxB,SAAY,UACZ,UAAa,MAGjB6B,EAAMjrB,KAAK,CACT,OAAU,MACV,MAAS,CACP,UAAaopB,EAAW,GACxB,SAAY,WACZ,UAAa,MAGjB6B,EAAMjrB,KAAK,CACT,OAAU,UACV,MAAS,CACP,UAAaopB,EAAW,GACxB,KAAQ,UAGP,CAEL,MAAMg+D,EAAYxiF,SAASiK,eAAeua,EAAW,IAC/Ci+D,EAAYziF,SAASiK,eAAeua,EAAW,IAC/C9R,EAAS8vE,EAAUvzE,QAAQ,UAC3B0D,EAAS8vE,EAAUxzE,QAAQ,UAC3B2D,EAAgBlW,MAAMuR,KAAKyE,EAAO5C,cAAc+C,UAAUO,OAAQnI,GAAsBA,EAAKP,UAAUE,SAAS,UAEtH,IAAI2I,EAAemvE,EAEf9vE,EAAcpK,QAAQkK,GAAUE,EAAcpK,QAAQmK,IACxDY,EAAgBivE,EAChBE,EAAiBD,IAEjBlvE,EAAgBkvE,EAChBC,EAAiBF,GAGnBn8D,EAAMjrB,KAAK,CACT,OAAU,MACV,MAAS,CACP,UAAamY,EAAchO,GAC3B,SAAY,WACZ,UAAam9E,EAAen9E,MAGhC8gB,EAAMjrB,KAAK,CACT,OAAU,MACV,MAAS,CACP,UAAasnF,EAAen9E,GAC5B,SAAY,UACZ,UAAagO,EAAchO,MAI/B,MAAM0K,EAAMyyE,EAAe72E,cAAc,QAC7B,OAARoE,GACFoW,EAAMjrB,KAAK,CACT,OAAU,SACV,MAAS,CACP,UAAa6U,EAAI1K,MAKzB+c,EAAY+D,MAAQA,EACpB/W,EAASiT,KAAKD,EAAahT,EAASE,KAAKC,qBAAqB+S,KAAMnb,IAC9DA,EACF6O,EAAamN,kBAAkB,yBAE/BnN,EAAamN,kBAAkB,kCAEjC1U,IACAW,EAASmT,2BAGb,MAAOjhB,KASX,SAAS6gF,EAAgBj8D,EAAgBu8D,EAAmBn+D,GAC1D,MAAMC,EAA6B,CACjC,OAAU2B,EACV,MAAS,CACP,UAAau8D,EACb,WAAcn+D,IAGlBlV,EAASiT,KAAKkC,EAAcnV,EAASE,KAAKC,qBAAqB+S,KAAMnb,IAiBnE,GAhBIA,EACa,UAAX+e,EACFlQ,EAAamN,kBAAkB,oBAE/BnN,EAAamN,kBAAkB,sBAGlB,UAAX+C,EACFlQ,EAAamN,kBAAkB,mBAE/BnN,EAAamN,kBAAkB,qBAGnC/T,EAASmT,uBAGS,OAAdkgE,EAAoB,CACtB,MAAMC,EAAc5iF,SAASiK,eAAeua,EAAW,IAAI1U,cACrD+iE,EAAMn2E,MAAMuR,KAAK20E,EAAY/vE,eAEnB1Y,IADAmV,EAASwU,KAAKgvD,WAAWD,IAEvCgQ,EAASC,wBAGbn0E,MAOJ,SAAS4zE,IACP,MAAMrzC,EAAM,GAKZ,OAJiBxyC,MAAMuR,KAAKjO,SAASwM,uBAAuB,aACnDjE,QAAQ2F,IACfghC,EAAI9zC,KAAK8S,EAAG3I,MAEP2pC,EAMT,SAASozC,IACP,MAAMS,EAAc,GAQpB,OAPiBrmF,MAAMuR,KAAKjO,SAASwM,uBAAuB,aACnDjE,QAAQ2F,IACExR,MAAMuR,KAAKC,EAAG2E,UACtBtK,QAAQ40C,IACf4lC,EAAY3nF,KAAK+hD,EAAG53C,QAGjBw9E,EAhST,wBAA8BvzE,GAC5BF,EAAWE,GAOb,2BAAiC9U,GAC/B,MAAMkoB,EAAW5iB,SAASiK,eAAe,YACzC2Y,EAASlY,UAAUK,OAAO,gBAC1B6X,EAAS/M,WAAaoN,EAASka,aAAaziC,GAC5CspB,KAMF,yBAUA,2B,8EC5CA,cAIA,OAWMg/D,EAAa,CACjBC,QAAS,EACTC,IAAK,EACLC,SAAU,EACVC,MAAO,EACPC,YAAa,EACbC,OAAQ,EACRC,WAAY,EACZC,KAAM,GAGR,kBAAwBzjF,EAA6BuP,EAAoBR,GAIvE,IAAI+B,EAIAC,EAIAC,EAIAC,EAKAC,EAEAwyE,EAAwBC,EAAoBC,EAAoBC,EAClE/jD,EAAkBgkD,EAAsBC,EAAiBh/D,EAAYi/D,EAyRvE,SAASC,IACP,MAAMC,EAAkB,CACtB,CAAEtwE,EAAG9C,EAAKgD,EAAG/C,EAAKxZ,KAAM0rF,EAAWC,SACnC,CAAEtvE,GAAI9C,EAAME,GAAO,EAAG8C,EAAG/C,GAAOC,EAAMF,GAAO,EAAI3E,KAAKg4E,IAAIjzE,GAAO3Z,KAAM0rF,EAAWE,KAClF,CAAEvvE,EAAG5C,EAAK8C,EAAG/C,GAAOC,EAAMF,GAAO3E,KAAKg4E,IAAIjzE,GAAO3Z,KAAM0rF,EAAWG,UAClE,CAAExvE,EAAG5C,EAAK8C,GAAI/C,EAAME,GAAOD,EAAMF,GAAO3E,KAAKg4E,IAAIjzE,IAAS,EAAG3Z,KAAM0rF,EAAWI,OAC9E,CAAEzvE,EAAG5C,EAAK8C,EAAG7C,EAAK1Z,KAAM0rF,EAAWK,aACnC,CAAE1vE,GAAI9C,EAAME,GAAO,EAAG8C,EAAG7C,GAAOD,EAAMF,GAAO,EAAI3E,KAAKg4E,IAAIjzE,GAAO3Z,KAAM0rF,EAAWM,QAClF,CAAE3vE,EAAG9C,EAAKgD,EAAG7C,GAAOD,EAAMF,GAAO3E,KAAKg4E,IAAIjzE,GAAO3Z,KAAM0rF,EAAWO,YAClE,CAAE5vE,EAAG9C,EAAKgD,GAAI/C,EAAME,GAAOD,EAAMF,GAAO3E,KAAKg4E,IAAIjzE,IAAS,EAAG3Z,KAAM0rF,EAAWQ,OAG1EW,EAAsBF,EAAO7wE,OAAO,CAACsnE,EAAOn8E,IAAmBA,EAAQ,GAAM,GAChF8H,IAAI4E,GAAQA,EAAK0I,EAAI,IAAM1I,EAAK4I,GAChCvN,KAAK,KAERpD,EAAG2L,OAAO,eAAeoX,KAAK,SAAUk+D,GAExC,IAAK,MAAMC,KAAapB,EAAY,CAClC,MAAMqB,EAAeJ,EAAOjB,EAAWoB,IACvClhF,EAAG2L,OAAO,MAAQu1E,GAAWhxE,OAAO,gBACjC6S,KAAK,KAAMo+D,EAAM1wE,GACjBsS,KAAK,KAAMo+D,EAAMxwE,GAGtB,IAAIF,EAAIswE,EAAO,GAAGtwE,EACdE,EAAIowE,EAAO,GAAGpwE,EAClB,MAAMywE,EAAoB3wE,EAAI,IAAO,KAAOE,EAAI,IAAM,KACnDF,EAAI,IAAM,KAAOE,EAAI,IAAM,KAAOF,EAAI,KAAO,KAAOE,EAAI,IAAM,KAAOF,EAAI,KAAO,KAAOE,EAAI,IAGxF0wE,GAFN5wE,EAAIswE,EAAO,GAAGtwE,GAEe,IAAO,MADpCE,EAAIowE,EAAO,GAAGpwE,GACiC,IAAM,KAClDF,EAAI,KAAO,KAAOE,EAAI,IAAM,KAAOF,EAAI,KAAO,KAAOE,EAAI,IAAM,KAAOF,EAAI,IAAM,KAAOE,EAAI,IAE9F3Q,EAAG2L,OAAO,aAAaoX,KAAK,SAAUs+D,GACtCrhF,EAAG2L,OAAO,cAAcoX,KAAK,SAAUq+D,IArTzC,SAASE,IACP,GAAgB,OAAZzkF,EAAkB,OAGtB,GAAIA,EAAQ2K,UAAUE,SAAS,OAAQ,CACrC,MAAM8W,EAAO3hB,EAAQ8L,cAAc,wBACnC,GAAa,OAAT6V,EAEF,YADA9lB,QAAQC,KAAK,wFAGfgV,EAAMhX,OAAO6nB,EAAKnU,aAAa,MAC/BuD,EAAMjX,OAAO6nB,EAAKnU,aAAa,MAC/BwD,GAAOF,IAAO6Q,EAAKnU,aAAa,SAChCyD,GAAOF,IAAO4Q,EAAKnU,aAAa,UAEhC0D,EAAO,EAIT,GAAIlR,EAAQ2K,UAAUE,SAAS,SAAU,CACvC,MAAMoF,EAAO,EAAAivB,aAAal/B,GAC1B8Q,EAAMb,EAAKa,IACXC,EAAMd,EAAKc,IACXC,EAAMf,EAAKe,IACXC,EAAMhB,EAAKgB,IAEX,MAAMG,EAAwBpR,EAAQ8L,cAAc,QACjD0B,aAAa,KACbvF,MAAM,QACN3B,IAAItG,GAAWlG,OAAOkG,IACzBkR,EAAO/E,KAAKkF,MAAMD,EAAY,GAAKA,EAAY,KAC5CA,EAAY,GAAKA,EAAY,KAGlC,IAAIszE,EAEJ,MAAMR,EAAuB,CAC3B,CAAEtwE,EAAG9C,EAAKgD,EAAG/C,EAAKxZ,KAAM0rF,EAAWC,SACnC,CAAEtvE,GAAI9C,EAAME,GAAO,EAAG8C,EAAG/C,GAAOC,EAAMF,GAAO,EAAI3E,KAAKg4E,IAAIjzE,GAAO3Z,KAAM0rF,EAAWE,KAClF,CAAEvvE,EAAG5C,EAAK8C,EAAG/C,GAAOC,EAAMF,GAAO3E,KAAKg4E,IAAIjzE,GAAO3Z,KAAM0rF,EAAWG,UAClE,CAAExvE,EAAG5C,EAAK8C,GAAI/C,EAAME,GAAOD,EAAMF,GAAO3E,KAAKg4E,IAAIjzE,IAAS,EAAG3Z,KAAM0rF,EAAWI,OAC9E,CAAEzvE,EAAG5C,EAAK8C,EAAG7C,EAAK1Z,KAAM0rF,EAAWK,aACnC,CAAE1vE,GAAI9C,EAAME,GAAO,EAAG8C,EAAG7C,GAAOD,EAAMF,GAAO,EAAI3E,KAAKg4E,IAAIjzE,GAAO3Z,KAAM0rF,EAAWM,QAClF,CAAE3vE,EAAG9C,EAAKgD,EAAG7C,GAAOD,EAAMF,GAAO3E,KAAKg4E,IAAIjzE,GAAO3Z,KAAM0rF,EAAWO,YAClE,CAAE5vE,EAAG9C,EAAKgD,GAAI/C,EAAME,GAAOD,EAAMF,GAAO3E,KAAKg4E,IAAIjzE,IAAS,EAAG3Z,KAAM0rF,EAAWQ,OAGhFM,EAAUG,EAAO,GAAGtwE,EAAIswE,EAAO,GAAGtwE,EAElC,MAAMwwE,EAAcF,EAAO7wE,OAAO,CAACsnE,EAAOn8E,IAAmBA,EAAQ,GAAM,GACxE8H,IAAI4E,GAAQA,EAAK0I,EAAI,IAAM1I,EAAK4I,GAChCvN,KAAK,KAERpD,EAAG2L,OAAO,IAAM9O,EAAQwF,IAAIyiB,OAAO,WAChC/B,KAAK,SAAUk+D,GACfl+D,KAAK,KAAM,cACXA,KAAK,SAAU,SACfA,KAAK,eAAgB,IACrBA,KAAK,OAAQ,QACbna,MAAM,SAAU,QAChBA,MAAM,mBAAoB,SAE7B,IAAK,MAAMs4E,KAAapB,EAAY,CAClC,MAAMqB,EAAeJ,EAAOjB,EAAWoB,IACvClhF,EAAG2L,OAAO9O,EAAQ2kF,iBAAiB18D,OAAO,UACvC/B,KAAK,KAAMo+D,EAAM1wE,GACjBsS,KAAK,KAAMo+D,EAAMxwE,GACjBoS,KAAK,IAAK,IACVA,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,OAAQ,WACbA,KAAK,QAAS,eACdA,KAAK,KAAM,KAAOm+D,GAIvB,IAAK,MAAM9sF,KAAQ0rF,EACjB9/E,EAAG2L,OAAO,MAAQvX,GAAM8b,OAAO,gBAAgBlc,KAC7CgM,EAAGoiB,OACAvnB,GAAG,QAAS,KAAQ4mF,EAAYrtF,KAChCyG,GAAG,OAAQ6mF,GACX7mF,GAAG,MAAO8mF,EAAUtsF,KAAK0B,QAGhC,GAAI8F,EAAQ2K,UAAUE,SAAS,SAAU,CACvC,IAAI+I,EAAIswE,EAAO,GAAGtwE,EACdE,EAAIowE,EAAO,GAAGpwE,EAClB,MAAMywE,EAAoB3wE,EAAI,IAAO,KAAOE,EAAI,IAAM,KACnDF,EAAI,IAAM,KAAOE,EAAI,IAAM,KAAOF,EAAI,KAAO,KAAOE,EAAI,IAAM,KAAOF,EAAI,KAAO,KAAOE,EAAI,IAC9FF,EAAIswE,EAAO,GAAGtwE,EACdE,EAAIowE,EAAO,GAAGpwE,EACd,MAAM0wE,EAAmB5wE,EAAI,IAAO,KAAOE,EAAI,IAAM,KAClDF,EAAI,KAAO,KAAOE,EAAI,IAAM,KAAOF,EAAI,KAAO,KAAOE,EAAI,IAAM,KAAOF,EAAI,IAAM,KAAOE,EAAI,IAE9F3Q,EAAG2L,OAAO,IAAM9O,EAAQwF,IAAIyiB,OAAO,WAChC/B,KAAK,SAAUq+D,GACfr+D,KAAK,KAAM,aACXA,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,OAAQ,WACbA,KAAK,QAAS,aAEjB/iB,EAAG2L,OAAO,IAAM9O,EAAQwF,IAAIyiB,OAAO,WAChC/B,KAAK,SAAUs+D,GACft+D,KAAK,KAAM,YACXA,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,OAAQ,WACbA,KAAK,QAAS,aAEjB/iB,EAAG2L,OAAO,aAAa3X,KACrBgM,EAAGoiB,OACAvnB,GAAG,QAAS+mF,GACZ/mF,GAAG,OAoBV,WACE,MACMgnF,EADW7hF,EAAGm9B,MAAMpmC,MAAM,GACR4lC,EAClBmlD,EAAWjB,EAAc73E,KAAKkF,KAAK2zE,EAAOjB,GAC5CkB,GAAY,IAAOA,EAAW,KAEhCl0E,EAAM+yE,GADN/+D,EAAKigE,GAEL9zE,EAAO+zE,GAEThB,MA5BKjmF,GAAG,MAAOknF,IAEf/hF,EAAG2L,OAAO,cAAc3X,KACtBgM,EAAGoiB,OACAvnB,GAAG,QAAS+mF,GACZ/mF,GAAG,OA0BV,WACE,MACMgnF,EADW7hF,EAAGm9B,MAAMpmC,MAAM,GACR4lC,EAClBmlD,EAAWjB,EAAc73E,KAAKkF,KAAK2zE,EAAOjB,GAC5CkB,GAAY,IAAOA,EAAW,KAEhC/zE,EAAO+zE,EACPh0E,EAAM6yE,GAFN/+D,EAAKigE,IAIPf,MAlCKjmF,GAAG,MAAOknF,IAGjB,SAASH,IACP,IAAII,EAAQhiF,EAAGsiB,MAAME,YAAYtsB,OAAOmM,GACxC,MAAM4/E,EAAUjiF,EAAG2L,OAAO,IAAMq2E,GACjBC,EAAQl/D,KAAK,UAC5B29D,EAAiBsB,EACjBrlD,EAAW38B,EAAGm9B,MAAMpmC,MAAM,GAC1B4pF,EAA0B,cAAVqB,EAAwBl0E,EAAMF,EAC9CizE,EAAc9yE,EA2BhB,SAASg0E,SACI9qF,IAAP2qB,IACFA,EAAK,GAEP,MAAML,EAAe,CACnB,OAAU,aACV,MAAS,CACP,UAAa1kB,EAAQwF,GACrB,GAAMuf,EACN,UAAiC,cAAnB8+D,IAGlBt0E,EAASiT,KAAKkC,EAAcnV,EAASE,KAAKC,qBAAqB+S,KAAKrT,MAAO9H,IACrEA,SACIiI,EAASyV,8BAEjBhlB,EAAUC,SAASiK,eAAelK,EAAQwF,IAC1CsL,OAAM1W,EACN2W,OAAM3W,EACN4W,OAAM5W,EACN6W,OAAM7W,EACN2qB,OAAK3qB,EACLqqF,IACIzkF,EAAQ2K,UAAUE,SAAS,OAC7B,EAAAmF,WAAWhQ,EAAQ8L,cAAc,wBAAyBiD,EAAa7U,MAEvE,EAAA8U,YAAYhP,EAAS+O,KAK3B,SAAS61E,EAAartF,GACpBmtF,EAAantF,EACb,MAAM+sF,EAAQJ,EAAO/hC,KAAKmiC,GAAkBA,EAAM/sF,OAAS0rF,EAAW1rF,IACtEmsF,EAAe,CAACY,EAAM1wE,EAAG0wE,EAAMxwE,GAC/B6vE,EAAa5yE,EACb6yE,EAAa3yE,EAGf,SAAS4zE,IACP,MAAMQ,EAAeliF,EAAGm9B,MAAMpmC,MAC9B,OAAQ+oF,EAAWyB,IACjB,KAAKzB,EAAWC,QACdpyE,EAAMu0E,EAAa,GACnBt0E,EAAMs0E,EAAa,GACnB,MACF,KAAKpC,EAAWE,IACdpyE,EAAMs0E,EAAa,IAAMr0E,EAAMF,GAAO3E,KAAKgzB,IAAIjuB,GAAQ,EACvD,MACF,KAAK+xE,EAAWG,SACdpyE,EAAMq0E,EAAa,GACnBt0E,EAAMs0E,EAAa,IAAMr0E,EAAMF,GAAO3E,KAAKgzB,IAAIjuB,GAC/C,MACF,KAAK+xE,EAAWI,MACdryE,EAAMq0E,EAAa,GACnBp0E,EAAM2yE,GAAcyB,EAAa,GAAK3B,EAAa,IAAMv3E,KAAKgzB,IAAIjuB,GAClE,MACF,KAAK+xE,EAAWK,YACdtyE,EAAMq0E,EAAa,GACnBp0E,EAAMo0E,EAAa,GACnB,MACF,KAAKpC,EAAWM,OACdtyE,EAAMo0E,EAAa,IAAMr0E,EAAMF,GAAO3E,KAAKgzB,IAAIjuB,GAAQ,EACvD,MACF,KAAK+xE,EAAWO,WACd1yE,EAAMu0E,EAAa,GACnBp0E,EAAMo0E,EAAa,IAAMr0E,EAAMF,GAAO3E,KAAKgzB,IAAIjuB,GAC/C,MACF,KAAK+xE,EAAWQ,KACd3yE,EAAMu0E,EAAa,GACnBt0E,EAAM4yE,GAAc0B,EAAa,GAAK3B,EAAa,IAAMv3E,KAAKgzB,IAAIjuB,GAClE,MACF,QACErV,QAAQ0B,MAAM,qFAElB0mF,IAGF,SAASa,IACP,MAAMpgE,EAAe,CACnB,OAAU,SACV,MAAS,CACP,UAAa1kB,EAAQwF,GACrB,IAAOsL,EACP,IAAOC,EACP,IAAOC,EACP,IAAOC,IAGX1B,EAASiT,KAAKkC,EAAcnV,EAASE,KAAKC,qBAAqB+S,KAAKrT,MAAO9H,IAazE,GAZIA,SACIiI,EAASyV,8BAEjBhlB,EAAUC,SAASiK,eAAelK,EAAQwF,IAC1CsL,OAAM1W,EACN2W,OAAM3W,EACN4W,OAAM5W,EACN6W,OAAM7W,EACN+I,EAAGqL,UAAU,gBAAgBxD,SAC7B7H,EAAGqL,UAAU,eAAexD,SAC5B7H,EAAGqL,UAAU,cAAcxD,SAC3By5E,IACIzkF,EAAQ2K,UAAUE,SAAS,OAC7B,EAAAmF,WAAWhQ,EAAQ8L,cAAc,wBAAyBiD,EAAa7U,WAEvE,IACE+F,SAASiK,eAAe,YAAY4L,UAAY,GAChD7V,SAASiK,eAAe,YAAYS,UAAUQ,IAAI,gBAClD,MAAO1J,QA9QjBgjF,K,8EClDF,aAyQ0B,EAAAr/D,QApQ1B,MAQE,YAAa7V,EAAoBqwB,GANjC,KAAA0lD,YAAa,EAkGb,KAAA9D,eAAiB,WACftnF,KAAKS,KAAO,GACZT,KAAKqrF,4BACLtlF,SAAS6K,KAAKU,oBAAoB,UAAWtR,KAAKsrF,iBAClDvlF,SAAS6K,KAAKU,oBAAoB,QAAStR,KAAKurF,oBAChDxlF,SAAS6K,KAAKU,oBAAoB,QAAStR,KAAKwrF,kBAChDzlF,SAAS6L,cAAc,uBAAuBnB,UAAUK,OAAO,aAC/D9Q,KAAKorF,YAAa,EAClB,IACErlF,SAASiK,eAAe,oBAAoBc,SAC5C,MAAOvJ,IAGT,MAAMkwE,EAAW1xE,SAASiK,eAAe,YACnCy7E,EAAa1lF,SAASiK,eAAe,cAC3CynE,EAAS5lE,MAAM6lE,gBAAkB,UACjCD,EAAS5lE,MAAMsC,WAAa,OAC5Bs3E,EAAW55E,MAAM6lE,gBAAkB,aACnC+T,EAAW55E,MAAMsC,WAAa,IAC7B7V,KAAK0B,MAMR,KAAAwrF,iBAAmB,SAA4Bj7E,GAC7C,MAAMpR,EAASoR,EAAIpR,OACoB,OAAnCA,EAAO6V,QAAQ,iBACsB,OAAvC7V,EAAO6V,QAAQ,qBACkB,OAAjC7V,EAAO6V,QAAQ,gBACfhV,KAAKsnF,iBACLvhF,SAAS6K,KAAKU,oBAAoB,UAChCtR,KAAK0rF,cACP3lF,SAAS6K,KAAKU,oBAAoB,UAChCtR,KAAK0D,WAERpF,KAAK0B,MAKR,KAAAurF,mBAAqB,SAA8Bh7E,GACjC,UAAZA,EAAIlS,KACN0H,SAAS6L,cAAc5R,KAAKmrB,UACzB7a,iBAAiB,QAAuB,UAAdtQ,KAAKS,KAC9BT,KAAK0rF,aAAe1rF,KAAK0D,UAE9BpF,KAAK0B,MAMR,KAAAsrF,gBAAkB,SAA2B/6E,GAC3B,WAAZA,EAAIlS,KACN2B,KAAKsnF,iBACLvhF,SAAS6K,KAAKU,oBAAoB,UAAWtR,KAAK0rF,cAClD3lF,SAAS6K,KAAKU,oBAAoB,UAAWtR,KAAK0D,UAC7B,UAAZ6M,EAAIlS,KACb2B,KAAKqrF,6BAEN/sF,KAAK0B,MAKR,KAAA0D,QAAU,SAAmB6M,GAC3BA,EAAIC,kBACJ,MAAM8zB,EAAYv+B,SAASwM,uBAAuB,eAAe,GAAGA,uBAAuB,oBAAoB,GACzGgyB,EAAKD,EAAUE,iBACrBD,EAAG7qB,EAAInJ,EAAIk0B,QACXF,EAAG3qB,EAAIrJ,EAAIm0B,QAEX,MAAMC,EAAmBL,EAAU/xB,uBAAuB,UAAU,GAA0BqyB,eACxF+mD,EAAWpnD,EAAGM,gBAAgBF,EAAgBG,WAE9Cta,EAA6B,CACjC,OAAU,SACV,MAAS,CACP,YAAexqB,KAAKS,KACpB,QAAW,OACX,IAAOkrF,EAASjyE,EAChB,IAAOiyE,EAAS/xE,IAII,OAApB5Z,KAAK24E,aACPnuD,EAAoB,MAAc,WAAIxqB,KAAK24E,WACV,MAA7B34E,KAAK24E,WAAkB,QACzBnuD,EAAoB,MAAO,KAAK,KAIpCxqB,KAAKqV,SAASiT,KAAKkC,EAAcxqB,KAAKqV,SAASE,KAAKC,qBAAqB+S,KAAK,IACrEvoB,KAAKqV,SAASyV,+BACpBvC,KAAK,KACNxiB,SAAS6L,cAAc5R,KAAKmrB,UAAU7a,iBAAiB,QAAStQ,KAAK0D,YAEtEpF,KAAK0B,MAKR,KAAA0rF,aAAe,SAAwBn7E,GACrC,MAAM+zB,EAAYv+B,SAASwM,uBAAuB,eAAe,GAAGA,uBAAuB,oBAAoB,GACzGgyB,EAAKD,EAAUE,iBACrBD,EAAG7qB,EAAInJ,EAAIk0B,QACXF,EAAG3qB,EAAIrJ,EAAIm0B,QACX,MAAMC,EAAmBL,EAAU/xB,uBAAuB,UAAU,GAA0BqyB,eACxF+mD,EAAWpnD,EAAGM,gBAAgBF,EAAgBG,WAEpD,GAAI9kC,KAAKorF,WACPprF,KAAK4rF,MAAQD,EACb1iF,EAAG2L,OAAO0vB,GAAWvW,OAAO,UAAU/B,KAAK,KAAM2/D,EAASjyE,GACvDsS,KAAK,KAAM2/D,EAAS/xE,GACpBoS,KAAK,IAAK,IACVA,KAAK,KAAM,gBACXA,KAAK,OAAQ,SAChBhsB,KAAKorF,YAAa,MACb,CACL,IAAIjkD,EAAIC,EACJukD,EAASjyE,EAAI1Z,KAAK4rF,MAAMlyE,GAAKiyE,EAAS/xE,EAAI5Z,KAAK4rF,MAAMhyE,GACvDutB,EAAKwkD,EACLvkD,EAAKpnC,KAAK4rF,QAEVzkD,EAAKnnC,KAAK4rF,MACVxkD,EAAKukD,GAEP5lF,SAASiK,eAAe,gBAAgBc,SACxC,MAAMqb,EAAuB,CAC3B,OAAU,SACV,MAAS,CACP,YAAe,QACf,QAAW,OACX,IAAOgb,EAAGztB,EACV,IAAOytB,EAAGvtB,EACV,IAAOwtB,EAAG1tB,EACV,IAAO0tB,EAAGxtB,IAId5Z,KAAKqV,SAASiT,KAAK6D,EAAQnsB,KAAKqV,SAASE,KAAKC,qBAAqB+S,KAAK,KACtEvoB,KAAKqV,SAASmT,uBACdxoB,KAAKorF,YAAa,MAGrB9sF,KAAK0B,MAKR,KAAAqrF,0BAA4B,WAC1BtlF,SAAS6L,cAAc5R,KAAKmrB,UAAU7Z,oBAAoB,QAAStR,KAAK0rF,cACxE3lF,SAAS6L,cAAc5R,KAAKmrB,UAAU7Z,oBAAoB,QAAStR,KAAK0D,UACvEpF,KAAK0B,MArPNA,KAAKqV,SAAWA,EAChBrV,KAAKmrB,SAAWua,EAQlB,aAAcmmD,GACZ,MAAMC,EAAsB9rF,KAAK83E,eACjC,OAAQ+T,GACN,IAAK,UACH7rF,KAAKS,KAAO,KACZT,KAAK24E,WAAa,KAClB,MACF,IAAK,UACH34E,KAAKS,KAAO,KACZT,KAAK24E,WAAa,CAAE,KAAQ,MAC5B,MACF,IAAK,QACH34E,KAAKS,KAAO,KACZT,KAAK24E,WAAa,CAAE,KAAQ,KAC5B,MACF,IAAK,MACL,IAAK,SACL,IAAK,YACL,IAAK,WACL,IAAK,WACL,IAAK,YACL,IAAK,UACH,MAAMjvD,EAAU1pB,KAAKqV,SAASwU,KAAKC,kBACjC+hE,EAAS9rD,OAAO,GAAG/M,cAAgB64D,EAASx8E,MAAM,IAEpDrP,KAAKS,KAAO,WACZT,KAAK24E,WAAa,CAAE,QAAWjvD,GAC/B,MACF,IAAK,QACL,IAAK,QACH1pB,KAAKS,KAAO,OACZT,KAAK24E,WAAa,CAAE,MAASkT,EAAS9rD,OAAO,GAAG/M,eAChD,MACF,IAAK,SACHhzB,KAAKS,KAAO,SACZT,KAAK24E,WAAa,KAClB,MACF,IAAK,QACH34E,KAAKS,KAAO,QACZT,KAAK24E,WAAa,KAClB,MACF,QAIE,OAHA34E,KAAKS,KAAO,GACZT,KAAK24E,WAAa,UAClBh3E,QAAQ0B,MAAM,iCAAmCwoF,EAAW,KAmBhE,GAfA7rF,KAAKqrF,4BACa,UAAdrrF,KAAKS,KACPsF,SAAS6L,cAAc5R,KAAKmrB,UACzB7a,iBAAiB,QAAStQ,KAAK0rF,cAElC3lF,SAAS6L,cAAc5R,KAAKmrB,UACzB7a,iBAAiB,QAAStQ,KAAK0D,SAIpCqC,SAAS6K,KAAKN,iBAAiB,UAAWtQ,KAAKsrF,iBAC/CvlF,SAAS6K,KAAKN,iBAAiB,QAAStQ,KAAKurF,oBAC7CxlF,SAAS6K,KAAKN,iBAAiB,QAAStQ,KAAKwrF,mBAGxCM,EAAqB,CACxB,MAAMC,EAAiBhmF,SAASO,cAAc,UAC9CylF,EAAezgF,GAAK,mBACpBygF,EAAet7E,UAAUQ,IAAI,UAC7B86E,EAAenwE,UAAY,sBAC3B7V,SAASiK,eAAe,QAAQvJ,WAAWG,YAAYmlF,GACvDA,EAAez7E,iBAAiB,QAAStQ,KAAKsnF,gBAEhD,MAAM7P,EAAW1xE,SAASiK,eAAe,YACzCynE,EAAS5lE,MAAM6lE,gBAAkB,aACjCD,EAAS5lE,MAAMsC,WAAa,GAC5B,MAAMs3E,EAAa1lF,SAASiK,eAAe,cAC3Cy7E,EAAW55E,MAAM6lE,gBAAkB,UACnC+T,EAAW55E,MAAMsC,WAAa,OAkKhC,eACE,MAAsB,KAAdnU,KAAKS,Q,6BCxQjB,4KAYA,IAAIpD,EAAO2uF,EAAY,YACnBC,EAAmB,aAAe5uF,EAAO,UACzC6uF,EAAUF,EAAY,WAE1B,GAAI3uF,EACFmK,OAAOu6C,MAAMkqC,GAAkB1jE,KAAK8zC,IAClC,GAAIA,EAAS5xB,GACX,OAAO4xB,EAASxhC,OAEhB,MAAM,IAAIt5B,MAAM86D,EAAS8vB,cAE1B5jE,KAAKrT,UACN,IAAIk7D,EACJ,IACEA,EAAWpiE,KAAKgvB,MAAMnC,GACtB,MAAOtzB,GAGP,OAFA5F,QAAQ0B,MAAMkE,QACd5F,QAAQu/E,MAAMrmD,GAGhB,IAAIqgC,EAAS,CACXkV,SAAUA,EACVO,QAAS,IACTG,KAAM,IACNP,SAAU,IACVD,SAAU,YAGU,IAAIh8C,QAAQ,CAAC1nB,EAAS2nB,KAC1C/sB,OAAOu6C,MAAMquB,EAASQ,OAAOroD,KAAK8zC,IAChCzvD,EAAQyvD,EAASd,QAAQ59D,IAAI,mBAC5B+gD,MAAMn7C,IACPgxB,EAAOhxB,QAGGwK,MAAM,aAClBmtD,EAAOwV,KAAO,IACdxV,EAAOmV,UAAY,MAEnBnV,EAAOwV,KAAO,IACdxV,EAAOmV,UAAY,KAGV,IAAI,IAASnV,GACnB98C,cAEF,CACI,IAAI,UAAQ,qBAClB0hC,cAAcosC,EAAS,YAAY3jE,KAAKkqB,GAClC,IAAIjrC,OAAO4kF,SAAS35C,GAAMib,QAChCnlC,KAAKrT,UACNvT,QAAQgyB,IAAIy8C,GACZ,IAAIlV,EAAS,CACXkV,SAAUA,EACVO,QAAS,IACTG,KAAM,IACNP,SAAU,IACVD,SAAU,YAGU,IAAIh8C,QAAQ,CAAC1nB,EAAS2nB,KAC1C/sB,OAAOu6C,MAAMquB,EAASQ,OAAOroD,KAAK8zC,IAChCzvD,EAAQyvD,EAASd,QAAQ59D,IAAI,mBAC5B+gD,MAAMn7C,IACPgxB,EAAOhxB,QAGGwK,MAAM,aAClBmtD,EAAOwV,KAAO,IACdxV,EAAOmV,UAAY,MAEnBnV,EAAOwV,KAAO,IACdxV,EAAOmV,UAAY,KAGV,IAAI,IAASnV,GACnB98C,UAIT,SAAS4tE,EAAa9pB,GACpB,IAAI90D,EAAS,KAET6f,EAAM,GAUV,OATAzlB,OAAO6kF,SAASjwE,OACbyD,OAAO,GACPzQ,MAAM,KACNd,QAASioC,KACRtpB,EAAMspB,EAAKnnC,MAAM,MACT,KAAO8yD,IACb90D,EAASkC,mBAAmB2d,EAAI,OAG/B7f,I,8ECzGT,cACA,QACA,QAEA,QAEA,QA2gBqB,EAAA8d,QA/frB,MAkBE,iBAAqC,OAAOlrB,KAAKssF,YAKjD,YAAalc,GACXpwE,KAAKusF,eAAiB,IAAI,UAC1BC,EAAWzsF,OAMXC,KAAKysF,WAAa,IAAIjkD,IAMtBxoC,KAAK0sF,WAAa,IAAIlkD,IAEtBxoC,KAAK2sF,UAAY,IAAInkD,IAErBxoC,KAAKuwC,OAAS,IAAIq8C,UAElB5sF,KAAK2qC,GAAK,IAAI,UAAQ,QAEtB3qC,KAAK6sF,WAAa,GAGlB7sF,KAAKowE,SAAWA,EAChBpwE,KAAKssF,YAAclc,EAAS0c,gBAC5B9sF,KAAK+sF,eAAiB,GASxB,aAActwC,GAAQ,GA2EpB,aAvEuB,IAAInoB,QAAY,CAAC1nB,EAAS2nB,KAC/Cv0B,KAAK2qC,GAAGhtC,IAAIqC,KAAKowE,SAAS,QAAQ1xB,MAAMn7C,IACtC,GAAiB,cAAbA,EAAIlG,KAAsB,CAE5B,MAAMgyC,EAAM,CACVgC,IAAKrxC,KAAKowE,SAAS,OACnBj9C,UAAWnzB,KAAKowE,SAASj9C,UACzBy9C,MAAO5wE,KAAKowE,SAASQ,MACrBvmE,MAAOrK,KAAKowE,SAAS/lE,MACrBiiF,YAAa,IAKf,OAHAtsF,KAAKssF,YAAYh+E,QAAQ0+E,IACvB39C,EAAIi9C,YAAYnrF,KAAK6rF,EAAW1hF,MAE3B+jC,EAGP,OADA1tC,QAAQ0B,MAAME,GACPgxB,EAAOhxB,KAEfglB,KAAKrT,MAAOm6B,IAIb,GAFgB,IAAKrd,KAAKqd,EAAIlc,WAAY85D,UAC1B,IAAKj7D,KAAKhyB,KAAKowE,SAASj9C,WAAY85D,YAE7CxwC,EAeH,OAbAz8C,KAAKssF,YAAc,GACnBj9C,EAAIi9C,YAAYh+E,QAAQ4G,MAAO5J,UACvBtL,KAAK2qC,GAAGhtC,IAAI2N,GAAIid,KAAMykE,IAC1BhtF,KAAKssF,YAAYnrF,KAAK,CACpBmK,GAAI0hF,EAAW37C,IACf5wC,KAAM,aACNmQ,KAAMo8E,EAAWp8E,KACjBzR,OAAQ6tF,EAAW7tF,WAEpBu/C,MAAMn7C,IACP5B,QAAQ0B,MAAME,OAGXqJ,GAAQ,GAGnB,IAAK,MAAMogF,KAAchtF,KAAKssF,kBAEtBtsF,KAAK2qC,GAAGhtC,IAAIqvF,EAAW1hF,IAAIozC,MAAMn7C,GACpB,cAAbA,EAAIlG,KACC,CACLg0C,IAAK27C,EAAW1hF,KAGlB3J,QAAQ0B,MAAME,GACPgxB,EAAOhxB,KAEfglB,KAAM2kE,IACPA,EAAct8E,KAAOo8E,EAAWp8E,KAChCs8E,EAAc/tF,OAAS6tF,EAAW7tF,OAC3Ba,KAAK2qC,GAAG2G,IAAI47C,KAClBxuC,MAAMn7C,IACPgxB,EAAOhxB,GACP5B,QAAQ0B,MAAME,KAGlB,OAAOvD,KAAK2qC,GAAG2G,IAAIjC,KAClB9mB,KAAK,IACC3b,GAAQ,IACd8xC,MAAMn7C,IACPgxB,EAAOhxB,GACP5B,QAAQ0B,MAAME,OAYpB,SAAUguE,GACR,OAAO,IAAIj9C,QAAQ,CAAC1nB,EAAS2nB,KAC3B,GAAIv0B,KAAK+sF,iBAAmBxb,GAAWvxE,KAAK2sF,UAAUrkD,IAAIipC,GACxD3kE,EAAQ5M,KAAK2sF,UAAUhvF,IAAI4zE,SACtB,GAAIvxE,KAAK2sF,UAAUrkD,IAAIipC,GAC5BvxE,KAAKmtF,SAAS5b,EAASvxE,KAAK2sF,UAAUhvF,IAAI4zE,GAASO,KAAKvpD,KAAK,KAC3D3b,EAAQ5M,KAAK2sF,UAAUhvF,IAAI4zE,WAExB,GAAIvxE,KAAK6sF,WAAW/pE,SAASyuD,GAAU,CAC5Cib,EAAWY,YACX,MAAM7lF,EAAI,IAAIhG,MAAM,wBAA0BgwE,GAC9ChqE,EAAElK,KAAO,cACTk3B,EAAOhtB,OACF,CAEL,MAAMylF,EAAahtF,KAAKssF,YAAYrkC,KAAKj3C,GAChCA,EAAK7R,SAAWoyE,GAErByb,EACFxlF,OAAOu6C,MAAMirC,EAAWp8E,MAAM2X,KAAK8zC,IACjC,GAAIA,EAAS5xB,GACX,OAAO4xB,EAASxhC,OAEhB,MAAM,IAAIt5B,MAAM86D,EAAS8vB,cAE1B5jE,KAAKpiB,IAEFA,EAAK4H,MAAM,aACb5H,EAAO,EAAAknF,iBAAiBlnF,IAE1BnG,KAAKmtF,SAAS5b,EAASprE,GAAMoiB,KAAK,KAChC3b,EAAQ5M,KAAK2sF,UAAUhvF,IAAI4zE,QAE5B7yB,MAAMn7C,IACPgxB,EAAOhxB,MAGTipF,EAAWY,YACXptF,KAAK6sF,WAAW1rF,KAAKowE,OAY7B,SAAUA,EAAiBprE,EAAcmnF,GAAQ,GAY/C,OAXAd,EAAWe,kBAAkBpnF,GAC7BnG,KAAK+sF,eAAiBxb,EAUf,IAAIj9C,QAAS1nB,IAClB,MAAMpJ,EAA0B,CAC9B8H,GAAI,EAAA6Q,SACJgQ,OAAQ,aACR2lD,IAAK3rE,GAiBPnG,KAAKusF,eAAej8E,iBAAiB,UAfrC,SAASk9E,EAAQj9E,GACf,GAAIA,EAAIpK,KAAKmF,KAAO9H,EAAQ8H,GAAI,CAC9B,MAAMmpE,EAAMz0E,KAAKuwC,OAAOk9C,gBACtBl9E,EAAIpK,KAAKsuE,IACT,iBACA9tE,gBACF3G,KAAK2sF,UAAU7pF,IAAIyuE,EAAS,CAC1BkD,IAAKA,EACL3C,IAAK3rE,EACLmnF,MAAOA,IAET/8E,EAAIpR,OAAOmS,oBAAoB,UAAWk8E,GAC1C5gF,MAGmDtO,KAAK0B,OAC5DA,KAAKusF,eAAerlF,YAAY1D,KAQpC,OAAQ+tE,GACN,OAAO,IAAIj9C,QAAQ,CAAC1nB,EAAS2nB,KAC3Bv0B,KAAK0tF,SAASnc,GAAShpD,KAAMgN,IAC3B3oB,EAAQ2oB,EAAMk/C,OACb/1B,MAAOn7C,IAAUgxB,EAAOhxB,OAQ/B,OAAQguE,GACN,OAAO,IAAIj9C,QAAQ,CAAC1nB,EAAS2nB,KAC3Bv0B,KAAK0tF,SAASnc,GAAShpD,KAAMgN,IAC3B3oB,EAAQ2oB,EAAMu8C,OACbpzB,MAAOn7C,IAAUgxB,EAAOhxB,OAS/B,eAAgB8oB,EAAmBklD,GACjC,OAAO,IAAIj9C,QAAS1nB,IAClB5M,KAAK0tF,SAASnc,GAAShpD,KAAK,KAC1B,MAAM/kB,EAA0B,CAC9B8H,GAAI,EAAA6Q,SACJgQ,OAAQ,iBACRE,UAAWA,GAEbrsB,KAAKusF,eAAej8E,iBAAiB,UAAW,SAASk9E,EAAQj9E,GAC3DA,EAAIpK,KAAKmF,KAAO9H,EAAQ8H,KAC1BiF,EAAIpR,OAAOmS,oBAAoB,UAAWk8E,GAC1C5gF,EAAQ2D,EAAIpK,KAAKwyE,eAGrB34E,KAAKusF,eAAerlF,YAAY1D,OAUtC,KAAMgnB,EAA4B+mD,GAChC,IAAIl9C,EAMJ,OAJEA,EADEr0B,KAAK+sF,iBAAmBxb,EAChBj9C,QAAQ1nB,QAAQ5M,KAAK2sF,UAAUhvF,IAAI4zE,IAEnCvxE,KAAK0tF,SAASnc,GAEnB,IAAIj9C,QAAS1nB,IAClBynB,EAAQ9L,KAAKgN,IACX,MAAMo4D,EAAap4D,EAAMu8C,IACnBtuE,EAA0B,CAC9B8H,GAAI,EAAA6Q,SACJgQ,OAAQ,OACR3B,aAAcA,GAehBxqB,KAAKusF,eAAej8E,iBAAiB,UAbrC,SAASk9E,EAAQj9E,GACXA,EAAIpK,KAAKmF,KAAO9H,EAAQ8H,KACtBiF,EAAIpK,KAAKiH,SACNpN,KAAKysF,WAAWnkD,IAAIipC,IACvBvxE,KAAKysF,WAAW3pF,IAAIyuE,EAAS,IAE/BvxE,KAAKysF,WAAW9uF,IAAI4zE,GAASpwE,KAAKwsF,GAClC3tF,KAAK0sF,WAAW5pF,IAAIyuE,EAAS,KAE/BhhE,EAAIpR,OAAOmS,oBAAoB,UAAWk8E,GAC1CxtF,KAAK4tF,YAAYrc,GAAShpD,KAAK,KAAQ3b,EAAQ2D,EAAIpK,KAAKiH,YAGL9O,KAAK0B,OAC5DA,KAAKusF,eAAerlF,YAAY1D,OAUtC,YAAa+tE,EAAiB+b,GAC5B,OAAO,IAAIh5D,QAAS1nB,IAElB,IAAIklE,EAAa+b,EACjB,MAAMC,EAAa,IAAIx5D,QAAS1nB,IAC9B,MAAMpJ,EAA0B,CAC9B8H,GAAI,EAAA6Q,SACJgQ,OAAQ,UAEVnsB,KAAKusF,eAAej8E,iBAAiB,UAAW,SAASk9E,EAAQj9E,GAC3DA,EAAIpK,KAAKmF,KAAO9H,EAAQ8H,KAC1BwmE,EAAMvhE,EAAIpK,KAAK2rE,IACfvhE,EAAIpR,OAAOmS,oBAAoB,UAAWk8E,GAC1C5gF,OAGJ5M,KAAKusF,eAAerlF,YAAY1D,KAE5BuqF,EAAa,IAAIz5D,QAAS1nB,IAC9B,MAAMpJ,EAA0B,CAC9B8H,GAAI,EAAA6Q,SACJgQ,OAAQ,eAEVnsB,KAAKusF,eAAej8E,iBAAiB,UAAW,SAASk9E,EAAQj9E,GAC3DA,EAAIpK,KAAKmF,KAAO9H,EAAQ8H,KAC1BuiF,EAAUt9E,EAAIpK,KAAKsuE,IACnBlkE,EAAIpR,OAAOmS,oBAAoB,UAAWk8E,GAC1C5gF,OAGJ5M,KAAKusF,eAAerlF,YAAY1D,KAGlCsqF,EAAWvlE,KAAK,IAAewlE,GAAexlE,KAAK,KACjD,MAAMksD,EAAMz0E,KAAKuwC,OAAOk9C,gBACtBI,EACA,iBACAlnF,gBACF3G,KAAK2sF,UAAU7pF,IAAIyuE,EAAS,CAC1BO,IAAKA,EACL2C,IAAKA,EACL6Y,MAAOA,IAET1gF,QASN,KAAM2kE,GACJ,IAAIl9C,EAMJ,OAJEA,EADEr0B,KAAK+sF,iBAAmBxb,EAChBj9C,QAAQ1nB,UAER5M,KAAK0tF,SAASnc,GAEnB,IAAIj9C,QAAS1nB,IAClBynB,EAAQ9L,KAAK,KACX,MAAM/kB,EAA0B,CAC9B8H,GAAI,EAAA6Q,SACJgQ,OAAQ,YAEVnsB,KAAKusF,eAAej8E,iBAAiB,UAAW,SAASk9E,EAAQj9E,GAC3DA,EAAIpK,KAAKmF,KAAO9H,EAAQ8H,KAC1BiF,EAAIpR,OAAOmS,oBAAoB,UAAWk8E,GAC1C5gF,EAAQoB,KAAKgvB,MAAMzsB,EAAIpK,KAAK0jB,UAGhC7pB,KAAKusF,eAAerlF,YAAY1D,OAUtC,KAAM+tE,GACJ,OAAO,IAAIj9C,QAAS1nB,IAClB,GAAI5M,KAAKysF,WAAWnkD,IAAIipC,GAAU,CAChC,MAAMzvE,EAAQ9B,KAAKysF,WAAW9uF,IAAI4zE,GAAShtE,MAC3C,QAAcrE,IAAV4B,EAOF,YANA9B,KAAK6xE,OAAON,GAAShpD,KAAKupD,IACxB9xE,KAAK0sF,WAAW/uF,IAAI4zE,GAASpwE,KAAK2wE,GAC3B9xE,KAAKmtF,SAAS5b,EAASzvE,GAAO,KACpCymB,KAAK,KACN3b,GAAQ,KAKdA,GAAQ,KASZ,KAAM2kE,GACJ,OAAO,IAAIj9C,QAAS1nB,IAClB,GAAI5M,KAAK0sF,WAAWpkD,IAAIipC,GAAU,CAChC,MAAMzvE,EAAQ9B,KAAK0sF,WAAW/uF,IAAI4zE,GAAShtE,MAC3C,QAAcrE,IAAV4B,EAOF,YANA9B,KAAK6xE,OAAON,GAAShpD,KAAMupD,IACzB9xE,KAAKysF,WAAW9uF,IAAI4zE,GAASpwE,KAAK2wE,GAC3B9xE,KAAKmtF,SAAS5b,EAASzvE,GAAO,KACpCymB,KAAK,KACN3b,GAAQ,KAKdA,GAAQ,KASZ,uBAEE,IAAIohF,GAAkB,EACtB,IAAK,MAAMC,KAAQjuF,KAAK2sF,UAAW,CACjC,MAAMtuF,EAAM4vF,EAAK,GACXlwF,EAAQkwF,EAAK,GACnB,GAAIlwF,EAAMuvF,MAAO,CACfU,GAAkB,EAClB,MAAM1pF,EAAQtE,KAAKssF,YAAYzW,UAAU7kE,GAAiBA,EAAK7R,SAAWd,GAG1E,IAAI2M,EACChL,KAAKssF,YAAYhoF,GAAOsM,KAAK7C,MAAM,UAmBtC/C,EAAM,mCAAqCxD,OAAOmqC,KAAK5zC,EAAM+zE,WAlBvDtqE,OAAOu6C,MAAM/hD,KAAKssF,YAAYhoF,GAAOsM,KACzC,CACE1I,OAAQ,MACRqzD,QAAS,CAAE,eAAgB,uBAC3B3qD,KAAM7S,EAAM+zE,MAEdvpD,KAAK8zC,IAEHrxD,EADEqxD,EAAS5xB,GACLzqC,KAAKssF,YAAYhoF,GAAOsM,KAExB,mCAAqCpJ,OAAOmqC,KAAK5zC,EAAM+zE,OAE9DpzB,MAAMn7C,IACP5B,QAAQ0B,MAAME,GACd5B,QAAQC,KAAK,4BACboJ,EAAM,mCAAqCxD,OAAOmqC,KAAK5zC,EAAM+zE,OAMjE9xE,KAAKssF,YAAYhoF,GAAOsM,KAAO5F,QACzBhL,KAAK2qC,GAAGhtC,IAAIqC,KAAKssF,YAAYhoF,GAAOgH,IAAIid,KAAM8mB,IAClDA,EAAIz+B,KAAO5F,EACJhL,KAAK2qC,GAAG2G,IAAIjC,KAClB9mB,KAAK,KACNxqB,EAAMuvF,OAAQ,IACb5uC,MAAMn7C,IACP5B,QAAQ0B,MAAME,MAKhByqF,SACIhuF,KAAK2qC,GAAGhtC,IAAIqC,KAAKowE,SAAS,QAAQ7nD,KAAM8mB,IAC5CA,EAAIlc,WAAY,IAAKnB,MAAQ8W,cACtB9oC,KAAK2qC,GAAG2G,IAAIjC,KAClBqP,MAAMn7C,IACP5B,QAAQ0B,MAAME,KAMpB,WACE,OAAOvD,KAAK2qC,GAAGhc,a,gBC5fnB,IAAIgB,EAAU,EAAQ,IAAaA,QAE/BwtD,EAAQ,EAAQ,IAChB+Q,EAAc,EAAQ,IAAYA,YAElCC,EAAS,GAETC,EAAK,IAAI/gF,OACX,+GAQQ,KAGNghF,EAAkBlR,EAAM9B,QAAQ/8E,KAAK,KAAM8vF,GA+M/C,IAAIE,EAAM,CACR,GA9MF,SAAqBh5D,EAAMomC,GACzB,IAAIkgB,EAAMlgB,EAAM,GAiBhB,OAfA,SAAgBj4D,EAAS2J,GACvB,IAAItQ,EAAG6G,EAAWy8E,EAAK,GAEvB,IAAKtjF,EAAI,EAAG6G,EAAMyJ,EAAOhM,OAAQtE,EAAI6G,EAAK7G,IACjCsQ,EAAOtQ,GACTg/E,UAAUxtE,QAAQ,SAAS/G,GAC1BA,EAAEq0E,MAAQA,GACZwE,EAAGj/E,KAAKoG,KAKd,OAAO64E,IAgMT,IA1LF,SAAsB9qD,EAAMomC,GAc1B,OAbA,SAAgBj4D,EAAS2J,GACvB,IAAItQ,EAAG6G,EAAWy8E,EAAK,GAEvB,IAAKtjF,EAAI,EAAG6G,EAAMyJ,EAAOhM,OAAQtE,EAAI6G,EAAK7G,IACjCsQ,EAAOtQ,GACTg/E,UAAUxtE,QAAQ,SAAS/G,GAC9B64E,EAAGj/E,KAAKoG,KAIZ,OAAO64E,IAgLT,IA1KF,SAAqB9qD,EAAMomC,GAYzB,OAXA,SAAgBj4D,EAAS2J,GACvB,IAAItQ,EAAG6G,EAAKqN,EAAMovE,EAAK,GAEvB,IAAKtjF,EAAI,EAAG6G,EAAMyJ,EAAOhM,OAAQtE,EAAI6G,EAAK7G,IACxCkU,EAAO5D,EAAOtQ,GACdsjF,EAAGj/E,KAAK6P,GAGV,OAAOovE,IAkKT,KA5HF,SAAyB9qD,EAAMomC,GAyB7B,OAxBA,SAAgBj4D,EAAS2J,GACvB,IAAItQ,EAAG6G,EAAKqN,EAAMovE,EAAK,GAAImO,EAAa9qF,EAAQ8qF,WAYhD,IAVKA,IACH9qF,EAAQ8qF,WAAaA,EAAa,GAElC9qF,EAAQszC,KAAK0nC,KAAK,KAAM,SAAS7/E,GAC/BA,EAAEk9E,UAAUxtE,QAAQ,SAAS/G,GAC3BgnF,EAAWhnF,GAAK3I,OAKjB9B,EAAI,EAAG6G,EAAMyJ,EAAOhM,OAAQtE,EAAI6G,EAAK7G,IACxCkU,EAAO5D,EAAOtQ,GAEVyxF,EAAW5vF,eAAeqS,IAC5BovE,EAAGj/E,KAAKotF,EAAWv9E,IAIvB,OAAOovE,IAuGT,KA7JF,SAAsB9qD,EAAMomC,GAC1B,IAAIkgB,EAGJ,GAAiB,OAFjBlgB,EAAQpmC,KAEE,GACRsmD,EAAM,QAEH,IAAKlgB,EAAM,GAId,MAAM,IAAIwyB,EAAYxyB,GAHtBkgB,EAAMlgB,EAAM,IAAM,GAqBpB,OAfA,SAAgBj4D,EAAS2J,GACvB,IAAItQ,EAAG6G,EAAKqN,EAAMovE,EAAK,GAEvB,IAAKtjF,EAAI,EAAG6G,EAAMyJ,EAAOhM,OAAQtE,EAAI6G,EAAK7G,KACxCkU,EAAO5D,EAAOtQ,IACT2hF,KAAK7C,EAAK,SAASr0E,GAClBA,IAAMyJ,GACRovE,EAAGj/E,KAAKoG,KAKd,OAAO64E,IAoIT,IAjGF,SAA2B9qD,EAAMomC,GAC/B,IAAIkgB,EAAKv9E,EAAKN,EAAO6W,EAGrB,GAAiB,OAFjB8mD,EAAQpmC,KAEE,GAAY,CAIpB,IAFAomC,EAAQpmC,KAEE,GACR,MAAM,IAAI44D,EAAYxyB,EAAO,+BAM/B,GAHAr9D,EAAMq9D,EAAM,GAGK,OAFjBA,EAAQpmC,KAEE,GACR1gB,EAAS,SAASnR,EAAS2J,GACzB,IAAItQ,EAAG6G,EAAKqN,EAAMovE,EAAK,GAEvB,IAAKtjF,EAAI,EAAG6G,EAAMyJ,EAAOhM,OAAQtE,EAAI6G,EAAK7G,KACxCkU,EAAO5D,EAAOtQ,IAELa,IAAIU,IACX+hF,EAAGj/E,KAAK6P,GAIZ,OAAOovE,QAGN,GAAiB,MAAb1kB,EAAM,GAAY,CAGzB,GAAiB,OAFjB39D,EAAQu3B,IAAO,IAEL,IAA0C,MAA5Bv3B,EAAMA,EAAMqD,OAAS,GAI3C,MAAM,IAAI8sF,EAAYxyB,EAAO,4BAH7B39D,EAAQA,EAAMsR,MAAM,EAAGtR,EAAMqD,OAAS,GAMxCs6D,EAAQpmC,IACR1gB,EAAS,SAASnR,EAAS2J,GACzB,IAAItQ,EAAG6G,EAAKqN,EAAMovE,EAAK,GAEvB,IAAKtjF,EAAI,EAAG6G,EAAMyJ,EAAOhM,OAAQtE,EAAI6G,EAAK7G,KACxCkU,EAAO5D,EAAOtQ,IAELa,IAAIU,KAASN,GACpBqiF,EAAGj/E,KAAK6P,GAIZ,OAAOovE,GAIX,GAAiB,MAAb1kB,EAAM,GACR,MAAM,IAAIwyB,EAAYxyB,EAAO,mCAG5B,IAAKA,EAAM,GAuBd,MAAM,IAAIwyB,EAAY,KAAM,qBAnB5B,GAHAtS,EAAMlgB,EAAM,IAAM,GAGD,OAFjBA,EAAQpmC,KAEE,GACR,MAAM,IAAI44D,EAAYxyB,EAAO,0BAG/B9mD,EAAS,SAASnR,EAAS2J,GACzB,IAAItQ,EAAG6G,EAAKqN,EAAMovE,EAAK,GAEvB,IAAKtjF,EAAI,EAAG6G,EAAMyJ,EAAOhM,OAAQtE,EAAI6G,EAAK7G,KACxCkU,EAAO5D,EAAOtQ,IAELmrD,KAAK2zB,IACZwE,EAAGj/E,KAAK6P,GAIZ,OAAOovE,GAOX,OAAOxrE,IAcT,SAAS45E,EAAiBz3C,GACxB/2C,KAAKuuF,WAAa,KAClBvuF,KAAK+2C,KAAOA,EAGd,SAASskC,EAAQrqE,EAAMiG,GACrB,IAAIkU,EAAU/d,EAAQtQ,EAAG6G,EAAK+3D,EAAO39D,EAAO6W,EAAQnR,EAEpD,GAAI0qF,EAAOxvF,eAAesY,GACxBkU,EAAWgjE,EAAOl3E,OAEf,CAMH,GAJIzZ,OAAOmH,KAAKwpF,GAAQ/sF,OAAS,MAC/B+sF,EAAS,IAGY,MAAnBl3E,EAAK8oB,OAAO,GACd,MAAM,IAAImuD,EAAY,KAAM,uCAM9B,SAASO,IACP,OAAOrhF,EAAO/I,QAIhB,IARA+I,EAASihF,EAAgBp3E,GACzBkU,EAAW,GAMXuwC,EAAQ+yB,MACK,CACX,IAAItxF,EAAIu+D,EAAM,IAAM,GAGpB,KAFA39D,EAAQuwF,EAAInxF,GAAGsxF,EAAU/yB,IAGvB,MAAM,IAAIwyB,EAAY,KAAMv+D,EAAQ,mBAAoB1Y,IAM1D,GAHAkU,EAAShqB,KAAKpD,KACd29D,EAAQ+yB,KAGN,MAMF,GAJsB,MAAb/yB,EAAM,KACbA,EAAQ+yB,MAGL/yB,EACH,MAIJyyB,EAAOl3E,GAAQkU,EAOjB,IAHA/d,EAAS,CAAC4D,GACVvN,EAAU,IAAI+qF,EAAiBx9E,GAE1BlU,EAAI,EAAG6G,EAAMwnB,EAAS/pB,OAAQtE,EAAI6G,EAAK7G,IAC1C8X,EAASuW,EAASruB,GAClBsQ,EAASwH,EAAOnR,EAAS2J,GAG3B,OAAOA,GAAU,GAwBnBxQ,EAAQqrD,KArBR,SAAcniD,EAASmR,GACrB,IAAIy3E,EAAiBrT,EAAQv1E,EAASmR,GAEtC,OAAIy3E,GAAkBA,EAAettF,OAAS,EACrCstF,EAAe,GAGjB,MAeT9xF,EAAQy+E,QAAUA,EAClBz+E,EAAQ2hF,SAbR,SAAkBz4E,EAASmR,EAAMunE,GAC/B,IAAIkQ,EAAiBrT,EAAQv1E,EAASmR,GAEtC,OAAIy3E,GAAkBA,EAAettF,OAAS,EACrCstF,EAAe,GAAG7zD,KAGpB2jD,I,gBC/TT,IAAI32E,EAAO,EAAQ,IAEf8nB,EAAU,EAAQ,IAAaA,QAEnC,SAASu+D,EAAYxyB,EAAOnvD,GAC1BA,EAAMA,GAAOojB,EAAQ,2BAA4B+rC,EAAMlwD,YACvDxL,KAAK07D,MAAQA,EACb17D,KAAKwD,QAAU+I,EACfhL,MAAMtE,KAAK+C,KAAMuM,GAGnB1E,EAAKC,SAASomF,EAAa3sF,OAE3B3E,EAAQsxF,YAAcA,G,cC9BtBrxF,EAAOD,QAAU,SAAkBmG,GACjC,OAAOA,GAAsB,iBAARA,GACI,mBAAbA,EAAIF,MACS,mBAAbE,EAAIgR,MACc,mBAAlBhR,EAAIqhB,Y,cCJW,mBAAlB5mB,OAAOY,OAEhBvB,EAAOD,QAAU,SAAkBkI,EAAMC,GACvCD,EAAKE,OAASD,EACdD,EAAKpG,UAAYlB,OAAOY,OAAO2G,EAAUrG,UAAW,CAClDuG,YAAa,CACXlH,MAAO+G,EACPpH,YAAY,EACZwH,UAAU,EACVC,cAAc,MAMpBtI,EAAOD,QAAU,SAAkBkI,EAAMC,GACvCD,EAAKE,OAASD,EACd,IAAIK,EAAW,aACfA,EAAS1G,UAAYqG,EAAUrG,UAC/BoG,EAAKpG,UAAY,IAAI0G,EACrBN,EAAKpG,UAAUuG,YAAcH,I,gBCDtB,EAAQ,IAAnB,IACI6pF,EAAU,EAAQ,IAYtB/xF,EAAQ0gF,WAVR,SAAoBjgF,GAClB,GAAa,QAATA,EACF,OAAOsxF,EAAQC,IAGf,MAAM,IAAIrtF,MAAM,mBAAqBlE,K,gBC3BzCT,EAAQgyF,IAAM,EAAQ,K,gBCAX,EAAQ,IAAnB,IAEIA,EAAM,EAAQ,IAEdvR,EAAc,EAAQ,IAAoBA,YAE9C,SAASwB,EAAU1/E,GACjBa,KAAKuwC,OAASq+C,EAAIr+C,QAAO,GAEzBvwC,KAAKb,OAAS,GAAoB,IAAIk+E,EAEtCr9E,KAAKuwC,OAAOs+C,UAAY7uF,KAAK8uF,eAAexwF,KAAK0B,MACjDA,KAAKuwC,OAAOw+C,OAAS/uF,KAAKgvF,YAAY1wF,KAAK0B,MAC3CA,KAAKuwC,OAAO0+C,QAAUjvF,KAAKkvF,aAAa5wF,KAAK0B,MAC7CA,KAAKuwC,OAAO4+C,UAAYnvF,KAAKovF,eAAe9wF,KAAK0B,MACjDA,KAAKuwC,OAAO8+C,UAAYrvF,KAAKsvF,eAAehxF,KAAK0B,MACjDA,KAAKuwC,OAAOg/C,WAAavvF,KAAKwvF,gBAAgBlxF,KAAK0B,MACnDA,KAAKuwC,OAAOuhB,QAAU9xD,KAAKyvF,aAAanxF,KAAK0B,MAG/C6+E,EAAUngF,UAAUowF,eAAiB,SAASlT,GAC5C57E,KAAKb,OAAOif,MAAMw9D,EAAIv+E,KAAMu+E,EAAIjD,aAGlCkG,EAAUngF,UAAUswF,YAAc,SAASn0D,GACzC76B,KAAKb,OAAOgH,KAAK00B,IAGnBgkD,EAAUngF,UAAUwwF,aAAe,SAASr0D,GAC1C76B,KAAKb,OAAOgH,KAAK00B,IAGnBgkD,EAAUngF,UAAU0wF,eAAiB,SAASv0D,KAG9CgkD,EAAUngF,UAAU4wF,eAAiB,SAASI,KAG9C7Q,EAAUngF,UAAU8wF,gBAAkB,SAAS5T,GAC7C57E,KAAKb,OAAOwJ,IAAIizE,IAGlBiD,EAAUngF,UAAU+wF,aAAe,SAASlsF,GAC1C,MAAMA,GAGRs7E,EAAUngF,UAAUy/D,KAAO,SAASvlC,GAClC54B,KAAKuwC,OAAOhzB,MAAMqb,IAGpBimD,EAAUngF,UAAU8hD,MAAQ,WAE1B,OADAxgD,KAAKuwC,OAAOiQ,QACLxgD,KAAKb,OAAOqhD,SAGrB5jD,EAAQiiF,UAAYA,G,iBCvDpB,aAAC,SAAW+P,GACVA,EAAIr+C,OAAS,SAAUo/C,EAAQC,GAAO,OAAO,IAAIC,EAAUF,EAAQC,IACnEhB,EAAIiB,UAAYA,EAChBjB,EAAIkB,UAAYA,EAChBlB,EAAImB,aAsKJ,SAAuBJ,EAAQC,GAC7B,OAAO,IAAIE,EAAUH,EAAQC,IA5J/BhB,EAAIoB,kBAAoB,MAExB,IA8IIj7D,EA9IAk7D,EAAU,CACZ,UAAW,WAAY,WAAY,UAAW,UAC9C,eAAgB,eAAgB,SAAU,aAC1C,cAAe,QAAS,UAuB1B,SAASJ,EAAWF,EAAQC,GAC1B,KAAM5vF,gBAAgB6vF,GACpB,OAAO,IAAIA,EAAUF,EAAQC,IAwFjC,SAAuBr/C,GACrB,IAAK,IAAIzzC,EAAI,EAAGC,EAAIkzF,EAAQ7uF,OAAQtE,EAAIC,EAAGD,IACzCyzC,EAAO0/C,EAAQnzF,IAAM,GAtFvBozF,CADalwF,WAENmwF,EAFMnwF,KAEK7C,EAAI,GAFT6C,KAGNowF,oBAAsBxB,EAAIoB,kBAHpBhwF,KAIN4vF,IAAMA,GAAO,GAJP5vF,KAKN4vF,IAAIS,UALErwF,KAKiB4vF,IAAIS,WALrBrwF,KAKyC4vF,IAAIU,cAL7CtwF,KAMNuwF,UANMvwF,KAMa4vF,IAAIS,UAAY,cAAgB,cAN7CrwF,KAONwwF,KAAO,GAPDxwF,KAQNywF,OARMzwF,KAQU0wF,WARV1wF,KAQ8B2wF,SAAU,EARxC3wF,KASN47E,IATM57E,KASOqD,MAAQ,KATfrD,KAUN2vF,SAAWA,EAVL3vF,KAWN4wF,YAAcjB,IAXR3vF,KAWyB4vF,IAAIgB,UAX7B5wF,KAYN8B,MAAQ2oE,EAAEomB,MAZJ7wF,KAaN8wF,eAbM9wF,KAakB4vF,IAAIkB,eAbtB9wF,KAcN+wF,SAdM/wF,KAcY8wF,eAAiBtzF,OAAOY,OAAOwwF,EAAIoC,cAAgBxzF,OAAOY,OAAOwwF,EAAImC,UAdjF/wF,KAeNixF,WAAa,GAfPjxF,KAoBF4vF,IAAIsB,QApBFlxF,KAqBJ7B,GAAKX,OAAOY,OAAO+yF,IArBfnxF,KAyBNoxF,eAAwC,IAzBlCpxF,KAyBiB4vF,IAAIzrF,SAzBrBnE,KA0BFoxF,gBA1BEpxF,KA2BJmE,SA3BInE,KA2Bc2yB,KA3Bd3yB,KA2B4BqxF,OAAS,GAElDpwF,EA7BajB,KA6BA,WAtDf4uF,EAAI0C,OAAS,CACX,OACA,wBACA,kBACA,UACA,UACA,YACA,UACA,WACA,YACA,QACA,aACA,QACA,MACA,QACA,SACA,gBACA,kBAwCG9zF,OAAOY,SACVZ,OAAOY,OAAS,SAAUb,GACxB,SAASg0F,KAGT,OAFAA,EAAE7yF,UAAYnB,EACH,IAAIg0F,IAKd/zF,OAAOmH,OACVnH,OAAOmH,KAAO,SAAUpH,GACtB,IAAIqR,EAAI,GACR,IAAK,IAAI9R,KAAKS,EAAOA,EAAEoB,eAAe7B,IAAI8R,EAAEzN,KAAKrE,GACjD,OAAO8R,IA0DXihF,EAAUnxF,UAAY,CACpBiK,IAAK,WAAcA,EAAI3I,OACvBud,MAizBF,SAAgBqb,GAEd,GAAI54B,KAAKqD,MACP,MAAMrD,KAAKqD,MAEb,GAJarD,KAIFywF,OACT,OAAOptF,EALIrD,KAMT,wDAEJ,GAAc,OAAV44B,EACF,OAAOjwB,EATI3I,MAWb,IAAIlD,EAAI,EACJK,EAAI,GACR,KACEA,EAAIy7B,EAAMmH,OAAOjjC,KAdNkD,KAeJ7C,EAAIA,EACNA,GAYL,OA5BW6C,KAmBAoxF,gBAnBApxF,KAoBFmE,WACG,OAANhH,GArBK6C,KAsBA2yB,OAtBA3yB,KAuBAqxF,OAAS,GAvBTrxF,KAyBAqxF,UAzBArxF,KA4BI8B,OACb,KAAK2oE,EAAEomB,MAEL,GA/BO7wF,KA8BA8B,MAAQ2oE,EAAE+mB,iBACP,WAANr0F,EACF,SAEFs0F,EAlCOzxF,KAkCiB7C,GACxB,SAEF,KAAKstE,EAAE+mB,iBACLC,EAtCOzxF,KAsCiB7C,GACxB,SAEF,KAAKstE,EAAEinB,KACL,GA1CO1xF,KA0CI2wF,UA1CJ3wF,KA0CuB0wF,WAAY,CAExC,IADA,IAAIiB,EAAS70F,EAAI,EACVK,GAAW,MAANA,GAAmB,MAANA,IACvBA,EAAIy7B,EAAMmH,OAAOjjC,OA7CdkD,KA8CaoxF,gBA9CbpxF,KA+CMmE,WACG,OAANhH,GAhDH6C,KAiDQ2yB,OAjDR3yB,KAkDQqxF,OAAS,GAlDjBrxF,KAoDQqxF,UApDRrxF,KAwDE4xF,UAAYh5D,EAAM1L,UAAUykE,EAAQ70F,EAAI,GAEvC,MAANK,GA1DG6C,KA0DmB2wF,SA1DnB3wF,KA0DqC0wF,aA1DrC1wF,KA0D2D2vF,SAI5DhtD,EAAIkvD,EAAY10F,IA9Df6C,KA8D8B2wF,UA9D9B3wF,KA8DgD0wF,YACnDoB,EA/DG9xF,KA+DgB,mCAEX,MAAN7C,EAjEC6C,KAkEI8B,MAAQ2oE,EAAEsnB,YAlEd/xF,KAoEI4xF,UAAYz0F,IApEhB6C,KA2DE8B,MAAQ2oE,EAAEunB,UA3DZhyF,KA4DEiyF,iBA5DFjyF,KA4D4BmE,UAWnC,SAEF,KAAKsmE,EAAEynB,OAEK,MAAN/0F,EA3EG6C,KA4EE8B,MAAQ2oE,EAAE0nB,cA5EZnyF,KA8EEoyF,QAAUj1F,EAEnB,SAEF,KAAKstE,EAAE0nB,cACK,MAANh1F,EAnFG6C,KAoFE8B,MAAQ2oE,EAAE4nB,WApFZryF,KAsFEoyF,QAAU,IAAMj1F,EAtFlB6C,KAuFE8B,MAAQ2oE,EAAEynB,QAEnB,SAEF,KAAKznB,EAAEunB,UAEL,GAAU,MAAN70F,EA7FG6C,KA8FE8B,MAAQ2oE,EAAE6nB,UA9FZtyF,KA+FEuyF,SAAW,QACb,GAAIC,EAAGX,EAAY10F,SAEnB,GAAIq1F,EAAGC,EAAWt1F,GAlGlB6C,KAmGE8B,MAAQ2oE,EAAEioB,SAnGZ1yF,KAoGEunB,QAAUpqB,OACZ,GAAU,MAANA,EArGJ6C,KAsGE8B,MAAQ2oE,EAAE4nB,UAtGZryF,KAuGEunB,QAAU,QACZ,GAAU,MAANpqB,EAxGJ6C,KAyGE8B,MAAQ2oE,EAAEkoB,UAzGZ3yF,KA0GE4yF,aA1GF5yF,KA0GwB6yF,aAAe,OACvC,CAGL,GAFAf,EA5GK9xF,KA4Gc,eA5GdA,KA8GMiyF,iBAAmB,EA9GzBjyF,KA8GoCmE,SAAU,CACjD,IAAI0uB,EA/GD7yB,KA+GcmE,SA/GdnE,KA+GgCiyF,iBACnC90F,EAAI,IAAIsF,MAAMowB,GAAKxmB,KAAK,KAAOlP,EAhH5B6C,KAkHE4xF,UAAY,IAAMz0F,EAlHpB6C,KAmHE8B,MAAQ2oE,EAAEinB,KAEnB,SAEF,KAAKjnB,EAAE6nB,WAvHEtyF,KAwHKuyF,SAAWp1F,GAAG61B,gBAAkB8/D,GAC1CC,EAzHK/yF,KAyHY,eAzHZA,KA0HE8B,MAAQ2oE,EAAEqoB,MA1HZ9yF,KA2HEuyF,SAAW,GA3HbvyF,KA4HEgzF,MAAQ,IA5HVhzF,KA6HWuyF,SAAWp1F,IAAM,MA7H5B6C,KA8HE8B,MAAQ2oE,EAAEwoB,QA9HZjzF,KA+HE0vF,QAAU,GA/HZ1vF,KAgIEuyF,SAAW,KAhIbvyF,KAiIYuyF,SAAWp1F,GAAG61B,gBAAkBkgE,GAjI5ClzF,KAkIE8B,MAAQ2oE,EAAEyoB,SAlIZlzF,KAmIMmzF,SAnINnzF,KAmIwB2wF,UAC3BmB,EApIG9xF,KAqID,+CArICA,KAuIEmzF,QAAU,GAvIZnzF,KAwIEuyF,SAAW,IACH,MAANp1F,GACT41F,EA1IK/yF,KA0IY,oBA1IZA,KA0IwCuyF,UA1IxCvyF,KA2IEuyF,SAAW,GA3IbvyF,KA4IE8B,MAAQ2oE,EAAEinB,MACRc,EAAGY,EAAOj2F,IA7Id6C,KA8IE8B,MAAQ2oE,EAAE4oB,iBA9IZrzF,KA+IEuyF,UAAYp1F,GA/Id6C,KAiJEuyF,UAAYp1F,EAErB,SAEF,KAAKstE,EAAE4oB,iBACDl2F,IAtJG6C,KAsJUmwF,IAtJVnwF,KAuJE8B,MAAQ2oE,EAAE6nB,UAvJZtyF,KAwJEmwF,EAAI,IAxJNnwF,KA0JAuyF,UAAYp1F,EACnB,SAEF,KAAKstE,EAAEyoB,QACK,MAAN/1F,GA9JG6C,KA+JE8B,MAAQ2oE,EAAEinB,KACjBqB,EAhKK/yF,KAgKY,YAhKZA,KAgKgCmzF,SAhKhCnzF,KAiKEmzF,SAAU,IAjKZnzF,KAmKEmzF,SAAWh2F,EACR,MAANA,EApKC6C,KAqKI8B,MAAQ2oE,EAAE6oB,YACRd,EAAGY,EAAOj2F,KAtKhB6C,KAuKI8B,MAAQ2oE,EAAE8oB,eAvKdvzF,KAwKImwF,EAAIhzF,IAGf,SAEF,KAAKstE,EAAE8oB,eA7KEvzF,KA8KAmzF,SAAWh2F,EACdA,IA/KG6C,KA+KUmwF,IA/KVnwF,KAgLEmwF,EAAI,GAhLNnwF,KAiLE8B,MAAQ2oE,EAAEyoB,SAEnB,SAEF,KAAKzoB,EAAE6oB,YArLEtzF,KAsLAmzF,SAAWh2F,EACR,MAANA,EAvLG6C,KAwLE8B,MAAQ2oE,EAAEyoB,QACRV,EAAGY,EAAOj2F,KAzLd6C,KA0LE8B,MAAQ2oE,EAAE+oB,mBA1LZxzF,KA2LEmwF,EAAIhzF,GAEb,SAEF,KAAKstE,EAAE+oB,mBA/LExzF,KAgMAmzF,SAAWh2F,EACdA,IAjMG6C,KAiMUmwF,IAjMVnwF,KAkME8B,MAAQ2oE,EAAE6oB,YAlMZtzF,KAmMEmwF,EAAI,IAEb,SAEF,KAAK1lB,EAAEwoB,QACK,MAAN91F,EAxMG6C,KAyME8B,MAAQ2oE,EAAEgpB,eAzMZzzF,KA2ME0vF,SAAWvyF,EAEpB,SAEF,KAAKstE,EAAEgpB,eACK,MAANt2F,GAhNG6C,KAiNE8B,MAAQ2oE,EAAEipB,cAjNZ1zF,KAkNE0vF,QAAUiE,EAlNZ3zF,KAkN4B4vF,IAlN5B5vF,KAkNwC0vF,SAlNxC1vF,KAmNM0vF,SACTqD,EApNG/yF,KAoNc,YApNdA,KAoNkC0vF,SApNlC1vF,KAsNE0vF,QAAU,KAtNZ1vF,KAwNE0vF,SAAW,IAAMvyF,EAxNnB6C,KAyNE8B,MAAQ2oE,EAAEwoB,SAEnB,SAEF,KAAKxoB,EAAEipB,cACK,MAANv2F,GACF20F,EA/NK9xF,KA+Nc,qBA/NdA,KAkOE0vF,SAAW,KAAOvyF,EAlOpB6C,KAmOE8B,MAAQ2oE,EAAEwoB,SAnOZjzF,KAqOE8B,MAAQ2oE,EAAEinB,KAEnB,SAEF,KAAKjnB,EAAEqoB,MACK,MAAN31F,EA1OG6C,KA2OE8B,MAAQ2oE,EAAEmpB,aA3OZ5zF,KA6OEgzF,OAAS71F,EAElB,SAEF,KAAKstE,EAAEmpB,aACK,MAANz2F,EAlPG6C,KAmPE8B,MAAQ2oE,EAAEopB,gBAnPZ7zF,KAqPEgzF,OAAS,IAAM71F,EArPjB6C,KAsPE8B,MAAQ2oE,EAAEqoB,OAEnB,SAEF,KAAKroB,EAAEopB,eACK,MAAN12F,GA3PG6C,KA4PMgzF,OACTD,EA7PG/yF,KA6Pc,UA7PdA,KA6PgCgzF,OAErCD,EA/PK/yF,KA+PY,gBA/PZA,KAgQEgzF,MAAQ,GAhQVhzF,KAiQE8B,MAAQ2oE,EAAEinB,MACF,MAANv0F,EAlQJ6C,KAmQEgzF,OAAS,KAnQXhzF,KAqQEgzF,OAAS,KAAO71F,EArQlB6C,KAsQE8B,MAAQ2oE,EAAEqoB,OAEnB,SAEF,KAAKroB,EAAEkoB,UACK,MAANx1F,EA3QG6C,KA4QE8B,MAAQ2oE,EAAEqpB,iBACRtB,EAAGX,EAAY10F,GA7QnB6C,KA8QE8B,MAAQ2oE,EAAEspB,eA9QZ/zF,KAgRE4yF,cAAgBz1F,EAEzB,SAEF,KAAKstE,EAAEspB,eACL,IArRO/zF,KAqRK6yF,cAAgBL,EAAGX,EAAY10F,GACzC,SACe,MAANA,EAvRJ6C,KAwRE8B,MAAQ2oE,EAAEqpB,iBAxRZ9zF,KA0RE6yF,cAAgB11F,EAEzB,SAEF,KAAKstE,EAAEqpB,iBACK,MAAN32F,GACF41F,EAhSK/yF,KAgSY,0BAA2B,CAC1C3C,KAjSG2C,KAiSU4yF,aACbhiF,KAlSG5Q,KAkSU6yF,eAlSV7yF,KAoSE4yF,aApSF5yF,KAoSwB6yF,aAAe,GApSvC7yF,KAqSE8B,MAAQ2oE,EAAEinB,OArSZ1xF,KAuSE6yF,cAAgB,IAAM11F,EAvSxB6C,KAwSE8B,MAAQ2oE,EAAEspB,gBAEnB,SAEF,KAAKtpB,EAAEioB,SACDF,EAAGwB,EAAU72F,GA7SV6C,KA8SEunB,SAAWpqB,GAElB82F,EAhTKj0F,MAiTK,MAAN7C,EACF+2F,EAlTGl0F,MAmTY,MAAN7C,EAnTN6C,KAoTI8B,MAAQ2oE,EAAE0pB,gBAEbxxD,EAAIkvD,EAAY10F,IAClB20F,EAvTC9xF,KAuTkB,iCAvTlBA,KAyTI8B,MAAQ2oE,EAAE2pB,SAGrB,SAEF,KAAK3pB,EAAE0pB,eACK,MAANh3F,GACF+2F,EAhUKl0F,MAgUW,GAChBq0F,EAjUKr0F,QAmUL8xF,EAnUK9xF,KAmUc,kDAnUdA,KAoUE8B,MAAQ2oE,EAAE2pB,QAEnB,SAEF,KAAK3pB,EAAE2pB,OAEL,GAAI5B,EAAGX,EAAY10F,GACjB,SACe,MAANA,EACT+2F,EA7UKl0F,MA8UU,MAAN7C,EA9UJ6C,KA+UE8B,MAAQ2oE,EAAE0pB,eACR3B,EAAGC,EAAWt1F,IAhVlB6C,KAiVEs0F,WAAan3F,EAjVf6C,KAkVEu0F,YAAc,GAlVhBv0F,KAmVE8B,MAAQ2oE,EAAE+pB,aAEjB1C,EArVK9xF,KAqVc,0BAErB,SAEF,KAAKyqE,EAAE+pB,YACK,MAANr3F,EA1VG6C,KA2VE8B,MAAQ2oE,EAAEgqB,aACF,MAANt3F,GACT20F,EA7VK9xF,KA6Vc,2BA7VdA,KA8VEu0F,YA9VFv0F,KA8VuBs0F,WAC5BjY,EA/VKr8E,MAgWLk0F,EAhWKl0F,OAiWIwyF,EAAGX,EAAY10F,GAjWnB6C,KAkWE8B,MAAQ2oE,EAAEiqB,sBACRlC,EAAGwB,EAAU72F,GAnWjB6C,KAoWEs0F,YAAcn3F,EAErB20F,EAtWK9xF,KAsWc,0BAErB,SAEF,KAAKyqE,EAAEiqB,sBACL,GAAU,MAANv3F,EA3WG6C,KA4WE8B,MAAQ2oE,EAAEgqB,iBACZ,IAAIjC,EAAGX,EAAY10F,GACxB,SAEA20F,EAhXK9xF,KAgXc,2BAhXdA,KAiXE47E,IAAIjD,WAjXN34E,KAiXwBs0F,YAAc,GAjXtCt0F,KAkXEu0F,YAAc,GACrBxB,EAnXK/yF,KAmXY,cAAe,CAC9B3C,KApXG2C,KAoXUs0F,WACbv2F,MAAO,KArXJiC,KAuXEs0F,WAAa,GACV,MAANn3F,EACF+2F,EAzXGl0F,MA0XMwyF,EAAGC,EAAWt1F,IA1XpB6C,KA2XIs0F,WAAan3F,EA3XjB6C,KA4XI8B,MAAQ2oE,EAAE+pB,cAEjB1C,EA9XG9xF,KA8XgB,0BA9XhBA,KA+XI8B,MAAQ2oE,EAAE2pB,QAGrB,SAEF,KAAK3pB,EAAEgqB,aACL,GAAIjC,EAAGX,EAAY10F,GACjB,SACSq1F,EAAGY,EAAOj2F,IAvYd6C,KAwYEmwF,EAAIhzF,EAxYN6C,KAyYE8B,MAAQ2oE,EAAEkqB,sBAEjB7C,EA3YK9xF,KA2Yc,4BA3YdA,KA4YE8B,MAAQ2oE,EAAEmqB,sBA5YZ50F,KA6YEu0F,YAAcp3F,GAEvB,SAEF,KAAKstE,EAAEkqB,oBACL,GAAIx3F,IAlZG6C,KAkZUmwF,EAAG,CACR,MAANhzF,EAnZC6C,KAoZI8B,MAAQ2oE,EAAEoqB,sBApZd70F,KAsZIu0F,aAAep3F,EAExB,SAEFk/E,EA1ZOr8E,WA2ZAmwF,EAAI,GA3ZJnwF,KA4ZA8B,MAAQ2oE,EAAEqqB,oBACjB,SAEF,KAAKrqB,EAAEqqB,oBACDtC,EAAGX,EAAY10F,GAhaZ6C,KAiaE8B,MAAQ2oE,EAAE2pB,OACF,MAANj3F,EACT+2F,EAnaKl0F,MAoaU,MAAN7C,EApaJ6C,KAqaE8B,MAAQ2oE,EAAE0pB,eACR3B,EAAGC,EAAWt1F,IACvB20F,EAvaK9xF,KAuac,oCAvadA,KAwaEs0F,WAAan3F,EAxaf6C,KAyaEu0F,YAAc,GAzahBv0F,KA0aE8B,MAAQ2oE,EAAE+pB,aAEjB1C,EA5aK9xF,KA4ac,0BAErB,SAEF,KAAKyqE,EAAEmqB,sBACL,GAAIjyD,EAAIoyD,EAAW53F,GAAI,CACX,MAANA,EAlbC6C,KAmbI8B,MAAQ2oE,EAAEuqB,sBAnbdh1F,KAqbIu0F,aAAep3F,EAExB,SAEFk/E,EAzbOr8E,MA0bG,MAAN7C,EACF+2F,EA3bKl0F,WA6bE8B,MAAQ2oE,EAAE2pB,OAEnB,SAEF,KAAK3pB,EAAE4nB,UACL,GAlcOryF,KAkcKunB,QAaK,MAANpqB,EACTk3F,EAhdKr0F,MAidIwyF,EAAGwB,EAAU72F,GAjdjB6C,KAkdEunB,SAAWpqB,EAldb6C,KAmdWoyF,QAndXpyF,KAodEoyF,QAAU,KApdZpyF,KAod0BunB,QApd1BvnB,KAqdEunB,QAAU,GArdZvnB,KAsdE8B,MAAQ2oE,EAAEynB,SAEbvvD,EAAIkvD,EAAY10F,IAClB20F,EAzdG9xF,KAydgB,kCAzdhBA,KA2dE8B,MAAQ2oE,EAAEwqB,yBAzBE,CACnB,GAAIzC,EAAGX,EAAY10F,GACjB,SACSwlC,EAAI8vD,EAAWt1F,GArcrB6C,KAscQoyF,QAtcRpyF,KAucMoyF,QAAU,KAAOj1F,EAvcvB6C,KAwcM8B,MAAQ2oE,EAAEynB,QAEjBJ,EA1cC9xF,KA0ckB,mCA1clBA,KA6cIunB,QAAUpqB,EAgBrB,SAEF,KAAKstE,EAAEwqB,oBACL,GAAIzC,EAAGX,EAAY10F,GACjB,SAEQ,MAANA,EACFk3F,EApeKr0F,MAseL8xF,EAteK9xF,KAsec,qCAErB,SAEF,KAAKyqE,EAAEsnB,YACP,KAAKtnB,EAAEoqB,sBACP,KAAKpqB,EAAEuqB,sBACL,IAAIE,EACAx3E,EACJ,OA/eO1d,KA+eQ8B,OACb,KAAK2oE,EAAEsnB,YACLmD,EAAczqB,EAAEinB,KAChBh0E,EAAS,WACT,MAEF,KAAK+sD,EAAEoqB,sBACLK,EAAczqB,EAAEkqB,oBAChBj3E,EAAS,cACT,MAEF,KAAK+sD,EAAEuqB,sBACLE,EAAczqB,EAAEmqB,sBAChBl3E,EAAS,cAIH,MAANvgB,GAhgBG6C,KAigBE0d,IAAWy3E,EAjgBbn1F,WAkgBEo1F,OAAS,GAlgBXp1F,KAmgBE8B,MAAQozF,GACN1C,EApgBJxyF,KAogBco1F,OAAOh0F,OAASi0F,EAAaC,EAAan4F,GApgBxD6C,KAqgBEo1F,QAAUj4F,GAEjB20F,EAvgBK9xF,KAugBc,oCAvgBdA,KAwgBE0d,IAAW,IAxgBb1d,KAwgB0Bo1F,OAASj4F,EAxgBnC6C,KAygBEo1F,OAAS,GAzgBXp1F,KA0gBE8B,MAAQozF,GAGjB,SAEF,QACE,MAAM,IAAI3zF,MAhhBHvB,KAghBiB,kBAhhBjBA,KAghB4C8B,OAhhB5C9B,KAohBFmE,UAphBEnE,KAohBiBowF,qBA93ChC,SAA4B7/C,GAG1B,IAFA,IAAIglD,EAAatjF,KAAKsB,IAAIq7E,EAAIoB,kBAAmB,IAC7CwF,EAAY,EACP14F,EAAI,EAAGC,EAAIkzF,EAAQ7uF,OAAQtE,EAAIC,EAAGD,IAAK,CAC9C,IAAI6G,EAAM4sC,EAAO0/C,EAAQnzF,IAAIsE,OAC7B,GAAIuC,EAAM4xF,EAKR,OAAQtF,EAAQnzF,IACd,IAAK,WACH24F,EAAUllD,GACV,MAEF,IAAK,QACHwiD,EAASxiD,EAAQ,UAAWA,EAAOyiD,OACnCziD,EAAOyiD,MAAQ,GACf,MAEF,IAAK,SACHD,EAASxiD,EAAQ,WAAYA,EAAO6hD,QACpC7hD,EAAO6hD,OAAS,GAChB,MAEF,QACE/uF,EAAMktC,EAAQ,+BAAiC0/C,EAAQnzF,IAG7D04F,EAAYvjF,KAAKsB,IAAIiiF,EAAW7xF,GAGlC,IAAIzG,EAAI0xF,EAAIoB,kBAAoBwF,EAChCjlD,EAAO6/C,oBAAsBlzF,EAAIqzC,EAAOpsC,SA81CtCuxF,CArhBW11F,MAuhBb,OAvhBaA;uDAjzBbolF,OAAQ,WAAiC,OAAnBplF,KAAKqD,MAAQ,KAAarD,MAChDwgD,MAAO,WAAc,OAAOxgD,KAAKud,MAAM,OACvC+oE,MAAO,WAjBT,IAAuB/1C,EACrBklD,EADqBllD,EAiBavwC,MAfb,KAAjBuwC,EAAOyiD,QACTD,EAASxiD,EAAQ,UAAWA,EAAOyiD,OACnCziD,EAAOyiD,MAAQ,IAEK,KAAlBziD,EAAO6hD,SACTW,EAASxiD,EAAQ,WAAYA,EAAO6hD,QACpC7hD,EAAO6hD,OAAS,MAapB,IACEr9D,EAAS,EAAQ,IAAUA,OAC3B,MAAO4gE,GACP5gE,EAAS,aAGX,IAAI6gE,EAAchH,EAAI0C,OAAOn4E,OAAO,SAAUmsE,GAC5C,MAAc,UAAPA,GAAyB,QAAPA,IAO3B,SAASwK,EAAWH,EAAQC,GAC1B,KAAM5vF,gBAAgB8vF,GACpB,OAAO,IAAIA,EAAUH,EAAQC,GAG/B76D,EAAO71B,MAAMc,MAEbA,KAAK61F,QAAU,IAAIhG,EAAUF,EAAQC,GACrC5vF,KAAKkF,UAAW,EAChBlF,KAAKoI,UAAW,EAEhB,IAAI0tF,EAAK91F,KAETA,KAAK61F,QAAQvtF,MAAQ,WACnBwtF,EAAG70F,KAAK,QAGVjB,KAAK61F,QAAQ/jC,QAAU,SAAUxuD,GAC/BwyF,EAAG70F,KAAK,QAASqC,GAIjBwyF,EAAGD,QAAQxyF,MAAQ,MAGrBrD,KAAK+1F,SAAW,KAEhBH,EAAYtnF,QAAQ,SAAUg3E,GAC5B9nF,OAAOC,eAAeq4F,EAAI,KAAOxQ,EAAI,CACnC3nF,IAAK,WACH,OAAOm4F,EAAGD,QAAQ,KAAOvQ,IAE3BxiF,IAAK,SAAU48B,GACb,IAAKA,EAGH,OAFAo2D,EAAGpxF,mBAAmB4gF,GACtBwQ,EAAGD,QAAQ,KAAOvQ,GAAM5lD,EACjBA,EAETo2D,EAAGhyF,GAAGwhF,EAAI5lD,IAEZhiC,YAAY,EACZyH,cAAc,MAKpB2qF,EAAUpxF,UAAYlB,OAAOY,OAAO22B,EAAOr2B,UAAW,CACpDuG,YAAa,CACXlH,MAAO+xF,KAIXA,EAAUpxF,UAAU6e,MAAQ,SAAUpX,GACpC,GAAsB,mBAAX4U,GACkB,mBAApBA,EAAOD,UACdC,EAAOD,SAAS3U,GAAO,CACvB,IAAKnG,KAAK+1F,SAAU,CAClB,IAAIC,EAAK,EAAQ,IAAkB17D,cACnCt6B,KAAK+1F,SAAW,IAAIC,EAAG,QAEzB7vF,EAAOnG,KAAK+1F,SAASx4E,MAAMpX,GAK7B,OAFAnG,KAAK61F,QAAQt4E,MAAMpX,EAAKqF,YACxBxL,KAAKiB,KAAK,OAAQkF,IACX,GAGT2pF,EAAUpxF,UAAUiK,IAAM,SAAUiwB,GAKlC,OAJIA,GAASA,EAAMx3B,QACjBpB,KAAKud,MAAMqb,GAEb54B,KAAK61F,QAAQltF,OACN,GAGTmnF,EAAUpxF,UAAUoF,GAAK,SAAUwhF,EAAI5hF,GACrC,IAAIoyF,EAAK91F,KAST,OARK81F,EAAGD,QAAQ,KAAOvQ,KAAoC,IAA7BsQ,EAAYrnF,QAAQ+2E,KAChDwQ,EAAGD,QAAQ,KAAOvQ,GAAM,WACtB,IAAIjmF,EAA4B,IAArB6C,UAAUd,OAAe,CAACc,UAAU,IAAMO,MAAMvD,MAAM,KAAMgD,WACvE7C,EAAK4hC,OAAO,EAAG,EAAGqkD,GAClBwQ,EAAG70F,KAAK/B,MAAM42F,EAAIz2F,KAIf01B,EAAOr2B,UAAUoF,GAAG7G,KAAK64F,EAAIxQ,EAAI5hF,IAI1C,IAAImuF,EAAa,UAIbpiF,EAAS,aACTwmF,EAAS,uDAGT7C,EAAQ,MACR2B,EAAYlD,EAAa,IACzBiB,EAAQ,UACRI,EAAU,UACVgD,EAAgB,uCAChBC,EAAkB,gCAClBhF,EAAS,CAAEiF,IAAKF,EAAehF,MAAOiF,GAG1CtE,EAAawE,EAAUxE,GACvBpiF,EAAS4mF,EAAU5mF,GACnBwmF,EAASI,EAAUJ,GAQnB,IAAIxD,EAAY,4JAEZuB,EAAW,iMAEXsB,EAAc,6JACdD,EAAa,kMAKjB,SAASgB,EAAWp2E,GAClB,OAAOA,EAAI7Q,MAAM,IAAIkjB,OAAO,SAAUzzB,EAAG1B,GAEvC,OADA0B,EAAE1B,IAAK,EACA0B,GACN,IAOL,SAAS2zF,EAAI8D,EAAWn5F,GACtB,OALF,SAAmBA,GACjB,MAA6C,oBAAtCK,OAAOkB,UAAU8M,SAASvO,KAAKE,GAI/Bod,CAAS+7E,KAAen5F,EAAE4Q,MAAMuoF,GAAaA,EAAUn5F,GAGhE,SAASwlC,EAAK2zD,EAAWn5F,GACvB,OAAQq1F,EAAG8D,EAAWn5F,GAnBxBi2F,EAAQiD,EAAUjD,GAClB2B,EAAYsB,EAAUtB,GAqBtB,IAwqCQwB,EACAhxE,EACAixE,EA1qCJ/rB,EAAI,EAsTR,IAAK,IAAI5rE,KArTT+vF,EAAI6H,MAAQ,CACV5F,MAAOpmB,IACP+mB,iBAAkB/mB,IAClBinB,KAAMjnB,IACNsnB,YAAatnB,IACbunB,UAAWvnB,IACX6nB,UAAW7nB,IACX4oB,iBAAkB5oB,IAClByoB,QAASzoB,IACT8oB,eAAgB9oB,IAChB6oB,YAAa7oB,IACb+oB,mBAAoB/oB,IACpBisB,iBAAkBjsB,IAClBwoB,QAASxoB,IACTgpB,eAAgBhpB,IAChBipB,cAAejpB,IACfqoB,MAAOroB,IACPmpB,aAAcnpB,IACdopB,eAAgBppB,IAChBkoB,UAAWloB,IACXspB,eAAgBtpB,IAChBqpB,iBAAkBrpB,IAClBioB,SAAUjoB,IACV0pB,eAAgB1pB,IAChB2pB,OAAQ3pB,IACR+pB,YAAa/pB,IACbiqB,sBAAuBjqB,IACvBgqB,aAAchqB,IACdkqB,oBAAqBlqB,IACrBqqB,oBAAqBrqB,IACrBmqB,sBAAuBnqB,IACvBoqB,sBAAuBpqB,IACvBuqB,sBAAuBvqB,IACvB4nB,UAAW5nB,IACXwqB,oBAAqBxqB,IACrBynB,OAAQznB,IACR0nB,cAAe1nB,KAGjBmkB,EAAIoC,aAAe,CACjB,IAAO,IACP,GAAM,IACN,GAAM,IACN,KAAQ,IACR,KAAQ,KAGVpC,EAAImC,SAAW,CACb,IAAO,IACP,GAAM,IACN,GAAM,IACN,KAAQ,IACR,KAAQ,IACR,MAAS,IACT,OAAU,IACV,MAAS,IACT,OAAU,IACV,MAAS,IACT,OAAU,IACV,KAAQ,IACR,OAAU,IACV,IAAO,IACP,OAAU,IACV,MAAS,IACT,OAAU,IACV,KAAQ,IACR,OAAU,IACV,MAAS,IACT,OAAU,IACV,KAAQ,IACR,OAAU,IACV,OAAU,IACV,MAAS,IACT,OAAU,IACV,OAAU,IACV,OAAU,IACV,KAAQ,IACR,MAAS,IACT,OAAU,IACV,MAAS,IACT,OAAU,IACV,KAAQ,IACR,OAAU,IACV,OAAU,IACV,MAAS,IACT,MAAS,IACT,OAAU,IACV,MAAS,IACT,OAAU,IACV,KAAQ,IACR,OAAU,IACV,OAAU,IACV,MAAS,IACT,OAAU,IACV,IAAO,IACP,KAAQ,IACR,OAAU,IACV,MAAS,IACT,OAAU,IACV,KAAQ,IACR,OAAU,IACV,OAAU,IACV,MAAS,IACT,OAAU,IACV,OAAU,IACV,OAAU,IACV,KAAQ,IACR,MAAS,IACT,MAAS,IACT,OAAU,IACV,MAAS,IACT,OAAU,IACV,KAAQ,IACR,OAAU,IACV,KAAQ,IACR,KAAQ,IACR,IAAO,IACP,KAAQ,IACR,MAAS,IACT,KAAQ,IACR,MAAS,IACT,OAAU,IACV,IAAO,IACP,OAAU,IACV,KAAQ,IACR,IAAO,IACP,KAAQ,IACR,MAAS,IACT,IAAO,IACP,IAAO,IACP,KAAQ,IACR,IAAO,IACP,OAAU,IACV,KAAQ,IACR,KAAQ,IACR,KAAQ,IACR,MAAS,IACT,MAAS,IACT,KAAQ,IACR,OAAU,IACV,MAAS,IACT,KAAQ,IACR,MAAS,IACT,OAAU,IACV,OAAU,IACV,OAAU,IACV,OAAU,IACV,MAAS,IACT,OAAU,IACV,MAAS,IACT,MAAS,IACT,OAAU,IACV,OAAU,IACV,KAAQ,IACR,KAAQ,IACR,KAAQ,IACR,MAAS,IACT,MAAS,IACT,KAAQ,IACR,MAAS,IACT,MAAS,IACT,QAAW,IACX,KAAQ,IACR,IAAO,IACP,MAAS,IACT,KAAQ,IACR,MAAS,IACT,OAAU,IACV,GAAM,IACN,GAAM,IACN,GAAM,IACN,QAAW,IACX,GAAM,IACN,IAAO,IACP,MAAS,IACT,IAAO,IACP,QAAW,IACX,IAAO,IACP,IAAO,IACP,IAAO,IACP,MAAS,IACT,MAAS,IACT,KAAQ,IACR,MAAS,IACT,MAAS,IACT,QAAW,IACX,KAAQ,IACR,IAAO,IACP,MAAS,IACT,KAAQ,IACR,MAAS,IACT,OAAU,IACV,GAAM,IACN,GAAM,IACN,GAAM,IACN,QAAW,IACX,GAAM,IACN,IAAO,IACP,OAAU,IACV,MAAS,IACT,IAAO,IACP,QAAW,IACX,IAAO,IACP,IAAO,IACP,IAAO,IACP,MAAS,IACT,SAAY,IACZ,MAAS,IACT,IAAO,IACP,KAAQ,KACR,KAAQ,KACR,OAAU,KACV,KAAQ,KACR,IAAO,KACP,IAAO,KACP,IAAO,KACP,MAAS,KACT,MAAS,KACT,MAAS,KACT,MAAS,KACT,MAAS,KACT,MAAS,KACT,MAAS,KACT,MAAS,KACT,OAAU,KACV,OAAU,KACV,KAAQ,KACR,OAAU,KACV,OAAU,KACV,MAAS,KACT,MAAS,KACT,OAAU,KACV,OAAU,KACV,MAAS,KACT,MAAS,KACT,KAAQ,KACR,MAAS,KACT,OAAU,KACV,KAAQ,KACR,MAAS,KACT,QAAW,KACX,KAAQ,KACR,KAAQ,KACR,KAAQ,KACR,KAAQ,KACR,KAAQ,KACR,MAAS,KACT,KAAQ,KACR,KAAQ,KACR,KAAQ,KACR,KAAQ,KACR,KAAQ,KACR,OAAU,KACV,KAAQ,KACR,MAAS,KACT,MAAS,KACT,MAAS,KACT,KAAQ,KACR,MAAS,KACT,GAAM,KACN,KAAQ,KACR,IAAO,KACP,MAAS,KACT,OAAU,KACV,MAAS,KACT,KAAQ,KACR,MAAS,KACT,IAAO,KACP,IAAO,KACP,GAAM,KACN,IAAO,KACP,IAAO,KACP,IAAO,KACP,OAAU,KACV,IAAO,KACP,KAAQ,KACR,MAAS,KACT,GAAM,KACN,MAAS,KACT,GAAM,KACN,GAAM,KACN,IAAO,KACP,IAAO,KACP,KAAQ,KACR,KAAQ,KACR,KAAQ,KACR,MAAS,KACT,OAAU,KACV,KAAQ,KACR,KAAQ,KACR,MAAS,KACT,MAAS,KACT,OAAU,KACV,OAAU,KACV,KAAQ,KACR,KAAQ,KACR,IAAO,KACP,OAAU,KACV,MAAS,KACT,OAAU,KACV,MAAS,MAGXvzF,OAAOmH,KAAKiqF,EAAImC,UAAUziF,QAAQ,SAAUjQ,GAC1C,IAAIkJ,EAAIqnF,EAAImC,SAAS1yF,GACjBQ,EAAiB,iBAAN0I,EAAiB/F,OAAO8f,aAAa/Z,GAAKA,EACzDqnF,EAAImC,SAAS1yF,GAAOQ,IAGR+vF,EAAI6H,MAChB7H,EAAI6H,MAAM7H,EAAI6H,MAAM53F,IAAMA,EAM5B,SAASoC,EAAMsvC,EAAQhlB,EAAOplB,GAC5BoqC,EAAOhlB,IAAUglB,EAAOhlB,GAAOplB,GAGjC,SAAS4sF,EAAUxiD,EAAQomD,EAAUxwF,GAC/BoqC,EAAOqhD,UAAU6D,EAAUllD,GAC/BtvC,EAAKsvC,EAAQomD,EAAUxwF,GAGzB,SAASsvF,EAAWllD,GAClBA,EAAOqhD,SAAW+B,EAASpjD,EAAOq/C,IAAKr/C,EAAOqhD,UAC1CrhD,EAAOqhD,UAAU3wF,EAAKsvC,EAAQ,SAAUA,EAAOqhD,UACnDrhD,EAAOqhD,SAAW,GAGpB,SAAS+B,EAAU/D,EAAK/0D,GAGtB,OAFI+0D,EAAI7oE,OAAM8T,EAAOA,EAAK9T,QACtB6oE,EAAIp0C,YAAW3gB,EAAOA,EAAKnsB,QAAQ,OAAQ,MACxCmsB,EAGT,SAASx3B,EAAOktC,EAAQjtC,GAUtB,OATAmyF,EAAUllD,GACNA,EAAO6gD,gBACT9tF,GAAM,WAAaitC,EAAO5d,KACxB,aAAe4d,EAAO8gD,OACtB,WAAa9gD,EAAOpzC,GAExBmG,EAAK,IAAI/B,MAAM+B,GACfitC,EAAOltC,MAAQC,EACfrC,EAAKsvC,EAAQ,UAAWjtC,GACjBitC,EAGT,SAAS5nC,EAAK4nC,GAYZ,OAXIA,EAAOogD,UAAYpgD,EAAOmgD,YAAYoB,EAAWvhD,EAAQ,qBACxDA,EAAOzuC,QAAU2oE,EAAEomB,OACrBtgD,EAAOzuC,QAAU2oE,EAAE+mB,kBACnBjhD,EAAOzuC,QAAU2oE,EAAEinB,MACpBruF,EAAMktC,EAAQ,kBAEhBklD,EAAUllD,GACVA,EAAOpzC,EAAI,GACXozC,EAAOkgD,QAAS,EAChBxvF,EAAKsvC,EAAQ,SACbs/C,EAAU5yF,KAAKszC,EAAQA,EAAOo/C,OAAQp/C,EAAOq/C,KACtCr/C,EAGT,SAASuhD,EAAYvhD,EAAQ/sC,GAC3B,GAAsB,iBAAX+sC,KAAyBA,aAAkBs/C,GACpD,MAAM,IAAItuF,MAAM,0BAEdgvC,EAAOo/C,QACTtsF,EAAMktC,EAAQ/sC,GAIlB,SAASywF,EAAQ1jD,GACVA,EAAOo/C,SAAQp/C,EAAOhpB,QAAUgpB,EAAOhpB,QAAQgpB,EAAOggD,cAC3D,IAAIl6E,EAASk6B,EAAOigD,KAAKjgD,EAAOigD,KAAKpvF,OAAS,IAAMmvC,EAChDqrC,EAAMrrC,EAAOqrC,IAAM,CAAEv+E,KAAMkzC,EAAOhpB,QAASoxD,WAAY,IAGvDpoC,EAAOq/C,IAAIsB,QACbtV,EAAIz9E,GAAKkY,EAAOlY,IAElBoyC,EAAO0gD,WAAW7vF,OAAS,EAG7B,SAASi+E,EAAOhiF,EAAMu5F,GACpB,IACIC,EADIx5F,EAAKkR,QAAQ,KACF,EAAI,CAAE,GAAIlR,GAASA,EAAK+R,MAAM,KAC7CgrC,EAASy8C,EAAS,GAClB1/B,EAAQ0/B,EAAS,GAQrB,OALID,GAAsB,UAATv5F,IACf+8C,EAAS,QACT+c,EAAQ,IAGH,CAAE/c,OAAQA,EAAQ+c,MAAOA,GAGlC,SAASklB,EAAQ9rC,GAKf,GAJKA,EAAOo/C,SACVp/C,EAAO+jD,WAAa/jD,EAAO+jD,WAAW/jD,EAAOggD,eAGO,IAAlDhgD,EAAO0gD,WAAW1iF,QAAQgiC,EAAO+jD,aACnC/jD,EAAOqrC,IAAIjD,WAAWh6E,eAAe4xC,EAAO+jD,YAC5C/jD,EAAO+jD,WAAa/jD,EAAOgkD,YAAc,OAF3C,CAMA,GAAIhkD,EAAOq/C,IAAIsB,MAAO,CACpB,IAAI4F,EAAKzX,EAAM9uC,EAAO+jD,YAAY,GAC9Bl6C,EAAS08C,EAAG18C,OACZ+c,EAAQ2/B,EAAG3/B,MAEf,GAAe,UAAX/c,EAEF,GAAc,QAAV+c,GAAmB5mB,EAAOgkD,cAAgB2B,EAC5CpE,EAAWvhD,EACT,gCAAkC2lD,EAAgB,aACrC3lD,EAAOgkD,kBACjB,GAAc,UAAVp9B,GAAqB5mB,EAAOgkD,cAAgB4B,EACrDrE,EAAWvhD,EACT,kCAAoC4lD,EAAkB,aACzC5lD,EAAOgkD,iBACjB,CACL,IAAI3Y,EAAMrrC,EAAOqrC,IACbvlE,EAASk6B,EAAOigD,KAAKjgD,EAAOigD,KAAKpvF,OAAS,IAAMmvC,EAChDqrC,EAAIz9E,KAAOkY,EAAOlY,KACpBy9E,EAAIz9E,GAAKX,OAAOY,OAAOiY,EAAOlY,KAEhCy9E,EAAIz9E,GAAGg5D,GAAS5mB,EAAOgkD,YAO3BhkD,EAAO0gD,WAAW9vF,KAAK,CAACovC,EAAO+jD,WAAY/jD,EAAOgkD,mBAGlDhkD,EAAOqrC,IAAIjD,WAAWpoC,EAAO+jD,YAAc/jD,EAAOgkD,YAClDxB,EAASxiD,EAAQ,cAAe,CAC9BlzC,KAAMkzC,EAAO+jD,WACbv2F,MAAOwyC,EAAOgkD,cAIlBhkD,EAAO+jD,WAAa/jD,EAAOgkD,YAAc,IAG3C,SAASL,EAAS3jD,EAAQwmD,GACxB,GAAIxmD,EAAOq/C,IAAIsB,MAAO,CAEpB,IAAItV,EAAMrrC,EAAOqrC,IAGbkb,EAAKzX,EAAM9uC,EAAOhpB,SACtBq0D,EAAIxhC,OAAS08C,EAAG18C,OAChBwhC,EAAIzkB,MAAQ2/B,EAAG3/B,MACfykB,EAAI5wE,IAAM4wE,EAAIz9E,GAAG24F,EAAG18C,SAAW,GAE3BwhC,EAAIxhC,SAAWwhC,EAAI5wE,MACrB8mF,EAAWvhD,EAAQ,6BACjBviC,KAAKC,UAAUsiC,EAAOhpB,UACxBq0D,EAAI5wE,IAAM8rF,EAAG18C,QAGf,IAAI/jC,EAASk6B,EAAOigD,KAAKjgD,EAAOigD,KAAKpvF,OAAS,IAAMmvC,EAChDqrC,EAAIz9E,IAAMkY,EAAOlY,KAAOy9E,EAAIz9E,IAC9BX,OAAOmH,KAAKi3E,EAAIz9E,IAAImQ,QAAQ,SAAU1P,GACpCm0F,EAASxiD,EAAQ,kBAAmB,CAClC6J,OAAQx7C,EACRoM,IAAK4wE,EAAIz9E,GAAGS,OAQlB,IAAK,IAAI9B,EAAI,EAAGC,EAAIwzC,EAAO0gD,WAAW7vF,OAAQtE,EAAIC,EAAGD,IAAK,CACxD,IAAI0oC,EAAK+K,EAAO0gD,WAAWn0F,GACvBO,EAAOmoC,EAAG,GACVznC,EAAQynC,EAAG,GACXqxD,EAAWxX,EAAMhiF,GAAM,GACvB+8C,EAASy8C,EAASz8C,OAClB+c,EAAQ0/B,EAAS1/B,MACjBnsD,EAAiB,KAAXovC,EAAgB,GAAMwhC,EAAIz9E,GAAGi8C,IAAW,GAC9CxrC,EAAI,CACNvR,KAAMA,EACNU,MAAOA,EACPq8C,OAAQA,EACR+c,MAAOA,EACPnsD,IAAKA,GAKHovC,GAAqB,UAAXA,IAAuBpvC,IACnC8mF,EAAWvhD,EAAQ,6BACjBviC,KAAKC,UAAUmsC,IACjBxrC,EAAE5D,IAAMovC,GAEV7J,EAAOqrC,IAAIjD,WAAWt7E,GAAQuR,EAC9BmkF,EAASxiD,EAAQ,cAAe3hC,GAElC2hC,EAAO0gD,WAAW7vF,OAAS,EAG7BmvC,EAAOqrC,IAAIob,gBAAkBD,EAG7BxmD,EAAOogD,SAAU,EACjBpgD,EAAOigD,KAAKrvF,KAAKovC,EAAOqrC,KACxBmX,EAASxiD,EAAQ,YAAaA,EAAOqrC,KAChCmb,IAEExmD,EAAOqgD,UAA6C,WAAjCrgD,EAAOhpB,QAAQrJ,cAGrCqyB,EAAOzuC,MAAQ2oE,EAAEinB,KAFjBnhD,EAAOzuC,MAAQ2oE,EAAEynB,OAInB3hD,EAAOqrC,IAAM,KACbrrC,EAAOhpB,QAAU,IAEnBgpB,EAAO+jD,WAAa/jD,EAAOgkD,YAAc,GACzChkD,EAAO0gD,WAAW7vF,OAAS,EAG7B,SAASizF,EAAU9jD,GACjB,IAAKA,EAAOhpB,QAIV,OAHAuqE,EAAWvhD,EAAQ,0BACnBA,EAAOqhD,UAAY,WACnBrhD,EAAOzuC,MAAQ2oE,EAAEinB,MAInB,GAAInhD,EAAO6hD,OAAQ,CACjB,GAAuB,WAAnB7hD,EAAOhpB,QAIT,OAHAgpB,EAAO6hD,QAAU,KAAO7hD,EAAOhpB,QAAU,IACzCgpB,EAAOhpB,QAAU,QACjBgpB,EAAOzuC,MAAQ2oE,EAAEynB,QAGnBa,EAASxiD,EAAQ,WAAYA,EAAO6hD,QACpC7hD,EAAO6hD,OAAS,GAKlB,IAAIp0F,EAAIuyC,EAAOigD,KAAKpvF,OAChBmmB,EAAUgpB,EAAOhpB,QAChBgpB,EAAOo/C,SACVpoE,EAAUA,EAAQgpB,EAAOggD,cAG3B,IADA,IAAI0G,EAAU1vE,EACPvpB,KAAK,CAEV,GADYuyC,EAAOigD,KAAKxyF,GACdX,OAAS45F,EAIjB,MAFAnF,EAAWvhD,EAAQ,wBAOvB,GAAIvyC,EAAI,EAIN,OAHA8zF,EAAWvhD,EAAQ,0BAA4BA,EAAOhpB,SACtDgpB,EAAOqhD,UAAY,KAAOrhD,EAAOhpB,QAAU,SAC3CgpB,EAAOzuC,MAAQ2oE,EAAEinB,MAGnBnhD,EAAOhpB,QAAUA,EAEjB,IADA,IAAI1oB,EAAI0xC,EAAOigD,KAAKpvF,OACbvC,KAAMb,GAAG,CACd,IAAI49E,EAAMrrC,EAAOqrC,IAAMrrC,EAAOigD,KAAKjsF,MACnCgsC,EAAOhpB,QAAUgpB,EAAOqrC,IAAIv+E,KAC5B01F,EAASxiD,EAAQ,aAAcA,EAAOhpB,SAEtC,IAAI7N,EAAI,GACR,IAAK,IAAI5c,KAAK8+E,EAAIz9E,GAChBub,EAAE5c,GAAK8+E,EAAIz9E,GAAGrB,GAGhB,IAAIuZ,EAASk6B,EAAOigD,KAAKjgD,EAAOigD,KAAKpvF,OAAS,IAAMmvC,EAChDA,EAAOq/C,IAAIsB,OAAStV,EAAIz9E,KAAOkY,EAAOlY,IAExCX,OAAOmH,KAAKi3E,EAAIz9E,IAAImQ,QAAQ,SAAU1P,GACpC,IAAIL,EAAIq9E,EAAIz9E,GAAGS,GACfm0F,EAASxiD,EAAQ,mBAAoB,CAAE6J,OAAQx7C,EAAGoM,IAAKzM,MAInD,IAANP,IAASuyC,EAAOmgD,YAAa,GACjCngD,EAAOhpB,QAAUgpB,EAAOgkD,YAAchkD,EAAO+jD,WAAa,GAC1D/jD,EAAO0gD,WAAW7vF,OAAS,EAC3BmvC,EAAOzuC,MAAQ2oE,EAAEinB,KAGnB,SAASyD,EAAa5kD,GACpB,IAEI5iB,EAFAynE,EAAS7kD,EAAO6kD,OAChB8B,EAAW9B,EAAOl3E,cAElBi5E,EAAS,GAEb,OAAI5mD,EAAOwgD,SAASqE,GACX7kD,EAAOwgD,SAASqE,GAErB7kD,EAAOwgD,SAASmG,GACX3mD,EAAOwgD,SAASmG,IAGA,OADzB9B,EAAS8B,GACEn3D,OAAO,KACS,MAArBq1D,EAAOr1D,OAAO,IAChBq1D,EAASA,EAAO/lF,MAAM,GAEtB8nF,GADAxpE,EAAMxgB,SAASioF,EAAQ,KACV5pF,SAAS,MAEtB4pF,EAASA,EAAO/lF,MAAM,GAEtB8nF,GADAxpE,EAAMxgB,SAASioF,EAAQ,KACV5pF,SAAS,MAG1B4pF,EAASA,EAAO1mF,QAAQ,MAAO,IAC3ByoF,EAAOj5E,gBAAkBk3E,GAC3BtD,EAAWvhD,EAAQ,4BACZ,IAAMA,EAAO6kD,OAAS,KAGxB5zF,OAAOg1F,cAAc7oE,IAG9B,SAAS8jE,EAAiBlhD,EAAQpzC,GACtB,MAANA,GACFozC,EAAOzuC,MAAQ2oE,EAAEunB,UACjBzhD,EAAO0hD,iBAAmB1hD,EAAOpsC,UACxBw+B,EAAIkvD,EAAY10F,KAGzB20F,EAAWvhD,EAAQ,oCACnBA,EAAOqhD,SAAWz0F,EAClBozC,EAAOzuC,MAAQ2oE,EAAEinB,MA3UrBjnB,EAAImkB,EAAI6H,MA22BHj1F,OAAOg1F,gBAEJD,EAAqB/0F,OAAO8f,aAC5BiE,EAAQtT,KAAKsT,MACbixE,EAAgB,WAClB,IAEIY,EACAC,EAHAC,EAAW,MACXC,EAAY,GAGZjzF,GAAS,EACTlD,EAASc,UAAUd,OACvB,IAAKA,EACH,MAAO,GAGT,IADA,IAAIgM,EAAS,KACJ9I,EAAQlD,GAAQ,CACvB,IAAI8f,EAAYthB,OAAOsC,UAAUoC,IACjC,IACGye,SAAS7B,IACVA,EAAY,GACZA,EAAY,SACZqE,EAAMrE,KAAeA,EAErB,MAAMle,WAAW,uBAAyBke,GAExCA,GAAa,MACfq2E,EAAUp2F,KAAK+f,IAIfk2E,EAAoC,QADpCl2E,GAAa,QACiB,IAC9Bm2E,EAAgBn2E,EAAY,KAAS,MACrCq2E,EAAUp2F,KAAKi2F,EAAeC,KAE5B/yF,EAAQ,IAAMlD,GAAUm2F,EAAUn2F,OAASk2F,KAC7ClqF,GAAUmpF,EAAmBr3F,MAAM,KAAMq4F,GACzCA,EAAUn2F,OAAS,GAGvB,OAAOgM,GAEL5P,OAAOC,eACTD,OAAOC,eAAe+D,OAAQ,gBAAiB,CAC7CzD,MAAOy4F,EACPrxF,cAAc,EACdD,UAAU,IAGZ1D,OAAOg1F,cAAgBA,GAthD9B,CA0hDmD55F,K,sDCxhDpDA,EAAQogB,WAuCR,SAAqBu1B,GACnB,IAAIilD,EAAOC,EAAQllD,GACfmlD,EAAWF,EAAK,GAChBG,EAAkBH,EAAK,GAC3B,OAAuC,GAA9BE,EAAWC,GAAuB,EAAKA,GA1ClD/6F,EAAQkqB,YAiDR,SAAsByrB,GACpB,IAAItlB,EAcAnwB,EAbA06F,EAAOC,EAAQllD,GACfmlD,EAAWF,EAAK,GAChBG,EAAkBH,EAAK,GAEvBj1F,EAAM,IAAIq1F,EAVhB,SAAsBrlD,EAAKmlD,EAAUC,GACnC,OAAuC,GAA9BD,EAAWC,GAAuB,EAAKA,EAS9BE,CAAYtlD,EAAKmlD,EAAUC,IAEzCG,EAAU,EAGVn0F,EAAMg0F,EAAkB,EACxBD,EAAW,EACXA,EAGJ,IAAK56F,EAAI,EAAGA,EAAI6G,EAAK7G,GAAK,EACxBmwB,EACG8qE,EAAUxlD,EAAIpyB,WAAWrjB,KAAO,GAChCi7F,EAAUxlD,EAAIpyB,WAAWrjB,EAAI,KAAO,GACpCi7F,EAAUxlD,EAAIpyB,WAAWrjB,EAAI,KAAO,EACrCi7F,EAAUxlD,EAAIpyB,WAAWrjB,EAAI,IAC/ByF,EAAIu1F,KAAc7qE,GAAO,GAAM,IAC/B1qB,EAAIu1F,KAAc7qE,GAAO,EAAK,IAC9B1qB,EAAIu1F,KAAmB,IAAN7qE,EAGK,IAApB0qE,IACF1qE,EACG8qE,EAAUxlD,EAAIpyB,WAAWrjB,KAAO,EAChCi7F,EAAUxlD,EAAIpyB,WAAWrjB,EAAI,KAAO,EACvCyF,EAAIu1F,KAAmB,IAAN7qE,GAGK,IAApB0qE,IACF1qE,EACG8qE,EAAUxlD,EAAIpyB,WAAWrjB,KAAO,GAChCi7F,EAAUxlD,EAAIpyB,WAAWrjB,EAAI,KAAO,EACpCi7F,EAAUxlD,EAAIpyB,WAAWrjB,EAAI,KAAO,EACvCyF,EAAIu1F,KAAc7qE,GAAO,EAAK,IAC9B1qB,EAAIu1F,KAAmB,IAAN7qE,GAGnB,OAAO1qB,GA3FT3F,EAAQgkB,cAkHR,SAAwBo3E,GAQtB,IAPA,IAAI/qE,EACAtpB,EAAMq0F,EAAM52F,OACZ62F,EAAat0F,EAAM,EACnBwL,EAAQ,GAIHrS,EAAI,EAAGo7F,EAAOv0F,EAAMs0F,EAAYn7F,EAAIo7F,EAAMp7F,GAH9B,MAInBqS,EAAMhO,KAAKg3F,EACTH,EAAOl7F,EAAIA,EALM,MAKgBo7F,EAAOA,EAAQp7F,EAL/B,QAUF,IAAfm7F,GACFhrE,EAAM+qE,EAAMr0F,EAAM,GAClBwL,EAAMhO,KACJi3F,EAAOnrE,GAAO,GACdmrE,EAAQnrE,GAAO,EAAK,IACpB,OAEsB,IAAfgrE,IACThrE,GAAO+qE,EAAMr0F,EAAM,IAAM,GAAKq0F,EAAMr0F,EAAM,GAC1CwL,EAAMhO,KACJi3F,EAAOnrE,GAAO,IACdmrE,EAAQnrE,GAAO,EAAK,IACpBmrE,EAAQnrE,GAAO,EAAK,IACpB,MAIJ,OAAO9d,EAAM9C,KAAK,KA3IpB,IALA,IAAI+rF,EAAS,GACTL,EAAY,GACZH,EAA4B,oBAAfl7E,WAA6BA,WAAaja,MAEvDikB,EAAO,mEACF5pB,EAAI,EAAG6G,EAAM+iB,EAAKtlB,OAAQtE,EAAI6G,IAAO7G,EAC5Cs7F,EAAOt7F,GAAK4pB,EAAK5pB,GACjBi7F,EAAUrxE,EAAKvG,WAAWrjB,IAAMA,EAQlC,SAAS26F,EAASllD,GAChB,IAAI5uC,EAAM4uC,EAAInxC,OAEd,GAAIuC,EAAM,EAAI,EACZ,MAAM,IAAIpC,MAAM,kDAKlB,IAAIm2F,EAAWnlD,EAAIhkC,QAAQ,KAO3B,OANkB,IAAdmpF,IAAiBA,EAAW/zF,GAMzB,CAAC+zF,EAJcA,IAAa/zF,EAC/B,EACA,EAAK+zF,EAAW,GAsEtB,SAASS,EAAaH,EAAO55E,EAAOzV,GAGlC,IAFA,IAAIskB,EARoBU,EASpBsE,EAAS,GACJn1B,EAAIshB,EAAOthB,EAAI6L,EAAK7L,GAAK,EAChCmwB,GACI+qE,EAAMl7F,IAAM,GAAM,WAClBk7F,EAAMl7F,EAAI,IAAM,EAAK,QACP,IAAfk7F,EAAMl7F,EAAI,IACbm1B,EAAO9wB,KAdFi3F,GADiBzqE,EAeMV,IAdT,GAAK,IACxBmrE,EAAOzqE,GAAO,GAAK,IACnByqE,EAAOzqE,GAAO,EAAI,IAClByqE,EAAa,GAANzqE,IAaT,OAAOsE,EAAO5lB,KAAK,IAjGrB0rF,EAAU,IAAI53E,WAAW,IAAM,GAC/B43E,EAAU,IAAI53E,WAAW,IAAM,I,cCnB/BvjB,EAAQsiB,KAAO,SAAUxB,EAAQ+B,EAAQ44E,EAAMC,EAAMC,GACnD,IAAIhxF,EAAGrK,EACHs7F,EAAiB,EAATD,EAAcD,EAAO,EAC7BG,GAAQ,GAAKD,GAAQ,EACrBE,EAAQD,GAAQ,EAChBE,GAAS,EACT77F,EAAIu7F,EAAQE,EAAS,EAAK,EAC1Bn7F,EAAIi7F,GAAQ,EAAI,EAChBx5F,EAAI6e,EAAO+B,EAAS3iB,GAOxB,IALAA,GAAKM,EAELmK,EAAI1I,GAAM,IAAO85F,GAAU,EAC3B95F,KAAQ85F,EACRA,GAASH,EACFG,EAAQ,EAAGpxF,EAAS,IAAJA,EAAWmW,EAAO+B,EAAS3iB,GAAIA,GAAKM,EAAGu7F,GAAS,GAKvE,IAHAz7F,EAAIqK,GAAM,IAAOoxF,GAAU,EAC3BpxF,KAAQoxF,EACRA,GAASL,EACFK,EAAQ,EAAGz7F,EAAS,IAAJA,EAAWwgB,EAAO+B,EAAS3iB,GAAIA,GAAKM,EAAGu7F,GAAS,GAEvE,GAAU,IAANpxF,EACFA,EAAI,EAAImxF,MACH,IAAInxF,IAAMkxF,EACf,OAAOv7F,EAAI07F,IAAsBhyE,KAAd/nB,GAAK,EAAI,GAE5B3B,GAAQ+U,KAAKwS,IAAI,EAAG6zE,GACpB/wF,GAAQmxF,EAEV,OAAQ75F,GAAK,EAAI,GAAK3B,EAAI+U,KAAKwS,IAAI,EAAGld,EAAI+wF,IAG5C17F,EAAQ2gB,MAAQ,SAAUG,EAAQ3f,EAAO0hB,EAAQ44E,EAAMC,EAAMC,GAC3D,IAAIhxF,EAAGrK,EAAGC,EACNq7F,EAAiB,EAATD,EAAcD,EAAO,EAC7BG,GAAQ,GAAKD,GAAQ,EACrBE,EAAQD,GAAQ,EAChBI,EAAe,KAATP,EAAcrmF,KAAKwS,IAAI,GAAI,IAAMxS,KAAKwS,IAAI,GAAI,IAAM,EAC1D3nB,EAAIu7F,EAAO,EAAKE,EAAS,EACzBn7F,EAAIi7F,EAAO,GAAK,EAChBx5F,EAAId,EAAQ,GAAgB,IAAVA,GAAe,EAAIA,EAAQ,EAAK,EAAI,EAmC1D,IAjCAA,EAAQkU,KAAK4G,IAAI9a,GAEb8B,MAAM9B,IAAUA,IAAU6oB,KAC5B1pB,EAAI2C,MAAM9B,GAAS,EAAI,EACvBwJ,EAAIkxF,IAEJlxF,EAAI0K,KAAKsT,MAAMtT,KAAK0hB,IAAI51B,GAASkU,KAAK6mF,KAClC/6F,GAASZ,EAAI8U,KAAKwS,IAAI,GAAIld,IAAM,IAClCA,IACApK,GAAK,IAGLY,GADEwJ,EAAImxF,GAAS,EACNG,EAAK17F,EAEL07F,EAAK5mF,KAAKwS,IAAI,EAAG,EAAIi0E,IAEpBv7F,GAAK,IACfoK,IACApK,GAAK,GAGHoK,EAAImxF,GAASD,GACfv7F,EAAI,EACJqK,EAAIkxF,GACKlxF,EAAImxF,GAAS,GACtBx7F,GAAMa,EAAQZ,EAAK,GAAK8U,KAAKwS,IAAI,EAAG6zE,GACpC/wF,GAAQmxF,IAERx7F,EAAIa,EAAQkU,KAAKwS,IAAI,EAAGi0E,EAAQ,GAAKzmF,KAAKwS,IAAI,EAAG6zE,GACjD/wF,EAAI,IAID+wF,GAAQ,EAAG56E,EAAO+B,EAAS3iB,GAAS,IAAJI,EAAUJ,GAAKM,EAAGF,GAAK,IAAKo7F,GAAQ,GAI3E,IAFA/wF,EAAKA,GAAK+wF,EAAQp7F,EAClBs7F,GAAQF,EACDE,EAAO,EAAG96E,EAAO+B,EAAS3iB,GAAS,IAAJyK,EAAUzK,GAAKM,EAAGmK,GAAK,IAAKixF,GAAQ,GAE1E96E,EAAO+B,EAAS3iB,EAAIM,IAAU,IAAJyB,I,cClF5B,IAAI2M,EAAW,GAAGA,SAElB3O,EAAOD,QAAU6F,MAAM2L,SAAW,SAAU7L,GAC1C,MAA6B,kBAAtBiJ,EAASvO,KAAKsF,K,gBCkBvB1F,EAAOD,QAAUm4B,EAEjB,IAAIgkE,EAAK,EAAQ,GAAUj5F,aAkB3B,SAASi1B,IACPgkE,EAAG97F,KAAK+C,MAlBK,EAAQ,EAEvB8H,CAASitB,EAAQgkE,GACjBhkE,EAAOhtB,SAAW,EAAQ,IAC1BgtB,EAAO/sB,SAAW,EAAQ,IAC1B+sB,EAAOntB,OAAS,EAAQ,IACxBmtB,EAAOC,UAAY,EAAQ,IAC3BD,EAAOE,YAAc,EAAQ,IAG7BF,EAAOA,OAASA,EAWhBA,EAAOr2B,UAAU66B,KAAO,SAAS4qD,EAAMh8E,GACrC,IAAI+0B,EAASl9B,KAEb,SAAS+kF,EAAOnsD,GACVurD,EAAKj/E,WACH,IAAUi/E,EAAK5mE,MAAMqb,IAAUsE,EAAOioD,OACxCjoD,EAAOioD,QAOb,SAASL,IACH5nD,EAAO90B,UAAY80B,EAAOkoD,QAC5BloD,EAAOkoD,SAJXloD,EAAOp5B,GAAG,OAAQihF,GAQlBZ,EAAKrgF,GAAG,QAASghF,GAIZX,EAAK6U,UAAc7wF,IAA2B,IAAhBA,EAAQQ,MACzCu0B,EAAOp5B,GAAG,MAAOwE,GACjB40B,EAAOp5B,GAAG,QAAS8gF,IAGrB,IAAIqU,GAAW,EACf,SAAS3wF,IACH2wF,IACJA,GAAW,EAEX9U,EAAKx7E,OAIP,SAASi8E,IACHqU,IACJA,GAAW,EAEiB,mBAAjB9U,EAAKx1D,SAAwBw1D,EAAKx1D,WAI/C,SAASmjC,EAAQxuD,GAEf,GADA41F,IACwC,IAApCH,EAAGn2F,cAAc5C,KAAM,SACzB,MAAMsD,EAQV,SAAS41F,IACPh8D,EAAO/6B,eAAe,OAAQ4iF,GAC9BZ,EAAKhiF,eAAe,QAAS2iF,GAE7B5nD,EAAO/6B,eAAe,MAAOmG,GAC7B40B,EAAO/6B,eAAe,QAASyiF,GAE/B1nD,EAAO/6B,eAAe,QAAS2vD,GAC/BqyB,EAAKhiF,eAAe,QAAS2vD,GAE7B50B,EAAO/6B,eAAe,MAAO+2F,GAC7Bh8D,EAAO/6B,eAAe,QAAS+2F,GAE/B/U,EAAKhiF,eAAe,QAAS+2F,GAW/B,OA5BAh8D,EAAOp5B,GAAG,QAASguD,GACnBqyB,EAAKrgF,GAAG,QAASguD,GAmBjB50B,EAAOp5B,GAAG,MAAOo1F,GACjBh8D,EAAOp5B,GAAG,QAASo1F,GAEnB/U,EAAKrgF,GAAG,QAASo1F,GAEjB/U,EAAKljF,KAAK,OAAQi8B,GAGXinD,I,cC7HT,IAAI34E,EAAW,GAAGA,SAElB3O,EAAOD,QAAU6F,MAAM2L,SAAW,SAAU7L,GAC1C,MAA6B,kBAAtBiJ,EAASvO,KAAKsF,K,6CCCvB,IAAIwY,EAAS,EAAQ,IAAeA,OAChClT,EAAO,EAAQ,IAMnBhL,EAAOD,QAAU,WACf,SAASukF,KAVX,SAAyBj2E,EAAUiuF,GAAe,KAAMjuF,aAAoBiuF,GAAgB,MAAM,IAAIp4F,UAAU,qCAW5Gq4F,CAAgBp5F,KAAMmhF,GAEtBnhF,KAAKkjF,KAAO,KACZljF,KAAKgtB,KAAO,KACZhtB,KAAKoB,OAAS,EAqDhB,OAlDA+/E,EAAWziF,UAAUyC,KAAO,SAAc8G,GACxC,IAAIstB,EAAQ,CAAEpvB,KAAM8B,EAAGqtB,KAAM,MACzBt1B,KAAKoB,OAAS,EAAGpB,KAAKgtB,KAAKsI,KAAOC,EAAWv1B,KAAKkjF,KAAO3tD,EAC7Dv1B,KAAKgtB,KAAOuI,IACVv1B,KAAKoB,QAGT+/E,EAAWziF,UAAUwC,QAAU,SAAiB+G,GAC9C,IAAIstB,EAAQ,CAAEpvB,KAAM8B,EAAGqtB,KAAMt1B,KAAKkjF,MACd,IAAhBljF,KAAKoB,SAAcpB,KAAKgtB,KAAOuI,GACnCv1B,KAAKkjF,KAAO3tD,IACVv1B,KAAKoB,QAGT+/E,EAAWziF,UAAU2F,MAAQ,WAC3B,GAAoB,IAAhBrE,KAAKoB,OAAT,CACA,IAAIoB,EAAMxC,KAAKkjF,KAAK/8E,KAGpB,OAFoB,IAAhBnG,KAAKoB,OAAcpB,KAAKkjF,KAAOljF,KAAKgtB,KAAO,KAAUhtB,KAAKkjF,KAAOljF,KAAKkjF,KAAK5tD,OAC7Et1B,KAAKoB,OACAoB,IAGT2+E,EAAWziF,UAAUq3E,MAAQ,WAC3B/1E,KAAKkjF,KAAOljF,KAAKgtB,KAAO,KACxBhtB,KAAKoB,OAAS,GAGhB+/E,EAAWziF,UAAU2N,KAAO,SAAcxN,GACxC,GAAoB,IAAhBmB,KAAKoB,OAAc,MAAO,GAG9B,IAFA,IAAIxC,EAAIoB,KAAKkjF,KACT1gF,EAAM,GAAK5D,EAAEuH,KACVvH,EAAIA,EAAE02B,MACX9yB,GAAO3D,EAAID,EAAEuH,KACd,OAAO3D,GAGV2+E,EAAWziF,UAAUgB,OAAS,SAAgBnB,GAC5C,GAAoB,IAAhByB,KAAKoB,OAAc,OAAO2Z,EAAO0G,MAAM,GAC3C,GAAoB,IAAhBzhB,KAAKoB,OAAc,OAAOpB,KAAKkjF,KAAK/8E,KAIxC,IAHA,IApDgBgI,EAAKhP,EAAQsgB,EAoDzBjd,EAAMuY,EAAO8B,YAAYte,IAAM,GAC/BK,EAAIoB,KAAKkjF,KACTpmF,EAAI,EACD8B,GAvDSuP,EAwDHvP,EAAEuH,KAxDMhH,EAwDAqD,EAxDQid,EAwDH3iB,EAvD5BqR,EAAItL,KAAK1D,EAAQsgB,GAwDb3iB,GAAK8B,EAAEuH,KAAK/E,OACZxC,EAAIA,EAAE02B,KAER,OAAO9yB,GAGF2+E,EA3DQ,GA8Dbt5E,GAAQA,EAAK4a,SAAW5a,EAAK4a,QAAQiS,SACvC73B,EAAOD,QAAQ8B,UAAUmJ,EAAK4a,QAAQiS,QAAU,WAC9C,IAAI/sB,EAAME,EAAK4a,QAAQ,CAAErhB,OAAQpB,KAAKoB,SACtC,OAAOpB,KAAKiF,YAAY5H,KAAO,IAAMsK,K,iCC5EzC,iCAC6B,oBAATe,MAAwBA,MAChClB,OACRtI,EAAQI,SAASZ,UAAUQ,MAiB/B,SAASm6F,EAAQ/tF,EAAIguF,GACnBt5F,KAAKqxC,IAAM/lC,EACXtL,KAAKu5F,SAAWD,EAflB18F,EAAQiK,WAAa,WACnB,OAAO,IAAIwyF,EAAQn6F,EAAMjC,KAAK4J,WAAYiqC,EAAO5uC,WAAYuH,eAE/D7M,EAAQ48F,YAAc,WACpB,OAAO,IAAIH,EAAQn6F,EAAMjC,KAAKu8F,YAAa1oD,EAAO5uC,WAAYu3F,gBAEhE78F,EAAQ6M,aACR7M,EAAQ68F,cAAgB,SAAS3vF,GAC3BA,GACFA,EAAQ02C,SAQZ64C,EAAQ36F,UAAUg7F,MAAQL,EAAQ36F,UAAU4iC,IAAM,aAClD+3D,EAAQ36F,UAAU8hD,MAAQ,WACxBxgD,KAAKu5F,SAASt8F,KAAK6zC,EAAO9wC,KAAKqxC,MAIjCz0C,EAAQ+8F,OAAS,SAASpjD,EAAMqjD,GAC9BnwF,aAAa8sC,EAAKsjD,gBAClBtjD,EAAKujD,aAAeF,GAGtBh9F,EAAQm9F,SAAW,SAASxjD,GAC1B9sC,aAAa8sC,EAAKsjD,gBAClBtjD,EAAKujD,cAAgB,GAGvBl9F,EAAQo9F,aAAep9F,EAAQq9F,OAAS,SAAS1jD,GAC/C9sC,aAAa8sC,EAAKsjD,gBAElB,IAAID,EAAQrjD,EAAKujD,aACbF,GAAS,IACXrjD,EAAKsjD,eAAiBhzF,WAAW,WAC3B0vC,EAAK2jD,YACP3jD,EAAK2jD,cACNN,KAKP,EAAQ,IAIRh9F,EAAQwJ,aAAgC,oBAATsC,MAAwBA,KAAKtC,mBAClB,IAAXZ,GAA0BA,EAAOY,cACxCpG,MAAQA,KAAKoG,aACrCxJ,EAAQu9F,eAAkC,oBAATzxF,MAAwBA,KAAKyxF,qBAClB,IAAX30F,GAA0BA,EAAO20F,gBACxCn6F,MAAQA,KAAKm6F,iB,kCC9DvC,6BACI,aAEA,IAAI30F,EAAOY,aAAX,CAIA,IAIIg0F,EA6HIC,EAZAvzF,EArBAwzF,EACAC,EAjGJC,EAAa,EACbC,EAAgB,GAChBC,GAAwB,EACxBrrD,EAAM7pC,EAAOO,SAoJb40F,EAAWn9F,OAAOyF,gBAAkBzF,OAAOyF,eAAeuC,GAC9Dm1F,EAAWA,GAAYA,EAAS9zF,WAAa8zF,EAAWn1F,EAGf,qBAArC,GAAGgG,SAASvO,KAAKuI,EAAO6D,SApFxB+wF,EAAoB,SAAS5M,GACzBnkF,EAAQxD,SAAS,WAAc+0F,EAAapN,OAIpD,WAGI,GAAIhoF,EAAO0B,cAAgB1B,EAAOq1F,cAAe,CAC7C,IAAIC,GAA4B,EAC5BC,EAAev1F,EAAOwB,UAM1B,OALAxB,EAAOwB,UAAY,WACf8zF,GAA4B,GAEhCt1F,EAAO0B,YAAY,GAAI,KACvB1B,EAAOwB,UAAY+zF,EACZD,GAwEJE,GAIAx1F,EAAOa,iBA9CVS,EAAU,IAAIT,gBACVU,MAAMC,UAAY,SAASukB,GAE/BqvE,EADarvE,EAAMplB,OAIvBi0F,EAAoB,SAAS5M,GACzB1mF,EAAQG,MAAMC,YAAYsmF,KA2CvBn+C,GAAO,uBAAwBA,EAAI/oC,cAAc,WAtCpD+zF,EAAOhrD,EAAI1oC,gBACfyzF,EAAoB,SAAS5M,GAGzB,IAAI4E,EAAS/iD,EAAI/oC,cAAc,UAC/B8rF,EAAO5rF,mBAAqB,WACxBo0F,EAAapN,GACb4E,EAAO5rF,mBAAqB,KAC5B6zF,EAAK3zF,YAAY0rF,GACjBA,EAAS,MAEbiI,EAAKzzF,YAAYwrF,KAKrBgI,EAAoB,SAAS5M,GACzB3mF,WAAW+zF,EAAc,EAAGpN,KAlD5B8M,EAAgB,gBAAkBroF,KAAKy6B,SAAW,IAClD6tD,EAAkB,SAAShvE,GACvBA,EAAM2R,SAAW13B,GACK,iBAAf+lB,EAAMplB,MACyB,IAAtColB,EAAMplB,KAAKoI,QAAQ+rF,IACnBM,GAAcrvE,EAAMplB,KAAKkJ,MAAMirF,EAAcl5F,UAIjDoE,EAAO8K,iBACP9K,EAAO8K,iBAAiB,UAAWiqF,GAAiB,GAEpD/0F,EAAOy1F,YAAY,YAAaV,GAGpCH,EAAoB,SAAS5M,GACzBhoF,EAAO0B,YAAYozF,EAAgB9M,EAAQ,OAgEnDmN,EAASv0F,aA1KT,SAAsBsvB,GAEI,mBAAbA,IACTA,EAAW,IAAIp2B,SAAS,GAAKo2B,IAI/B,IADA,IAAIr2B,EAAO,IAAIoD,MAAMP,UAAUd,OAAS,GAC/BtE,EAAI,EAAGA,EAAIuC,EAAK+B,OAAQtE,IAC7BuC,EAAKvC,GAAKoF,UAAUpF,EAAI,GAG5B,IAAIuK,EAAO,CAAEquB,SAAUA,EAAUr2B,KAAMA,GAGvC,OAFAo7F,EAAcD,GAAcnzF,EAC5B+yF,EAAkBI,GACXA,KA6JTG,EAASR,eAAiBA,EA1J1B,SAASA,EAAe3M,UACbiN,EAAcjN,GAyBzB,SAASoN,EAAapN,GAGlB,GAAIkN,EAGA7zF,WAAW+zF,EAAc,EAAGpN,OACzB,CACH,IAAInmF,EAAOozF,EAAcjN,GACzB,GAAInmF,EAAM,CACNqzF,GAAwB,EACxB,KAjCZ,SAAarzF,GACT,IAAIquB,EAAWruB,EAAKquB,SAChBr2B,EAAOgI,EAAKhI,KAChB,OAAQA,EAAK+B,QACb,KAAK,EACDs0B,IACA,MACJ,KAAK,EACDA,EAASr2B,EAAK,IACd,MACJ,KAAK,EACDq2B,EAASr2B,EAAK,GAAIA,EAAK,IACvB,MACJ,KAAK,EACDq2B,EAASr2B,EAAK,GAAIA,EAAK,GAAIA,EAAK,IAChC,MACJ,QACIq2B,EAASx2B,MAAMgB,EAAWb,IAiBlB0K,CAAI1C,GACN,QACE8yF,EAAe3M,GACfkN,GAAwB,MAvE5C,CAyLkB,oBAAThyF,UAAyC,IAAXlD,EAAyBxF,KAAOwF,EAASkD,Q,mDCjIhF,SAASwyF,EAAQ79F,GAEf,IACE,IAAKmI,EAAOymC,aAAc,OAAO,EACjC,MAAO9b,GACP,OAAO,EAET,IAAIxS,EAAMnY,EAAOymC,aAAa5uC,GAC9B,OAAI,MAAQsgB,GACyB,SAA9Bnc,OAAOmc,GAAKO,cA5DrBrhB,EAAOD,QAoBP,SAAoBsqB,EAAI3a,GACtB,GAAI2uF,EAAO,iBACT,OAAOh0E,EAGT,IAAI7lB,GAAS,EAeb,OAdA,WACE,IAAKA,EAAQ,CACX,GAAI65F,EAAO,oBACT,MAAM,IAAI35F,MAAMgL,GACP2uF,EAAO,oBAChBv5F,QAAQ6uB,MAAMjkB,GAEd5K,QAAQC,KAAK2K,GAEflL,GAAS,EAEX,OAAO6lB,EAAGhoB,MAAMc,KAAMkC,e,iCCzC1B,IAAIwb,EAAS,EAAQ,IACjB3C,EAAS2C,EAAO3C,OAGpB,SAASma,EAAW/mB,EAAKE,GACvB,IAAK,IAAIhQ,KAAO8P,EACdE,EAAIhQ,GAAO8P,EAAI9P,GAWnB,SAAS82B,EAAYpyB,EAAK6Z,EAAkBxb,GAC1C,OAAO2Z,EAAOhY,EAAK6Z,EAAkBxb,GATnC2Z,EAAO/G,MAAQ+G,EAAO0G,OAAS1G,EAAO8B,aAAe9B,EAAOkH,gBAC9DplB,EAAOD,QAAU8gB,GAGjBwX,EAAUxX,EAAQ9gB,GAClBA,EAAQme,OAASoa,GAOnBA,EAAWz2B,UAAYlB,OAAOY,OAAO2c,EAAOrc,WAG5Cw2B,EAAUna,EAAQoa,GAElBA,EAAWnhB,KAAO,SAAUjR,EAAK6Z,EAAkBxb,GACjD,GAAmB,iBAAR2B,EACT,MAAM,IAAIhC,UAAU,iCAEtB,OAAOga,EAAOhY,EAAK6Z,EAAkBxb,IAGvC+zB,EAAW1T,MAAQ,SAAUxJ,EAAMlE,EAAMqJ,GACvC,GAAoB,iBAATnF,EACT,MAAM,IAAIlX,UAAU,6BAEtB,IAAIoe,EAAMpE,EAAO9C,GAUjB,YATa/X,IAAT6T,EACsB,iBAAbqJ,EACT+B,EAAIpL,KAAKA,EAAMqJ,GAEf+B,EAAIpL,KAAKA,GAGXoL,EAAIpL,KAAK,GAEJoL,GAGTgW,EAAWtY,YAAc,SAAU5E,GACjC,GAAoB,iBAATA,EACT,MAAM,IAAIlX,UAAU,6BAEtB,OAAOga,EAAO9C,IAGhBkd,EAAWlT,gBAAkB,SAAUhK,GACrC,GAAoB,iBAATA,EACT,MAAM,IAAIlX,UAAU,6BAEtB,OAAO2c,EAAO8D,WAAWvJ,K,6BCnC3Bpb,EAAOD,QAAUq4B,EAEjB,IAAID,EAAY,EAAQ,IAGpBntB,EAAO,EAAQ,IAMnB,SAASotB,EAAY9sB,GACnB,KAAMnI,gBAAgBi1B,GAAc,OAAO,IAAIA,EAAY9sB,GAE3D6sB,EAAU/3B,KAAK+C,KAAMmI,GARvBN,EAAKC,SAAW,EAAQ,GAGxBD,EAAKC,SAASmtB,EAAaD,GAQ3BC,EAAYv2B,UAAU2nF,WAAa,SAAUztD,EAAOxb,EAAUpU,GAC5DA,EAAG,KAAM4vB,K,gBC7CX/7B,EAAOD,QAAU,EAAQ,K,gBCAzBC,EAAOD,QAAU,EAAQ,I,gBCAzBC,EAAOD,QAAU,EAAQ,IAAco4B,W,gBCAvCn4B,EAAOD,QAAU,EAAQ,IAAcq4B,a,cCmBvCr4B,EAAQgiF,eAFa,O,8ECjBrB,MAAMuc,EAAiBp5C,MAAM,oCAC7B,IAAIq5C,EAAgBjwF,EAAgBkwF,EAKpC,SAASC,EAAU93F,GACjB,MAAMmI,EAASnI,EAAQ2C,KACvB,GAAe,OAAXwF,EAAiB,CACnB0vF,EAAYnqF,YAAc,QAC1BmqF,EAAYxpF,MAAMqC,MAAQ,QAC1B,IAAK,MAAMyT,KAAS0zE,EAAYziF,SAC9B+O,EAAM7W,aAEH,CACL,IAAI6iB,EAAM,GACVhoB,EAAO2C,QAAQqkB,IACbgB,GAAOhB,EAAO,OAEhB0oE,EAAYnqF,YAAc,GAC1BmqF,EAAYxpF,MAAMqC,MAAQ,MAC1B,MAAMqnF,EAAOx1F,SAASO,cAAc,KACpCi1F,EAAK3oF,aAAa,OAAQ,iCACxBnE,mBAAmBklB,IACrB4nE,EAAK3oF,aAAa,WAAY,kBAC9B2oF,EAAKrqF,YAAc,UACnBmqF,EAAYz0F,YAAY20F,IAQ5B,OAAOrmF,iBACL,MAAMzC,EAAkB1M,SAASiK,eAAe,mBAChD,GAAwB,OAApByC,EAA0B,CAC5B,MAAM+oF,EAAaz1F,SAASO,cAAc,OAC1Ck1F,EAAW/qF,UAAUQ,IAAI,eACzB,MAAMwqF,EAAS11F,SAASO,cAAc,KACtCm1F,EAAOvqF,YAAc,eACrB,MAAM+D,EAAOlP,SAASO,cAAc,QACpC2O,EAAK3J,GAAK,oBACV2J,EAAK/D,YAAc,UACnBuqF,EAAO70F,YAAYqO,GACnBumF,EAAW50F,YAAY60F,GACvBhpF,EAAgB7L,YAAY40F,GAC5BH,EAAct1F,SAASiK,eAAe,sBACtCorF,EAAS,IAAIM,OAAO,oCACb10F,UAAYs0F,IAQvB,oBAAOpmF,eAAkCymF,GACvC,QAAoBz7F,IAAhBm7F,EAAJ,CAGA,QAAen7F,IAAXiL,EAAsB,CACxB,MAAMkxD,QAAiB8+B,EACvBhwF,QAAekxD,EAASxhC,OAE1BwgE,EAAYnqF,YAAc,cAC1BmqF,EAAYxpF,MAAMqC,MAAQ,OAC1BknF,EAAOl0F,YAAY,CACjB4qE,IAAK6pB,EACLxwF,OAAQA,MAOZ,uBACE,IAAK,MAAMwc,KAAS0zE,EAAYziF,SAC9B+O,EAAM7W,SAERuqF,EAAYnqF,YAAc,SAC1BmqF,EAAYxpF,MAAMqC,MAAQ,e,8EC3E5B,gBAEE,cACElU,KAAK47F,cAAgB,IAAIF,OAAO,0CAMlC,iBAAkBj7F,EAAciD,GAC9B,OAAO1D,KAAK47F,cAActrF,iBAAiB7P,EAAMiD,GAMnD,YAAaF,GACX,OAAOxD,KAAK47F,cAAc10F,YAAY1D,M,gBCvB1C,IAQIq4F,EACAC,EATAC,EAAM,EAAQ,IACdC,EAAc,EAAQ,IAWtBC,EAAa,EACbC,EAAa,EA+FjBr/F,EAAOD,QA5FP,SAAYuL,EAASgX,EAAKM,GACxB,IAAI3iB,EAAIqiB,GAAOM,GAAU,EACrB5Q,EAAIsQ,GAAO,GAGX+nB,GADJ/+B,EAAUA,GAAW,IACF++B,MAAQ20D,EACvBM,OAAgCj8F,IAArBiI,EAAQg0F,SAAyBh0F,EAAQg0F,SAAWL,EAKnE,GAAY,MAAR50D,GAA4B,MAAZi1D,EAAkB,CACpC,IAAIC,EAAYL,IACJ,MAAR70D,IAEFA,EAAO20D,EAAU,CACA,EAAfO,EAAU,GACVA,EAAU,GAAIA,EAAU,GAAIA,EAAU,GAAIA,EAAU,GAAIA,EAAU,KAGtD,MAAZD,IAEFA,EAAWL,EAAiD,OAApCM,EAAU,IAAM,EAAIA,EAAU,KAQ1D,IAAIxC,OAA0B15F,IAAlBiI,EAAQyxF,MAAsBzxF,EAAQyxF,OAAQ,IAAI5nE,MAAOi7D,UAIjEoP,OAA0Bn8F,IAAlBiI,EAAQk0F,MAAsBl0F,EAAQk0F,MAAQH,EAAa,EAGnEI,EAAM1C,EAAQqC,GAAeI,EAAQH,GAAY,IAcrD,GAXII,EAAK,QAA0Bp8F,IAArBiI,EAAQg0F,WACpBA,EAAWA,EAAW,EAAI,QAKvBG,EAAK,GAAK1C,EAAQqC,SAAiC/7F,IAAlBiI,EAAQk0F,QAC5CA,EAAQ,GAINA,GAAS,IACX,MAAM,IAAI96F,MAAM,mDAGlB06F,EAAarC,EACbsC,EAAaG,EACbP,EAAYK,EAMZ,IAAII,GAA4B,KAAb,WAHnB3C,GAAS,cAG+ByC,GAAS,WACjDxtF,EAAE/R,KAAOy/F,IAAO,GAAK,IACrB1tF,EAAE/R,KAAOy/F,IAAO,GAAK,IACrB1tF,EAAE/R,KAAOy/F,IAAO,EAAI,IACpB1tF,EAAE/R,KAAY,IAALy/F,EAGT,IAAIC,EAAO5C,EAAQ,WAAc,IAAS,UAC1C/qF,EAAE/R,KAAO0/F,IAAQ,EAAI,IACrB3tF,EAAE/R,KAAa,IAAN0/F,EAGT3tF,EAAE/R,KAAO0/F,IAAQ,GAAK,GAAM,GAC5B3tF,EAAE/R,KAAO0/F,IAAQ,GAAK,IAGtB3tF,EAAE/R,KAAOq/F,IAAa,EAAI,IAG1BttF,EAAE/R,KAAkB,IAAXq/F,EAGT,IAAK,IAAI59F,EAAI,EAAGA,EAAI,IAAKA,EACvBsQ,EAAE/R,EAAIyB,GAAK2oC,EAAK3oC,GAGlB,OAAO4gB,GAAY68E,EAAYntF,K,gBCzGjC,IAAIktF,EAAM,EAAQ,IACdC,EAAc,EAAQ,IA2B1Bn/F,EAAOD,QAzBP,SAAYuL,EAASgX,EAAKM,GACxB,IAAI3iB,EAAIqiB,GAAOM,GAAU,EAEF,iBAAb,IACRN,EAAkB,WAAZhX,EAAuB,IAAI1F,MAAM,IAAM,KAC7C0F,EAAU,MAIZ,IAAIw+E,GAFJx+E,EAAUA,GAAW,IAEFukC,SAAWvkC,EAAQ4zF,KAAOA,KAO7C,GAJApV,EAAK,GAAgB,GAAVA,EAAK,GAAa,GAC7BA,EAAK,GAAgB,GAAVA,EAAK,GAAa,IAGzBxnE,EACF,IAAK,IAAIs9E,EAAK,EAAGA,EAAK,KAAMA,EAC1Bt9E,EAAIriB,EAAI2/F,GAAM9V,EAAK8V,GAIvB,OAAOt9E,GAAO68E,EAAYrV,K,8ECxB5B,MAAM+V,EAAa,EAAQ,IACrBC,EAAc,EAAQ,IAE5B,QAKA,yBAA+BC,GAC7B,MAAMxxD,EAAU,EAAAgQ,SAASwhD,EAAgBF,GACnCxxF,EAAWkgC,EAAQlgC,SACzB,GAAIkgC,EAAQz/B,OAAOvK,OAAS,EAE1B,OADAO,QAAQ0B,MAAM+nC,EAAQz/B,SACf,EAET,MAAMlI,EAAUyH,EAAS,YACzB,MAAgB,kEAAZzH,IAGCA,EAAQ,KAAOk5F,EAAY,IAC3Bl5F,EAAQ,GAAW,SAAMk5F,EAAY,GAAW,QAChDl5F,EAAQ,GAAU,QAAMk5F,EAAY,GAAU,OAC9Cl5F,EAAQ,GAAc,YAAMk5F,EAAY,GAAc,WACtDl5F,EAAQ,GAAU,MAAE,SAAWk5F,EAAY,GAAU,MAAE,QACvDl5F,EAAQ,GAAU,MAAE,WAAak5F,EAAY,GAAU,MAAE,UACzDl5F,EAAQ,GAAoB,gBAAE,SAAWk5F,EAAY,GAAoB,gBAAE,QAC3El5F,EAAQ,GAAoB,gBAAE,WAAak5F,EAAY,GAAoB,gBAAE,UAC7El5F,EAAQ,GAAoB,gBAAE,gBAAkBk5F,EAAY,GAAoB,gBAAE,gBAGrFh7F,QAAQ0B,MAAM,oBACd1B,QAAQ0B,MAAMI,GACd9B,QAAQ0B,MAAMs5F,IACP,M,oxBChCX,IAAIE,EAAYhgG,EAAOD,QAAQigG,UAAY,EAAQ,IAEnDhgG,EAAOD,QAAQ6O,gBAAkB,EAAQ,GAAaA,gBACtD5O,EAAOD,QAAQqO,gBAAkB,EAAQ,GAAaA,gBACtDpO,EAAOD,QAAQ0P,YAAc,EAAQ,GAAaA,YAClDzP,EAAOD,QAAQykC,iBAAmB,EAAQ,IAAUA,iBACpDxkC,EAAOD,QAAQ2kC,KAAO,EAAQ,IAAUA,KAExC1kC,EAAOD,QAAQw+C,SAAW,SAAUlwC,EAAUC,EAAQhD,GAEpD,OADQ,IAAI00F,GACHzhD,SAASlwC,EAAUC,EAAQhD,K,6BCVtC,IAAIg5B,EAAS,EAAQ,IAEjBy1D,EAAY,EAAQ,KACpBx1D,EAAU,EAAQ,GAClBI,EAAa,EAAQ,IAAUD,KAC/B91B,EAAkB21B,EAAQ31B,gBAC1Ba,EAAc80B,EAAQ90B,YACtBG,EAAgB20B,EAAQ30B,cASxBowF,EAAY,SAASA,IAGvB78F,KAAK8N,cAAgBtQ,OAAOY,OAAOy+F,EAAUn+F,UAAUoP,eACvD9N,KAAK2M,QAAU,GACf3M,KAAK88F,eAAiB,GAGtB98F,KAAK+8F,MAAQv/F,OAAOY,OAAO2+F,GAC3B/8F,KAAK24E,WAAan7E,OAAOY,OAAOw4F,EAAUoG,aA6G5C,SAASC,EAAc9xF,GACrB,IAAIm2B,EAAyB,iBAAXn2B,EAAuBA,EAASA,EAAOu2B,KACzD,MAAgB,iBAALJ,GAAsBA,EA3GnCu7D,EAAUn+F,UAAUoP,cAAgB,GAGpC+uF,EAAUn+F,UAAUiO,QAAU,KAC9BkwF,EAAUn+F,UAAUq+F,MAAQ,KAC5BF,EAAUn+F,UAAUi6E,WAAa,KACjCkkB,EAAUn+F,UAAUo+F,eAAiB,KAQrCD,EAAUn+F,UAAUw+F,UAAY,SAAoB/xF,EAAQuB,GAC1D,IAAIhE,EAAO1I,KACX,IAAKmL,EACH,OAAO,KAET,IAAIo2B,EAAOC,EAAW90B,GAvCJ,IAuCyBvB,GACvCgyF,EAASzwF,GAAQvB,EAAOG,GAC5B,IAAI,IAAIN,KAAOu2B,EAAKj2B,GAClBtL,KAAK2M,QAAQ3B,GAAOu2B,EAAKj2B,GAAGN,GAE9B,IAAI,IAAIA,KAAOu2B,EAAKD,IAClBthC,KAAK88F,eAAe37F,KAAK6J,GAK3B,OAHAhL,KAAK88F,eAAiB98F,KAAK88F,eAAe3jF,OAAO,SAASnO,GACxD,YAAkC,IAApBtC,EAAKiE,QAAQ3B,KAEtBhL,KAAK2M,QAAQwwF,IAGtBN,EAAUn+F,UAAU0+F,kBAAoB,SAA2B37D,EAAS90B,GAC1E,GAAKA,aAAmBlK,MACxB,IAAI,IAAI3F,EAAE,EAAGA,EAAE6P,EAAQvL,OAAQtE,IAC7BkD,KAAKq9F,aAAa57D,EAAS90B,EAAQ7P,KAIvC+/F,EAAUn+F,UAAU4+F,mBAAqB,SAA2B77D,EAAS90B,GAC3E,GAAIA,GAA2B,iBAATA,EACtB,IAAI,IAAI/N,KAAK+N,EACX3M,KAAKq9F,aAAa57D,EAAS90B,EAAQ/N,KAUvCi+F,EAAUn+F,UAAU6+F,WAAa,SAAqB5wF,GACpD3M,KAAK2M,QAAUA,GAOjBkwF,EAAUn+F,UAAU8+F,UAAY,SAAoBC,GAClD,OAAOz9F,KAAK2M,QAAQ8wF,IAWtBZ,EAAUn+F,UAAU08C,SAAW,SAAmBlwC,EAAUC,EAAQhD,EAASuD,GACtEvD,IACHA,EAAU,IAEZ,IAAI2E,EAAe3E,EAAQ2E,cAAgB,WAEvCJ,EAAOy0B,EAAOv0B,QAAQzE,EAAQuE,MAnGhB,IAmGqCvB,EAAOG,IAAI,IAClE,IAAII,EAAI,EACNA,EAAM,IAAIe,EAActB,EAAQhD,EAAS2E,EAAcJ,EAAMlP,OAAOY,OAAO4B,KAAK2M,WACvEA,QAAQD,KACfhB,EAAIiB,QAAQD,GAAQvB,GAEtB,IAAImU,EAAQkiB,EAAW90B,EAAMvB,GAC7B,IAAI,IAAI5M,KAAK+gB,EAAMhU,GAAG,CACpB,IAAIoyF,EAAMp+E,EAAMhU,GAAG/M,GACnBmN,EAAIiB,QAAQpO,GAAKm/F,GAGrB,GAAIvyF,EAAQ,CACV,IAAIiC,EAASpN,KAAK29F,eAAezyF,EAAUC,EAAQhD,EAASuD,GAC5D,IAAK0B,EACH,MAAM,IAAI7L,MAAM,oBAElB,OAAO6L,EAET,MAAM,IAAId,EAAY,sBAAuBnB,IAsB/C0xF,EAAUn+F,UAAUi/F,eAAiB,SAAyBzyF,EAAUC,EAAQhD,EAASuD,GACvF,IA8BIkyF,EA9BAxwF,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAG5D,GAAmB,kBAATP,GACI,IAATA,EAEDA,EAAS,IACO,IAATA,IAEPA,EAAS,CAAC1K,KAAM,UAEd,IAAI0K,EAER,MAAM,IAAI5J,MAAM,uBAGlB,GAAI4J,EAAgB,QAClB,GAAIA,EAAgB,mBAAa1I,MAAO,CACtC,IAAIo7F,EAAY,CAAC1yF,OAAQA,EAAQO,IAAKA,GACtCP,EAAgB,QAAEmD,QAAQtO,KAAK89F,gBAAgBx/F,KAAK0B,KAAM69F,IAC1D1yF,EAAS0yF,EAAU1yF,OACnB0yF,EAAU1yF,OAAS,KACnB0yF,EAAUnyF,IAAM,KAChBmyF,EAAY,UAEZ1yF,EAASi2B,EAAQlzB,UAAU/C,EAAQnL,KAAK+9F,aAAa5yF,EAAgB,QAAGO,IAM5E,GAAIkyF,EAAeX,EAAc9xF,GAAS,CACxC,IAAI6yF,EAAWh+F,KAAK4M,QAAQzB,EAAQyyF,EAAclyF,GAC9CuyF,EAAS,IAAIxxF,EAAcuxF,EAASE,UAAW/1F,EAASuD,EAAIN,aAAc4yF,EAASJ,aAAclyF,EAAIiB,SACzG,OAAO3M,KAAK29F,eAAezyF,EAAU8yF,EAASE,UAAW/1F,EAAS81F,GAGpE,IAAIE,EAAiBh2F,GAAWA,EAAQg2F,gBAAkB,GAE1D,IAAK,IAAI9/F,KAAO8M,EACd,IAAKyrF,EAAUwH,iBAAiB//F,IAAQ8/F,EAAe5vF,QAAQlQ,GAAO,EAAG,CACvE,IAAIggG,EAAe,KACfzwF,EAAY5N,KAAK24E,WAAWt6E,GAChC,GAAIuP,EACFywF,EAAezwF,EAAU3Q,KAAK+C,KAAMkL,EAAUC,EAAQhD,EAASuD,QAC1D,IAAuC,IAAnCvD,EAAQm2F,uBAEjB,MAAM,IAAIhyF,EAAY,0BAA4BjO,EAAK8M,GAErDkzF,GACFjxF,EAAOnB,aAAaoyF,GAK1B,GAA8B,mBAAnBl2F,EAAQo2F,QAAuB,CACxC,IAAIxgG,EAAQoK,EAAQo2F,QAAQthG,KAAK+C,KAAMkL,EAAUC,EAAQhD,EAASuD,GAClE0B,EAAOlC,SAAWnN,EAEpB,OAAOqP,GASTyvF,EAAUn+F,UAAUo/F,gBAAkB,SAA0BD,EAAWh/F,GACzEg/F,EAAU1yF,OAASi2B,EAAQlzB,UAAU2vF,EAAU1yF,OAAQnL,KAAK+9F,aAAal/F,EAAGg/F,EAAUnyF,OASxFmxF,EAAUn+F,UAAUq/F,aAAe,SAAuB5yF,EAAQO,GAChE,IAAI41B,EACJ,OAAGA,EAAM27D,EAAc9xF,IACdnL,KAAK4M,QAAQzB,EAAQm2B,EAAK51B,GAAKwyF,UAEjC/yF,GAWT0xF,EAAUn+F,UAAUkO,QAAU,SAAkBzB,EAAQyyF,EAAclyF,GAGpE,GAFAkyF,EAAelyF,EAAIkB,QAAQgxF,GAEvBlyF,EAAIiB,QAAQixF,GACd,MAAO,CAACM,UAAWxyF,EAAIiB,QAAQixF,GAAeA,aAAcA,GAG9D,IAAIh+E,EAASuhB,EAAOnE,MAAM4gE,GACtBY,EAAW5+E,GAAUA,EAAO6O,KAC5B1oB,EAAWy4F,GAAYA,EAASp9F,QAAUw8F,EAAa/9E,OAAO,EAAG+9E,EAAax8F,OAASo9F,EAASp9F,QACpG,IAAK2E,IAAa2F,EAAIiB,QAAQ5G,GAC5B,MAAM,IAAIuG,EAAY,mBAAqBsxF,EAAe,IAAKzyF,GAEjE,IAAI+yF,EAAY98D,EAAQnyB,cAAcvD,EAAIiB,QAAQ5G,GAAWy4F,EAAS3+E,OAAO,IAC7E,QAAe3f,IAAZg+F,EACD,MAAM,IAAI5xF,EAAY,kBAAoBkyF,EAAW,gBAAkBz4F,EAAW,IAAKoF,GAEzF,MAAO,CAAC+yF,UAAWA,EAAWN,aAAcA,IAa9Cf,EAAUn+F,UAAU+/F,SAAW,SAAuBvzF,EAAUC,EAAQhD,EAASuD,EAAKjL,GACpF,GAA+B,mBAApBT,KAAK+8F,MAAMt8F,GACpB,OAAOT,KAAK+8F,MAAMt8F,GAAMxD,KAAK+C,KAAMkL,GAErC,GAAIzK,GAAuB,iBAARA,EAAkB,CACnC,IAAIyL,EAAMlM,KAAK29F,eAAezyF,EAAUzK,EAAM0H,EAASuD,GACvD,YAAexL,IAARgM,KAAuBA,GAAOA,EAAIP,OAAOvK,QAGlD,OAAO,GAGT,IAAI27F,EAAQF,EAAUn+F,UAAUq+F,MAAQ,GACxCA,EAAM5/E,OAAS,SAAqBjS,GAClC,MAA0B,iBAAZA,GAEhB6xF,EAAMttF,OAAS,SAAqBvE,GAElC,MAA0B,iBAAZA,GAAwB6X,SAAS7X,IAEjD6xF,EAAM2B,QAAU,SAAsBxzF,GACpC,MAA2B,iBAAZA,GAAyBA,EAAW,GAAM,GAE3D6xF,EAAM4B,QAAU,SAAsBzzF,GACpC,MAA0B,kBAAZA,GAEhB6xF,EAAM5yF,MAAQ,SAAoBe,GAChC,OAAOzI,MAAM2L,QAAQlD,IAEvB6xF,EAAY,KAAI,SAAmB7xF,GACjC,OAAoB,OAAbA,GAET6xF,EAAM6B,KAAO,SAAmB1zF,GAC9B,OAAOA,aAAoB8mB,MAE7B+qE,EAAM8B,IAAM,SAAkB3zF,GAC5B,OAAO,GAET6xF,EAAMv+F,OAAS,SAAqB0M,GAElC,OAAOA,GAAkC,iBAAdA,KAA4BA,aAAoBzI,UAAYyI,aAAoB8mB,OAG7Gn1B,EAAOD,QAAUigG,G,iBC/TjB,uEACE,SAAS9lD,GAGsCn6C,GAC9CA,EAAQ+5F,SACoC95F,GAC5CA,EAAO85F,SAHT,IAIImI,EAA8B,iBAAVt5F,GAAsBA,EAE7Cs5F,EAAWt5F,SAAWs5F,GACtBA,EAAWt3F,SAAWs3F,GACtBA,EAAWp2F,KAUZ,IAAI2zB,EAGJ0iE,EAAS,WAGTryF,EAAO,GACPsyF,EAAO,EACPC,EAAO,GACPjoF,EAAO,GACPkoF,EAAO,IACPC,EAAc,GACdC,EAAW,IACXC,EAAY,IAGZC,EAAgB,QAChBC,EAAgB,eAChBC,EAAkB,4BAGlB7zF,EAAS,CACR,SAAY,kDACZ,YAAa,iDACb,gBAAiB,iBAIlB8zF,EAAgB/yF,EAAOsyF,EACvBz5E,EAAQtT,KAAKsT,MACbgxE,EAAqB/0F,OAAO8f,aAa5B,SAASje,EAAM5C,GACd,MAAM,IAAIuC,WAAW2I,EAAOlL,IAW7B,SAAS2L,EAAIjC,EAAO+c,GAGnB,IAFA,IAAI9lB,EAAS+I,EAAM/I,OACfgM,EAAS,GACNhM,KACNgM,EAAOhM,GAAU8lB,EAAG/c,EAAM/I,IAE3B,OAAOgM,EAaR,SAASsyF,EAAUviF,EAAQ+J,GAC1B,IAAI/X,EAAQgO,EAAO/N,MAAM,KACrBhC,EAAS,GAWb,OAVI+B,EAAM/N,OAAS,IAGlBgM,EAAS+B,EAAM,GAAK,IACpBgO,EAAShO,EAAM,IAMT/B,EADOhB,GAFd+Q,EAASA,EAAOzO,QAAQ8wF,EAAiB,MACrBpwF,MAAM,KACA8X,GAAI7a,KAAK,KAiBpC,SAASszF,EAAWxiF,GAMnB,IALA,IAGIpf,EACA6hG,EAJA3tE,EAAS,GACT4tE,EAAU,EACVz+F,EAAS+b,EAAO/b,OAGby+F,EAAUz+F,IAChBrD,EAAQof,EAAOgD,WAAW0/E,OACb,OAAU9hG,GAAS,OAAU8hG,EAAUz+F,EAG3B,QAAX,OADbw+F,EAAQziF,EAAOgD,WAAW0/E,OAEzB5tE,EAAO9wB,OAAe,KAARpD,IAAkB,KAAe,KAAR6hG,GAAiB,QAIxD3tE,EAAO9wB,KAAKpD,GACZ8hG,KAGD5tE,EAAO9wB,KAAKpD,GAGd,OAAOk0B,EAWR,SAAS6tE,EAAW31F,GACnB,OAAOiC,EAAIjC,EAAO,SAASpM,GAC1B,IAAIk0B,EAAS,GAOb,OANIl0B,EAAQ,QAEXk0B,GAAUskE,GADVx4F,GAAS,SAC8B,GAAK,KAAQ,OACpDA,EAAQ,MAAiB,KAARA,GAElBk0B,GAAUskE,EAAmBx4F,KAE3BsO,KAAK,IAoCT,SAAS0zF,EAAaC,EAAOC,GAG5B,OAAOD,EAAQ,GAAK,IAAMA,EAAQ,MAAgB,GAARC,IAAc,GAQzD,SAASC,EAAMj0C,EAAOk0C,EAAWC,GAChC,IAAIlxF,EAAI,EAGR,IAFA+8C,EAAQm0C,EAAY76E,EAAM0mC,EAAQizC,GAAQjzC,GAAS,EACnDA,GAAS1mC,EAAM0mC,EAAQk0C,GACOl0C,EAAQwzC,EAAgBR,GAAQ,EAAG/vF,GAAKxC,EACrEu/C,EAAQ1mC,EAAM0mC,EAAQwzC,GAEvB,OAAOl6E,EAAMrW,GAAKuwF,EAAgB,GAAKxzC,GAASA,EAAQj1C,IAUzD,SAASqpF,EAAOpzF,GAEf,IAEIiW,EAIAo9E,EACA/gF,EACAjb,EACAi8F,EACAj/F,EACA4N,EACA8wF,EACAhiG,EAEAwiG,EArEiBt/E,EAsDjB+Q,EAAS,GACTwuE,EAAcxzF,EAAM7L,OAEpBtE,EAAI,EACJyB,EAAI6gG,EACJsB,EAAOvB,EAqBX,KALAmB,EAAQrzF,EAAM6R,YAAYugF,IACd,IACXiB,EAAQ,GAGJ/gF,EAAI,EAAGA,EAAI+gF,IAAS/gF,EAEpBtS,EAAMkT,WAAWZ,IAAM,KAC1Blc,EAAM,aAEP4uB,EAAO9wB,KAAK8L,EAAMkT,WAAWZ,IAM9B,IAAKjb,EAAQg8F,EAAQ,EAAIA,EAAQ,EAAI,EAAGh8F,EAAQm8F,GAAwC,CAOvF,IAAKF,EAAOzjG,EAAGwE,EAAI,EAAG4N,EAAIxC,EAErBpI,GAASm8F,GACZp9F,EAAM,mBAGP28F,GAxGmB9+E,EAwGEjU,EAAMkT,WAAW7b,MAvGxB,GAAK,GACb4c,EAAY,GAEhBA,EAAY,GAAK,GACbA,EAAY,GAEhBA,EAAY,GAAK,GACbA,EAAY,GAEbxU,IAgGQA,GAAQszF,EAAQz6E,GAAOw5E,EAASjiG,GAAKwE,KACjD+B,EAAM,YAGPvG,GAAKkjG,EAAQ1+F,IAGT0+F,GAFJhiG,EAAIkR,GAAKwxF,EAAO1B,EAAQ9vF,GAAKwxF,EAAOzB,EAAOA,EAAO/vF,EAAIwxF,IAbHxxF,GAAKxC,EAoBpDpL,EAAIikB,EAAMw5E,GADdyB,EAAa9zF,EAAO1O,KAEnBqF,EAAM,YAGP/B,GAAKk/F,EAKNE,EAAOR,EAAMpjG,EAAIyjG,EADjBr9E,EAAM+O,EAAO7wB,OAAS,EACc,GAARm/F,GAIxBh7E,EAAMzoB,EAAIomB,GAAO67E,EAASxgG,GAC7B8E,EAAM,YAGP9E,GAAKgnB,EAAMzoB,EAAIomB,GACfpmB,GAAKomB,EAGL+O,EAAOgP,OAAOnkC,IAAK,EAAGyB,GAIvB,OAAOuhG,EAAW7tE,GAUnB,SAAS0uE,EAAO1zF,GACf,IAAI1O,EACA0tD,EACA20C,EACAC,EACAH,EACAnhF,EACAriB,EACAizF,EACAjhF,EACAlR,EACA8iG,EAGAL,EAEAM,EACAP,EACAQ,EANA/uE,EAAS,GAoBb,IARAwuE,GAHAxzF,EAAQ0yF,EAAW1yF,IAGC7L,OAGpB7C,EAAI6gG,EACJnzC,EAAQ,EACRy0C,EAAOvB,EAGF5/E,EAAI,EAAGA,EAAIkhF,IAAelhF,GAC9BuhF,EAAe7zF,EAAMsS,IACF,KAClB0S,EAAO9wB,KAAKo1F,EAAmBuK,IAejC,IAXAF,EAAiBC,EAAc5uE,EAAO7wB,OAMlCy/F,GACH5uE,EAAO9wB,KAAKk+F,GAINuB,EAAiBH,GAAa,CAIpC,IAAKvjG,EAAI6hG,EAAQx/E,EAAI,EAAGA,EAAIkhF,IAAelhF,GAC1CuhF,EAAe7zF,EAAMsS,KACDhhB,GAAKuiG,EAAe5jG,IACvCA,EAAI4jG,GAcN,IAPI5jG,EAAIqB,EAAIgnB,GAAOw5E,EAAS9yC,IAD5B80C,EAAwBH,EAAiB,KAExCv9F,EAAM,YAGP4oD,IAAU/uD,EAAIqB,GAAKwiG,EACnBxiG,EAAIrB,EAECqiB,EAAI,EAAGA,EAAIkhF,IAAelhF,EAO9B,IANAuhF,EAAe7zF,EAAMsS,IAEFhhB,KAAO0tD,EAAQ8yC,GACjC17F,EAAM,YAGHy9F,GAAgBviG,EAAG,CAEtB,IAAK4xF,EAAIlkC,EAAO/8C,EAAIxC,IAEfyjF,GADJnyF,EAAIkR,GAAKwxF,EAAO1B,EAAQ9vF,GAAKwxF,EAAOzB,EAAOA,EAAO/vF,EAAIwxF,IADTxxF,GAAKxC,EAKlDs0F,EAAU7Q,EAAInyF,EACdwiG,EAAa9zF,EAAO1O,EACpBi0B,EAAO9wB,KACNo1F,EAAmBwJ,EAAa/hG,EAAIgjG,EAAUR,EAAY,KAE3DrQ,EAAI5qE,EAAMy7E,EAAUR,GAGrBvuE,EAAO9wB,KAAKo1F,EAAmBwJ,EAAa5P,EAAG,KAC/CuQ,EAAOR,EAAMj0C,EAAO80C,EAAuBH,GAAkBC,GAC7D50C,EAAQ,IACN20C,IAIF30C,IACA1tD,EAGH,OAAO0zB,EAAO5lB,KAAK,IA4CpBgwB,EAAW,CAMV,QAAW,QAQX,KAAQ,CACP,OAAUsjE,EACV,OAAUG,GAEX,OAAUO,EACV,OAAUM,EACV,QA/BD,SAAiB1zF,GAChB,OAAOyyF,EAAUzyF,EAAO,SAASkQ,GAChC,OAAOoiF,EAAc1xF,KAAKsP,GACvB,OAASwjF,EAAOxjF,GAChBA,KA4BJ,UAnDD,SAAmBlQ,GAClB,OAAOyyF,EAAUzyF,EAAO,SAASkQ,GAChC,OAAOmiF,EAAczxF,KAAKsP,GACvBkjF,EAAOljF,EAAO9N,MAAM,GAAG6O,eACvBf,WA4DH,KAFD,aACC,OAAOkf,GACP,8BAngBF,K,wCCDDx/B,EAAOD,QAAU,SAASC,GAoBzB,OAnBKA,EAAOokG,kBACXpkG,EAAOuzB,UAAY,aACnBvzB,EAAOs5C,MAAQ,GAEVt5C,EAAO+b,WAAU/b,EAAO+b,SAAW,IACxCpb,OAAOC,eAAeZ,EAAQ,SAAU,CACvCa,YAAY,EACZC,IAAK,WACJ,OAAOd,EAAOE,KAGhBS,OAAOC,eAAeZ,EAAQ,KAAM,CACnCa,YAAY,EACZC,IAAK,WACJ,OAAOd,EAAOC,KAGhBD,EAAOokG,gBAAkB,GAEnBpkG,I,6BClBRA,EAAOD,QAAU,CACfwd,SAAU,SAASrX,GACjB,MAAuB,iBAAV,GAEf0X,SAAU,SAAS1X,GACjB,MAAuB,iBAAV,GAA8B,OAARA,GAErCkX,OAAQ,SAASlX,GACf,OAAe,OAARA,GAETmX,kBAAmB,SAASnX,GAC1B,OAAc,MAAPA,K,6BCXXnG,EAAQyjG,OAASzjG,EAAQogC,MAAQ,EAAQ,IACzCpgC,EAAQ+jG,OAAS/jG,EAAQqR,UAAY,EAAQ,K,6BCuB7C,SAAStP,EAAegJ,EAAK+rB,GAC3B,OAAOl2B,OAAOkB,UAAUC,eAAe1B,KAAK0K,EAAK+rB,GAGnD72B,EAAOD,QAAU,SAASskG,EAAIC,EAAKC,EAAIj5F,GACrCg5F,EAAMA,GAAO,IACbC,EAAKA,GAAM,IACX,IAAIz5F,EAAM,GAEV,GAAkB,iBAAPu5F,GAAiC,IAAdA,EAAG9/F,OAC/B,OAAOuG,EAGT,IAAI2F,EAAS,MACb4zF,EAAKA,EAAG9xF,MAAM+xF,GAEd,IAAIE,EAAU,IACVl5F,GAAsC,iBAApBA,EAAQk5F,UAC5BA,EAAUl5F,EAAQk5F,SAGpB,IAAI19F,EAAMu9F,EAAG9/F,OAETigG,EAAU,GAAK19F,EAAM09F,IACvB19F,EAAM09F,GAGR,IAAK,IAAIvkG,EAAI,EAAGA,EAAI6G,IAAO7G,EAAG,CAC5B,IAEIwkG,EAAMC,EAAMryF,EAAGjH,EAFfyR,EAAIwnF,EAAGpkG,GAAG4R,QAAQpB,EAAQ,OAC1BukB,EAAMnY,EAAEnL,QAAQ6yF,GAGhBvvE,GAAO,GACTyvE,EAAO5nF,EAAEmG,OAAO,EAAGgS,GACnB0vE,EAAO7nF,EAAEmG,OAAOgS,EAAM,KAEtByvE,EAAO5nF,EACP6nF,EAAO,IAGTryF,EAAII,mBAAmBgyF,GACvBr5F,EAAIqH,mBAAmBiyF,GAElB5iG,EAAegJ,EAAKuH,GAEdd,EAAQzG,EAAIuH,IACrBvH,EAAIuH,GAAG/N,KAAK8G,GAEZN,EAAIuH,GAAK,CAACvH,EAAIuH,GAAIjH,GAJlBN,EAAIuH,GAAKjH,EAQb,OAAON,GAGT,IAAIyG,EAAU3L,MAAM2L,SAAW,SAAU41E,GACvC,MAA8C,mBAAvCxmF,OAAOkB,UAAU8M,SAASvO,KAAK+mF,K,6BC3DxC,IAAIwd,EAAqB,SAASv5F,GAChC,cAAeA,GACb,IAAK,SACH,OAAOA,EAET,IAAK,UACH,OAAOA,EAAI,OAAS,QAEtB,IAAK,SACH,OAAO8a,SAAS9a,GAAKA,EAAI,GAE3B,QACE,MAAO,KAIbpL,EAAOD,QAAU,SAAS+K,EAAKw5F,EAAKC,EAAI/jG,GAOtC,OANA8jG,EAAMA,GAAO,IACbC,EAAKA,GAAM,IACC,OAARz5F,IACFA,OAAMzH,GAGW,iBAARyH,EACFyE,EAAI1E,EAAWC,GAAM,SAASuH,GACnC,IAAIuyF,EAAKhzF,mBAAmB+yF,EAAmBtyF,IAAMkyF,EACrD,OAAIhzF,EAAQzG,EAAIuH,IACP9C,EAAIzE,EAAIuH,GAAI,SAASjH,GAC1B,OAAOw5F,EAAKhzF,mBAAmB+yF,EAAmBv5F,MACjDoE,KAAK80F,GAEDM,EAAKhzF,mBAAmB+yF,EAAmB75F,EAAIuH,OAEvD7C,KAAK80F,GAIL9jG,EACEoR,mBAAmB+yF,EAAmBnkG,IAAS+jG,EAC/C3yF,mBAAmB+yF,EAAmB75F,IAF3B,IAKpB,IAAIyG,EAAU3L,MAAM2L,SAAW,SAAU41E,GACvC,MAA8C,mBAAvCxmF,OAAOkB,UAAU8M,SAASvO,KAAK+mF,IAGxC,SAAS53E,EAAK43E,EAAI/zD,GAChB,GAAI+zD,EAAG53E,IAAK,OAAO43E,EAAG53E,IAAI6jB,GAE1B,IADA,IAAI/jB,EAAM,GACDpP,EAAI,EAAGA,EAAIknF,EAAG5iF,OAAQtE,IAC7BoP,EAAI/K,KAAK8uB,EAAE+zD,EAAGlnF,GAAIA,IAEpB,OAAOoP,EAGT,IAAIxE,EAAalK,OAAOmH,MAAQ,SAAUgD,GACxC,IAAIuE,EAAM,GACV,IAAK,IAAI7N,KAAOsJ,EACVnK,OAAOkB,UAAUC,eAAe1B,KAAK0K,EAAKtJ,IAAM6N,EAAI/K,KAAK9C,GAE/D,OAAO6N,I,6BCjFT,IAAIk1B,EAAU,EAAQ,GAGlB31B,EAAkB21B,EAAQ31B,gBAE1Ba,EAAc80B,EAAQ90B,YAEtBsqF,EAAY,CAEhB,iBAA6B,CAE3B,IAAM,EACN,SAAW,EACX,aAAe,EACf,OAAS,EAET,kBAAoB,EACpB,kBAAoB,EACpB,iBAAmB,EAEnB,SAAW,EACX,MAAQ,EACR,SAAW,IAMToG,EAAapG,EAAUoG,WAAa,GA8BxC,SAAS0E,EAAkBx2F,EAAU/C,EAASuD,EAAKgqB,EAAUvqB,GAC3D,IAAIS,EAAazD,EAAQyD,WACzBzD,EAAQyD,YAAa,EACrB,IAAIM,EAAMlM,KAAK29F,eAAezyF,EAAUC,EAAQhD,EAASuD,GAMzD,OALAvD,EAAQyD,WAAaA,GAEfM,EAAIwtB,OAAShE,aAAoBp2B,UACrCo2B,EAASxpB,GAEJA,EAAIwtB,MA+Ib,SAASioE,EAAwBz2F,EAAUC,EAAQhD,EAASuD,EAAKjN,EAAU2O,GACzE,GAAIpN,KAAK+8F,MAAMv+F,OAAO0M,MAClBC,EAAO+2B,iBAA8ChiC,IAAhCiL,EAAO+2B,WAAWzjC,IAG3C,IAAoC,IAAhC0M,EAAOg3B,qBACT/0B,EAAOrB,SAAS,CACd1O,KAAM,uBACNgO,SAAU5M,EACV+E,QAAS,sBAAwBwK,KAAKC,UAAUxP,GAAY,6CAEzD,CACL,IAAI0jC,EAAuBh3B,EAAOg3B,sBAAwB,GAEhB,mBAA/Bh6B,EAAQy5F,qBACjBz5F,EAAQy5F,oBAAoB12F,EAAUzM,EAAU0jC,EAAsBh6B,EAASuD,GAGjF,IAAIQ,EAAMlM,KAAK29F,eAAezyF,EAASzM,GAAW0jC,EAAsBh6B,EAASuD,EAAImB,UAAUs1B,EAAsB1jC,IAClHyN,EAAIhB,WAAakC,EAAOlC,SAASzM,KAAW2O,EAAOlC,SAASzM,GAAYyN,EAAIhB,UAC/EkC,EAAOnB,aAAaC,IAhMxB8wF,EAAWv8F,KAAO,SAAuByK,EAAUC,EAAQhD,EAASuD,GAElE,QAAiBxL,IAAbgL,EACF,OAAO,KAET,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GACxDqxF,EAAQt6F,MAAM2L,QAAQjD,EAAO1K,MAAQ0K,EAAO1K,KAAO,CAAC0K,EAAO1K,MAC/D,IAAKs8F,EAAMh1C,KAAK/nD,KAAKy+F,SAASngG,KAAK0B,KAAMkL,EAAUC,EAAQhD,EAASuD,IAAO,CACzE,IAAIxH,EAAO64F,EAAM3wF,IAAI,SAAUnE,GAC7B,OAAOA,EAAEqD,IAAO,IAAMrD,EAAEqD,GAAK,KAASrD,EAAE,KAE1CmF,EAAOrB,SAAS,CACd1O,KAAM,OACNgO,SAAUnH,EACVV,QAAS,uBAAyBU,IAGtC,OAAOkJ,GAuBT4vF,EAAWv6D,MAAQ,SAAwBv3B,EAAUC,EAAQhD,EAASuD,GAEpE,QAAiBxL,IAAbgL,EACF,OAAO,KAET,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GACxDspE,EAAQ,IAAIvpE,EAAgBP,EAAUC,EAAQhD,EAASuD,GAC3D,IAAKjJ,MAAM2L,QAAQjD,EAAOs3B,OACxB,MAAM,IAAIn2B,EAAY,0BAExB,IAAKnB,EAAOs3B,MAAMslB,KAChB25C,EAAkBpjG,KAChB0B,KAAMkL,EAAU/C,EAASuD,EAAK,SAASQ,GAAK8oE,EAAM/oE,aAAaC,MAC3D,CACN,IAAIhI,EAAOiH,EAAOs3B,MAAMr2B,IAAI,SAAUnE,EAAGnL,GACvC,OAAQmL,EAAEqD,IAAO,IAAMrD,EAAEqD,GAAK,KAAUrD,EAAEoC,OAAS2D,KAAKC,UAAUhG,EAAEoC,QAAYpC,EAAQ,MAAM,IAAMA,EAAQ,KAAI,KAAS,cAAcnL,EAAE,MAEvIqL,EAAQ05F,cACVz0F,EAAOnB,aAAa+oE,GAEtB5nE,EAAOrB,SAAS,CACd1O,KAAM,QACNgO,SAAUnH,EACVV,QAAS,iBAAmBU,EAAKmI,KAAK,OAG1C,OAAOe,GAWT4vF,EAAWx6D,MAAQ,SAAwBt3B,EAAUC,EAAQhD,EAASuD,GAEpE,QAAiBxL,IAAbgL,EACF,OAAO,KAET,IAAKzI,MAAM2L,QAAQjD,EAAOq3B,OACxB,MAAM,IAAIl2B,EAAY,0BAExB,IAAIc,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GACxDhD,EAAO1I,KAaX,OAZAmL,EAAOq3B,MAAMl0B,QAAQ,SAASrG,EAAGnL,GAC/B,IAAI48B,EAAQhxB,EAAKi1F,eAAezyF,EAAUjD,EAAGE,EAASuD,GACtD,IAAIguB,EAAMA,MAAM,CACd,IAAIntB,EAAOtE,EAAEqD,IAAO,IAAMrD,EAAEqD,GAAK,KAAUrD,EAAEoC,OAAS2D,KAAKC,UAAUhG,EAAEoC,QAAYpC,EAAQ,MAAM,IAAMA,EAAQ,KAAI,KAAS,cAAcnL,EAAE,IAC5IsQ,EAAOrB,SAAS,CACd1O,KAAM,QACNgO,SAAU,CAAEC,GAAIiB,EAAKnL,OAAQs4B,EAAM/tB,OAAOvK,OAAQs4B,MAAOA,GACzDl2B,QAAS,+BAAiC+I,EAAM,SAAWmtB,EAAM/tB,OAAOvK,OAAS,eAEnFgM,EAAOnB,aAAaytB,MAGjBtsB,GAWT4vF,EAAWt6D,MAAQ,SAAwBx3B,EAAUC,EAAQhD,EAASuD,GAEpE,QAAiBxL,IAAbgL,EACF,OAAO,KAET,IAAKzI,MAAM2L,QAAQjD,EAAOu3B,OACxB,MAAM,IAAIp2B,EAAY,0BAExB,IAAIc,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GACxDspE,EAAQ,IAAIvpE,EAAgBP,EAAUC,EAAQhD,EAASuD,GACvDhK,EAAQyJ,EAAOu3B,MAAMvpB,OACvBuoF,EAAkBpjG,KAChB0B,KAAMkL,EAAU/C,EAASuD,EAAK,SAASQ,GAAM8oE,EAAM/oE,aAAaC,MAC5D9K,OACJ8C,EAAOiH,EAAOu3B,MAAMt2B,IAAI,SAAUnE,EAAGnL,GACvC,OAAQmL,EAAEqD,IAAO,IAAMrD,EAAEqD,GAAK,KAAUrD,EAAEoC,OAAS2D,KAAKC,UAAUhG,EAAEoC,QAAYpC,EAAQ,MAAM,IAAMA,EAAQ,KAAI,KAAS,cAAcnL,EAAE,MAY3I,OAVY,IAAR4E,IACEyG,EAAQ05F,cACVz0F,EAAOnB,aAAa+oE,GAEtB5nE,EAAOrB,SAAS,CACd1O,KAAM,QACNgO,SAAUnH,EACVV,QAAS,2BAA6BU,EAAKmI,KAAK,QAG7Ce,GAWT4vF,EAAW96D,WAAa,SAA6Bh3B,EAAUC,EAAQhD,EAASuD,GAC9E,GAAI1L,KAAK+8F,MAAMv+F,OAAO0M,GAAtB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GACxDw2B,EAAa/2B,EAAO+2B,YAAc,GACtC,IAAK,IAAIzjC,KAAYyjC,EAAY,CACW,mBAA/B/5B,EAAQy5F,qBACjBz5F,EAAQy5F,oBAAoB12F,EAAUzM,EAAUyjC,EAAWzjC,GAAW0J,EAASuD,GAGjF,IAAIgoB,EAAOl2B,OAAOmB,eAAe1B,KAAKiO,EAAUzM,GAAYyM,EAASzM,QAAYyB,EAC7EgM,EAAMlM,KAAK29F,eAAejqE,EAAMwO,EAAWzjC,GAAW0J,EAASuD,EAAImB,UAAUq1B,EAAWzjC,GAAWA,IACpGyN,EAAIhB,WAAakC,EAAOlC,SAASzM,KAAW2O,EAAOlC,SAASzM,GAAYyN,EAAIhB,UAC/EkC,EAAOnB,aAAaC,GAEtB,OAAOkB,IA0CT4vF,EAAW36D,kBAAoB,SAAoCn3B,EAAUC,EAAQhD,EAASuD,GAC5F,GAAI1L,KAAK+8F,MAAMv+F,OAAO0M,GAAtB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GACxD22B,EAAoBl3B,EAAOk3B,mBAAqB,GAEpD,IAAK,IAAI5jC,KAAYyM,EAAU,CAC7B,IAAI2C,GAAO,EACX,IAAK,IAAIL,KAAW60B,EAAmB,CAErC,GADW,IAAIh1B,OAAOG,GACZK,KAAKpP,GAAf,CAGAoP,GAAO,EAEmC,mBAA/B1F,EAAQy5F,qBACjBz5F,EAAQy5F,oBAAoB12F,EAAUzM,EAAU4jC,EAAkB70B,GAAUrF,EAASuD,GAGvF,IAAIQ,EAAMlM,KAAK29F,eAAezyF,EAASzM,GAAW4jC,EAAkB70B,GAAUrF,EAASuD,EAAImB,UAAUw1B,EAAkB70B,GAAU/O,IAC9HyN,EAAIhB,WAAakC,EAAOlC,SAASzM,KAAW2O,EAAOlC,SAASzM,GAAYyN,EAAIhB,UAC/EkC,EAAOnB,aAAaC,IAElB2B,GACF8zF,EAAuB1kG,KAAK+C,KAAMkL,EAAUC,EAAQhD,EAASuD,EAAKjN,EAAU2O,GAIhF,OAAOA,IAWT4vF,EAAW76D,qBAAuB,SAAuCj3B,EAAUC,EAAQhD,EAASuD,GAClG,GAAI1L,KAAK+8F,MAAMv+F,OAAO0M,GAAtB,CAEA,GAAIC,EAAOk3B,kBACT,OAAO,KAET,IAAIj1B,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAC5D,IAAK,IAAIjN,KAAYyM,EACnBy2F,EAAuB1kG,KAAK+C,KAAMkL,EAAUC,EAAQhD,EAASuD,EAAKjN,EAAU2O,GAE9E,OAAOA,IAST4vF,EAAW8E,cAAgB,SAAgC52F,EAAUC,EAAQhD,EAASuD,GACpF,GAAK1L,KAAK+8F,MAAMv+F,OAAO0M,GAAvB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAS5D,OARWlO,OAAOmH,KAAKuG,GACZ9J,QAAU+J,EAAO22F,eAC1B10F,EAAOrB,SAAS,CACd1O,KAAM,gBACNgO,SAAUF,EAAO22F,cACjBt+F,QAAS,4CAA8C2H,EAAO22F,gBAG3D10F,IAST4vF,EAAW+E,cAAgB,SAAgC72F,EAAUC,EAAQhD,EAASuD,GACpF,GAAK1L,KAAK+8F,MAAMv+F,OAAO0M,GAAvB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAS5D,OARWlO,OAAOmH,KAAKuG,GACZ9J,QAAU+J,EAAO42F,eAC1B30F,EAAOrB,SAAS,CACd1O,KAAM,gBACNgO,SAAUF,EAAO42F,cACjBv+F,QAAS,4CAA8C2H,EAAO42F,gBAG3D30F,IAWT4vF,EAAWl7D,MAAQ,SAAwB52B,EAAUC,EAAQhD,EAASuD,GACpE,IAAIhD,EAAO1I,KACX,GAAKA,KAAK+8F,MAAM5yF,MAAMe,IACjBC,EAAO22B,MAAZ,CACA,IAAI10B,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAkB5D,OAjBAR,EAAS4D,MAAM,SAAU/Q,EAAOjB,GAC9B,IAAIglC,EAAQr/B,MAAM2L,QAAQjD,EAAO22B,OAAU32B,EAAO22B,MAAMhlC,IAAMqO,EAAO62B,gBAAmB72B,EAAO22B,MAC/F,QAAc5hC,IAAV4hC,EACF,OAAO,EAET,IAAc,IAAVA,EAKF,OAJA10B,EAAOrB,SAAS,CACd1O,KAAM,QACNmG,QAAS,mCAEJ,EAET,IAAI0I,EAAMxD,EAAKi1F,eAAe5/F,EAAO+jC,EAAO35B,EAASuD,EAAImB,UAAUi1B,EAAOhlC,IAG1E,OAFGoP,EAAIhB,WAAakC,EAAOlC,SAASpO,KAAIsQ,EAAOlC,SAASpO,GAAKoP,EAAIhB,UACjEkC,EAAOnB,aAAaC,IACb,IAEFkB,IAST4vF,EAAWgF,QAAU,SAA0B92F,EAAUC,EAAQhD,EAASuD,GACxE,GAAK1L,KAAK+8F,MAAMttF,OAAOvE,GAAvB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAc5D,OAZIP,EAAO82F,mBAAgD,IAA5B92F,EAAO82F,iBAC5B/2F,EAAWC,EAAO62F,QAElB92F,GAAYC,EAAO62F,UAG3B50F,EAAOrB,SAAS,CACd1O,KAAM,UACNgO,SAAUF,EAAO62F,QACjBx+F,QAAS,gCAAkC2H,EAAO62F,UAG/C50F,IAST4vF,EAAWkF,QAAU,SAA0Bh3F,EAAUC,EAAQhD,EAASuD,GACxE,GAAK1L,KAAK+8F,MAAMttF,OAAOvE,GAAvB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAc5D,OAZIP,EAAOg3F,mBAAgD,IAA5Bh3F,EAAOg3F,iBAC5Bj3F,EAAWC,EAAO+2F,QAElBh3F,GAAYC,EAAO+2F,UAG3B90F,EAAOrB,SAAS,CACd1O,KAAM,UACNgO,SAAUF,EAAO+2F,QACjB1+F,QAAS,gCAAkC2H,EAAO+2F,UAG/C90F,IAWT,IAAIg1F,EAAiC,SAAyCl3F,EAAUC,EAAQhD,EAASuD,EAAK22F,EAAgBC,GAC5H,GAAKtiG,KAAK+8F,MAAMttF,OAAOvE,GAAvB,CAEA,IAAIq3F,EAAqBp3F,EAAOk3F,GAChC,GAA0B,GAAtBE,EACF,MAAM,IAAIj2F,EAAY+1F,EAAiB,mBAGzC,IAAIj1F,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAExD82F,EAAmBphE,EAAQ5xB,iBAAiBtE,GAC5Cu3F,EAAkBrhE,EAAQ5xB,iBAAiB+yF,GAE3CG,EAAczwF,KAAKsB,IAAIivF,EAAmBC,GAC1CE,EAAa1wF,KAAKwS,IAAI,GAAIi+E,GAU9B,OARIzwF,KAAKC,MAAMhH,EAAWy3F,GAAc1wF,KAAKC,MAAMqwF,EAAqBI,IAAgB,GACtFv1F,EAAOrB,SAAS,CACd1O,KAAMglG,EACNh3F,SAAWk3F,EACX/+F,QAAS8+F,EAAet0F,KAAKC,UAAUs0F,KAIpCn1F,IA2NT,SAASw1F,EAAY36F,EAAGnL,EAAG8R,GACzB,IAAI2Q,EAAG5b,EAAMiL,EAAExN,OACf,IAAKme,EAAIziB,EAAI,EAAQyiB,EAAI5b,EAAK4b,IAC5B,GAAI6hB,EAAQzyB,kBAAkB1G,EAAG2G,EAAE2Q,IACjC,OAAO,EAGX,OAAO,EAzNTy9E,EAAW6F,WAAa,SAA6B33F,EAAUC,EAAQhD,EAASuD,GAC/E,OAAO02F,EAA+BnlG,KAAK+C,KAAMkL,EAAUC,EAAQhD,EAASuD,EAAK,aAAc,yCAShGsxF,EAAW8F,YAAc,SAA8B53F,EAAUC,EAAQhD,EAASuD,GAChF,OAAO02F,EAA+BnlG,KAAK+C,KAAMkL,EAAUC,EAAQhD,EAASuD,EAAK,cAAe,uCASlGsxF,EAAW+F,SAAW,SAA2B73F,EAAUC,EAAQhD,EAASuD,GAC1E,IAAI0B,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAkB5D,YAjBiBxL,IAAbgL,IAA8C,IAApBC,EAAO43F,SAEnC31F,EAAOrB,SAAS,CACd1O,KAAM,WACNmG,QAAS,gBAEFxD,KAAK+8F,MAAMv+F,OAAO0M,IAAazI,MAAM2L,QAAQjD,EAAO43F,WAC7D53F,EAAO43F,SAASz0F,QAAQ,SAAS/P,QACd2B,IAAdgL,EAAS3M,IACV6O,EAAOrB,SAAS,CACd1O,KAAM,WACNgO,SAAU9M,EACViF,QAAS,qBAAuBwK,KAAKC,UAAU1P,OAKhD6O,GAST4vF,EAAWxvF,QAAU,SAA0BtC,EAAUC,EAAQhD,EAASuD,GACxE,GAAK1L,KAAK+8F,MAAM5/E,OAAOjS,GAAvB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAQ5D,OAPKR,EAAS6C,MAAM5C,EAAOqC,UACzBJ,EAAOrB,SAAS,CACd1O,KAAM,UACNgO,SAAUF,EAAOqC,QACjBhK,QAAS,0BAA4BwK,KAAKC,UAAU9C,EAAOqC,WAGxDJ,IAwBT4vF,EAAWrvF,OAAS,SAAyBzC,EAAUC,EAAQhD,EAASuD,GACtE,QAAexL,IAAXgL,EAAJ,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAQ5D,OAPK0B,EAAOvB,eAAkBu1B,EAAQ1zB,SAASxC,EAAUC,EAAOwC,OAAQ3N,OACtEoN,EAAOrB,SAAS,CACd1O,KAAM,SACNgO,SAAUF,EAAOwC,OACjBnK,QAAS,2BAA6BwK,KAAKC,UAAU9C,EAAOwC,QAAU,YAGnEP,IAST4vF,EAAWgG,UAAY,SAA4B93F,EAAUC,EAAQhD,EAASuD,GAC5E,GAAK1L,KAAK+8F,MAAM5/E,OAAOjS,GAAvB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GACxDu3F,EAAM/3F,EAAS6C,MAAM,oBASzB,OARa7C,EAAS9J,QAAU6hG,EAAMA,EAAI7hG,OAAS,IACnC+J,EAAO63F,WACrB51F,EAAOrB,SAAS,CACd1O,KAAM,YACNgO,SAAUF,EAAO63F,UACjBx/F,QAAS,mCAAqC2H,EAAO63F,YAGlD51F,IAST4vF,EAAWkG,UAAY,SAA4Bh4F,EAAUC,EAAQhD,EAASuD,GAC5E,GAAK1L,KAAK+8F,MAAM5/E,OAAOjS,GAAvB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAExDu3F,EAAM/3F,EAAS6C,MAAM,oBASzB,OARa7C,EAAS9J,QAAU6hG,EAAMA,EAAI7hG,OAAS,IACnC+J,EAAO+3F,WACrB91F,EAAOrB,SAAS,CACd1O,KAAM,YACNgO,SAAUF,EAAO+3F,UACjB1/F,QAAS,mCAAqC2H,EAAO+3F,YAGlD91F,IAST4vF,EAAWmG,SAAW,SAA2Bj4F,EAAUC,EAAQhD,EAASuD,GAC1E,GAAK1L,KAAK+8F,MAAM5yF,MAAMe,GAAtB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAQ5D,OAPMR,EAAS9J,QAAU+J,EAAOg4F,UAC9B/1F,EAAOrB,SAAS,CACd1O,KAAM,WACNgO,SAAUF,EAAOg4F,SACjB3/F,QAAS,mCAAqC2H,EAAOg4F,WAGlD/1F,IAST4vF,EAAWoG,SAAW,SAA2Bl4F,EAAUC,EAAQhD,EAASuD,GAC1E,GAAK1L,KAAK+8F,MAAM5yF,MAAMe,GAAtB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAQ5D,OAPMR,EAAS9J,QAAU+J,EAAOi4F,UAC9Bh2F,EAAOrB,SAAS,CACd1O,KAAM,WACNgO,SAAUF,EAAOi4F,SACjB5/F,QAAS,mCAAqC2H,EAAOi4F,WAGlDh2F,IAWT4vF,EAAWqG,YAAc,SAA8Bn4F,EAAUC,EAAQhD,EAASuD,GAChF,GAAK1L,KAAK+8F,MAAM5yF,MAAMe,GAAtB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAa5D,OANKR,EAAS4D,MANd,SAAqB7G,EAAGnL,EAAG8R,GACzB,IAAK,IAAI2Q,EAAIziB,EAAI,EAAGyiB,EAAI3Q,EAAExN,OAAQme,IAAK,GAAI6hB,EAAQzyB,kBAAkB1G,EAAG2G,EAAE2Q,IACxE,OAAO,EAET,OAAO,KAGPnS,EAAOrB,SAAS,CACd1O,KAAM,cACNmG,QAAS,4BAGN4J,IA0BT4vF,EAAWqG,YAAc,SAA8Bn4F,EAAUC,EAAQhD,EAASuD,GAChF,GAAK1L,KAAK+8F,MAAM5yF,MAAMe,GAAtB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAO5D,OANKR,EAAS4D,MAAM8zF,IAClBx1F,EAAOrB,SAAS,CACd1O,KAAM,cACNmG,QAAS,4BAGN4J,IAWT4vF,EAAW16D,aAAe,SAA+Bp3B,EAAUC,EAAQhD,EAASuD,GAClF,GAAK1L,KAAK+8F,MAAMv+F,OAAO0M,GAAvB,CACA,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAC5D,IAAK,IAAIjN,KAAY0M,EAAOm3B,aAC1B,QAA2BpiC,IAAvBgL,EAASzM,GAAb,CAGA,IAAI6kG,EAAMn4F,EAAOm3B,aAAa7jC,GAC1B8kG,EAAe73F,EAAImB,UAAUy2F,EAAK7kG,GAItC,GAHkB,iBAAP6kG,IACTA,EAAM,CAACA,IAEL7gG,MAAM2L,QAAQk1F,GAChBA,EAAIh1F,QAAQ,SAAUolB,QACGxzB,IAAnBgL,EAASwoB,IACXtmB,EAAOrB,SAAS,CAGd1O,KAAM,eACNgO,SAAUk4F,EAAan4F,aACvB5H,QAAS,YAAckwB,EAAO,2BAA6B6vE,EAAan4F,qBAIzE,CACL,IAAIc,EAAMlM,KAAK29F,eAAezyF,EAAUo4F,EAAKn7F,EAASo7F,GACnDn2F,EAAOlC,WAAagB,EAAIhB,WAAUkC,EAAOlC,SAAWgB,EAAIhB,UACvDgB,GAAOA,EAAIP,OAAOvK,SACpBgM,EAAOrB,SAAS,CACd1O,KAAM,eACNgO,SAAUk4F,EAAan4F,aACvB5H,QAAS,wCAA0C+/F,EAAan4F,eAElEgC,EAAOnB,aAAaC,KAI1B,OAAOkB,IAUT4vF,EAAiB,KAAI,SAAuB9xF,EAAUC,EAAQhD,EAASuD,GACrE,QAAiBxL,IAAbgL,EACF,OAAO,KAET,IAAKzI,MAAM2L,QAAQjD,EAAa,MAC9B,MAAM,IAAImB,EAAY,wBAAyBnB,GAEjD,IAAIiC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAQ5D,OAPKP,EAAa,KAAE48C,KAAK3mB,EAAQzyB,kBAAkBrQ,KAAK,KAAM4M,KAC5DkC,EAAOrB,SAAS,CACd1O,KAAM,OACNgO,SAAUF,EAAa,KACvB3H,QAAS,8BAAgC2H,EAAa,KAAEiB,IAAI5K,QAAQ6K,KAAK,OAGtEe,GAUT4vF,EAAkB,MAAI,SAAuB9xF,EAAUC,EAAQhD,EAASuD,GACtE,QAAiBxL,IAAbgL,EACF,OAAO,KAET,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GAQ5D,OAPK01B,EAAQzyB,kBAAkBxD,EAAc,MAAGD,IAC9CkC,EAAOrB,SAAS,CACd1O,KAAM,QACNgO,SAAUF,EAAc,MACxB3H,QAAS,6CAA+C2H,EAAc,QAGnEiC,GAWT4vF,EAAWr6D,IAAMq6D,EAAWz6D,SAAW,SAAsBr3B,EAAUC,EAAQhD,EAASuD,GACtF,IAAIhD,EAAO1I,KACX,QAAcE,IAAXgL,EAAsB,OAAO,KAChC,IAAIkC,EAAS,IAAI3B,EAAgBP,EAAUC,EAAQhD,EAASuD,GACxD83F,EAAWr4F,EAAOw3B,KAAOx3B,EAAOo3B,SACpC,OAAIihE,GACA/gG,MAAM2L,QAAQo1F,KAAWA,EAAS,CAACA,IACvCA,EAASl1F,QAAQ,SAAU7N,GACzB,GAAIiI,EAAK+1F,SAASvzF,EAAUC,EAAQhD,EAASuD,EAAKjL,GAAO,CACvD,IAAIgjG,EAAWhjG,GAAQA,EAAK6K,IAAO,IAAM7K,EAAK6K,GAAK,KAAQ7K,EAC3D2M,EAAOrB,SAAS,CACd1O,KAAM,MACNgO,SAAUo4F,EACVjgG,QAAS,yBAA2BigG,OAInCr2F,GAZc,MAevBvQ,EAAOD,QAAUg6F,G,8ECnzBjB,cAEA,SACA,QAyBA,SAAgB8M,EAAeruF,GAC7B,MAAMgB,EAAsBtQ,SAASiK,eAAe,mBAAmB6F,cACvE9P,SAASiK,eAAe,mBAAmBc,SAC3CuF,EAAO1V,QAAQ,EAAAgjG,oBACf59F,SAASiK,eAAe,qBAAqB4L,UAAY,EAAAgoF,cACzDC,EAAWxuF,GACXyuF,EAAkBzuF,GAElB,MAAM0uF,EAAqBh+F,SAASO,cAAc,KAC5C09F,EAAUj+F,SAASO,cAAc,MACvC09F,EAAQvzF,UAAUQ,IAAI,oBACtB8yF,EAAmBtzF,UAAUQ,IAAI,iBACjC8yF,EAAmBz4F,GAAK,sBACxBy4F,EAAmB7yF,YAAc,oBAChCnL,SAASwM,uBAAuB,oBAAqB,GAAG3L,YAAYo9F,GACpEj+F,SAASwM,uBAAuB,oBAAqB,GAAG3L,YAAYm9F,GAMvE,SAAgBF,EAAYxuF,GAE1BtP,SAASiK,eAAe,QAAQM,iBAAiB,QAAS,KACxD+E,EAAS4uF,OAAO17E,KAAK,KACnBtM,EAAamN,kBAAkB,aAGnCrjB,SAAS6K,KAAKN,iBAAiB,UAAYC,IACzB,MAAZA,EAAIlS,KACNgX,EAAS4uF,OAAO17E,KAAK,KACnBtM,EAAamN,kBAAkB,aAKrCrjB,SAASiK,eAAe,UAAUM,iBAAiB,QAAS,KAC1D+E,EAAS6uF,SAAS37E,KAAK6nD,IACrB,MAAMmrB,EAA0Bx1F,SAASO,cAAc,KACvDi1F,EAAKx+D,KAAOqzC,EACZmrB,EAAK4I,SAAW9uF,EAAShY,KAAO,UAChC0I,SAAS6K,KAAKhK,YAAY20F,GAC1BA,EAAKlkB,QACLkkB,EAAKzqF,SACLmL,EAAamN,kBAAkB,aAInCrjB,SAASiK,eAAe,UAAUM,iBAAiB,QAAS,WACtD9I,OAAO48F,QAAQ,uEACjB/uF,EAASu8D,WAAWrpD,KAAK,KACvB/gB,OAAO6kF,SAASgY,aAMtBt+F,SAASiK,eAAe,UAAUM,iBAAiB,QAAS,KAC1D,MAAMtF,EAAMqK,EAASE,KAAKC,oBAC1BH,EAASivF,WAAWt5F,GAAKud,KAAKupD,IAC5B,MAAM3rE,EAAO,mCAAqCqB,OAAOmqC,KAAK,EAAA4yD,iBAAiBzyB,IAC/E/rE,SAASiK,eAAe,UAAU4C,aAAa,OAAQzM,GACvDJ,SAASiK,eAAe,UAAU4C,aAAa,WAAYyC,EAASE,KAAKivF,cAAgB,YAQ/F,SAAgBV,EAAmBzuF,GAkBjC,SAASovF,IACPpvF,EAASi8D,OAAO/oD,KAAMnb,IAChBA,EACFiI,EAASmT,uBAET7mB,QAAQ0B,MAAM,2BAQpB,SAASqhG,IACPrvF,EAASg8D,OAAO9oD,KAAMnb,IAChBA,EACFiI,EAASmT,uBAET7mB,QAAQ0B,MAAM,2BAnCpB0C,SAASiK,eAAe,QAAQM,iBAAiB,QAASm0F,GAC1D1+F,SAAS6K,KAAKN,iBAAiB,UAAYC,IACzB,MAAZA,EAAIlS,MAAgBkS,EAAI8zB,SAAW9zB,EAAI6zB,UACzCqgE,MAIJ1+F,SAASiK,eAAe,QAAQM,iBAAiB,QAASo0F,GAC1D3+F,SAAS6K,KAAKN,iBAAiB,UAAYC,KACxB,MAAZA,EAAIlS,KAA4B,MAAZkS,EAAIlS,KAAekS,EAAIozB,YAAepzB,EAAI8zB,SAAW9zB,EAAI6zB,UAChFsgE,MArGN,2BAAiCrvF,GAC/B,MAAMgB,EAAStQ,SAASiK,eAAe,mBACjC20F,EAAW5+F,SAASO,cAAc,KACxCq+F,EAASl0F,UAAUQ,IAAI,eACvB,MAAM2zF,EAAa7+F,SAASO,cAAc,UAC1Cs+F,EAAWn0F,UAAUQ,IAAI,UACzB2zF,EAAWt5F,GAAK,YAChBs5F,EAAW1zF,YAAc,WACzByzF,EAAS/9F,YAAYg+F,GACrBvuF,EAAOzP,YAAY+9F,GAEnBC,EAAWt0F,iBAAiB,QAAS,KACnCozF,EAAcruF,MAQlB,kBAqBA,eAiDA,uB,8EC/Fa,EAAAsuF,mBAAqC59F,SAASO,cAAc,OACzE,EAAAq9F,mBAAmBlzF,UAAUQ,IAAI,cAAe,eAAgB,gBAChE,MAAM4zF,EAAW9+F,SAASO,cAAc,KACxCu+F,EAASp0F,UAAUQ,IAAI,eACvB4zF,EAAS3zF,YAAc,OACvB,MAAM4zF,EAAiB/+F,SAASO,cAAc,OAC9Cw+F,EAAer0F,UAAUQ,IAAI,mBAC7B6zF,EAAex5F,GAAK,0BACH,CAAC,CAAC,OAAQ,QAAS,CAAC,SAAU,2BAC7C,CAAC,SAAU,gBAAiB,CAAC,SAAU,WAChCgD,QAAQugB,IACf,MAAM0nB,EAAOxwC,SAASO,cAAc,KACpCiwC,EAAKjrC,GAAKujB,EAAQ,GAClB0nB,EAAK9lC,UAAUQ,IAAI,eACnBslC,EAAKrlC,YAAc2d,EAAQ,GAC3Bi2E,EAAel+F,YAAY2vC,KAE7B,EAAAotD,mBAAmB/8F,YAAYi+F,GAC/B,EAAAlB,mBAAmB/8F,YAAYk+F,GAKlB,EAAAC,eACT,0DAKS,EAAAnB,cACT,iM,8ECzBgB,EAAA14E,QARpBhW,iBACE,MAAMmnD,QAAiBta,MAAM,sCAC7Bh8C,SAAS6K,KAAKgL,gBAAkBygD,EAASxhC,OACxC90B,SAASiK,eAAe,aACtB+sB,KAAO,qCACVh3B,SAASiK,eAAe,gBAAgBkB,YAAc,qB,8ECLxD,aAEA,MAAa8zF,EASX,YAAaC,EAAoBC,GAC/BllG,KAAK4O,EAAI,EACT5O,KAAK6O,EAAI,EACT7O,KAAK7C,EAAI8nG,EACTjlG,KAAK5C,EAAI8nG,EAETllG,KAAKilG,WAAaA,EAClBjlG,KAAKklG,YAAcA,EAGrB,IAAK5jG,EAAWoY,EAAWE,EAAWurF,GACpCnlG,KAAK4O,EAAItN,EACTtB,KAAK6O,EAAI6K,EACT1Z,KAAK7C,EAAIyc,EACT5Z,KAAK5C,EAAI+nG,EAGX,MACE,OAAOnlG,KAAK4O,EAAEpD,WAAa,IAAMxL,KAAK6O,EAAErD,WAAa,IACnDxL,KAAK7C,EAAI,IAAM6C,KAAK5C,EAGxB,OAAQ8R,GACN,MAAMk2F,EAAcplG,KAAKklG,YAAch2F,EACjCm2F,EAAarlG,KAAKilG,WAAa/1F,EAErClP,KAAK7C,EAAIkoG,EACTrlG,KAAK5C,EAAIgoG,EAGX,UACE,OAAOplG,KAAKilG,WAAajlG,KAAK7C,EAGhC,UAAWmvB,EAAeC,GACxBvsB,KAAK4O,GAAK0d,EACVtsB,KAAK6O,GAAK0d,GA7Cd,YAiDA,MAAa+4E,EAQX,kBACE,MAAMC,EAAQx/F,SAASiK,eAAe,SACtChQ,KAAKwlG,QAAU,IAAIR,EAAQ73F,SAASo4F,EAAMjyF,aAAa,UAAWnG,SAASo4F,EAAMjyF,aAAa,YAE9FtT,KAAKylG,gBAMP,OAAQv2F,GACNlP,KAAK0lG,aACL1lG,KAAKwlG,QAAQvyF,OAAO/D,GACpBlP,KAAKylG,gBAMP,UAAWn5E,EAAeC,GACxBvsB,KAAK0lG,aACL1lG,KAAKwlG,QAAQG,UAAUr5E,EAAOC,GAC9BvsB,KAAKylG,gBAMP,6BACuBvlG,IAAjBF,KAAKwlG,QACPxlG,KAAKkT,kBAELlT,KAAKylG,gBAOT,aACE,QAAqBvlG,IAAjBF,KAAKwlG,QAAuB,CAC9B,MAAMD,EAAQx/F,SAASiK,eAAe,SACtChQ,KAAKwlG,QAAU,IAAIR,EAAQ73F,SAASo4F,EAAMjyF,aAAa,UAAWnG,SAASo4F,EAAMjyF,aAAa,YAEhG,MAAMsyF,EAAa7/F,SAASiK,eAAe,aACxCsD,aAAa,WACblE,MAAM,KACTpP,KAAKwlG,QAAQ1iG,IACXqK,SAASy4F,EAAW,IACpBz4F,SAASy4F,EAAW,IACpBz4F,SAASy4F,EAAW,IACpBz4F,SAASy4F,EAAW,KAOxB,gBACE7/F,SAASiK,eAAe,aAAa4C,aAAa,UAAW5S,KAAKwlG,QAAQ7nG,OAG5E,YACE,MAAMma,EAAQ/R,SAASiK,eAAe,aACtChQ,KAAK6lG,gBAAkB/tF,EAAM0sB,iBACP,eAAlBv7B,EAAGsiB,MAAM9qB,MAEXT,KAAK6lG,gBAAgBnsF,EAAIzQ,EAAGsiB,MAAMwrD,QAAQ,GAAG3xC,QAC7CplC,KAAK6lG,gBAAgBjsF,EAAI3Q,EAAGsiB,MAAMwrD,QAAQ,GAAG1xC,UAG7CrlC,KAAK6lG,gBAAgBnsF,EAAIzQ,EAAGsiB,MAAM7R,EAClC1Z,KAAK6lG,gBAAgBjsF,EAAI3Q,EAAGsiB,MAAM3R,GAGpC5Z,KAAK8lG,OAAShuF,EAAM8sB,eAAeE,UAGrC,WACE,MAAMhtB,EAAQ/R,SAASiK,eAAe,aAChC+1F,EAAiBjuF,EAAM0sB,iBAEP,cAAlBv7B,EAAGsiB,MAAM9qB,MACXslG,EAAersF,EAAIzQ,EAAGsiB,MAAMwrD,QAAQ,GAAG3xC,QACvC2gE,EAAensF,EAAI3Q,EAAGsiB,MAAMwrD,QAAQ,GAAG1xC,SACZ,UAAlBp8B,EAAGsiB,MAAM9qB,OAA0C,IAAtBwI,EAAGsiB,MAAMoY,eAC3BzjC,IAAhBF,KAAK8lG,SACP9lG,KAAK8lG,OAAShuF,EAAM8sB,eAAeE,gBAER5kC,IAAzBF,KAAK6lG,kBACP7lG,KAAK6lG,gBAAkB/tF,EAAM0sB,kBAE/BxkC,KAAK6lG,gBAAgBnsF,EAAIzQ,EAAGsiB,MAAM7R,EAClC1Z,KAAK6lG,gBAAgBjsF,EAAI3Q,EAAGsiB,MAAM3R,EAClCmsF,EAAersF,EAAI1Z,KAAK6lG,gBAAgBnsF,EAAIzQ,EAAGsiB,MAAMy6E,OACrDD,EAAensF,EAAI5Z,KAAK6lG,gBAAgBjsF,EAAI3Q,EAAGsiB,MAAM06E,OACrDh9F,EAAGsiB,MAAMzC,mBAETi9E,EAAersF,EAAIzQ,EAAGsiB,MAAM7R,EAC5BqsF,EAAensF,EAAI3Q,EAAGsiB,MAAM3R,GAE9B,MAAMssF,EAAeH,EAAelhE,gBAAgB7kC,KAAK8lG,QACnDK,EAAgBnmG,KAAK6lG,gBAAgBhhE,gBAAgB7kC,KAAK8lG,QAChE9lG,KAAK2lG,WAAWO,EAAaxsF,EAAIysF,EAAczsF,GAAIwsF,EAAatsF,EAAIusF,EAAcvsF,GAClF5Z,KAAK6lG,gBAAkBE,EAGzB,aACE,GAAsB,UAAlB98F,EAAGsiB,MAAM9qB,KAAkB,OAC/B,IAAKwI,EAAGsiB,MAAMoY,SAEZ,YADA3jC,KAAK0rB,WAGP,MAAM06E,EAASrgG,SAASiK,eAAe,cACvChQ,KAAK0lG,aAEL,IAAIW,EADMrmG,KAAKwlG,QAAQc,UACRr9F,EAAGsiB,MAAMy6E,OAAS,IAC7BK,EAAOl5F,SAASi5F,EAAO9yF,aAAa,QAAU,MAAK+yF,EAAO,KAC1DA,EAAOl5F,SAASi5F,EAAO9yF,aAAa,QAAU,MAAK+yF,EAAO,GAC9DrmG,KAAKiT,OAAOozF,GAGZD,EAAOroG,OAAgB,IAAPsoG,GAAY76F,WAC3BzF,SAASiK,eAAe,cAAoCjS,MAAQyD,OAAOyQ,KAAKC,MAAa,IAAPm0F,KAnI3F,gBAuIwB,EAAAn7E,QAAA,G,8ECrLxB,mCACQ1jB,OAAO48F,QAAQ,4FACnBr+F,SAASiK,eAAe,QAAQqnE,U,8ECPpC,cAGA,QACA,QAGA,qBAIE,YAAahiE,EAAoBc,GA0BjC,KAAAzS,SAAY6M,IACV,MAAMjF,EAAKtL,KAAKmW,MAAM7K,GAEhBg5B,EAAYtkC,KAAKmW,MAAMnB,QAAQ,qBAC/BuvB,EAAKD,EAAUE,iBACrBD,EAAG7qB,EAAInJ,EAAIk0B,QACXF,EAAG3qB,EAAIrJ,EAAIm0B,QAGX,MAAMC,EAAmBL,EAAU/xB,uBAAuB,UAAU,GACjEqyB,eAAeE,UACZyhE,EAAWhiE,EAAGM,gBAAgBF,GAI9Bna,EAA6B,CACjC,OAAU,QACV,MAAS,CACP,UAAalf,EACb,EAAKi7F,EAAS7sF,IAIlB1Z,KAAKqV,SAASiT,KAAKkC,EAAcxqB,KAAKqV,SAASE,KAAKC,qBAAqB+S,KAAKrT,MAAO9H,IAC/EA,UACIpN,KAAKqV,SAASyV,8BACpB7O,EAAamN,kBAAkB,4BAEjC,IAAIvU,EAAc,IAAI,UAAY7U,KAAKqV,SAAU,UACjDrV,KAAKwmG,eACL,EAAAlyF,UAAU,CAACvO,SAAS6L,cAAc,IAAMtG,IAAqBtL,KAAKqV,SAAUR,GAC5E,IACE9O,SAASiK,eAAe,YAAY4L,UAAY,GAChD7V,SAASiK,eAAe,YAAYS,UAAUQ,IAAI,gBAClD,MAAO1J,SAEVjJ,KAAK0B,MAGR,KAAAsrF,iBAAoB/6E,IACF,WAAZA,EAAIlS,IACN2B,KAAKwmG,eACgB,UAAZj2F,EAAIlS,KACb0H,SAAS6K,KAAKU,oBAAoB,QAAStR,KAAK0D,QAAS,CAAE+iG,SAAS,MAErEnoG,KAAK0B,MAGR,KAAAwrF,kBAAqBj7E,IAEoB,OADxBA,EAAIpR,OACR6V,QAAQ,kBACjBhV,KAAKwmG,eACLzgG,SAAS6K,KAAKU,oBAAoB,QAAStR,KAAK0D,QAAS,CAAE+iG,SAAS,OAErEnoG,KAAK0B,MAGR,KAAA0mG,cAAiBn2F,IACC,UAAZA,EAAIlS,KACN0H,SAAS6K,KAAKN,iBAAiB,QAAStQ,KAAK0D,QAAS,CAAE+iG,SAAS,MAElEnoG,KAAK0B,MAtFNA,KAAKqV,SAAWA,EAChBrV,KAAKmW,MAAQA,EAGf,aACEnW,KAAKwmG,eAELzgG,SAAS6K,KAAKN,iBAAiB,QAAStQ,KAAK0D,QAAS,CAAE+iG,SAAS,IAGjE1gG,SAAS6K,KAAKN,iBAAiB,UAAWtQ,KAAKsrF,iBAC/CvlF,SAAS6K,KAAKN,iBAAiB,QAAStQ,KAAK0mG,cAC7C3gG,SAAS6K,KAAKN,iBAAiB,QAAStQ,KAAKwrF,kBAE7CvvE,EAAamN,kBAAkB,wBAGjC,eACErjB,SAAS6K,KAAKU,oBAAoB,UAAWtR,KAAKsrF,iBAClDvlF,SAAS6K,KAAKU,oBAAoB,QAAStR,KAAK0mG,cAChD3gG,SAAS6K,KAAKU,oBAAoB,QAAStR,KAAKwrF,kBAChDzlF,SAAS6K,KAAKU,oBAAoB,QAAStR,KAAK0D,QAAS,CAAE+iG,SAAS","file":"editor.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 57);\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = $getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  var args = [];\n  for (var i = 0; i < arguments.length; i++) args.push(arguments[i]);\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    ReflectApply(this.listener, this.target, args);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a duplex stream is just a stream that is both readable and writable.\n// Since JS doesn't have multiple prototypal inheritance, this class\n// prototypally inherits from Readable, and then parasitically from\n// Writable.\n\n'use strict';\n\n/*<replacement>*/\n\nvar pna = require('process-nextick-args');\n/*</replacement>*/\n\n/*<replacement>*/\nvar objectKeys = Object.keys || function (obj) {\n  var keys = [];\n  for (var key in obj) {\n    keys.push(key);\n  }return keys;\n};\n/*</replacement>*/\n\nmodule.exports = Duplex;\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nvar Readable = require('./_stream_readable');\nvar Writable = require('./_stream_writable');\n\nutil.inherits(Duplex, Readable);\n\n{\n  // avoid scope creep, the keys array can then be collected\n  var keys = objectKeys(Writable.prototype);\n  for (var v = 0; v < keys.length; v++) {\n    var method = keys[v];\n    if (!Duplex.prototype[method]) Duplex.prototype[method] = Writable.prototype[method];\n  }\n}\n\nfunction Duplex(options) {\n  if (!(this instanceof Duplex)) return new Duplex(options);\n\n  Readable.call(this, options);\n  Writable.call(this, options);\n\n  if (options && options.readable === false) this.readable = false;\n\n  if (options && options.writable === false) this.writable = false;\n\n  this.allowHalfOpen = true;\n  if (options && options.allowHalfOpen === false) this.allowHalfOpen = false;\n\n  this.once('end', onend);\n}\n\nObject.defineProperty(Duplex.prototype, 'writableHighWaterMark', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function () {\n    return this._writableState.highWaterMark;\n  }\n});\n\n// the no-half-open enforcer\nfunction onend() {\n  // if we allow half-open state, or if the writable side ended,\n  // then we're ok.\n  if (this.allowHalfOpen || this._writableState.ended) return;\n\n  // no more data can be written.\n  // But allow more writes to happen in this tick.\n  pna.nextTick(onEndNT, this);\n}\n\nfunction onEndNT(self) {\n  self.end();\n}\n\nObject.defineProperty(Duplex.prototype, 'destroyed', {\n  get: function () {\n    if (this._readableState === undefined || this._writableState === undefined) {\n      return false;\n    }\n    return this._readableState.destroyed && this._writableState.destroyed;\n  },\n  set: function (value) {\n    // we ignore the value if the stream\n    // has not been initialized yet\n    if (this._readableState === undefined || this._writableState === undefined) {\n      return;\n    }\n\n    // backward compatibility, the user is explicitly\n    // managing destroyed\n    this._readableState.destroyed = value;\n    this._writableState.destroyed = value;\n  }\n});\n\nDuplex.prototype._destroy = function (err, cb) {\n  this.push(null);\n  this.end();\n\n  pna.nextTick(cb, err);\n};","module.exports = d3;","'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","'use strict';\n\nvar uri = require('url');\n\nvar ValidationError = exports.ValidationError = function ValidationError (message, instance, schema, propertyPath, name, argument) {\n  if (propertyPath) {\n    this.property = propertyPath;\n  }\n  if (message) {\n    this.message = message;\n  }\n  if (schema) {\n    if (schema.id) {\n      this.schema = schema.id;\n    } else {\n      this.schema = schema;\n    }\n  }\n  if (instance) {\n    this.instance = instance;\n  }\n  this.name = name;\n  this.argument = argument;\n  this.stack = this.toString();\n};\n\nValidationError.prototype.toString = function toString() {\n  return this.property + ' ' + this.message;\n};\n\nvar ValidatorResult = exports.ValidatorResult = function ValidatorResult(instance, schema, options, ctx) {\n  this.instance = instance;\n  this.schema = schema;\n  this.propertyPath = ctx.propertyPath;\n  this.errors = [];\n  this.throwError = options && options.throwError;\n  this.disableFormat = options && options.disableFormat === true;\n};\n\nValidatorResult.prototype.addError = function addError(detail) {\n  var err;\n  if (typeof detail == 'string') {\n    err = new ValidationError(detail, this.instance, this.schema, this.propertyPath);\n  } else {\n    if (!detail) throw new Error('Missing error detail');\n    if (!detail.message) throw new Error('Missing error message');\n    if (!detail.name) throw new Error('Missing validator type');\n    err = new ValidationError(detail.message, this.instance, this.schema, this.propertyPath, detail.name, detail.argument);\n  }\n\n  if (this.throwError) {\n    throw err;\n  }\n  this.errors.push(err);\n  return err;\n};\n\nValidatorResult.prototype.importErrors = function importErrors(res) {\n  if (typeof res == 'string' || (res && res.validatorType)) {\n    this.addError(res);\n  } else if (res && res.errors) {\n    Array.prototype.push.apply(this.errors, res.errors);\n  }\n};\n\nfunction stringizer (v,i){\n  return i+': '+v.toString()+'\\n';\n}\nValidatorResult.prototype.toString = function toString(res) {\n  return this.errors.map(stringizer).join('');\n};\n\nObject.defineProperty(ValidatorResult.prototype, \"valid\", { get: function() {\n  return !this.errors.length;\n} });\n\n/**\n * Describes a problem with a Schema which prevents validation of an instance\n * @name SchemaError\n * @constructor\n */\nvar SchemaError = exports.SchemaError = function SchemaError (msg, schema) {\n  this.message = msg;\n  this.schema = schema;\n  Error.call(this, msg);\n  Error.captureStackTrace(this, SchemaError);\n};\nSchemaError.prototype = Object.create(Error.prototype,\n  { constructor: {value: SchemaError, enumerable: false}\n  , name: {value: 'SchemaError', enumerable: false}\n  });\n\nvar SchemaContext = exports.SchemaContext = function SchemaContext (schema, options, propertyPath, base, schemas) {\n  this.schema = schema;\n  this.options = options;\n  this.propertyPath = propertyPath;\n  this.base = base;\n  this.schemas = schemas;\n};\n\nSchemaContext.prototype.resolve = function resolve (target) {\n  return uri.resolve(this.base, target);\n};\n\nSchemaContext.prototype.makeChild = function makeChild(schema, propertyName){\n  var propertyPath = (propertyName===undefined) ? this.propertyPath : this.propertyPath+makeSuffix(propertyName);\n  var base = uri.resolve(this.base, schema.id||'');\n  var ctx = new SchemaContext(schema, this.options, propertyPath, base, Object.create(this.schemas));\n  if(schema.id && !ctx.schemas[base]){\n    ctx.schemas[base] = schema;\n  }\n  return ctx;\n}\n\nvar FORMAT_REGEXPS = exports.FORMAT_REGEXPS = {\n  'date-time': /^\\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\\.\\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,\n  'date': /^\\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,\n  'time': /^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,\n\n  'email': /^(?:[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+\\.)*[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!\\.)){0,61}[a-zA-Z0-9]?\\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\\[(?:(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\.){3}(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\]))$/,\n  'ip-address': /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,\n  'ipv6': /^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/,\n  'uri': /^[a-zA-Z][a-zA-Z0-9+-.]*:[^\\s]*$/,\n\n  'color': /^(#?([0-9A-Fa-f]{3}){1,2}\\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\\(\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*\\))|(rgb\\(\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*\\)))$/,\n\n  // hostname regex from: http://stackoverflow.com/a/1420225/5628\n  'hostname': /^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\\.?$/,\n  'host-name': /^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\\.?$/,\n\n  'alpha': /^[a-zA-Z]+$/,\n  'alphanumeric': /^[a-zA-Z0-9]+$/,\n  'utc-millisec': function (input) {\n    return (typeof input === 'string') && parseFloat(input) === parseInt(input, 10) && !isNaN(input);\n  },\n  'regex': function (input) {\n    var result = true;\n    try {\n      new RegExp(input);\n    } catch (e) {\n      result = false;\n    }\n    return result;\n  },\n  'style': /\\s*(.+?):\\s*([^;]+);?/g,\n  'phone': /^\\+(?:[0-9] ?){6,14}[0-9]$/\n};\n\nFORMAT_REGEXPS.regexp = FORMAT_REGEXPS.regex;\nFORMAT_REGEXPS.pattern = FORMAT_REGEXPS.regex;\nFORMAT_REGEXPS.ipv4 = FORMAT_REGEXPS['ip-address'];\n\nexports.isFormat = function isFormat (input, format, validator) {\n  if (typeof input === 'string' && FORMAT_REGEXPS[format] !== undefined) {\n    if (FORMAT_REGEXPS[format] instanceof RegExp) {\n      return FORMAT_REGEXPS[format].test(input);\n    }\n    if (typeof FORMAT_REGEXPS[format] === 'function') {\n      return FORMAT_REGEXPS[format](input);\n    }\n  } else if (validator && validator.customFormats &&\n      typeof validator.customFormats[format] === 'function') {\n    return validator.customFormats[format](input);\n  }\n  return true;\n};\n\nvar makeSuffix = exports.makeSuffix = function makeSuffix (key) {\n  key = key.toString();\n  // This function could be capable of outputting valid a ECMAScript string, but the\n  // resulting code for testing which form to use would be tens of thousands of characters long\n  // That means this will use the name form for some illegal forms\n  if (!key.match(/[.\\s\\[\\]]/) && !key.match(/^[\\d]/)) {\n    return '.' + key;\n  }\n  if (key.match(/^\\d+$/)) {\n    return '[' + key + ']';\n  }\n  return '[' + JSON.stringify(key) + ']';\n};\n\nexports.deepCompareStrict = function deepCompareStrict (a, b) {\n  if (typeof a !== typeof b) {\n    return false;\n  }\n  if (a instanceof Array) {\n    if (!(b instanceof Array)) {\n      return false;\n    }\n    if (a.length !== b.length) {\n      return false;\n    }\n    return a.every(function (v, i) {\n      return deepCompareStrict(a[i], b[i]);\n    });\n  }\n  if (typeof a === 'object') {\n    if (!a || !b) {\n      return a === b;\n    }\n    var aKeys = Object.keys(a);\n    var bKeys = Object.keys(b);\n    if (aKeys.length !== bKeys.length) {\n      return false;\n    }\n    return aKeys.every(function (v) {\n      return deepCompareStrict(a[v], b[v]);\n    });\n  }\n  return a === b;\n};\n\nfunction deepMerger (target, dst, e, i) {\n  if (typeof e === 'object') {\n    dst[i] = deepMerge(target[i], e)\n  } else {\n    if (target.indexOf(e) === -1) {\n      dst.push(e)\n    }\n  }\n}\n\nfunction copyist (src, dst, key) {\n  dst[key] = src[key];\n}\n\nfunction copyistWithDeepMerge (target, src, dst, key) {\n  if (typeof src[key] !== 'object' || !src[key]) {\n    dst[key] = src[key];\n  }\n  else {\n    if (!target[key]) {\n      dst[key] = src[key];\n    } else {\n      dst[key] = deepMerge(target[key], src[key])\n    }\n  }\n}\n\nfunction deepMerge (target, src) {\n  var array = Array.isArray(src);\n  var dst = array && [] || {};\n\n  if (array) {\n    target = target || [];\n    dst = dst.concat(target);\n    src.forEach(deepMerger.bind(null, target, dst));\n  } else {\n    if (target && typeof target === 'object') {\n      Object.keys(target).forEach(copyist.bind(null, target, dst));\n    }\n    Object.keys(src).forEach(copyistWithDeepMerge.bind(null, target, src, dst));\n  }\n\n  return dst;\n};\n\nmodule.exports.deepMerge = deepMerge;\n\n/**\n * Validates instance against the provided schema\n * Implements URI+JSON Pointer encoding, e.g. \"%7e\"=\"~0\"=>\"~\", \"~1\"=\"%2f\"=>\"/\"\n * @param o\n * @param s The path to walk o along\n * @return any\n */\nexports.objectGetPath = function objectGetPath(o, s) {\n  var parts = s.split('/').slice(1);\n  var k;\n  while (typeof (k=parts.shift()) == 'string') {\n    var n = decodeURIComponent(k.replace(/~0/,'~').replace(/~1/g,'/'));\n    if (!(n in o)) return;\n    o = o[n];\n  }\n  return o;\n};\n\nfunction pathEncoder (v) {\n  return '/'+encodeURIComponent(v).replace(/~/g,'%7E');\n}\n/**\n * Accept an Array of property names and return a JSON Pointer URI fragment\n * @param Array a\n * @return {String}\n */\nexports.encodePath = function encodePointer(a){\n\t// ~ must be encoded explicitly because hacks\n\t// the slash is encoded by encodeURIComponent\n\treturn a.map(pathEncoder).join('');\n};\n\n\n/**\n * Calculate the number of decimal places a number uses\n * We need this to get correct results out of multipleOf and divisibleBy\n * when either figure is has decimal places, due to IEEE-754 float issues.\n * @param number\n * @returns {number}\n */\nexports.getDecimalPlaces = function getDecimalPlaces(number) {\n\n  var decimalPlaces = 0;\n  if (isNaN(number)) return decimalPlaces;\n\n  if (typeof number !== 'number') {\n    number = Number(number);\n  }\n\n  var parts = number.toString().split('e');\n  if (parts.length === 2) {\n    if (parts[1][0] !== '-') {\n      return decimalPlaces;\n    } else {\n      decimalPlaces = Number(parts[1].slice(1));\n    }\n  }\n\n  var decimalParts = parts[0].split('.');\n  if (decimalParts.length === 2) {\n    decimalPlaces += decimalParts[1].length;\n  }\n\n  return decimalPlaces;\n};\n\n","/** @module DisplayPanel/DisplayControls */\n\nimport * as Color from '../utils/Color';\nimport ZoomHandler from '../SingleView/Zoom';\n\nlet lastGlyphOpacity: number, lastImageOpacity: number;\n\n/**\n * Initialize listeners and controls for display panel.\n * @param {string} meiClassName - The class used to signifiy the MEI element(s).\n * @param {string} background - The class used to signify the background.\n */\nexport function initDisplayControls (meiClassName: string, background: string): void {\n  setOpacityControls(meiClassName);\n  setBackgroundOpacityControls(background);\n  setHighlightControls();\n  setBurgerControls();\n\n  const displayContents = document.getElementById('displayContents');\n  const toggleDisplay = document.getElementById('toggleDisplay');\n\n  toggleDisplay.addEventListener('click', () => {\n    if (displayContents.style.display === 'none') {\n      displayContents.style.display = '';\n      toggleDisplay.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down');\n    } else {\n      displayContents.style.display = 'none';\n      toggleDisplay.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-side');\n    }\n  });\n}\n\n/**\n * Set zoom control listener for button and slider\n */\nexport function setZoomControls (zoomHandler?: ZoomHandler): void {\n  if (zoomHandler === undefined) {\n    return;\n  }\n  const zoomSlider = document.getElementById('zoomSlider') as HTMLInputElement;\n  const zoomOutput = document.getElementById('zoomOutput') as HTMLOutputElement;\n\n  zoomSlider.value = '100';\n  document.getElementById('reset-zoom').addEventListener('click', () => {\n    zoomOutput.value = '100';\n    zoomSlider.value = '100';\n    zoomHandler.resetZoomAndPan();\n  });\n\n  zoomSlider.addEventListener('input', inputChangeHandler);\n  zoomSlider.addEventListener('change', inputChangeHandler);\n\n  function inputChangeHandler (): void {\n    zoomOutput.value = zoomSlider.value;\n    zoomHandler.zoomTo(Number(zoomOutput.value) / 100.0);\n  }\n\n  document.body.addEventListener('keydown', (evt) => {\n    const currentZoom = parseInt(zoomOutput.value);\n    if (evt.key === '+') { // increase zoom by 20\n      const newZoom = Math.min(currentZoom + 20, parseInt(zoomSlider.getAttribute('max')));\n      zoomHandler.zoomTo(newZoom / 100.0);\n      zoomOutput.value = String(newZoom);\n      zoomSlider.value = String(newZoom);\n    } else if (evt.key === '-') { // decrease zoom by 20\n      const newZoom = Math.max(currentZoom - 20, parseInt(zoomSlider.getAttribute('min')));\n      zoomHandler.zoomTo(newZoom / 100.0);\n      zoomOutput.value = String(Math.round(newZoom));\n      zoomSlider.value = String(newZoom);\n    } else if (evt.key === '0') {\n      zoomOutput.value = '100';\n      zoomSlider.value = '100';\n      zoomHandler.resetZoomAndPan();\n    }\n  });\n}\n\n/**\n * Set rendered MEI opacity button and slider listeners.\n */\nfunction setOpacityControls (meiClassName: string): void {\n  lastGlyphOpacity = 100;\n  const opacitySlider = document.getElementById('opacitySlider') as HTMLInputElement;\n  const opacityOutput = document.getElementById('opacityOutput') as HTMLOutputElement;\n\n  opacitySlider.value = '100';\n\n  document.getElementById('reset-opacity').addEventListener('click', () => {\n    // Definition scale is the root element of what is generated by verovio\n    const lowerOpacity = lastGlyphOpacity < 95 ? lastGlyphOpacity / 100.0 : 0;\n    const newOpacity = opacitySlider.value === '100' ? lowerOpacity : 1;\n    (document.querySelectorAll('.' + meiClassName) as NodeListOf<HTMLElement>).forEach(g => {\n      g.style.opacity = newOpacity.toString();\n    });\n\n    lastGlyphOpacity = Number(opacitySlider.value);\n    opacitySlider.value = String(newOpacity * 100);\n    opacityOutput.value = String(Math.round(newOpacity * 100));\n  });\n\n  opacitySlider.addEventListener('input', inputChangeOpacity);\n  opacitySlider.addEventListener('change', inputChangeOpacity);\n\n  function inputChangeOpacity (): void {\n    opacityOutput.value = opacitySlider.value;\n    lastGlyphOpacity = Number(opacitySlider.value);\n    (document.querySelector('.' + meiClassName) as HTMLElement)\n      .style.opacity = (Number(opacityOutput.value) / 100.0).toString();\n  }\n}\n\n/**\n * Update MEI opacity to value from the slider.\n */\nexport function setOpacityFromSlider (meiClassName?: string): void {\n  const opacityOutput = document.getElementById('opacityOutput') as HTMLOutputElement;\n  opacityOutput.value = (document.getElementById('opacitySlider') as HTMLInputElement).value;\n  try {\n    ((document.querySelectorAll('.' + meiClassName)) as NodeListOf<HTMLElement>).forEach(g => {\n      g.style.opacity = (Number(opacityOutput.value) / 100.0).toString();\n    });\n  } catch (e) {}\n}\n\n/**\n * Set background image opacity button and slider listeners.\n */\nfunction setBackgroundOpacityControls (background: string): void {\n  lastImageOpacity = 100;\n  const bgOpacitySlider = document.getElementById('bgOpacitySlider') as HTMLInputElement;\n  const bgOpacityOutput = document.getElementById('bgOpacityOutput') as HTMLOutputElement;\n\n  bgOpacitySlider.value = '100';\n  document.getElementById('reset-bg-opacity').addEventListener('click', () => {\n    const lowerOpacity = lastImageOpacity < 95 ? lastImageOpacity / 100.0 : 0;\n    const newOpacity = bgOpacitySlider.value === '100' ? lowerOpacity : 1;\n    (document.getElementsByClassName(background)[0] as HTMLElement)\n      .style.opacity = newOpacity.toString();\n\n    lastImageOpacity = Number(bgOpacitySlider.value);\n    bgOpacitySlider.value = String(newOpacity * 100);\n    bgOpacityOutput.value = String(Math.round(newOpacity * 100));\n  });\n\n  bgOpacitySlider.addEventListener('input', bgInputChangeHandler);\n  bgOpacitySlider.addEventListener('change', bgInputChangeHandler);\n\n  function bgInputChangeHandler (): void {\n    bgOpacityOutput.value = bgOpacitySlider.value;\n    lastImageOpacity = Number(bgOpacitySlider.value);\n    (document.getElementsByClassName(background)[0] as HTMLElement)\n      .style.opacity = (Number(bgOpacityOutput.value) / 100.0).toString();\n  }\n}\n\n/**\n * Set listener on staff highlighting checkbox.\n */\nexport function setHighlightControls (): void {\n  const highlightDropdown = document.getElementById('highlight-dropdown');\n  const highlightStaff = document.getElementById('highlight-staff');\n  const highlightSyllable = document.getElementById('highlight-syllable');\n  const highlightNeume = document.getElementById('highlight-neume');\n  const highlightNone = document.getElementById('highlight-none');\n  const highlightType = document.getElementById('highlight-type');\n\n  document.getElementById('highlight-button').addEventListener('click', (evt) => {\n    evt.stopPropagation();\n    highlightDropdown.classList.toggle('is-active');\n    if (highlightDropdown.classList.contains('is-active')) {\n      document.body.addEventListener('click', highlightClickaway);\n      highlightStaff.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightStaff.classList.add('highlight-selected');\n        highlightType.textContent = ' - Staff';\n        Color.setGroupingHighlight('staff');\n      });\n      highlightSyllable.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightSyllable.classList.add('highlight-selected');\n        highlightType.textContent = ' - Syllable';\n        Color.setGroupingHighlight('syllable');\n      });\n      highlightNeume.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightNeume.classList.add('highlight-selected');\n        highlightType.textContent = ' - Neume';\n        Color.setGroupingHighlight('neume');\n      });\n      highlightNone.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightType.textContent = ' - Off';\n        Color.unsetGroupingHighlight();\n      });\n    } else {\n      document.body.removeEventListener('click', highlightClickaway);\n    }\n  });\n}\n\nexport function setHighlightSelectionControls (): void {\n  const highlightSelection = document.getElementById('highlight-selection');\n  highlightSelection.addEventListener('click', () => {\n    document.getElementById('highlight-dropdown').classList.remove('is-active');\n    document.querySelectorAll('.highlight-selected').forEach(elem => {\n      elem.classList.remove('highlight-selected');\n    });\n    highlightSelection.classList.add('highlight-selected');\n    document.getElementById('highlight-type').textContent = ' - Selection';\n    Color.setGroupingHighlight('selection');\n  });\n}\n\n/**\n * Reset the highlight for different types based on the 'highlight-selected' class in the DOM.\n */\nexport function updateHighlight (): void {\n  let highlightId: string;\n  try {\n    highlightId = document.querySelector('.highlight-selected').id;\n  } catch (e) {\n    highlightId = '';\n  }\n  switch (highlightId) {\n    case 'highlight-staff':\n      Color.setGroupingHighlight('staff');\n      break;\n    case 'highlight-syllable':\n      Color.setGroupingHighlight('syllable');\n      break;\n    case 'highlight-neume':\n      Color.setGroupingHighlight('neume');\n      break;\n    case 'highlight-selection':\n      Color.setGroupingHighlight('selection');\n      break;\n    default:\n      Color.unsetGroupingHighlight();\n  }\n}\n\n/**\n * Set listener on burger menu for smaller screens.\n */\nfunction setBurgerControls () {\n  document.getElementById('burgerMenu').addEventListener('click', () => {\n    document.getElementById('burgerMenu').classList.toggle('is-active');\n    document.getElementById('navMenu').classList.toggle('is-active');\n  });\n}\n\n/**\n * Clickaway listener for the highlight dropdown.\n */\nfunction highlightClickaway () {\n  document.body.removeEventListener('click', highlightClickaway);\n  document.getElementById('highlight-dropdown').classList.remove('is-active');\n}\n","import * as Color from './Color';\nimport { updateHighlight } from '../DisplayPanel/DisplayControls';\nimport * as Grouping from '../SquareEdit/Grouping';\nimport { resize } from './Resize';\nimport { Attributes } from '../Types';\nimport NeonView from '../NeonView';\nimport DragHandler from './DragHandler';\nimport * as SelectOptions from '../SquareEdit/SelectOptions';\n\nimport * as d3 from 'd3';\n/**\n * Get the selection mode chosen by the user.\n */\nexport function getSelectionType (): string {\n  const element = document.getElementsByClassName('sel-by is-active');\n  if (element.length !== 0) {\n    return element[0].id;\n  } else {\n    return null;\n  }\n}\n\n/**\n * Unselect all selected elements and run undo any extra\n * actions.\n */\nexport function unselect (): void {\n  document.querySelectorAll('.selected').forEach((selected: SVGGElement) => {\n    selected.classList.remove('selected');\n    if (selected.classList.contains('staff')) {\n      selected.removeAttribute('style');\n      Color.unhighlight(selected);\n    } else {\n      selected.removeAttribute('style');\n      selected.style.fill = '';\n    }\n  });\n  Array.from(document.getElementsByClassName('text-select')).forEach((el: SVGElement) => {\n    el.style.color = '';\n    el.style.fontWeight = '';\n    el.classList.remove('text-select');\n  });\n  Array.from(document.getElementsByClassName('sylTextRect-display')).forEach((sylRect: HTMLElement) => {\n    sylRect.style.fill = 'blue';\n  });\n\n  Array.from(document.getElementsByClassName('syllable-highlighted')).forEach((syllable: HTMLElement) => {\n    syllable.style.fill = '';\n    syllable.classList.add('syllable');\n    syllable.classList.remove('syllable-highlighted');\n  });\n\n  d3.selectAll('#resizeRect').remove();\n  d3.selectAll('.resizePoint').remove();\n  d3.selectAll('.skewPoint').remove();\n\n  if (!document.getElementById('selByStaff').classList.contains('is-active')) {\n    Grouping.endGroupingSelection();\n  } else {\n    SelectOptions.endOptionsSelection();\n  }\n  updateHighlight();\n}\n\n/**\n * Generic select function.\n */\nexport function select (el: SVGGraphicsElement, dragHandler?: DragHandler): void {\n  if (el.classList.contains('staff')) {\n    return selectStaff(el, dragHandler);\n  }\n  if (!el.classList.contains('selected') && !el.classList.contains('sylTextRect') &&\n      !el.classList.contains('sylTextRect-display')) {\n    el.classList.add('selected');\n    el.style.fill = '#d00';\n    if (el.querySelectorAll('.sylTextRect-display').length) {\n      el.querySelectorAll('.sylTextRect-display').forEach((elem: HTMLElement) => {\n        elem.style.fill = 'red';\n      });\n    }\n    let sylId;\n    if (el.classList.contains('syllable')) {\n      sylId = el.id;\n    } else if (el.closest('.syllable') !== null) {\n      sylId = el.closest('.syllable').id;\n    }\n    if (sylId !== undefined) {\n      const spans = document.querySelectorAll('span.' + sylId);\n      spans.forEach((span: HTMLElement) => {\n        span.style.color = '#d00';\n        span.style.fontWeight = 'bold';\n        span.classList.add('text-select');\n      });\n    }\n  }\n  updateHighlight();\n}\n\n/**\n * Select an nc.\n */\nexport async function selectNcs (el: SVGGraphicsElement, neonView: NeonView, dragHandler: DragHandler): Promise<void> {\n  if (!el.parentElement.classList.contains('selected')) {\n    const parent = el.parentElement as unknown as SVGGraphicsElement;\n    unselect();\n    select(parent);\n    if (await isLigature(parent, neonView)) {\n      const prevNc = parent.previousSibling as unknown as SVGGraphicsElement;\n      if (await isLigature(prevNc, neonView)) {\n        select(prevNc);\n      } else {\n        const nextNc = parent.nextSibling as unknown as SVGGraphicsElement;\n        if (await isLigature(nextNc, neonView)) {\n          select(nextNc);\n        } else {\n          console.warn('Error: Neither prev or next nc are ligatures');\n        }\n      }\n      Grouping.triggerGrouping('ligature');\n    } else if (parent.classList.contains('nc')) {\n      SelectOptions.triggerNcActions(parent);\n    } else {\n      console.warn('No action triggered!');\n    }\n    dragHandler.dragInit();\n  }\n}\n\n/**\n * Check if neume component is part of a ligature\n */\nexport async function isLigature (nc: SVGGraphicsElement, neonView: NeonView): Promise<boolean> {\n  const attributes: Attributes = await neonView.getElementAttr(nc.id, neonView.view.getCurrentPageURI());\n  return (attributes.ligated);\n}\n\n/**\n * Check if the elements have the same parent up two levels.\n */\nexport function sharedSecondLevelParent (elements: SVGElement[]): boolean {\n  const tempElements = Array.from(elements);\n  const firstElement = tempElements.pop();\n  const secondParent = firstElement.parentElement.parentElement;\n  for (const element of tempElements) {\n    const secPar = element.parentElement.parentElement;\n    if (secPar.id !== secondParent.id) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Get the bounding box of a staff based on its staff lines.\n * Skew is included in radians.\n */\nexport function getStaffBBox (staff: SVGGElement): {ulx: number; uly: number; lrx: number; lry: number; skew: number} {\n  let ulx, uly, lrx, lry, skew;\n  staff.querySelectorAll('path').forEach(path => {\n    const coordinates: number[] = path.getAttribute('d')\n      .match(/\\d+/g)\n      .map(element => Number(element));\n    if (skew === undefined) {\n      skew = Math.atan((coordinates[3] - coordinates[1]) /\n        (coordinates[2] - coordinates[0]));\n    }\n    if (uly === undefined || coordinates[1] < uly) {\n      uly = coordinates[1];\n    }\n    if (ulx === undefined || coordinates[0] < ulx) {\n      ulx = coordinates[0];\n    }\n    if (lry === undefined || coordinates[3] > lry) {\n      lry = coordinates[3];\n    }\n    if (lrx === undefined || coordinates[2] > lrx) {\n      lrx = coordinates[2];\n    }\n  });\n  return { 'ulx': ulx, 'uly': uly, 'lrx': lrx, 'lry': lry, 'skew': skew };\n}\n\n/**\n * select a boundingbox element\n * @param el - the bbox (sylTextRect) element in the DOM\n * @param dragHandler - the drag handler in use\n */\nexport function selectBBox (el: SVGGraphicsElement, dragHandler: DragHandler, neonView: NeonView): void {\n  const bbox = el;\n  const syl = bbox.closest('.syl');\n  if (!syl.classList.contains('selected')) {\n    syl.classList.add('selected');\n    bbox.style.fill = '#d00';\n    const closest = el.closest('.syllable') as HTMLElement;\n    closest.style.fill = 'red';\n    closest.classList.add('syllable-highlighted');\n    if (neonView !== undefined ){\n      resize(syl as SVGGraphicsElement, neonView, dragHandler);\n    }\n    if (dragHandler !== undefined) {\n      dragHandler.dragInit();\n    }\n    const sylId = el.closest('.syllable').id;\n    if (sylId !== undefined) {\n      const span: HTMLSpanElement = document.querySelector('span.' + sylId);\n      if (span) {\n        span.style.color = '#d00';\n        span.style.fontWeight = 'bold';\n        span.classList.add('text-select');\n      }\n    }\n  }\n}\n\n/**\n * Select not neume elements.\n * @param notNeumes - An array of not neumes elements.\n */\nexport function selectNn (notNeumes: SVGGraphicsElement[]): boolean {\n  if (notNeumes.length > 0) {\n    notNeumes.forEach(nn => { select(nn); });\n    return false;\n  } else {\n    return true;\n  }\n}\n\n/**\n * Select a staff element.\n * @param staff - The staff element in the DOM.\n * @param dragHandler - The drag handler in use.\n */\nexport function selectStaff (staff: SVGGElement, dragHandler: DragHandler): void {\n  if (!staff.classList.contains('selected')) {\n    staff.classList.add('selected');\n    Color.unhighlight(staff);\n    Color.highlight(staff, '#d00');\n    dragHandler.dragInit();\n  }\n}\n\n/**\n * Handle selecting an array of elements based on the selection type.\n */\nexport async function selectAll (elements: Array<SVGGraphicsElement>, neonView: NeonView, dragHandler: DragHandler): Promise<void> {\n  const selectionType = getSelectionType();\n  unselect();\n  if (elements.length === 0) {\n    return;\n  }\n\n  let selectionClass;\n  let containsClefOrCustos = false;\n\n  switch (selectionType) {\n    case 'selBySyl':\n      selectionClass = '.syllable';\n      break;\n    case 'selByNeume':\n      selectionClass = '.neume';\n      break;\n    case 'selByNc':\n      selectionClass = '.nc';\n      break;\n    case 'selByStaff':\n      selectionClass = '.staff';\n      break;\n    case 'selByBBox':\n      selectionClass = '.sylTextRect-display';\n      break;\n    default:\n      console.error('Unknown selection type ' + selectionType);\n      return;\n  }\n\n  // Get the groupings specified by selectionClass\n  // that contain the provided elements to select.\n  const groupsToSelect = new Set();\n  for (const element of elements) {\n    let grouping = element.closest(selectionClass);\n    if (grouping === null) {\n      // Check if we click-selected a clef or a custos\n      grouping = element.closest('.clef, .custos');\n      if (grouping === null) {\n        console.warn('Element ' + element.id + ' is not part of specified group and is not a clef or custos.');\n        continue;\n      }\n      containsClefOrCustos = containsClefOrCustos || true;\n    }\n    groupsToSelect.add(grouping);\n\n    // Check for precedes/follows\n    const follows = grouping.getAttribute('mei:follows');\n    if (follows) {\n      groupsToSelect.add(document.getElementById(follows));\n    }\n    const precedes = grouping.getAttribute('mei:precedes');\n    if (precedes) {\n      groupsToSelect.add(document.getElementById(precedes));\n    }\n  }\n\n  // Select the elements\n  groupsToSelect.forEach((group: SVGGraphicsElement) => { select(group, dragHandler); });\n\n  /* Determine the context menu to display (if any) */\n\n  const groups = Array.from(groupsToSelect.values()) as SVGGraphicsElement[];\n\n  // Handle occurance of clef or custos\n  if (containsClefOrCustos) {\n    // A context menu will only be displayed if there is a single clef\n    if (groupsToSelect.size === 1 && groups[0].classList.contains('clef')) {\n      SelectOptions.triggerClefActions(groups[0]);\n    } else if (groupsToSelect.size === 1 && groups[0].classList.contains('custos')) {\n      SelectOptions.triggerCustosActions();\n    } else {\n      if (selectionType == 'selBySyl') {\n        SelectOptions.triggerDefaultSylActions();\n      } else {\n        SelectOptions.triggerDefaultActions();\n      }\n    }\n    return;\n  }\n\n  switch (selectionType) {\n    case 'selByStaff':\n      switch (groups.length) {\n        case 1:\n          SelectOptions.triggerSplitActions();\n          resize(groups[0], neonView, dragHandler);\n          break;\n        default:\n          SelectOptions.triggerStaffActions();\n      }\n      break;\n\n    case 'selBySyl':\n      switch (groups.length) {\n        case 1:\n          // TODO change context if it is only a neume/nc.\n          SelectOptions.triggerSylActions();\n          break;\n        case 2:\n          // Check if this is a linked syllable split by a staff break\n          if ((groups[0].getAttribute('mei:follows') === groups[1].id) || (groups[0].getAttribute('mei:precedes') === groups[1].id)) {\n            Grouping.triggerGrouping('splitSyllable');\n          } else if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('syl');\n          } else {\n            // Check if this *could* be a selection with a single logical syllable split by a staff break.\n            const staff0 = groups[0].closest('.staff');\n            const staff1 = groups[1].closest('.staff');\n            const staffChildren = Array.from(staff0.parentElement.children);\n            // Check if these are adjacent staves (logically)\n            if (Math.abs(staffChildren.indexOf(staff0) - staffChildren.indexOf(staff1)) === 1) {\n              // Check if one syllable is the last in the first staff and the other is the first in the second.\n              // Determine which staff is first.\n              const firstStaff = (staffChildren.indexOf(staff0) < staffChildren.indexOf(staff1)) ? staff0 : staff1;\n              const secondStaff = (firstStaff.id === staff0.id) ? staff1 : staff0;\n              const firstLayer = firstStaff.querySelector('.layer');\n              const secondLayer = secondStaff.querySelector('.layer');\n\n              // Check that the first staff has either syllable as the last syllable\n              const firstSyllableChildren = Array.from(firstLayer.children)\n                .filter((elem: HTMLElement) => elem.classList.contains('syllable')) as HTMLElement[];\n              const secondSyllableChildren = Array.from(secondLayer.children)\n                .filter((elem: HTMLElement) => elem.classList.contains('syllable')) as HTMLElement[];\n              const lastSyllable = firstSyllableChildren[firstSyllableChildren.length - 1];\n              const firstSyllable = secondSyllableChildren[0];\n              if (lastSyllable.id === groups[0].id && firstSyllable.id === groups[1].id) {\n                Grouping.triggerGrouping('splitSyllable');\n                break;\n              } else if (lastSyllable.id === groups[1].id && firstSyllable.id === groups[0].id) {\n                Grouping.triggerGrouping('splitSyllable');\n                break;\n              }\n            }\n            SelectOptions.triggerDefaultSylActions();\n          }\n          break;\n        default:\n          if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('syl');\n          } else {\n            SelectOptions.triggerDefaultSylActions();\n          }\n      }\n      break;\n\n    case 'selByNeume':\n      switch (groups.length) {\n        case 1:\n          // TODO change context if it is only a nc.\n          SelectOptions.triggerNeumeActions();\n          break;\n        default:\n          if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('neume');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n      }\n      break;\n\n    case 'selByNc':\n      switch (groups.length) {\n        case 1:\n          SelectOptions.triggerNcActions(groups[0]);\n          break;\n        case 2:\n          if (sharedSecondLevelParent(groups)) {\n            // Check if this selection is a ligature or can be a ligature\n            // Check if these neume components are part of the same neume\n            if (groups[0].parentElement === groups[1].parentElement) {\n              const children = Array.from(groups[0].parentElement.children);\n              // Check that neume components are adjacent\n              if (Math.abs(children.indexOf(groups[0]) - children.indexOf(groups[1])) === 1) {\n                // Check that second neume component is lower than first.\n                // Note that the order in the list may not be the same as the\n                // order by x-position.\n                const orderFirstX = (groups[0].children[0] as SVGUseElement)\n                  .x.baseVal.value;\n                const orderSecondX = (groups[1].children[0] as SVGUseElement)\n                  .x.baseVal.value;\n                let posFirstY, posSecondY;\n\n                if (orderFirstX < orderSecondX) {\n                  posFirstY = (groups[0].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                  posSecondY = (groups[1].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                } else {\n                  posFirstY = (groups[1].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                  posSecondY = (groups[0].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                }\n\n                // Also ensure both components are marked or not marked as ligatures.\n                const isFirstLigature = await isLigature(groups[0], neonView);\n                const isSecondLigature = await isLigature(groups[1], neonView);\n                if ((posSecondY > posFirstY) && !(isFirstLigature !== isSecondLigature)) {\n                  Grouping.triggerGrouping('ligature');\n                  break;\n                }\n              }\n            }\n            Grouping.triggerGrouping('nc');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n          break;\n        default:\n          if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('nc');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n      }\n      break;\n    case 'selByBBox':\n      switch (groups.length) {\n        case 1:\n          selectBBox(groups[0], dragHandler, neonView);\n          break;\n        default:\n          groups.forEach(g => selectBBox(g, dragHandler, undefined));\n          break;\n      }\n      break;\n    default:\n      console.error('Unknown selection type. This should not have occurred.');\n  }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\n\nfunction isArray(arg) {\n  if (Array.isArray) {\n    return Array.isArray(arg);\n  }\n  return objectToString(arg) === '[object Array]';\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = Buffer.isBuffer;\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n","import { uuidv4 } from './random';\n\nconst notifications: Notification[] = new Array(0);\nlet currentModeMessage: Notification = null;\nlet notifying = false;\n\n/**\n * Number of notifications to display at a time.\n */\nconst NUMBER_TO_DISPLAY = 3;\n\n/**\n * Add a notification to the queue.\n */\nexport function queueNotification (notification: string): void {\n  const notif = new Notification(notification);\n  notifications.push(notif);\n  if (!notifying || document.getElementById('notification-content').querySelectorAll('.neon-notification').length < NUMBER_TO_DISPLAY) {\n    startNotification();\n  }\n}\n\n/**\n * Start displaying notifications. Called automatically.\n */\nfunction startNotification (): void {\n  if (notifications.length > 0) {\n    notifying = true;\n    const currentNotification = notifications.pop();\n    displayNotification(currentNotification);\n    currentNotification.setTimeoutId(window.setTimeout(clearOrShowNextNotification, 5000, currentNotification.getId()));\n    document.getElementById(currentNotification.getId()).addEventListener('click', () => {\n      window.clearTimeout(currentNotification.timeoutID);\n      clearOrShowNextNotification(currentNotification.getId());\n    });\n  }\n}\n\n/**\n * Display a notification.\n */\nfunction displayNotification (notification: Notification): void {\n  if (notification.isModeMessage) {\n    if (currentModeMessage === null) {\n      currentModeMessage = notification;\n    } else {\n      window.clearTimeout(currentModeMessage.timeoutID);\n      notifications.push(notification);\n      clearOrShowNextNotification(currentModeMessage.getId());\n      return;\n    }\n  }\n  const notificationContent = document.getElementById('notification-content');\n  notificationContent.innerHTML += '<div class=\\'neon-notification\\' id=\\'' + notification.getId() + '\\'>' + notification.message + '</div> ';\n  notificationContent.style.display = '';\n  notification.display();\n}\n\n/**\n * Clear the notifications if no more exist or display another from the queue.\n * @param currentId - The ID of the notification to be cleared.\n */\nfunction clearOrShowNextNotification (currentId: string): void {\n  document.getElementById(currentId).remove();\n  if (currentModeMessage !== null && currentModeMessage.getId() === currentId) {\n    currentModeMessage = null;\n  }\n  if (notifications.length > 0) {\n    startNotification();\n  } else if (document.querySelectorAll('.neon-notification').length === 0) {\n    document.getElementById('notification-content').style.display = 'none';\n    notifying = false;\n  }\n}\n\n/**\n * A class to manage Neon notifications.\n */\nclass Notification {\n  message: string;\n  displayed: boolean;\n  id: string;\n  isModeMessage: boolean;\n  timeoutID: number;\n  /**\n   * Create a new notification.\n   */\n  constructor (message: string) {\n    this.message = message;\n    this.displayed = false;\n    this.id = uuidv4();\n    this.isModeMessage = message.search('Mode') !== -1;\n    this.timeoutID = -1;\n  }\n\n  /** Set the ID from setTimeout. */\n  setTimeoutId (id: number): void {\n    this.timeoutID = Math.max(id, -1);\n  }\n\n  /** Display the Notification. */\n  display (): void {\n    this.displayed = true;\n  }\n\n  /**\n   * Get the UUID for this notification\n   */\n  getId (): string {\n    return this.id;\n  }\n}\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('isarray')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\n/*\n * Export kMaxLength after typed array support is determined.\n */\nexports.kMaxLength = kMaxLength()\n\nfunction typedArraySupport () {\n  try {\n    var arr = new Uint8Array(1)\n    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\nfunction createBuffer (that, length) {\n  if (kMaxLength() < length) {\n    throw new RangeError('Invalid typed array length')\n  }\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = new Uint8Array(length)\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    if (that === null) {\n      that = new Buffer(length)\n    }\n    that.length = length\n  }\n\n  return that\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {\n    return new Buffer(arg, encodingOrOffset, length)\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new Error(\n        'If encoding is specified then the first argument must be a string'\n      )\n    }\n    return allocUnsafe(this, arg)\n  }\n  return from(this, arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\n// TODO: Legacy, not needed anymore. Remove in next major version.\nBuffer._augment = function (arr) {\n  arr.__proto__ = Buffer.prototype\n  return arr\n}\n\nfunction from (that, value, encodingOrOffset, length) {\n  if (typeof value === 'number') {\n    throw new TypeError('\"value\" argument must not be a number')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {\n    return fromArrayBuffer(that, value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'string') {\n    return fromString(that, value, encodingOrOffset)\n  }\n\n  return fromObject(that, value)\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(null, value, encodingOrOffset, length)\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n  if (typeof Symbol !== 'undefined' && Symbol.species &&\n      Buffer[Symbol.species] === Buffer) {\n    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97\n    Object.defineProperty(Buffer, Symbol.species, {\n      value: null,\n      configurable: true\n    })\n  }\n}\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be a number')\n  } else if (size < 0) {\n    throw new RangeError('\"size\" argument must not be negative')\n  }\n}\n\nfunction alloc (that, size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(that, size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpretted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(that, size).fill(fill, encoding)\n      : createBuffer(that, size).fill(fill)\n  }\n  return createBuffer(that, size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(null, size, fill, encoding)\n}\n\nfunction allocUnsafe (that, size) {\n  assertSize(size)\n  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < size; ++i) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(null, size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(null, size)\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('\"encoding\" must be a valid string encoding')\n  }\n\n  var length = byteLength(string, encoding) | 0\n  that = createBuffer(that, length)\n\n  var actual = that.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    that = that.slice(0, actual)\n  }\n\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = array.length < 0 ? 0 : checked(array.length) | 0\n  that = createBuffer(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array, byteOffset, length) {\n  array.byteLength // this throws if `array` is not a valid ArrayBuffer\n\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\\'offset\\' is out of bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\\'length\\' is out of bounds')\n  }\n\n  if (byteOffset === undefined && length === undefined) {\n    array = new Uint8Array(array)\n  } else if (length === undefined) {\n    array = new Uint8Array(array, byteOffset)\n  } else {\n    array = new Uint8Array(array, byteOffset, length)\n  }\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = array\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromArrayLike(that, array)\n  }\n  return that\n}\n\nfunction fromObject (that, obj) {\n  if (Buffer.isBuffer(obj)) {\n    var len = checked(obj.length) | 0\n    that = createBuffer(that, len)\n\n    if (that.length === 0) {\n      return that\n    }\n\n    obj.copy(that, 0, 0, len)\n    return that\n  }\n\n  if (obj) {\n    if ((typeof ArrayBuffer !== 'undefined' &&\n        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {\n      if (typeof obj.length !== 'number' || isnan(obj.length)) {\n        return createBuffer(that, 0)\n      }\n      return fromArrayLike(that, obj)\n    }\n\n    if (obj.type === 'Buffer' && isArray(obj.data)) {\n      return fromArrayLike(that, obj.data)\n    }\n  }\n\n  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength()` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  var buffer = Buffer.allocUnsafe(length)\n  var pos = 0\n  for (i = 0; i < list.length; ++i) {\n    var buf = list[i]\n    if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    }\n    buf.copy(buffer, pos)\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&\n      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    string = '' + string\n  }\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n      case undefined:\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect\n// Buffer instances.\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  var i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  var len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (var i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  var len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (var i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  var len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (var i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError('Argument must be a Buffer')\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  var x = thisEnd - thisStart\n  var y = end - start\n  var len = Math.min(x, y)\n\n  var thisCopy = this.slice(thisStart, thisEnd)\n  var targetCopy = target.slice(start, end)\n\n  for (var i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset  // Coerce to Number.\n  if (isNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (Buffer.TYPED_ARRAY_SUPPORT &&\n        typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  var indexSize = 1\n  var arrLength = arr.length\n  var valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  var i\n  if (dir) {\n    var foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      var found = true\n      for (var j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; ++i) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction latin1Write (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Write(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; ++i) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = this.subarray(start, end)\n    newBuf.__proto__ = Buffer.prototype\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; ++i) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; --i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; ++i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, start + len),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (val.length === 1) {\n      var code = val.charCodeAt(0)\n      if (code < 256) {\n        val = code\n      }\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  var i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    var bytes = Buffer.isBuffer(val)\n      ? val\n      : utf8ToBytes(new Buffer(val, encoding).toString())\n    var len = bytes.length\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction isnan (val) {\n  return val !== val // eslint-disable-line no-self-compare\n}\n","'use strict';\n\nif (typeof process === 'undefined' ||\n    !process.version ||\n    process.version.indexOf('v0.') === 0 ||\n    process.version.indexOf('v1.') === 0 && process.version.indexOf('v1.8.') !== 0) {\n  module.exports = { nextTick: nextTick };\n} else {\n  module.exports = process\n}\n\nfunction nextTick(fn, arg1, arg2, arg3) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('\"callback\" argument must be a function');\n  }\n  var len = arguments.length;\n  var args, i;\n  switch (len) {\n  case 0:\n  case 1:\n    return process.nextTick(fn);\n  case 2:\n    return process.nextTick(function afterTickOne() {\n      fn.call(null, arg1);\n    });\n  case 3:\n    return process.nextTick(function afterTickTwo() {\n      fn.call(null, arg1, arg2);\n    });\n  case 4:\n    return process.nextTick(function afterTickThree() {\n      fn.call(null, arg1, arg2, arg3);\n    });\n  default:\n    args = new Array(len - 1);\n    i = 0;\n    while (i < args.length) {\n      args[i++] = arguments[i];\n    }\n    return process.nextTick(function afterTick() {\n      fn.apply(null, args);\n    });\n  }\n}\n\n","/**\n * Adapted from color palette from Figure 2 (Colors optimized for color-blind\n * individuals) from\n * [\"Points of view: Color blindness\" by Bang Wong published in Nature Methods volume 8 on 27 May 2011](https://www.nature.com/articles/nmeth.1618?WT.ec_id=NMETH-201106)\n */\nconst ColorPalette: string[] = [\n  'rgb(230, 159, 0)',\n  'rgb(86, 180, 233)',\n  'rgb(0, 158, 115)',\n  'rgb(240, 228, 66)',\n  'rgb(0, 114, 178)',\n  'rgb(213, 94, 0)',\n  'rgb(204, 121, 167)'\n];\n\n/**\n * Remove the highlight from a staff.\n * @param staff If undefined, the all staves are unhighlighted.\n */\nexport function unhighlight (staff?: SVGGElement): void {\n  let children: NodeListOf<Element>;\n  if (staff) {\n    children = staff.querySelectorAll(':not(.selected) .highlighted');\n  } else {\n    children = document.querySelectorAll(':not(.selected) .highlighted');\n  }\n  children.forEach(elem => {\n    if (elem.tagName === 'path' && !elem.closest('.staff').classList.contains('selected')) {\n      elem.setAttribute('stroke', '#000000');\n    } else {\n      elem.removeAttribute('fill');\n      let rects = elem.querySelectorAll('.sylTextRect-display');\n      if (!rects.length) {\n        try {\n          rects = elem.closest('.syllable').querySelectorAll('.sylTextRect-display');\n        } catch (e) {\n          rects = [] as unknown as NodeListOf<Element>;\n        }\n      }\n      rects.forEach(function (rect: HTMLElement) {\n        if (rect.closest('.syllable').classList.contains('selected') || \n            rect.closest('.staff').classList.contains('selected') ||\n            rect.closest('.syl').classList.contains('selected')) {\n          rect.style.fill = 'red';\n        } else {\n          rect.style.fill = 'blue';\n        }\n        rect.classList.remove('highlighted');\n      });\n    }\n    elem.classList.remove('highlighted');\n  });\n}\n\n/**\n * Remove the highlight from each staff.\n */\nexport function unsetStaffHighlight (): void {\n  unhighlight();\n}\n\n/**\n * Unset highlight for all grouping types\n */\nexport function unsetGroupingHighlight (): void {\n  unsetStaffHighlight();\n  const highlighted = Array.from(document.getElementsByClassName('highlighted'))\n    .filter((elem: HTMLElement) => !elem.parentElement.classList.contains('selected'));\n  highlighted.forEach((elem: HTMLElement) => {\n    elem.setAttribute('fill', null);\n    let rects = elem.querySelectorAll('.sylTextRect-display');\n    if (!rects.length) {\n      if (elem.closest('.syllable') !== null) {\n        rects = elem.closest('.syllable').querySelectorAll('sylTextRect-display');\n      }\n    }\n    rects.forEach(function (rect: HTMLElement) {\n      if (rect.closest('.syllable').classList.contains('selected') || rect.closest('.syl').classList.contains('selected')) {\n        rect.style.fill = 'red';\n      } else {\n        rect.style.fill = 'blue';\n      }\n      rect.classList.remove('highlighted');\n    });\n    elem.classList.remove('highlighted');\n    elem.querySelectorAll('sylTextRect-display').forEach(rect => {\n      rect.classList.remove('highlighted');\n    });\n  });\n}\n\n/**\n * Highlight a staff a certain color.\n */\nexport function highlight (staff: SVGGElement, color: string): void {\n  const children = Array.from(staff.children);\n  for (var i = 0; i < children.length; i++) {\n    let child = children[i];\n    if (child.tagName === 'path') {\n      child.setAttribute('stroke', color);\n    } else if (child.classList.contains('resizePoint') || child.id === 'resizeRect' || child.classList.contains('skewPoint')) {\n      return;\n    } else if (child.classList.contains('layer')) {\n      Array.from(child.children).forEach(cchild => { children.push(cchild); });\n    } else if (document.getElementsByClassName('highlight-selected').length && \n      document.getElementsByClassName('highlight-selected')[0].id === 'highlight-neume'\n      && child.classList.contains('syllable')) {\n      Array.from(child.children).filter(el => el.classList.contains('neume')).forEach(cchild => { children.push(cchild); });\n    } else {\n      child.setAttribute('fill', color);\n      let rects = child.querySelectorAll('.sylTextRect-display');\n      if (!rects.length) {\n        try {\n          rects = child.closest('.syllable').querySelectorAll('.sylTextRect-display');\n        } catch (e) {\n          rects = [] as unknown as NodeListOf<Element>;\n        }\n      }\n      rects.forEach(function (rect: HTMLElement) {\n        if (!(rect.closest('.syllable').classList.contains('selected') ||\n              rect.closest('.syl').classList.contains('selected') ||\n              rect.closest('.staff').classList.contains('selected'))) {\n          rect.style.fill = color;\n          rect.classList.add('highlighted');\n        }\n      });\n    }\n    child.classList.add('highlighted');\n  }\n}\n\n/**\n * Highlight each staff a different color.\n */\nexport function setStaffHighlight (): void {\n  const staves = Array.from(document.getElementsByClassName('staff')) as SVGGElement[];\n  for (let i = 0; i < staves.length; i++) {\n    const staffColor = ColorPalette[i % ColorPalette.length];\n    highlight(staves[i], staffColor);\n  }\n}\n\n/**\n * Set a highlight by a different grouping.\n * @param grouping - Either \"staff\", \"syllable\", or \"neume\".\n */\nexport function setGroupingHighlight (grouping: string): void {\n  unsetGroupingHighlight();\n  if (grouping === 'staff') {\n    setStaffHighlight();\n    return;\n  } else if (grouping === 'selection') {\n    const temp = document.querySelector('.sel-by.is-active').id;\n    switch (temp) {\n      case 'selBySyl':\n      case 'selByBBox':\n        grouping = 'syllable';\n        break;\n      case 'selByStaff':\n        grouping = 'staff';\n        break;\n      default:\n        grouping = 'neume';\n        break;\n    }\n    setGroupingHighlight(grouping);\n    return;\n  }\n\n  const groups = document.getElementsByClassName(grouping) as HTMLCollectionOf<HTMLElement>;\n  for (let i = 0; i < groups.length; i++) {\n    const groupColor = ColorPalette[i % ColorPalette.length];\n    if ((groups[i].closest('.selected') === null) && !groups[i].classList.contains('selected')) {\n      groups[i].setAttribute('fill', groupColor);\n      const rects = groups[i].querySelectorAll('.sylTextRect-display') as NodeListOf<HTMLElement>;\n      rects.forEach(function (rect) {\n        if (rect.closest('.syl').classList.contains('selected') || \n            rect.closest('.syllable').classList.contains('selected') ||\n            rect.closest('.staff').classList.contains('selected')) {\n          return;\n        }\n        rect.style.fill = groupColor;\n      });\n      groups[i].classList.add('highlighted');\n      groups[i].querySelectorAll('.sylTextRect-display').forEach(rect => {\n        rect.classList.add('highlighted');\n      });\n    } else {\n      if (!groups[i].classList.contains('selected')) {\n        groups[i].setAttribute('fill', null);\n      } else {\n        groups[i].setAttribute('fill', '#d00');\n      }\n      groups[i].classList.remove('highlighted');\n    }\n  }\n}\n","import * as Contents from './Contents';\nimport * as Grouping from './Grouping';\nimport * as Notification from '../utils/Notification';\nimport NeonView from '../NeonView';\nimport { SplitHandler } from './StaffTools';\nimport { EditorAction } from '../Types';\n\n/**\n * The NeonView parent to call editor actions.\n */\nlet neonView: NeonView;\n\n/**\n * Initialize NeonView.\n */\nexport function initNeonView (view: NeonView): void {\n  neonView = view;\n  Grouping.initNeonView(view);\n}\n\n/**\n * Return an action that unsets the inclinatum parameter of an nc.\n * @param id - The id of the neume component.\n */\nexport function unsetInclinatumAction (id: string): object {\n  return {\n    'action': 'set',\n    'param': {\n      'elementId': id,\n      'attrType': 'tilt',\n      'attrValue': ''\n    }\n  };\n}\n\n/**\n * Return an action that unsets the virga parameter of an nc.\n * @param id - The id of the neume component.\n */\nexport function unsetVirgaAction (id: string): object {\n  return {\n    'action': 'set',\n    'param': {\n      'elementId': id,\n      'attrType': 'tilt',\n      'attrValue': ''\n    }\n  };\n}\n\n/**\n * Function to handle removing elements\n */\nexport function removeHandler (): void {\n  const toRemove = [];\n  const selected = Array.from(document.getElementsByClassName('selected'));\n  selected.forEach(elem => {\n    toRemove.push(\n      {\n        'action': 'remove',\n        'param': {\n          'elementId': elem.id\n        }\n      }\n    );\n  });\n  const chainAction: EditorAction = {\n    'action': 'chain',\n    'param': toRemove\n  };\n  endOptionsSelection();\n  neonView.edit(chainAction, neonView.view.getCurrentPageURI()).then(() => { neonView.updateForCurrentPage(); });\n}\n\n/**\n * Function to handle re-associating elements to the nearest staff\n */\nexport function changeStaffHandler(): void {\n  const toChange: EditorAction[] = [];\n  const selected = Array.from(document.getElementsByClassName('selected'));\n  selected.forEach(elem => {\n    toChange.push(\n      {\n        'action': 'changeStaff',\n        'param': {\n          'elementId': elem.id\n        }\n      }\n    );\n  });\n  const chainAction: EditorAction = {\n    'action': 'chain',\n    'param': toChange\n  };\n  endOptionsSelection();\n  neonView.edit(chainAction, neonView.view.getCurrentPageURI()).then(() => { neonView.updateForCurrentPage(); });\n}\n\n/**\n * Trigger the extra nc action menu for a selection.\n */\nexport function triggerNcActions (nc: SVGGraphicsElement): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.ncActionContents;\n  } catch (e) {}\n\n  document.querySelector('#Punctum.dropdown-item')\n    .addEventListener('click', () => {\n      const unsetInclinatum = unsetInclinatumAction(nc.id);\n      const unsetVirga = unsetVirgaAction(nc.id);\n      neonView.edit({ 'action': 'chain', 'param': [ unsetInclinatum, unsetVirga ] }, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n\n  document.querySelector('#Inclinatum.dropdown-item')\n    .addEventListener('click', () => {\n      const setInclinatum = {\n        'action': 'set',\n        'param': {\n          'elementId': nc.id,\n          'attrType': 'tilt',\n          'attrValue': 'se'\n        }\n      };\n      neonView.edit(setInclinatum, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n\n  document.querySelector('#Virga.dropdown-item')\n    .addEventListener('click', () => {\n      const unsetInclinatum = unsetInclinatumAction(nc.id);\n      const setVirga = {\n        'action': 'set',\n        'param': {\n          'elementId': nc.id,\n          'attrType': 'tilt',\n          'attrValue': 'n'\n        }\n      };\n      neonView.edit({ 'action': 'chain', 'param': [ unsetInclinatum, setVirga ] }, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n  initOptionsListeners();\n}\n\n/**\n * Trigger extra neume actions.\n */\nexport function triggerNeumeActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.neumeActionContents;\n  } catch (e) {}\n  const neume = document.querySelectorAll('.selected');\n  if (neume.length !== 1) {\n    console.warn('More than one neume selected! Cannot trigger Neume ClickSelect actions.');\n    return;\n  }\n\n  document.querySelector('.grouping')\n    .addEventListener('click', (e) => {\n      const contour = neonView.info.getContourByValue((e.target as HTMLElement).id);\n      triggerChangeGroup(contour);\n    });\n\n  function triggerChangeGroup (contour): void {\n    const changeGroupingAction: EditorAction = {\n      'action': 'changeGroup',\n      'param': {\n        'elementId': neume[0].id,\n        'contour': contour\n      }\n    };\n    neonView.edit(changeGroupingAction, neonView.view.getCurrentPageURI()).then((result) => {\n      if (result) {\n        Notification.queueNotification('Grouping Changed');\n      } else {\n        Notification.queueNotification('Grouping Failed');\n      }\n      endOptionsSelection();\n      neonView.updateForCurrentPage();\n    });\n  }\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n  initOptionsListeners();\n  Grouping.initGroupingListeners();\n}\n\n/**\n * Trigger extra syllable actions.\n */\nexport function triggerSylActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML =\n      '<div><p class=\\'control\\'>' +\n          '<button class=\\'button\\' id=\\'ungroupNeumes\\'>Ungroup</button></p></div>' +\n      '<div><p class=\\'control\\'>' +\n          '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>' +\n      '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>';\n    document.getElementById('changeStaff').addEventListener('click', changeStaffHandler);\n  } catch (e) {}\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n  Grouping.initGroupingListeners();\n}\n\n/**\n * Trigger extra clef actions for a specific clef.\n */\nexport function triggerClefActions (clef: SVGGraphicsElement): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.clefActionContents;\n  } catch (e) {}\n  document.querySelector('#CClef.dropdown-item')\n    .addEventListener('click', () => {\n      const setCClef: EditorAction = {\n        'action': 'setClef',\n        'param': {\n          'elementId': clef.id,\n          'shape': 'C'\n        }\n      };\n      neonView.edit(setCClef, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  document.querySelector('#FClef.dropdown-item')\n    .addEventListener('click', () => {\n      const setFClef: EditorAction = {\n        'action': 'setClef',\n        'param': {\n          'elementId': clef.id,\n          'shape': 'F'\n        }\n      };\n      neonView.edit(setFClef, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n    document.getElementById('changeStaff').addEventListener('click', changeStaffHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n\n  initOptionsListeners();\n}\n\n/**\n * trigger extra custos actions.\n */\nexport function triggerCustosActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML += Contents.custosActionContents;\n  } catch (e) {}\n\n  try {\n    document.getElementById('changeStaff')\n      .addEventListener('click', changeStaffHandler);\n  } catch (e) {}\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n    document.body.addEventListener('keydown', deleteButtonHandler);\n  } catch (e) {}\n}\n\n/**\n * Trigger extra staff actions.\n */\nexport function triggerStaffActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.staffActionContents;\n  } catch (e) {}\n\n  document.getElementById('merge-systems')\n    .addEventListener('click', () => {\n      const systems = document.querySelectorAll('.staff.selected');\n      const elementIds = [];\n      systems.forEach(staff => {\n        elementIds.push(staff.id);\n      });\n      const editorAction: EditorAction = {\n        'action': 'merge',\n        'param': {\n          'elementIds': elementIds\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Staff Merged');\n          endOptionsSelection();\n          neonView.updateForCurrentPage();\n        } else {\n          Notification.queueNotification('Merge Failed');\n        }\n      });\n    });\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * Trigger split staff option\n */\nexport function triggerSplitActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.splitActionContents;\n  } catch (e) {}\n\n  // TODO add trigger for split action\n  document.getElementById('split-system')\n    .addEventListener('click', () => {\n      const staff = document.querySelector('.staff.selected') as SVGGElement;\n      if (staff !== null) {\n        const split = new SplitHandler(neonView, staff);\n        split.startSplit();\n        endOptionsSelection();\n      } else {\n        console.error('No staff was selected!');\n        endOptionsSelection();\n      }\n    });\n\n  document.getElementById('reset-skew')\n    .addEventListener('click', () => {\n      const staff = document.querySelector('.staff.selected') as SVGElement;\n      const rect = staff.querySelector('#resizeRect');\n      const co = rect.getAttribute('points').split(' ');\n      let dy = parseInt(co[0].split(',')[1]) - parseInt(co[1].split(',')[1]);\n      if (staff !== null) {\n        const editorAction: EditorAction = {\n          'action': 'changeSkew',\n          'param': {\n            'elementId': staff.id,\n            'dy': dy,\n            'rightSide': true\n          }\n        };\n        neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then(async (result) => {\n          if (result) {\n            await neonView.updateForCurrentPagePromise();\n          }\n        });\n        endOptionsSelection();\n      } else {\n        console.error('No staff was selected');\n        endOptionsSelection();\n      }\n    });\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n}\n\n/** \n * trigger default actions when selecting by syl\n */\nexport function triggerDefaultSylActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.defaultSylActionContents;\n  } catch (e) {}\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n  try {\n    const changeStaff = document.getElementById('changeStaff');\n    changeStaff.removeEventListener('click', changeStaffHandler);\n    changeStaff.addEventListener('click', changeStaffHandler);\n  } catch(e) {}\n}\n\n/**\n * Trigger default selection option.\n */\nexport function triggerDefaultActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.defaultActionContents;\n  } catch (e) {}\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * End the extra options menu.\n */\nexport function endOptionsSelection (): void {\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.innerHTML = '';\n    moreEdit.classList.add('is-invisible');\n  } catch (e) {}\n  document.body.removeEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * Initialize extra dropdown options.\n */\nfunction initOptionsListeners (): void {\n  document.getElementById('drop_select').addEventListener('click', function () {\n    this.classList.toggle('is-active');\n  });\n}\n\n/** Event handler for delete button press. */\nexport function deleteButtonHandler (evt: KeyboardEvent): void {\n  if (evt.key === 'd' || evt.key === 'Backspace') { removeHandler(); evt.preventDefault(); }\n}\n","import NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport * as d3 from 'd3';\n\nclass DragHandler {\n  private dragStartCoords: Array<number>;\n  private resetToAction: (selection: d3.Selection<d3.BaseType, {}, HTMLElement, any>, args: any[]) => void;\n  readonly neonView: NeonView;\n  private selector: string;\n  private selection: Element[];\n  private dx: number;\n  private dy: number;\n\n  constructor (neonView: NeonView, selector: string) {\n    this.neonView = neonView;\n    this.selector = selector;\n  }\n\n  /**\n   * Initialize the dragging action and handler for selected elements.\n   */\n  dragInit (): void {\n    // Adding listeners\n    const dragBehaviour = d3.drag()\n      .on('start', dragStarted.bind(this))\n      .on('drag', this.dragging.bind(this))\n      .on('end', this.dragEnded.bind(this));\n\n    const activeNc = d3.selectAll('.selected');\n    const selection = Array.from(document.getElementsByClassName('selected'));\n    this.selection = selection.concat(Array.from(document.getElementsByClassName('resizePoint')));\n\n    this.dragStartCoords = new Array(activeNc.size());\n\n    activeNc.call(dragBehaviour);\n\n    // Drag effects\n    function dragStarted (): void {\n      this.dragStartCoords = [d3.event.x, d3.event.y];\n      this.dx = 0;\n      this.dy = 0;\n      const target = d3.event.sourceEvent.target;\n      if (target.classList.contains('staff')) {\n        d3.select(this.selector).call(dragBehaviour);\n      }\n    }\n  }\n\n  dragging (): void {\n    const relativeY = d3.event.y - this.dragStartCoords[1];\n    const relativeX = d3.event.x - this.dragStartCoords[0];\n    this.dx = d3.event.x - this.dragStartCoords[0];\n    this.dy = d3.event.y - this.dragStartCoords[1];\n    this.selection.forEach((el) => {\n      d3.select(el).attr('transform', function () {\n        return 'translate(' + [relativeX, relativeY] + ')';\n      });\n    });\n    /*\n     * if we're dragging a syllable (or neume etc) then there won't be a syl selected\n     * then we don't want the bounding box (if it is displayed) to move when dragging the neumes\n     * it will be a child of the element in selection, so it will get moved in the above loop\n     * so we cancel that movement out here\n     */\n    if (this.selection.filter((element: HTMLElement) => element.classList.contains('syl')).length === 0) {\n      d3.selectAll('.syllable.selected').selectAll('.sylTextRect-display').attr('transform', function () {\n        return 'translate(' + [-1 * relativeX, -1 * relativeY] + ')';\n      });\n    }\n  }\n\n  dragEnded (): void {\n    const paramArray = [];\n    this.selection.filter((el: SVGElement) => !el.classList.contains('resizePoint')).forEach((el: SVGElement) => {\n      const id = (el.tagName === 'rect') ? el.closest('.syl').id : el.id;\n      const singleAction = { action: 'drag',\n        param: { elementId: id,\n          x: this.dx,\n          y: (this.dy) * -1 }\n      };\n      paramArray.push(singleAction);\n    });\n    const editorAction: EditorAction = {\n      'action': 'chain',\n      'param': paramArray\n    };\n\n    const xDiff = Math.abs(this.dx);\n    const yDiff = Math.abs(this.dy);\n\n    if (xDiff > 5 || yDiff > 5) {\n      this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then(() => {\n        this.neonView.updateForCurrentPage();\n        this.endOptionsSelection();\n        this.reset();\n        this.dragInit();\n      });\n    } else {\n      this.reset();\n      this.dragInit();\n    }\n  }\n\n  /** Set the d3 action to use for [[reset]]. */\n  resetTo (reset: (selection: d3.Selection<d3.BaseType, {}, HTMLElement, any>, args: any[]) => void): void {\n    this.resetToAction = reset;\n  }\n\n  /** Reset to a previous d3 action for [[this.selector]]. */\n  reset (): void {\n    if (this.resetToAction !== undefined) {\n      d3.select(this.selector).call(this.resetToAction);\n    }\n  }\n\n  endOptionsSelection (): void {\n    try {\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('moreEdit').classList.add('is-invisible');\n    } catch (e) {}\n  }\n}\n\nexport { DragHandler as default };\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} raw     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     raw True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","/*\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\nvar cache = {};\n\n\n// Do any others need escaping?\nvar TO_ESCAPE = {\n  '\\'': '\\\\\\'',\n  '\\n': '\\\\n'\n};\n\n\nfunction populate(formatter) {\n  var i, type,\n      key = formatter,\n      prev = 0,\n      arg = 1,\n      builder = 'return \\'';\n\n  for (i = 0; i < formatter.length; i++) {\n    if (formatter[i] === '%') {\n      type = formatter[i + 1];\n\n      switch (type) {\n        case 's':\n          builder += formatter.slice(prev, i) + '\\' + arguments[' + arg + '] + \\'';\n          prev = i + 2;\n          arg++;\n          break;\n        case 'j':\n          builder += formatter.slice(prev, i) + '\\' + JSON.stringify(arguments[' + arg + ']) + \\'';\n          prev = i + 2;\n          arg++;\n          break;\n        case '%':\n          builder += formatter.slice(prev, i + 1);\n          prev = i + 2;\n          i++;\n          break;\n      }\n\n\n    } else if (TO_ESCAPE[formatter[i]]) {\n      builder += formatter.slice(prev, i) + TO_ESCAPE[formatter[i]];\n      prev = i + 1;\n    }\n  }\n\n  builder += formatter.slice(prev) + '\\';';\n  cache[key] = new Function(builder);\n}\n\n\n/**\n * A fast version of sprintf(), which currently only supports the %s and %j.\n * This caches a formatting function for each format string that is used, so\n * you should only use this sprintf() will be called many times with a single\n * format string and a limited number of format strings will ever be used (in\n * general this means that format strings should be string literals).\n *\n * @param {String} formatter A format string.\n * @param {...String} var_args Values that will be formatted by %s and %j.\n * @return {String} The formatted output.\n */\nexports.sprintf = function(formatter, var_args) {\n  if (!cache[formatter]) {\n    populate(formatter);\n  }\n\n  return cache[formatter].apply(null, arguments);\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar getOwnPropertyDescriptors = Object.getOwnPropertyDescriptors ||\n  function getOwnPropertyDescriptors(obj) {\n    var keys = Object.keys(obj);\n    var descriptors = {};\n    for (var i = 0; i < keys.length; i++) {\n      descriptors[keys[i]] = Object.getOwnPropertyDescriptor(obj, keys[i]);\n    }\n    return descriptors;\n  };\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  if (typeof process !== 'undefined' && process.noDeprecation === true) {\n    return fn;\n  }\n\n  // Allow for deprecating things in the process of starting up.\n  if (typeof process === 'undefined') {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nvar kCustomPromisifiedSymbol = typeof Symbol !== 'undefined' ? Symbol('util.promisify.custom') : undefined;\n\nexports.promisify = function promisify(original) {\n  if (typeof original !== 'function')\n    throw new TypeError('The \"original\" argument must be of type Function');\n\n  if (kCustomPromisifiedSymbol && original[kCustomPromisifiedSymbol]) {\n    var fn = original[kCustomPromisifiedSymbol];\n    if (typeof fn !== 'function') {\n      throw new TypeError('The \"util.promisify.custom\" argument must be of type Function');\n    }\n    Object.defineProperty(fn, kCustomPromisifiedSymbol, {\n      value: fn, enumerable: false, writable: false, configurable: true\n    });\n    return fn;\n  }\n\n  function fn() {\n    var promiseResolve, promiseReject;\n    var promise = new Promise(function (resolve, reject) {\n      promiseResolve = resolve;\n      promiseReject = reject;\n    });\n\n    var args = [];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    args.push(function (err, value) {\n      if (err) {\n        promiseReject(err);\n      } else {\n        promiseResolve(value);\n      }\n    });\n\n    try {\n      original.apply(this, args);\n    } catch (err) {\n      promiseReject(err);\n    }\n\n    return promise;\n  }\n\n  Object.setPrototypeOf(fn, Object.getPrototypeOf(original));\n\n  if (kCustomPromisifiedSymbol) Object.defineProperty(fn, kCustomPromisifiedSymbol, {\n    value: fn, enumerable: false, writable: false, configurable: true\n  });\n  return Object.defineProperties(\n    fn,\n    getOwnPropertyDescriptors(original)\n  );\n}\n\nexports.promisify.custom = kCustomPromisifiedSymbol\n\nfunction callbackifyOnRejected(reason, cb) {\n  // `!reason` guard inspired by bluebird (Ref: https://goo.gl/t5IS6M).\n  // Because `null` is a special error value in callbacks which means \"no error\n  // occurred\", we error-wrap so the callback consumer can distinguish between\n  // \"the promise rejected with null\" or \"the promise fulfilled with undefined\".\n  if (!reason) {\n    var newReason = new Error('Promise was rejected with a falsy value');\n    newReason.reason = reason;\n    reason = newReason;\n  }\n  return cb(reason);\n}\n\nfunction callbackify(original) {\n  if (typeof original !== 'function') {\n    throw new TypeError('The \"original\" argument must be of type Function');\n  }\n\n  // We DO NOT return the promise as it gives the user a false sense that\n  // the promise is actually somehow related to the callback's execution\n  // and that the callback throwing will reject the promise.\n  function callbackified() {\n    var args = [];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n\n    var maybeCb = args.pop();\n    if (typeof maybeCb !== 'function') {\n      throw new TypeError('The last argument must be of type Function');\n    }\n    var self = this;\n    var cb = function() {\n      return maybeCb.apply(self, arguments);\n    };\n    // In true node style we process the callback on `nextTick` with all the\n    // implications (stack, `uncaughtException`, `async_hooks`)\n    original.apply(this, args)\n      .then(function(ret) { process.nextTick(cb, null, ret) },\n            function(rej) { process.nextTick(callbackifyOnRejected, rej, cb) });\n  }\n\n  Object.setPrototypeOf(callbackified, Object.getPrototypeOf(original));\n  Object.defineProperties(callbackified,\n                          getOwnPropertyDescriptors(original));\n  return callbackified;\n}\nexports.callbackify = callbackify;\n","exports = module.exports = require('./lib/_stream_readable.js');\nexports.Stream = exports;\nexports.Readable = exports;\nexports.Writable = require('./lib/_stream_writable.js');\nexports.Duplex = require('./lib/_stream_duplex.js');\nexports.Transform = require('./lib/_stream_transform.js');\nexports.PassThrough = require('./lib/_stream_passthrough.js');\n","/* eslint-disable node/no-deprecated-api */\nvar buffer = require('buffer')\nvar Buffer = buffer.Buffer\n\n// alternative to using Object.keys for old browsers\nfunction copyProps (src, dst) {\n  for (var key in src) {\n    dst[key] = src[key]\n  }\n}\nif (Buffer.from && Buffer.alloc && Buffer.allocUnsafe && Buffer.allocUnsafeSlow) {\n  module.exports = buffer\n} else {\n  // Copy properties from require('buffer')\n  copyProps(buffer, exports)\n  exports.Buffer = SafeBuffer\n}\n\nfunction SafeBuffer (arg, encodingOrOffset, length) {\n  return Buffer(arg, encodingOrOffset, length)\n}\n\n// Copy static methods from Buffer\ncopyProps(Buffer, SafeBuffer)\n\nSafeBuffer.from = function (arg, encodingOrOffset, length) {\n  if (typeof arg === 'number') {\n    throw new TypeError('Argument must not be a number')\n  }\n  return Buffer(arg, encodingOrOffset, length)\n}\n\nSafeBuffer.alloc = function (size, fill, encoding) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  var buf = Buffer(size)\n  if (fill !== undefined) {\n    if (typeof encoding === 'string') {\n      buf.fill(fill, encoding)\n    } else {\n      buf.fill(fill)\n    }\n  } else {\n    buf.fill(0)\n  }\n  return buf\n}\n\nSafeBuffer.allocUnsafe = function (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  return Buffer(size)\n}\n\nSafeBuffer.allocUnsafeSlow = function (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  return buffer.SlowBuffer(size)\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// A bit simpler than readable streams.\n// Implement an async ._write(chunk, encoding, cb), and it'll handle all\n// the drain event emission and buffering.\n\n'use strict';\n\n/*<replacement>*/\n\nvar pna = require('process-nextick-args');\n/*</replacement>*/\n\nmodule.exports = Writable;\n\n/* <replacement> */\nfunction WriteReq(chunk, encoding, cb) {\n  this.chunk = chunk;\n  this.encoding = encoding;\n  this.callback = cb;\n  this.next = null;\n}\n\n// It seems a linked list but it is not\n// there will be only 2 of these for each stream\nfunction CorkedRequest(state) {\n  var _this = this;\n\n  this.next = null;\n  this.entry = null;\n  this.finish = function () {\n    onCorkedFinish(_this, state);\n  };\n}\n/* </replacement> */\n\n/*<replacement>*/\nvar asyncWrite = !process.browser && ['v0.10', 'v0.9.'].indexOf(process.version.slice(0, 5)) > -1 ? setImmediate : pna.nextTick;\n/*</replacement>*/\n\n/*<replacement>*/\nvar Duplex;\n/*</replacement>*/\n\nWritable.WritableState = WritableState;\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\n/*<replacement>*/\nvar internalUtil = {\n  deprecate: require('util-deprecate')\n};\n/*</replacement>*/\n\n/*<replacement>*/\nvar Stream = require('./internal/streams/stream');\n/*</replacement>*/\n\n/*<replacement>*/\n\nvar Buffer = require('safe-buffer').Buffer;\nvar OurUint8Array = global.Uint8Array || function () {};\nfunction _uint8ArrayToBuffer(chunk) {\n  return Buffer.from(chunk);\n}\nfunction _isUint8Array(obj) {\n  return Buffer.isBuffer(obj) || obj instanceof OurUint8Array;\n}\n\n/*</replacement>*/\n\nvar destroyImpl = require('./internal/streams/destroy');\n\nutil.inherits(Writable, Stream);\n\nfunction nop() {}\n\nfunction WritableState(options, stream) {\n  Duplex = Duplex || require('./_stream_duplex');\n\n  options = options || {};\n\n  // Duplex streams are both readable and writable, but share\n  // the same options object.\n  // However, some cases require setting options to different\n  // values for the readable and the writable sides of the duplex stream.\n  // These options can be provided separately as readableXXX and writableXXX.\n  var isDuplex = stream instanceof Duplex;\n\n  // object stream flag to indicate whether or not this stream\n  // contains buffers or objects.\n  this.objectMode = !!options.objectMode;\n\n  if (isDuplex) this.objectMode = this.objectMode || !!options.writableObjectMode;\n\n  // the point at which write() starts returning false\n  // Note: 0 is a valid value, means that we always return false if\n  // the entire buffer is not flushed immediately on write()\n  var hwm = options.highWaterMark;\n  var writableHwm = options.writableHighWaterMark;\n  var defaultHwm = this.objectMode ? 16 : 16 * 1024;\n\n  if (hwm || hwm === 0) this.highWaterMark = hwm;else if (isDuplex && (writableHwm || writableHwm === 0)) this.highWaterMark = writableHwm;else this.highWaterMark = defaultHwm;\n\n  // cast to ints.\n  this.highWaterMark = Math.floor(this.highWaterMark);\n\n  // if _final has been called\n  this.finalCalled = false;\n\n  // drain event flag.\n  this.needDrain = false;\n  // at the start of calling end()\n  this.ending = false;\n  // when end() has been called, and returned\n  this.ended = false;\n  // when 'finish' is emitted\n  this.finished = false;\n\n  // has it been destroyed\n  this.destroyed = false;\n\n  // should we decode strings into buffers before passing to _write?\n  // this is here so that some node-core streams can optimize string\n  // handling at a lower level.\n  var noDecode = options.decodeStrings === false;\n  this.decodeStrings = !noDecode;\n\n  // Crypto is kind of old and crusty.  Historically, its default string\n  // encoding is 'binary' so we have to make this configurable.\n  // Everything else in the universe uses 'utf8', though.\n  this.defaultEncoding = options.defaultEncoding || 'utf8';\n\n  // not an actual buffer we keep track of, but a measurement\n  // of how much we're waiting to get pushed to some underlying\n  // socket or file.\n  this.length = 0;\n\n  // a flag to see when we're in the middle of a write.\n  this.writing = false;\n\n  // when true all writes will be buffered until .uncork() call\n  this.corked = 0;\n\n  // a flag to be able to tell if the onwrite cb is called immediately,\n  // or on a later tick.  We set this to true at first, because any\n  // actions that shouldn't happen until \"later\" should generally also\n  // not happen before the first write call.\n  this.sync = true;\n\n  // a flag to know if we're processing previously buffered items, which\n  // may call the _write() callback in the same tick, so that we don't\n  // end up in an overlapped onwrite situation.\n  this.bufferProcessing = false;\n\n  // the callback that's passed to _write(chunk,cb)\n  this.onwrite = function (er) {\n    onwrite(stream, er);\n  };\n\n  // the callback that the user supplies to write(chunk,encoding,cb)\n  this.writecb = null;\n\n  // the amount that is being written when _write is called.\n  this.writelen = 0;\n\n  this.bufferedRequest = null;\n  this.lastBufferedRequest = null;\n\n  // number of pending user-supplied write callbacks\n  // this must be 0 before 'finish' can be emitted\n  this.pendingcb = 0;\n\n  // emit prefinish if the only thing we're waiting for is _write cbs\n  // This is relevant for synchronous Transform streams\n  this.prefinished = false;\n\n  // True if the error was already emitted and should not be thrown again\n  this.errorEmitted = false;\n\n  // count buffered requests\n  this.bufferedRequestCount = 0;\n\n  // allocate the first CorkedRequest, there is always\n  // one allocated and free to use, and we maintain at most two\n  this.corkedRequestsFree = new CorkedRequest(this);\n}\n\nWritableState.prototype.getBuffer = function getBuffer() {\n  var current = this.bufferedRequest;\n  var out = [];\n  while (current) {\n    out.push(current);\n    current = current.next;\n  }\n  return out;\n};\n\n(function () {\n  try {\n    Object.defineProperty(WritableState.prototype, 'buffer', {\n      get: internalUtil.deprecate(function () {\n        return this.getBuffer();\n      }, '_writableState.buffer is deprecated. Use _writableState.getBuffer ' + 'instead.', 'DEP0003')\n    });\n  } catch (_) {}\n})();\n\n// Test _writableState for inheritance to account for Duplex streams,\n// whose prototype chain only points to Readable.\nvar realHasInstance;\nif (typeof Symbol === 'function' && Symbol.hasInstance && typeof Function.prototype[Symbol.hasInstance] === 'function') {\n  realHasInstance = Function.prototype[Symbol.hasInstance];\n  Object.defineProperty(Writable, Symbol.hasInstance, {\n    value: function (object) {\n      if (realHasInstance.call(this, object)) return true;\n      if (this !== Writable) return false;\n\n      return object && object._writableState instanceof WritableState;\n    }\n  });\n} else {\n  realHasInstance = function (object) {\n    return object instanceof this;\n  };\n}\n\nfunction Writable(options) {\n  Duplex = Duplex || require('./_stream_duplex');\n\n  // Writable ctor is applied to Duplexes, too.\n  // `realHasInstance` is necessary because using plain `instanceof`\n  // would return false, as no `_writableState` property is attached.\n\n  // Trying to use the custom `instanceof` for Writable here will also break the\n  // Node.js LazyTransform implementation, which has a non-trivial getter for\n  // `_writableState` that would lead to infinite recursion.\n  if (!realHasInstance.call(Writable, this) && !(this instanceof Duplex)) {\n    return new Writable(options);\n  }\n\n  this._writableState = new WritableState(options, this);\n\n  // legacy.\n  this.writable = true;\n\n  if (options) {\n    if (typeof options.write === 'function') this._write = options.write;\n\n    if (typeof options.writev === 'function') this._writev = options.writev;\n\n    if (typeof options.destroy === 'function') this._destroy = options.destroy;\n\n    if (typeof options.final === 'function') this._final = options.final;\n  }\n\n  Stream.call(this);\n}\n\n// Otherwise people can pipe Writable streams, which is just wrong.\nWritable.prototype.pipe = function () {\n  this.emit('error', new Error('Cannot pipe, not readable'));\n};\n\nfunction writeAfterEnd(stream, cb) {\n  var er = new Error('write after end');\n  // TODO: defer error events consistently everywhere, not just the cb\n  stream.emit('error', er);\n  pna.nextTick(cb, er);\n}\n\n// Checks that a user-supplied chunk is valid, especially for the particular\n// mode the stream is in. Currently this means that `null` is never accepted\n// and undefined/non-string values are only allowed in object mode.\nfunction validChunk(stream, state, chunk, cb) {\n  var valid = true;\n  var er = false;\n\n  if (chunk === null) {\n    er = new TypeError('May not write null values to stream');\n  } else if (typeof chunk !== 'string' && chunk !== undefined && !state.objectMode) {\n    er = new TypeError('Invalid non-string/buffer chunk');\n  }\n  if (er) {\n    stream.emit('error', er);\n    pna.nextTick(cb, er);\n    valid = false;\n  }\n  return valid;\n}\n\nWritable.prototype.write = function (chunk, encoding, cb) {\n  var state = this._writableState;\n  var ret = false;\n  var isBuf = !state.objectMode && _isUint8Array(chunk);\n\n  if (isBuf && !Buffer.isBuffer(chunk)) {\n    chunk = _uint8ArrayToBuffer(chunk);\n  }\n\n  if (typeof encoding === 'function') {\n    cb = encoding;\n    encoding = null;\n  }\n\n  if (isBuf) encoding = 'buffer';else if (!encoding) encoding = state.defaultEncoding;\n\n  if (typeof cb !== 'function') cb = nop;\n\n  if (state.ended) writeAfterEnd(this, cb);else if (isBuf || validChunk(this, state, chunk, cb)) {\n    state.pendingcb++;\n    ret = writeOrBuffer(this, state, isBuf, chunk, encoding, cb);\n  }\n\n  return ret;\n};\n\nWritable.prototype.cork = function () {\n  var state = this._writableState;\n\n  state.corked++;\n};\n\nWritable.prototype.uncork = function () {\n  var state = this._writableState;\n\n  if (state.corked) {\n    state.corked--;\n\n    if (!state.writing && !state.corked && !state.finished && !state.bufferProcessing && state.bufferedRequest) clearBuffer(this, state);\n  }\n};\n\nWritable.prototype.setDefaultEncoding = function setDefaultEncoding(encoding) {\n  // node::ParseEncoding() requires lower case.\n  if (typeof encoding === 'string') encoding = encoding.toLowerCase();\n  if (!(['hex', 'utf8', 'utf-8', 'ascii', 'binary', 'base64', 'ucs2', 'ucs-2', 'utf16le', 'utf-16le', 'raw'].indexOf((encoding + '').toLowerCase()) > -1)) throw new TypeError('Unknown encoding: ' + encoding);\n  this._writableState.defaultEncoding = encoding;\n  return this;\n};\n\nfunction decodeChunk(state, chunk, encoding) {\n  if (!state.objectMode && state.decodeStrings !== false && typeof chunk === 'string') {\n    chunk = Buffer.from(chunk, encoding);\n  }\n  return chunk;\n}\n\nObject.defineProperty(Writable.prototype, 'writableHighWaterMark', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function () {\n    return this._writableState.highWaterMark;\n  }\n});\n\n// if we're already writing something, then just put this\n// in the queue, and wait our turn.  Otherwise, call _write\n// If we return false, then we need a drain event, so set that flag.\nfunction writeOrBuffer(stream, state, isBuf, chunk, encoding, cb) {\n  if (!isBuf) {\n    var newChunk = decodeChunk(state, chunk, encoding);\n    if (chunk !== newChunk) {\n      isBuf = true;\n      encoding = 'buffer';\n      chunk = newChunk;\n    }\n  }\n  var len = state.objectMode ? 1 : chunk.length;\n\n  state.length += len;\n\n  var ret = state.length < state.highWaterMark;\n  // we must ensure that previous needDrain will not be reset to false.\n  if (!ret) state.needDrain = true;\n\n  if (state.writing || state.corked) {\n    var last = state.lastBufferedRequest;\n    state.lastBufferedRequest = {\n      chunk: chunk,\n      encoding: encoding,\n      isBuf: isBuf,\n      callback: cb,\n      next: null\n    };\n    if (last) {\n      last.next = state.lastBufferedRequest;\n    } else {\n      state.bufferedRequest = state.lastBufferedRequest;\n    }\n    state.bufferedRequestCount += 1;\n  } else {\n    doWrite(stream, state, false, len, chunk, encoding, cb);\n  }\n\n  return ret;\n}\n\nfunction doWrite(stream, state, writev, len, chunk, encoding, cb) {\n  state.writelen = len;\n  state.writecb = cb;\n  state.writing = true;\n  state.sync = true;\n  if (writev) stream._writev(chunk, state.onwrite);else stream._write(chunk, encoding, state.onwrite);\n  state.sync = false;\n}\n\nfunction onwriteError(stream, state, sync, er, cb) {\n  --state.pendingcb;\n\n  if (sync) {\n    // defer the callback if we are being called synchronously\n    // to avoid piling up things on the stack\n    pna.nextTick(cb, er);\n    // this can emit finish, and it will always happen\n    // after error\n    pna.nextTick(finishMaybe, stream, state);\n    stream._writableState.errorEmitted = true;\n    stream.emit('error', er);\n  } else {\n    // the caller expect this to happen before if\n    // it is async\n    cb(er);\n    stream._writableState.errorEmitted = true;\n    stream.emit('error', er);\n    // this can emit finish, but finish must\n    // always follow error\n    finishMaybe(stream, state);\n  }\n}\n\nfunction onwriteStateUpdate(state) {\n  state.writing = false;\n  state.writecb = null;\n  state.length -= state.writelen;\n  state.writelen = 0;\n}\n\nfunction onwrite(stream, er) {\n  var state = stream._writableState;\n  var sync = state.sync;\n  var cb = state.writecb;\n\n  onwriteStateUpdate(state);\n\n  if (er) onwriteError(stream, state, sync, er, cb);else {\n    // Check if we're actually ready to finish, but don't emit yet\n    var finished = needFinish(state);\n\n    if (!finished && !state.corked && !state.bufferProcessing && state.bufferedRequest) {\n      clearBuffer(stream, state);\n    }\n\n    if (sync) {\n      /*<replacement>*/\n      asyncWrite(afterWrite, stream, state, finished, cb);\n      /*</replacement>*/\n    } else {\n      afterWrite(stream, state, finished, cb);\n    }\n  }\n}\n\nfunction afterWrite(stream, state, finished, cb) {\n  if (!finished) onwriteDrain(stream, state);\n  state.pendingcb--;\n  cb();\n  finishMaybe(stream, state);\n}\n\n// Must force callback to be called on nextTick, so that we don't\n// emit 'drain' before the write() consumer gets the 'false' return\n// value, and has a chance to attach a 'drain' listener.\nfunction onwriteDrain(stream, state) {\n  if (state.length === 0 && state.needDrain) {\n    state.needDrain = false;\n    stream.emit('drain');\n  }\n}\n\n// if there's something in the buffer waiting, then process it\nfunction clearBuffer(stream, state) {\n  state.bufferProcessing = true;\n  var entry = state.bufferedRequest;\n\n  if (stream._writev && entry && entry.next) {\n    // Fast case, write everything using _writev()\n    var l = state.bufferedRequestCount;\n    var buffer = new Array(l);\n    var holder = state.corkedRequestsFree;\n    holder.entry = entry;\n\n    var count = 0;\n    var allBuffers = true;\n    while (entry) {\n      buffer[count] = entry;\n      if (!entry.isBuf) allBuffers = false;\n      entry = entry.next;\n      count += 1;\n    }\n    buffer.allBuffers = allBuffers;\n\n    doWrite(stream, state, true, state.length, buffer, '', holder.finish);\n\n    // doWrite is almost always async, defer these to save a bit of time\n    // as the hot path ends with doWrite\n    state.pendingcb++;\n    state.lastBufferedRequest = null;\n    if (holder.next) {\n      state.corkedRequestsFree = holder.next;\n      holder.next = null;\n    } else {\n      state.corkedRequestsFree = new CorkedRequest(state);\n    }\n    state.bufferedRequestCount = 0;\n  } else {\n    // Slow case, write chunks one-by-one\n    while (entry) {\n      var chunk = entry.chunk;\n      var encoding = entry.encoding;\n      var cb = entry.callback;\n      var len = state.objectMode ? 1 : chunk.length;\n\n      doWrite(stream, state, false, len, chunk, encoding, cb);\n      entry = entry.next;\n      state.bufferedRequestCount--;\n      // if we didn't call the onwrite immediately, then\n      // it means that we need to wait until it does.\n      // also, that means that the chunk and cb are currently\n      // being processed, so move the buffer counter past them.\n      if (state.writing) {\n        break;\n      }\n    }\n\n    if (entry === null) state.lastBufferedRequest = null;\n  }\n\n  state.bufferedRequest = entry;\n  state.bufferProcessing = false;\n}\n\nWritable.prototype._write = function (chunk, encoding, cb) {\n  cb(new Error('_write() is not implemented'));\n};\n\nWritable.prototype._writev = null;\n\nWritable.prototype.end = function (chunk, encoding, cb) {\n  var state = this._writableState;\n\n  if (typeof chunk === 'function') {\n    cb = chunk;\n    chunk = null;\n    encoding = null;\n  } else if (typeof encoding === 'function') {\n    cb = encoding;\n    encoding = null;\n  }\n\n  if (chunk !== null && chunk !== undefined) this.write(chunk, encoding);\n\n  // .end() fully uncorks\n  if (state.corked) {\n    state.corked = 1;\n    this.uncork();\n  }\n\n  // ignore unnecessary end() calls.\n  if (!state.ending && !state.finished) endWritable(this, state, cb);\n};\n\nfunction needFinish(state) {\n  return state.ending && state.length === 0 && state.bufferedRequest === null && !state.finished && !state.writing;\n}\nfunction callFinal(stream, state) {\n  stream._final(function (err) {\n    state.pendingcb--;\n    if (err) {\n      stream.emit('error', err);\n    }\n    state.prefinished = true;\n    stream.emit('prefinish');\n    finishMaybe(stream, state);\n  });\n}\nfunction prefinish(stream, state) {\n  if (!state.prefinished && !state.finalCalled) {\n    if (typeof stream._final === 'function') {\n      state.pendingcb++;\n      state.finalCalled = true;\n      pna.nextTick(callFinal, stream, state);\n    } else {\n      state.prefinished = true;\n      stream.emit('prefinish');\n    }\n  }\n}\n\nfunction finishMaybe(stream, state) {\n  var need = needFinish(state);\n  if (need) {\n    prefinish(stream, state);\n    if (state.pendingcb === 0) {\n      state.finished = true;\n      stream.emit('finish');\n    }\n  }\n  return need;\n}\n\nfunction endWritable(stream, state, cb) {\n  state.ending = true;\n  finishMaybe(stream, state);\n  if (cb) {\n    if (state.finished) pna.nextTick(cb);else stream.once('finish', cb);\n  }\n  state.ended = true;\n  stream.writable = false;\n}\n\nfunction onCorkedFinish(corkReq, state, err) {\n  var entry = corkReq.entry;\n  corkReq.entry = null;\n  while (entry) {\n    var cb = entry.callback;\n    state.pendingcb--;\n    cb(err);\n    entry = entry.next;\n  }\n  if (state.corkedRequestsFree) {\n    state.corkedRequestsFree.next = corkReq;\n  } else {\n    state.corkedRequestsFree = corkReq;\n  }\n}\n\nObject.defineProperty(Writable.prototype, 'destroyed', {\n  get: function () {\n    if (this._writableState === undefined) {\n      return false;\n    }\n    return this._writableState.destroyed;\n  },\n  set: function (value) {\n    // we ignore the value if the stream\n    // has not been initialized yet\n    if (!this._writableState) {\n      return;\n    }\n\n    // backward compatibility, the user is explicitly\n    // managing destroyed\n    this._writableState.destroyed = value;\n  }\n});\n\nWritable.prototype.destroy = destroyImpl.destroy;\nWritable.prototype._undestroy = destroyImpl.undestroy;\nWritable.prototype._destroy = function (err, cb) {\n  this.end();\n  cb(err);\n};","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n/*<replacement>*/\n\nvar Buffer = require('safe-buffer').Buffer;\n/*</replacement>*/\n\nvar isEncoding = Buffer.isEncoding || function (encoding) {\n  encoding = '' + encoding;\n  switch (encoding && encoding.toLowerCase()) {\n    case 'hex':case 'utf8':case 'utf-8':case 'ascii':case 'binary':case 'base64':case 'ucs2':case 'ucs-2':case 'utf16le':case 'utf-16le':case 'raw':\n      return true;\n    default:\n      return false;\n  }\n};\n\nfunction _normalizeEncoding(enc) {\n  if (!enc) return 'utf8';\n  var retried;\n  while (true) {\n    switch (enc) {\n      case 'utf8':\n      case 'utf-8':\n        return 'utf8';\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return 'utf16le';\n      case 'latin1':\n      case 'binary':\n        return 'latin1';\n      case 'base64':\n      case 'ascii':\n      case 'hex':\n        return enc;\n      default:\n        if (retried) return; // undefined\n        enc = ('' + enc).toLowerCase();\n        retried = true;\n    }\n  }\n};\n\n// Do not cache `Buffer.isEncoding` when checking encoding names as some\n// modules monkey-patch it to support additional encodings\nfunction normalizeEncoding(enc) {\n  var nenc = _normalizeEncoding(enc);\n  if (typeof nenc !== 'string' && (Buffer.isEncoding === isEncoding || !isEncoding(enc))) throw new Error('Unknown encoding: ' + enc);\n  return nenc || enc;\n}\n\n// StringDecoder provides an interface for efficiently splitting a series of\n// buffers into a series of JS strings without breaking apart multi-byte\n// characters.\nexports.StringDecoder = StringDecoder;\nfunction StringDecoder(encoding) {\n  this.encoding = normalizeEncoding(encoding);\n  var nb;\n  switch (this.encoding) {\n    case 'utf16le':\n      this.text = utf16Text;\n      this.end = utf16End;\n      nb = 4;\n      break;\n    case 'utf8':\n      this.fillLast = utf8FillLast;\n      nb = 4;\n      break;\n    case 'base64':\n      this.text = base64Text;\n      this.end = base64End;\n      nb = 3;\n      break;\n    default:\n      this.write = simpleWrite;\n      this.end = simpleEnd;\n      return;\n  }\n  this.lastNeed = 0;\n  this.lastTotal = 0;\n  this.lastChar = Buffer.allocUnsafe(nb);\n}\n\nStringDecoder.prototype.write = function (buf) {\n  if (buf.length === 0) return '';\n  var r;\n  var i;\n  if (this.lastNeed) {\n    r = this.fillLast(buf);\n    if (r === undefined) return '';\n    i = this.lastNeed;\n    this.lastNeed = 0;\n  } else {\n    i = 0;\n  }\n  if (i < buf.length) return r ? r + this.text(buf, i) : this.text(buf, i);\n  return r || '';\n};\n\nStringDecoder.prototype.end = utf8End;\n\n// Returns only complete characters in a Buffer\nStringDecoder.prototype.text = utf8Text;\n\n// Attempts to complete a partial non-UTF-8 character using bytes from a Buffer\nStringDecoder.prototype.fillLast = function (buf) {\n  if (this.lastNeed <= buf.length) {\n    buf.copy(this.lastChar, this.lastTotal - this.lastNeed, 0, this.lastNeed);\n    return this.lastChar.toString(this.encoding, 0, this.lastTotal);\n  }\n  buf.copy(this.lastChar, this.lastTotal - this.lastNeed, 0, buf.length);\n  this.lastNeed -= buf.length;\n};\n\n// Checks the type of a UTF-8 byte, whether it's ASCII, a leading byte, or a\n// continuation byte. If an invalid byte is detected, -2 is returned.\nfunction utf8CheckByte(byte) {\n  if (byte <= 0x7F) return 0;else if (byte >> 5 === 0x06) return 2;else if (byte >> 4 === 0x0E) return 3;else if (byte >> 3 === 0x1E) return 4;\n  return byte >> 6 === 0x02 ? -1 : -2;\n}\n\n// Checks at most 3 bytes at the end of a Buffer in order to detect an\n// incomplete multi-byte UTF-8 character. The total number of bytes (2, 3, or 4)\n// needed to complete the UTF-8 character (if applicable) are returned.\nfunction utf8CheckIncomplete(self, buf, i) {\n  var j = buf.length - 1;\n  if (j < i) return 0;\n  var nb = utf8CheckByte(buf[j]);\n  if (nb >= 0) {\n    if (nb > 0) self.lastNeed = nb - 1;\n    return nb;\n  }\n  if (--j < i || nb === -2) return 0;\n  nb = utf8CheckByte(buf[j]);\n  if (nb >= 0) {\n    if (nb > 0) self.lastNeed = nb - 2;\n    return nb;\n  }\n  if (--j < i || nb === -2) return 0;\n  nb = utf8CheckByte(buf[j]);\n  if (nb >= 0) {\n    if (nb > 0) {\n      if (nb === 2) nb = 0;else self.lastNeed = nb - 3;\n    }\n    return nb;\n  }\n  return 0;\n}\n\n// Validates as many continuation bytes for a multi-byte UTF-8 character as\n// needed or are available. If we see a non-continuation byte where we expect\n// one, we \"replace\" the validated continuation bytes we've seen so far with\n// a single UTF-8 replacement character ('\\ufffd'), to match v8's UTF-8 decoding\n// behavior. The continuation byte check is included three times in the case\n// where all of the continuation bytes for a character exist in the same buffer.\n// It is also done this way as a slight performance increase instead of using a\n// loop.\nfunction utf8CheckExtraBytes(self, buf, p) {\n  if ((buf[0] & 0xC0) !== 0x80) {\n    self.lastNeed = 0;\n    return '\\ufffd';\n  }\n  if (self.lastNeed > 1 && buf.length > 1) {\n    if ((buf[1] & 0xC0) !== 0x80) {\n      self.lastNeed = 1;\n      return '\\ufffd';\n    }\n    if (self.lastNeed > 2 && buf.length > 2) {\n      if ((buf[2] & 0xC0) !== 0x80) {\n        self.lastNeed = 2;\n        return '\\ufffd';\n      }\n    }\n  }\n}\n\n// Attempts to complete a multi-byte UTF-8 character using bytes from a Buffer.\nfunction utf8FillLast(buf) {\n  var p = this.lastTotal - this.lastNeed;\n  var r = utf8CheckExtraBytes(this, buf, p);\n  if (r !== undefined) return r;\n  if (this.lastNeed <= buf.length) {\n    buf.copy(this.lastChar, p, 0, this.lastNeed);\n    return this.lastChar.toString(this.encoding, 0, this.lastTotal);\n  }\n  buf.copy(this.lastChar, p, 0, buf.length);\n  this.lastNeed -= buf.length;\n}\n\n// Returns all complete UTF-8 characters in a Buffer. If the Buffer ended on a\n// partial character, the character's bytes are buffered until the required\n// number of bytes are available.\nfunction utf8Text(buf, i) {\n  var total = utf8CheckIncomplete(this, buf, i);\n  if (!this.lastNeed) return buf.toString('utf8', i);\n  this.lastTotal = total;\n  var end = buf.length - (total - this.lastNeed);\n  buf.copy(this.lastChar, 0, end);\n  return buf.toString('utf8', i, end);\n}\n\n// For UTF-8, a replacement character is added when ending on a partial\n// character.\nfunction utf8End(buf) {\n  var r = buf && buf.length ? this.write(buf) : '';\n  if (this.lastNeed) return r + '\\ufffd';\n  return r;\n}\n\n// UTF-16LE typically needs two bytes per character, but even if we have an even\n// number of bytes available, we need to check if we end on a leading/high\n// surrogate. In that case, we need to wait for the next two bytes in order to\n// decode the last character properly.\nfunction utf16Text(buf, i) {\n  if ((buf.length - i) % 2 === 0) {\n    var r = buf.toString('utf16le', i);\n    if (r) {\n      var c = r.charCodeAt(r.length - 1);\n      if (c >= 0xD800 && c <= 0xDBFF) {\n        this.lastNeed = 2;\n        this.lastTotal = 4;\n        this.lastChar[0] = buf[buf.length - 2];\n        this.lastChar[1] = buf[buf.length - 1];\n        return r.slice(0, -1);\n      }\n    }\n    return r;\n  }\n  this.lastNeed = 1;\n  this.lastTotal = 2;\n  this.lastChar[0] = buf[buf.length - 1];\n  return buf.toString('utf16le', i, buf.length - 1);\n}\n\n// For UTF-16LE we do not explicitly append special replacement characters if we\n// end on a partial character, we simply let v8 handle that.\nfunction utf16End(buf) {\n  var r = buf && buf.length ? this.write(buf) : '';\n  if (this.lastNeed) {\n    var end = this.lastTotal - this.lastNeed;\n    return r + this.lastChar.toString('utf16le', 0, end);\n  }\n  return r;\n}\n\nfunction base64Text(buf, i) {\n  var n = (buf.length - i) % 3;\n  if (n === 0) return buf.toString('base64', i);\n  this.lastNeed = 3 - n;\n  this.lastTotal = 3;\n  if (n === 1) {\n    this.lastChar[0] = buf[buf.length - 1];\n  } else {\n    this.lastChar[0] = buf[buf.length - 2];\n    this.lastChar[1] = buf[buf.length - 1];\n  }\n  return buf.toString('base64', i, buf.length - n);\n}\n\nfunction base64End(buf) {\n  var r = buf && buf.length ? this.write(buf) : '';\n  if (this.lastNeed) return r + this.lastChar.toString('base64', 0, 3 - this.lastNeed);\n  return r;\n}\n\n// Pass bytes on through for single-byte encodings (e.g. ascii, latin1, hex)\nfunction simpleWrite(buf) {\n  return buf.toString(this.encoding);\n}\n\nfunction simpleEnd(buf) {\n  return buf && buf.length ? this.write(buf) : '';\n}","function uint8ToUuid (data: Uint8Array): string {\n  if (data.length !== 16) {\n    return '';\n  }\n\n  function cb (previous: string, current: number): string {\n    return previous + current.toString(16).padStart(2, '0');\n  }\n\n  return data.slice(0, 4).reduce(cb, '') +\n    '-' + data.slice(4, 6).reduce(cb, '') +\n    '-' + data.slice(6, 8).reduce(cb, '') +\n    '-' + data.slice(8, 10).reduce(cb, '') +\n    '-' + data.slice(10).reduce(cb, '');\n}\n\nexport function uuidv4 (): string {\n  // Check for crypto API\n  if (window.crypto === undefined) {\n    return uint8ToUuid(new Uint8Array(16));\n  }\n\n  // Get 16 octets for UUID\n  const octets = new Uint8Array(16);\n  const modifiers = Uint8Array.from([\n    parseInt('01000000', 2),  // Version bits (4 => 0100)\n    parseInt('10000000', 2),  // Variant bits (10x)\n    parseInt('00001111', 2),  // Mask to zero higher bits, version\n    parseInt('00111111', 2)   // Mask to zero higher bits, variant\n  ]);\n  window.crypto.getRandomValues(octets);\n  // Set version bits and variant bits\n  octets[6] = (octets[6] & modifiers[2]) | modifiers[0];\n  octets[8] = (octets[8] & modifiers[3]) | modifiers[1];\n\n  return uint8ToUuid(octets);\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar punycode = require('punycode');\nvar util = require('./util');\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // Special case for a simple path URL\n    simplePathPattern = /^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[+a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = require('querystring');\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && util.isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!util.isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  // Copy chrome, IE, opera backslash-handling behavior.\n  // Back slashes before the query string get converted to forward slashes\n  // See: https://code.google.com/p/chromium/issues/detail?id=25916\n  var queryIndex = url.indexOf('?'),\n      splitter =\n          (queryIndex !== -1 && queryIndex < url.indexOf('#')) ? '?' : '#',\n      uSplit = url.split(splitter),\n      slashRegex = /\\\\/g;\n  uSplit[0] = uSplit[0].replace(slashRegex, '/');\n  url = uSplit.join(splitter);\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  if (!slashesDenoteHost && url.split('#').length === 1) {\n    // Try fast path regexp\n    var simplePath = simplePathPattern.exec(rest);\n    if (simplePath) {\n      this.path = rest;\n      this.href = rest;\n      this.pathname = simplePath[1];\n      if (simplePath[2]) {\n        this.search = simplePath[2];\n        if (parseQueryString) {\n          this.query = querystring.parse(this.search.substr(1));\n        } else {\n          this.query = this.search.substr(1);\n        }\n      } else if (parseQueryString) {\n        this.search = '';\n        this.query = {};\n      }\n      return this;\n    }\n  }\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a punycoded representation of \"domain\".\n      // It only converts parts of the domain name that\n      // have non-ASCII characters, i.e. it doesn't matter if\n      // you call it with a domain that already is ASCII-only.\n      this.hostname = punycode.toASCII(this.hostname);\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      if (rest.indexOf(ae) === -1)\n        continue;\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (util.isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      util.isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (util.isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  var tkeys = Object.keys(this);\n  for (var tk = 0; tk < tkeys.length; tk++) {\n    var tkey = tkeys[tk];\n    result[tkey] = this[tkey];\n  }\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    var rkeys = Object.keys(relative);\n    for (var rk = 0; rk < rkeys.length; rk++) {\n      var rkey = rkeys[rk];\n      if (rkey !== 'protocol')\n        result[rkey] = relative[rkey];\n    }\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      var keys = Object.keys(relative);\n      for (var v = 0; v < keys.length; v++) {\n        var k = keys[v];\n        result[k] = relative[k];\n      }\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!util.isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especially happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host || srcPath.length > 1) &&\n      (last === '.' || last === '..') || last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last === '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especially happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n","\nvar urilib = require('url');\nvar helpers = require('./helpers');\n\nmodule.exports.SchemaScanResult = SchemaScanResult;\nfunction SchemaScanResult(found, ref){\n  this.id = found;\n  this.ref = ref;\n}\n\n/**\n * Adds a schema with a certain urn to the Validator instance.\n * @param string uri\n * @param object schema\n * @return {Object}\n */\nmodule.exports.scan = function scan(base, schema){\n  function scanSchema(baseuri, schema){\n    if(!schema || typeof schema!='object') return;\n    // Mark all referenced schemas so we can tell later which schemas are referred to, but never defined\n    if(schema.$ref){\n      var resolvedUri = urilib.resolve(baseuri, schema.$ref);\n      ref[resolvedUri] = ref[resolvedUri] ? ref[resolvedUri]+1 : 0;\n      return;\n    }\n    var ourBase = schema.id ? urilib.resolve(baseuri, schema.id) : baseuri;\n    if (ourBase) {\n      // If there's no fragment, append an empty one\n      if(ourBase.indexOf('#')<0) ourBase += '#';\n      if(found[ourBase]){\n        if(!helpers.deepCompareStrict(found[ourBase], schema)){\n          throw new Error('Schema <'+schema+'> already exists with different definition');\n        }\n        return found[ourBase];\n      }\n      found[ourBase] = schema;\n      // strip trailing fragment\n      if(ourBase[ourBase.length-1]=='#'){\n        found[ourBase.substring(0, ourBase.length-1)] = schema;\n      }\n    }\n    scanArray(ourBase+'/items', ((schema.items instanceof Array)?schema.items:[schema.items]));\n    scanArray(ourBase+'/extends', ((schema.extends instanceof Array)?schema.extends:[schema.extends]));\n    scanSchema(ourBase+'/additionalItems', schema.additionalItems);\n    scanObject(ourBase+'/properties', schema.properties);\n    scanSchema(ourBase+'/additionalProperties', schema.additionalProperties);\n    scanObject(ourBase+'/definitions', schema.definitions);\n    scanObject(ourBase+'/patternProperties', schema.patternProperties);\n    scanObject(ourBase+'/dependencies', schema.dependencies);\n    scanArray(ourBase+'/disallow', schema.disallow);\n    scanArray(ourBase+'/allOf', schema.allOf);\n    scanArray(ourBase+'/anyOf', schema.anyOf);\n    scanArray(ourBase+'/oneOf', schema.oneOf);\n    scanSchema(ourBase+'/not', schema.not);\n  }\n  function scanArray(baseuri, schemas){\n    if(!(schemas instanceof Array)) return;\n    for(var i=0; i<schemas.length; i++){\n      scanSchema(baseuri+'/'+i, schemas[i]);\n    }\n  }\n  function scanObject(baseuri, schemas){\n    if(!schemas || typeof schemas!='object') return;\n    for(var p in schemas){\n      scanSchema(baseuri+'/'+p, schemas[p]);\n    }\n  }\n\n  var found = {};\n  var ref = {};\n  var schemaUri = base;\n  scanSchema(base, schema);\n  return new SchemaScanResult(found, ref);\n}\n","/**\n * HTML for each insert tab (neume, grouping, clef, system, and division).\n */\nexport const insertTabHtml: Record<string, string> = {\n  primitiveTab: '<p class=\\'control\\'>' +\n        '<button id=\\'punctum\\' class=\\'button insertel smallel\\' title=\\'punctum\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/punctum.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'virga\\' class=\\'button insertel smallel\\' title=\\'virga\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/virga.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'diamond\\' class=\\'button insertel smallel\\' title=\\'inclinatum\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/diamond.png' + '\\' class=\\'image\\'/></button></p>' +\n  /*  \"<p class='control'>\" +\n        \"<button id='white_punct' class='button insertel smallel' title='white punctum'><img src='\" + White__ASSET_PREFIX__ + 'assets/img/punctum.png' + \"' class='image'/></button></p>\" +\n        \"<p class='control'>\" +\n        \"<button id='quilisma' class='button insertel smallel' title='quilisma'><img src='\" + __ASSET_PREFIX__ + 'assets/img/quilisma.png' + \"' class='image'/></button></p>\" + */\n        '<p class=\\'control\\'>' +\n        '<button id=\\'custos\\' class=\\'button insertel smallel\\' title=\\'custos\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/custos.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'cClef\\' class=\\'button insertel smallel\\' title=\\' C Clef\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/cClef.png' + '\\' class=\\'image\\' /></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'fClef\\' class=\\'button insertel smallel\\' title=\\'F Clef\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/fClef.png' + '\\' class=\\'image\\'/></button></p>',\n  groupingTab: '<p class=\\'control\\'>' +\n        '<button id=\\'pes\\' class=\\'button insertel smallel\\' title=\\'pes\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/pes.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'clivis\\' class=\\'button insertel smallel\\' title=\\'clivis\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/clivis.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'scandicus\\' class=\\'button insertel smallel\\' title=\\'scandicus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/scandicus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'climacus\\' class=\\'button insertel smallel\\' title=\\'climacus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/climacus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'torculus\\' class=\\'button insertel smallel\\' title=\\'toculus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/torculus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'porrectus\\' class=\\'button insertel smallel\\' title=\\'porrectus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/porrectus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'pressus\\' class=\\'button insertel smallel\\' title=\\'pressus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/pressus.png' + '\\' class=\\'image\\'/></button></p>',\n  systemTab: '<p class=\\'control\\'>' +\n        '<button id=\\'staff\\' class=\\'button insertel longel\\' title=\\'system\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/staff.png' + '\\' class=\\'image\\' /></button></p>' +\n        '<p>Click upper left and lower right corners of new staff.</p>'\n  // divisionTab: \"<p class='control'>\" +\n  //     \"<button id='smallDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/smalldiv.png' + \"' class='image'/></button></p>\" +\n  //     \"<p class='control'>\" +\n  //     \"<button id='minorDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/minordiv.png' +\"' class='image'/></button></p>\" +\n  //     \"<p class='control'>\" +\n  //     \"<button id='majorDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/majordiv.png' + \"' class='image'/></button></p>\" +\n  //     \"<p class='control'>\" +\n  //     \"<button id='finalDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/finaldiv.png' + \"' class='image'/></button></p>\"\n};\n\n/**\n * Structure of insert panel with basic grouping tabs.\n */\nexport const insertControlsPanel: string =\n    '<p class=\\'panel-heading\\' id=\\'insertMenu\\'>Insert' +\n    '<svg class=\\'icon is-pulled-right\\'><use id=\\'toggleInsert\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></p>' +\n    '<div id=\\'insertContents\\' style=\\'overflow-y: hidden;\\'>' +\n    '<p class=\\'panel-tabs\\'>' +\n    '<a id=\\'primitiveTab\\' class=\\'insertTab\\'>Primitive Elements</a>' +\n    '<a id=\\'groupingTab\\' class=\\'insertTab\\'>Grouping</a>' +\n    '<a id=\\'systemTab\\' class=\\'insertTab\\'>System</a></p>' +\n    // \"<a id='divisionTab' class='insertTab'>Division</a></p>\" +\n    '<a class=\\'panel-block has-text-centered\\'>' +\n    '<div id=\\'insert_data\\' class=\\'field is-grouped buttons\\'></div></a></div>';\n\n/**\n * Contents of edit panel with buttons.\n */\nexport const editControlsPanel: string =\n    '<p class=\\'panel-heading\\' id=\\'editMenu\\'>Edit' +\n    '<svg class=\\'icon is-pulled-right\\'><use id=\\'toggleEdit\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></p>' +\n    '<div id=\\'editContents\\'>' +\n    '<a class=\\'panel-block\\'>' +\n    '<label>Select By:&nbsp;</label>' +\n    '<div class=\\'field has-addons buttons\\' style=\\'overflow-x: auto;\\'>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by is-active\\' id=\\'selBySyl\\'>Syllable</button></p>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by\\' id=\\'selByNeume\\'>Neume</button></p>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by\\' id=\\'selByNc\\'>Neume Component</button></p>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by\\' id=\\'selByStaff\\'>Staff</button></p></div></a>' +\n    '<div class=\\'field is-grouped buttons\\'>' +\n    '<p class=\\'control\\'>' +\n    '<a id=\\'moreEdit\\' class=\\'panel-block is-invisible\\'>' +\n    '<a id=\\'neumeEdit\\' class=\\'panel-block is-invisible\\'></div>';\n\n/**\n * Contents of extra nc action menu.\n */\nexport const ncActionContents: string =\n        '<label>Change Head Shape:&nbsp;</label>' +\n        '<div id=\\'drop_select\\' class=\\'dropdown\\'>' +\n        '<div class=\\'dropdown-trigger\\'>' +\n        '<button id=\\'select-options\\' class=\\'button\\' aria-haspopup=\\'true\\' aria-controls=\\'dropdown-menu\\'>' +\n        '<span>Head Shapes</span>' +\n        '<svg class=\\'icon\\'><use xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></button></div>' +\n        '<div class=\\'dropdown-menu\\' id=\\'dropdown-menu\\' role=\\'menu\\'>' +\n        '<div class=\\'dropdown-content\\'>' +\n        '<a id=\\'Punctum\\' class=\\'dropdown-item\\'>Punctum</a>' +\n        '<a id=\\'Virga\\' class=\\'dropdown-item\\'>Virga</a>' +\n        '<a id=\\'Inclinatum\\' class=\\'dropdown-item\\'>Inclinatum</a></div></div></div>' +\n        '<p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of extra neume action menu.\n */\nexport const neumeActionContents: string =\n        '<label>Change Grouping:&nbsp;</label>' +\n        '<div id=\\'drop_select\\' class=\\'dropdown\\'>' +\n        '<div class=\\'dropdown-trigger\\'>' +\n        '<button id=\\'select-options\\' class=\\'button\\' aria-haspopup=\\'true\\' aria-controls=\\'dropdown-menu\\'>' +\n        '<span>Groupings</span>' +\n        '<svg class=\\'icon\\'><use xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></button></div>' +\n        '<div class=\\'dropdown-menu\\' id=\\'dropdown-menu\\' role=\\'menu\\'>' +\n        '<div class=\\'dropdown-content scrollable-dropdown\\'>' +\n        '<a id=\\'Pes\\' class=\\'dropdown-item grouping\\'>Pes</a>' +\n        '<a id=\\'Pes subpunctis\\' class=\\'dropdown-item grouping\\'>Pes Subpunctis</a>' +\n        '<a id=\\'Clivis\\' class=\\'dropdown-item grouping\\'>Clivis</a>' +\n        '<a id=\\'Scandicus\\' class=\\'dropdown-item grouping\\'>Scandicus</a>' +\n        '<a id=\\'Scandicus flexus\\' class=\\'dropdown-item grouping\\'>Scandicus Flexus</a>' +\n        '<a id=\\'Scandicus subpunctis\\' class=\\'dropdown-item grouping\\'>Scandicus Subpunctis</a>' +\n        '<a id=\\'Climacus\\' class=\\'dropdown-item grouping\\'>Climacus</a>' +\n        '<a id=\\'Climacus resupinus\\' class=\\'dropdown-item grouping\\'>Climacus Resupinus</a>' +\n        '<a id=\\'Torculus\\' class=\\'dropdown-item grouping\\'>Torculus</a>' +\n        '<a id=\\'Torculus resupinus\\' class=\\'dropdown-item grouping\\'>Torculus Resupinus</a>' +\n        '<a id=\\'Porrectus\\' class=\\'dropdown-item grouping\\'>Porrectus</a>' +\n        '<a id=\\'Porrectus flexus\\' class=\\'dropdown-item grouping\\'>Porrectus Flexus</a>' +\n        '<a id=\\'Porrectus subpunctis\\' class=\\'dropdown-item grouping\\'>Porrectus Subpunctis</a>' +\n        '<a id=\\'Pressus\\' class=\\'dropdown-item grouping\\'>Pressus</a>' +\n        '</div></div></div>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'ungroupNcs\\'>Ungroup</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of extra staff action menu.\n */\nexport const staffActionContents: string =\n    '<label>Merge Systems:&nbsp;</label>' +\n    '<div><p class=\\'control\\'>' +\n    '<button id=\\'merge-systems\\' class=\\'button\\'>Merge</button>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of default action menu.\n */\nexport const defaultActionContents: string =\n    '<div><p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of default action menu when selecting by syllable\n * Same as above except includes re-associate to nearest staff\n */\n export const defaultSylActionContents: string =\n    '<div><p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n    '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>';\n    \n/**\n * Contents of custos action menu.\n */\nexport const custosActionContents: string =\n    '<div><p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n    '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>';\n\n/**\n * Contents of split action menu.\n * @type {string}\n */\nexport const splitActionContents: string=\n    '<label>Split System:&nbsp;</label>' +\n    '<div><p class=\\'control\\'>' +\n    '<button id=\\'split-system\\' class=\\'button\\'>Split</button>' +\n    '<button id=\\'reset-skew\\' class=\\'button\\'>Reset Skew</button>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of extra clef action menu.\n */\nexport const clefActionContents: string =\n    '<label>Change Clef Shape:&nbsp;</label>' +\n    '<div id=\\'drop_select\\' class=\\'dropdown\\'>' +\n    '<div class=\\'field has-addons buttons\\' style=\\'overflow-x: auto;\\'>' +\n    '<div class=\\'dropdown-trigger\\'>' +\n    '<button id=\\'select-options\\' class=\\'button\\' aria-haspopup=\\'true\\' aria-controls=\\'dropdown-menu\\'>' +\n    '<span>Clef Shapes</span>' +\n    '<svg class=\\'icon\\'><use xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></button></div>' +\n    '<div class=\\'dropdown-menu\\' id=\\'dropdown-menu\\' role=\\'menu\\'>' +\n    '<div class=\\'dropdown-content\\'>' +\n    '<a id=\\'CClef\\' class=\\'dropdown-item\\'>C Clef</a>' +\n    '<a id=\\'FClef\\' class=\\'dropdown-item\\'>F Clef</a></div></div>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n    '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></div></div>';\n\n/**\n * HTML for grouping selection menu.\n */\nexport const groupingMenu: object = {\n  'nc': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'groupNcs\\'>Group Neume Components</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>',\n  'neume': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'groupNeumes\\'>Group Neumes</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>',\n  'syl': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'mergeSyls\\'>Merge Syllables</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n        '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>',\n  'ligatureNc': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'groupNcs\\'>Group Neume Components</button></p></div>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'toggle-ligature\\'>Toggle Ligature</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div></div>',\n  'ligature': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'toggle-ligature\\'>Toggle Ligature</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div></div>',\n  'splitSyllable': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'toggle-link\\'>Toggle Linked Syllables</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div></div>'\n};\n","/** @module utils/Select */\n\nimport {\n  unselect, getStaffBBox, selectStaff, selectAll, getSelectionType\n} from './SelectTools';\nimport { resize } from './Resize';\nimport NeonView from '../NeonView';\nimport DragHandler from './DragHandler';\nimport { InfoInterface } from '../Interfaces';\nimport ZoomHandler from '../SingleView/Zoom';\n\nimport * as d3 from 'd3';\n\nlet dragHandler: DragHandler, neonView: NeonView, info: InfoInterface, zoomHandler: ZoomHandler;\nlet strokeWidth = 7;\n\nexport function setSelectStrokeWidth (width: number): void {\n  strokeWidth = width;\n}\n\n/**\n * Set the objects for this module.\n */\nexport function setSelectHelperObjects (nv: NeonView, dh: DragHandler): void {\n  dragHandler = dh;\n  neonView = nv;\n  info = neonView.info;\n  zoomHandler = neonView.view.zoomHandler;\n}\n\nfunction escapeKeyListener (evt: KeyboardEvent): void {\n  if (evt.key === 'Escape') {\n    if (document.getElementsByClassName('selected').length > 0) {\n      info.infoListeners();\n    }\n    unselect();\n  }\n}\n\nfunction isSelByBBox (): boolean {\n  const selByBBox = document.getElementById('selByBBox');\n  if (selByBBox) {\n    return selByBBox.classList.contains('is-active');\n  }\n  return false;\n}\n\nfunction stopPropHandler (evt): void { evt.stopPropagation(); }\n\n/**\n * Apply listeners for click selection.\n * @param selector - The CSS selector used to choose where listeners are applied.\n */\nexport function clickSelect (selector: string): void {\n  document.querySelectorAll(selector).forEach(sel => {\n    sel.removeEventListener('mousedown', clickHandler);\n    sel.addEventListener('mousedown', clickHandler);\n  });\n\n  // Click away listeners\n  document.body.removeEventListener('keydown', escapeKeyListener);\n  document.body.addEventListener('keydown', escapeKeyListener);\n\n  document.getElementById('container')\n    .addEventListener('contextmenu', (evt) => { evt.preventDefault(); });\n\n  document.querySelectorAll('use,rect,#moreEdit').forEach(sel => {\n    sel.removeEventListener('click', stopPropHandler);\n    sel.addEventListener('click', stopPropHandler);\n  });\n}\n\n/**\n * Handle click events related to element selection.\n */\nfunction clickHandler (evt: MouseEvent): void {\n  if (!neonView) return;\n  const mode = neonView.getUserMode();\n\n  // If in insert mode or panning is active from shift key\n  if (mode === 'insert' || evt.shiftKey) { return; }\n  // Check if the element being clicked on is part of a drag Selection\n  if (this.tagName === 'use' && getSelectionType() !== 'selByBBox') {\n    if (this.closest('.selected') === null) {\n      let selection = [this];\n      // Check if this is part of a ligature and, if so, add all of it to the selection.\n      const firstLigatureHalf = /E9B[45678]/;\n      const secondLigatureHalf = /E9B[9ABC]/;\n      if (this.getAttribute('xlink:href').match(secondLigatureHalf)) {\n        // This is the second part of a ligature\n        const nc = this.closest('.nc');\n        const neume = this.closest('.neume');\n        const ncIndex = Array.from(neume.children).indexOf(nc);\n        const firstUse = neume.children[ncIndex - 1].children[0];\n        console.assert(firstUse.getAttribute('xlink:href').match(firstLigatureHalf), 'First glyph of ligature unexpected!');\n        if (firstUse.closest('.selected') === null) {\n          selection.unshift(firstUse);\n        }\n      } else if (this.getAttribute('xlink:href').match(firstLigatureHalf)) {\n        // This is the first part of a ligature\n        const nc = this.closest('.nc');\n        const neume = this.closest('.neume');\n        const ncIndex = Array.from(neume.children).indexOf(nc);\n        const secondUse = neume.children[ncIndex + 1].children[0];\n        console.assert(secondUse.getAttribute('xlink:href').match(secondLigatureHalf), 'Second glyph of ligature unexpected!');\n        if (secondUse.closest('.selected') === null) {\n          selection.push(secondUse);\n        }\n      }\n      if (window.navigator.userAgent.match(/Mac/) ? evt.metaKey : evt.ctrlKey) {\n        selection = selection.concat(Array.from(document.getElementsByClassName('selected')));\n      }\n      selectAll(selection, neonView, dragHandler);\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n    }\n  } else if ((evt.target as HTMLElement).tagName === 'rect' && getSelectionType() === 'selByBBox') {\n    if (this.closest('.selected') === null) {\n      let selection = [evt.target] as SVGGElement[];\n      if (window.navigator.userAgent.match(/Mac/) ? evt.metaKey : evt.ctrlKey) {\n        selection = selection.concat(Array.from(document.getElementsByClassName('selected')) as SVGGElement[]);\n      }\n      selectAll(selection, neonView, dragHandler);\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n    }\n  } else {\n    // Check if the point being clicked on is a staff selection (if applicable)\n    if (getSelectionType() !== 'selByStaff') {\n      info.infoListeners();\n      return;\n    }\n\n    // Check if the point is in a staff.\n    const container = document.getElementsByClassName('active-page')[0].getElementsByClassName('definition-scale')[0] as SVGSVGElement;\n    let pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGraphicsElement).getScreenCTM();\n    pt = pt.matrixTransform(transformMatrix.inverse());\n\n    const selectedStaves = Array.from(document.getElementsByClassName('staff'))\n      .filter((staff: SVGGElement) => {\n        const bbox = getStaffBBox(staff);\n        let ulx = bbox.ulx;\n        let uly = bbox.uly;\n        let lrx = bbox.lrx;\n        let lry = bbox.lry;\n        let skew = bbox.skew;\n\n        return (pt.x > ulx && pt.x < lrx) && \n          (pt.y > (uly + (pt.x - ulx) * Math.tan(skew))) && \n          (pt.y < (lry - (lrx - pt.x) * Math.tan(skew)));\n      });\n\n    unselect();\n    if (selectedStaves.length == 0) {\n      return;\n    }\n    \n    // Select a staff\n    const staff = selectedStaves[0] as SVGGElement;\n    let bbox = getStaffBBox(staff);\n    if (!staff.classList.contains('selected')) {\n      // Select previously unselected staff\n      selectStaff(staff, dragHandler);\n      resize(staff, neonView, dragHandler);\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n    }\n    // Trigger mousedown event on the staff\n    staff.dispatchEvent(new MouseEvent('mousedown', {\n      screenX: evt.screenX,\n      screenY: evt.screenY,\n      clientX: evt.clientX,\n      clientY: evt.clientY,\n      ctrlKey: evt.ctrlKey,\n      shiftKey: evt.shiftKey,\n      altKey: evt.altKey,\n      metaKey: evt.metaKey,\n      view: evt.view\n    }));\n  }\n}\n\n/**\n * Apply listeners for drag selection.\n * @param selector - The CSS selector used to choose where listeners are applied.\n */\nexport function dragSelect (selector: string): void {\n  let initialX = 0;\n  let initialY = 0;\n  let panning = false;\n  let dragSelecting = false;\n  // var canvas = d3.select('#svg_group');\n  d3.selectAll(selector.replace('.active-page', '').trim())\n    .on('.drag', null);\n  const canvas = d3.select(selector);\n  const dragSelectAction = d3.drag()\n    .on('start', selStart)\n    .on('drag', selecting)\n    .on('end', selEnd);\n  canvas.call(dragSelectAction);\n  if (dragHandler) {\n    dragHandler.resetTo(dragSelectAction);\n  }\n\n  function selStart (): void {\n    if (!neonView) return;\n    const userMode = neonView.getUserMode();\n    if (d3.event.sourceEvent.target.nodeName !== 'use' && userMode !== 'insert' && d3.event.sourceEvent.target.nodeName !== 'rect') {\n      if (!d3.event.sourceEvent.shiftKey) { // If not holding down shift key to pan\n        if (!document.getElementById('selByStaff').classList.contains('is-active') ||\n          pointNotInStaff(d3.mouse(this))) {\n          unselect();\n          dragSelecting = true;\n          const initialP = d3.mouse(this);\n          initialX = initialP[0];\n          initialY = initialP[1];\n          initRect(initialX, initialY);\n        }\n      } else {\n        panning = true;\n        if (zoomHandler !== undefined) {\n          zoomHandler.startDrag();\n        }\n      }\n    } else if (d3.event.sourceEvent.shiftKey) {\n      panning = true;\n      if (zoomHandler !== undefined) {\n        zoomHandler.startDrag();\n      }\n    }\n  }\n\n  /**\n   * Check if a point is in the bounds of a staff element.\n   * Skew is not taken into account.\n   */\n  function pointNotInStaff (pt: number[]): boolean {\n    const staves = Array.from(document.getElementsByClassName('staff'));\n    const filtered = staves.filter((staff: SVGGElement) => {\n      const bbox = getStaffBBox(staff);\n        let ulx = bbox.ulx;\n        let uly = bbox.uly;\n        let lrx = bbox.lrx;\n        let lry = bbox.lry;\n        let skew = bbox.skew;\n\n        return (pt[0] > ulx && pt[0] < lrx) && \n          (pt[1] > (uly + (pt[0] - ulx) * Math.tan(skew))) && \n          (pt[1] < (lry - (lrx - pt[0]) * Math.tan(skew)));\n    });\n    return (filtered.length === 0);\n  }\n\n  function selecting (): void {\n    if (!panning && dragSelecting) {\n      const currentPt = d3.mouse(this);\n      const curX = currentPt[0];\n      const curY = currentPt[1];\n\n      const newX = curX < initialX ? curX : initialX;\n      const newY = curY < initialY ? curY : initialY;\n      const width = curX < initialX ? initialX - curX : curX - initialX;\n      const height = curY < initialY ? initialY - curY : curY - initialY;\n\n      updateRect(newX, newY, width, height);\n    } else if (panning) {\n      if (zoomHandler !== undefined) {\n        zoomHandler.dragging();\n      }\n    }\n  }\n\n  function selEnd (): void {\n    if (!panning && dragSelecting) {\n      const rx = parseInt(document.getElementById('selectRect').getAttribute('x'));\n      const ry = parseInt(document.getElementById('selectRect').getAttribute('y'));\n      const lx = parseInt(document.getElementById('selectRect').getAttribute('x')) +\n        parseInt(document.getElementById('selectRect').getAttribute('width'));\n      const ly = parseInt(document.getElementById('selectRect').getAttribute('y')) +\n        parseInt(document.getElementById('selectRect').getAttribute('height'));\n      // Transform to the correct coordinate system\n      const node = canvas.node() as SVGSVGElement;\n      let ul = node.createSVGPoint();\n      ul.x = rx;\n      ul.y = ry;\n      let lr = node.createSVGPoint();\n      lr.x = lx;\n      lr.y = ly;\n      const transform = node.getScreenCTM().inverse()\n        .multiply((canvas.select('.system').node() as SVGGraphicsElement)\n          .getScreenCTM()).inverse();\n      ul = ul.matrixTransform(transform);\n      lr = lr.matrixTransform(transform);\n\n      let nc;\n      if (document.getElementById('selByStaff').classList.contains('is-active')) {\n        nc = document.querySelectorAll(selector + ' use, ' + selector + ' .staff');\n      } else if (isSelByBBox()) {\n        nc = document.querySelectorAll(selector + ' .sylTextRect-display');\n      } else {\n        nc = document.querySelectorAll(selector + ' use');\n      }\n      const els = Array.from(nc);\n\n      const elements = els.filter(function (d: SVGGraphicsElement): boolean {\n        let ulx, uly, lrx, lry;\n        if (isSelByBBox()) {\n          ulx = Number(d.getAttribute('x'));\n          uly = Number(d.getAttribute('y'));\n          lrx = +ulx + +(d.getAttribute('width').slice(0, -2));\n          lry = +uly + +(d.getAttribute('height').slice(0, -2));\n          return !(((ul.x < ulx && lr.x < ulx) || (ul.x > lrx && lr.x > lrx)) || ((ul.y < uly && lr.y < uly) || (ul.y > lry && lr.y > lry)));\n        } else if (d.tagName === 'use') {\n          const box = (d.parentNode as SVGGElement).getBBox();\n          ulx = box.x;\n          uly = box.y;\n          lrx = box.x + box.width;\n          lry = box.y + box.height;\n          return !(((ul.x < ulx && lr.x < ulx) || (ul.x > lrx && lr.x > lrx)) || ((ul.y < uly && lr.y < uly) || (ul.y > lry && lr.y > lry)));\n        } else {\n          const box = getStaffBBox(d);\n          return !((ul.x < box.ulx && lr.x < box.ulx) || \n                  (ul.x > box.lrx && lr.x > box.lrx) || \n                  (ul.y < (box.uly + Math.abs(box.ulx - ul.x) * Math.tan(box.skew)) && \n                    lr.y < (box.uly + Math.abs(box.ulx - ul.x) * Math.tan(box.skew))) || \n                  (ul.y > (box.lry + Math.abs(box.lry - lr.y) * Math.tan(box.skew)) && \n                    lr.y > (box.lry + Math.abs(box.lry - lr.y) * Math.tan(box.skew))));\n        }\n      }) as SVGGraphicsElement[];\n\n      // Get other halves of ligatures if only one is selected\n      elements.forEach((element: SVGElement) => {\n        if (element.tagName === 'use' && element.getAttribute('xlink:href').match(/E9B[456789ABC]/)) {\n          const neume = element.closest('.neume');\n          const ncIndex = Array.from(neume.children).indexOf(element.closest('.nc'));\n          if (element.getAttribute('xlink:href').match(/E9B[45678]/)) {\n            // Add second half of ligature to selected list if not already present\n            const secondNc = neume.children[ncIndex + 1];\n            const secondUse = secondNc.querySelector('use');\n            if (elements.indexOf(secondUse) < 0) {\n              elements.push(secondUse);\n            }\n          } else {\n            // Add first half of ligature to selected list if not already present\n            const firstNc = neume.children[ncIndex - 1];\n            const firstUse = firstNc.querySelector('use');\n            if (elements.indexOf(firstUse) < 0) {\n              elements.push(firstUse);\n            }\n          }\n        }\n      });\n      selectAll(elements, neonView, dragHandler);\n\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n      d3.selectAll('#selectRect').remove();\n      dragSelecting = false;\n    }\n    panning = false;\n  }\n\n  /**\n     * Create an initial dragging rectangle.\n     * @param ulx - The upper left x-position of the new rectangle.\n     * @param uly - The upper left y-position of the new rectangle.\n     */\n  function initRect (ulx: number, uly: number): void {\n    canvas.append('rect')\n      .attr('x', ulx)\n      .attr('y', uly)\n      .attr('width', 0)\n      .attr('height', 0)\n      .attr('id', 'selectRect')\n      .attr('stroke', 'black')\n      .attr('stroke-width', strokeWidth)\n      .attr('fill', 'none');\n  }\n\n  /**\n     * Update the dragging rectangle.\n     * @param newX - The new ulx.\n     * @param newY - The new uly.\n     * @param currentWidth - The width of the rectangle in pixels.\n     * @param currentHeight - The height of the rectangle in pixels.\n     */\n  function updateRect (newX: number, newY: number, currentWidth: number, currentHeight: number): void {\n    d3.select('#selectRect')\n      .attr('x', newX)\n      .attr('y', newY)\n      .attr('width', currentWidth)\n      .attr('height', currentHeight);\n  }\n}\n","import immediate from 'immediate';\nimport uuidV4 from 'uuid';\nimport Md5 from 'spark-md5';\nimport vuvuzela from 'vuvuzela';\nimport getArguments from 'argsarray';\nimport inherits from 'inherits';\nimport { EventEmitter } from 'events';\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = global.setImmediate || global.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EventEmitter);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EventEmitter.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev$$1 = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev$$1] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev$$1});\n    }\n    return rev$$1;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      immediate(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EventEmitter);\n\nfunction AbstractPouchDB() {\n  EventEmitter.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev$$1,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev$$1) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev$$1,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev$$1) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev$$1 = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev$$1);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev$$1);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev$$1) {\n      addToMissing(id, rev$$1);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev$$1) {\n      if (height[rev$$1] > maxHeight) {\n        candidates.push(rev$$1);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev$$1 = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev$$1) !== -1) {\n        revs.push(rev$$1);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      /* istanbul ignore if */\n      if (!path) {\n        err = new Error('invalid rev tree');\n        err.docId = id;\n        return cb(err);\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev$$1) {\n            return rev$$1.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev$$1) {\n          pos--;\n          return {\n            rev: pos + '-' + rev$$1.id,\n            status: rev$$1.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EventEmitter();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EventEmitter.prototype).forEach(function (key) {\n    if (typeof EventEmitter.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.1.1\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n//#7458: execute function mergeAndedSelectors on nested $and\nfunction mergeAndedSelectorsNested(obj) {\n    for (var prop in obj) {\n        if (Array.isArray(obj)) {\n            for (var i in obj) {\n                if (obj[i]['$and']) {\n                    obj[i] = mergeAndedSelectors(obj[i]['$and']);\n                }\n            }\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            mergeAndedSelectorsNested(value); // <- recursive call\n        }\n    }\n    return obj;\n}\n\n//#7458: determine id $and is present in selector (at any level)\nfunction isAndInSelector(obj, isAnd) {\n    for (var prop in obj) {\n        if (prop === '$and') {\n            isAnd = true;\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            isAnd = isAndInSelector(value, isAnd); // <- recursive call\n        }\n    }\n    return isAnd;\n}\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n    //#7458: if $and is present in selector (at any level) merge nested $and\n    if (isAndInSelector(result, false)) {\n        result = mergeAndedSelectorsNested(result);\n        if ('$and' in result) {\n            result = mergeAndedSelectors(result['$and']);\n        }\n        wasAnded = true;\n    }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  // is matcher an object, if so continue recursion\n  if (typeof matcher === 'object') {\n    return Object.keys(matcher).every(function (userOperator) {\n      var userValue = matcher[userOperator];\n      return match(userOperator, doc, userValue, parsedField, docFieldValue);\n    });\n  }\n\n  // no more depth, No need to recurse further\n  return matcher === docFieldValue;\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev$$1) {\n  if (!/^\\d+-./.test(rev$$1)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev$$1.indexOf('-');\n  var left = rev$$1.substring(0, idx);\n  var right = rev$$1.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev$$1) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev$$1;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending  no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      immediate(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev$$1 = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev$$1;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev$$1;\n      if (!opts.rev) {\n        rev$$1 = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev$$1 = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev$$1;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev$$1 = pos + '-' + revHash;\n        if (revs.indexOf(rev$$1) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return immediate(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function () {\n    var msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc && doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    options.credentials = 'include';\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  immediate(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).catch(function () {\n      return {};\n    }).then(function (result) {\n      // Bad response or missing `uuid` should not prevent ID generation.\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      var url = path.substring(0, 1) === '/' ?\n        genUrl(host, path.substring(1)) :\n        genDBUrl(host, path);\n      return ourFetch(url, options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if (typeof process !== 'undefined' && !process.browser) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            // TODO: Can we remove this?\n            if (typeof process !== 'undefined' && !process.browser) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev$$1 = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev$$1;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser) {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev$$1,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev$$1;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev$$1, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev$$1;\n      rev$$1 = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev$$1) {\n      url += '?rev=' + rev$$1;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n    \n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        immediate(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      immediate(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      immediate(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              immediate(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev$$1) {\n  return /^1-/.test(rev$$1);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate$$1) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate$$1 ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    immediate(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EventEmitter);\nfunction Replication() {\n  EventEmitter.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EventEmitter);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\n// Pull from src because pouchdb-node/pouchdb-browser themselves\n\nexport default PouchDB;\n","import NeonCore from './NeonCore';\n\nimport { parseManifest } from './utils/NeonManifest';\nimport { prepareEditMode } from './utils/EditControls';\nimport setBody from './utils/template/Template';\nimport * as Types from './Types';\nimport * as Interfaces from './Interfaces';\n\n\n/**\n * NeonView class. Manages the other modules of Neon and communicates with\n * NeonCore.\n */\nclass NeonView {\n  /** The manifest describing what to load and where to find it. */\n  manifest: Types.NeonManifest;\n  /** Module that displays rendered MEI. */\n  view: Interfaces.ViewInterface;\n  /** Name of the document loaded. */\n  name: string;\n  /** Module that handles managing resources, rendering SVGs. */\n  core: NeonCore;\n  /** Module that provides additional information on musical elements. */\n  info: Interfaces.InfoInterface;\n  /** Module that allows editing of musical elements. */\n  NeumeEdit: Interfaces.NeumeEditInterface;\n  /** Module that allows viewing of syllable text. */\n  textView: Interfaces.TextViewInterface;\n  /** Module that allows editing of syllable text. */\n  TextEdit: Interfaces.TextEditInterface;\n\n  params: Interfaces.NeonViewParams;\n\n\n  /**\n   * Constructor for NeonView. Sets mode and passes constructors.\n   */\n  constructor (params: Interfaces.NeonViewParams) {\n    if (!parseManifest(params.manifest)) {\n      console.error('Unable to parse the manifest');\n    }\n\n    this.params = params;\n    this.manifest = params.manifest;\n  }\n\n  /**\n   * Set up Neon for any provided editing modules.\n   */\n  setupEdit(params: Interfaces.NeonViewParams): void {\n    if (params.NeumeEdit !== undefined || (params.TextEdit !== undefined && params.TextView !== undefined)) {\n      // Set up display for edit button\n      prepareEditMode(this);\n    }\n\n    if (params.NeumeEdit !== undefined) {\n      this.NeumeEdit = new params.NeumeEdit(this);\n    }\n    if (params.TextView !== undefined) {\n      this.textView = new params.TextView(this);\n      if (params.TextEdit !== undefined) {\n        this.TextEdit = new params.TextEdit(this);\n      }\n    }\n  }\n\n  /**\n   * Start Neon\n   */\n  start (): void {\n    /* this.core.db.info().then((info) => {\n      if (info.doc_count === 0) {\n        this.core.initDb().then(() => { this.updateForCurrentPage(); });\n      } else {\n        Notification.queueNotification('Existing database found. Revert to start from the beginning.');\n        this.updateForCurrentPage();\n      }\n    }); */\n    setBody().then(() => {\n      this.view = new this.params.View(this, this.params.Display, this.manifest.image);\n      this.name = this.manifest.title;\n\n      this.core = new NeonCore(this.manifest);\n      this.info = new this.params.Info(this);\n\n      window.setTimeout(this.setupEdit.bind(this), 2000, this.params);\n      return this.core.initDb();\n    }).then(() => {\n      this.updateForCurrentPage(true);\n    });\n  }\n\n  /**\n   * Get the current page from the loaded view and then display the\n   * most up to date SVG.\n   */\n  updateForCurrentPage (delay = false): void {\n    const pageNo = this.view.getCurrentPage();\n    this.view.changePage(pageNo, delay);\n  }\n\n  /**\n   * Same as [[updateForCurrentPage]] but returns a promise.\n   */\n  updateForCurrentPagePromise (delay = false): Promise<void> {\n    const pageNo = this.view.getCurrentPage();\n    return Promise.resolve(this.view.changePage(pageNo, delay));\n  }\n\n  /**\n   * Redo an action performed on the current page (if there is one).\n   */\n  redo (): Promise<boolean> {\n    return this.core.redo(this.view.getCurrentPageURI());\n  }\n\n  /**\n   * Undo the last action performed on the current page (if there is one).\n   */\n  undo (): Promise<boolean> {\n    return this.core.undo(this.view.getCurrentPageURI());\n  }\n\n  /**\n   * Get the mode Neon is in.\n   * @returns Value is \"viewer\", \"insert\", or \"edit\".\n   */\n  getUserMode (): string {\n    if (this.NeumeEdit !== undefined) {\n      return this.NeumeEdit.getUserMode();\n    } else if (this.TextEdit !== undefined) {\n      return 'edit';\n    } else {\n      return 'viewer';\n    }\n  }\n\n  /**\n   * Attempt to perform an editor action.\n   * @param action - The editor toolkit action object.\n   * @param pageURI - The URI of the page to perform the action on\n   */\n  edit (action: Types.EditorAction, pageURI: string): Promise<boolean> {\n    return this.core.edit(action, pageURI);\n  }\n\n  /**\n   * Get the attributes for a specific musical element.\n   * @param elementId - The unique ID of the musical element.\n   * @param pageURI - The URI of the page the element is found on.\n   */\n  getElementAttr (elementID: string, pageURI: string): Promise<Types.Attributes> {\n    return this.core.getElementAttr(elementID, pageURI);\n  }\n\n  /**\n   * Updates browser database and creates JSON-LD save file.\n   * @returns The contents of this file.\n   */\n  export (): Promise<string | ArrayBuffer> {\n    return (new Promise((resolve, reject): void => {\n      this.core.updateDatabase().then(() => {\n        this.manifest['mei_annotations'] = this.core.getAnnotations();\n        this.manifest.timestamp = (new Date()).toISOString();\n        const data = new window.Blob([JSON.stringify(this.manifest, null, 2)], { type: 'application/ld+json' });\n        const reader = new FileReader();\n        reader.addEventListener('load', () => {\n          resolve(reader.result);\n        });\n        reader.readAsDataURL(data);\n      }).catch(err => { reject(err); });\n    }));\n  }\n\n  /**\n   * Save the current state to the browser database.\n   */\n  save (): Promise<void> {\n    return this.core.updateDatabase();\n  }\n\n  /**\n   * Deletes the local database of the loaded MEI file(s).\n   */\n  deleteDb (): Promise<void> {\n    return this.core.deleteDb();\n  }\n\n  /**\n   * Get the page's MEI file encoded as a data URI.\n   * @param pageNo - The URI specifying the page.\n   * @returns A [Data URI](https://en.wikipedia.org/wiki/Data_URI_scheme).\n   */\n  getPageURI (pageNo?: string): Promise<string> {\n    if (pageNo === undefined) {\n      pageNo = this.view.getCurrentPageURI();\n    }\n    return new Promise((resolve): void => {\n      this.core.getMEI(pageNo).then((mei) => {\n        resolve('data:application/mei+xml;charset=utf-8,' + encodeURIComponent(mei));\n      });\n    });\n  }\n\n  /**\n   * Get the page's MEI file as a string.\n   * @param pageNo - The identifying URI of the page.\n   */\n  getPageMEI (pageNo: string): Promise<string> {\n    return this.core.getMEI(pageNo);\n  }\n\n  /**\n   * Get the page's SVG.\n   * @param pageNo - The identifying URI of the page.\n   */\n  getPageSVG (pageNo: string): Promise<SVGSVGElement> {\n    return this.core.getSVG(pageNo);\n  }\n}\n\nexport { NeonView as default };\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","import * as DisplayControls from './DisplayControls';\nimport ZoomHandler from '../SingleView/Zoom';\nimport { DisplayInterface, ViewInterface } from '../Interfaces';\n\n/**\n * Return the HTML for the display panel.\n * @param {ZoomHandler} handleZoom - Includes zoom controls if defined.\n * @returns {string}\n */\nfunction displayControlsPanel (handleZoom: ZoomHandler): string {\n  let contents =\n  '<p class=\\'panel-heading\\' id=\\'displayHeader\\'>Display' +\n  '<svg class=\\'icon is-pulled-right\\'><use id=\\'toggleDisplay\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></p>' +\n  '<div id=\\'displayContents\\'>';\n  if (handleZoom !== undefined) {\n    contents +=\n    '<a class=\\'panel-block has-text-centered\\'><button class=\\'button\\' id=\\'reset-zoom\\'>Zoom</button>' +\n    '<input class=\\'slider is-fullwidth\\' id=\\'zoomSlider\\' step=\\'5\\' min=\\'25\\' max=\\'400\\' value=\\'100\\' type=\\'range\\'/>' +\n    '<output id=\\'zoomOutput\\' for=\\'zoomSlider\\'>100</output></a>';\n  }\n  contents +=\n  '<a class=\\'panel-block has-text-centered\\'><button class=\\'button\\' id=\\'reset-opacity\\'>Glyph Opacity</button>' +\n  '<input class=\\'slider is-fullwidth\\' id=\\'opacitySlider\\' step=\\'5\\' min=\\'0\\' max=\\'100\\' value=\\'100\\' type=\\'range\\'/>' +\n  '<output id=\\'opacityOutput\\' for=\\'opacitySlider\\'>100</output></a>' +\n  '<a class=\\'panel-block has-text-centered\\'><button class=\\'button\\' id=\\'reset-bg-opacity\\'>Image Opacity</button>' +\n  '<input class=\\'slider is-fullwidth\\' id=\\'bgOpacitySlider\\' step=\\'5\\' min=\\'0\\' max=\\'100\\' value=\\'100\\' type=\\'range\\'/>' +\n  '<output id=\\'bgOpacityOutput\\' for=\\'bgOpacitySlider\\'>100</output></a>' +\n  '<div class=\\'panel-block\\' id=\\'extensible-block\\'>' +\n  '<div class=\\'dropdown\\' id=\\'highlight-dropdown\\'><div class=\\'dropdown-trigger\\'>' +\n  '<button class=\\'button\\' id=\\'highlight-button\\' aria-haspopup=\\'true\\' aria-controls=\\'highlight-menu\\' style=\\'width: auto\\'>' +\n  '<span>Highlight</span><span id=\\'highlight-type\\'>&nbsp;- Off</span>' +\n  '<svg class=\\'icon\\'><use id=\\'toggleDisplay\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use>' +\n  '</svg></button></div><div class=\\'dropdown-menu\\' id=\\'highlight-menu\\' role=\\'menu\\'>' +\n  '<div class=\\'dropdown-content\\'><a class=\\'dropdown-item\\' id=\\'highlight-staff\\'>Staff</a>' +\n  '<a class=\\'dropdown-item\\' id=\\'highlight-syllable\\'>Syllable</a>' +\n  '<a class=\\'dropdown-item\\' id=\\'highlight-neume\\'>Neume</a><hr class=\\'dropdown-divider\\'/>' +\n  '<a class=\\'dropdown-item\\' id=\\'highlight-none\\'>None</a></div></div></div></div></div>';\n  return contents;\n}\n\n/**\n * A class that sets the content of the display panel to the right and\n * manages controls for viewing.\n */\nclass DisplayPanel implements DisplayInterface {\n  view: ViewInterface;\n  className: string;\n  background: string;\n  zoomHandler: ZoomHandler;\n\n  /**\n   * Constructor for DisplayPanel.\n   * @param {SingleView | DivaView} view - The View parent.\n   * @param {string} className - The class name for the rendered SVG object(s).\n   * @param {string} background - The class name associated with the background.\n   * @param {ZoomHandler} [zoomHandler] - The ZoomHandler object, if SingleView.\n   */\n  constructor (view: ViewInterface, className: string,\n    background: string, zoomHandler: ZoomHandler = undefined) {\n    this.view = view;\n    this.className = className;\n    this.background = background;\n    this.zoomHandler = zoomHandler;\n\n    const displayPanel = document.getElementById('display_controls');\n    displayPanel.innerHTML = displayControlsPanel(this.zoomHandler);\n    this.view.addUpdateCallback(this.updateVisualization.bind(this));\n  }\n\n  /**\n   * Apply event listeners related to the DisplayPanel.\n   */\n  setDisplayListeners (): void {\n    if (this.zoomHandler) {\n      // Zoom handler stuff\n      DisplayControls.setZoomControls(this.zoomHandler);\n    }\n    DisplayControls.initDisplayControls(this.className, this.background);\n  }\n\n  /**\n   * Update SVG based on visualization settings\n   */\n  updateVisualization (): void {\n    DisplayControls.setOpacityFromSlider(this.className);\n    DisplayControls.updateHighlight();\n  }\n}\n\nexport { DisplayPanel as default };\n","import NeonView from './NeonView';\nimport DisplayPanel from './DisplayPanel/DisplayPanel';\nimport { DisplayConstructable, ViewInterface } from './Interfaces';\nimport ZoomHandler from './SingleView/Zoom';\n\ndeclare let Diva: any;\n\n/**\n * View module that uses the diva.js viewer to render the pages of a IIIF manifests\n * and then display the rendered MEI files over the proper pages.\n */\nclass DivaView implements ViewInterface {\n  readonly neonView: NeonView;\n  private updateCallbacks: Array<() => void>;\n  divaReady: boolean;\n  private diva: any;\n  private indexMap: Map<number, string>;\n  private displayPanel: DisplayPanel;\n  private loadDelay: number;\n  zoomHandler: ZoomHandler;\n\n  /**\n   * @param manifest - Link to the IIIF manifest.\n   */\n  constructor (neonView: NeonView, Display: DisplayConstructable, manifest: string) {\n    this.neonView = neonView;\n    this.updateCallbacks = [];\n    this.divaReady = false;\n    this.diva = new Diva('container', {\n      objectData: manifest\n    });\n    document.getElementById('container').style.minHeight = '100%';\n    this.indexMap = new Map();\n    this.diva.disableDragScrollable();\n    this.displayPanel = new Display(this, 'neon-container', 'diva-viewer-canvas');\n    this.loadDelay = 500; // in milliseconds\n    this.initDivaEvents();\n    this.setViewEventHandlers();\n\n    window.onresize = (): void => {\n      const height = window.innerHeight;\n      const width = window.innerWidth;\n\n      window.setTimeout((): void => {\n        if ((height === window.innerHeight) && (width === window.innerWidth)) {\n          this.changePage(this.getCurrentPage(), false);\n        }\n      }, this.loadDelay);\n    };\n  }\n\n  /**\n   * Set the listeners for certain events internal to diva.js\n   */\n  initDivaEvents (): void {\n    Diva.Events.subscribe('ManifestDidLoad', this.parseManifest.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ObjectDidLoad', this.didLoad.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ActivePageDidChange', this.changePage.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ZoomLevelDidChange', this.adjustZoom.bind(this), this.diva.settings.ID);\n  }\n\n  /**\n   * Called when the visible page changes in the diva.js viewer.\n   * @param pageIndex - The zero-indexed page that is most visible.\n   * @param delay - Whether to delay the loading of the page so that neon doesn't lag while scrolling.\n   */\n  async changePage (pageIndex: number, delay = true): Promise<void> {\n    function checkAndLoad (page: number): void {\n      if (page === this.getCurrentPage()) {\n        const pageURI = this.indexMap.get(page);\n        this.neonView.getPageSVG(pageURI).then((svg: SVGSVGElement) => {\n          this.updateSVG(svg, page);\n          const containerId = 'neon-container-' + page;\n          const container = document.getElementById(containerId);\n          if (container !== null) {\n            container.classList.add('active-page');\n          }\n          this.updateCallbacks.forEach((callback: Function) => callback());\n        }).catch((err: { name: string }) => {\n          if (err.name !== 'not_found' && err.name !== 'missing_mei') {\n            console.error(err);\n          }\n        });\n      }\n    }\n\n    const pageIndexes = [pageIndex];\n    Array.from(document.getElementsByClassName('active-page')).forEach(elem => {\n      elem.classList.remove('active-page');\n    });\n    for (const page of pageIndexes) {\n      if (delay) {\n        window.setTimeout(checkAndLoad.bind(this), (this.loadDelay), page);\n      } else {\n        checkAndLoad.bind(this)(page);\n      }\n    }\n  }\n\n  /**\n   * Get the active page in the diva.js viewer.\n   */\n  getCurrentPage (): number {\n    return this.diva.getActivePageIndex();\n  }\n\n  /**\n   * Get the active page URI in the diva.js viewer.\n   */\n  getCurrentPageURI (): string {\n    return this.indexMap.get(this.getCurrentPage());\n  }\n\n  /**\n   * Adjust the rendered SVG(s) to be the correct size after zooming.\n   */\n  adjustZoom (): void {\n    (new Promise((resolve): void => {\n      Array.from(document.getElementsByClassName('neon-container'))\n        .forEach((elem: HTMLElement) => { elem.style.display = 'none'; });\n      setTimeout(resolve, this.diva.settings.zoomDuration + 100);\n    })).then(() => {\n      this.changePage(this.diva.getActivePageIndex(), true);\n      Array.from(document.getElementsByClassName('neon-container'))\n        .forEach((elem: HTMLElement) => {\n          const svg = elem.firstChild as SVGSVGElement;\n          const pageNo = parseInt(elem.id.match(/\\d+/)[0]);\n          this.updateSVG(svg, pageNo);\n          elem.style.display = '';\n        });\n    });\n  }\n\n  /**\n   * Update the SVG being displayed for the specified page.\n   * @param pageNo - The zero-indexed page number.\n   */\n  updateSVG (svg: SVGSVGElement, pageNo: number): void {\n    const inner = document.getElementById('diva-1-inner');\n    const dimensions = this.diva.getPageDimensionsAtCurrentZoomLevel(pageNo);\n    const offset = this.diva.settings.viewHandler._viewerCore.getPageRegion(pageNo, {\n      includePadding: true,\n      incorporateViewport: true\n    });\n    const marginLeft = window.getComputedStyle(inner, null)\n      .getPropertyValue('margin-left');\n\n    const containerId = 'neon-container-' + pageNo.toString();\n    let container = document.getElementById(containerId);\n    if (container === null) {\n      container = document.createElement('div');\n      container.id = containerId;\n      container.classList.add('neon-container');\n      inner.appendChild(container);\n    }\n\n    while (container.firstChild) {\n      container.removeChild(container.firstChild);\n    }\n\n    svg.setAttribute('width', dimensions.width);\n    svg.setAttribute('height', dimensions.height);\n    container.style.position = 'absolute';\n    container.style.top = `${offset.top}px`;\n    container.style.left = `${offset.left - parseInt(marginLeft)}px`;\n\n    container.appendChild(svg);\n  }\n\n  /**\n   * Function called when diva.js finishes loading.\n   */\n  didLoad (): void {\n    this.divaReady = true;\n    this.displayPanel.setDisplayListeners();\n    document.getElementById('loading').style.display = 'none';\n    console.log(this.diva);\n  }\n\n  /**\n   * Add a callback function that will be run whenever an SVG is updated.\n   */\n  addUpdateCallback (cb: () => void): void {\n    this.updateCallbacks.push(cb);\n  }\n\n  /**\n   * Remove a callback function previously added to the list of functions to call.\n   */\n  removeUpdateCallback (cb: () => void): void {\n    const index = this.updateCallbacks.findIndex((elem) => {\n      return elem === cb;\n    });\n    if (index !== -1) {\n      this.updateCallbacks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Set listeners on the body element for global events.\n   */\n  setViewEventHandlers (): void {\n    document.body.addEventListener('keydown', (evt) => {\n      switch (evt.key) {\n        case 'h':\n          for (const container of document.getElementsByClassName('neon-container') as HTMLCollectionOf<HTMLElement>) {\n            container.style.visibility = 'hidden';\n          }\n          break;\n        default: break;\n      }\n    });\n\n    document.body.addEventListener('keyup', (evt) => {\n      switch (evt.key) {\n        case 'h':\n          for (const container of document.getElementsByClassName('neon-container') as HTMLCollectionOf<HTMLElement>) {\n            container.style.visibility = '';\n          }\n          break;\n        default: break;\n      }\n    });\n  }\n\n  /**\n   * Use the IIIF manifest to create a map between IIIF canvases and page indexes.\n   * @param manifest - The IIIF manifest object.\n   */\n  parseManifest (manifest: { sequences: { canvases: object[] }[] }): void {\n    this.indexMap.clear();\n    for (const sequence of manifest.sequences) {\n      for (const canvas of sequence.canvases) {\n        this.indexMap.set(sequence.canvases.indexOf(canvas), canvas['@id']);\n      }\n    }\n  }\n\n  /**\n   * Get the name of the active page/canvas combined with the manuscript name.\n   */\n  getPageName (): string {\n    const manuscriptName = this.diva.settings.manifest.itemTitle;\n    const pageName = this.diva.settings.manifest.pages[this.getCurrentPage()].l;\n    return manuscriptName + ' \\u2014 ' + pageName;\n  }\n}\n\nexport { DivaView as default };\n","import { updateHighlight, setOpacityFromSlider } from '../DisplayPanel/DisplayControls';\nimport NeonView from '../NeonView';\nimport DisplayPanel from '../DisplayPanel/DisplayPanel';\nimport ZoomHandler from './Zoom';\nimport { ViewInterface, DisplayConstructable } from '../Interfaces';\n\nimport * as d3 from 'd3';\n\n/**\n * A view module for displaying a single page of a manuscript.\n */\nclass SingleView implements ViewInterface {\n  readonly neonView: NeonView;\n  private container: HTMLElement;\n  private updateCallbacks: Array<() => void>;\n  private group: SVGSVGElement;\n  private bg: SVGImageElement;\n  private mei: SVGSVGElement;\n  zoomHandler: ZoomHandler;\n  private displayPanel: DisplayPanel;\n  readonly pageURI: string;\n  /**\n   * Constructor for SingleView.\n   * @param image - The URI to the background image for the page.\n   */\n  constructor (neonView: NeonView, panel: DisplayConstructable, image: string) {\n    this.neonView = neonView;\n    this.container = document.getElementById('container');\n    this.updateCallbacks = new Array(0);\n    // Group will contain the image and the rendered SVG\n    this.group = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    this.group.id = 'svg_group';\n    this.group.setAttribute('height', window.innerHeight.toString());\n    this.group.setAttribute('width', '100%');\n\n    this.bg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\n    this.bg.id = 'bgimg';\n    this.bg.classList.add('background');\n    this.bg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', image);\n    this.bg.setAttribute('x', '0');\n    this.bg.setAttribute('y', '0');\n\n    this.mei = document.createElementNS('http://www.w3.org/svg', 'svg') as SVGSVGElement;\n    this.mei.id = 'mei_output';\n    this.mei.classList.add('neon-container', 'active-page');\n\n    this.group.appendChild(this.bg);\n    this.group.appendChild(this.mei);\n    this.container.appendChild(this.group);\n\n    this.zoomHandler = new ZoomHandler();\n    this.displayPanel = new panel(this, 'neon-container', 'background', this.zoomHandler);\n\n    this.setViewEventHandlers();\n    this.displayPanel.setDisplayListeners();\n\n    this.pageURI = image;\n\n    document.getElementById('loading').style.display = 'none';\n  }\n\n  /**\n   * Update the SVG being displayed.\n   */\n  updateSVG (svg: SVGSVGElement): void {\n    this.group.replaceChild(svg, this.mei);\n    this.mei = svg;\n    this.mei.id = 'mei_output';\n    this.mei.classList.add('neon-container', 'active-page');\n    const height = parseInt(this.mei.getAttribute('height'));\n    const width = parseInt(this.mei.getAttribute('width'));\n\n    this.bg.setAttribute('height', height.toString());\n    this.bg.setAttribute('width', width.toString());\n    this.group.setAttribute('viewBox', '0 0 ' + width + ' ' + height);\n    updateHighlight();\n    this.resetTransformations();\n    this.updateCallbacks.forEach(callback => callback());\n  }\n\n  /**\n   * Change to a certain page\n   * Since there is only one page, this is essentially a wrapper for updateSVG\n   */\n  async changePage (_page: number, _delay: boolean): Promise<void> {\n    const svg = await this.neonView.getPageSVG(this.getCurrentPageURI());\n    this.updateSVG(svg);\n  }\n\n  /**\n   * Add a callback to the list of those be called when the page updates.\n   */\n  addUpdateCallback (cb: () => void): void {\n    this.updateCallbacks.push(cb);\n  }\n\n  /**\n   * Remove a callback from the list of callbacks if it is part of the list.\n   */\n  removeUpdateCallback (cb: () => void): void {\n    const index = this.updateCallbacks.findIndex((elem) => {\n      return elem === cb;\n    });\n    if (index !== -1) {\n      this.updateCallbacks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Reset the transformations that have been applied to the SVG upon update.\n   */\n  resetTransformations (): void {\n    this.displayPanel.zoomHandler.restoreTransformation();\n    setOpacityFromSlider();\n  }\n\n  /**\n   * Returns the zero-indexed number of the current page. This will always be zero.\n   */\n  getCurrentPage (): number {\n    return 0;\n  }\n\n  /**\n   * Returns the page URI.\n   */\n  getCurrentPageURI (): string {\n    return this.pageURI;\n  }\n\n  /**\n   * Set event handlers for the view and display panel.\n   */\n  setViewEventHandlers (): void {\n    document.body.addEventListener('keydown', (evt) => {\n      switch (evt.key) {\n        case 'Shift':\n          d3.select('#svg_group').on('.drag', null);\n          d3.select('#svg_group').call(\n            d3.drag().on('start', this.displayPanel.zoomHandler.startDrag.bind(this.displayPanel.zoomHandler))\n              .on('drag', this.displayPanel.zoomHandler.dragging.bind(this.displayPanel.zoomHandler))\n          );\n          break;\n        case 'h':\n          document.getElementById('mei_output').setAttribute('visibility', 'hidden');\n          break;\n        default: break;\n      }\n    });\n    document.body.addEventListener('keyup', (evt) => {\n      switch (evt.key) {\n        case 'Shift':\n          d3.select('#svg_group').on('.drag', null);\n          if (this.neonView.getUserMode() !== 'viewer') {\n            this.neonView.NeumeEdit.setSelectListeners();\n          }\n          break;\n        case 'h':\n          document.getElementById('mei_output').setAttribute('visibility', 'visible');\n          break;\n        default: break;\n      }\n    });\n\n    d3.select('#container').on('touchstart', () => {\n      if (d3.event.touches.length === 2) {\n        this.displayPanel.zoomHandler.startDrag();\n        d3.select('#container').on('touchmove', this.displayPanel.zoomHandler.dragging.bind(this.displayPanel.zoomHandler));\n        d3.select('#container').on('touchend', () => {\n          d3.select('#container').on('touchmove', null);\n        });\n      }\n    });\n    d3.select('#container').on('wheel', this.displayPanel.zoomHandler.scrollZoom.bind(this.displayPanel.zoomHandler), false);\n    // Update height of container based on window\n    window.onresize = (): void => {\n      const newHeight = window.innerHeight;\n      const container = document.getElementById('container');\n      if (newHeight > Number(container.getAttribute('height'))) {\n        container.setAttribute('height', newHeight.toString());\n      }\n    };\n  }\n\n  /**\n   * A human readable name for the page. Used for downloads.\n   */\n  getPageName (): string {\n    return this.neonView.name;\n  }\n}\n\nexport { SingleView as default };\n","import { bindInsertTabs, initInsertEditControls, initEditModeControls, initSelectionButtons } from './Controls';\nimport * as Select from '../utils/Select';\nimport InsertHandler from './InsertHandler';\nimport NeonView from '../NeonView';\nimport * as SelectOptions from './SelectOptions';\nimport { setHighlightSelectionControls } from '../DisplayPanel/DisplayControls';\nimport DragHandler from '../utils/DragHandler';\nimport { NeumeEditInterface } from '../Interfaces';\n\nclass DivaEdit implements NeumeEditInterface {\n  neonView: NeonView;\n  dragHandler: DragHandler;\n  insertHandler: InsertHandler;\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    initEditModeControls(this);\n  }\n\n  initEditMode (): void {\n    this.dragHandler = new DragHandler(this.neonView, '.active-page > svg');\n    this.insertHandler = new InsertHandler(this.neonView, '.active-page > svg');\n    bindInsertTabs(this.insertHandler);\n    document.getElementById('primitiveTab').click();\n    Select.setSelectHelperObjects(this.neonView, this.dragHandler);\n    this.setSelectListeners();\n\n    SelectOptions.initNeonView(this.neonView);\n    initInsertEditControls();\n    const editMenu = document.getElementById('editMenu');\n    editMenu.style.backgroundColor = '#ffc7c7';\n    editMenu.style.fontWeight = 'bold';\n\n    Select.setSelectStrokeWidth(1);\n\n    initSelectionButtons();\n\n    setHighlightSelectionControls();\n\n    this.neonView.view.addUpdateCallback(this.setSelectListeners.bind(this));\n  }\n\n  /**\n   * Get the user mode that Neon is in. Either insert, edit, or viewer.\n   * @returns {string}\n   */\n  getUserMode (): string {\n    if (this.insertHandler !== undefined) {\n      if (this.insertHandler.isInsertMode()) {\n        return 'insert';\n      }\n      return 'edit';\n    }\n    return 'viewer';\n  }\n\n  setSelectListeners (): void {\n    Select.clickSelect('.active-page > svg > svg, .active-page > svg > svg use, .active-page > svg > svg rect');\n    Select.dragSelect('.active-page svg');\n  }\n}\n\nexport { DivaEdit as default };\n","import { bindInsertTabs, initInsertEditControls, initEditModeControls, initSelectionButtons } from './Controls';\nimport { setHighlightSelectionControls } from '../DisplayPanel/DisplayControls';\nimport * as Select from '../utils/Select';\nimport InsertHandler from './InsertHandler';\nimport NeonView from '../NeonView';\nimport * as SelectOptions from './SelectOptions';\nimport DragHandler from '../utils/DragHandler';\nimport { NeumeEditInterface } from '../Interfaces';\n\n/**\n * An Edit Module for a single page of a manuscript.\n * Works with the SingleView module.\n */\nclass SingleEditMode implements NeumeEditInterface {\n  neonView: NeonView;\n  dragHandler: DragHandler;\n  insertHandler: InsertHandler;\n  /**\n   * Constructor for an EditMode object.\n   * @param {NeonView} neonView - The NeonView parent.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    initEditModeControls(this);\n  }\n\n  /**\n   * Initialize the start of edit mode when first leaving viewer mode.\n   */\n  initEditMode (): void {\n    this.dragHandler = new DragHandler(this.neonView, '#svg_group');\n    this.insertHandler = new InsertHandler(this.neonView, '#svg_group');\n    bindInsertTabs(this.insertHandler);\n    document.getElementById('primitiveTab').click();\n    Select.setSelectHelperObjects(this.neonView, this.dragHandler);\n    this.setSelectListeners();\n\n    SelectOptions.initNeonView(this.neonView);\n    initInsertEditControls();\n    const editMenu = document.getElementById('editMenu');\n    editMenu.style.backgroundColor = '#ffc7c7';\n    editMenu.style.fontWeight = 'bold';\n\n    initSelectionButtons();\n\n    setHighlightSelectionControls();\n\n    this.neonView.view.addUpdateCallback(this.setSelectListeners.bind(this));\n  }\n\n  /**\n   * Get the user mode that Neon is in. Either insert, edit, or viewer.\n   * @returns {string}\n   */\n  getUserMode (): string {\n    if (this.insertHandler !== undefined) {\n      if (this.insertHandler.isInsertMode()) {\n        return 'insert';\n      }\n      return 'edit';\n    }\n    return 'viewer';\n  }\n\n  setSelectListeners (): void {\n    Select.clickSelect('#svg_group, #svg_group use, #svg_group rect');\n    Select.dragSelect('#svg_group');\n  }\n}\n\nexport { SingleEditMode as default };\n","/** @module InfoModule */\n\nimport NeonView from './NeonView';\nimport { InfoInterface } from './Interfaces';\nimport { Attributes } from './Types';\n\n/**\n * Map of contours to neume names.\n */\nconst neumeGroups = new Map(\n  [['', 'Punctum'], ['u', 'Pes'], ['d', 'Clivis'], ['uu', 'Scandicus'], ['ud', 'Torculus'], ['du', 'Porrectus'], ['s', 'Distropha'], ['ss', 'Tristopha'],\n    ['sd', 'Pressus'], ['dd', 'Climacus'], ['ddu', 'Climacus resupinus'], ['udu', 'Torculus resupinus'], ['dud', 'Porrectus flexus'],\n    ['udd', 'Pes subpunctis'], ['uud', 'Scandicus flexus'], ['uudd', 'Scandicus subpunctis'], ['dudd', 'Porrectus subpunctis']]\n);\n\nfunction startInfoVisibility (): void {\n  document.getElementById('neume_info').innerHTML =\n    '<article class=\\'message\\'><div class=\\'message-header\\'><p></p></div>' +\n      '<div class=\\'message-body\\'></div>';\n  document.getElementById('neume_info').setAttribute('style', 'display: none');\n}\n\n/**\n * Update the visibility of infoBox\n */\nfunction updateInfoVisibility (): void {\n  const neumeInfo = document.getElementById('neume_info');\n  if ((document.getElementById('displayInfo') as HTMLInputElement).checked) {\n    neumeInfo.setAttribute('style', '');\n  } else {\n    neumeInfo.setAttribute('style', 'display: none');\n  }\n}\n\n/**\n * Set listener on info visibility checkbox.\n */\nfunction setInfoControls (): void {\n  startInfoVisibility();\n  updateInfoVisibility();\n  document.getElementById('displayInfo').addEventListener('click', updateInfoVisibility);\n}\n\n/**\n * Class that manages getting information for elements in Neon from Verovio.\n */\nclass InfoModule implements InfoInterface {\n  private neonView: NeonView;\n\n  /**\n   * A constructor for an InfoModule.\n   * @param {NeonView} neonView - The NeonView parent.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    // Add info box enable/disable check box\n    const block = document.getElementById('extensible-block');\n    const label = document.createElement('label');\n    label.classList.add('checkbox');\n    label.textContent = 'Display Info: ';\n    const input = document.createElement('input');\n    input.classList.add('checkbox');\n    input.id = 'displayInfo';\n    input.type = 'checkbox';\n    input.checked = false;\n    label.appendChild(input);\n    block.prepend(label);\n\n    this.neonView.view.addUpdateCallback(this.resetInfoListeners.bind(this));\n    setInfoControls();\n    this.resetInfoListeners();\n  }\n\n  /**\n   * Set listeners for the InfoModule.\n   */\n  infoListeners (): void {\n    try {\n      document.getElementsByClassName('active-page')[0]\n        .querySelectorAll('.neume,.custos,.clef')\n        .forEach(node => {\n          node.addEventListener('mouseover', this.updateInfo.bind(this));\n        });\n    } catch (e) {}\n  }\n\n  /**\n   * Stop listeners for the InfoModule.\n   */\n  stopListeners (): void {\n    document.querySelectorAll('.neume,.custos,.clef').forEach(node => {\n      node.removeEventListener('mouseover', this.updateInfo.bind(this));\n    });\n  }\n\n  /**\n   * Restart listeners for the InfoModule.\n   */\n  resetInfoListeners (): void {\n    this.stopListeners();\n    this.infoListeners();\n  }\n\n  /**\n   * Get updated info for the calling element based on its element type.\n   * Makes calls to NeonCore to get the information necessary.\n   */\n  async updateInfo (event: MouseEvent): Promise<void> {\n  // For now, since Clefs do not have their own element tag in mei4, there is not a way to select the <g> element\n  // So we will simply return if ID does not exist for now\n    const id = (event.currentTarget as HTMLElement).id;\n    if (id === '') {\n      Array.from(document.getElementById('neume_info').children).forEach(child => {\n        child.remove();\n      });\n      console.log('No id!');\n      return;\n    }\n\n    const element = document.getElementById(id);\n    const classRe = /neume|nc|clef|custos|staff/;\n    const elementClass = element.getAttribute('class').match(classRe)[0];\n    let body = '';\n    let attributes: Attributes;\n\n    // Gets the pitches depending on element type and\n    switch (elementClass) {\n      case 'neume':\n        // Select neume components of selected neume\n        const ncs = element.querySelectorAll('.nc') as NodeListOf<SVGGraphicsElement>;\n        let contour = await this.getContour(ncs);\n        if (contour === 'Clivis') {\n          const attr: Attributes = await this.neonView.getElementAttr(ncs[0].id, this.neonView.view.getCurrentPageURI());\n          if (attr.ligated) {\n            contour = 'Ligature';\n          }\n        }\n        let pitches = await this.getPitches(ncs);\n\n        pitches = pitches.trim().toUpperCase();\n        body = 'Shape: ' + (contour === undefined ? 'Compound' : contour) + '\\r\\n' +\n                'Pitch(es): ' + pitches;\n        break;\n      case 'custos':\n        attributes = await this.neonView.getElementAttr(id, this.neonView.view.getCurrentPageURI());\n        body += 'Pitch: ' + (attributes['pname']).toUpperCase() + attributes['oct'];\n        break;\n      case 'clef':\n        attributes = await this.neonView.getElementAttr(id, this.neonView.view.getCurrentPageURI());\n        body += 'Shape: ' + attributes['shape'] + '\\r\\n' +\n                'Line: ' + attributes['line'];\n        break;\n      default:\n        body += 'nothing';\n        break;\n    }\n    this.updateInfoModule(elementClass, body);\n  }\n\n  /**\n   * Get the individual pitches of a neume.\n   * @param ncs - Neume components in the neume.\n   * @returns Space separated pitches of the neume components in order.\n   */\n  async getPitches (ncs: Iterable<SVGGraphicsElement>): Promise<string> {\n    let pitches = '';\n    for (const nc of ncs) {\n      const attributes: Attributes = await this.neonView.getElementAttr(nc.id, this.neonView.view.getCurrentPageURI());\n      pitches += attributes['pname'] + attributes['oct'] + ' ';\n    }\n    return pitches;\n  }\n\n  /**\n   * Get the contour of a neume.\n   * @param ncs - Neume components in the neume.\n   */\n  async getContour (ncs: Iterable<SVGGraphicsElement>): Promise<string> {\n    let contour = '';\n    let previous: Attributes = null;\n    for (const nc of ncs) {\n      const attributes: Attributes = await this.neonView.getElementAttr(nc.id, this.neonView.view.getCurrentPageURI());\n      if (previous !== null) {\n        if (previous['oct'] > attributes['oct']) {\n          contour += 'd';\n        } else if (previous['oct'] < attributes['oct']) {\n          contour += 'u';\n        } else {\n          if (this.pitchNameToNum(previous['pname']) < this.pitchNameToNum(attributes['pname'])) {\n            contour += 'u';\n          } else if (this.pitchNameToNum(previous['pname']) > this.pitchNameToNum(attributes['pname'])) {\n            contour += 'd';\n          } else {\n            contour += 's';\n          }\n        }\n      }\n      previous = attributes;\n    }\n    if (neumeGroups.get(contour) === undefined) {\n      console.warn('Unknown contour: ' + contour);\n    }\n    return neumeGroups.get(contour);\n  }\n\n  /**\n   * Show and update the info box.\n   * @param title - The info box title.\n   * @param body - The info box contents.\n   */\n  updateInfoModule (title: string, body: string): void {\n    document.getElementsByClassName('message-header')[0].querySelector('p')\n      .textContent = title;\n    (document.getElementsByClassName('message-body')[0] as HTMLElement).innerText = body;\n\n    if ((document.getElementById('displayInfo') as HTMLInputElement).checked) {\n      (document.getElementsByClassName('message')[0] as HTMLElement).style.display = '';\n    }\n  }\n\n  /**\n   * Convert a pitch name (a-g) to a number (where c is 1, d is 2, ...and b is 7).\n   * @param pname - The pitch name.\n   * @returns\n   */\n  pitchNameToNum (pname: string): number {\n    switch (pname) {\n      case 'c':\n        return 1;\n      case 'd':\n        return 2;\n      case 'e':\n        return 3;\n      case 'f':\n        return 4;\n      case 'g':\n        return 5;\n      case 'a':\n        return 6;\n      case 'b':\n        return 7;\n      default:\n        console.log('Unknown pitch name');\n    }\n  }\n\n  /**\n   * Find the contour of an neume grouping based on the grouping name.\n   * @param value - The contour name.\n   */\n  getContourByValue (value: string): string {\n    for (const [cont, v] of neumeGroups.entries()) {\n      if (v === value) {\n        return cont;\n      }\n    }\n  }\n}\n\nexport { InfoModule as default };\n","import * as Notification from './utils/Notification';\nimport NeonView from './NeonView';\nimport { unselect } from './utils/SelectTools';\nimport { updateHighlight } from './DisplayPanel/DisplayControls';\nimport { TextViewInterface } from './Interfaces';\n\n/*\n * Class that manages getting the text for syllables in Neon from the mei file\n */\nclass TextView implements TextViewInterface {\n  private neonView: NeonView;\n  /** Whether or not the user has been notified about blank syllables. */\n  private notificationSent: boolean;\n  /**\n   * A constructor for a TextView.\n   * @param neonView - The calling [[NeonView]] for the instance.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    this.notificationSent = false;\n\n    // add checkbox to enable/disable the view\n    const block = document.getElementById('extensible-block');\n    const textLabel = document.createElement('label');\n    const bboxLabel = document.createElement('label');\n    const textButton = document.createElement('input');\n    const bboxButton = document.createElement('input');\n    textLabel.classList.add('checkbox');\n    bboxLabel.classList.add('checkbox');\n    textLabel.textContent = 'Display Text: ';\n    bboxLabel.textContent = 'Display Text BBoxes: ';\n    textButton.classList.add('checkbox');\n    bboxButton.classList.add('checkbox');\n    textButton.id = 'displayText';\n    textButton.type = 'checkbox';\n    bboxButton.id = 'displayBBox';\n    bboxButton.type = 'checkbox';\n    textButton.checked = false;\n    bboxButton.checked = false;\n    textLabel.appendChild(textButton);\n    bboxLabel.appendChild(bboxButton);\n    block.prepend(bboxLabel);\n    block.prepend(textLabel);\n\n    this.setTextViewControls();\n    this.neonView.view.addUpdateCallback(this.updateTextViewVisibility.bind(this));\n    this.neonView.view.addUpdateCallback(this.updateBBoxViewVisibility.bind(this));\n  }\n\n  /**\n  * Set listeners on textview visibility checkbox\n  */\n  setTextViewControls (): void {\n    function textViewVis (): void { this.updateTextViewVisibility(); }\n    function bboxViewVis (): void { this.updateBBoxViewVisibility(); }\n\n    this.updateTextViewVisibility();\n    this.updateBBoxViewVisibility();\n    document.getElementById('displayText')\n      .addEventListener('click', textViewVis.bind(this));\n    document.getElementById('displayBBox')\n      .addEventListener('click', bboxViewVis.bind(this));\n  }\n\n  /**\n   * Update visibility of text bounding boxes\n   */\n  updateBBoxViewVisibility (): void {\n    if ((document.getElementById('displayBBox')as HTMLInputElement).checked) {\n      document.querySelectorAll('.sylTextRect').forEach(rect => {\n        rect.classList.add('sylTextRect-display');\n        rect.classList.remove('sylTextRect');\n      });\n      document.querySelectorAll('.syl.selected .sylTextRect-display')\n        .forEach((rect: HTMLElement) => { rect.style.fill = 'red'; });\n\n      if (this.neonView.getUserMode() !== 'viewer' && this.neonView.TextEdit !== undefined) {\n        this.neonView.TextEdit.initSelectByBBoxButton();\n      }\n    } else {\n      if ((document.getElementById('selByBBox') !== null) &&\n        document.getElementById('selByBBox').classList.contains('is-active')) {\n        unselect();\n        document.getElementById('selByBBox').classList.remove('is-active');\n        document.getElementById('selBySyl').classList.add('is-active');\n      }\n      document.querySelectorAll('.sylTextRect-display').forEach(rect => {\n        rect.classList.add('sylTextRect');\n        rect.classList.remove('sylTextRect-display');\n      });\n      document.querySelectorAll('.syl.selected .sylTextRect').forEach((rect: HTMLElement) => {\n        rect.style.fill = 'none';\n      });\n      try {\n        document.getElementById('selByBBox').style.display = 'none';\n      } catch (e) {}\n    }\n    updateHighlight();\n  }\n\n  /**\n  * Update the visibility of the textview box\n  * and add the event listeners to make sure the syl highlights when moused over\n  */\n  updateTextViewVisibility (): void {\n    if ((document.getElementById('displayText') as HTMLInputElement).checked) {\n      const sylText = document.getElementById('syl_text');\n      sylText.style.display = '';\n      sylText.innerHTML = '<p>' + this.getSylText() + '</p>';\n      const spans = sylText.querySelectorAll('p > span');\n      spans.forEach(span => {\n        const syllable = document.getElementById(span.className);\n        const syl = syllable.querySelector('.syl');\n        const text = syl.querySelector('text');\n        const rect = syl.querySelector('rect');\n        if (text.classList.length === 0) {\n          text.classList.add('text');\n        }\n\n        span.addEventListener('mouseover', () => {\n          syllable.classList.add('selected');\n          syllable.querySelectorAll('.neume').forEach(neume => {\n            neume.classList.add('selected');\n          });\n          if (rect !== null) {\n            rect.style.fill = '#d00';\n          }\n          // syl.attr('fill', '#ffc7c7');\n          // this.highlightBoundingBox(span);\n        });\n\n        span.addEventListener('mouseleave', () => {\n          syllable.classList.remove('selected');\n          syllable.querySelectorAll('.neume').forEach(neume => {\n            neume.classList.remove('selected');\n          });\n          if (rect !== null) {\n            if (syllable.style.fill !== 'rgb(0, 0, 0)') { // syllable.getAttributeNS('http://www.w3.org/2000/SVG', 'fill');\n              rect.style.fill = syllable.getAttribute('fill');\n            } else {\n              rect.style.fill = 'blue';\n            }\n          }\n          // syl.attr('fill', null);\n          // this.removeBoundingBox(span);\n        });\n      });\n      if (this.neonView.getUserMode() !== 'viewer' && this.neonView.TextEdit !== undefined) {\n        this.neonView.TextEdit.initTextEdit();\n      }\n    } else {\n      document.getElementById('syl_text').style.display = 'none';\n    }\n  }\n\n  /**\n   * Get the syllable text of the loaded file\n   */\n  getSylText (): string {\n    let lyrics = '';\n    const uniToDash = /\\ue551/g;\n    const syllables = document.querySelectorAll('.active-page .syllable');\n    syllables.forEach(syllable => {\n      if (syllable.querySelector('.syl') !== null) {\n        const syl = syllable.querySelector('.syl');\n        lyrics += '<span class=\\'' + syllable.id + '\\'>';\n        if (syl.textContent.trim() === '') {\n          lyrics += '&#x25CA; ';\n        } else {\n          Array.from(syl.children[0].children[0].children).forEach(text => {\n            lyrics += text.textContent !== '' ? text.textContent : '&#x25CA; ';\n          });\n        }\n        lyrics += ' </span>';\n      }\n    });\n    if (!this.notificationSent) {\n      Notification.queueNotification('Blank syllables are represented by &#x25CA;!');\n      this.notificationSent = true;\n    }\n    return lyrics.replace(uniToDash, '-');\n  }\n}\n\nexport { TextView as default };\n","import { unselect } from './utils/SelectTools';\nimport DragHandler from './utils/DragHandler';\nimport NeonView from './NeonView';\nimport { setSelectHelperObjects, dragSelect, clickSelect } from './utils/Select';\nimport { setGroupingHighlight } from './utils/Color';\nimport { TextEditInterface } from './Interfaces';\n\n/**\n * Format a string for prompting the user.\n * @param rawString - The unformatted string.\n */\nfunction formatRaw (rawString: string): string {\n  const removeSymbol = /\\u{25CA}/u;\n  return rawString.replace(removeSymbol, '').trim();\n}\n\nfunction selBySylListener (): void {\n  if (!document.getElementById('selByBBox').classList.contains('is-active')) {\n    unselect();\n    try {\n      document.getElementById('moreEdit').innerHTML = '';\n    } catch (e) {}\n    document.getElementById('selByBBox').classList.add('is-active');\n    try {\n      document.getElementById('selByNc').classList.remove('is-active');\n      document.getElementById('selByNeume').classList.remove('is-active');\n      document.getElementById('selByStaff').classList.remove('is-active');\n      document.getElementById('selBySyl').classList.remove('is-active');\n    } catch (e) {}\n    try {\n      if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n        setGroupingHighlight('syllable');\n      }\n    } catch (e) {}\n  }\n  this.addBBoxListeners();\n}\n\n/**\n * A Text editing module that works with the SingleView and DivaView modules\n */\nexport default class TextEditMode implements TextEditInterface {\n  private dragHandler: DragHandler;\n  private neonView: NeonView;\n\n  /**\n   * Constructor for a TextEdit\n   * @param neonView - The calling [[NeonView]] for the instance.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    this.initEditModeControls();\n  }\n\n  /**\n   * Set listener on edit mode button to start editing.\n   */\n  initEditModeControls (): void {\n    document.getElementById('edit_mode').addEventListener('click', () => {\n      this.initTextEdit();\n      if ((document.getElementById('displayBBox') as HTMLInputElement).checked) {\n        this.initSelectByBBoxButton();\n      }\n    });\n  }\n\n  /**\n  * Set text to edit mode\n  */\n  initTextEdit (): void {\n    const spans = document.getElementById('syl_text').querySelectorAll('p > span');\n    spans.forEach(span => {\n      function updateSylText (): void {\n        this.updateSylText(span);\n      }\n\n      span.removeEventListener('click', updateSylText.bind(this));\n      span.addEventListener('click', updateSylText.bind(this));\n    });\n  }\n\n  /**\n  * Add the selectByBBox button.\n  * If neume edit mode is there, add it to the bar with the other select by buttons.\n  * Otherwise add an invisible button\n  * since the only edit mode is selectByRect in that case\n  */\n  initSelectByBBoxButton (): void {\n    if (this.neonView.NeumeEdit !== undefined) {\n      const selByBBox = document.getElementById('selByBBox');\n      if (selByBBox) {\n        selByBBox.style.display = '';\n        return;\n      }\n\n      const block = document.getElementById('selBySyl')\n        .closest('.control')\n        .closest('.field');\n      const p = document.createElement('p');\n      p.classList.add('control');\n      const button = document.createElement('button');\n      button.classList.add('button', 'sel-by');\n      button.id = 'selByBBox';\n      button.textContent = 'BBox';\n      p.appendChild(button);\n      block.appendChild(p);\n      button.addEventListener('click', selBySylListener.bind(this));\n      document.body.addEventListener('keydown', (evt) => {\n        if (evt.key === '5') {\n          if (document.getElementById('selByBBox').style.display === '') {\n            selBySylListener.bind(this)();\n          }\n        }\n      });\n      this.neonView.view.addUpdateCallback(this.addBBoxListeners.bind(this));\n    } else {\n      const block = document.getElementById('undo').closest('.control');\n      const p = document.createElement('p');\n      p.classList.add('control');\n      const button = document.createElement('button');\n      button.classList.add('button', 'sel-by');\n      button.id = 'selByBBox';\n      button.textContent = 'BBox';\n      p.appendChild(button);\n      block.appendChild(p);\n      button.classList.add('is-active');\n      button.style.display = 'none';\n      this.addBBoxListeners();\n      this.neonView.view.addUpdateCallback(this.addBBoxListeners.bind(this));\n    }\n  }\n\n  /**\n   * Initialize select by bbox mode\n   */\n  addBBoxListeners (): void {\n    if (document.getElementById('selByBBox').classList.contains('is-active')) {\n      unselect();\n      if (this.neonView.NeumeEdit === undefined) {\n        // just in case\n        this.dragHandler = new DragHandler(this.neonView, '.sylTextRect-display');\n        setSelectHelperObjects(this.neonView, this.dragHandler);\n        if (this.neonView.view.constructor.name === 'SingleView') {\n          clickSelect('#mei_output, #mei_output rect');\n          dragSelect('#svg_group');\n        } else {\n          clickSelect('.active-page > svg > svg, .active-page > svg > svg rect');\n          dragSelect('.active-page svg');\n        }\n      }\n    }\n  }\n\n  /**\n  * Update the text for a single syl element\n  */\n  updateSylText (span: HTMLSpanElement): void {\n    const orig = formatRaw(span.textContent);\n    const corrected = window.prompt('', orig);\n    if (corrected !== null && corrected !== orig) {\n      const editorAction = {\n        'action': 'setText',\n        'param': {\n          'elementId': [...span.classList.entries()].filter(e => e[1] !== 'text-select')[0][1],\n          'text': corrected\n        }\n      };\n      this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then((response) => {\n        if (response) {\n          this.neonView.updateForCurrentPage();\n        }\n      });\n    }\n  }\n}\n","import * as et from 'elementtree';\nimport { uuidv4 } from './random';\n\net.register_namespace('xml', 'http://www.w3.org/XML/1998/namespace');\net.register_namespace('', 'http://www.music-encoding.org/ns/mei');\n\nexport function convertStaffToSb (staffBasedMei: string): string {\n  const meiTree = et.parse(staffBasedMei);\n  const meiTag = meiTree.getroot();\n  for (const section of meiTag.findall('.//section')) {\n    const newStaff = et.Element('staff', { 'n': '1' });\n    const container: any = et.SubElement(newStaff, 'layer');\n\n    container.set('n', '1');\n\n    for (const staff of section.getchildren()) {\n      for (const layer of staff.getchildren()) {\n        // Replace every staff + layer with a sb with the same facsimile info\n        const sb = et.Element('sb', {\n          'n': staff.get('n'),\n          'facs': staff.get('facs'),\n          'xml:id': staff.get('xml:id')\n        });\n\n        // Check for custos\n        if (container.len() > 1) {\n          if (container.getItem(container.len() - 1).tag === 'custos') {\n            sb.append(container.getItem(container.len() - 1));\n            container.remove(container.getItem(container.len() - 1));\n          }\n        }\n\n        // Check if first syllable has @follows\n        let firstSyllable = layer.find('syllable');\n        let syllableId = '';\n        if (firstSyllable) {\n          if (firstSyllable.get('follows')) {\n            syllableId = firstSyllable.get('follows');\n            for (const syl of firstSyllable.findall('syl')) {\n              firstSyllable.remove(syl);\n            }\n            layer.remove(firstSyllable);\n          } else {\n            firstSyllable = undefined;\n          }\n        }\n\n        if (!firstSyllable) {\n          container.append(sb);\n        } else {\n          const syllable: any = container.find(\n            './/*[@xml:id=\\'' + syllableId + '\\']'\n          );\n          syllable.append(sb);\n          syllable._children = syllable._children.concat(firstSyllable.getchildren());\n        }\n        container._children = container._children.concat(layer.getchildren());\n      }\n    }\n    const sectionId = section.get('xml:id');\n    section.clear();\n    section.set('xml:id', sectionId);\n    section.append(newStaff);\n  }\n\n  return meiTree.write({ 'xml_declaration': true, indent: 4 });\n}\n\nexport function convertSbToStaff (sbBasedMei: string): string {\n  const meiTree = et.parse(sbBasedMei);\n  const meiTag = meiTree.getroot();\n\n  for (const section of meiTag.findall('.//section') as any) {\n    const staffStore = [];\n    for (const staff of section.getchildren()) {\n      for (const layer of staff.getchildren()) {\n        const sbIndexes = [];\n        for (const sb of layer.findall('sb')) {\n          sbIndexes.push(layer.getchildren().indexOf(sb));\n        }\n\n        for (const [sbIndex, n] of zip(sbIndexes, [...Array(sbIndexes.length).keys()])) {\n          const sb = layer.getItem(sbIndex);\n          const newStaff = et.Element('staff', sb.attrib);\n          const container: any = et.Element('layer', { 'n': '1' });\n\n          // Check for custos\n          for (let i = 0; i < sb.len(); i++) {\n            const custos = sb.getItem(0);\n            const lastStaff = staffStore[staffStore.length - 1];\n            lastStaff.getItem(lastStaff.len() - 1).append(custos);\n          }\n\n          // Get elements to add\n          const lastIndex = n + 1 === sbIndexes.length ? layer.len() : sbIndexes[n + 1];\n          container._children = container._children.concat(layer.getSlice(sbIndex + 1, lastIndex));\n          newStaff.append(container);\n          staffStore.push(newStaff);\n        }\n      }\n    }\n    const sectionId = section.get('xml:id');\n    section.clear();\n    section.set('xml:id', sectionId);\n    section._children = section._children.concat(staffStore);\n\n    // Handle sb in syllables\n    const stavesAdded = 0;\n    for (const [staff, staffIndex] of zip(section.getchildren(), [...Array(section.len()).keys()])) {\n      for (const layer of staff.getchildren()) {\n        for (const syllable of layer.findall('.//syllable')) {\n          const sb = syllable.find('sb');\n          if (!sb) {\n            continue;\n          }\n          const newStaff = et.Element('staff', sb.attrib);\n          const newLayer: any = et.SubElement(newStaff, 'layer');\n          newLayer.set('n', '1');\n\n          const newSyllableId = uuidv4();\n          const newSyllable: any = et.SubElement(newLayer, 'syllable');\n          newSyllable.set('follows', syllable.get('xml:id'));\n          newSyllable.set('xml:id', newSyllableId);\n          syllable.set('precedes', newSyllableId);\n          newSyllable._children = newSyllable._children.concat(syllable.getSlice(syllable.getchildren().indexOf(sb) + 1, syllable.len()));\n\n          const oldSyllableContent = syllable.getSlice(0, syllable.getchildren().indexOf(sb));\n          const syllableAttrib = syllable.attrib;\n\n          // Move remaining components to new staff.\n          newLayer._children = newLayer._children.concat(layer.getSlice(layer.getchildren().indexOf(syllable) + 1, layer.len()));\n          const layerAttrib = layer.attrib;\n          const layerContent = layer.getSlice(0, layer.getchildren().indexOf(syllable) + 1);\n          layer.clear();\n          layer.attrib = layerAttrib;\n          layer._children = layer._children.concat(layerContent);\n\n          // Handle custos;\n          layer._children = layer._children.concat(sb.getchildren());\n\n          // Shrink syllable\n          syllable.clear();\n          syllable.attrib = syllableAttrib;\n          syllable._children = syllable._children.concat(oldSyllableContent);\n\n          section._children.splice(staffIndex + stavesAdded + 1, 0, newStaff);\n        }\n      }\n    }\n  }\n\n  return meiTree.write({ 'xml_declaration': true, indent: 4 });\n}\n\nfunction zip (array1: Array<any>, array2: Array<any>): Array<any> {\n  const result = [];\n  for (let i = 0; i < (array1.length > array2.length ? array2.length : array1.length); i++) {\n    result.push([array1[i], array2[i]]);\n  }\n  return result;\n}\n","/**\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\nvar sprintf = require('./sprintf').sprintf;\n\nvar utils = require('./utils');\nvar ElementPath = require('./elementpath');\nvar TreeBuilder = require('./treebuilder').TreeBuilder;\nvar get_parser = require('./parser').get_parser;\nvar constants = require('./constants');\n\nvar element_ids = 0;\n\nfunction Element(tag, attrib)\n{\n  this._id = element_ids++;\n  this.tag = tag;\n  this.attrib = {};\n  this.text = null;\n  this.tail = null;\n  this._children = [];\n\n  if (attrib) {\n    this.attrib = utils.merge(this.attrib, attrib);\n  }\n}\n\nElement.prototype.toString = function()\n{\n  return sprintf(\"<Element %s at %s>\", this.tag, this._id);\n};\n\nElement.prototype.makeelement = function(tag, attrib)\n{\n  return new Element(tag, attrib);\n};\n\nElement.prototype.len = function()\n{\n  return this._children.length;\n};\n\nElement.prototype.getItem = function(index)\n{\n  return this._children[index];\n};\n\nElement.prototype.setItem = function(index, element)\n{\n  this._children[index] = element;\n};\n\nElement.prototype.delItem = function(index)\n{\n  this._children.splice(index, 1);\n};\n\nElement.prototype.getSlice = function(start, stop)\n{\n  return this._children.slice(start, stop);\n};\n\nElement.prototype.setSlice = function(start, stop, elements)\n{\n  var i;\n  var k = 0;\n  for (i = start; i < stop; i++, k++) {\n    this._children[i] = elements[k];\n  }\n};\n\nElement.prototype.delSlice = function(start, stop)\n{\n  this._children.splice(start, stop - start);\n};\n\nElement.prototype.append = function(element)\n{\n  this._children.push(element);\n};\n\nElement.prototype.extend = function(elements)\n{\n  this._children.concat(elements);\n};\n\nElement.prototype.insert = function(index, element)\n{\n  this._children[index] = element;\n};\n\nElement.prototype.remove = function(element)\n{\n  this._children = this._children.filter(function(e) {\n    /* TODO: is this the right way to do this? */\n    if (e._id === element._id) {\n      return false;\n    }\n    return true;\n  });\n};\n\nElement.prototype.getchildren = function() {\n  return this._children;\n};\n\nElement.prototype.find = function(path)\n{\n  return ElementPath.find(this, path);\n};\n\nElement.prototype.findtext = function(path, defvalue)\n{\n  return ElementPath.findtext(this, path, defvalue);\n};\n\nElement.prototype.findall = function(path, defvalue)\n{\n  return ElementPath.findall(this, path, defvalue);\n};\n\nElement.prototype.clear = function()\n{\n  this.attrib = {};\n  this._children = [];\n  this.text = null;\n  this.tail = null;\n};\n\nElement.prototype.get = function(key, defvalue)\n{\n  if (this.attrib[key] !== undefined) {\n    return this.attrib[key];\n  }\n  else {\n    return defvalue;\n  }\n};\n\nElement.prototype.set = function(key, value)\n{\n  this.attrib[key] = value;\n};\n\nElement.prototype.keys = function()\n{\n  return Object.keys(this.attrib);\n};\n\nElement.prototype.items = function()\n{\n  return utils.items(this.attrib);\n};\n\n/*\n * In python this uses a generator, but in v8 we don't have em,\n * so we use a callback instead.\n **/\nElement.prototype.iter = function(tag, callback)\n{\n  var self = this;\n  var i, child;\n\n  if (tag === \"*\") {\n    tag = null;\n  }\n\n  if (tag === null || this.tag === tag) {\n    callback(self);\n  }\n\n  for (i = 0; i < this._children.length; i++) {\n    child = this._children[i];\n    child.iter(tag, function(e) {\n      callback(e);\n    });\n  }\n};\n\nElement.prototype.itertext = function(callback)\n{\n  this.iter(null, function(e) {\n    if (e.text) {\n      callback(e.text);\n    }\n\n    if (e.tail) {\n      callback(e.tail);\n    }\n  });\n};\n\n\nfunction SubElement(parent, tag, attrib) {\n  var element = parent.makeelement(tag, attrib);\n  parent.append(element);\n  return element;\n}\n\nfunction Comment(text) {\n  var element = new Element(Comment);\n  if (text) {\n    element.text = text;\n  }\n  return element;\n}\n\nfunction CData(text) {\n  var element = new Element(CData);\n  if (text) {\n    element.text = text;\n  }\n  return element;\n}\n\nfunction ProcessingInstruction(target, text)\n{\n  var element = new Element(ProcessingInstruction);\n  element.text = target;\n  if (text) {\n    element.text = element.text + \" \" + text;\n  }\n  return element;\n}\n\nfunction QName(text_or_uri, tag)\n{\n  if (tag) {\n    text_or_uri = sprintf(\"{%s}%s\", text_or_uri, tag);\n  }\n  this.text = text_or_uri;\n}\n\nQName.prototype.toString = function() {\n  return this.text;\n};\n\nfunction ElementTree(element)\n{\n  this._root = element;\n}\n\nElementTree.prototype.getroot = function() {\n  return this._root;\n};\n\nElementTree.prototype._setroot = function(element) {\n  this._root = element;\n};\n\nElementTree.prototype.parse = function(source, parser) {\n  if (!parser) {\n    parser = get_parser(constants.DEFAULT_PARSER);\n    parser = new parser.XMLParser(new TreeBuilder());\n  }\n\n  parser.feed(source);\n  this._root = parser.close();\n  return this._root;\n};\n\nElementTree.prototype.iter = function(tag, callback) {\n  this._root.iter(tag, callback);\n};\n\nElementTree.prototype.find = function(path) {\n  return this._root.find(path);\n};\n\nElementTree.prototype.findtext = function(path, defvalue) {\n  return this._root.findtext(path, defvalue);\n};\n\nElementTree.prototype.findall = function(path) {\n  return this._root.findall(path);\n};\n\n/**\n * Unlike ElementTree, we don't write to a file, we return you a string.\n */\nElementTree.prototype.write = function(options) {\n  var sb = [];\n  options = utils.merge({\n    encoding: 'utf-8',\n    xml_declaration: null,\n    default_namespace: null,\n    method: 'xml'}, options);\n\n  if (options.xml_declaration !== false) {\n    sb.push(\"<?xml version='1.0' encoding='\"+options.encoding +\"'?>\\n\");\n  }\n\n  if (options.method === \"text\") {\n    _serialize_text(sb, self._root, encoding);\n  }\n  else {\n    var qnames, namespaces, indent, indent_string;\n    var x = _namespaces(this._root, options.encoding, options.default_namespace);\n    qnames = x[0];\n    namespaces = x[1];\n\n    if (options.hasOwnProperty('indent')) {\n      indent = 0;\n      indent_string = new Array(options.indent + 1).join(' ');\n    }\n    else {\n      indent = false;\n    }\n\n    if (options.method === \"xml\") {\n      _serialize_xml(function(data) {\n        sb.push(data);\n      }, this._root, options.encoding, qnames, namespaces, indent, indent_string);\n    }\n    else {\n      /* TODO: html */\n      throw new Error(\"unknown serialization method \"+ options.method);\n    }\n  }\n\n  return sb.join(\"\");\n};\n\nvar _namespace_map = {\n    /* \"well-known\" namespace prefixes */\n    \"http://www.w3.org/XML/1998/namespace\": \"xml\",\n    \"http://www.w3.org/1999/xhtml\": \"html\",\n    \"http://www.w3.org/1999/02/22-rdf-syntax-ns#\": \"rdf\",\n    \"http://schemas.xmlsoap.org/wsdl/\": \"wsdl\",\n    /* xml schema */\n    \"http://www.w3.org/2001/XMLSchema\": \"xs\",\n    \"http://www.w3.org/2001/XMLSchema-instance\": \"xsi\",\n    /* dublic core */\n    \"http://purl.org/dc/elements/1.1/\": \"dc\",\n};\n\nfunction register_namespace(prefix, uri) {\n  if (/ns\\d+$/.test(prefix)) {\n    throw new Error('Prefix format reserved for internal use');\n  }\n\n  if (_namespace_map.hasOwnProperty(uri) && _namespace_map[uri] === prefix) {\n    delete _namespace_map[uri];\n  }\n\n  _namespace_map[uri] = prefix;\n}\n\n\nfunction _escape(text, encoding, isAttribute, isText) {\n  if (text) {\n    text = text.toString();\n    text = text.replace(/&/g, '&amp;');\n    text = text.replace(/</g, '&lt;');\n    text = text.replace(/>/g, '&gt;');\n    if (!isText) {\n        text = text.replace(/\\n/g, '&#xA;');\n        text = text.replace(/\\r/g, '&#xD;');\n    }\n    if (isAttribute) {\n      text = text.replace(/\"/g, '&quot;');\n    }\n  }\n  return text;\n}\n\n/* TODO: benchmark single regex */\nfunction _escape_attrib(text, encoding) {\n  return _escape(text, encoding, true);\n}\n\nfunction _escape_cdata(text, encoding) {\n  return _escape(text, encoding, false);\n}\n\nfunction _escape_text(text, encoding) {\n  return _escape(text, encoding, false, true);\n}\n\nfunction _namespaces(elem, encoding, default_namespace) {\n  var qnames = {};\n  var namespaces = {};\n\n  if (default_namespace) {\n    namespaces[default_namespace] = \"\";\n  }\n\n  function encode(text) {\n    return text;\n  }\n\n  function add_qname(qname) {\n    if (qname[0] === \"{\") {\n      var tmp = qname.substring(1).split(\"}\", 2);\n      var uri = tmp[0];\n      var tag = tmp[1];\n      var prefix = namespaces[uri];\n\n      if (prefix === undefined) {\n        prefix = _namespace_map[uri];\n        if (prefix === undefined) {\n          prefix = \"ns\" + Object.keys(namespaces).length;\n        }\n        if (prefix !== \"xml\") {\n          namespaces[uri] = prefix;\n        }\n      }\n\n      if (prefix) {\n        qnames[qname] = sprintf(\"%s:%s\", prefix, tag);\n      }\n      else {\n        qnames[qname] = tag;\n      }\n    }\n    else {\n      if (default_namespace) {\n        throw new Error('cannot use non-qualified names with default_namespace option');\n      }\n\n      qnames[qname] = qname;\n    }\n  }\n\n\n  elem.iter(null, function(e) {\n    var i;\n    var tag = e.tag;\n    var text = e.text;\n    var items = e.items();\n\n    if (tag instanceof QName && qnames[tag.text] === undefined) {\n      add_qname(tag.text);\n    }\n    else if (typeof(tag) === \"string\") {\n      add_qname(tag);\n    }\n    else if (tag !== null && tag !== Comment && tag !== CData && tag !== ProcessingInstruction) {\n      throw new Error('Invalid tag type for serialization: '+ tag);\n    }\n\n    if (text instanceof QName && qnames[text.text] === undefined) {\n      add_qname(text.text);\n    }\n\n    items.forEach(function(item) {\n      var key = item[0],\n          value = item[1];\n      if (key instanceof QName) {\n        key = key.text;\n      }\n\n      if (qnames[key] === undefined) {\n        add_qname(key);\n      }\n\n      if (value instanceof QName && qnames[value.text] === undefined) {\n        add_qname(value.text);\n      }\n    });\n  });\n  return [qnames, namespaces];\n}\n\nfunction _serialize_xml(write, elem, encoding, qnames, namespaces, indent, indent_string) {\n  var tag = elem.tag;\n  var text = elem.text;\n  var items;\n  var i;\n\n  var newlines = indent || (indent === 0);\n  write(Array(indent + 1).join(indent_string));\n\n  if (tag === Comment) {\n    write(sprintf(\"<!--%s-->\", _escape_cdata(text, encoding)));\n  }\n  else if (tag === ProcessingInstruction) {\n    write(sprintf(\"<?%s?>\", _escape_cdata(text, encoding)));\n  }\n  else if (tag === CData) {\n    text = text || '';\n    write(sprintf(\"<![CDATA[%s]]>\", text));\n  }\n  else {\n    tag = qnames[tag];\n    if (tag === undefined) {\n      if (text) {\n        write(_escape_text(text, encoding));\n      }\n      elem.iter(function(e) {\n        _serialize_xml(write, e, encoding, qnames, null, newlines ? indent + 1 : false, indent_string);\n      });\n    }\n    else {\n      write(\"<\" + tag);\n      items = elem.items();\n\n      if (items || namespaces) {\n        items.sort(); // lexical order\n\n        items.forEach(function(item) {\n          var k = item[0],\n              v = item[1];\n\n            if (k instanceof QName) {\n              k = k.text;\n            }\n\n            if (v instanceof QName) {\n              v = qnames[v.text];\n            }\n            else {\n              v = _escape_attrib(v, encoding);\n            }\n            write(sprintf(\" %s=\\\"%s\\\"\", qnames[k], v));\n        });\n\n        if (namespaces) {\n          items = utils.items(namespaces);\n          items.sort(function(a, b) { return a[1] < b[1]; });\n\n          items.forEach(function(item) {\n            var k = item[1],\n                v = item[0];\n\n            if (k) {\n              k = ':' + k;\n            }\n\n            write(sprintf(\" xmlns%s=\\\"%s\\\"\", k, _escape_attrib(v, encoding)));\n          });\n        }\n      }\n\n      if (text || elem.len()) {\n        if (text && text.toString().match(/^\\s*$/)) {\n            text = null;\n        }\n\n        write(\">\");\n        if (!text && newlines) {\n          write(\"\\n\");\n        }\n\n        if (text) {\n          write(_escape_text(text, encoding));\n        }\n        elem._children.forEach(function(e) {\n          _serialize_xml(write, e, encoding, qnames, null, newlines ? indent + 1 : false, indent_string);\n        });\n\n        if (!text && indent) {\n          write(Array(indent + 1).join(indent_string));\n        }\n        write(\"</\" + tag + \">\");\n      }\n      else {\n        write(\" />\");\n      }\n    }\n  }\n\n  if (newlines) {\n    write(\"\\n\");\n  }\n}\n\nfunction parse(source, parser) {\n  var tree = new ElementTree();\n  tree.parse(source, parser);\n  return tree;\n}\n\nfunction tostring(element, options) {\n  return new ElementTree(element).write(options);\n}\n\nexports.PI = ProcessingInstruction;\nexports.Comment = Comment;\nexports.CData = CData;\nexports.ProcessingInstruction = ProcessingInstruction;\nexports.SubElement = SubElement;\nexports.QName = QName;\nexports.ElementTree = ElementTree;\nexports.ElementPath = ElementPath;\nexports.Element = function(tag, attrib) {\n  return new Element(tag, attrib);\n};\n\nexports.XML = function(data) {\n  var et = new ElementTree();\n  return et.parse(data);\n};\n\nexports.parse = parse;\nexports.register_namespace = register_namespace;\nexports.tostring = tostring;\n","/**\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\n/**\n * @param {Object} hash.\n * @param {Array} ignored.\n */\nfunction items(hash, ignored) {\n  ignored = ignored || null;\n  var k, rv = [];\n\n  function is_ignored(key) {\n    if (!ignored || ignored.length === 0) {\n      return false;\n    }\n\n    return ignored.indexOf(key);\n  }\n\n  for (k in hash) {\n    if (hash.hasOwnProperty(k) && !(is_ignored(ignored))) {\n      rv.push([k, hash[k]]);\n    }\n  }\n\n  return rv;\n}\n\n\nfunction findall(re, str) {\n  var match, matches = [];\n\n  while ((match = re.exec(str))) {\n      matches.push(match);\n  }\n\n  return matches;\n}\n\nfunction merge(a, b) {\n  var c = {}, attrname;\n\n  for (attrname in a) {\n    if (a.hasOwnProperty(attrname)) {\n      c[attrname] = a[attrname];\n    }\n  }\n  for (attrname in b) {\n    if (b.hasOwnProperty(attrname)) {\n      c[attrname] = b[attrname];\n    }\n  }\n  return c;\n}\n\nexports.items = items;\nexports.findall = findall;\nexports.merge = merge;\n","function TreeBuilder(element_factory) {\n  this._data = [];\n  this._elem = [];\n  this._last = null;\n  this._tail = null;\n  if (!element_factory) {\n    /* evil circular dep */\n    element_factory = require('./elementtree').Element;\n  }\n  this._factory = element_factory;\n}\n\nTreeBuilder.prototype.close = function() {\n  return this._last;\n};\n\nTreeBuilder.prototype._flush = function() {\n  if (this._data) {\n    if (this._last !== null) {\n      var text = this._data.join(\"\");\n      if (this._tail) {\n        this._last.tail = text;\n      }\n      else {\n        this._last.text = text;\n      }\n    }\n    this._data = [];\n  }\n};\n\nTreeBuilder.prototype.data = function(data) {\n  this._data.push(data);\n};\n\nTreeBuilder.prototype.start = function(tag, attrs) {\n  this._flush();\n  var elem = this._factory(tag, attrs);\n  this._last = elem;\n\n  if (this._elem.length) {\n    this._elem[this._elem.length - 1].append(elem);\n  }\n\n  this._elem.push(elem);\n\n  this._tail = null;\n};\n\nTreeBuilder.prototype.end = function(tag) {\n  this._flush();\n  this._last = this._elem.pop();\n  if (this._last.tag !== tag) {\n    throw new Error(\"end tag mismatch\");\n  }\n  this._tail = 1;\n  return this._last;\n};\n\nexports.TreeBuilder = TreeBuilder;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n/*<replacement>*/\n\nvar pna = require('process-nextick-args');\n/*</replacement>*/\n\nmodule.exports = Readable;\n\n/*<replacement>*/\nvar isArray = require('isarray');\n/*</replacement>*/\n\n/*<replacement>*/\nvar Duplex;\n/*</replacement>*/\n\nReadable.ReadableState = ReadableState;\n\n/*<replacement>*/\nvar EE = require('events').EventEmitter;\n\nvar EElistenerCount = function (emitter, type) {\n  return emitter.listeners(type).length;\n};\n/*</replacement>*/\n\n/*<replacement>*/\nvar Stream = require('./internal/streams/stream');\n/*</replacement>*/\n\n/*<replacement>*/\n\nvar Buffer = require('safe-buffer').Buffer;\nvar OurUint8Array = global.Uint8Array || function () {};\nfunction _uint8ArrayToBuffer(chunk) {\n  return Buffer.from(chunk);\n}\nfunction _isUint8Array(obj) {\n  return Buffer.isBuffer(obj) || obj instanceof OurUint8Array;\n}\n\n/*</replacement>*/\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\n/*<replacement>*/\nvar debugUtil = require('util');\nvar debug = void 0;\nif (debugUtil && debugUtil.debuglog) {\n  debug = debugUtil.debuglog('stream');\n} else {\n  debug = function () {};\n}\n/*</replacement>*/\n\nvar BufferList = require('./internal/streams/BufferList');\nvar destroyImpl = require('./internal/streams/destroy');\nvar StringDecoder;\n\nutil.inherits(Readable, Stream);\n\nvar kProxyEvents = ['error', 'close', 'destroy', 'pause', 'resume'];\n\nfunction prependListener(emitter, event, fn) {\n  // Sadly this is not cacheable as some libraries bundle their own\n  // event emitter implementation with them.\n  if (typeof emitter.prependListener === 'function') return emitter.prependListener(event, fn);\n\n  // This is a hack to make sure that our error handler is attached before any\n  // userland ones.  NEVER DO THIS. This is here only because this code needs\n  // to continue to work with older versions of Node.js that do not include\n  // the prependListener() method. The goal is to eventually remove this hack.\n  if (!emitter._events || !emitter._events[event]) emitter.on(event, fn);else if (isArray(emitter._events[event])) emitter._events[event].unshift(fn);else emitter._events[event] = [fn, emitter._events[event]];\n}\n\nfunction ReadableState(options, stream) {\n  Duplex = Duplex || require('./_stream_duplex');\n\n  options = options || {};\n\n  // Duplex streams are both readable and writable, but share\n  // the same options object.\n  // However, some cases require setting options to different\n  // values for the readable and the writable sides of the duplex stream.\n  // These options can be provided separately as readableXXX and writableXXX.\n  var isDuplex = stream instanceof Duplex;\n\n  // object stream flag. Used to make read(n) ignore n and to\n  // make all the buffer merging and length checks go away\n  this.objectMode = !!options.objectMode;\n\n  if (isDuplex) this.objectMode = this.objectMode || !!options.readableObjectMode;\n\n  // the point at which it stops calling _read() to fill the buffer\n  // Note: 0 is a valid value, means \"don't call _read preemptively ever\"\n  var hwm = options.highWaterMark;\n  var readableHwm = options.readableHighWaterMark;\n  var defaultHwm = this.objectMode ? 16 : 16 * 1024;\n\n  if (hwm || hwm === 0) this.highWaterMark = hwm;else if (isDuplex && (readableHwm || readableHwm === 0)) this.highWaterMark = readableHwm;else this.highWaterMark = defaultHwm;\n\n  // cast to ints.\n  this.highWaterMark = Math.floor(this.highWaterMark);\n\n  // A linked list is used to store data chunks instead of an array because the\n  // linked list can remove elements from the beginning faster than\n  // array.shift()\n  this.buffer = new BufferList();\n  this.length = 0;\n  this.pipes = null;\n  this.pipesCount = 0;\n  this.flowing = null;\n  this.ended = false;\n  this.endEmitted = false;\n  this.reading = false;\n\n  // a flag to be able to tell if the event 'readable'/'data' is emitted\n  // immediately, or on a later tick.  We set this to true at first, because\n  // any actions that shouldn't happen until \"later\" should generally also\n  // not happen before the first read call.\n  this.sync = true;\n\n  // whenever we return null, then we set a flag to say\n  // that we're awaiting a 'readable' event emission.\n  this.needReadable = false;\n  this.emittedReadable = false;\n  this.readableListening = false;\n  this.resumeScheduled = false;\n\n  // has it been destroyed\n  this.destroyed = false;\n\n  // Crypto is kind of old and crusty.  Historically, its default string\n  // encoding is 'binary' so we have to make this configurable.\n  // Everything else in the universe uses 'utf8', though.\n  this.defaultEncoding = options.defaultEncoding || 'utf8';\n\n  // the number of writers that are awaiting a drain event in .pipe()s\n  this.awaitDrain = 0;\n\n  // if true, a maybeReadMore has been scheduled\n  this.readingMore = false;\n\n  this.decoder = null;\n  this.encoding = null;\n  if (options.encoding) {\n    if (!StringDecoder) StringDecoder = require('string_decoder/').StringDecoder;\n    this.decoder = new StringDecoder(options.encoding);\n    this.encoding = options.encoding;\n  }\n}\n\nfunction Readable(options) {\n  Duplex = Duplex || require('./_stream_duplex');\n\n  if (!(this instanceof Readable)) return new Readable(options);\n\n  this._readableState = new ReadableState(options, this);\n\n  // legacy\n  this.readable = true;\n\n  if (options) {\n    if (typeof options.read === 'function') this._read = options.read;\n\n    if (typeof options.destroy === 'function') this._destroy = options.destroy;\n  }\n\n  Stream.call(this);\n}\n\nObject.defineProperty(Readable.prototype, 'destroyed', {\n  get: function () {\n    if (this._readableState === undefined) {\n      return false;\n    }\n    return this._readableState.destroyed;\n  },\n  set: function (value) {\n    // we ignore the value if the stream\n    // has not been initialized yet\n    if (!this._readableState) {\n      return;\n    }\n\n    // backward compatibility, the user is explicitly\n    // managing destroyed\n    this._readableState.destroyed = value;\n  }\n});\n\nReadable.prototype.destroy = destroyImpl.destroy;\nReadable.prototype._undestroy = destroyImpl.undestroy;\nReadable.prototype._destroy = function (err, cb) {\n  this.push(null);\n  cb(err);\n};\n\n// Manually shove something into the read() buffer.\n// This returns true if the highWaterMark has not been hit yet,\n// similar to how Writable.write() returns true if you should\n// write() some more.\nReadable.prototype.push = function (chunk, encoding) {\n  var state = this._readableState;\n  var skipChunkCheck;\n\n  if (!state.objectMode) {\n    if (typeof chunk === 'string') {\n      encoding = encoding || state.defaultEncoding;\n      if (encoding !== state.encoding) {\n        chunk = Buffer.from(chunk, encoding);\n        encoding = '';\n      }\n      skipChunkCheck = true;\n    }\n  } else {\n    skipChunkCheck = true;\n  }\n\n  return readableAddChunk(this, chunk, encoding, false, skipChunkCheck);\n};\n\n// Unshift should *always* be something directly out of read()\nReadable.prototype.unshift = function (chunk) {\n  return readableAddChunk(this, chunk, null, true, false);\n};\n\nfunction readableAddChunk(stream, chunk, encoding, addToFront, skipChunkCheck) {\n  var state = stream._readableState;\n  if (chunk === null) {\n    state.reading = false;\n    onEofChunk(stream, state);\n  } else {\n    var er;\n    if (!skipChunkCheck) er = chunkInvalid(state, chunk);\n    if (er) {\n      stream.emit('error', er);\n    } else if (state.objectMode || chunk && chunk.length > 0) {\n      if (typeof chunk !== 'string' && !state.objectMode && Object.getPrototypeOf(chunk) !== Buffer.prototype) {\n        chunk = _uint8ArrayToBuffer(chunk);\n      }\n\n      if (addToFront) {\n        if (state.endEmitted) stream.emit('error', new Error('stream.unshift() after end event'));else addChunk(stream, state, chunk, true);\n      } else if (state.ended) {\n        stream.emit('error', new Error('stream.push() after EOF'));\n      } else {\n        state.reading = false;\n        if (state.decoder && !encoding) {\n          chunk = state.decoder.write(chunk);\n          if (state.objectMode || chunk.length !== 0) addChunk(stream, state, chunk, false);else maybeReadMore(stream, state);\n        } else {\n          addChunk(stream, state, chunk, false);\n        }\n      }\n    } else if (!addToFront) {\n      state.reading = false;\n    }\n  }\n\n  return needMoreData(state);\n}\n\nfunction addChunk(stream, state, chunk, addToFront) {\n  if (state.flowing && state.length === 0 && !state.sync) {\n    stream.emit('data', chunk);\n    stream.read(0);\n  } else {\n    // update the buffer info.\n    state.length += state.objectMode ? 1 : chunk.length;\n    if (addToFront) state.buffer.unshift(chunk);else state.buffer.push(chunk);\n\n    if (state.needReadable) emitReadable(stream);\n  }\n  maybeReadMore(stream, state);\n}\n\nfunction chunkInvalid(state, chunk) {\n  var er;\n  if (!_isUint8Array(chunk) && typeof chunk !== 'string' && chunk !== undefined && !state.objectMode) {\n    er = new TypeError('Invalid non-string/buffer chunk');\n  }\n  return er;\n}\n\n// if it's past the high water mark, we can push in some more.\n// Also, if we have no data yet, we can stand some\n// more bytes.  This is to work around cases where hwm=0,\n// such as the repl.  Also, if the push() triggered a\n// readable event, and the user called read(largeNumber) such that\n// needReadable was set, then we ought to push more, so that another\n// 'readable' event will be triggered.\nfunction needMoreData(state) {\n  return !state.ended && (state.needReadable || state.length < state.highWaterMark || state.length === 0);\n}\n\nReadable.prototype.isPaused = function () {\n  return this._readableState.flowing === false;\n};\n\n// backwards compatibility.\nReadable.prototype.setEncoding = function (enc) {\n  if (!StringDecoder) StringDecoder = require('string_decoder/').StringDecoder;\n  this._readableState.decoder = new StringDecoder(enc);\n  this._readableState.encoding = enc;\n  return this;\n};\n\n// Don't raise the hwm > 8MB\nvar MAX_HWM = 0x800000;\nfunction computeNewHighWaterMark(n) {\n  if (n >= MAX_HWM) {\n    n = MAX_HWM;\n  } else {\n    // Get the next highest power of 2 to prevent increasing hwm excessively in\n    // tiny amounts\n    n--;\n    n |= n >>> 1;\n    n |= n >>> 2;\n    n |= n >>> 4;\n    n |= n >>> 8;\n    n |= n >>> 16;\n    n++;\n  }\n  return n;\n}\n\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction howMuchToRead(n, state) {\n  if (n <= 0 || state.length === 0 && state.ended) return 0;\n  if (state.objectMode) return 1;\n  if (n !== n) {\n    // Only flow one buffer at a time\n    if (state.flowing && state.length) return state.buffer.head.data.length;else return state.length;\n  }\n  // If we're asking for more than the current hwm, then raise the hwm.\n  if (n > state.highWaterMark) state.highWaterMark = computeNewHighWaterMark(n);\n  if (n <= state.length) return n;\n  // Don't have enough\n  if (!state.ended) {\n    state.needReadable = true;\n    return 0;\n  }\n  return state.length;\n}\n\n// you can override either this method, or the async _read(n) below.\nReadable.prototype.read = function (n) {\n  debug('read', n);\n  n = parseInt(n, 10);\n  var state = this._readableState;\n  var nOrig = n;\n\n  if (n !== 0) state.emittedReadable = false;\n\n  // if we're doing read(0) to trigger a readable event, but we\n  // already have a bunch of data in the buffer, then just trigger\n  // the 'readable' event and move on.\n  if (n === 0 && state.needReadable && (state.length >= state.highWaterMark || state.ended)) {\n    debug('read: emitReadable', state.length, state.ended);\n    if (state.length === 0 && state.ended) endReadable(this);else emitReadable(this);\n    return null;\n  }\n\n  n = howMuchToRead(n, state);\n\n  // if we've ended, and we're now clear, then finish it up.\n  if (n === 0 && state.ended) {\n    if (state.length === 0) endReadable(this);\n    return null;\n  }\n\n  // All the actual chunk generation logic needs to be\n  // *below* the call to _read.  The reason is that in certain\n  // synthetic stream cases, such as passthrough streams, _read\n  // may be a completely synchronous operation which may change\n  // the state of the read buffer, providing enough data when\n  // before there was *not* enough.\n  //\n  // So, the steps are:\n  // 1. Figure out what the state of things will be after we do\n  // a read from the buffer.\n  //\n  // 2. If that resulting state will trigger a _read, then call _read.\n  // Note that this may be asynchronous, or synchronous.  Yes, it is\n  // deeply ugly to write APIs this way, but that still doesn't mean\n  // that the Readable class should behave improperly, as streams are\n  // designed to be sync/async agnostic.\n  // Take note if the _read call is sync or async (ie, if the read call\n  // has returned yet), so that we know whether or not it's safe to emit\n  // 'readable' etc.\n  //\n  // 3. Actually pull the requested chunks out of the buffer and return.\n\n  // if we need a readable event, then we need to do some reading.\n  var doRead = state.needReadable;\n  debug('need readable', doRead);\n\n  // if we currently have less than the highWaterMark, then also read some\n  if (state.length === 0 || state.length - n < state.highWaterMark) {\n    doRead = true;\n    debug('length less than watermark', doRead);\n  }\n\n  // however, if we've ended, then there's no point, and if we're already\n  // reading, then it's unnecessary.\n  if (state.ended || state.reading) {\n    doRead = false;\n    debug('reading or ended', doRead);\n  } else if (doRead) {\n    debug('do read');\n    state.reading = true;\n    state.sync = true;\n    // if the length is currently zero, then we *need* a readable event.\n    if (state.length === 0) state.needReadable = true;\n    // call internal read method\n    this._read(state.highWaterMark);\n    state.sync = false;\n    // If _read pushed data synchronously, then `reading` will be false,\n    // and we need to re-evaluate how much data we can return to the user.\n    if (!state.reading) n = howMuchToRead(nOrig, state);\n  }\n\n  var ret;\n  if (n > 0) ret = fromList(n, state);else ret = null;\n\n  if (ret === null) {\n    state.needReadable = true;\n    n = 0;\n  } else {\n    state.length -= n;\n  }\n\n  if (state.length === 0) {\n    // If we have nothing in the buffer, then we want to know\n    // as soon as we *do* get something into the buffer.\n    if (!state.ended) state.needReadable = true;\n\n    // If we tried to read() past the EOF, then emit end on the next tick.\n    if (nOrig !== n && state.ended) endReadable(this);\n  }\n\n  if (ret !== null) this.emit('data', ret);\n\n  return ret;\n};\n\nfunction onEofChunk(stream, state) {\n  if (state.ended) return;\n  if (state.decoder) {\n    var chunk = state.decoder.end();\n    if (chunk && chunk.length) {\n      state.buffer.push(chunk);\n      state.length += state.objectMode ? 1 : chunk.length;\n    }\n  }\n  state.ended = true;\n\n  // emit 'readable' now to make sure it gets picked up.\n  emitReadable(stream);\n}\n\n// Don't emit readable right away in sync mode, because this can trigger\n// another read() call => stack overflow.  This way, it might trigger\n// a nextTick recursion warning, but that's not so bad.\nfunction emitReadable(stream) {\n  var state = stream._readableState;\n  state.needReadable = false;\n  if (!state.emittedReadable) {\n    debug('emitReadable', state.flowing);\n    state.emittedReadable = true;\n    if (state.sync) pna.nextTick(emitReadable_, stream);else emitReadable_(stream);\n  }\n}\n\nfunction emitReadable_(stream) {\n  debug('emit readable');\n  stream.emit('readable');\n  flow(stream);\n}\n\n// at this point, the user has presumably seen the 'readable' event,\n// and called read() to consume some data.  that may have triggered\n// in turn another _read(n) call, in which case reading = true if\n// it's in progress.\n// However, if we're not ended, or reading, and the length < hwm,\n// then go ahead and try to read some more preemptively.\nfunction maybeReadMore(stream, state) {\n  if (!state.readingMore) {\n    state.readingMore = true;\n    pna.nextTick(maybeReadMore_, stream, state);\n  }\n}\n\nfunction maybeReadMore_(stream, state) {\n  var len = state.length;\n  while (!state.reading && !state.flowing && !state.ended && state.length < state.highWaterMark) {\n    debug('maybeReadMore read 0');\n    stream.read(0);\n    if (len === state.length)\n      // didn't get any data, stop spinning.\n      break;else len = state.length;\n  }\n  state.readingMore = false;\n}\n\n// abstract method.  to be overridden in specific implementation classes.\n// call cb(er, data) where data is <= n in length.\n// for virtual (non-string, non-buffer) streams, \"length\" is somewhat\n// arbitrary, and perhaps not very meaningful.\nReadable.prototype._read = function (n) {\n  this.emit('error', new Error('_read() is not implemented'));\n};\n\nReadable.prototype.pipe = function (dest, pipeOpts) {\n  var src = this;\n  var state = this._readableState;\n\n  switch (state.pipesCount) {\n    case 0:\n      state.pipes = dest;\n      break;\n    case 1:\n      state.pipes = [state.pipes, dest];\n      break;\n    default:\n      state.pipes.push(dest);\n      break;\n  }\n  state.pipesCount += 1;\n  debug('pipe count=%d opts=%j', state.pipesCount, pipeOpts);\n\n  var doEnd = (!pipeOpts || pipeOpts.end !== false) && dest !== process.stdout && dest !== process.stderr;\n\n  var endFn = doEnd ? onend : unpipe;\n  if (state.endEmitted) pna.nextTick(endFn);else src.once('end', endFn);\n\n  dest.on('unpipe', onunpipe);\n  function onunpipe(readable, unpipeInfo) {\n    debug('onunpipe');\n    if (readable === src) {\n      if (unpipeInfo && unpipeInfo.hasUnpiped === false) {\n        unpipeInfo.hasUnpiped = true;\n        cleanup();\n      }\n    }\n  }\n\n  function onend() {\n    debug('onend');\n    dest.end();\n  }\n\n  // when the dest drains, it reduces the awaitDrain counter\n  // on the source.  This would be more elegant with a .once()\n  // handler in flow(), but adding and removing repeatedly is\n  // too slow.\n  var ondrain = pipeOnDrain(src);\n  dest.on('drain', ondrain);\n\n  var cleanedUp = false;\n  function cleanup() {\n    debug('cleanup');\n    // cleanup event handlers once the pipe is broken\n    dest.removeListener('close', onclose);\n    dest.removeListener('finish', onfinish);\n    dest.removeListener('drain', ondrain);\n    dest.removeListener('error', onerror);\n    dest.removeListener('unpipe', onunpipe);\n    src.removeListener('end', onend);\n    src.removeListener('end', unpipe);\n    src.removeListener('data', ondata);\n\n    cleanedUp = true;\n\n    // if the reader is waiting for a drain event from this\n    // specific writer, then it would cause it to never start\n    // flowing again.\n    // So, if this is awaiting a drain, then we just call it now.\n    // If we don't know, then assume that we are waiting for one.\n    if (state.awaitDrain && (!dest._writableState || dest._writableState.needDrain)) ondrain();\n  }\n\n  // If the user pushes more data while we're writing to dest then we'll end up\n  // in ondata again. However, we only want to increase awaitDrain once because\n  // dest will only emit one 'drain' event for the multiple writes.\n  // => Introduce a guard on increasing awaitDrain.\n  var increasedAwaitDrain = false;\n  src.on('data', ondata);\n  function ondata(chunk) {\n    debug('ondata');\n    increasedAwaitDrain = false;\n    var ret = dest.write(chunk);\n    if (false === ret && !increasedAwaitDrain) {\n      // If the user unpiped during `dest.write()`, it is possible\n      // to get stuck in a permanently paused state if that write\n      // also returned false.\n      // => Check whether `dest` is still a piping destination.\n      if ((state.pipesCount === 1 && state.pipes === dest || state.pipesCount > 1 && indexOf(state.pipes, dest) !== -1) && !cleanedUp) {\n        debug('false write response, pause', src._readableState.awaitDrain);\n        src._readableState.awaitDrain++;\n        increasedAwaitDrain = true;\n      }\n      src.pause();\n    }\n  }\n\n  // if the dest has an error, then stop piping into it.\n  // however, don't suppress the throwing behavior for this.\n  function onerror(er) {\n    debug('onerror', er);\n    unpipe();\n    dest.removeListener('error', onerror);\n    if (EElistenerCount(dest, 'error') === 0) dest.emit('error', er);\n  }\n\n  // Make sure our error handler is attached before userland ones.\n  prependListener(dest, 'error', onerror);\n\n  // Both close and finish should trigger unpipe, but only once.\n  function onclose() {\n    dest.removeListener('finish', onfinish);\n    unpipe();\n  }\n  dest.once('close', onclose);\n  function onfinish() {\n    debug('onfinish');\n    dest.removeListener('close', onclose);\n    unpipe();\n  }\n  dest.once('finish', onfinish);\n\n  function unpipe() {\n    debug('unpipe');\n    src.unpipe(dest);\n  }\n\n  // tell the dest that it's being piped to\n  dest.emit('pipe', src);\n\n  // start the flow if it hasn't been started already.\n  if (!state.flowing) {\n    debug('pipe resume');\n    src.resume();\n  }\n\n  return dest;\n};\n\nfunction pipeOnDrain(src) {\n  return function () {\n    var state = src._readableState;\n    debug('pipeOnDrain', state.awaitDrain);\n    if (state.awaitDrain) state.awaitDrain--;\n    if (state.awaitDrain === 0 && EElistenerCount(src, 'data')) {\n      state.flowing = true;\n      flow(src);\n    }\n  };\n}\n\nReadable.prototype.unpipe = function (dest) {\n  var state = this._readableState;\n  var unpipeInfo = { hasUnpiped: false };\n\n  // if we're not piping anywhere, then do nothing.\n  if (state.pipesCount === 0) return this;\n\n  // just one destination.  most common case.\n  if (state.pipesCount === 1) {\n    // passed in one, but it's not the right one.\n    if (dest && dest !== state.pipes) return this;\n\n    if (!dest) dest = state.pipes;\n\n    // got a match.\n    state.pipes = null;\n    state.pipesCount = 0;\n    state.flowing = false;\n    if (dest) dest.emit('unpipe', this, unpipeInfo);\n    return this;\n  }\n\n  // slow case. multiple pipe destinations.\n\n  if (!dest) {\n    // remove all.\n    var dests = state.pipes;\n    var len = state.pipesCount;\n    state.pipes = null;\n    state.pipesCount = 0;\n    state.flowing = false;\n\n    for (var i = 0; i < len; i++) {\n      dests[i].emit('unpipe', this, unpipeInfo);\n    }return this;\n  }\n\n  // try to find the right one.\n  var index = indexOf(state.pipes, dest);\n  if (index === -1) return this;\n\n  state.pipes.splice(index, 1);\n  state.pipesCount -= 1;\n  if (state.pipesCount === 1) state.pipes = state.pipes[0];\n\n  dest.emit('unpipe', this, unpipeInfo);\n\n  return this;\n};\n\n// set up data events if they are asked for\n// Ensure readable listeners eventually get something\nReadable.prototype.on = function (ev, fn) {\n  var res = Stream.prototype.on.call(this, ev, fn);\n\n  if (ev === 'data') {\n    // Start flowing on next tick if stream isn't explicitly paused\n    if (this._readableState.flowing !== false) this.resume();\n  } else if (ev === 'readable') {\n    var state = this._readableState;\n    if (!state.endEmitted && !state.readableListening) {\n      state.readableListening = state.needReadable = true;\n      state.emittedReadable = false;\n      if (!state.reading) {\n        pna.nextTick(nReadingNextTick, this);\n      } else if (state.length) {\n        emitReadable(this);\n      }\n    }\n  }\n\n  return res;\n};\nReadable.prototype.addListener = Readable.prototype.on;\n\nfunction nReadingNextTick(self) {\n  debug('readable nexttick read 0');\n  self.read(0);\n}\n\n// pause() and resume() are remnants of the legacy readable stream API\n// If the user uses them, then switch into old mode.\nReadable.prototype.resume = function () {\n  var state = this._readableState;\n  if (!state.flowing) {\n    debug('resume');\n    state.flowing = true;\n    resume(this, state);\n  }\n  return this;\n};\n\nfunction resume(stream, state) {\n  if (!state.resumeScheduled) {\n    state.resumeScheduled = true;\n    pna.nextTick(resume_, stream, state);\n  }\n}\n\nfunction resume_(stream, state) {\n  if (!state.reading) {\n    debug('resume read 0');\n    stream.read(0);\n  }\n\n  state.resumeScheduled = false;\n  state.awaitDrain = 0;\n  stream.emit('resume');\n  flow(stream);\n  if (state.flowing && !state.reading) stream.read(0);\n}\n\nReadable.prototype.pause = function () {\n  debug('call pause flowing=%j', this._readableState.flowing);\n  if (false !== this._readableState.flowing) {\n    debug('pause');\n    this._readableState.flowing = false;\n    this.emit('pause');\n  }\n  return this;\n};\n\nfunction flow(stream) {\n  var state = stream._readableState;\n  debug('flow', state.flowing);\n  while (state.flowing && stream.read() !== null) {}\n}\n\n// wrap an old-style stream as the async data source.\n// This is *not* part of the readable stream interface.\n// It is an ugly unfortunate mess of history.\nReadable.prototype.wrap = function (stream) {\n  var _this = this;\n\n  var state = this._readableState;\n  var paused = false;\n\n  stream.on('end', function () {\n    debug('wrapped end');\n    if (state.decoder && !state.ended) {\n      var chunk = state.decoder.end();\n      if (chunk && chunk.length) _this.push(chunk);\n    }\n\n    _this.push(null);\n  });\n\n  stream.on('data', function (chunk) {\n    debug('wrapped data');\n    if (state.decoder) chunk = state.decoder.write(chunk);\n\n    // don't skip over falsy values in objectMode\n    if (state.objectMode && (chunk === null || chunk === undefined)) return;else if (!state.objectMode && (!chunk || !chunk.length)) return;\n\n    var ret = _this.push(chunk);\n    if (!ret) {\n      paused = true;\n      stream.pause();\n    }\n  });\n\n  // proxy all the other methods.\n  // important when wrapping filters and duplexes.\n  for (var i in stream) {\n    if (this[i] === undefined && typeof stream[i] === 'function') {\n      this[i] = function (method) {\n        return function () {\n          return stream[method].apply(stream, arguments);\n        };\n      }(i);\n    }\n  }\n\n  // proxy certain important events.\n  for (var n = 0; n < kProxyEvents.length; n++) {\n    stream.on(kProxyEvents[n], this.emit.bind(this, kProxyEvents[n]));\n  }\n\n  // when we try to consume some more bytes, simply unpause the\n  // underlying stream.\n  this._read = function (n) {\n    debug('wrapped _read', n);\n    if (paused) {\n      paused = false;\n      stream.resume();\n    }\n  };\n\n  return this;\n};\n\nObject.defineProperty(Readable.prototype, 'readableHighWaterMark', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function () {\n    return this._readableState.highWaterMark;\n  }\n});\n\n// exposed for testing purposes only.\nReadable._fromList = fromList;\n\n// Pluck off n bytes from an array of buffers.\n// Length is the combined lengths of all the buffers in the list.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction fromList(n, state) {\n  // nothing buffered\n  if (state.length === 0) return null;\n\n  var ret;\n  if (state.objectMode) ret = state.buffer.shift();else if (!n || n >= state.length) {\n    // read it all, truncate the list\n    if (state.decoder) ret = state.buffer.join('');else if (state.buffer.length === 1) ret = state.buffer.head.data;else ret = state.buffer.concat(state.length);\n    state.buffer.clear();\n  } else {\n    // read part of list\n    ret = fromListPartial(n, state.buffer, state.decoder);\n  }\n\n  return ret;\n}\n\n// Extracts only enough buffered data to satisfy the amount requested.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction fromListPartial(n, list, hasStrings) {\n  var ret;\n  if (n < list.head.data.length) {\n    // slice is the same for buffers and strings\n    ret = list.head.data.slice(0, n);\n    list.head.data = list.head.data.slice(n);\n  } else if (n === list.head.data.length) {\n    // first chunk is a perfect match\n    ret = list.shift();\n  } else {\n    // result spans more than one buffer\n    ret = hasStrings ? copyFromBufferString(n, list) : copyFromBuffer(n, list);\n  }\n  return ret;\n}\n\n// Copies a specified amount of characters from the list of buffered data\n// chunks.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction copyFromBufferString(n, list) {\n  var p = list.head;\n  var c = 1;\n  var ret = p.data;\n  n -= ret.length;\n  while (p = p.next) {\n    var str = p.data;\n    var nb = n > str.length ? str.length : n;\n    if (nb === str.length) ret += str;else ret += str.slice(0, n);\n    n -= nb;\n    if (n === 0) {\n      if (nb === str.length) {\n        ++c;\n        if (p.next) list.head = p.next;else list.head = list.tail = null;\n      } else {\n        list.head = p;\n        p.data = str.slice(nb);\n      }\n      break;\n    }\n    ++c;\n  }\n  list.length -= c;\n  return ret;\n}\n\n// Copies a specified amount of bytes from the list of buffered data chunks.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction copyFromBuffer(n, list) {\n  var ret = Buffer.allocUnsafe(n);\n  var p = list.head;\n  var c = 1;\n  p.data.copy(ret);\n  n -= p.data.length;\n  while (p = p.next) {\n    var buf = p.data;\n    var nb = n > buf.length ? buf.length : n;\n    buf.copy(ret, ret.length - n, 0, nb);\n    n -= nb;\n    if (n === 0) {\n      if (nb === buf.length) {\n        ++c;\n        if (p.next) list.head = p.next;else list.head = list.tail = null;\n      } else {\n        list.head = p;\n        p.data = buf.slice(nb);\n      }\n      break;\n    }\n    ++c;\n  }\n  list.length -= c;\n  return ret;\n}\n\nfunction endReadable(stream) {\n  var state = stream._readableState;\n\n  // If we get here before consuming all the bytes, then that is a\n  // bug in node.  Should never happen.\n  if (state.length > 0) throw new Error('\"endReadable()\" called on non-empty stream');\n\n  if (!state.endEmitted) {\n    state.ended = true;\n    pna.nextTick(endReadableNT, state, stream);\n  }\n}\n\nfunction endReadableNT(state, stream) {\n  // Check that we didn't get one last unshift.\n  if (!state.endEmitted && state.length === 0) {\n    state.endEmitted = true;\n    stream.readable = false;\n    stream.emit('end');\n  }\n}\n\nfunction indexOf(xs, x) {\n  for (var i = 0, l = xs.length; i < l; i++) {\n    if (xs[i] === x) return i;\n  }\n  return -1;\n}","module.exports = require('events').EventEmitter;\n","'use strict';\n\n/*<replacement>*/\n\nvar pna = require('process-nextick-args');\n/*</replacement>*/\n\n// undocumented cb() API, needed for core, not for public API\nfunction destroy(err, cb) {\n  var _this = this;\n\n  var readableDestroyed = this._readableState && this._readableState.destroyed;\n  var writableDestroyed = this._writableState && this._writableState.destroyed;\n\n  if (readableDestroyed || writableDestroyed) {\n    if (cb) {\n      cb(err);\n    } else if (err && (!this._writableState || !this._writableState.errorEmitted)) {\n      pna.nextTick(emitErrorNT, this, err);\n    }\n    return this;\n  }\n\n  // we set destroyed to true before firing error callbacks in order\n  // to make it re-entrance safe in case destroy() is called within callbacks\n\n  if (this._readableState) {\n    this._readableState.destroyed = true;\n  }\n\n  // if this is a duplex stream mark the writable part as destroyed as well\n  if (this._writableState) {\n    this._writableState.destroyed = true;\n  }\n\n  this._destroy(err || null, function (err) {\n    if (!cb && err) {\n      pna.nextTick(emitErrorNT, _this, err);\n      if (_this._writableState) {\n        _this._writableState.errorEmitted = true;\n      }\n    } else if (cb) {\n      cb(err);\n    }\n  });\n\n  return this;\n}\n\nfunction undestroy() {\n  if (this._readableState) {\n    this._readableState.destroyed = false;\n    this._readableState.reading = false;\n    this._readableState.ended = false;\n    this._readableState.endEmitted = false;\n  }\n\n  if (this._writableState) {\n    this._writableState.destroyed = false;\n    this._writableState.ended = false;\n    this._writableState.ending = false;\n    this._writableState.finished = false;\n    this._writableState.errorEmitted = false;\n  }\n}\n\nfunction emitErrorNT(self, err) {\n  self.emit('error', err);\n}\n\nmodule.exports = {\n  destroy: destroy,\n  undestroy: undestroy\n};","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a transform stream is a readable/writable stream where you do\n// something with the data.  Sometimes it's called a \"filter\",\n// but that's not a great name for it, since that implies a thing where\n// some bits pass through, and others are simply ignored.  (That would\n// be a valid example of a transform, of course.)\n//\n// While the output is causally related to the input, it's not a\n// necessarily symmetric or synchronous transformation.  For example,\n// a zlib stream might take multiple plain-text writes(), and then\n// emit a single compressed chunk some time in the future.\n//\n// Here's how this works:\n//\n// The Transform stream has all the aspects of the readable and writable\n// stream classes.  When you write(chunk), that calls _write(chunk,cb)\n// internally, and returns false if there's a lot of pending writes\n// buffered up.  When you call read(), that calls _read(n) until\n// there's enough pending readable data buffered up.\n//\n// In a transform stream, the written data is placed in a buffer.  When\n// _read(n) is called, it transforms the queued up data, calling the\n// buffered _write cb's as it consumes chunks.  If consuming a single\n// written chunk would result in multiple output chunks, then the first\n// outputted bit calls the readcb, and subsequent chunks just go into\n// the read buffer, and will cause it to emit 'readable' if necessary.\n//\n// This way, back-pressure is actually determined by the reading side,\n// since _read has to be called to start processing a new chunk.  However,\n// a pathological inflate type of transform can cause excessive buffering\n// here.  For example, imagine a stream where every byte of input is\n// interpreted as an integer from 0-255, and then results in that many\n// bytes of output.  Writing the 4 bytes {ff,ff,ff,ff} would result in\n// 1kb of data being output.  In this case, you could write a very small\n// amount of input, and end up with a very large amount of output.  In\n// such a pathological inflating mechanism, there'd be no way to tell\n// the system to stop doing the transform.  A single 4MB write could\n// cause the system to run out of memory.\n//\n// However, even in such a pathological case, only a single written chunk\n// would be consumed, and then the rest would wait (un-transformed) until\n// the results of the previous transformed chunk were consumed.\n\n'use strict';\n\nmodule.exports = Transform;\n\nvar Duplex = require('./_stream_duplex');\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nutil.inherits(Transform, Duplex);\n\nfunction afterTransform(er, data) {\n  var ts = this._transformState;\n  ts.transforming = false;\n\n  var cb = ts.writecb;\n\n  if (!cb) {\n    return this.emit('error', new Error('write callback called multiple times'));\n  }\n\n  ts.writechunk = null;\n  ts.writecb = null;\n\n  if (data != null) // single equals check for both `null` and `undefined`\n    this.push(data);\n\n  cb(er);\n\n  var rs = this._readableState;\n  rs.reading = false;\n  if (rs.needReadable || rs.length < rs.highWaterMark) {\n    this._read(rs.highWaterMark);\n  }\n}\n\nfunction Transform(options) {\n  if (!(this instanceof Transform)) return new Transform(options);\n\n  Duplex.call(this, options);\n\n  this._transformState = {\n    afterTransform: afterTransform.bind(this),\n    needTransform: false,\n    transforming: false,\n    writecb: null,\n    writechunk: null,\n    writeencoding: null\n  };\n\n  // start out asking for a readable event once data is transformed.\n  this._readableState.needReadable = true;\n\n  // we have implemented the _read method, and done the other things\n  // that Readable wants before the first _read call, so unset the\n  // sync guard flag.\n  this._readableState.sync = false;\n\n  if (options) {\n    if (typeof options.transform === 'function') this._transform = options.transform;\n\n    if (typeof options.flush === 'function') this._flush = options.flush;\n  }\n\n  // When the writable side finishes, then flush out anything remaining.\n  this.on('prefinish', prefinish);\n}\n\nfunction prefinish() {\n  var _this = this;\n\n  if (typeof this._flush === 'function') {\n    this._flush(function (er, data) {\n      done(_this, er, data);\n    });\n  } else {\n    done(this, null, null);\n  }\n}\n\nTransform.prototype.push = function (chunk, encoding) {\n  this._transformState.needTransform = false;\n  return Duplex.prototype.push.call(this, chunk, encoding);\n};\n\n// This is the part where you do stuff!\n// override this function in implementation classes.\n// 'chunk' is an input chunk.\n//\n// Call `push(newChunk)` to pass along transformed output\n// to the readable side.  You may call 'push' zero or more times.\n//\n// Call `cb(err)` when you are done with this chunk.  If you pass\n// an error, then that'll put the hurt on the whole operation.  If you\n// never call cb(), then you'll never get another chunk.\nTransform.prototype._transform = function (chunk, encoding, cb) {\n  throw new Error('_transform() is not implemented');\n};\n\nTransform.prototype._write = function (chunk, encoding, cb) {\n  var ts = this._transformState;\n  ts.writecb = cb;\n  ts.writechunk = chunk;\n  ts.writeencoding = encoding;\n  if (!ts.transforming) {\n    var rs = this._readableState;\n    if (ts.needTransform || rs.needReadable || rs.length < rs.highWaterMark) this._read(rs.highWaterMark);\n  }\n};\n\n// Doesn't matter what the args are here.\n// _transform does all the work.\n// That we got here means that the readable side wants more data.\nTransform.prototype._read = function (n) {\n  var ts = this._transformState;\n\n  if (ts.writechunk !== null && ts.writecb && !ts.transforming) {\n    ts.transforming = true;\n    this._transform(ts.writechunk, ts.writeencoding, ts.afterTransform);\n  } else {\n    // mark that we need a transform, so that any data that comes in\n    // will get processed, now that we've asked for it.\n    ts.needTransform = true;\n  }\n};\n\nTransform.prototype._destroy = function (err, cb) {\n  var _this2 = this;\n\n  Duplex.prototype._destroy.call(this, err, function (err2) {\n    cb(err2);\n    _this2.emit('close');\n  });\n};\n\nfunction done(stream, er, data) {\n  if (er) return stream.emit('error', er);\n\n  if (data != null) // single equals check for both `null` and `undefined`\n    stream.push(data);\n\n  // if there's nothing in the write buffer, then that means\n  // that nothing more will ever be provided\n  if (stream._writableState.length) throw new Error('Calling transform done when ws.length != 0');\n\n  if (stream._transformState.transforming) throw new Error('Calling transform done when still transforming');\n\n  return stream.push(null);\n}","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && msCrypto.getRandomValues.bind(msCrypto));\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","/** @module SquareEdit/Controls */\n\nimport * as Contents from './Contents';\nimport { setGroupingHighlight } from '../utils/Color';\nimport { unselect } from '../utils/SelectTools';\nimport InsertHandler from './InsertHandler';\nimport { NeumeEditInterface } from '../Interfaces';\n\n/**\n * Set listener on EditMode button.\n */\nexport function initEditModeControls (editMode: NeumeEditInterface) {\n  document.getElementById('edit_mode').addEventListener('click', function () {\n    document.getElementById('insert_controls').innerHTML += Contents.insertControlsPanel;\n    document.getElementById('edit_controls').innerHTML += Contents.editControlsPanel;\n    editMode.initEditMode();\n  });\n}\n\n/**\n * Bind listeners to insert tabs.'\n */\nexport function bindInsertTabs (insertHandler: InsertHandler) {\n  const insertTabs: Element[] = Array.from(document.getElementsByClassName('insertTab'));\n  const tabIds: string[] = insertTabs.map((tab) => { return tab.id; });\n\n  document.body.addEventListener('keydown', (evt: KeyboardEvent) => {\n    if (evt.code.match(/^Digit\\d$/) && evt.shiftKey) {\n      try {\n        const index = Number(evt.code[evt.code.length - 1]) - 1;\n        const insertOptions = document.getElementsByClassName('insertel');\n        const selectedOption = insertOptions[index];\n        deactivate('.insertel');\n        insertHandler.insertDisabled();\n        activate(selectedOption.id, insertHandler);\n      } catch (e) {\n        console.debug(e);\n      }\n    }\n  });\n\n  tabIds.forEach((tab) => {\n    document.getElementById(tab).addEventListener('click', () => {\n      deactivate('.insertTab');\n      activate(tab, insertHandler);\n      document.getElementById('insert_data').innerHTML = Contents.insertTabHtml[tab];\n      bindElements(insertHandler);\n      deactivate('.insertel');\n      const firstOption = document.getElementsByClassName('insertel')[0];\n      activate(firstOption.id, insertHandler);\n    });\n  });\n}\n\n/**\n * Initialize Edit and Insert control panels.\n */\nexport function initInsertEditControls () {\n  const toggleInsert = document.getElementById('toggleInsert');\n  const toggleEdit = document.getElementById('toggleEdit');\n  const insertContents = document.getElementById('insertContents');\n  const editContents = document.getElementById('editContents');\n  toggleInsert.addEventListener('click', () => {\n    if (insertContents.style.display === 'none') {\n      insertContents.style.display = '';\n      toggleInsert.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down');\n    } else {\n      insertContents.style.display = 'none';\n      toggleInsert.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-side');\n    }\n  });\n\n  toggleEdit.addEventListener('click', () => {\n    if (editContents.style.display === 'none') {\n      editContents.style.display = '';\n      toggleEdit.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down');\n    } else {\n      editContents.style.display = 'none';\n      toggleEdit.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-side');\n    }\n  });\n}\n\n/**\n * Activate a certain insert action.\n * @param id - The ID of the insert action tab.\n */\nfunction activate (id: string, insertHandler: InsertHandler) {\n  document.getElementById(id).classList.add('is-active');\n  if (document.getElementById(id).classList.contains('insertel')) {\n    insertHandler.insertActive(id);\n  }\n}\n\n/**\n * Deactivate a certain insert action.\n * @param type - A CSS selector for the action tab.\n */\nfunction deactivate (type: string) {\n  const elList = document.querySelectorAll(type);\n  elList.forEach(el => {\n    el.classList.remove('is-active');\n  });\n}\n\n/**\n * Bind listeners to insert tab elements.\n */\nfunction bindElements (insertHandler: InsertHandler) {\n  const insertElements = Array.from(document.getElementsByClassName('insertel'));\n  const elementIds = insertElements.map(el => el.id);\n  elementIds.forEach(el => {\n    document.getElementById(el).addEventListener('click', () => {\n      deactivate('.insertel');\n      activate(el, insertHandler);\n    });\n  });\n}\n\n/**\n * Set listeners on the buttons to change selection modes.\n */\nexport function initSelectionButtons () {\n  const selBySyl = document.getElementById('selBySyl');\n  const selByNeume = document.getElementById('selByNeume');\n  const selByNc = document.getElementById('selByNc');\n  const selByStaff = document.getElementById('selByStaff');\n\n  selBySyl.addEventListener('click', selectBySylHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '1') {\n      selectBySylHandler();\n    }\n  });\n\n  selByNeume.addEventListener('click', selectByNeumeHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '2') {\n      selectByNeumeHandler();\n    }\n  });\n\n  selByNc.addEventListener('click', selectByNcHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '3') {\n      selectByNcHandler();\n    }\n  });\n\n  selByStaff.addEventListener('click', selectByStaffHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '4') {\n      selectByStaffHandler();\n    }\n  });\n\n  function selectBySylHandler () {\n    if (!selBySyl.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      selBySyl.classList.add('is-active');\n      selByNeume.classList.remove('is-active');\n      selByNc.classList.remove('is-active');\n      selByStaff.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('syllable');\n        }\n      } catch (e) {}\n    }\n  }\n\n  function selectByNeumeHandler () {\n    if (!selByNeume.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      selByNeume.classList.add('is-active');\n      selByNc.classList.remove('is-active');\n      selBySyl.classList.remove('is-active');\n      selByStaff.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('neume');\n        }\n      } catch (e) {}\n    }\n  }\n\n  function selectByNcHandler () {\n    if (!selByNc.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      selByNc.classList.add('is-active');\n      selByNeume.classList.remove('is-active');\n      selBySyl.classList.remove('is-active');\n      selByStaff.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('neume');\n        }\n      } catch (e) {}\n    }\n  }\n\n  function selectByStaffHandler () {\n    if (!selByStaff.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      selByStaff.classList.add('is-active');\n      selByNeume.classList.remove('is-active');\n      selByNc.classList.remove('is-active');\n      selBySyl.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('staff');\n        }\n      } catch (e) {}\n    }\n  }\n}\n","import * as Contents from './Contents';\nimport * as Warnings from '../Warnings';\nimport * as Notification from '../utils/Notification';\nimport NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport { unsetVirgaAction, unsetInclinatumAction, removeHandler, deleteButtonHandler } from './SelectOptions';\n\n/**\n * The NeonView parent to access editor actions.\n */\nlet neonView: NeonView;\n\n/**\n * Set the neonView member.\n * @param {NeonView} view\n */\nexport function initNeonView (view: NeonView): void {\n  neonView = view;\n}\n\n/**\n * Trigger the grouping selection menu.\n * @param {string} type - The grouping type: nc, neume, syl, ligatureNc, or ligature\n */\nexport function triggerGrouping (type: string): void {\n  const moreEdit = document.getElementById('moreEdit');\n  moreEdit.classList.remove('is-invisible');\n  moreEdit.innerHTML += Contents.groupingMenu[type];\n  initGroupingListeners();\n}\n\n/**\n * Remove the grouping selection menu.\n */\nexport function endGroupingSelection (): void {\n  const moreEdit = document.getElementById('moreEdit');\n  moreEdit.innerHTML = '';\n  moreEdit.classList.add('is-invisible');\n  document.body.removeEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * The grouping dropdown listener.\n */\nexport function initGroupingListeners (): void {\n  const del = document.getElementById('delete');\n  del.removeEventListener('click', removeHandler);\n  del.addEventListener('click', removeHandler);\n  document.body.addEventListener('keydown', deleteButtonHandler);\n  try {\n    document.getElementById('mergeSyls').addEventListener('click', () => {\n      const elementIds = getChildrenIds().filter(e =>\n        document.getElementById(e).classList.contains('neume')\n      );\n      groupingAction('group', 'neume', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('groupNeumes').addEventListener('click', () => {\n      const elementIds = getIds();\n      groupingAction('group', 'neume', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('groupNcs').addEventListener('click', () => {\n      const elementIds = getIds();\n      groupingAction('group', 'nc', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('ungroupNeumes').addEventListener('click', () => {\n      const elementIds = getChildrenIds();\n      groupingAction('ungroup', 'neume', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('ungroupNcs').addEventListener('click', () => {\n      const elementIds = getChildrenIds();\n      groupingAction('ungroup', 'nc', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('toggle-ligature').addEventListener('click', async () => {\n      const elementIds = getIds();\n      let isLigature;\n      const ligatureRegex = /#E99[016]/;\n      if (!ligatureRegex.test(document.getElementById(elementIds[0]).children[0].getAttribute('xlink:href'))) { // SMUFL codes for ligature glyphs\n        isLigature = true;\n      } else {\n        isLigature = false;\n        const chainAction: EditorAction = { 'action': 'chain',\n          'param': [\n            unsetInclinatumAction(elementIds[0]), unsetVirgaAction(elementIds[0]),\n            unsetInclinatumAction(elementIds[1]), unsetVirgaAction(elementIds[1])\n          ] };\n        await neonView.edit(chainAction, neonView.view.getCurrentPageURI());\n      }\n\n      const editorAction: EditorAction = {\n        'action': 'toggleLigature',\n        'param': {\n          'elementIds': elementIds,\n          'isLigature': isLigature.toString()\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Ligature Toggled');\n        } else {\n          Notification.queueNotification('Ligature Toggle Failed');\n        }\n        endGroupingSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('toggle-link').addEventListener('click', () => {\n      const elementIds = getIds();\n      const chainAction: EditorAction = {\n        'action': 'chain',\n        'param': []\n      };\n      const param = new Array<EditorAction>();\n      if (document.getElementById(elementIds[0]).getAttribute('mei:precedes')) {\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[0],\n            'attrType': 'precedes',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[1],\n            'attrType': 'follows',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'setText',\n          'param': {\n            'elementId': elementIds[1],\n            'text': ''\n          }\n        });\n      } else if (document.getElementById(elementIds[0]).getAttribute('mei:follows')) {\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[0],\n            'attrType': 'follows',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[1],\n            'attrType': 'precedes',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'setText',\n          'param': {\n            'elementId': elementIds[0],\n            'text': ''\n          }\n        });\n      } else {\n        // Associate syllables. Will need to find which is first. Use staves.\n        const syllable0 = document.getElementById(elementIds[0]);\n        const syllable1 = document.getElementById(elementIds[1]);\n        const staff0 = syllable0.closest('.staff');\n        const staff1 = syllable1.closest('.staff');\n        const staffChildren = Array.from(staff0.parentElement.children).filter((elem: HTMLElement) => elem.classList.contains('staff'));\n\n        let firstSyllable, secondSyllable;\n        // Determine first syllable comes first by staff\n        if (staffChildren.indexOf(staff0) < staffChildren.indexOf(staff1)) {\n          firstSyllable = syllable0;\n          secondSyllable = syllable1;\n        } else {\n          firstSyllable = syllable1;\n          secondSyllable = syllable0;\n        }\n\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': firstSyllable.id,\n            'attrType': 'precedes',\n            'attrValue': secondSyllable.id\n          }\n        });\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': secondSyllable.id,\n            'attrType': 'follows',\n            'attrValue': firstSyllable.id\n          }\n        });\n        // Delete syl on second syllable\n        const syl = secondSyllable.querySelector('.syl');\n        if (syl !== null) {\n          param.push({\n            'action': 'remove',\n            'param': {\n              'elementId': syl.id\n            }\n          });\n        }\n      }\n      chainAction.param = param;\n      neonView.edit(chainAction, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Toggled Syllable Link');\n        } else {\n          Notification.queueNotification('Failed to Toggle Syllable Link');\n        }\n        endGroupingSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  } catch (e) {}\n}\n\n/**\n * Form and execute a group/ungroup action.\n * @param action - The action to execute. Either \"group\" or \"ungroup\".\n * @param groupType - The type of elements to group. Either \"neume\" or \"nc\".\n * @param elementIds - The IDs of the elements.\n */\nfunction groupingAction (action: string, groupType: string, elementIds: string[]): void {\n  const editorAction: EditorAction = {\n    'action': action,\n    'param': {\n      'groupType': groupType,\n      'elementIds': elementIds\n    }\n  };\n  neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then((result) => {\n    if (result) {\n      if (action === 'group') {\n        Notification.queueNotification('Grouping Success');\n      } else {\n        Notification.queueNotification('Ungrouping Success');\n      }\n    } else {\n      if (action === 'group') {\n        Notification.queueNotification('Grouping Failed');\n      } else {\n        Notification.queueNotification('Ungrouping Failed');\n      }\n    }\n    neonView.updateForCurrentPage();\n\n    // Prompt user to confirm if Neon does not re cognize contour\n    if (groupType === 'nc') {\n      const neumeParent = document.getElementById(elementIds[0]).parentElement;\n      const ncs = Array.from(neumeParent.children) as SVGGraphicsElement[];\n      const contour = neonView.info.getContour(ncs);\n      if (contour === undefined) {\n        Warnings.groupingNotRecognized();\n      }\n    }\n    endGroupingSelection();\n  });\n}\n\n/**\n * Get the IDs of selected elements.\n */\nfunction getIds (): string[] {\n  const ids = [];\n  const elements = Array.from(document.getElementsByClassName('selected'));\n  elements.forEach(el => {\n    ids.push(el.id);\n  });\n  return ids;\n}\n\n/**\n * Get the IDs of the selected elements' children.\n */\nfunction getChildrenIds (): string[] {\n  const childrenIds = [];\n  const elements = Array.from(document.getElementsByClassName('selected'));\n  elements.forEach(el => {\n    const children = Array.from(el.children);\n    children.forEach(ch => {\n      childrenIds.push(ch.id);\n    });\n  });\n  return childrenIds;\n}\n","import { getStaffBBox, selectBBox, selectStaff } from './SelectTools';\nimport NeonView from '../NeonView';\nimport DragHandler from './DragHandler';\n\nimport * as d3 from 'd3';\n\n/**\n * Resize a staff or a syllable text bounding box.\n * For staves, this also supports adjusting the skew.\n */\ntype Point = { x: number; y: number; name: number };\n\n/**\n * The points you can click and drag to resize\n */\nconst PointNames = {\n  TopLeft: 0,\n  Top: 1,\n  TopRight: 2,\n  Right: 3,\n  BottomRight: 4,\n  Bottom: 5,\n  BottomLeft: 6,\n  Left: 7\n};\n\nexport function resize (element: SVGGraphicsElement, neonView: NeonView, dragHandler: DragHandler): void {\n  /**\n   * The upper-left x-coordinate of the element.\n   */\n  let ulx: number;\n  /**\n   * The upper-left y-coordinate of the element.\n   */\n  let uly: number;\n  /**\n   * The lower-right x-coordinate of the element.\n   */\n  let lrx: number;\n  /**\n   * The lower-right y-coordinate of the element.\n   */\n  let lry: number;\n\n  /**\n   * The skew of the rect in radians.\n   */\n  let skew: number;\n\n  let initialPoint: number[], initialUly: number, initialLry: number, whichSkewPoint: string,\n    initialY: number, initialRectY: number, polyLen: number, dy: number, initialSkew: number;\n\n  drawInitialRect();\n  /**\n   * Draw the initial rectangle around the element\n   * and add the listeners to support dragging to resize.\n   */\n  function drawInitialRect (): void {\n    if (element === null) return;\n\n    // if it's a boundingbox just get the coordinates\n    if (element.classList.contains('syl')) {\n      const rect = element.querySelector('.sylTextRect-display');\n      if (rect === null) {\n        console.warn('Tried to draw resize rect for a sylTextRect that doesn\\'t exist (or isn\\'t displaying)');\n        return;\n      }\n      ulx = Number(rect.getAttribute('x'));\n      uly = Number(rect.getAttribute('y'));\n      lrx = +ulx + +rect.getAttribute('width');\n      lry = +uly + +rect.getAttribute('height');\n\n      skew = 0;\n    }\n\n    // if it's a staff use the paths to get it's boundingbox\n    if (element.classList.contains('staff')) {\n      const bbox = getStaffBBox(element);\n      ulx = bbox.ulx;\n      uly = bbox.uly;\n      lrx = bbox.lrx;\n      lry = bbox.lry;\n\n      const coordinates: number[] = element.querySelector('path')\n        .getAttribute('d')\n        .match(/\\d+/g)\n        .map(element => Number(element));\n      skew = Math.atan((coordinates[3] - coordinates[1]) /\n        (coordinates[2] - coordinates[0]));\n    }\n\n    let whichPoint: string;\n\n    const points: Array<Point> = [\n      { x: ulx, y: uly, name: PointNames.TopLeft },\n      { x: (ulx + lrx) / 2, y: uly + (lrx - ulx) / 2 * Math.sin(skew), name: PointNames.Top },\n      { x: lrx, y: uly + (lrx - ulx) * Math.sin(skew), name: PointNames.TopRight },\n      { x: lrx, y: (uly + lry + (lrx - ulx) * Math.sin(skew)) / 2, name: PointNames.Right },\n      { x: lrx, y: lry, name: PointNames.BottomRight },\n      { x: (ulx + lrx) / 2, y: lry - (lrx - ulx) / 2 * Math.sin(skew), name: PointNames.Bottom },\n      { x: ulx, y: lry - (lrx - ulx) * Math.sin(skew), name: PointNames.BottomLeft },\n      { x: ulx, y: (uly + lry - (lrx - ulx) * Math.sin(skew)) / 2, name: PointNames.Left }\n    ];\n\n    polyLen = points[2].x - points[0].x;\n\n    const pointString = points.filter((_elem, index) => { return index % 2 === 0; })\n      .map(elem => elem.x + ',' + elem.y)\n      .join(' ');\n\n    d3.select('#' + element.id).append('polygon')\n      .attr('points', pointString)\n      .attr('id', 'resizeRect')\n      .attr('stroke', 'black')\n      .attr('stroke-width', 10)\n      .attr('fill', 'none')\n      .style('cursor', 'move')\n      .style('stroke-dasharray', '20 10');\n\n    for (const pointName in PointNames) {\n      const point: Point = points[PointNames[pointName]];\n      d3.select(element.viewportElement).append('circle')\n        .attr('cx', point.x)\n        .attr('cy', point.y)\n        .attr('r', 25)\n        .attr('stroke', 'black')\n        .attr('stroke-width', 4)\n        .attr('fill', '#0099ff')\n        .attr('class', 'resizePoint')\n        .attr('id', 'p-' + pointName);\n    }\n\n    // do it as a loop instead of selectAll so that you can easily know which point was\n    for (const name in PointNames) {\n      d3.select('#p-' + name).filter('.resizePoint').call(\n        d3.drag()\n          .on('start', () => { resizeStart(name); })\n          .on('drag', resizeDrag)\n          .on('end', resizeEnd.bind(this)));\n    }\n\n    if (element.classList.contains('staff')) {\n      let x = points[3].x;\n      let y = points[3].y;\n      const pointStringRight = (x + 100) + ',' + (y + 85) + ' ' +\n        (x + 70) + ',' + (y + 50) + ' ' + (x + 100) + ',' + (y + 15) + ' ' + (x + 130) + ',' + (y + 50);\n      x = points[7].x;\n      y = points[7].y;\n      const pointStringLeft = (x - 100) + ',' + (y - 15) + ' ' +\n        (x - 130) + ',' + (y - 50) + ' ' + (x - 100) + ',' + (y - 85) + ' ' + (x - 70) + ',' + (y - 50);\n\n      d3.select('#' + element.id).append('polygon')\n        .attr('points', pointStringRight)\n        .attr('id', 'skewRight')\n        .attr('stroke', 'black')\n        .attr('stroke-width', 7)\n        .attr('fill', '#0099ff')\n        .attr('class', 'skewPoint');\n\n      d3.select('#' + element.id).append('polygon')\n        .attr('points', pointStringLeft)\n        .attr('id', 'skewLeft')\n        .attr('stroke', 'black')\n        .attr('stroke-width', 7)\n        .attr('fill', '#0099ff')\n        .attr('class', 'skewPoint');\n\n      d3.select('#skewLeft').call(\n        d3.drag()\n          .on('start', skewStart)\n          .on('drag', skewDragLeft)\n          .on('end', skewEnd));\n\n      d3.select('#skewRight').call(\n        d3.drag()\n          .on('start', skewStart)\n          .on('drag', skewDragRight)\n          .on('end', skewEnd));\n    }\n\n    function skewStart (): void {\n      let which = d3.event.sourceEvent.target.id;\n      const polygon = d3.select('#' + which);\n      const points = polygon.attr('points');\n      whichSkewPoint = which;\n      initialY = d3.mouse(this)[1];\n      initialRectY = (which === 'skewRight' ? lry : uly);\n      initialSkew = skew;\n    }\n\n    function skewDragLeft (): void {\n      const currentY = d3.mouse(this)[1];\n      const temp = currentY - initialY;\n      const tempSkew = initialSkew - Math.atan(temp / polyLen);\n      if (tempSkew > -0.2 && tempSkew < 0.2) {\n        dy = temp;\n        uly = initialRectY + dy;\n        skew = tempSkew;\n      }\n      redraw();\n    }\n\n    function skewDragRight (): void {\n      const currentY = d3.mouse(this)[1];\n      const temp = currentY - initialY;\n      const tempSkew = initialSkew + Math.atan(temp / polyLen);\n      if (tempSkew > -0.2 && tempSkew < 0.2) {\n        dy = temp;\n        skew = tempSkew;\n        lry = initialRectY + dy;\n      }\n      redraw();\n    }\n\n    function skewEnd (): void {\n      if (dy === undefined) {\n        dy = 0;\n      }\n      const editorAction = {\n        'action': 'changeSkew',\n        'param': {\n          'elementId': element.id,\n          'dy': dy,\n          'rightSide': (whichSkewPoint === 'skewRight')\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then(async (result) => {\n        if (result) {\n          await neonView.updateForCurrentPagePromise();\n        }\n        element = document.getElementById(element.id) as unknown as SVGGraphicsElement;\n        ulx = undefined;\n        uly = undefined;\n        lrx = undefined;\n        lry = undefined;\n        dy = undefined;\n        drawInitialRect();\n        if (element.classList.contains('syl')) {\n          selectBBox(element.querySelector('.sylTextRect-display'), dragHandler, this);\n        } else {\n          selectStaff(element, dragHandler);\n        }\n      });\n    }\n\n    function resizeStart (name: string): void {\n      whichPoint = name;\n      const point = points.find(point => { return point.name === PointNames[name]; });\n      initialPoint = [point.x, point.y];\n      initialUly = uly;\n      initialLry = lry;\n    }\n\n    function resizeDrag (): void {\n      const currentPoint = d3.mouse(this);\n      switch (PointNames[whichPoint]) {\n        case PointNames.TopLeft:\n          ulx = currentPoint[0];\n          uly = currentPoint[1];\n          break;\n        case PointNames.Top:\n          uly = currentPoint[1] - (lrx - ulx) * Math.tan(skew) / 2;\n          break;\n        case PointNames.TopRight:\n          lrx = currentPoint[0];\n          uly = currentPoint[1] - (lrx - ulx) * Math.tan(skew);\n          break;\n        case PointNames.Right:\n          lrx = currentPoint[0];\n          lry = initialLry + (currentPoint[0] - initialPoint[0]) * Math.tan(skew);\n          break;\n        case PointNames.BottomRight:\n          lrx = currentPoint[0];\n          lry = currentPoint[1];\n          break;\n        case PointNames.Bottom:\n          lry = currentPoint[1] + (lrx - ulx) * Math.tan(skew) / 2;\n          break;\n        case PointNames.BottomLeft:\n          ulx = currentPoint[0];\n          lry = currentPoint[1] + (lrx - ulx) * Math.tan(skew);\n          break;\n        case PointNames.Left:\n          ulx = currentPoint[0];\n          uly = initialUly + (currentPoint[0] - initialPoint[0]) * Math.tan(skew);\n          break;\n        default:\n          console.error('Something that wasn\\'t a side of the rectangle was dragged. This shouldn\\'t happen.');\n      }\n      redraw();\n    }\n\n    function resizeEnd (): void {\n      const editorAction = {\n        'action': 'resize',\n        'param': {\n          'elementId': element.id,\n          'ulx': ulx,\n          'uly': uly,\n          'lrx': lrx,\n          'lry': lry\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then(async (result) => {\n        if (result) {\n          await neonView.updateForCurrentPagePromise();\n        }\n        element = document.getElementById(element.id) as unknown as SVGGraphicsElement;\n        ulx = undefined;\n        uly = undefined;\n        lrx = undefined;\n        lry = undefined;\n        d3.selectAll('.resizePoint').remove();\n        d3.selectAll('#resizeRect').remove();\n        d3.selectAll('.skewPoint').remove();\n        drawInitialRect();\n        if (element.classList.contains('syl')) {\n          selectBBox(element.querySelector('.sylTextRect-display'), dragHandler, this);\n        } else {\n          try {\n            document.getElementById('moreEdit').innerHTML = '';\n            document.getElementById('moreEdit').classList.add('is-invisible');\n          } catch (e) {}\n        }\n      });\n    }\n  }\n\n  /**\n   * Redraw the rectangle with the new bounds\n   */\n  function redraw (): void {\n    const points: Point[] = [\n      { x: ulx, y: uly, name: PointNames.TopLeft },\n      { x: (ulx + lrx) / 2, y: uly + (lrx - ulx) / 2 * Math.sin(skew), name: PointNames.Top },\n      { x: lrx, y: uly + (lrx - ulx) * Math.sin(skew), name: PointNames.TopRight },\n      { x: lrx, y: (uly + lry + (lrx - ulx) * Math.sin(skew)) / 2, name: PointNames.Right },\n      { x: lrx, y: lry, name: PointNames.BottomRight },\n      { x: (ulx + lrx) / 2, y: lry - (lrx - ulx) / 2 * Math.sin(skew), name: PointNames.Bottom },\n      { x: ulx, y: lry - (lrx - ulx) * Math.sin(skew), name: PointNames.BottomLeft },\n      { x: ulx, y: (uly + lry - (lrx - ulx) * Math.sin(skew)) / 2, name: PointNames.Left }\n    ];\n\n    const pointString: string = points.filter((_elem, index) => { return index % 2 === 0; })\n      .map(elem => elem.x + ',' + elem.y)\n      .join(' ');\n\n    d3.select('#resizeRect').attr('points', pointString);\n\n    for (const pointName in PointNames) {\n      const point: Point = points[PointNames[pointName]];\n      d3.select('#p-' + pointName).filter('.resizePoint')\n        .attr('cx', point.x)\n        .attr('cy', point.y);\n    }\n\n    let x = points[3].x;\n    let y = points[3].y;\n    const pointStringRight = (x + 100) + ',' + (y + 85) + ' ' +\n      (x + 70) + ',' + (y + 50) + ' ' + (x + 100) + ',' + (y + 15) + ' ' + (x + 130) + ',' + (y + 50);\n    x = points[7].x;\n    y = points[7].y;\n    const pointStringLeft = (x - 100) + ',' + (y - 15) + ' ' +\n      (x - 130) + ',' + (y - 50) + ' ' + (x - 100) + ',' + (y - 85) + ' ' + (x - 70) + ',' + (y - 50);\n\n    d3.select('#skewLeft').attr('points', pointStringLeft);\n    d3.select('#skewRight').attr('points', pointStringRight);\n  }\n}\n","import NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport * as d3 from 'd3';\n\n/**\n * Class that handles insert mode, events, and actions.\n */\nclass InsertHandler {\n  type: string;\n  firstClick = true;\n  coord: DOMPoint;\n  attributes: object;\n  selector: string;\n  neonView: NeonView;\n\n  constructor (neonView: NeonView, sel: string) {\n    this.neonView = neonView;\n    this.selector = sel;\n  }\n\n  /**\n   * Called when an insert button is clicked.\n   * Triggers the start of insert mode.\n   * @param buttonId - The ID of the button that was clicked.\n   */\n  insertActive (buttonId: string): void {\n    const alreadyInInsertMode = this.isInsertMode();\n    switch (buttonId) {\n      case 'punctum':\n        this.type = 'nc';\n        this.attributes = null;\n        break;\n      case 'diamond':\n        this.type = 'nc';\n        this.attributes = { 'tilt': 'se' };\n        break;\n      case 'virga':\n        this.type = 'nc';\n        this.attributes = { 'tilt': 'n' };\n        break;\n      case 'pes':\n      case 'clivis':\n      case 'scandicus':\n      case 'climacus':\n      case 'torculus':\n      case 'porrectus':\n      case 'pressus':\n        const contour = this.neonView.info.getContourByValue(\n          buttonId.charAt(0).toUpperCase() + buttonId.slice(1)\n        );\n        this.type = 'grouping';\n        this.attributes = { 'contour': contour };\n        break;\n      case 'cClef':\n      case 'fClef':\n        this.type = 'clef';\n        this.attributes = { 'shape': buttonId.charAt(0).toUpperCase() };\n        break;\n      case 'custos':\n        this.type = 'custos';\n        this.attributes = null;\n        break;\n      case 'staff':\n        this.type = 'staff';\n        this.attributes = null;\n        break;\n      default:\n        this.type = '';\n        this.attributes = null;\n        console.error('Invalid button for insertion: ' + buttonId + '.');\n        return;\n    }\n\n    this.removeInsertClickHandlers();\n    if (this.type === 'staff') {\n      document.querySelector(this.selector)\n        .addEventListener('click', this.staffHandler);\n    } else {\n      document.querySelector(this.selector)\n        .addEventListener('click', this.handler);\n    }\n\n    // Disable edit mode listeners\n    document.body.addEventListener('keydown', this.keydownListener);\n    document.body.addEventListener('keyup', this.resetInsertHandler);\n    document.body.addEventListener('click', this.clickawayHandler);\n\n    // Add 'return to edit mode' button\n    if (!alreadyInInsertMode) {\n      const editModeButton = document.createElement('button');\n      editModeButton.id = 'returnToEditMode';\n      editModeButton.classList.add('button');\n      editModeButton.innerHTML = 'Return to Edit Mode';\n      document.getElementById('redo').parentNode.appendChild(editModeButton);\n      editModeButton.addEventListener('click', this.insertDisabled);\n    }\n    const editMenu = document.getElementById('editMenu');\n    editMenu.style.backgroundColor = 'whitesmoke';\n    editMenu.style.fontWeight = '';\n    const insertMenu = document.getElementById('insertMenu');\n    insertMenu.style.backgroundColor = '#ffc7c7';\n    insertMenu.style.fontWeight = 'bold';\n  }\n\n  /**\n   * Disable insert mode and remove event listeners.\n   */\n  insertDisabled = (function insertDisabled (): void {\n    this.type = '';\n    this.removeInsertClickHandlers();\n    document.body.removeEventListener('keydown', this.keydownListener);\n    document.body.removeEventListener('keyup', this.resetInsertHandler);\n    document.body.removeEventListener('click', this.clickawayHandler);\n    document.querySelector('.insertel.is-active').classList.remove('is-active');\n    this.firstClick = true;\n    try {\n      document.getElementById('returnToEditMode').remove();\n    } catch (e) {\n      // console.debug(e);\n    }\n    const editMenu = document.getElementById('editMenu');\n    const insertMenu = document.getElementById('insertMenu');\n    editMenu.style.backgroundColor = '#ffc7c7';\n    editMenu.style.fontWeight = 'bold';\n    insertMenu.style.backgroundColor = 'whitesmoke';\n    insertMenu.style.fontWeight = '';\n  }).bind(this);\n\n  /**\n   * Event handler to handle a user clicking away from the active page\n   * causing insert mode to end.\n   */\n  clickawayHandler = (function clickawayHandler (evt: MouseEvent): void {\n    const target = evt.target as HTMLElement;\n    if (target.closest('.active-page') === null &&\n      target.closest('#insert_controls') === null &&\n      target.closest('#svg_group') === null) {\n      this.insertDisabled();\n      document.body.removeEventListener('keydown',\n        this.staffHandler);\n      document.body.removeEventListener('keydown',\n        this.handler);\n    }\n  }).bind(this);\n\n  /**\n   * Resets an insert event listener after temporarily removing it.\n   */\n  resetInsertHandler = (function resetInsertHandler (evt: KeyboardEvent): void {\n    if (evt.key === 'Shift') {\n      document.querySelector(this.selector)\n        .addEventListener('click', this.type === 'staff' ?\n          this.staffHandler : this.handler);\n    }\n  }).bind(this);\n\n  /**\n   * Listens to key presses to either exit edit mode (if Escape) or\n   * temporarily remove insert event listeners (if Shift).\n   */\n  keydownListener = (function keydownListener (evt: KeyboardEvent): void {\n    if (evt.key === 'Escape') {\n      this.insertDisabled();\n      document.body.removeEventListener('keydown', this.staffHandler);\n      document.body.removeEventListener('keydown', this.handler);\n    } else if (evt.key === 'Shift') {\n      this.removeInsertClickHandlers();\n    }\n  }).bind(this);\n\n  /**\n   * Event handler for clicking to insert any element except a staff.\n   */\n  handler = (function handler (evt: MouseEvent): void {\n    evt.stopPropagation();\n    const container = document.getElementsByClassName('active-page')[0].getElementsByClassName('definition-scale')[0] as SVGSVGElement;\n    const pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n    // Transform pt to SVG context\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGraphicsElement).getScreenCTM();\n    const cursorpt = pt.matrixTransform(transformMatrix.inverse());\n\n    const editorAction: EditorAction = {\n      'action': 'insert',\n      'param': {\n        'elementType': this.type,\n        'staffId': 'auto',\n        'ulx': cursorpt.x,\n        'uly': cursorpt.y\n      }\n    };\n\n    if (this.attributes !== null) {\n      editorAction['param']['attributes'] = this.attributes;\n      if (this.attributes['shape'] === 'F') {\n        editorAction['param']['ulx'] -= 50;\n      }\n    }\n\n    this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then(() => {\n      return this.neonView.updateForCurrentPagePromise();\n    }).then(() => {\n      document.querySelector(this.selector).addEventListener('click', this.handler);\n    });\n  }).bind(this);\n\n  /**\n   * Event handler to insert a staff.\n   */\n  staffHandler = (function staffHandler (evt: MouseEvent): void {\n    const container = document.getElementsByClassName('active-page')[0].getElementsByClassName('definition-scale')[0] as SVGSVGElement;\n    const pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGraphicsElement).getScreenCTM();\n    const cursorpt = pt.matrixTransform(transformMatrix.inverse());\n\n    if (this.firstClick) {\n      this.coord = cursorpt;\n      d3.select(container).append('circle').attr('cx', cursorpt.x)\n        .attr('cy', cursorpt.y)\n        .attr('r', 10)\n        .attr('id', 'staff-circle')\n        .attr('fill', 'green');\n      this.firstClick = false;\n    } else {\n      let ul, lr;\n      if (cursorpt.x < this.coord.x || cursorpt.y < this.coord.y) { // second point is not lr\n        ul = cursorpt;\n        lr = this.coord;\n      } else {\n        ul = this.coord;\n        lr = cursorpt;\n      }\n      document.getElementById('staff-circle').remove();\n      const action: EditorAction = {\n        'action': 'insert',\n        'param': {\n          'elementType': 'staff',\n          'staffId': 'auto',\n          'ulx': ul.x,\n          'uly': ul.y,\n          'lrx': lr.x,\n          'lry': lr.y\n        }\n      };\n\n      this.neonView.edit(action, this.neonView.view.getCurrentPageURI()).then(() => {\n        this.neonView.updateForCurrentPage();\n        this.firstClick = true;\n      });\n    }\n  }).bind(this);\n\n  /**\n   * Remove the insert listeners while not leaving insert mode entirely.\n   */\n  removeInsertClickHandlers = (function removeInsertClickHandlers (): void {\n    document.querySelector(this.selector).removeEventListener('click', this.staffHandler);\n    document.querySelector(this.selector).removeEventListener('click', this.handler);\n  }).bind(this);\n\n  isInsertMode (): boolean {\n    return (this.type !== '');\n  }\n}\nexport { InsertHandler as default };\n","import NeonView from '../../src/NeonView';\nimport DisplayPanel from '../../src/DisplayPanel/DisplayPanel';\nimport DivaView from '../../src/DivaView';\nimport SingleView from '../../src/SingleView/SingleView';\nimport DivaEdit from '../../src/SquareEdit/DivaEditMode';\nimport SingleEditMode from '../../src/SquareEdit/SingleEditMode';\nimport InfoModule from '../../src/InfoModule';\nimport TextView from '../../src/TextView';\nimport TextEditMode from '../../src/TextEditMode';\n\nimport PouchDB from 'pouchdb';\n\nlet name = getGetParam('manifest');\nlet manifestLocation = 'manifests/' + name + '.jsonld';\nlet storage = getGetParam('storage');\n\nif (name) {\n  window.fetch(manifestLocation).then(response => {\n    if (response.ok) {\n      return response.text();\n    } else {\n      throw new Error(response.statusText);\n    }\n  }).then(async text => {\n    let manifest;\n    try {\n      manifest = JSON.parse(text);\n    } catch (e) {\n      console.error(e);\n      console.debug(text);\n      return;\n    }\n    let params = {\n      manifest: manifest,\n      Display: DisplayPanel,\n      Info: InfoModule,\n      TextView: TextView,\n      TextEdit: TextEditMode\n    };\n    // Determine if it is a single page or multiple by media type\n    let mediaType = await new Promise((resolve, reject) => {\n      window.fetch(manifest.image).then(response => {\n        resolve(response.headers.get('Content-Type'));\n      }).catch(err => {\n        reject(err);\n      });\n    });\n    if (mediaType.match(/image\\/*/)) {\n      params.View = SingleView;\n      params.NeumeEdit = SingleEditMode;\n    } else {\n      params.View = DivaView;\n      params.NeumeEdit = DivaEdit;\n    }\n\n    var view = new NeonView(params);\n    view.start();\n  });\n} else {\n  let db = new PouchDB('Neon-User-Storage');\n  db.getAttachment(storage, 'manifest').then(blob => {\n    return new window.Response(blob).json();\n  }).then(async manifest => {\n    console.log(manifest);\n    let params = {\n      manifest: manifest,\n      Display: DisplayPanel,\n      Info: InfoModule,\n      TextView: TextView,\n      TextEdit: TextEditMode\n    };\n\n    let mediaType = await new Promise((resolve, reject) => {\n      window.fetch(manifest.image).then(response => {\n        resolve(response.headers.get('Content-Type'));\n      }).catch(err => {\n        reject(err);\n      });\n    });\n    if (mediaType.match(/image\\/*/)) {\n      params.View = SingleView;\n      params.NeumeEdit = SingleEditMode;\n    } else {\n      params.View = DivaView;\n      params.NeumeEdit = DivaEdit;\n    }\n\n    var view = new NeonView(params);\n    view.start();\n  });\n}\n\nfunction getGetParam (paramName) {\n  let result = null;\n\n  let tmp = [];\n  window.location.search\n    .substr(1)\n    .split('&')\n    .forEach((item) => {\n      tmp = item.split('=');\n      if (tmp[0] === paramName) {\n        result = decodeURIComponent(tmp[1]);\n      }\n    });\n  return result;\n}\n","import { convertSbToStaff } from './utils/ConvertMei';\nimport * as Validation from './Validation';\nimport VerovioWrapper from './VerovioWrapper';\nimport { WebAnnotation, Attributes, EditorAction, NeonManifest, VerovioMessage } from './Types';\nimport { uuidv4 } from './utils/random';\n\nimport PouchDB from 'pouchdb';\n\ninterface CacheEntry {\n  dirty: boolean;\n  mei: string;\n  svg: SVGSVGElement;\n}\n\n/**\n * The core component of Neon. This manages the database,\n * the verovio toolkit, the cache, and undo/redo stacks.\n */\nclass NeonCore {\n  /** Wrapper for the Verovio WebWorker. */\n  private verovioWrapper: VerovioWrapper;\n  /** Stacks of actions that can be undone per page. */\n  private undoStacks: Map<string, string[]>;\n  /** Stacks of actions that can be redone per page. */\n  private redoStacks: Map<string, string[]>;\n  /** Cache containing entries for each page. */\n  private neonCache: Map<string, CacheEntry>;\n  private db: PouchDB.Database;\n  private parser: DOMParser;\n  /** Pages known not to have any associated MEI. */\n  private blankPages: Array<string>;\n  /** A collection of W3 Web Annotations. */\n  private annotations: WebAnnotation[];\n  private manifest: NeonManifest;\n  private lastPageLoaded: string;\n\n  getAnnotations (): WebAnnotation[] { return this.annotations; }\n\n  /**\n   * Constructor for NeonCore\n   */\n  constructor (manifest: NeonManifest) {\n    this.verovioWrapper = new VerovioWrapper();\n    Validation.init();\n\n    /**\n     * Stacks of previous MEI files representing actions that can be undone for each page.\n     * @type {Map.<string, Array.<string>>}\n     */\n    this.undoStacks = new Map<string, string[]>();\n\n    /**\n     * Stacks of previous MEI files representing actions that can be redone for each page.\n     * @type {Map.<string, Array.<string>>}\n     */\n    this.redoStacks = new Map();\n\n    this.neonCache = new Map();\n\n    this.parser = new DOMParser();\n\n    this.db = new PouchDB('Neon');\n\n    this.blankPages = [];\n\n    // Add each MEI to the database\n    this.manifest = manifest;\n    this.annotations = manifest.mei_annotations;\n    this.lastPageLoaded = '';\n  }\n\n  /**\n   * Initialize the PouchDb database based on the provided manifest.\n   * If a newer version already exists in the database, this will\n   * not update the database unless forced.\n   * @param force - If a database update should be forced.\n   */\n  async initDb (force = false): Promise<{}> {\n    // Check for existing manifest\n    type DbAnnotation = PouchDB.Core.IdMeta & PouchDB.Core.GetMeta & WebAnnotation;\n    type Doc = PouchDB.Core.IdMeta & PouchDB.Core.GetMeta & { timestamp: string; annotations: string[]};\n    const response = await new Promise<{}>((resolve, reject): void => {\n      this.db.get(this.manifest['@id']).catch(err => {\n        if (err.name === 'not_found') {\n          // This is a new document.\n          const doc = {\n            _id: this.manifest['@id'],\n            timestamp: this.manifest.timestamp,\n            image: this.manifest.image,\n            title: this.manifest.title,\n            annotations: []\n          };\n          this.annotations.forEach(annotation => {\n            doc.annotations.push(annotation.id);\n          });\n          return doc;\n        } else {\n          console.error(err);\n          return reject(err);\n        }\n      }).then(async (doc: Doc) => {\n        // Check if doc timestamp is newer than manifest\n        const docTime = (new Date(doc.timestamp)).getTime();\n        const manTime = (new Date(this.manifest.timestamp)).getTime();\n        if (docTime > manTime) {\n          if (!force) {\n            // Fill annotations list with db annotations\n            this.annotations = [];\n            doc.annotations.forEach(async (id: string) => {\n              await this.db.get(id).then((annotation: DbAnnotation) => {\n                this.annotations.push({\n                  id: annotation._id,\n                  type: 'Annotation',\n                  body: annotation.body,\n                  target: annotation.target\n                });\n              }).catch(err => {\n                console.error(err);\n              });\n            });\n            return resolve(false);\n          }\n        }\n        for (const annotation of this.annotations) {\n          // Add annotations to database\n          await this.db.get(annotation.id).catch(err => {\n            if (err.name === 'not_found') {\n              return {\n                _id: annotation.id\n              };\n            } else {\n              console.error(err);\n              return reject(err);\n            }\n          }).then((newAnnotation: DbAnnotation) => {\n            newAnnotation.body = annotation.body;\n            newAnnotation.target = annotation.target;\n            return this.db.put(newAnnotation);\n          }).catch(err => {\n            reject(err);\n            console.error(err);\n          });\n        }\n        return this.db.put(doc);\n      }).then(() => {\n        return resolve(true);\n      }).catch(err => {\n        reject(err);\n        console.error(err);\n      });\n    });\n\n    return response;\n  }\n\n  /**\n   * Load a page into the verovio toolkit. This will fetch the\n   * page from the cache or from the database.\n   * @param pageURI - The URI of the selected page.\n   */\n  loadPage (pageURI: string): Promise<CacheEntry> {\n    return new Promise((resolve, reject): void => {\n      if (this.lastPageLoaded === pageURI && this.neonCache.has(pageURI)) {\n        resolve(this.neonCache.get(pageURI));\n      } else if (this.neonCache.has(pageURI)) {\n        this.loadData(pageURI, this.neonCache.get(pageURI).mei).then(() => {\n          resolve(this.neonCache.get(pageURI));\n        });\n      } else if (this.blankPages.includes(pageURI)) {\n        Validation.blankPage();\n        const e = new Error('No MEI file for page ' + pageURI);\n        e.name = 'missing_mei';\n        reject(e);\n      } else {\n        // Find annotation\n        const annotation = this.annotations.find(elem => {\n          return elem.target === pageURI;\n        });\n        if (annotation) {\n          window.fetch(annotation.body).then(response => {\n            if (response.ok) {\n              return response.text();\n            } else {\n              throw new Error(response.statusText);\n            }\n          }).then(data => {\n            // Check if the MEI file is sb-based. If so, convert to staff-based.\n            if (data.match(/<sb .+>/)) {\n              data = convertSbToStaff(data);\n            }\n            this.loadData(pageURI, data).then(() => {\n              resolve(this.neonCache.get(pageURI));\n            });\n          }).catch(err => {\n            reject(err);\n          });\n        } else {\n          Validation.blankPage();\n          this.blankPages.push(pageURI);\n        }\n      }\n    });\n  }\n\n  /**\n   * Load data into the verovio toolkit and update the cache.\n   * @param pageURI - The URI of the selected page.\n   * @param data - The MEI of the page as a string.\n   * @param dirty - If the cache entry should be marked as dirty.\n   */\n  loadData (pageURI: string, data: string, dirty = false): Promise<void> {\n    Validation.sendForValidation(data);\n    this.lastPageLoaded = pageURI;\n    /* A promise is returned that will resolve to the result of the action.\n     * However the value that is must return comes from the Web Worker and\n     * information passed between the worker and main context much be in a\n     * message. So an event handler is put on verovioWrapper for when a message\n     * is receieved from the worker. Then a message is sent to the worker to\n     * take an action. A response is sent back and the previously mentioned\n     * event handler handles the response. Since it is defined within the\n     * promise it has access to the necessary resolve function.\n     */\n    return new Promise((resolve): void => {\n      const message: VerovioMessage = {\n        id: uuidv4(),\n        action: 'renderData',\n        mei: data\n      };\n      function handle (evt: MessageEvent): void {\n        if (evt.data.id === message.id) {\n          const svg = this.parser.parseFromString(\n            evt.data.svg,\n            'image/svg+xml'\n          ).documentElement;\n          this.neonCache.set(pageURI, {\n            svg: svg,\n            mei: data,\n            dirty: dirty\n          });\n          evt.target.removeEventListener('message', handle);\n          resolve();\n        }\n      }\n      this.verovioWrapper.addEventListener('message', handle.bind(this));\n      this.verovioWrapper.postMessage(message);\n    });\n  }\n\n  /**\n   * Get the SVG for a specific page.\n   * @param pageURI - The URI of the selected page.\n   */\n  getSVG (pageURI: string): Promise<SVGSVGElement> {\n    return new Promise((resolve, reject): void => {\n      this.loadPage(pageURI).then((entry) => {\n        resolve(entry.svg);\n      }).catch((err) => { reject(err); });\n    });\n  }\n\n  /**\n   * Get the MEI for a specific page.\n   * @param pageURI - The URI of the selected page.\n   */\n  getMEI (pageURI: string): Promise<string> {\n    return new Promise((resolve, reject): void => {\n      this.loadPage(pageURI).then((entry) => {\n        resolve(entry.mei);\n      }).catch((err) => { reject(err); });\n    });\n  }\n\n  /**\n   * Get musical element attributes from the verovio toolkit.\n   * @param elementId - The unique ID of the musical element.\n   * @param pageURI - The URI of the selected page.\n   */\n  getElementAttr (elementId: string, pageURI: string): Promise<Attributes> {\n    return new Promise((resolve): void => {\n      this.loadPage(pageURI).then(() => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'getElementAttr',\n          elementId: elementId\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            evt.target.removeEventListener('message', handle);\n            resolve(evt.data.attributes);\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n    });\n  }\n\n  /**\n   * Perform an editor action on a specific page.\n   * @param action - The editor toolkit action object.\n   * @param pageURI - The URI of the selected page.\n   */\n  edit (editorAction: EditorAction, pageURI: string): Promise<boolean> {\n    let promise: Promise<CacheEntry>;\n    if (this.lastPageLoaded === pageURI) {\n      promise = Promise.resolve(this.neonCache.get(pageURI));\n    } else {\n      promise = this.loadPage(pageURI);\n    }\n    return new Promise((resolve): void => {\n      promise.then(entry => {\n        const currentMEI = entry.mei;\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'edit',\n          editorAction: editorAction\n        };\n        function handle (evt: MessageEvent): void {\n          if (evt.data.id === message.id) {\n            if (evt.data.result) {\n              if (!this.undoStacks.has(pageURI)) {\n                this.undoStacks.set(pageURI, []);\n              }\n              this.undoStacks.get(pageURI).push(currentMEI);\n              this.redoStacks.set(pageURI, []);\n            }\n            evt.target.removeEventListener('message', handle);\n            this.updateCache(pageURI).then(() => { resolve(evt.data.result); });\n          }\n        }\n        this.verovioWrapper.addEventListener('message', handle.bind(this));\n        this.verovioWrapper.postMessage(message);\n      });\n    });\n  }\n\n  /**\n   * Update contents of the cache using information in verovio toolkit.\n   * @param pageURI - Page to be updated in cache.\n   * @param dirty - If the entry should be marked as dirty\n   */\n  updateCache (pageURI: string, dirty: boolean): Promise<void> {\n    return new Promise((resolve): void => {\n      // Must get MEI and then get SVG then finish.\n      let mei: string, svgText: string;\n      const meiPromise = new Promise((resolve): void => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'getMEI'\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            mei = evt.data.mei;\n            evt.target.removeEventListener('message', handle);\n            resolve();\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n      const svgPromise = new Promise((resolve): void => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'renderToSVG'\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            svgText = evt.data.svg;\n            evt.target.removeEventListener('message', handle);\n            resolve();\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n\n      meiPromise.then(() => { return svgPromise; }).then(() => {\n        const svg = this.parser.parseFromString(\n          svgText,\n          'image/svg+xml'\n        ).documentElement as unknown as SVGSVGElement;\n        this.neonCache.set(pageURI, {\n          mei: mei,\n          svg: svg,\n          dirty: dirty\n        });\n        resolve();\n      });\n    });\n  }\n\n  /**\n   * Get the edit info string from the verovio toolkit.\n   * @param pageURI - The URI of the page to get the edit info string from.\n   */\n  info (pageURI: string): Promise<string> {\n    let promise: Promise<CacheEntry | void>;\n    if (this.lastPageLoaded === pageURI) {\n      promise = Promise.resolve();\n    } else {\n      promise = this.loadPage(pageURI);\n    }\n    return new Promise((resolve): void => {\n      promise.then(() => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'editInfo'\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            evt.target.removeEventListener('message', handle);\n            resolve(JSON.parse(evt.data.info));\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n    });\n  }\n\n  /**\n   * Undo the last action performed on a specific page.\n   * @param pageURI - The URI of the selected page.\n   * @returns If the action was undone.\n   */\n  undo (pageURI: string): Promise<boolean> {\n    return new Promise((resolve): void => {\n      if (this.undoStacks.has(pageURI)) {\n        const state = this.undoStacks.get(pageURI).pop();\n        if (state !== undefined) {\n          this.getMEI(pageURI).then(mei => {\n            this.redoStacks.get(pageURI).push(mei);\n            return this.loadData(pageURI, state, true);\n          }).then(() => {\n            resolve(true);\n          });\n          return;\n        }\n      }\n      resolve(false);\n    });\n  }\n\n  /**\n   * Redo the last action performed on a page.\n   * @param pageURI - The page URI.\n   * @returns If the action was redone.\n   */\n  redo (pageURI: string): Promise<boolean> {\n    return new Promise((resolve): void => {\n      if (this.redoStacks.has(pageURI)) {\n        const state = this.redoStacks.get(pageURI).pop();\n        if (state !== undefined) {\n          this.getMEI(pageURI).then((mei) => {\n            this.undoStacks.get(pageURI).push(mei);\n            return this.loadData(pageURI, state, true);\n          }).then(() => {\n            resolve(true);\n          });\n          return;\n        }\n      }\n      resolve(false);\n    });\n  }\n\n  /**\n   * Update the PouchDb database stored in the browser.\n   * This is based on the data stored in the cache. To save time,\n   * only entries marked as dirty will be updated.\n   */\n  async updateDatabase (): Promise<void> {\n    type Doc = PouchDB.Core.GetMeta & PouchDB.Core.IdMeta & { body: string; timestamp: string };\n    let updateTimestamp = false;\n    for (const pair of this.neonCache) {\n      const key = pair[0];\n      const value = pair[1];\n      if (value.dirty) {\n        updateTimestamp = true;\n        const index = this.annotations.findIndex(elem => { return elem.target === key; });\n        // try to update server with PUT (if applicable\n        // only attempt if not a data URI\n        let uri: string;\n        if (!this.annotations[index].body.match(/^data:/)) {\n          await window.fetch(this.annotations[index].body,\n            {\n              method: 'PUT',\n              headers: { 'Content-Type': 'application/mei+xml' },\n              body: value.mei\n            }\n          ).then(response => {\n            if (response.ok) {\n              uri = this.annotations[index].body;\n            } else {\n              uri = 'data:application/mei+xml;base64,' + window.btoa(value.mei);\n            }\n          }).catch(err => {\n            console.error(err);\n            console.warn('Falling back to data URI');\n            uri = 'data:application/mei+xml;base64,' + window.btoa(value.mei);\n          });\n        } else {\n          uri = 'data:application/mei+xml;base64,' + window.btoa(value.mei);\n        }\n        // Update URI in annotations, database\n        this.annotations[index].body = uri;\n        await this.db.get(this.annotations[index].id).then((doc: Doc) => {\n          doc.body = uri;\n          return this.db.put(doc);\n        }).then(() => {\n          value.dirty = false;\n        }).catch(err => {\n          console.error(err);\n        });\n      }\n    }\n\n    if (updateTimestamp) {\n      await this.db.get(this.manifest['@id']).then((doc: Doc) => {\n        doc.timestamp = (new Date()).toISOString();\n        return this.db.put(doc);\n      }).catch(err => {\n        console.error(err);\n      });\n    }\n  }\n\n  /** Completely remove the database. */\n  deleteDb (): Promise<void> {\n    return this.db.destroy();\n  }\n}\n\nexport { NeonCore as default };\n","/**\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\nvar sprintf = require('./sprintf').sprintf;\n\nvar utils = require('./utils');\nvar SyntaxError = require('./errors').SyntaxError;\n\nvar _cache = {};\n\nvar RE = new RegExp(\n  \"(\" +\n  \"'[^']*'|\\\"[^\\\"]*\\\"|\" +\n  \"::|\" +\n  \"//?|\" +\n  \"\\\\.\\\\.|\" +\n  \"\\\\(\\\\)|\" +\n  \"[/.*:\\\\[\\\\]\\\\(\\\\)@=])|\" +\n  \"((?:\\\\{[^}]+\\\\})?[^/\\\\[\\\\]\\\\(\\\\)@=\\\\s]+)|\" +\n  \"\\\\s+\", 'g'\n);\n\nvar xpath_tokenizer = utils.findall.bind(null, RE);\n\nfunction prepare_tag(next, token) {\n  var tag = token[0];\n\n  function select(context, result) {\n    var i, len, elem, rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      elem._children.forEach(function(e) {\n        if (e.tag === tag) {\n          rv.push(e);\n        }\n      });\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_star(next, token) {\n  function select(context, result) {\n    var i, len, elem, rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      elem._children.forEach(function(e) {\n        rv.push(e);\n      });\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_dot(next, token) {\n  function select(context, result) {\n    var i, len, elem, rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      rv.push(elem);\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_iter(next, token) {\n  var tag;\n  token = next();\n\n  if (token[1] === '*') {\n    tag = '*';\n  }\n  else if (!token[1]) {\n    tag = token[0] || '';\n  }\n  else {\n    throw new SyntaxError(token);\n  }\n\n  function select(context, result) {\n    var i, len, elem, rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      elem.iter(tag, function(e) {\n        if (e !== elem) {\n          rv.push(e);\n        }\n      });\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_dot_dot(next, token) {\n  function select(context, result) {\n    var i, len, elem, rv = [], parent_map = context.parent_map;\n\n    if (!parent_map) {\n      context.parent_map = parent_map = {};\n\n      context.root.iter(null, function(p) {\n        p._children.forEach(function(e) {\n          parent_map[e] = p;\n        });\n      });\n    }\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n\n      if (parent_map.hasOwnProperty(elem)) {\n        rv.push(parent_map[elem]);\n      }\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\n\nfunction prepare_predicate(next, token) {\n  var tag, key, value, select;\n  token = next();\n\n  if (token[1] === '@') {\n    // attribute\n    token = next();\n\n    if (token[1]) {\n      throw new SyntaxError(token, 'Invalid attribute predicate');\n    }\n\n    key = token[0];\n    token = next();\n\n    if (token[1] === ']') {\n      select = function(context, result) {\n        var i, len, elem, rv = [];\n\n        for (i = 0, len = result.length; i < len; i++) {\n          elem = result[i];\n\n          if (elem.get(key)) {\n            rv.push(elem);\n          }\n        }\n\n        return rv;\n      };\n    }\n    else if (token[1] === '=') {\n      value = next()[1];\n\n      if (value[0] === '\"' || value[value.length - 1] === '\\'') {\n        value = value.slice(1, value.length - 1);\n      }\n      else {\n        throw new SyntaxError(token, 'Ivalid comparison target');\n      }\n\n      token = next();\n      select = function(context, result) {\n        var i, len, elem, rv = [];\n\n        for (i = 0, len = result.length; i < len; i++) {\n          elem = result[i];\n\n          if (elem.get(key) === value) {\n            rv.push(elem);\n          }\n        }\n\n        return rv;\n      };\n    }\n\n    if (token[1] !== ']') {\n      throw new SyntaxError(token, 'Invalid attribute predicate');\n    }\n  }\n  else if (!token[1]) {\n    tag = token[0] || '';\n    token = next();\n\n    if (token[1] !== ']') {\n      throw new SyntaxError(token, 'Invalid node predicate');\n    }\n\n    select = function(context, result) {\n      var i, len, elem, rv = [];\n\n      for (i = 0, len = result.length; i < len; i++) {\n        elem = result[i];\n\n        if (elem.find(tag)) {\n          rv.push(elem);\n        }\n      }\n\n      return rv;\n    };\n  }\n  else {\n    throw new SyntaxError(null, 'Invalid predicate');\n  }\n\n  return select;\n}\n\n\n\nvar ops = {\n  \"\": prepare_tag,\n  \"*\": prepare_star,\n  \".\": prepare_dot,\n  \"..\": prepare_dot_dot,\n  \"//\": prepare_iter,\n  \"[\": prepare_predicate,\n};\n\nfunction _SelectorContext(root) {\n  this.parent_map = null;\n  this.root = root;\n}\n\nfunction findall(elem, path) {\n  var selector, result, i, len, token, value, select, context;\n\n  if (_cache.hasOwnProperty(path)) {\n    selector = _cache[path];\n  }\n  else {\n    // TODO: Use smarter cache purging approach\n    if (Object.keys(_cache).length > 100) {\n      _cache = {};\n    }\n\n    if (path.charAt(0) === '/') {\n      throw new SyntaxError(null, 'Cannot use absolute path on element');\n    }\n\n    result = xpath_tokenizer(path);\n    selector = [];\n\n    function getToken() {\n      return result.shift();\n    }\n\n    token = getToken();\n    while (true) {\n      var c = token[1] || '';\n      value = ops[c](getToken, token);\n\n      if (!value) {\n        throw new SyntaxError(null, sprintf('Invalid path: %s', path));\n      }\n\n      selector.push(value);\n      token = getToken();\n\n      if (!token) {\n        break;\n      }\n      else if (token[1] === '/') {\n        token = getToken();\n      }\n\n      if (!token) {\n        break;\n      }\n    }\n\n    _cache[path] = selector;\n  }\n\n  // Execute slector pattern\n  result = [elem];\n  context = new _SelectorContext(elem);\n\n  for (i = 0, len = selector.length; i < len; i++) {\n    select = selector[i];\n    result = select(context, result);\n  }\n\n  return result || [];\n}\n\nfunction find(element, path) {\n  var resultElements = findall(element, path);\n\n  if (resultElements && resultElements.length > 0) {\n    return resultElements[0];\n  }\n\n  return null;\n}\n\nfunction findtext(element, path, defvalue) {\n  var resultElements = findall(element, path);\n\n  if (resultElements && resultElements.length > 0) {\n    return resultElements[0].text;\n  }\n\n  return defvalue;\n}\n\n\nexports.find = find;\nexports.findall = findall;\nexports.findtext = findtext;\n","/**\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\nvar util = require('util');\n\nvar sprintf = require('./sprintf').sprintf;\n\nfunction SyntaxError(token, msg) {\n  msg = msg || sprintf('Syntax Error at token %s', token.toString());\n  this.token = token;\n  this.message = msg;\n  Error.call(this, msg);\n}\n\nutil.inherits(SyntaxError, Error);\n\nexports.SyntaxError = SyntaxError;\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","/*\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\n/* TODO: support node-expat C++ module optionally */\n\nvar util = require('util');\nvar parsers = require('./parsers/index');\n\nfunction get_parser(name) {\n  if (name === 'sax') {\n    return parsers.sax;\n  }\n  else {\n    throw new Error('Invalid parser: ' + name);\n  }\n}\n\n\nexports.get_parser = get_parser;\n","exports.sax = require('./sax');\n","var util = require('util');\n\nvar sax = require('sax');\n\nvar TreeBuilder = require('./../treebuilder').TreeBuilder;\n\nfunction XMLParser(target) {\n  this.parser = sax.parser(true);\n\n  this.target = (target) ? target : new TreeBuilder();\n\n  this.parser.onopentag = this._handleOpenTag.bind(this);\n  this.parser.ontext = this._handleText.bind(this);\n  this.parser.oncdata = this._handleCdata.bind(this);\n  this.parser.ondoctype = this._handleDoctype.bind(this);\n  this.parser.oncomment = this._handleComment.bind(this);\n  this.parser.onclosetag = this._handleCloseTag.bind(this);\n  this.parser.onerror = this._handleError.bind(this);\n}\n\nXMLParser.prototype._handleOpenTag = function(tag) {\n  this.target.start(tag.name, tag.attributes);\n};\n\nXMLParser.prototype._handleText = function(text) {\n  this.target.data(text);\n};\n\nXMLParser.prototype._handleCdata = function(text) {\n  this.target.data(text);\n};\n\nXMLParser.prototype._handleDoctype = function(text) {\n};\n\nXMLParser.prototype._handleComment = function(comment) {\n};\n\nXMLParser.prototype._handleCloseTag = function(tag) {\n  this.target.end(tag);\n};\n\nXMLParser.prototype._handleError = function(err) {\n  throw err;\n};\n\nXMLParser.prototype.feed = function(chunk) {\n  this.parser.write(chunk);\n};\n\nXMLParser.prototype.close = function() {\n  this.parser.close();\n  return this.target.close();\n};\n\nexports.XMLParser = XMLParser;\n",";(function (sax) { // wrapper for non-node envs\n  sax.parser = function (strict, opt) { return new SAXParser(strict, opt) }\n  sax.SAXParser = SAXParser\n  sax.SAXStream = SAXStream\n  sax.createStream = createStream\n\n  // When we pass the MAX_BUFFER_LENGTH position, start checking for buffer overruns.\n  // When we check, schedule the next check for MAX_BUFFER_LENGTH - (max(buffer lengths)),\n  // since that's the earliest that a buffer overrun could occur.  This way, checks are\n  // as rare as required, but as often as necessary to ensure never crossing this bound.\n  // Furthermore, buffers are only tested at most once per write(), so passing a very\n  // large string into write() might have undesirable effects, but this is manageable by\n  // the caller, so it is assumed to be safe.  Thus, a call to write() may, in the extreme\n  // edge case, result in creating at most one complete copy of the string passed in.\n  // Set to Infinity to have unlimited buffers.\n  sax.MAX_BUFFER_LENGTH = 64 * 1024\n\n  var buffers = [\n    'comment', 'sgmlDecl', 'textNode', 'tagName', 'doctype',\n    'procInstName', 'procInstBody', 'entity', 'attribName',\n    'attribValue', 'cdata', 'script'\n  ]\n\n  sax.EVENTS = [\n    'text',\n    'processinginstruction',\n    'sgmldeclaration',\n    'doctype',\n    'comment',\n    'attribute',\n    'opentag',\n    'closetag',\n    'opencdata',\n    'cdata',\n    'closecdata',\n    'error',\n    'end',\n    'ready',\n    'script',\n    'opennamespace',\n    'closenamespace'\n  ]\n\n  function SAXParser (strict, opt) {\n    if (!(this instanceof SAXParser)) {\n      return new SAXParser(strict, opt)\n    }\n\n    var parser = this\n    clearBuffers(parser)\n    parser.q = parser.c = ''\n    parser.bufferCheckPosition = sax.MAX_BUFFER_LENGTH\n    parser.opt = opt || {}\n    parser.opt.lowercase = parser.opt.lowercase || parser.opt.lowercasetags\n    parser.looseCase = parser.opt.lowercase ? 'toLowerCase' : 'toUpperCase'\n    parser.tags = []\n    parser.closed = parser.closedRoot = parser.sawRoot = false\n    parser.tag = parser.error = null\n    parser.strict = !!strict\n    parser.noscript = !!(strict || parser.opt.noscript)\n    parser.state = S.BEGIN\n    parser.strictEntities = parser.opt.strictEntities\n    parser.ENTITIES = parser.strictEntities ? Object.create(sax.XML_ENTITIES) : Object.create(sax.ENTITIES)\n    parser.attribList = []\n\n    // namespaces form a prototype chain.\n    // it always points at the current tag,\n    // which protos to its parent tag.\n    if (parser.opt.xmlns) {\n      parser.ns = Object.create(rootNS)\n    }\n\n    // mostly just for error reporting\n    parser.trackPosition = parser.opt.position !== false\n    if (parser.trackPosition) {\n      parser.position = parser.line = parser.column = 0\n    }\n    emit(parser, 'onready')\n  }\n\n  if (!Object.create) {\n    Object.create = function (o) {\n      function F () {}\n      F.prototype = o\n      var newf = new F()\n      return newf\n    }\n  }\n\n  if (!Object.keys) {\n    Object.keys = function (o) {\n      var a = []\n      for (var i in o) if (o.hasOwnProperty(i)) a.push(i)\n      return a\n    }\n  }\n\n  function checkBufferLength (parser) {\n    var maxAllowed = Math.max(sax.MAX_BUFFER_LENGTH, 10)\n    var maxActual = 0\n    for (var i = 0, l = buffers.length; i < l; i++) {\n      var len = parser[buffers[i]].length\n      if (len > maxAllowed) {\n        // Text/cdata nodes can get big, and since they're buffered,\n        // we can get here under normal conditions.\n        // Avoid issues by emitting the text node now,\n        // so at least it won't get any bigger.\n        switch (buffers[i]) {\n          case 'textNode':\n            closeText(parser)\n            break\n\n          case 'cdata':\n            emitNode(parser, 'oncdata', parser.cdata)\n            parser.cdata = ''\n            break\n\n          case 'script':\n            emitNode(parser, 'onscript', parser.script)\n            parser.script = ''\n            break\n\n          default:\n            error(parser, 'Max buffer length exceeded: ' + buffers[i])\n        }\n      }\n      maxActual = Math.max(maxActual, len)\n    }\n    // schedule the next check for the earliest possible buffer overrun.\n    var m = sax.MAX_BUFFER_LENGTH - maxActual\n    parser.bufferCheckPosition = m + parser.position\n  }\n\n  function clearBuffers (parser) {\n    for (var i = 0, l = buffers.length; i < l; i++) {\n      parser[buffers[i]] = ''\n    }\n  }\n\n  function flushBuffers (parser) {\n    closeText(parser)\n    if (parser.cdata !== '') {\n      emitNode(parser, 'oncdata', parser.cdata)\n      parser.cdata = ''\n    }\n    if (parser.script !== '') {\n      emitNode(parser, 'onscript', parser.script)\n      parser.script = ''\n    }\n  }\n\n  SAXParser.prototype = {\n    end: function () { end(this) },\n    write: write,\n    resume: function () { this.error = null; return this },\n    close: function () { return this.write(null) },\n    flush: function () { flushBuffers(this) }\n  }\n\n  var Stream\n  try {\n    Stream = require('stream').Stream\n  } catch (ex) {\n    Stream = function () {}\n  }\n\n  var streamWraps = sax.EVENTS.filter(function (ev) {\n    return ev !== 'error' && ev !== 'end'\n  })\n\n  function createStream (strict, opt) {\n    return new SAXStream(strict, opt)\n  }\n\n  function SAXStream (strict, opt) {\n    if (!(this instanceof SAXStream)) {\n      return new SAXStream(strict, opt)\n    }\n\n    Stream.apply(this)\n\n    this._parser = new SAXParser(strict, opt)\n    this.writable = true\n    this.readable = true\n\n    var me = this\n\n    this._parser.onend = function () {\n      me.emit('end')\n    }\n\n    this._parser.onerror = function (er) {\n      me.emit('error', er)\n\n      // if didn't throw, then means error was handled.\n      // go ahead and clear error, so we can write again.\n      me._parser.error = null\n    }\n\n    this._decoder = null\n\n    streamWraps.forEach(function (ev) {\n      Object.defineProperty(me, 'on' + ev, {\n        get: function () {\n          return me._parser['on' + ev]\n        },\n        set: function (h) {\n          if (!h) {\n            me.removeAllListeners(ev)\n            me._parser['on' + ev] = h\n            return h\n          }\n          me.on(ev, h)\n        },\n        enumerable: true,\n        configurable: false\n      })\n    })\n  }\n\n  SAXStream.prototype = Object.create(Stream.prototype, {\n    constructor: {\n      value: SAXStream\n    }\n  })\n\n  SAXStream.prototype.write = function (data) {\n    if (typeof Buffer === 'function' &&\n      typeof Buffer.isBuffer === 'function' &&\n      Buffer.isBuffer(data)) {\n      if (!this._decoder) {\n        var SD = require('string_decoder').StringDecoder\n        this._decoder = new SD('utf8')\n      }\n      data = this._decoder.write(data)\n    }\n\n    this._parser.write(data.toString())\n    this.emit('data', data)\n    return true\n  }\n\n  SAXStream.prototype.end = function (chunk) {\n    if (chunk && chunk.length) {\n      this.write(chunk)\n    }\n    this._parser.end()\n    return true\n  }\n\n  SAXStream.prototype.on = function (ev, handler) {\n    var me = this\n    if (!me._parser['on' + ev] && streamWraps.indexOf(ev) !== -1) {\n      me._parser['on' + ev] = function () {\n        var args = arguments.length === 1 ? [arguments[0]] : Array.apply(null, arguments)\n        args.splice(0, 0, ev)\n        me.emit.apply(me, args)\n      }\n    }\n\n    return Stream.prototype.on.call(me, ev, handler)\n  }\n\n  // character classes and tokens\n  var whitespace = '\\r\\n\\t '\n\n  // this really needs to be replaced with character classes.\n  // XML allows all manner of ridiculous numbers and digits.\n  var number = '0124356789'\n  var letter = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'\n\n  // (Letter | \"_\" | \":\")\n  var quote = '\\'\"'\n  var attribEnd = whitespace + '>'\n  var CDATA = '[CDATA['\n  var DOCTYPE = 'DOCTYPE'\n  var XML_NAMESPACE = 'http://www.w3.org/XML/1998/namespace'\n  var XMLNS_NAMESPACE = 'http://www.w3.org/2000/xmlns/'\n  var rootNS = { xml: XML_NAMESPACE, xmlns: XMLNS_NAMESPACE }\n\n  // turn all the string character sets into character class objects.\n  whitespace = charClass(whitespace)\n  number = charClass(number)\n  letter = charClass(letter)\n\n  // http://www.w3.org/TR/REC-xml/#NT-NameStartChar\n  // This implementation works on strings, a single character at a time\n  // as such, it cannot ever support astral-plane characters (10000-EFFFF)\n  // without a significant breaking change to either this  parser, or the\n  // JavaScript language.  Implementation of an emoji-capable xml parser\n  // is left as an exercise for the reader.\n  var nameStart = /[:_A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]/\n\n  var nameBody = /[:_A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\u00B7\\u0300-\\u036F\\u203F-\\u2040\\.\\d-]/\n\n  var entityStart = /[#:_A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]/\n  var entityBody = /[#:_A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\u00B7\\u0300-\\u036F\\u203F-\\u2040\\.\\d-]/\n\n  quote = charClass(quote)\n  attribEnd = charClass(attribEnd)\n\n  function charClass (str) {\n    return str.split('').reduce(function (s, c) {\n      s[c] = true\n      return s\n    }, {})\n  }\n\n  function isRegExp (c) {\n    return Object.prototype.toString.call(c) === '[object RegExp]'\n  }\n\n  function is (charclass, c) {\n    return isRegExp(charclass) ? !!c.match(charclass) : charclass[c]\n  }\n\n  function not (charclass, c) {\n    return !is(charclass, c)\n  }\n\n  var S = 0\n  sax.STATE = {\n    BEGIN: S++, // leading byte order mark or whitespace\n    BEGIN_WHITESPACE: S++, // leading whitespace\n    TEXT: S++, // general stuff\n    TEXT_ENTITY: S++, // &amp and such.\n    OPEN_WAKA: S++, // <\n    SGML_DECL: S++, // <!BLARG\n    SGML_DECL_QUOTED: S++, // <!BLARG foo \"bar\n    DOCTYPE: S++, // <!DOCTYPE\n    DOCTYPE_QUOTED: S++, // <!DOCTYPE \"//blah\n    DOCTYPE_DTD: S++, // <!DOCTYPE \"//blah\" [ ...\n    DOCTYPE_DTD_QUOTED: S++, // <!DOCTYPE \"//blah\" [ \"foo\n    COMMENT_STARTING: S++, // <!-\n    COMMENT: S++, // <!--\n    COMMENT_ENDING: S++, // <!-- blah -\n    COMMENT_ENDED: S++, // <!-- blah --\n    CDATA: S++, // <![CDATA[ something\n    CDATA_ENDING: S++, // ]\n    CDATA_ENDING_2: S++, // ]]\n    PROC_INST: S++, // <?hi\n    PROC_INST_BODY: S++, // <?hi there\n    PROC_INST_ENDING: S++, // <?hi \"there\" ?\n    OPEN_TAG: S++, // <strong\n    OPEN_TAG_SLASH: S++, // <strong /\n    ATTRIB: S++, // <a\n    ATTRIB_NAME: S++, // <a foo\n    ATTRIB_NAME_SAW_WHITE: S++, // <a foo _\n    ATTRIB_VALUE: S++, // <a foo=\n    ATTRIB_VALUE_QUOTED: S++, // <a foo=\"bar\n    ATTRIB_VALUE_CLOSED: S++, // <a foo=\"bar\"\n    ATTRIB_VALUE_UNQUOTED: S++, // <a foo=bar\n    ATTRIB_VALUE_ENTITY_Q: S++, // <foo bar=\"&quot;\"\n    ATTRIB_VALUE_ENTITY_U: S++, // <foo bar=&quot\n    CLOSE_TAG: S++, // </a\n    CLOSE_TAG_SAW_WHITE: S++, // </a   >\n    SCRIPT: S++, // <script> ...\n    SCRIPT_ENDING: S++ // <script> ... <\n  }\n\n  sax.XML_ENTITIES = {\n    'amp': '&',\n    'gt': '>',\n    'lt': '<',\n    'quot': '\"',\n    'apos': \"'\"\n  }\n\n  sax.ENTITIES = {\n    'amp': '&',\n    'gt': '>',\n    'lt': '<',\n    'quot': '\"',\n    'apos': \"'\",\n    'AElig': 198,\n    'Aacute': 193,\n    'Acirc': 194,\n    'Agrave': 192,\n    'Aring': 197,\n    'Atilde': 195,\n    'Auml': 196,\n    'Ccedil': 199,\n    'ETH': 208,\n    'Eacute': 201,\n    'Ecirc': 202,\n    'Egrave': 200,\n    'Euml': 203,\n    'Iacute': 205,\n    'Icirc': 206,\n    'Igrave': 204,\n    'Iuml': 207,\n    'Ntilde': 209,\n    'Oacute': 211,\n    'Ocirc': 212,\n    'Ograve': 210,\n    'Oslash': 216,\n    'Otilde': 213,\n    'Ouml': 214,\n    'THORN': 222,\n    'Uacute': 218,\n    'Ucirc': 219,\n    'Ugrave': 217,\n    'Uuml': 220,\n    'Yacute': 221,\n    'aacute': 225,\n    'acirc': 226,\n    'aelig': 230,\n    'agrave': 224,\n    'aring': 229,\n    'atilde': 227,\n    'auml': 228,\n    'ccedil': 231,\n    'eacute': 233,\n    'ecirc': 234,\n    'egrave': 232,\n    'eth': 240,\n    'euml': 235,\n    'iacute': 237,\n    'icirc': 238,\n    'igrave': 236,\n    'iuml': 239,\n    'ntilde': 241,\n    'oacute': 243,\n    'ocirc': 244,\n    'ograve': 242,\n    'oslash': 248,\n    'otilde': 245,\n    'ouml': 246,\n    'szlig': 223,\n    'thorn': 254,\n    'uacute': 250,\n    'ucirc': 251,\n    'ugrave': 249,\n    'uuml': 252,\n    'yacute': 253,\n    'yuml': 255,\n    'copy': 169,\n    'reg': 174,\n    'nbsp': 160,\n    'iexcl': 161,\n    'cent': 162,\n    'pound': 163,\n    'curren': 164,\n    'yen': 165,\n    'brvbar': 166,\n    'sect': 167,\n    'uml': 168,\n    'ordf': 170,\n    'laquo': 171,\n    'not': 172,\n    'shy': 173,\n    'macr': 175,\n    'deg': 176,\n    'plusmn': 177,\n    'sup1': 185,\n    'sup2': 178,\n    'sup3': 179,\n    'acute': 180,\n    'micro': 181,\n    'para': 182,\n    'middot': 183,\n    'cedil': 184,\n    'ordm': 186,\n    'raquo': 187,\n    'frac14': 188,\n    'frac12': 189,\n    'frac34': 190,\n    'iquest': 191,\n    'times': 215,\n    'divide': 247,\n    'OElig': 338,\n    'oelig': 339,\n    'Scaron': 352,\n    'scaron': 353,\n    'Yuml': 376,\n    'fnof': 402,\n    'circ': 710,\n    'tilde': 732,\n    'Alpha': 913,\n    'Beta': 914,\n    'Gamma': 915,\n    'Delta': 916,\n    'Epsilon': 917,\n    'Zeta': 918,\n    'Eta': 919,\n    'Theta': 920,\n    'Iota': 921,\n    'Kappa': 922,\n    'Lambda': 923,\n    'Mu': 924,\n    'Nu': 925,\n    'Xi': 926,\n    'Omicron': 927,\n    'Pi': 928,\n    'Rho': 929,\n    'Sigma': 931,\n    'Tau': 932,\n    'Upsilon': 933,\n    'Phi': 934,\n    'Chi': 935,\n    'Psi': 936,\n    'Omega': 937,\n    'alpha': 945,\n    'beta': 946,\n    'gamma': 947,\n    'delta': 948,\n    'epsilon': 949,\n    'zeta': 950,\n    'eta': 951,\n    'theta': 952,\n    'iota': 953,\n    'kappa': 954,\n    'lambda': 955,\n    'mu': 956,\n    'nu': 957,\n    'xi': 958,\n    'omicron': 959,\n    'pi': 960,\n    'rho': 961,\n    'sigmaf': 962,\n    'sigma': 963,\n    'tau': 964,\n    'upsilon': 965,\n    'phi': 966,\n    'chi': 967,\n    'psi': 968,\n    'omega': 969,\n    'thetasym': 977,\n    'upsih': 978,\n    'piv': 982,\n    'ensp': 8194,\n    'emsp': 8195,\n    'thinsp': 8201,\n    'zwnj': 8204,\n    'zwj': 8205,\n    'lrm': 8206,\n    'rlm': 8207,\n    'ndash': 8211,\n    'mdash': 8212,\n    'lsquo': 8216,\n    'rsquo': 8217,\n    'sbquo': 8218,\n    'ldquo': 8220,\n    'rdquo': 8221,\n    'bdquo': 8222,\n    'dagger': 8224,\n    'Dagger': 8225,\n    'bull': 8226,\n    'hellip': 8230,\n    'permil': 8240,\n    'prime': 8242,\n    'Prime': 8243,\n    'lsaquo': 8249,\n    'rsaquo': 8250,\n    'oline': 8254,\n    'frasl': 8260,\n    'euro': 8364,\n    'image': 8465,\n    'weierp': 8472,\n    'real': 8476,\n    'trade': 8482,\n    'alefsym': 8501,\n    'larr': 8592,\n    'uarr': 8593,\n    'rarr': 8594,\n    'darr': 8595,\n    'harr': 8596,\n    'crarr': 8629,\n    'lArr': 8656,\n    'uArr': 8657,\n    'rArr': 8658,\n    'dArr': 8659,\n    'hArr': 8660,\n    'forall': 8704,\n    'part': 8706,\n    'exist': 8707,\n    'empty': 8709,\n    'nabla': 8711,\n    'isin': 8712,\n    'notin': 8713,\n    'ni': 8715,\n    'prod': 8719,\n    'sum': 8721,\n    'minus': 8722,\n    'lowast': 8727,\n    'radic': 8730,\n    'prop': 8733,\n    'infin': 8734,\n    'ang': 8736,\n    'and': 8743,\n    'or': 8744,\n    'cap': 8745,\n    'cup': 8746,\n    'int': 8747,\n    'there4': 8756,\n    'sim': 8764,\n    'cong': 8773,\n    'asymp': 8776,\n    'ne': 8800,\n    'equiv': 8801,\n    'le': 8804,\n    'ge': 8805,\n    'sub': 8834,\n    'sup': 8835,\n    'nsub': 8836,\n    'sube': 8838,\n    'supe': 8839,\n    'oplus': 8853,\n    'otimes': 8855,\n    'perp': 8869,\n    'sdot': 8901,\n    'lceil': 8968,\n    'rceil': 8969,\n    'lfloor': 8970,\n    'rfloor': 8971,\n    'lang': 9001,\n    'rang': 9002,\n    'loz': 9674,\n    'spades': 9824,\n    'clubs': 9827,\n    'hearts': 9829,\n    'diams': 9830\n  }\n\n  Object.keys(sax.ENTITIES).forEach(function (key) {\n    var e = sax.ENTITIES[key]\n    var s = typeof e === 'number' ? String.fromCharCode(e) : e\n    sax.ENTITIES[key] = s\n  })\n\n  for (var s in sax.STATE) {\n    sax.STATE[sax.STATE[s]] = s\n  }\n\n  // shorthand\n  S = sax.STATE\n\n  function emit (parser, event, data) {\n    parser[event] && parser[event](data)\n  }\n\n  function emitNode (parser, nodeType, data) {\n    if (parser.textNode) closeText(parser)\n    emit(parser, nodeType, data)\n  }\n\n  function closeText (parser) {\n    parser.textNode = textopts(parser.opt, parser.textNode)\n    if (parser.textNode) emit(parser, 'ontext', parser.textNode)\n    parser.textNode = ''\n  }\n\n  function textopts (opt, text) {\n    if (opt.trim) text = text.trim()\n    if (opt.normalize) text = text.replace(/\\s+/g, ' ')\n    return text\n  }\n\n  function error (parser, er) {\n    closeText(parser)\n    if (parser.trackPosition) {\n      er += '\\nLine: ' + parser.line +\n        '\\nColumn: ' + parser.column +\n        '\\nChar: ' + parser.c\n    }\n    er = new Error(er)\n    parser.error = er\n    emit(parser, 'onerror', er)\n    return parser\n  }\n\n  function end (parser) {\n    if (parser.sawRoot && !parser.closedRoot) strictFail(parser, 'Unclosed root tag')\n    if ((parser.state !== S.BEGIN) &&\n      (parser.state !== S.BEGIN_WHITESPACE) &&\n      (parser.state !== S.TEXT)) {\n      error(parser, 'Unexpected end')\n    }\n    closeText(parser)\n    parser.c = ''\n    parser.closed = true\n    emit(parser, 'onend')\n    SAXParser.call(parser, parser.strict, parser.opt)\n    return parser\n  }\n\n  function strictFail (parser, message) {\n    if (typeof parser !== 'object' || !(parser instanceof SAXParser)) {\n      throw new Error('bad call to strictFail')\n    }\n    if (parser.strict) {\n      error(parser, message)\n    }\n  }\n\n  function newTag (parser) {\n    if (!parser.strict) parser.tagName = parser.tagName[parser.looseCase]()\n    var parent = parser.tags[parser.tags.length - 1] || parser\n    var tag = parser.tag = { name: parser.tagName, attributes: {} }\n\n    // will be overridden if tag contails an xmlns=\"foo\" or xmlns:foo=\"bar\"\n    if (parser.opt.xmlns) {\n      tag.ns = parent.ns\n    }\n    parser.attribList.length = 0\n  }\n\n  function qname (name, attribute) {\n    var i = name.indexOf(':')\n    var qualName = i < 0 ? [ '', name ] : name.split(':')\n    var prefix = qualName[0]\n    var local = qualName[1]\n\n    // <x \"xmlns\"=\"http://foo\">\n    if (attribute && name === 'xmlns') {\n      prefix = 'xmlns'\n      local = ''\n    }\n\n    return { prefix: prefix, local: local }\n  }\n\n  function attrib (parser) {\n    if (!parser.strict) {\n      parser.attribName = parser.attribName[parser.looseCase]()\n    }\n\n    if (parser.attribList.indexOf(parser.attribName) !== -1 ||\n      parser.tag.attributes.hasOwnProperty(parser.attribName)) {\n      parser.attribName = parser.attribValue = ''\n      return\n    }\n\n    if (parser.opt.xmlns) {\n      var qn = qname(parser.attribName, true)\n      var prefix = qn.prefix\n      var local = qn.local\n\n      if (prefix === 'xmlns') {\n        // namespace binding attribute. push the binding into scope\n        if (local === 'xml' && parser.attribValue !== XML_NAMESPACE) {\n          strictFail(parser,\n            'xml: prefix must be bound to ' + XML_NAMESPACE + '\\n' +\n            'Actual: ' + parser.attribValue)\n        } else if (local === 'xmlns' && parser.attribValue !== XMLNS_NAMESPACE) {\n          strictFail(parser,\n            'xmlns: prefix must be bound to ' + XMLNS_NAMESPACE + '\\n' +\n            'Actual: ' + parser.attribValue)\n        } else {\n          var tag = parser.tag\n          var parent = parser.tags[parser.tags.length - 1] || parser\n          if (tag.ns === parent.ns) {\n            tag.ns = Object.create(parent.ns)\n          }\n          tag.ns[local] = parser.attribValue\n        }\n      }\n\n      // defer onattribute events until all attributes have been seen\n      // so any new bindings can take effect. preserve attribute order\n      // so deferred events can be emitted in document order\n      parser.attribList.push([parser.attribName, parser.attribValue])\n    } else {\n      // in non-xmlns mode, we can emit the event right away\n      parser.tag.attributes[parser.attribName] = parser.attribValue\n      emitNode(parser, 'onattribute', {\n        name: parser.attribName,\n        value: parser.attribValue\n      })\n    }\n\n    parser.attribName = parser.attribValue = ''\n  }\n\n  function openTag (parser, selfClosing) {\n    if (parser.opt.xmlns) {\n      // emit namespace binding events\n      var tag = parser.tag\n\n      // add namespace info to tag\n      var qn = qname(parser.tagName)\n      tag.prefix = qn.prefix\n      tag.local = qn.local\n      tag.uri = tag.ns[qn.prefix] || ''\n\n      if (tag.prefix && !tag.uri) {\n        strictFail(parser, 'Unbound namespace prefix: ' +\n          JSON.stringify(parser.tagName))\n        tag.uri = qn.prefix\n      }\n\n      var parent = parser.tags[parser.tags.length - 1] || parser\n      if (tag.ns && parent.ns !== tag.ns) {\n        Object.keys(tag.ns).forEach(function (p) {\n          emitNode(parser, 'onopennamespace', {\n            prefix: p,\n            uri: tag.ns[p]\n          })\n        })\n      }\n\n      // handle deferred onattribute events\n      // Note: do not apply default ns to attributes:\n      //   http://www.w3.org/TR/REC-xml-names/#defaulting\n      for (var i = 0, l = parser.attribList.length; i < l; i++) {\n        var nv = parser.attribList[i]\n        var name = nv[0]\n        var value = nv[1]\n        var qualName = qname(name, true)\n        var prefix = qualName.prefix\n        var local = qualName.local\n        var uri = prefix === '' ? '' : (tag.ns[prefix] || '')\n        var a = {\n          name: name,\n          value: value,\n          prefix: prefix,\n          local: local,\n          uri: uri\n        }\n\n        // if there's any attributes with an undefined namespace,\n        // then fail on them now.\n        if (prefix && prefix !== 'xmlns' && !uri) {\n          strictFail(parser, 'Unbound namespace prefix: ' +\n            JSON.stringify(prefix))\n          a.uri = prefix\n        }\n        parser.tag.attributes[name] = a\n        emitNode(parser, 'onattribute', a)\n      }\n      parser.attribList.length = 0\n    }\n\n    parser.tag.isSelfClosing = !!selfClosing\n\n    // process the tag\n    parser.sawRoot = true\n    parser.tags.push(parser.tag)\n    emitNode(parser, 'onopentag', parser.tag)\n    if (!selfClosing) {\n      // special case for <script> in non-strict mode.\n      if (!parser.noscript && parser.tagName.toLowerCase() === 'script') {\n        parser.state = S.SCRIPT\n      } else {\n        parser.state = S.TEXT\n      }\n      parser.tag = null\n      parser.tagName = ''\n    }\n    parser.attribName = parser.attribValue = ''\n    parser.attribList.length = 0\n  }\n\n  function closeTag (parser) {\n    if (!parser.tagName) {\n      strictFail(parser, 'Weird empty close tag.')\n      parser.textNode += '</>'\n      parser.state = S.TEXT\n      return\n    }\n\n    if (parser.script) {\n      if (parser.tagName !== 'script') {\n        parser.script += '</' + parser.tagName + '>'\n        parser.tagName = ''\n        parser.state = S.SCRIPT\n        return\n      }\n      emitNode(parser, 'onscript', parser.script)\n      parser.script = ''\n    }\n\n    // first make sure that the closing tag actually exists.\n    // <a><b></c></b></a> will close everything, otherwise.\n    var t = parser.tags.length\n    var tagName = parser.tagName\n    if (!parser.strict) {\n      tagName = tagName[parser.looseCase]()\n    }\n    var closeTo = tagName\n    while (t--) {\n      var close = parser.tags[t]\n      if (close.name !== closeTo) {\n        // fail the first time in strict mode\n        strictFail(parser, 'Unexpected close tag')\n      } else {\n        break\n      }\n    }\n\n    // didn't find it.  we already failed for strict, so just abort.\n    if (t < 0) {\n      strictFail(parser, 'Unmatched closing tag: ' + parser.tagName)\n      parser.textNode += '</' + parser.tagName + '>'\n      parser.state = S.TEXT\n      return\n    }\n    parser.tagName = tagName\n    var s = parser.tags.length\n    while (s-- > t) {\n      var tag = parser.tag = parser.tags.pop()\n      parser.tagName = parser.tag.name\n      emitNode(parser, 'onclosetag', parser.tagName)\n\n      var x = {}\n      for (var i in tag.ns) {\n        x[i] = tag.ns[i]\n      }\n\n      var parent = parser.tags[parser.tags.length - 1] || parser\n      if (parser.opt.xmlns && tag.ns !== parent.ns) {\n        // remove namespace bindings introduced by tag\n        Object.keys(tag.ns).forEach(function (p) {\n          var n = tag.ns[p]\n          emitNode(parser, 'onclosenamespace', { prefix: p, uri: n })\n        })\n      }\n    }\n    if (t === 0) parser.closedRoot = true\n    parser.tagName = parser.attribValue = parser.attribName = ''\n    parser.attribList.length = 0\n    parser.state = S.TEXT\n  }\n\n  function parseEntity (parser) {\n    var entity = parser.entity\n    var entityLC = entity.toLowerCase()\n    var num\n    var numStr = ''\n\n    if (parser.ENTITIES[entity]) {\n      return parser.ENTITIES[entity]\n    }\n    if (parser.ENTITIES[entityLC]) {\n      return parser.ENTITIES[entityLC]\n    }\n    entity = entityLC\n    if (entity.charAt(0) === '#') {\n      if (entity.charAt(1) === 'x') {\n        entity = entity.slice(2)\n        num = parseInt(entity, 16)\n        numStr = num.toString(16)\n      } else {\n        entity = entity.slice(1)\n        num = parseInt(entity, 10)\n        numStr = num.toString(10)\n      }\n    }\n    entity = entity.replace(/^0+/, '')\n    if (numStr.toLowerCase() !== entity) {\n      strictFail(parser, 'Invalid character entity')\n      return '&' + parser.entity + ';'\n    }\n\n    return String.fromCodePoint(num)\n  }\n\n  function beginWhiteSpace (parser, c) {\n    if (c === '<') {\n      parser.state = S.OPEN_WAKA\n      parser.startTagPosition = parser.position\n    } else if (not(whitespace, c)) {\n      // have to process this as a text node.\n      // weird, but happens.\n      strictFail(parser, 'Non-whitespace before first tag.')\n      parser.textNode = c\n      parser.state = S.TEXT\n    }\n  }\n\n  function write (chunk) {\n    var parser = this\n    if (this.error) {\n      throw this.error\n    }\n    if (parser.closed) {\n      return error(parser,\n        'Cannot write after close. Assign an onready handler.')\n    }\n    if (chunk === null) {\n      return end(parser)\n    }\n    var i = 0\n    var c = ''\n    while (true) {\n      c = chunk.charAt(i++)\n      parser.c = c\n      if (!c) {\n        break\n      }\n      if (parser.trackPosition) {\n        parser.position++\n        if (c === '\\n') {\n          parser.line++\n          parser.column = 0\n        } else {\n          parser.column++\n        }\n      }\n      switch (parser.state) {\n        case S.BEGIN:\n          parser.state = S.BEGIN_WHITESPACE\n          if (c === '\\uFEFF') {\n            continue\n          }\n          beginWhiteSpace(parser, c)\n          continue\n\n        case S.BEGIN_WHITESPACE:\n          beginWhiteSpace(parser, c)\n          continue\n\n        case S.TEXT:\n          if (parser.sawRoot && !parser.closedRoot) {\n            var starti = i - 1\n            while (c && c !== '<' && c !== '&') {\n              c = chunk.charAt(i++)\n              if (c && parser.trackPosition) {\n                parser.position++\n                if (c === '\\n') {\n                  parser.line++\n                  parser.column = 0\n                } else {\n                  parser.column++\n                }\n              }\n            }\n            parser.textNode += chunk.substring(starti, i - 1)\n          }\n          if (c === '<' && !(parser.sawRoot && parser.closedRoot && !parser.strict)) {\n            parser.state = S.OPEN_WAKA\n            parser.startTagPosition = parser.position\n          } else {\n            if (not(whitespace, c) && (!parser.sawRoot || parser.closedRoot)) {\n              strictFail(parser, 'Text data outside of root node.')\n            }\n            if (c === '&') {\n              parser.state = S.TEXT_ENTITY\n            } else {\n              parser.textNode += c\n            }\n          }\n          continue\n\n        case S.SCRIPT:\n          // only non-strict\n          if (c === '<') {\n            parser.state = S.SCRIPT_ENDING\n          } else {\n            parser.script += c\n          }\n          continue\n\n        case S.SCRIPT_ENDING:\n          if (c === '/') {\n            parser.state = S.CLOSE_TAG\n          } else {\n            parser.script += '<' + c\n            parser.state = S.SCRIPT\n          }\n          continue\n\n        case S.OPEN_WAKA:\n          // either a /, ?, !, or text is coming next.\n          if (c === '!') {\n            parser.state = S.SGML_DECL\n            parser.sgmlDecl = ''\n          } else if (is(whitespace, c)) {\n            // wait for it...\n          } else if (is(nameStart, c)) {\n            parser.state = S.OPEN_TAG\n            parser.tagName = c\n          } else if (c === '/') {\n            parser.state = S.CLOSE_TAG\n            parser.tagName = ''\n          } else if (c === '?') {\n            parser.state = S.PROC_INST\n            parser.procInstName = parser.procInstBody = ''\n          } else {\n            strictFail(parser, 'Unencoded <')\n            // if there was some whitespace, then add that in.\n            if (parser.startTagPosition + 1 < parser.position) {\n              var pad = parser.position - parser.startTagPosition\n              c = new Array(pad).join(' ') + c\n            }\n            parser.textNode += '<' + c\n            parser.state = S.TEXT\n          }\n          continue\n\n        case S.SGML_DECL:\n          if ((parser.sgmlDecl + c).toUpperCase() === CDATA) {\n            emitNode(parser, 'onopencdata')\n            parser.state = S.CDATA\n            parser.sgmlDecl = ''\n            parser.cdata = ''\n          } else if (parser.sgmlDecl + c === '--') {\n            parser.state = S.COMMENT\n            parser.comment = ''\n            parser.sgmlDecl = ''\n          } else if ((parser.sgmlDecl + c).toUpperCase() === DOCTYPE) {\n            parser.state = S.DOCTYPE\n            if (parser.doctype || parser.sawRoot) {\n              strictFail(parser,\n                'Inappropriately located doctype declaration')\n            }\n            parser.doctype = ''\n            parser.sgmlDecl = ''\n          } else if (c === '>') {\n            emitNode(parser, 'onsgmldeclaration', parser.sgmlDecl)\n            parser.sgmlDecl = ''\n            parser.state = S.TEXT\n          } else if (is(quote, c)) {\n            parser.state = S.SGML_DECL_QUOTED\n            parser.sgmlDecl += c\n          } else {\n            parser.sgmlDecl += c\n          }\n          continue\n\n        case S.SGML_DECL_QUOTED:\n          if (c === parser.q) {\n            parser.state = S.SGML_DECL\n            parser.q = ''\n          }\n          parser.sgmlDecl += c\n          continue\n\n        case S.DOCTYPE:\n          if (c === '>') {\n            parser.state = S.TEXT\n            emitNode(parser, 'ondoctype', parser.doctype)\n            parser.doctype = true // just remember that we saw it.\n          } else {\n            parser.doctype += c\n            if (c === '[') {\n              parser.state = S.DOCTYPE_DTD\n            } else if (is(quote, c)) {\n              parser.state = S.DOCTYPE_QUOTED\n              parser.q = c\n            }\n          }\n          continue\n\n        case S.DOCTYPE_QUOTED:\n          parser.doctype += c\n          if (c === parser.q) {\n            parser.q = ''\n            parser.state = S.DOCTYPE\n          }\n          continue\n\n        case S.DOCTYPE_DTD:\n          parser.doctype += c\n          if (c === ']') {\n            parser.state = S.DOCTYPE\n          } else if (is(quote, c)) {\n            parser.state = S.DOCTYPE_DTD_QUOTED\n            parser.q = c\n          }\n          continue\n\n        case S.DOCTYPE_DTD_QUOTED:\n          parser.doctype += c\n          if (c === parser.q) {\n            parser.state = S.DOCTYPE_DTD\n            parser.q = ''\n          }\n          continue\n\n        case S.COMMENT:\n          if (c === '-') {\n            parser.state = S.COMMENT_ENDING\n          } else {\n            parser.comment += c\n          }\n          continue\n\n        case S.COMMENT_ENDING:\n          if (c === '-') {\n            parser.state = S.COMMENT_ENDED\n            parser.comment = textopts(parser.opt, parser.comment)\n            if (parser.comment) {\n              emitNode(parser, 'oncomment', parser.comment)\n            }\n            parser.comment = ''\n          } else {\n            parser.comment += '-' + c\n            parser.state = S.COMMENT\n          }\n          continue\n\n        case S.COMMENT_ENDED:\n          if (c !== '>') {\n            strictFail(parser, 'Malformed comment')\n            // allow <!-- blah -- bloo --> in non-strict mode,\n            // which is a comment of \" blah -- bloo \"\n            parser.comment += '--' + c\n            parser.state = S.COMMENT\n          } else {\n            parser.state = S.TEXT\n          }\n          continue\n\n        case S.CDATA:\n          if (c === ']') {\n            parser.state = S.CDATA_ENDING\n          } else {\n            parser.cdata += c\n          }\n          continue\n\n        case S.CDATA_ENDING:\n          if (c === ']') {\n            parser.state = S.CDATA_ENDING_2\n          } else {\n            parser.cdata += ']' + c\n            parser.state = S.CDATA\n          }\n          continue\n\n        case S.CDATA_ENDING_2:\n          if (c === '>') {\n            if (parser.cdata) {\n              emitNode(parser, 'oncdata', parser.cdata)\n            }\n            emitNode(parser, 'onclosecdata')\n            parser.cdata = ''\n            parser.state = S.TEXT\n          } else if (c === ']') {\n            parser.cdata += ']'\n          } else {\n            parser.cdata += ']]' + c\n            parser.state = S.CDATA\n          }\n          continue\n\n        case S.PROC_INST:\n          if (c === '?') {\n            parser.state = S.PROC_INST_ENDING\n          } else if (is(whitespace, c)) {\n            parser.state = S.PROC_INST_BODY\n          } else {\n            parser.procInstName += c\n          }\n          continue\n\n        case S.PROC_INST_BODY:\n          if (!parser.procInstBody && is(whitespace, c)) {\n            continue\n          } else if (c === '?') {\n            parser.state = S.PROC_INST_ENDING\n          } else {\n            parser.procInstBody += c\n          }\n          continue\n\n        case S.PROC_INST_ENDING:\n          if (c === '>') {\n            emitNode(parser, 'onprocessinginstruction', {\n              name: parser.procInstName,\n              body: parser.procInstBody\n            })\n            parser.procInstName = parser.procInstBody = ''\n            parser.state = S.TEXT\n          } else {\n            parser.procInstBody += '?' + c\n            parser.state = S.PROC_INST_BODY\n          }\n          continue\n\n        case S.OPEN_TAG:\n          if (is(nameBody, c)) {\n            parser.tagName += c\n          } else {\n            newTag(parser)\n            if (c === '>') {\n              openTag(parser)\n            } else if (c === '/') {\n              parser.state = S.OPEN_TAG_SLASH\n            } else {\n              if (not(whitespace, c)) {\n                strictFail(parser, 'Invalid character in tag name')\n              }\n              parser.state = S.ATTRIB\n            }\n          }\n          continue\n\n        case S.OPEN_TAG_SLASH:\n          if (c === '>') {\n            openTag(parser, true)\n            closeTag(parser)\n          } else {\n            strictFail(parser, 'Forward-slash in opening tag not followed by >')\n            parser.state = S.ATTRIB\n          }\n          continue\n\n        case S.ATTRIB:\n          // haven't read the attribute name yet.\n          if (is(whitespace, c)) {\n            continue\n          } else if (c === '>') {\n            openTag(parser)\n          } else if (c === '/') {\n            parser.state = S.OPEN_TAG_SLASH\n          } else if (is(nameStart, c)) {\n            parser.attribName = c\n            parser.attribValue = ''\n            parser.state = S.ATTRIB_NAME\n          } else {\n            strictFail(parser, 'Invalid attribute name')\n          }\n          continue\n\n        case S.ATTRIB_NAME:\n          if (c === '=') {\n            parser.state = S.ATTRIB_VALUE\n          } else if (c === '>') {\n            strictFail(parser, 'Attribute without value')\n            parser.attribValue = parser.attribName\n            attrib(parser)\n            openTag(parser)\n          } else if (is(whitespace, c)) {\n            parser.state = S.ATTRIB_NAME_SAW_WHITE\n          } else if (is(nameBody, c)) {\n            parser.attribName += c\n          } else {\n            strictFail(parser, 'Invalid attribute name')\n          }\n          continue\n\n        case S.ATTRIB_NAME_SAW_WHITE:\n          if (c === '=') {\n            parser.state = S.ATTRIB_VALUE\n          } else if (is(whitespace, c)) {\n            continue\n          } else {\n            strictFail(parser, 'Attribute without value')\n            parser.tag.attributes[parser.attribName] = ''\n            parser.attribValue = ''\n            emitNode(parser, 'onattribute', {\n              name: parser.attribName,\n              value: ''\n            })\n            parser.attribName = ''\n            if (c === '>') {\n              openTag(parser)\n            } else if (is(nameStart, c)) {\n              parser.attribName = c\n              parser.state = S.ATTRIB_NAME\n            } else {\n              strictFail(parser, 'Invalid attribute name')\n              parser.state = S.ATTRIB\n            }\n          }\n          continue\n\n        case S.ATTRIB_VALUE:\n          if (is(whitespace, c)) {\n            continue\n          } else if (is(quote, c)) {\n            parser.q = c\n            parser.state = S.ATTRIB_VALUE_QUOTED\n          } else {\n            strictFail(parser, 'Unquoted attribute value')\n            parser.state = S.ATTRIB_VALUE_UNQUOTED\n            parser.attribValue = c\n          }\n          continue\n\n        case S.ATTRIB_VALUE_QUOTED:\n          if (c !== parser.q) {\n            if (c === '&') {\n              parser.state = S.ATTRIB_VALUE_ENTITY_Q\n            } else {\n              parser.attribValue += c\n            }\n            continue\n          }\n          attrib(parser)\n          parser.q = ''\n          parser.state = S.ATTRIB_VALUE_CLOSED\n          continue\n\n        case S.ATTRIB_VALUE_CLOSED:\n          if (is(whitespace, c)) {\n            parser.state = S.ATTRIB\n          } else if (c === '>') {\n            openTag(parser)\n          } else if (c === '/') {\n            parser.state = S.OPEN_TAG_SLASH\n          } else if (is(nameStart, c)) {\n            strictFail(parser, 'No whitespace between attributes')\n            parser.attribName = c\n            parser.attribValue = ''\n            parser.state = S.ATTRIB_NAME\n          } else {\n            strictFail(parser, 'Invalid attribute name')\n          }\n          continue\n\n        case S.ATTRIB_VALUE_UNQUOTED:\n          if (not(attribEnd, c)) {\n            if (c === '&') {\n              parser.state = S.ATTRIB_VALUE_ENTITY_U\n            } else {\n              parser.attribValue += c\n            }\n            continue\n          }\n          attrib(parser)\n          if (c === '>') {\n            openTag(parser)\n          } else {\n            parser.state = S.ATTRIB\n          }\n          continue\n\n        case S.CLOSE_TAG:\n          if (!parser.tagName) {\n            if (is(whitespace, c)) {\n              continue\n            } else if (not(nameStart, c)) {\n              if (parser.script) {\n                parser.script += '</' + c\n                parser.state = S.SCRIPT\n              } else {\n                strictFail(parser, 'Invalid tagname in closing tag.')\n              }\n            } else {\n              parser.tagName = c\n            }\n          } else if (c === '>') {\n            closeTag(parser)\n          } else if (is(nameBody, c)) {\n            parser.tagName += c\n          } else if (parser.script) {\n            parser.script += '</' + parser.tagName\n            parser.tagName = ''\n            parser.state = S.SCRIPT\n          } else {\n            if (not(whitespace, c)) {\n              strictFail(parser, 'Invalid tagname in closing tag')\n            }\n            parser.state = S.CLOSE_TAG_SAW_WHITE\n          }\n          continue\n\n        case S.CLOSE_TAG_SAW_WHITE:\n          if (is(whitespace, c)) {\n            continue\n          }\n          if (c === '>') {\n            closeTag(parser)\n          } else {\n            strictFail(parser, 'Invalid characters in closing tag')\n          }\n          continue\n\n        case S.TEXT_ENTITY:\n        case S.ATTRIB_VALUE_ENTITY_Q:\n        case S.ATTRIB_VALUE_ENTITY_U:\n          var returnState\n          var buffer\n          switch (parser.state) {\n            case S.TEXT_ENTITY:\n              returnState = S.TEXT\n              buffer = 'textNode'\n              break\n\n            case S.ATTRIB_VALUE_ENTITY_Q:\n              returnState = S.ATTRIB_VALUE_QUOTED\n              buffer = 'attribValue'\n              break\n\n            case S.ATTRIB_VALUE_ENTITY_U:\n              returnState = S.ATTRIB_VALUE_UNQUOTED\n              buffer = 'attribValue'\n              break\n          }\n\n          if (c === ';') {\n            parser[buffer] += parseEntity(parser)\n            parser.entity = ''\n            parser.state = returnState\n          } else if (is(parser.entity.length ? entityBody : entityStart, c)) {\n            parser.entity += c\n          } else {\n            strictFail(parser, 'Invalid character in entity name')\n            parser[buffer] += '&' + parser.entity + c\n            parser.entity = ''\n            parser.state = returnState\n          }\n\n          continue\n\n        default:\n          throw new Error(parser, 'Unknown state: ' + parser.state)\n      }\n    } // while\n\n    if (parser.position >= parser.bufferCheckPosition) {\n      checkBufferLength(parser)\n    }\n    return parser\n  }\n\n  /*! http://mths.be/fromcodepoint v0.1.0 by @mathias */\n  if (!String.fromCodePoint) {\n    (function () {\n      var stringFromCharCode = String.fromCharCode\n      var floor = Math.floor\n      var fromCodePoint = function () {\n        var MAX_SIZE = 0x4000\n        var codeUnits = []\n        var highSurrogate\n        var lowSurrogate\n        var index = -1\n        var length = arguments.length\n        if (!length) {\n          return ''\n        }\n        var result = ''\n        while (++index < length) {\n          var codePoint = Number(arguments[index])\n          if (\n            !isFinite(codePoint) || // `NaN`, `+Infinity`, or `-Infinity`\n            codePoint < 0 || // not a valid Unicode code point\n            codePoint > 0x10FFFF || // not a valid Unicode code point\n            floor(codePoint) !== codePoint // not an integer\n          ) {\n            throw RangeError('Invalid code point: ' + codePoint)\n          }\n          if (codePoint <= 0xFFFF) { // BMP code point\n            codeUnits.push(codePoint)\n          } else { // Astral code point; split in surrogate halves\n            // http://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae\n            codePoint -= 0x10000\n            highSurrogate = (codePoint >> 10) + 0xD800\n            lowSurrogate = (codePoint % 0x400) + 0xDC00\n            codeUnits.push(highSurrogate, lowSurrogate)\n          }\n          if (index + 1 === length || codeUnits.length > MAX_SIZE) {\n            result += stringFromCharCode.apply(null, codeUnits)\n            codeUnits.length = 0\n          }\n        }\n        return result\n      }\n      if (Object.defineProperty) {\n        Object.defineProperty(String, 'fromCodePoint', {\n          value: fromCodePoint,\n          configurable: true,\n          writable: true\n        })\n      } else {\n        String.fromCodePoint = fromCodePoint\n      }\n    }())\n  }\n})(typeof exports === 'undefined' ? this.sax = {} : exports)\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(\n      uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)\n    ))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","exports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nmodule.exports = Stream;\n\nvar EE = require('events').EventEmitter;\nvar inherits = require('inherits');\n\ninherits(Stream, EE);\nStream.Readable = require('readable-stream/readable.js');\nStream.Writable = require('readable-stream/writable.js');\nStream.Duplex = require('readable-stream/duplex.js');\nStream.Transform = require('readable-stream/transform.js');\nStream.PassThrough = require('readable-stream/passthrough.js');\n\n// Backwards-compat with node 0.4.x\nStream.Stream = Stream;\n\n\n\n// old-style streams.  Note that the pipe method (the only relevant\n// part of this class) is overridden in the Readable class.\n\nfunction Stream() {\n  EE.call(this);\n}\n\nStream.prototype.pipe = function(dest, options) {\n  var source = this;\n\n  function ondata(chunk) {\n    if (dest.writable) {\n      if (false === dest.write(chunk) && source.pause) {\n        source.pause();\n      }\n    }\n  }\n\n  source.on('data', ondata);\n\n  function ondrain() {\n    if (source.readable && source.resume) {\n      source.resume();\n    }\n  }\n\n  dest.on('drain', ondrain);\n\n  // If the 'end' option is not supplied, dest.end() will be called when\n  // source gets the 'end' or 'close' events.  Only dest.end() once.\n  if (!dest._isStdio && (!options || options.end !== false)) {\n    source.on('end', onend);\n    source.on('close', onclose);\n  }\n\n  var didOnEnd = false;\n  function onend() {\n    if (didOnEnd) return;\n    didOnEnd = true;\n\n    dest.end();\n  }\n\n\n  function onclose() {\n    if (didOnEnd) return;\n    didOnEnd = true;\n\n    if (typeof dest.destroy === 'function') dest.destroy();\n  }\n\n  // don't leave dangling pipes when there are errors.\n  function onerror(er) {\n    cleanup();\n    if (EE.listenerCount(this, 'error') === 0) {\n      throw er; // Unhandled stream error in pipe.\n    }\n  }\n\n  source.on('error', onerror);\n  dest.on('error', onerror);\n\n  // remove all the event listeners that were added.\n  function cleanup() {\n    source.removeListener('data', ondata);\n    dest.removeListener('drain', ondrain);\n\n    source.removeListener('end', onend);\n    source.removeListener('close', onclose);\n\n    source.removeListener('error', onerror);\n    dest.removeListener('error', onerror);\n\n    source.removeListener('end', cleanup);\n    source.removeListener('close', cleanup);\n\n    dest.removeListener('close', cleanup);\n  }\n\n  source.on('end', cleanup);\n  source.on('close', cleanup);\n\n  dest.on('close', cleanup);\n\n  dest.emit('pipe', source);\n\n  // Allow for unix-like usage: A.pipe(B).pipe(C)\n  return dest;\n};\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","'use strict';\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Buffer = require('safe-buffer').Buffer;\nvar util = require('util');\n\nfunction copyBuffer(src, target, offset) {\n  src.copy(target, offset);\n}\n\nmodule.exports = function () {\n  function BufferList() {\n    _classCallCheck(this, BufferList);\n\n    this.head = null;\n    this.tail = null;\n    this.length = 0;\n  }\n\n  BufferList.prototype.push = function push(v) {\n    var entry = { data: v, next: null };\n    if (this.length > 0) this.tail.next = entry;else this.head = entry;\n    this.tail = entry;\n    ++this.length;\n  };\n\n  BufferList.prototype.unshift = function unshift(v) {\n    var entry = { data: v, next: this.head };\n    if (this.length === 0) this.tail = entry;\n    this.head = entry;\n    ++this.length;\n  };\n\n  BufferList.prototype.shift = function shift() {\n    if (this.length === 0) return;\n    var ret = this.head.data;\n    if (this.length === 1) this.head = this.tail = null;else this.head = this.head.next;\n    --this.length;\n    return ret;\n  };\n\n  BufferList.prototype.clear = function clear() {\n    this.head = this.tail = null;\n    this.length = 0;\n  };\n\n  BufferList.prototype.join = function join(s) {\n    if (this.length === 0) return '';\n    var p = this.head;\n    var ret = '' + p.data;\n    while (p = p.next) {\n      ret += s + p.data;\n    }return ret;\n  };\n\n  BufferList.prototype.concat = function concat(n) {\n    if (this.length === 0) return Buffer.alloc(0);\n    if (this.length === 1) return this.head.data;\n    var ret = Buffer.allocUnsafe(n >>> 0);\n    var p = this.head;\n    var i = 0;\n    while (p) {\n      copyBuffer(p.data, ret, i);\n      i += p.data.length;\n      p = p.next;\n    }\n    return ret;\n  };\n\n  return BufferList;\n}();\n\nif (util && util.inspect && util.inspect.custom) {\n  module.exports.prototype[util.inspect.custom] = function () {\n    var obj = util.inspect({ length: this.length });\n    return this.constructor.name + ' ' + obj;\n  };\n}","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","\n/**\n * Module exports.\n */\n\nmodule.exports = deprecate;\n\n/**\n * Mark that a method should not be used.\n * Returns a modified function which warns once by default.\n *\n * If `localStorage.noDeprecation = true` is set, then it is a no-op.\n *\n * If `localStorage.throwDeprecation = true` is set, then deprecated functions\n * will throw an Error when invoked.\n *\n * If `localStorage.traceDeprecation = true` is set, then deprecated functions\n * will invoke `console.trace()` instead of `console.error()`.\n *\n * @param {Function} fn - the function to deprecate\n * @param {String} msg - the string to print to the console when `fn` is invoked\n * @returns {Function} a new \"deprecated\" version of `fn`\n * @api public\n */\n\nfunction deprecate (fn, msg) {\n  if (config('noDeprecation')) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (config('throwDeprecation')) {\n        throw new Error(msg);\n      } else if (config('traceDeprecation')) {\n        console.trace(msg);\n      } else {\n        console.warn(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n}\n\n/**\n * Checks `localStorage` for boolean values for the given `name`.\n *\n * @param {String} name\n * @returns {Boolean}\n * @api private\n */\n\nfunction config (name) {\n  // accessing global.localStorage can trigger a DOMException in sandboxed iframes\n  try {\n    if (!global.localStorage) return false;\n  } catch (_) {\n    return false;\n  }\n  var val = global.localStorage[name];\n  if (null == val) return false;\n  return String(val).toLowerCase() === 'true';\n}\n","/* eslint-disable node/no-deprecated-api */\nvar buffer = require('buffer')\nvar Buffer = buffer.Buffer\n\n// alternative to using Object.keys for old browsers\nfunction copyProps (src, dst) {\n  for (var key in src) {\n    dst[key] = src[key]\n  }\n}\nif (Buffer.from && Buffer.alloc && Buffer.allocUnsafe && Buffer.allocUnsafeSlow) {\n  module.exports = buffer\n} else {\n  // Copy properties from require('buffer')\n  copyProps(buffer, exports)\n  exports.Buffer = SafeBuffer\n}\n\nfunction SafeBuffer (arg, encodingOrOffset, length) {\n  return Buffer(arg, encodingOrOffset, length)\n}\n\nSafeBuffer.prototype = Object.create(Buffer.prototype)\n\n// Copy static methods from Buffer\ncopyProps(Buffer, SafeBuffer)\n\nSafeBuffer.from = function (arg, encodingOrOffset, length) {\n  if (typeof arg === 'number') {\n    throw new TypeError('Argument must not be a number')\n  }\n  return Buffer(arg, encodingOrOffset, length)\n}\n\nSafeBuffer.alloc = function (size, fill, encoding) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  var buf = Buffer(size)\n  if (fill !== undefined) {\n    if (typeof encoding === 'string') {\n      buf.fill(fill, encoding)\n    } else {\n      buf.fill(fill)\n    }\n  } else {\n    buf.fill(0)\n  }\n  return buf\n}\n\nSafeBuffer.allocUnsafe = function (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  return Buffer(size)\n}\n\nSafeBuffer.allocUnsafeSlow = function (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  return buffer.SlowBuffer(size)\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a passthrough stream.\n// basically just the most minimal sort of Transform stream.\n// Every written chunk gets output as-is.\n\n'use strict';\n\nmodule.exports = PassThrough;\n\nvar Transform = require('./_stream_transform');\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nutil.inherits(PassThrough, Transform);\n\nfunction PassThrough(options) {\n  if (!(this instanceof PassThrough)) return new PassThrough(options);\n\n  Transform.call(this, options);\n}\n\nPassThrough.prototype._transform = function (chunk, encoding, cb) {\n  cb(null, chunk);\n};","module.exports = require('./lib/_stream_writable.js');\n","module.exports = require('./lib/_stream_duplex.js');\n","module.exports = require('./readable').Transform\n","module.exports = require('./readable').PassThrough\n","/*\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\nvar DEFAULT_PARSER = 'sax';\n\nexports.DEFAULT_PARSER = DEFAULT_PARSER;\n","const schemaResponse = fetch(__ASSET_PREFIX__ + 'assets/mei-all.rng');\nlet worker: Worker, schema: string, statusField: HTMLSpanElement;\n\n/**\n * Update the UI with the validation results. Called when the WebWorker finishes validating.\n */\nfunction updateUI (message: { data: string[] }): void {\n  const errors = message.data;\n  if (errors === null) {\n    statusField.textContent = 'VALID';\n    statusField.style.color = 'green';\n    for (const child of statusField.children) {\n      child.remove();\n    }\n  } else {\n    let log = '';\n    errors.forEach(line => {\n      log += line + '\\n';\n    });\n    statusField.textContent = '';\n    statusField.style.color = 'red';\n    const link = document.createElement('a');\n    link.setAttribute('href', 'data:text/plain;charset=utf-8,' +\n      encodeURIComponent(log));\n    link.setAttribute('download', 'validation.log');\n    link.textContent = 'INVALID';\n    statusField.appendChild(link);\n  }\n}\n\n/**\n * Add the validation information to the display and create the WebWorker\n * for validation MEI.\n */\nexport async function init (): Promise<void> {\n  const displayContents = document.getElementById('displayContents');\n  if (displayContents !== null) {\n    const panelBlock = document.createElement('div');\n    panelBlock.classList.add('panel-block');\n    const pNotif = document.createElement('p');\n    pNotif.textContent = 'MEI Status: ';\n    const span = document.createElement('span');\n    span.id = 'validation_status';\n    span.textContent = 'unknown';\n    pNotif.appendChild(span);\n    panelBlock.appendChild(pNotif);\n    displayContents.appendChild(panelBlock);\n    statusField = document.getElementById('validation_status');\n    worker = new Worker(__ASSET_PREFIX__ + 'workers/Worker.js');\n    worker.onmessage = updateUI;\n  }\n}\n\n/**\n * Send the contents of an MEI file to the WebWorker for validation.\n * @param {string} meiData\n */\nexport async function sendForValidation (meiData: string): Promise<void> {\n  if (statusField === undefined) {\n    return;\n  }\n  if (schema === undefined) {\n    const response = await schemaResponse;\n    schema = await response.text();\n  }\n  statusField.textContent = 'checking...';\n  statusField.style.color = 'gray';\n  worker.postMessage({\n    mei: meiData,\n    schema: schema\n  });\n}\n\n/**\n * Update the message on a blank page when there is no MEI.\n */\nexport function blankPage (): void {\n  for (const child of statusField.children) {\n    child.remove();\n  }\n  statusField.textContent = 'No MEI';\n  statusField.style.color = 'color:gray';\n}\n","import { VerovioMessage } from './Types';\n\n\n/**\n * A wrapper around the verovio web worker to permit mocking in tests.\n */\nexport default class VerovioWrapper {\n  verovioWorker: Worker;\n  constructor () {\n    this.verovioWorker = new Worker(__ASSET_PREFIX__ + 'workers/VerovioWorker.js');\n  }\n\n  /**\n   * Set an event listener onto the actual web worker.\n   */\n  addEventListener (type: string, handler: EventListenerOrEventListenerObject): void {\n    return this.verovioWorker.addEventListener(type, handler);\n  }\n\n  /**\n   * Send a message to the actual web worker.\n   */\n  postMessage (message: VerovioMessage): void {\n    return this.verovioWorker.postMessage(message);\n  }\n}\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","import { NeonManifest } from '../Types';\nconst NeonSchema = require('./manifest/NeonSchema.json');\nconst NeonContext = require('./manifest/context.json');\n\nimport { validate } from 'jsonschema';\n/**\n * Check if the provided Neon manifest is parseable.\n * @param {string} manifestString - The Neon manifest as a string.\n */\nexport function parseManifest (manifestString: NeonManifest): boolean {\n  const results = validate(manifestString, NeonSchema);\n  const instance = results.instance;\n  if (results.errors.length > 0) {\n    console.error(results.errors);\n    return false;\n  }\n  const context = instance['@context'];\n  if (context === 'https://ddmal.music.mcgill.ca/Neon/contexts/1/manifest.jsonld') {\n    return true;\n  }\n  if ((context[0] === NeonContext[0]) &&\n      (context[1]['schema'] === NeonContext[1]['schema']) &&\n      (context[1]['title'] === NeonContext[1]['title']) &&\n      (context[1]['timestamp'] === NeonContext[1]['timestamp']) &&\n      (context[1]['image']['@id'] === NeonContext[1]['image']['@id']) &&\n      (context[1]['image']['@type'] === NeonContext[1]['image']['@type']) &&\n      (context[1]['mei_annotations']['@id'] === NeonContext[1]['mei_annotations']['@id']) &&\n      (context[1]['mei_annotations']['@type'] === NeonContext[1]['mei_annotations']['@type']) &&\n      (context[1]['mei_annotations']['@container'] === NeonContext[1]['mei_annotations']['@container'])) {\n    return true;\n  } else {\n    console.error('Context mismatch');\n    console.error(context);\n    console.error(NeonContext);\n    return false;\n  }\n}\n","'use strict';\n\nvar Validator = module.exports.Validator = require('./validator');\n\nmodule.exports.ValidatorResult = require('./helpers').ValidatorResult;\nmodule.exports.ValidationError = require('./helpers').ValidationError;\nmodule.exports.SchemaError = require('./helpers').SchemaError;\nmodule.exports.SchemaScanResult = require('./scan').SchemaScanResult;\nmodule.exports.scan = require('./scan').scan;\n\nmodule.exports.validate = function (instance, schema, options) {\n  var v = new Validator();\n  return v.validate(instance, schema, options);\n};\n","'use strict';\n\nvar urilib = require('url');\n\nvar attribute = require('./attribute');\nvar helpers = require('./helpers');\nvar scanSchema = require('./scan').scan;\nvar ValidatorResult = helpers.ValidatorResult;\nvar SchemaError = helpers.SchemaError;\nvar SchemaContext = helpers.SchemaContext;\n//var anonymousBase = 'vnd.jsonschema:///';\nvar anonymousBase = '/';\n\n/**\n * Creates a new Validator object\n * @name Validator\n * @constructor\n */\nvar Validator = function Validator () {\n  // Allow a validator instance to override global custom formats or to have their\n  // own custom formats.\n  this.customFormats = Object.create(Validator.prototype.customFormats);\n  this.schemas = {};\n  this.unresolvedRefs = [];\n\n  // Use Object.create to make this extensible without Validator instances stepping on each other's toes.\n  this.types = Object.create(types);\n  this.attributes = Object.create(attribute.validators);\n};\n\n// Allow formats to be registered globally.\nValidator.prototype.customFormats = {};\n\n// Hint at the presence of a property\nValidator.prototype.schemas = null;\nValidator.prototype.types = null;\nValidator.prototype.attributes = null;\nValidator.prototype.unresolvedRefs = null;\n\n/**\n * Adds a schema with a certain urn to the Validator instance.\n * @param schema\n * @param urn\n * @return {Object}\n */\nValidator.prototype.addSchema = function addSchema (schema, base) {\n  var self = this;\n  if (!schema) {\n    return null;\n  }\n  var scan = scanSchema(base||anonymousBase, schema);\n  var ourUri = base || schema.id;\n  for(var uri in scan.id){\n    this.schemas[uri] = scan.id[uri];\n  }\n  for(var uri in scan.ref){\n    this.unresolvedRefs.push(uri);\n  }\n  this.unresolvedRefs = this.unresolvedRefs.filter(function(uri){\n    return typeof self.schemas[uri]==='undefined';\n  });\n  return this.schemas[ourUri];\n};\n\nValidator.prototype.addSubSchemaArray = function addSubSchemaArray(baseuri, schemas) {\n  if(!(schemas instanceof Array)) return;\n  for(var i=0; i<schemas.length; i++){\n    this.addSubSchema(baseuri, schemas[i]);\n  }\n};\n\nValidator.prototype.addSubSchemaObject = function addSubSchemaArray(baseuri, schemas) {\n  if(!schemas || typeof schemas!='object') return;\n  for(var p in schemas){\n    this.addSubSchema(baseuri, schemas[p]);\n  }\n};\n\n\n\n/**\n * Sets all the schemas of the Validator instance.\n * @param schemas\n */\nValidator.prototype.setSchemas = function setSchemas (schemas) {\n  this.schemas = schemas;\n};\n\n/**\n * Returns the schema of a certain urn\n * @param urn\n */\nValidator.prototype.getSchema = function getSchema (urn) {\n  return this.schemas[urn];\n};\n\n/**\n * Validates instance against the provided schema\n * @param instance\n * @param schema\n * @param [options]\n * @param [ctx]\n * @return {Array}\n */\nValidator.prototype.validate = function validate (instance, schema, options, ctx) {\n  if (!options) {\n    options = {};\n  }\n  var propertyName = options.propertyName || 'instance';\n  // This will work so long as the function at uri.resolve() will resolve a relative URI to a relative URI\n  var base = urilib.resolve(options.base||anonymousBase, schema.id||'');\n  if(!ctx){\n    ctx = new SchemaContext(schema, options, propertyName, base, Object.create(this.schemas));\n    if (!ctx.schemas[base]) {\n      ctx.schemas[base] = schema;\n    }\n    var found = scanSchema(base, schema);\n    for(var n in found.id){\n      var sch = found.id[n];\n      ctx.schemas[n] = sch;\n    }\n  }\n  if (schema) {\n    var result = this.validateSchema(instance, schema, options, ctx);\n    if (!result) {\n      throw new Error('Result undefined');\n    }\n    return result;\n  }\n  throw new SchemaError('no schema specified', schema);\n};\n\n/**\n* @param Object schema\n* @return mixed schema uri or false\n*/\nfunction shouldResolve(schema) {\n  var ref = (typeof schema === 'string') ? schema : schema.$ref;\n  if (typeof ref=='string') return ref;\n  return false;\n}\n\n/**\n * Validates an instance against the schema (the actual work horse)\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @private\n * @return {ValidatorResult}\n */\nValidator.prototype.validateSchema = function validateSchema (instance, schema, options, ctx) {\n  var result = new ValidatorResult(instance, schema, options, ctx);\n\n    // Support for the true/false schemas\n  if(typeof schema==='boolean') {\n    if(schema===true){\n      // `true` is always valid\n      schema = {};\n    }else if(schema===false){\n      // `false` is always invalid\n      schema = {type: []};\n    }\n  }else if(!schema){\n    // This might be a string\n    throw new Error(\"schema is undefined\");\n  }\n\n  if (schema['extends']) {\n    if (schema['extends'] instanceof Array) {\n      var schemaobj = {schema: schema, ctx: ctx};\n      schema['extends'].forEach(this.schemaTraverser.bind(this, schemaobj));\n      schema = schemaobj.schema;\n      schemaobj.schema = null;\n      schemaobj.ctx = null;\n      schemaobj = null;\n    } else {\n      schema = helpers.deepMerge(schema, this.superResolve(schema['extends'], ctx));\n    }\n  }\n\n  // If passed a string argument, load that schema URI\n  var switchSchema;\n  if (switchSchema = shouldResolve(schema)) {\n    var resolved = this.resolve(schema, switchSchema, ctx);\n    var subctx = new SchemaContext(resolved.subschema, options, ctx.propertyPath, resolved.switchSchema, ctx.schemas);\n    return this.validateSchema(instance, resolved.subschema, options, subctx);\n  }\n\n  var skipAttributes = options && options.skipAttributes || [];\n  // Validate each schema attribute against the instance\n  for (var key in schema) {\n    if (!attribute.ignoreProperties[key] && skipAttributes.indexOf(key) < 0) {\n      var validatorErr = null;\n      var validator = this.attributes[key];\n      if (validator) {\n        validatorErr = validator.call(this, instance, schema, options, ctx);\n      } else if (options.allowUnknownAttributes === false) {\n        // This represents an error with the schema itself, not an invalid instance\n        throw new SchemaError(\"Unsupported attribute: \" + key, schema);\n      }\n      if (validatorErr) {\n        result.importErrors(validatorErr);\n      }\n    }\n  }\n\n  if (typeof options.rewrite == 'function') {\n    var value = options.rewrite.call(this, instance, schema, options, ctx);\n    result.instance = value;\n  }\n  return result;\n};\n\n/**\n* @private\n* @param Object schema\n* @param SchemaContext ctx\n* @returns Object schema or resolved schema\n*/\nValidator.prototype.schemaTraverser = function schemaTraverser (schemaobj, s) {\n  schemaobj.schema = helpers.deepMerge(schemaobj.schema, this.superResolve(s, schemaobj.ctx));\n}\n\n/**\n* @private\n* @param Object schema\n* @param SchemaContext ctx\n* @returns Object schema or resolved schema\n*/\nValidator.prototype.superResolve = function superResolve (schema, ctx) {\n  var ref;\n  if(ref = shouldResolve(schema)) {\n    return this.resolve(schema, ref, ctx).subschema;\n  }\n  return schema;\n}\n\n/**\n* @private\n* @param Object schema\n* @param Object switchSchema\n* @param SchemaContext ctx\n* @return Object resolved schemas {subschema:String, switchSchema: String}\n* @throws SchemaError\n*/\nValidator.prototype.resolve = function resolve (schema, switchSchema, ctx) {\n  switchSchema = ctx.resolve(switchSchema);\n  // First see if the schema exists under the provided URI\n  if (ctx.schemas[switchSchema]) {\n    return {subschema: ctx.schemas[switchSchema], switchSchema: switchSchema};\n  }\n  // Else try walking the property pointer\n  var parsed = urilib.parse(switchSchema);\n  var fragment = parsed && parsed.hash;\n  var document = fragment && fragment.length && switchSchema.substr(0, switchSchema.length - fragment.length);\n  if (!document || !ctx.schemas[document]) {\n    throw new SchemaError(\"no such schema <\" + switchSchema + \">\", schema);\n  }\n  var subschema = helpers.objectGetPath(ctx.schemas[document], fragment.substr(1));\n  if(subschema===undefined){\n    throw new SchemaError(\"no such schema \" + fragment + \" located in <\" + document + \">\", schema);\n  }\n  return {subschema: subschema, switchSchema: switchSchema};\n};\n\n/**\n * Tests whether the instance if of a certain type.\n * @private\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @param type\n * @return {boolean}\n */\nValidator.prototype.testType = function validateType (instance, schema, options, ctx, type) {\n  if (typeof this.types[type] == 'function') {\n    return this.types[type].call(this, instance);\n  }\n  if (type && typeof type == 'object') {\n    var res = this.validateSchema(instance, type, options, ctx);\n    return res === undefined || !(res && res.errors.length);\n  }\n  // Undefined or properties not on the list are acceptable, same as not being defined\n  return true;\n};\n\nvar types = Validator.prototype.types = {};\ntypes.string = function testString (instance) {\n  return typeof instance == 'string';\n};\ntypes.number = function testNumber (instance) {\n  // isFinite returns false for NaN, Infinity, and -Infinity\n  return typeof instance == 'number' && isFinite(instance);\n};\ntypes.integer = function testInteger (instance) {\n  return (typeof instance == 'number') && instance % 1 === 0;\n};\ntypes.boolean = function testBoolean (instance) {\n  return typeof instance == 'boolean';\n};\ntypes.array = function testArray (instance) {\n  return Array.isArray(instance);\n};\ntypes['null'] = function testNull (instance) {\n  return instance === null;\n};\ntypes.date = function testDate (instance) {\n  return instance instanceof Date;\n};\ntypes.any = function testAny (instance) {\n  return true;\n};\ntypes.object = function testObject (instance) {\n  // TODO: fix this - see #15\n  return instance && (typeof instance) === 'object' && !(instance instanceof Array) && !(instance instanceof Date);\n};\n\nmodule.exports = Validator;\n","/*! https://mths.be/punycode v1.4.1 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports &&\n\t\t!exports.nodeType && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\t!module.nodeType && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (\n\t\tfreeGlobal.global === freeGlobal ||\n\t\tfreeGlobal.window === freeGlobal ||\n\t\tfreeGlobal.self === freeGlobal\n\t) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^\\x20-\\x7E]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow new RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\tvar result = [];\n\t\twhile (length--) {\n\t\t\tresult[length] = fn(array[length]);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t * addresses.\n\t * @private\n\t * @param {String} domain The domain name or email address.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\tvar parts = string.split('@');\n\t\tvar result = '';\n\t\tif (parts.length > 1) {\n\t\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t\t// the local part (i.e. everything up to `@`) intact.\n\t\t\tresult = parts[0] + '@';\n\t\t\tstring = parts[1];\n\t\t}\n\t\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\t\tstring = string.replace(regexSeparators, '\\x2E');\n\t\tvar labels = string.split('.');\n\t\tvar encoded = map(labels, fn).join('.');\n\t\treturn result + encoded;\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * https://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t * Punycode string of ASCII-only symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name or an email address\n\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t * it doesn't matter if you call it on a string that has already been\n\t * converted to Unicode.\n\t * @memberOf punycode\n\t * @param {String} input The Punycoded domain name or email address to\n\t * convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name or an email address to\n\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t * ASCII.\n\t * @memberOf punycode\n\t * @param {String} input The domain name or email address to convert, as a\n\t * Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name or\n\t * email address.\n\t */\n\tfunction toASCII(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.4.1',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && freeModule) {\n\t\tif (module.exports == freeExports) {\n\t\t\t// in Node.js, io.js, or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else {\n\t\t\t// in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n","module.exports = function(module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function() {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","'use strict';\n\nmodule.exports = {\n  isString: function(arg) {\n    return typeof(arg) === 'string';\n  },\n  isObject: function(arg) {\n    return typeof(arg) === 'object' && arg !== null;\n  },\n  isNull: function(arg) {\n    return arg === null;\n  },\n  isNullOrUndefined: function(arg) {\n    return arg == null;\n  }\n};\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n","'use strict';\n\nvar helpers = require('./helpers');\n\n/** @type ValidatorResult */\nvar ValidatorResult = helpers.ValidatorResult;\n/** @type SchemaError */\nvar SchemaError = helpers.SchemaError;\n\nvar attribute = {};\n\nattribute.ignoreProperties = {\n  // informative properties\n  'id': true,\n  'default': true,\n  'description': true,\n  'title': true,\n  // arguments to other properties\n  'exclusiveMinimum': true,\n  'exclusiveMaximum': true,\n  'additionalItems': true,\n  // special-handled properties\n  '$schema': true,\n  '$ref': true,\n  'extends': true\n};\n\n/**\n * @name validators\n */\nvar validators = attribute.validators = {};\n\n/**\n * Validates whether the instance if of a certain type\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {ValidatorResult|null}\n */\nvalidators.type = function validateType (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var types = Array.isArray(schema.type) ? schema.type : [schema.type];\n  if (!types.some(this.testType.bind(this, instance, schema, options, ctx))) {\n    var list = types.map(function (v) {\n      return v.id && ('<' + v.id + '>') || (v+'');\n    });\n    result.addError({\n      name: 'type',\n      argument: list,\n      message: \"is not of a type(s) \" + list,\n    });\n  }\n  return result;\n};\n\nfunction testSchemaNoThrow(instance, options, ctx, callback, schema){\n  var throwError = options.throwError;\n  options.throwError = false;\n  var res = this.validateSchema(instance, schema, options, ctx);\n  options.throwError = throwError;\n\n  if (! res.valid && callback instanceof Function) {\n    callback(res);\n  }\n  return res.valid;\n}\n\n/**\n * Validates whether the instance matches some of the given schemas\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {ValidatorResult|null}\n */\nvalidators.anyOf = function validateAnyOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var inner = new ValidatorResult(instance, schema, options, ctx);\n  if (!Array.isArray(schema.anyOf)){\n    throw new SchemaError(\"anyOf must be an array\");\n  }\n  if (!schema.anyOf.some(\n    testSchemaNoThrow.bind(\n      this, instance, options, ctx, function(res){inner.importErrors(res);}\n      ))) {\n    var list = schema.anyOf.map(function (v, i) {\n      return (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n    });\n    if (options.nestedErrors) {\n      result.importErrors(inner);\n    }\n    result.addError({\n      name: 'anyOf',\n      argument: list,\n      message: \"is not any of \" + list.join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance matches every given schema\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.allOf = function validateAllOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema.allOf)){\n    throw new SchemaError(\"allOf must be an array\");\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var self = this;\n  schema.allOf.forEach(function(v, i){\n    var valid = self.validateSchema(instance, v, options, ctx);\n    if(!valid.valid){\n      var msg = (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n      result.addError({\n        name: 'allOf',\n        argument: { id: msg, length: valid.errors.length, valid: valid },\n        message: 'does not match allOf schema ' + msg + ' with ' + valid.errors.length + ' error[s]:',\n      });\n      result.importErrors(valid);\n    }\n  });\n  return result;\n};\n\n/**\n * Validates whether the instance matches exactly one of the given schemas\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.oneOf = function validateOneOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema.oneOf)){\n    throw new SchemaError(\"oneOf must be an array\");\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var inner = new ValidatorResult(instance, schema, options, ctx);\n  var count = schema.oneOf.filter(\n    testSchemaNoThrow.bind(\n      this, instance, options, ctx, function(res) {inner.importErrors(res);}\n      ) ).length;\n  var list = schema.oneOf.map(function (v, i) {\n    return (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n  });\n  if (count!==1) {\n    if (options.nestedErrors) {\n      result.importErrors(inner);\n    }\n    result.addError({\n      name: 'oneOf',\n      argument: list,\n      message: \"is not exactly one from \" + list.join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates properties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.properties = function validateProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var properties = schema.properties || {};\n  for (var property in properties) {\n    if (typeof options.preValidateProperty == 'function') {\n      options.preValidateProperty(instance, property, properties[property], options, ctx);\n    }\n\n    var prop = Object.hasOwnProperty.call(instance, property) ? instance[property] : undefined;\n    var res = this.validateSchema(prop, properties[property], options, ctx.makeChild(properties[property], property));\n    if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n    result.importErrors(res);\n  }\n  return result;\n};\n\n/**\n * Test a specific property within in instance against the additionalProperties schema attribute\n * This ignores properties with definitions in the properties schema attribute, but no other attributes.\n * If too many more types of property-existance tests pop up they may need their own class of tests (like `type` has)\n * @private\n * @return {boolean}\n */\nfunction testAdditionalProperty (instance, schema, options, ctx, property, result) {\n  if(!this.types.object(instance)) return;\n  if (schema.properties && schema.properties[property] !== undefined) {\n    return;\n  }\n  if (schema.additionalProperties === false) {\n    result.addError({\n      name: 'additionalProperties',\n      argument: property,\n      message: \"additionalProperty \" + JSON.stringify(property) + \" exists in instance when not allowed\",\n    });\n  } else {\n    var additionalProperties = schema.additionalProperties || {};\n\n    if (typeof options.preValidateProperty == 'function') {\n      options.preValidateProperty(instance, property, additionalProperties, options, ctx);\n    }\n\n    var res = this.validateSchema(instance[property], additionalProperties, options, ctx.makeChild(additionalProperties, property));\n    if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n    result.importErrors(res);\n  }\n}\n\n/**\n * Validates patternProperties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.patternProperties = function validatePatternProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var patternProperties = schema.patternProperties || {};\n\n  for (var property in instance) {\n    var test = true;\n    for (var pattern in patternProperties) {\n      var expr = new RegExp(pattern);\n      if (!expr.test(property)) {\n        continue;\n      }\n      test = false;\n\n      if (typeof options.preValidateProperty == 'function') {\n        options.preValidateProperty(instance, property, patternProperties[pattern], options, ctx);\n      }\n\n      var res = this.validateSchema(instance[property], patternProperties[pattern], options, ctx.makeChild(patternProperties[pattern], property));\n      if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n      result.importErrors(res);\n    }\n    if (test) {\n      testAdditionalProperty.call(this, instance, schema, options, ctx, property, result);\n    }\n  }\n\n  return result;\n};\n\n/**\n * Validates additionalProperties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.additionalProperties = function validateAdditionalProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  // if patternProperties is defined then we'll test when that one is called instead\n  if (schema.patternProperties) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  for (var property in instance) {\n    testAdditionalProperty.call(this, instance, schema, options, ctx, property, result);\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at least of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minProperties = function validateMinProperties (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var keys = Object.keys(instance);\n  if (!(keys.length >= schema.minProperties)) {\n    result.addError({\n      name: 'minProperties',\n      argument: schema.minProperties,\n      message: \"does not meet minimum property length of \" + schema.minProperties,\n    })\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at most of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxProperties = function validateMaxProperties (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var keys = Object.keys(instance);\n  if (!(keys.length <= schema.maxProperties)) {\n    result.addError({\n      name: 'maxProperties',\n      argument: schema.maxProperties,\n      message: \"does not meet maximum property length of \" + schema.maxProperties,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates items when instance is an array\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.items = function validateItems (instance, schema, options, ctx) {\n  var self = this;\n  if (!this.types.array(instance)) return;\n  if (!schema.items) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  instance.every(function (value, i) {\n    var items = Array.isArray(schema.items) ? (schema.items[i] || schema.additionalItems) : schema.items;\n    if (items === undefined) {\n      return true;\n    }\n    if (items === false) {\n      result.addError({\n        name: 'items',\n        message: \"additionalItems not permitted\",\n      });\n      return false;\n    }\n    var res = self.validateSchema(value, items, options, ctx.makeChild(items, i));\n    if(res.instance !== result.instance[i]) result.instance[i] = res.instance;\n    result.importErrors(res);\n    return true;\n  });\n  return result;\n};\n\n/**\n * Validates minimum and exclusiveMinimum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minimum = function validateMinimum (instance, schema, options, ctx) {\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var valid = true;\n  if (schema.exclusiveMinimum && schema.exclusiveMinimum === true) {\n    valid = instance > schema.minimum;\n  } else {\n    valid = instance >= schema.minimum;\n  }\n  if (!valid) {\n    result.addError({\n      name: 'minimum',\n      argument: schema.minimum,\n      message: \"must have a minimum value of \" + schema.minimum,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates maximum and exclusiveMaximum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maximum = function validateMaximum (instance, schema, options, ctx) {\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var valid;\n  if (schema.exclusiveMaximum && schema.exclusiveMaximum === true) {\n    valid = instance < schema.maximum;\n  } else {\n    valid = instance <= schema.maximum;\n  }\n  if (!valid) {\n    result.addError({\n      name: 'maximum',\n      argument: schema.maximum,\n      message: \"must have a maximum value of \" + schema.maximum,\n    });\n  }\n  return result;\n};\n\n/**\n * Perform validation for multipleOf and divisibleBy, which are essentially the same.\n * @param instance\n * @param schema\n * @param validationType\n * @param errorMessage\n * @returns {String|null}\n */\nvar validateMultipleOfOrDivisbleBy = function validateMultipleOfOrDivisbleBy (instance, schema, options, ctx, validationType, errorMessage) {\n  if (!this.types.number(instance)) return;\n\n  var validationArgument = schema[validationType];\n  if (validationArgument == 0) {\n    throw new SchemaError(validationType + \" cannot be zero\");\n  }\n\n  var result = new ValidatorResult(instance, schema, options, ctx);\n\n  var instanceDecimals = helpers.getDecimalPlaces(instance);\n  var divisorDecimals = helpers.getDecimalPlaces(validationArgument);\n\n  var maxDecimals = Math.max(instanceDecimals , divisorDecimals);\n  var multiplier = Math.pow(10, maxDecimals);\n\n  if (Math.round(instance * multiplier) % Math.round(validationArgument * multiplier) !== 0) {\n    result.addError({\n      name: validationType,\n      argument:  validationArgument,\n      message: errorMessage + JSON.stringify(validationArgument)\n    });\n  }\n\n  return result;\n};\n\n/**\n * Validates divisibleBy when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.multipleOf = function validateMultipleOf (instance, schema, options, ctx) {\n return validateMultipleOfOrDivisbleBy.call(this, instance, schema, options, ctx, \"multipleOf\", \"is not a multiple of (divisible by) \");\n};\n\n/**\n * Validates multipleOf when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.divisibleBy = function validateDivisibleBy (instance, schema, options, ctx) {\n  return validateMultipleOfOrDivisbleBy.call(this, instance, schema, options, ctx, \"divisibleBy\", \"is not divisible by (multiple of) \");\n};\n\n/**\n * Validates whether the instance value is present.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.required = function validateRequired (instance, schema, options, ctx) {\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (instance === undefined && schema.required === true) {\n    // A boolean form is implemented for reverse-compatability with schemas written against older drafts\n    result.addError({\n      name: 'required',\n      message: \"is required\"\n    });\n  } else if (this.types.object(instance) && Array.isArray(schema.required)) {\n    schema.required.forEach(function(n){\n      if(instance[n]===undefined){\n        result.addError({\n          name: 'required',\n          argument: n,\n          message: \"requires property \" + JSON.stringify(n),\n        });\n      }\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value matches the regular expression, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.pattern = function validatePattern (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!instance.match(schema.pattern)) {\n    result.addError({\n      name: 'pattern',\n      argument: schema.pattern,\n      message: \"does not match pattern \" + JSON.stringify(schema.pattern),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is of a certain defined format or a custom\n * format.\n * The following formats are supported for string types:\n *   - date-time\n *   - date\n *   - time\n *   - ip-address\n *   - ipv6\n *   - uri\n *   - color\n *   - host-name\n *   - alpha\n *   - alpha-numeric\n *   - utc-millisec\n * @param instance\n * @param schema\n * @param [options]\n * @param [ctx]\n * @return {String|null}\n */\nvalidators.format = function validateFormat (instance, schema, options, ctx) {\n  if (instance===undefined) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!result.disableFormat && !helpers.isFormat(instance, schema.format, this)) {\n    result.addError({\n      name: 'format',\n      argument: schema.format,\n      message: \"does not conform to the \" + JSON.stringify(schema.format) + \" format\",\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at least of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minLength = function validateMinLength (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var hsp = instance.match(/[\\uDC00-\\uDFFF]/g);\n  var length = instance.length - (hsp ? hsp.length : 0);\n  if (!(length >= schema.minLength)) {\n    result.addError({\n      name: 'minLength',\n      argument: schema.minLength,\n      message: \"does not meet minimum length of \" + schema.minLength,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at most of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxLength = function validateMaxLength (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  // TODO if this was already computed in \"minLength\", use that value instead of re-computing\n  var hsp = instance.match(/[\\uDC00-\\uDFFF]/g);\n  var length = instance.length - (hsp ? hsp.length : 0);\n  if (!(length <= schema.maxLength)) {\n    result.addError({\n      name: 'maxLength',\n      argument: schema.maxLength,\n      message: \"does not meet maximum length of \" + schema.maxLength,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether instance contains at least a minimum number of items, when the instance is an Array.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minItems = function validateMinItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!(instance.length >= schema.minItems)) {\n    result.addError({\n      name: 'minItems',\n      argument: schema.minItems,\n      message: \"does not meet minimum length of \" + schema.minItems,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether instance contains no more than a maximum number of items, when the instance is an Array.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxItems = function validateMaxItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!(instance.length <= schema.maxItems)) {\n    result.addError({\n      name: 'maxItems',\n      argument: schema.maxItems,\n      message: \"does not meet maximum length of \" + schema.maxItems,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates that every item in an instance array is unique, when instance is an array\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.uniqueItems = function validateUniqueItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  function testArrays (v, i, a) {\n    for (var j = i + 1; j < a.length; j++) if (helpers.deepCompareStrict(v, a[j])) {\n      return false;\n    }\n    return true;\n  }\n  if (!instance.every(testArrays)) {\n    result.addError({\n      name: 'uniqueItems',\n      message: \"contains duplicate item\",\n    });\n  }\n  return result;\n};\n\n/**\n * Deep compares arrays for duplicates\n * @param v\n * @param i\n * @param a\n * @private\n * @return {boolean}\n */\nfunction testArrays (v, i, a) {\n  var j, len = a.length;\n  for (j = i + 1, len; j < len; j++) {\n    if (helpers.deepCompareStrict(v, a[j])) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Validates whether there are no duplicates, when the instance is an Array.\n * @param instance\n * @return {String|null}\n */\nvalidators.uniqueItems = function validateUniqueItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!instance.every(testArrays)) {\n    result.addError({\n      name: 'uniqueItems',\n      message: \"contains duplicate item\",\n    });\n  }\n  return result;\n};\n\n/**\n * Validate for the presence of dependency properties, if the instance is an object.\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {null|ValidatorResult}\n */\nvalidators.dependencies = function validateDependencies (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  for (var property in schema.dependencies) {\n    if (instance[property] === undefined) {\n      continue;\n    }\n    var dep = schema.dependencies[property];\n    var childContext = ctx.makeChild(dep, property);\n    if (typeof dep == 'string') {\n      dep = [dep];\n    }\n    if (Array.isArray(dep)) {\n      dep.forEach(function (prop) {\n        if (instance[prop] === undefined) {\n          result.addError({\n            // FIXME there's two different \"dependencies\" errors here with slightly different outputs\n            // Can we make these the same? Or should we create different error types?\n            name: 'dependencies',\n            argument: childContext.propertyPath,\n            message: \"property \" + prop + \" not found, required by \" + childContext.propertyPath,\n          });\n        }\n      });\n    } else {\n      var res = this.validateSchema(instance, dep, options, childContext);\n      if(result.instance !== res.instance) result.instance = res.instance;\n      if (res && res.errors.length) {\n        result.addError({\n          name: 'dependencies',\n          argument: childContext.propertyPath,\n          message: \"does not meet dependency required by \" + childContext.propertyPath,\n        });\n        result.importErrors(res);\n      }\n    }\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is one of the enumerated values.\n *\n * @param instance\n * @param schema\n * @return {ValidatorResult|null}\n */\nvalidators['enum'] = function validateEnum (instance, schema, options, ctx) {\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema['enum'])) {\n    throw new SchemaError(\"enum expects an array\", schema);\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!schema['enum'].some(helpers.deepCompareStrict.bind(null, instance))) {\n    result.addError({\n      name: 'enum',\n      argument: schema['enum'],\n      message: \"is not one of enum values: \" + schema['enum'].map(String).join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance exactly matches a given value\n *\n * @param instance\n * @param schema\n * @return {ValidatorResult|null}\n */\nvalidators['const'] = function validateEnum (instance, schema, options, ctx) {\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!helpers.deepCompareStrict(schema['const'], instance)) {\n    result.addError({\n      name: 'const',\n      argument: schema['const'],\n      message: \"does not exactly match expected constant: \" + schema['const'],\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance if of a prohibited type.\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {null|ValidatorResult}\n */\nvalidators.not = validators.disallow = function validateNot (instance, schema, options, ctx) {\n  var self = this;\n  if(instance===undefined) return null;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var notTypes = schema.not || schema.disallow;\n  if(!notTypes) return null;\n  if(!Array.isArray(notTypes)) notTypes=[notTypes];\n  notTypes.forEach(function (type) {\n    if (self.testType(instance, schema, options, ctx, type)) {\n      var schemaId = type && type.id && ('<' + type.id + '>') || type;\n      result.addError({\n        name: 'not',\n        argument: schemaId,\n        message: \"is of prohibited type \" + schemaId,\n      });\n    }\n  });\n  return result;\n};\n\nmodule.exports = attribute;\n","import * as Notification from './Notification';\nimport NeonView from '../NeonView';\nimport { navbarDropdownMenu, undoRedoPanel } from './EditContents';\nimport { convertStaffToSb } from './ConvertMei';\n\n/**\n * prepare the edit mode button\n */\nexport function prepareEditMode (neonView: NeonView): void {\n  const parent = document.getElementById('dropdown_toggle');\n  const editItem = document.createElement('a');\n  editItem.classList.add('navbar-item');\n  const editButton = document.createElement('button');\n  editButton.classList.add('button');\n  editButton.id = 'edit_mode';\n  editButton.textContent = 'Edit MEI';\n  editItem.appendChild(editButton);\n  parent.appendChild(editItem);\n\n  editButton.addEventListener('click', () => {\n    startEditMode(neonView);\n  });\n}\n\n/**\n * start the basic edit mode features\n * is called when the edit mode button is clicked\n */\nexport function startEditMode (neonView: NeonView): void {\n  const parent: HTMLElement = document.getElementById('dropdown_toggle').parentElement;\n  document.getElementById('dropdown_toggle').remove();\n  parent.prepend(navbarDropdownMenu);\n  document.getElementById('undoRedo_controls').innerHTML = undoRedoPanel;\n  initNavbar(neonView);\n  initUndoRedoPanel(neonView);\n\n  const selectionHighlight = document.createElement('a');\n  const divider = document.createElement('hr');\n  divider.classList.add('dropdown-divider');\n  selectionHighlight.classList.add('dropdown-item');\n  selectionHighlight.id = 'highlight-selection';\n  selectionHighlight.textContent = 'By Selection Mode';\n  (document.getElementsByClassName('dropdown-content'))[0].appendChild(divider);\n  (document.getElementsByClassName('dropdown-content'))[0].appendChild(selectionHighlight);\n}\n\n/**\n * Set listener on switching EditMode button to File dropdown in the navbar.\n */\nexport function initNavbar (neonView: NeonView): void {\n  // setup navbar listeners\n  document.getElementById('save').addEventListener('click', () => {\n    neonView.save().then(() => {\n      Notification.queueNotification('Saved');\n    });\n  });\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === 's') {\n      neonView.save().then(() => {\n        Notification.queueNotification('Saved');\n      });\n    }\n  });\n\n  document.getElementById('export').addEventListener('click', () => {\n    neonView.export().then(manifest => {\n      const link: HTMLAnchorElement = document.createElement('a');\n      link.href = manifest as string;\n      link.download = neonView.name + '.jsonld';\n      document.body.appendChild(link);\n      link.click();\n      link.remove();\n      Notification.queueNotification('Saved');\n    });\n  });\n\n  document.getElementById('revert').addEventListener('click', function () {\n    if (window.confirm('Reverting will cause all changes to be lost. Press OK to continue.')) {\n      neonView.deleteDb().then(() => {\n        window.location.reload();\n      });\n    }\n  });\n  // Download link for MEI\n  // Is an actual file with a valid URI except in local mode where it must be generated.\n  document.getElementById('getmei').addEventListener('click', () => {\n    const uri = neonView.view.getCurrentPageURI();\n    neonView.getPageMEI(uri).then(mei => {\n      const data = 'data:application/mei+xml;base64,' + window.btoa(convertStaffToSb(mei));\n      document.getElementById('getmei').setAttribute('href', data);\n      document.getElementById('getmei').setAttribute('download', neonView.view.getPageName() + '.mei');\n    });\n  });\n}\n\n/**\n * Initialize the undo/redo panel\n */\nexport function initUndoRedoPanel (neonView: NeonView): void {\n  document.getElementById('undo').addEventListener('click', undoHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === 'z' && (evt.ctrlKey || evt.metaKey)) {\n      undoHandler();\n    }\n  });\n\n  document.getElementById('redo').addEventListener('click', redoHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if ((evt.key === 'Z' || (evt.key === 'z' && evt.shiftKey)) && (evt.ctrlKey || evt.metaKey)) {\n      redoHandler();\n    }\n  });\n\n  /**\n   * Tries to undo an action and update the page if it succeeds.\n   */\n  function undoHandler (): void {\n    neonView.undo().then((result: boolean) => {\n      if (result) {\n        neonView.updateForCurrentPage();\n      } else {\n        console.error('Failed to undo action');\n      }\n    });\n  }\n\n  /**\n   * Tries to redo an action and update the page if it succeeds.\n   */\n  function redoHandler (): void {\n    neonView.redo().then((result: boolean) => {\n      if (result) {\n        neonView.updateForCurrentPage();\n      } else {\n        console.error('Failed to redo action');\n      }\n    });\n  }\n}\n","/**\n * Contents of navbar menu after switching to edit mode.\n */\nexport const navbarDropdownMenu: HTMLDivElement = document.createElement('div');\nnavbarDropdownMenu.classList.add('navbar-item', 'has-dropdown', 'is-hoverable');\nconst fileLink = document.createElement('a');\nfileLink.classList.add('navbar-link');\nfileLink.textContent = 'File';\nconst navbarContents = document.createElement('div');\nnavbarContents.classList.add('navbar-dropdown');\nnavbarContents.id = 'navbar-dropdown-options';\nconst contents = [['save', 'Save'], ['export', 'Save and Export to File'],\n  ['getmei', 'Download MEI'], ['revert', 'Revert']];\ncontents.forEach(content => {\n  const item = document.createElement('a');\n  item.id = content[0];\n  item.classList.add('navbar-item');\n  item.textContent = content[1];\n  navbarContents.appendChild(item);\n});\nnavbarDropdownMenu.appendChild(fileLink);\nnavbarDropdownMenu.appendChild(navbarContents);\n\n/**\n * Finalize option in the navbar for rodan\n */\nexport const navbarFinalize =\n    '<a id=\\'finalize\\' class=\\'navbar-item\\'> Finalize MEI </a>';\n\n/**\n * Contents of the undo/redo panel with buttons\n */\nexport const undoRedoPanel: string =\n    '<div class=\\'field has-addons buttons\\' style=\\'overflow-x: auto;\\'>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'undo\\'>Undo</button>' +\n    '<button class=\\'button\\' id=\\'redo\\'>Redo</button></p></a></div>';\n","async function setBody (): Promise<void> {\n  const response = await fetch(__ASSET_PREFIX__ + 'assets/template.html');\n  document.body.innerHTML = await response.text();\n  (document.getElementById('home-link') as HTMLAnchorElement)\n    .href = __LINK_LOCATION__;\n  document.getElementById('neon-version').textContent = __NEON_VERSION__;\n}\n\nexport { setBody as default };\n","import * as d3 from 'd3';\n\nexport class ViewBox {\n  a: number;\n  b: number;\n  c: number;\n  d: number;\n\n  imageHeight: number;\n  imageWidth: number;\n\n  constructor (imageWidth: number, imageHeight: number) {\n    this.a = 0;\n    this.b = 0;\n    this.c = imageWidth;\n    this.d = imageHeight;\n\n    this.imageWidth = imageWidth;\n    this.imageHeight = imageHeight;\n  }\n\n  set (w: number, x: number, y: number, z: number): void {\n    this.a = w;\n    this.b = x;\n    this.c = y;\n    this.d = z;\n  }\n\n  get (): string {\n    return this.a.toString() + ' ' + this.b.toString() + ' ' +\n      this.c + ' ' + this.d;\n  }\n\n  zoomTo (k: number): void {\n    const zoomHeight = (this.imageHeight / k);\n    const zoomWidth = (this.imageWidth / k);\n\n    this.c = zoomWidth;\n    this.d = zoomHeight;\n  }\n\n  getZoom (): number {\n    return this.imageWidth / this.c;\n  }\n\n  translate (xDiff: number, yDiff: number): void {\n    this.a += xDiff;\n    this.b += yDiff;\n  }\n}\n\nexport class ZoomHandler {\n  dragCoordinates: DOMPoint;\n  viewBox: ViewBox;\n  matrix: DOMMatrix;\n\n  /**\n   * reset the zoom and pan of the SVG viewbox\n   */\n  resetZoomAndPan (): void {\n    const bgimg = document.getElementById('bgimg') as HTMLImageElement;\n    this.viewBox = new ViewBox(parseInt(bgimg.getAttribute('width')), parseInt(bgimg.getAttribute('height')));\n\n    this.updateViewBox();\n  }\n\n  /**\n   * Zoom to a certain factor.\n   */\n  zoomTo (k: number): void {\n    this.getViewBox();\n    this.viewBox.zoomTo(k);\n    this.updateViewBox();\n  }\n\n  /**\n   * Translate the view box by relative coordinates.\n   */\n  translate (xDiff: number, yDiff: number): void {\n    this.getViewBox();\n    this.viewBox.translate(xDiff, yDiff);\n    this.updateViewBox();\n  }\n\n  /**\n   * Restore the view box to its position before the editor action.\n   */\n  restoreTransformation (): void {\n    if (this.viewBox === undefined) {\n      this.resetZoomAndPan();\n    } else {\n      this.updateViewBox();\n    }\n  }\n\n  /**\n   * Get the view box from the SVG in the page.\n   */\n  getViewBox (): void {\n    if (this.viewBox === undefined) {\n      const bgimg = document.getElementById('bgimg') as HTMLImageElement;\n      this.viewBox = new ViewBox(parseInt(bgimg.getAttribute('width')), parseInt(bgimg.getAttribute('height')));\n    }\n    const rawViewBox = document.getElementById('svg_group')\n      .getAttribute('viewBox')\n      .split(' ');\n    this.viewBox.set(\n      parseInt(rawViewBox[0]),\n      parseInt(rawViewBox[1]),\n      parseInt(rawViewBox[2]),\n      parseInt(rawViewBox[3])\n    );\n  }\n\n  /**\n   * Update the viewBox attribute of svg_group\n   */\n  updateViewBox (): void {\n    document.getElementById('svg_group').setAttribute('viewBox', this.viewBox.get());\n  }\n\n  startDrag (): void {\n    const group = document.getElementById('svg_group') as unknown as SVGSVGElement;\n    this.dragCoordinates = group.createSVGPoint();\n    if (d3.event.type === 'touchstart') {\n      // If drag is triggered by a touch event\n      this.dragCoordinates.x = d3.event.touches[0].screenX;\n      this.dragCoordinates.y = d3.event.touches[0].screenY;\n    } else {\n      // Otherwise triggered by a mouse click\n      this.dragCoordinates.x = d3.event.x;\n      this.dragCoordinates.y = d3.event.y;\n    }\n\n    this.matrix = group.getScreenCTM().inverse();\n  }\n\n  dragging (): void {\n    const group = document.getElementById('svg_group') as unknown as SVGSVGElement;\n    const newCoordinates = group.createSVGPoint();\n    // Same kind of checking as in startDrag\n    if (d3.event.type === 'touchmove') {\n      newCoordinates.x = d3.event.touches[0].screenX;\n      newCoordinates.y = d3.event.touches[0].screenY;\n    } else if (d3.event.type === 'wheel' && d3.event.shiftKey === false) {\n      if (this.matrix === undefined) {\n        this.matrix = group.getScreenCTM().inverse();\n      }\n      if (this.dragCoordinates === undefined) {\n        this.dragCoordinates = group.createSVGPoint();\n      }\n      this.dragCoordinates.x = d3.event.x;\n      this.dragCoordinates.y = d3.event.y;\n      newCoordinates.x = this.dragCoordinates.x - d3.event.deltaX;\n      newCoordinates.y = this.dragCoordinates.y - d3.event.deltaY;\n      d3.event.preventDefault();\n    } else {\n      newCoordinates.x = d3.event.x;\n      newCoordinates.y = d3.event.y;\n    }\n    const newTransform = newCoordinates.matrixTransform(this.matrix);\n    const dragTransform = this.dragCoordinates.matrixTransform(this.matrix);\n    this.translate(-newTransform.x + dragTransform.x, -newTransform.y + dragTransform.y);\n    this.dragCoordinates = newCoordinates;\n  }\n\n  scrollZoom (): void {\n    if (d3.event.type !== 'wheel') return;\n    if (!d3.event.shiftKey) {\n      this.dragging();\n      return;\n    }\n    const slider = document.getElementById('zoomSlider') as HTMLInputElement;\n    this.getViewBox();\n    const k = this.viewBox.getZoom();\n    let newK = k - d3.event.deltaX / 100;\n    if (newK < parseInt(slider.getAttribute('min')) / 100) newK = 0.25;\n    if (newK > parseInt(slider.getAttribute('max')) / 100) newK = 4;\n    this.zoomTo(newK);\n\n    // Update zoom slider\n    slider.value = (newK * 100).toString();\n    (document.getElementById('zoomOutput') as HTMLOutputElement).value = String(Math.round(newK * 100));\n  }\n}\n\nexport { ZoomHandler as default };\n","/** @module Warnings */\n\n/**\n * Warn when grouped neume components form an unrecognized neume.\n */\nexport function groupingNotRecognized () {\n  if (!(window.confirm('Neon does not recognize this neume grouping. Would you like to create a compound neume?'))) {\n    document.getElementById('undo').click();\n  }\n}\n","import * as Notification from '../utils/Notification';\nimport NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport { selectAll } from '../utils/SelectTools';\nimport DragHandler from '../utils/DragHandler';\n\n/** Handle splitting a staff into two staves through Verovio. */\nexport class SplitHandler {\n  readonly neonView: NeonView;\n  readonly staff: SVGGElement;\n\n  constructor (neonView: NeonView, staff: SVGGElement) {\n    this.neonView = neonView;\n    this.staff = staff;\n  }\n\n  startSplit (): void {\n    this.splitDisable();\n\n    document.body.addEventListener('click', this.handler, { capture: true });\n\n    // Handle keypresses\n    document.body.addEventListener('keydown', this.keydownListener);\n    document.body.addEventListener('keyup', this.resetHandler);\n    document.body.addEventListener('click', this.clickawayHandler);\n\n    Notification.queueNotification('Click Where to Split');\n  }\n\n  splitDisable (): void {\n    document.body.removeEventListener('keydown', this.keydownListener);\n    document.body.removeEventListener('keyup', this.resetHandler);\n    document.body.removeEventListener('click', this.clickawayHandler);\n    document.body.removeEventListener('click', this.handler, { capture: true });\n  }\n\n  /** Handle input to split a staff. */\n  handler = ((evt: MouseEvent): void => {\n    const id = this.staff.id;\n\n    const container = this.staff.closest('.definition-scale') as SVGSVGElement;\n    const pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n\n    // Transform to SVG coordinate system.\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGElement)\n      .getScreenCTM().inverse();\n    const cursorPt = pt.matrixTransform(transformMatrix);\n    // Find staff point corresponds to if one exists\n    // TODO\n\n    const editorAction: EditorAction = {\n      'action': 'split',\n      'param': {\n        'elementId': id,\n        'x': cursorPt.x\n      }\n    };\n\n    this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then(async (result) => {\n      if (result) {\n        await this.neonView.updateForCurrentPagePromise();\n        Notification.queueNotification('Split action successful');\n      }\n      let dragHandler = new DragHandler(this.neonView, '.staff');\n      this.splitDisable();\n      selectAll([document.querySelector('#' + id) as SVGGElement], this.neonView, dragHandler);\n      try {\n        document.getElementById('moreEdit').innerHTML = '';\n        document.getElementById('moreEdit').classList.add('is-invisible');\n      } catch (e) {}\n    });\n  }).bind(this);\n\n  /** Exits split on Escape press, disables on Shift. */\n  keydownListener = ((evt: KeyboardEvent): void => {\n    if (evt.key === 'Escape') {\n      this.splitDisable();\n    } else if (evt.key === 'Shift') {\n      document.body.removeEventListener('click', this.handler, { capture: true });\n    }\n  }).bind(this);\n\n  /** Exit split if user clicks off of active page. */\n  clickawayHandler = ((evt: MouseEvent): void => {\n    const target = evt.target as HTMLElement;\n    if (target.closest('.active-page') === null) {\n      this.splitDisable();\n      document.body.removeEventListener('click', this.handler, { capture: true });\n    }\n  }).bind(this);\n\n  /** Called to reapply the event listener if necessary. */\n  resetHandler = ((evt: KeyboardEvent): void => {\n    if (evt.key === 'Shift') {\n      document.body.addEventListener('click', this.handler, { capture: true });\n    }\n  }).bind(this);\n}\n"],"sourceRoot":""}