{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/events/events.js","webpack:///./node_modules/pouchdb/node_modules/inherits/inherits_browser.js","webpack:///./node_modules/immediate/lib/browser.js","webpack:///(webpack)/buildin/global.js","webpack:///./node_modules/readable-stream/lib/_stream_duplex.js","webpack:///external \"d3\"","webpack:///./node_modules/argsarray/index.js","webpack:///./node_modules/process/browser.js","webpack:///./node_modules/inherits/inherits_browser.js","webpack:///./node_modules/jsonschema/lib/helpers.js","webpack:///./src/DisplayPanel/DisplayControls.ts","webpack:///./node_modules/core-util-is/lib/util.js","webpack:///./src/utils/Notification.ts","webpack:///./src/utils/SelectTools.ts","webpack:///./node_modules/buffer/index.js","webpack:///./node_modules/process-nextick-args/index.js","webpack:///./src/utils/Color.ts","webpack:///./src/SquareEdit/SelectOptions.ts","webpack:///./node_modules/spark-md5/spark-md5.js","webpack:///./node_modules/elementtree/lib/sprintf.js","webpack:///./node_modules/util/util.js","webpack:///./node_modules/readable-stream/readable-browser.js","webpack:///./node_modules/readable-stream/node_modules/safe-buffer/index.js","webpack:///./node_modules/readable-stream/lib/_stream_writable.js","webpack:///./node_modules/node-libs-browser/node_modules/string_decoder/lib/string_decoder.js","webpack:///./src/utils/random.ts","webpack:///./node_modules/url/url.js","webpack:///./node_modules/jsonschema/lib/scan.js","webpack:///./src/utils/Cursor.ts","webpack:///./src/SquareEdit/Contents.ts","webpack:///./src/utils/Select.ts","webpack:///./src/utils/DragHandler.ts","webpack:///./node_modules/pouchdb/lib/index-browser.es.js","webpack:///./src/NeonView.ts","webpack:///./node_modules/pouchdb/node_modules/uuid/index.js","webpack:///./node_modules/vuvuzela/index.js","webpack:///./src/DisplayPanel/DisplayPanel.ts","webpack:///./src/DivaView.ts","webpack:///./src/SingleView/SingleView.ts","webpack:///./src/SquareEdit/DivaEditMode.ts","webpack:///./src/SquareEdit/SingleEditMode.ts","webpack:///./src/InfoModule.ts","webpack:///./src/TextView.ts","webpack:///./src/TextEditMode.ts","webpack:///./src/utils/ConvertMei.ts","webpack:///./node_modules/elementtree/lib/elementtree.js","webpack:///./node_modules/elementtree/lib/utils.js","webpack:///./node_modules/elementtree/lib/treebuilder.js","webpack:///./node_modules/readable-stream/lib/_stream_readable.js","webpack:///./node_modules/readable-stream/lib/internal/streams/stream-browser.js","webpack:///./node_modules/readable-stream/lib/internal/streams/destroy.js","webpack:///./node_modules/readable-stream/lib/_stream_transform.js","webpack:///./node_modules/pouchdb/node_modules/uuid/lib/rng-browser.js","webpack:///./node_modules/pouchdb/node_modules/uuid/lib/bytesToUuid.js","webpack:///./src/SquareEdit/Controls.ts","webpack:///./src/SquareEdit/Grouping.ts","webpack:///./src/utils/Resize.ts","webpack:///./src/SquareEdit/InsertHandler.ts","webpack:///./deployment/pages/editor.js","webpack:///./src/NeonCore.ts","webpack:///./node_modules/elementtree/lib/elementpath.js","webpack:///./node_modules/elementtree/lib/errors.js","webpack:///./node_modules/util/support/isBufferBrowser.js","webpack:///./node_modules/util/node_modules/inherits/inherits_browser.js","webpack:///./node_modules/elementtree/lib/parser.js","webpack:///./node_modules/elementtree/lib/parsers/index.js","webpack:///./node_modules/elementtree/lib/parsers/sax.js","webpack:///./node_modules/elementtree/node_modules/sax/lib/sax.js","webpack:///./node_modules/base64-js/index.js","webpack:///./node_modules/ieee754/index.js","webpack:///./node_modules/buffer/node_modules/isarray/index.js","webpack:///./node_modules/stream-browserify/index.js","webpack:///./node_modules/readable-stream/node_modules/isarray/index.js","webpack:///./node_modules/readable-stream/lib/internal/streams/BufferList.js","webpack:///./node_modules/timers-browserify/main.js","webpack:///./node_modules/setimmediate/setImmediate.js","webpack:///./node_modules/util-deprecate/browser.js","webpack:///./node_modules/safe-buffer/index.js","webpack:///./node_modules/readable-stream/lib/_stream_passthrough.js","webpack:///./node_modules/readable-stream/writable-browser.js","webpack:///./node_modules/readable-stream/duplex-browser.js","webpack:///./node_modules/readable-stream/transform.js","webpack:///./node_modules/readable-stream/passthrough.js","webpack:///./node_modules/elementtree/lib/constants.js","webpack:///./src/Validation.ts","webpack:///./src/Worker.js","webpack:///./src/VerovioWrapper.ts","webpack:///./src/VerovioWorker.js","webpack:///./node_modules/pouchdb/node_modules/uuid/v1.js","webpack:///./node_modules/pouchdb/node_modules/uuid/v4.js","webpack:///./src/utils/NeonManifest.ts","webpack:///./node_modules/jsonschema/lib/index.js","webpack:///./node_modules/jsonschema/lib/validator.js","webpack:///./node_modules/punycode/punycode.js","webpack:///(webpack)/buildin/module.js","webpack:///./node_modules/url/util.js","webpack:///./node_modules/querystring-es3/index.js","webpack:///./node_modules/querystring-es3/decode.js","webpack:///./node_modules/querystring-es3/encode.js","webpack:///./node_modules/jsonschema/lib/attribute.js","webpack:///./src/utils/EditControls.ts","webpack:///./src/utils/EditContents.ts","webpack:///./src/utils/template/Template.ts","webpack:///./src/SingleView/Zoom.ts","webpack:///./src/Warnings.ts","webpack:///./src/SquareEdit/StaffTools.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","EventEmitter","init","this","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","$getMaxListeners","that","_addListener","type","listener","prepend","events","existing","warning","TypeError","newListener","emit","unshift","push","length","warned","w","Error","String","emitter","count","console","warn","_onceWrap","state","fired","wrapFn","wrapped","arguments","removeListener","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","err","message","context","handler","len","listeners","addListener","on","prependListener","once","prependOnceListener","list","position","originalListener","shift","index","pop","spliceOne","off","removeAllListeners","keys","rawListeners","eventNames","ctor","superCtor","super_","constructor","writable","configurable","TempCtor","scheduleDrain","draining","Mutation","global","MutationObserver","WebKitMutationObserver","called","observer","nextTick","element","document","createTextNode","observe","characterData","data","setImmediate","MessageChannel","createElement","scriptEl","onreadystatechange","parentNode","removeChild","documentElement","appendChild","setTimeout","channel","port1","onmessage","port2","postMessage","queue","oldQueue","task","g","e","window","pna","objectKeys","obj","Duplex","util","inherits","Readable","Writable","v","method","options","readable","allowHalfOpen","onend","_writableState","ended","onEndNT","self","end","highWaterMark","_readableState","destroyed","_destroy","cb","d3","fun","cachedSetTimeout","cachedClearTimeout","process","defaultSetTimout","defaultClearTimeout","runTimeout","clearTimeout","currentQueue","queueIndex","cleanUpNextTick","drainQueue","timeout","run","marker","runClearTimeout","Item","array","noop","title","browser","env","argv","version","versions","binding","cwd","chdir","dir","umask","uri","ValidationError","instance","schema","propertyPath","argument","id","stack","toString","ValidatorResult","ctx","errors","throwError","disableFormat","stringizer","addError","detail","importErrors","res","validatorType","map","join","SchemaError","msg","captureStackTrace","SchemaContext","base","schemas","resolve","makeChild","propertyName","makeSuffix","FORMAT_REGEXPS","input","parseFloat","parseInt","result","RegExp","regexp","regex","pattern","ipv4","isFormat","format","validator","test","customFormats","match","JSON","stringify","deepMerge","src","isArray","dst","forEach","indexOf","pathEncoder","encodeURIComponent","replace","deepCompareStrict","a","b","every","aKeys","bKeys","objectGetPath","k","parts","split","slice","decodeURIComponent","encodePath","getDecimalPlaces","number","decimalPlaces","decimalParts","lastGlyphOpacity","lastImageOpacity","setHighlightControls","highlightDropdown","getElementById","highlightStaff","highlightSyllable","highlightNeume","highlightNone","highlightType","addEventListener","evt","stopPropagation","classList","toggle","contains","body","highlightClickaway","remove","querySelectorAll","elem","add","textContent","Color","setGroupingHighlight","unsetGroupingHighlight","removeEventListener","meiClassName","background","opacitySlider","opacityOutput","inputChangeOpacity","querySelector","style","opacity","lowerOpacity","newOpacity","Math","round","setOpacityControls","bgOpacitySlider","bgOpacityOutput","bgInputChangeHandler","getElementsByClassName","setBackgroundOpacityControls","displayContents","toggleDisplay","display","setAttribute","zoomHandler","zoomSlider","zoomOutput","inputChangeHandler","zoomTo","resetZoomAndPan","currentZoom","newZoom","min","getAttribute","max","highlightSelection","highlightId","objectToString","isBoolean","isNull","isNullOrUndefined","isNumber","isString","isSymbol","isUndefined","isRegExp","re","isObject","isDate","isError","isFunction","isPrimitive","isBuffer","Buffer","notifications","currentModeMessage","notifying","NUMBER_TO_DISPLAY","startNotification","currentNotification","notification","isModeMessage","timeoutID","clearOrShowNextNotification","getId","notificationContent","innerHTML","displayNotification","setTimeoutId","currentId","notif","Notification","displayed","uuidv4","search","getSelectionType","unselect","selected","removeAttribute","unhighlight","fill","from","el","color","fontWeight","sylRect","syllable","selectAll","SelectOptions","endOptionsSelection","Grouping","endGroupingSelection","updateHighlight","select","dragHandler","selectStaff","sylId","closest","span","async","isLigature","nc","neonView","getElementAttr","view","getCurrentPageURI","sharedSecondLevelParent","elements","tempElements","secondParent","parentElement","selectBBox","bbox","syl","resize","dragInit","staff","highlight","parent","prevNc","previousSibling","nextNc","nextSibling","triggerGrouping","triggerNcActions","ulx","uly","lrx","lry","path","coordinates","notNeumes","nn","selectionType","selectionClass","containsClefOrCustos","groupsToSelect","Set","grouping","follows","precedes","group","groups","values","size","triggerClefActions","triggerCustosActions","triggerDefaultActions","triggerSplitActions","triggerStaffActions","triggerSylActions","staff0","staff1","staffChildren","children","abs","firstStaff","secondStaff","firstLayer","secondLayer","firstSyllableChildren","filter","secondSyllableChildren","lastSyllable","firstSyllable","triggerNeumeActions","posFirstY","posSecondY","x","baseVal","y","isFirstLigature","isSecondLigature","base64","ieee754","kMaxLength","TYPED_ARRAY_SUPPORT","createBuffer","Uint8Array","__proto__","encodingOrOffset","allocUnsafe","ArrayBuffer","byteOffset","byteLength","fromArrayLike","fromArrayBuffer","string","encoding","isEncoding","actual","write","fromString","checked","buffer","val","fromObject","assertSize","isView","loweredCase","utf8ToBytes","base64ToBytes","toLowerCase","slowToString","start","hexSlice","utf8Slice","asciiSlice","latin1Slice","base64Slice","utf16leSlice","swap","bidirectionalIndexOf","arrayIndexOf","lastIndexOf","indexSize","arrLength","valLength","read","buf","readUInt16BE","foundIndex","found","j","hexWrite","offset","remaining","strLen","parsed","substr","utf8Write","blitBuffer","asciiWrite","str","byteArray","charCodeAt","asciiToBytes","latin1Write","base64Write","ucs2Write","units","hi","lo","utf16leToBytes","fromByteArray","secondByte","thirdByte","fourthByte","tempCodePoint","firstByte","codePoint","bytesPerSequence","codePoints","MAX_ARGUMENTS_LENGTH","fromCharCode","decodeCodePointsArray","SlowBuffer","alloc","INSPECT_MAX_BYTES","foo","subarray","typedArraySupport","poolSize","_augment","species","allocUnsafeSlow","_isBuffer","compare","pos","swap16","swap32","swap64","equals","inspect","thisStart","thisEnd","thisCopy","targetCopy","includes","isFinite","toJSON","_arr","out","toHex","bytes","checkOffset","ext","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","writeDouble","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt8","readUInt16LE","readUInt32LE","readUInt32BE","readIntLE","pow","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","writeUIntBE","writeUInt8","floor","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","limit","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","targetStart","code","INVALID_BASE64_RE","Infinity","leadSurrogate","toByteArray","trim","stringtrim","base64clean","fn","arg1","arg2","arg3","ColorPalette","tagName","rects","rect","unsetStaffHighlight","child","cchild","setStaffHighlight","staves","staffColor","groupColor","unsetInclinatumAction","unsetVirgaAction","removeHandler","toRemove","chainAction","edit","then","updateForCurrentPage","changeStaffHandler","toChange","moreEdit","deleteButtonHandler","initOptionsListeners","preventDefault","initNeonView","Contents","ncActionContents","unsetInclinatum","unsetVirga","queueNotification","setInclinatum","setVirga","del","neumeActionContents","neume","contour","changeGroupingAction","triggerChangeGroup","info","getContourByValue","initGroupingListeners","clef","clefActionContents","setCClef","setFClef","custosActionContents","staffActionContents","systems","elementIds","editorAction","splitActionContents","SplitHandler","startSplit","co","dy","updateForCurrentPagePromise","defaultActionContents","hex_chr","md5cycle","md5blk","md5blks","md5blk_array","md51","tail","tmp","substring","rhex","hex","toUtf8","unescape","hexToBinaryString","SparkMD5","reset","clamp","to","num","targetArray","sourceArray","begin","append","appendBinary","contents","_buff","_length","_hash","raw","buff","_finish","getState","hash","setState","destroy","hashBinary","content","first","second","returnUInt8Array","utf8Str2ArrayBuffer","md51_array","factory","cache","TO_ESCAPE","'","populate","formatter","prev","builder","sprintf","var_args","getOwnPropertyDescriptors","descriptors","getOwnPropertyDescriptor","formatRegExp","f","objects","_","deprecate","noDeprecation","throwDeprecation","traceDeprecation","trace","debugEnviron","debugs","opts","seen","stylize","stylizeNoColor","depth","colors","showHidden","_extend","customInspect","stylizeWithColor","formatValue","styleType","styles","recurseTimes","primitive","simple","formatPrimitive","visibleKeys","idx","arrayToHash","formatError","Date","output","braces","toUTCString","formatProperty","formatArray","reduce","cur","numLinesEst","reduceToSingleString","desc","line","ar","pad","debuglog","NODE_DEBUG","toUpperCase","pid","months","timestamp","time","getHours","getMinutes","getSeconds","getDate","getMonth","prop","log","origin","kCustomPromisifiedSymbol","callbackifyOnRejected","reason","newReason","promisify","original","promiseResolve","promiseReject","promise","Promise","reject","setPrototypeOf","defineProperties","custom","callbackify","callbackified","maybeCb","rej","Stream","Transform","PassThrough","copyProps","SafeBuffer","CorkedRequest","_this","next","entry","finish","corkReq","callback","pendingcb","corkedRequestsFree","onCorkedFinish","asyncWrite","WritableState","internalUtil","OurUint8Array","realHasInstance","destroyImpl","nop","stream","isDuplex","objectMode","writableObjectMode","hwm","writableHwm","writableHighWaterMark","defaultHwm","finalCalled","needDrain","ending","finished","noDecode","decodeStrings","defaultEncoding","writing","corked","sync","bufferProcessing","onwrite","writecb","writelen","onwriteStateUpdate","finishMaybe","errorEmitted","onwriteError","needFinish","bufferedRequest","clearBuffer","afterWrite","lastBufferedRequest","prefinished","bufferedRequestCount","_write","writev","_writev","final","_final","doWrite","chunk","onwriteDrain","holder","allBuffers","isBuf","callFinal","need","prefinish","getBuffer","current","hasInstance","pipe","_uint8ArrayToBuffer","writeAfterEnd","valid","validChunk","newChunk","decodeChunk","last","writeOrBuffer","cork","uncork","setDefaultEncoding","endWritable","_undestroy","undestroy","StringDecoder","nb","enc","nenc","retried","_normalizeEncoding","normalizeEncoding","text","utf16Text","utf16End","fillLast","utf8FillLast","base64Text","base64End","simpleWrite","simpleEnd","lastNeed","lastTotal","lastChar","utf8CheckByte","byte","utf8CheckExtraBytes","total","utf8CheckIncomplete","uint8ToUuid","previous","padStart","crypto","octets","modifiers","getRandomValues","punycode","Url","protocol","slashes","auth","host","port","hostname","query","pathname","href","parse","urlParse","source","relative","resolveObject","protocolPattern","portPattern","simplePathPattern","unwise","autoEscape","nonHostChars","hostEndingChars","hostnamePartPattern","hostnamePartStart","unsafeProtocol","hostlessProtocol","slashedProtocol","querystring","url","parseQueryString","slashesDenoteHost","u","queryIndex","splitter","uSplit","rest","simplePath","exec","proto","lowerProto","atSign","hostEnd","hec","parseHost","ipv6Hostname","hostparts","part","newpart","validParts","notHost","bit","toASCII","h","ae","esc","escape","qm","charAt","rel","tkeys","tk","tkey","rkeys","rk","rkey","relPath","isSourceAbs","isRelAbs","mustEndAbs","removeAllDots","srcPath","psychotic","authInHost","hasTrailingSlash","up","splice","isAbsolute","urilib","helpers","SchemaScanResult","ref","scan","scanSchema","baseuri","$ref","resolvedUri","ourBase","scanArray","items","extends","additionalItems","scanObject","properties","additionalProperties","definitions","patternProperties","dependencies","disallow","allOf","anyOf","oneOf","not","_type","insertTabHtml","primitiveTab","groupingTab","systemTab","insertControlsPanel","editControlsPanel","groupingMenu","strokeWidth","escapeKeyListener","infoListeners","isSelByBBox","selByBBox","stopPropHandler","clickHandler","getUserMode","shiftKey","selection","firstLigatureHalf","secondLigatureHalf","ncIndex","firstUse","assert","secondUse","navigator","userAgent","metaKey","ctrlKey","container","pt","createSVGPoint","clientX","clientY","transformMatrix","getScreenCTM","matrixTransform","inverse","selectedStaves","getStaffBBox","dispatchEvent","MouseEvent","screenX","screenY","altKey","width","nv","dh","selector","sel","initialX","initialY","panning","dragSelecting","canvas","dragSelectAction","drag","userMode","event","sourceEvent","nodeName","startDrag","point","mouse","box","initialP","attr","currentPt","curX","curY","newX","newY","currentWidth","currentHeight","updateRect","dragging","rx","ry","lx","ly","node","ul","lr","transform","multiply","getBBox","height","resetTo","default","dragBehaviour","dragStartCoords","dragEnded","activeNc","dragEndCoords","relativeY","relativeX","paramArray","singleAction","action","param","elementId","xDiff","yDiff","resetToAction","ExportedSet","ExportedMap","mangle","unmangle","Map$1","_store","Set$1","cloneBinaryObject","cloneArrayBuffer","webkitSlice","mangled","has","delete","Map","supportsMapAndSet","funcToString","objectCtorString","clone","newObject","toISOString","Blob","isBinaryObject","Ctor","isPlainObject","toPromise","func","usedCB","fulfill","resp","mesg","adapterFun","_closed","_destroyed","logArgs","origCallback","responseArgs","logApiCall","taskqueue","isReady","addTask","failed","pick","hasLocal","MAX_NUM_CONCURRENT_REQUESTS","identityFunction","formatResultForOpenRevsGet","ok","bulkGet","db","requests","docs","requestsById","request","numDocs","numDone","perDocResults","checkDone","results","allRequests","nextBatch","upTo","batch","docId","docIdx","docRequests","docOpts","open_revs","rev","formatResult","processBatch","localStorage","setItem","getItem","hasLocalStorage","Changes","attachBrowserEvents","guardedConsole","defaultBackOff","maxTimeout","random","randomNumber","explainError","status","dbName","inprogress","eventFunction","changesOpts","changes","seq","since","cancelled","onChange","notifyLocalWindows","notify","$inject_Object_assign","assign","nextSource","nextKey","PouchError","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","UNKNOWN_ERROR","BAD_ARG","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","IDB_ERROR","INVALID_REV","MISSING_STUB","createError","CustomPouchError","generateErrorFromResponse","filterChange","req","hasFilter","query_params","change","doc","filterReturn","tryFilter","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","isRemote","_remote","parseDesignDocFunctionName","normalizeDesignDocFunctionName","normalized","qName","qParser","parser","parseUri","encoded","$0","$1","$2","scopeEval","scope","upsert","diffFun","docRev","_rev","newDoc","updated","_id","put","tryAndPut","thisAtob","atob","thisBtoa","btoa","createBlob","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","getBlob","binaryStringToArrayBuffer","bin","binStringToBluffer","binString","b64ToBluffer","b64","readAsBinaryString","blob","reader","FileReader","hasBinaryString","onloadend","binary","arrayBufferToBinaryString","readAsArrayBuffer","blobToBinaryString","blobOrBuffer","blobToBase64","setImmediateShim","MD5_CHUNK_SIZE","appendBlob","sliceBlob","arrayBuffer","appendString","binaryMd5","inputIsString","chunkSize","chunks","ceil","currentChunk","loadNextChunk","done","rawToBase64","stringMd5","deterministic_revs","clonedDoc","_rev_tree","v4","uuid","winningRev","metadata","winningId","winningPos","winningDeleted","toVisit","rev_tree","tree","ids","branches","deleted","traverseRevTree","revs","newCtx","sortByPos","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","rootToLeaf","paths","history","sortByPos$1","insertSorted","item","comparator","mid","low","high","binarySearch","pathToTree","numStemmed","root","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","diff","candidateParents","trees","parentIdx","elementsLen","merge","newTree","stemmed","stemmedRevs","revHash","stem","getTrees","isDeleted","isLocalId","Changes$1","complete","ee","onDestroy","cancel","pending","lastSeq","isCancelled","tryCatchInChangeListener","validateChanges","processChange","changeList","_conflicts","left","right","yankError","compareByIdThenRev","idCompare","_revisions","AbstractPouchDB","TaskQueue","PouchDB","__opts","auto_compaction","prefix","backend","adapter","adapters","preferredAdapters","adapterName","use_prefix","parseAdapter","_adapter","fail","onDestroyed","from_constructor","onClosed","prepareForDestruction","ready","_changesFilterPlugin","validate","doChanges","continuous","live","normalize","shouldFilter","descending","newPromise","_changes","update_seq","post","bulkDocs","_putLocal","_deleted","_removeLocal","oldRevId","newRevNum","newRevId","putDoc","_put","new_edits","force","putAttachment","attachmentId","rev$$1","api","createAttachment","prevrevpos","content_type","revpos","removeAttachment","docOrId","optsOrRev","was_delete","revsDiff","missing","addToMissing","revId","_getRevisionTree","missingForId","processDoc","missingObj","compactDocument","maxHeight","revTree","edges","prnt","edge","computeHeight","candidates","_doCompaction","compact","_compactionQueue","doNextCompaction","catch","last_seq","_compact","return_docs","promises","row","all","_getLocal","finishOpenRevs","latest","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","indexOfRev","howMany","_revs_info","_getAttachment","getAttachment","allDocs","skip","start_key","startkey","end_key","endkey","incompatibleOpt","allDocsKeysParse","_allDocs","close","_close","_info","db_name","attachmentError","attachmentNameError","atts","cleanDocs","_bulkDocs","registerDependentDatabase","dependentDb","depDB","dependentDbs","usePrefix","destroyDb","localDoc","deletedMap","trueName","execute","AbortController","abort","f$1","fetch","Headers","eventEmitter","Pouch","destructListeners","_destructionListeners","dbList","setUpEventEmitter","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","getFieldFromDoc","parsedField","parseField","fieldName","fields","ch","combinationFields","isCombinationalField","field","getKey","mergeAndedSelectors","selectors","matcher","$eq","fieldMatchers","operator","$gte","$gt","mergeGtGte","$lte","$lt","mergeLtLte","$ne","mergeNe","mergeEq","massageSelector","wasAnded","isAndInSelector","isAnd","mergeAndedSelectorsNested","orOrNor","subSelector","MIN_MAGNITUDE","MAGNITUDE_DIGITS","SEP","collate","normalizeKey","ai","collationIndex","bi","stringCollate","arrayCollate","ak","bk","objectCollate","origKey","indexify","expFormat","toExponential","magnitude","neg","magString","padWith","upToLength","padding","targetLength","factor","factorStr","toFixed","numToIndexableString","toIndexableString","objKey","parseNumber","originalIdx","numAsString","magAsString","metaStack","lastMetaElement","lastElementIndex","filterInMemoryFields","rows","requestDef","inMemoryFields","rowFilter","fieldSorter","getFieldValuesAsArray","sorting","aRow","bRow","collation","createFieldSorter","docFieldValue","some","orMatchers","find","matchCominationalSelector","matchSelector","userOperator","userValue","matchers","fieldExists","fieldIsNotUndefined","arrayContainsValue","divisor","mod","modField","neValue","arraySize","arrayContainsAllValues","regexMatch","typeMatch","filterName","changesHandler","doc_ids","viewName","ddoc","mapFun","views","rowsMatched","matchesSelector","filterFun","filters","toObject","reservedWords","dataWords","parseRevisionInfo","parseDoc","newEdits","dbOpts","nRevNum","revInfo","revisions","revisionIds","makeRevTreeFromRevisions","specialKey","preprocessString","blobType","asBinary","parseBase64","digest","preprocessAttachment","md5","preprocessBlob","updateDoc","revLimit","docInfo","writeDoc","splitRev","targetPos","targetId","revExists","previousWinningRev","previouslyDeleted","isRoot","newRev","rev_map","winningRev$$1","winningRevIsDeleted","delta","processDocs","docInfos","fetchedDocs","tx","overallCallback","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","resultsIdx","docWritten","nextDoc","rootIsMissing","insertDoc","ADAPTER_VERSION","DOC_STORE","BY_SEQ_STORE","ATTACH_STORE","ATTACH_AND_SEQ_STORE","META_STORE","LOCAL_STORE","DETECT_BLOB_SUPPORT_STORE","safeJsonStringify","json","idbError","encodeMetadata","deletedOrLocal","decodeMetadata","storedObject","safeJsonParse","decodeDoc","_doc_id_rev","readBlobData","asBlob","fetchAttachmentsIfNecessary","txn","attObj","objectStore","onsuccess","fetchAttachment","postProcessAttachments","attNames","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","IDBKeyRange","bound","deleteOrphanedAttachments","openCursor","only","cursor","digestSeq","primaryKey","continue","openTransactionSafely","idb","stores","transaction","idbBulkDocs","docStore","bySeqStore","attachStore","attachAndSeqStore","metaStore","docInfoError","metaDoc","allDocsProcessed","docCountDelta","preconditionErrored","_meta","blobSupport","onAllDocsProcessed","updateDocCountIfReady","docCount","newRevIsDeleted","isUpdate","collectResults","finishDoc","attachmentSaved","newAtt","saveAttachment","writeAttachments","afterPutDoc","revsToDelete","compactTree","metadataToStore","afterPutMetadata","attsAdded","attsToAdd","onerror","insertAttachmentMappings","putReq","overallErr","docv","recv","processedAttachment","preprocessAttachments","txnResult","onabort","ontimeout","oncomplete","digests","filename","verifyAttachment","attErr","verifyAttachments","numFetched","revs_limit","readMetadata","fetchExistingDocs","startTransaction","runBatchedCursor","keyRange","batchSize","onBatch","keysBatch","valuesBatch","pseudoCursor","onGetAll","onGetAllKeys","onCursor","getAll","getAllKeys","newKeyRange","lastKey","upper","upperOpen","lowerBound","idbAllDocs","keyRangeError","inclusiveEnd","inclusive_end","upperBound","createKeyRange","onResultsReady","updateSeq","onSuccess","docIdRevIndex","allDocsInner","fetchDocAsynchronously","batchValues","batchValue","batchKeys","returnVal","total_rows","maxKey","allDocsKeys","running","applyNext","docIds","numResults","docIdsToMetadata","onGetMetadata","docIdRev","objectStores","winningDocs","metadatas","fetchWinningDocAndMetadata","winningDoc","processMetadataAndWinningDoc","onBatchDone","filtered","blobSupportPromise","cachedDBs","openReqList","IdbPouch","tryCode","enqueueTask","thisCallback","addDeletedOrLocalIndex","createIndex","unique","migrateLocalStore","localStore","local","range","seqCursor","migrateAttsAndSeqs","digestMap","migrateMetadata","onGetMetadataSeq","metadataSeq","fetchMetadataSeq","instanceId","reqOpts","historyNode","attachId","attachment","blobData","doc_count","idb_attachment_format","oldRev","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","createObjectStore","keyPath","autoIncrement","createSchema","currentTarget","createLocalStoreSchema","addAttachAndSeqStore","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","countDocs","blob$$1","matchedChrome","matchedEdge","checkBlobSupport","CHANGES_BATCH_SIZE","MAX_SIMULTANEOUS_REVS","CHANGES_TIMEOUT_BUFFER","DEFAULT_HEARTBEAT","supportsBulkGetMap","readAttachmentsAsBlobOrBuffer","encodeDocId","preprocessAttachments$1","getHost","hasUrlPrefix","user","password","username","genDBUrl","genUrl","pathDel","paramsToStr","params","HttpPouch","dbUrl","setupPromise","ourFetch","headers","credentials","nAuth","token","ua","isIE","isTrident","isEdge","isGET","shouldCacheBust","now","adapterFun$$1","setup","fetchJSON","response","skip_setup","encodeAttachmentId","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","filenames","promiseFactories","doNext","runNextBatch","onError","thisErr","pool","fetchData","docOrDocs","contentType","paramStr","batch_size","heartbeat","requestTimeout","leftToFetch","feed","seq_interval","param_name","lastFetchedSeq","controller","aborted","fetchOpts","signal","fetched","raw_results_length","QueryParseError","NotFoundError","BuiltInError","promisedCallback","sequentialize","promiseFactory","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","evalFunctionWithEval","TaskQueue$1","createView","sourceDB","reduceFun","temporary","localDocName","cachedViews","viewSignature","createViewSignature","_cachedViews","promiseForView","depDbName","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","CHANGES_BATCH_SIZE$1","parseViewName","emitError","builtInReduce","_sum","_count","_stats","sumsqr","_sumsqr","abstract","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","sortByKeyThenValue","keyCompare","sliceResults","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","checkQueryParseError","startkeyName","endkeyName","group_level","optionName","checkPositiveInteger","defaultsTo","getDocsToPersist","docIdsToChangesAndEmits","metaDocId","defaultMetaDoc","docData","indexableKeysToKeyValues","isGenOne","getKeyValueDocs","kvDocsRes","kvDocs","oldKeys","keyValue","newKeys","kvDoc","processKeyValueDocs","getQueue","updateView","mapResults","currentSeq","listOfDocsToPersist","docsToPersist","saveKeyValues","processNextBatch","createIndexableKeysToKeyValues","createDocIdsToChangesAndEmits","emittedKeyValue","complexKey","updateViewInQueue","queryView","totalRows","shouldReduce","fetchFromView","viewOpts","expectedKeys","parsedKeyAndDocId","parsedNum","parsedStr","arrayElement","objElement","parseIndexableString","onMapResultsReady","finalResults","shouldGroup","lvl","POSITIVE_INFINITY","groupKey","reduceTry","reduceView","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","queryViewInQueue","queryPromised","_query","customQuery","keysAsString","httpQuery","finalPromiseFactory","designDocName","stale","coerceOptions","viewCleanup","_viewCleanup","customViewCleanup","httpViewCleanup","docsToViews","viewsToStatus","ddocName","viewDBNames","statusIsGood","viewDBName","destroyPromises","localViewCleanup","createAbstractMapReduce","origMap","reduceFunString","builtIn","getBuiltIn","mapreduce","isGenOne$1","getDocAttachments","getDocs","diffs","resultDocs","fetchRevisionOneDocs","hasConflicts","bulkGetOpts","missingRev","createBulkGetOpts","bulkGetResponse","bulkGetInfo","remoteDoc","doCheckForLocalAttachments","fileHasChanged","getDocAttachmentsFromTargetOrSource","Boolean","CHECKPOINT_VERSION","REPLICATOR","CHECKPOINT_HISTORY_SIZE","LOWEST_SEQ","updateCheckpoint","checkpoint","session","returnValue","session_id","replicator","Checkpointer","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","srcDoc","tgtDoc","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","T","targetRest","sourceId","hasSessionId","compareReplicationLogs","sessionId","props","getCheckpoint","STARTING_BACK_OFF","generateReplicationId","queryParams","filterViewName","sortObjectPropertiesByKey","queryData","md5sum","replicate","currentBatch","repId","checkpointer","batches","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","changedDocs","start_time","docs_read","docs_written","doc_write_failures","initCheckpointer","checkpointOpts","writeDocs","bulkOpts","completeReplication","errorsById","errorsNo","errorName","finishBatch","outResult","getChanges","onCheckpointError","getBatchDocs","got","startNextBatch","abortReplication","processPendingBatch","immediate$$1","fatalError","end_time","retry","back_off_function","backOffSet","current_back_off","backOff","onChangesComplete","onChangesError","_abortChanges","abortChanges","startChanges","_addedListeners","Replication","toPouch","PouchConstructor","replicateWrapper","replicateRet","Sync","canceled","optsPush","optsPull","pull","pullChange","direction","pushChange","pushDenied","pullDenied","pushPaused","pullPaused","pushActive","pullActive","removed","removeAll","addOneListener","success","_readyCalled","replicateMethods","other","parseManifest","manifest","NeumeEdit","TextEdit","TextView","prepareEditMode","textView","View","Display","image","core","Info","setupEdit","initDb","delay","pageNo","getCurrentPage","changePage","redo","undo","pageURI","elementID","updateDatabase","getAnnotations","readAsDataURL","deleteDb","getMEI","mei","getSVG","v1","arrayPrefix","objPrefix","numChar","parsedString","lastCh","numConsecutiveSlashes","className","handleZoom","displayControlsPanel","addUpdateCallback","updateVisualization","DisplayControls","setZoomControls","initDisplayControls","setOpacityFromSlider","updateCallbacks","divaReady","diva","Diva","objectData","minHeight","indexMap","disableDragScrollable","displayPanel","loadDelay","initDivaEvents","setViewEventHandlers","onresize","innerHeight","innerWidth","Events","subscribe","settings","ID","didLoad","adjustZoom","pageIndex","checkAndLoad","page","getPageSVG","svg","updateSVG","containerId","pageIndexes","getActivePageIndex","zoomDuration","firstChild","inner","dimensions","getPageDimensionsAtCurrentZoomLevel","viewHandler","_viewerCore","getPageRegion","includePadding","incorporateViewport","marginLeft","getComputedStyle","getPropertyValue","top","setDisplayListeners","findIndex","visibility","clear","sequence","sequences","canvases","itemTitle","pages","panel","createElementNS","bg","setAttributeNS","replaceChild","resetTransformations","_page","_delay","restoreTransformation","Cursor","updateCursorTo","setSelectListeners","updateCursor","touches","scrollZoom","newHeight","initEditModeControls","insertHandler","bindInsertTabs","click","Select","setSelectHelperObjects","initInsertEditControls","editMenu","backgroundColor","setSelectStrokeWidth","initSelectionButtons","setHighlightSelectionControls","isInsertMode","clickSelect","dragSelect","neumeGroups","updateInfoVisibility","neumeInfo","setInfoControls","block","label","resetInfoListeners","updateInfo","stopListeners","elementClass","attributes","ncs","getContour","ligated","pitches","getPitches","updateInfoModule","pitchNameToNum","innerText","pname","cont","entries","notificationSent","textLabel","bboxLabel","textButton","bboxButton","setTextViewControls","updateTextViewVisibility","updateBBoxViewVisibility","initSelectByBBoxButton","sylText","getSylText","initTextEdit","lyrics","selBySylListener","addBBoxListeners","updateSylText","button","orig","corrected","prompt","zip","array1","array2","et","register_namespace","staffBasedMei","meiTree","meiTag","getroot","section","findall","newStaff","Element","SubElement","getchildren","layer","sb","tag","syllableId","_children","sectionId","indent","sbBasedMei","staffStore","sbIndexes","sbIndex","attrib","custos","lastStaff","lastIndex","getSlice","stavesAdded","staffIndex","newLayer","newSyllableId","newSyllable","oldSyllableContent","syllableAttrib","layerAttrib","layerContent","utils","ElementPath","TreeBuilder","get_parser","constants","element_ids","Comment","CData","ProcessingInstruction","QName","text_or_uri","ElementTree","_root","makeelement","delItem","stop","setSlice","delSlice","extend","insert","findtext","defvalue","iter","itertext","_setroot","DEFAULT_PARSER","XMLParser","xml_declaration","default_namespace","_serialize_text","qnames","namespaces","indent_string","add_qname","qname","_namespace_map","_namespaces","_serialize_xml","newlines","_escape_cdata","_escape_text","_escape_attrib","_escape","isAttribute","isText","PI","XML","tostring","ignored","rv","matches","attrname","element_factory","_data","_elem","_last","_tail","_factory","_flush","attrs","ReadableState","EElistenerCount","debugUtil","debug","BufferList","kProxyEvents","readableObjectMode","readableHwm","readableHighWaterMark","pipes","pipesCount","flowing","endEmitted","reading","needReadable","emittedReadable","readableListening","resumeScheduled","awaitDrain","readingMore","decoder","_read","readableAddChunk","addToFront","skipChunkCheck","emitReadable","onEofChunk","chunkInvalid","addChunk","maybeReadMore","needMoreData","isPaused","setEncoding","MAX_HWM","howMuchToRead","head","computeNewHighWaterMark","emitReadable_","flow","maybeReadMore_","nReadingNextTick","resume_","fromList","hasStrings","copyFromBufferString","copyFromBuffer","fromListPartial","endReadable","endReadableNT","xs","nOrig","doRead","dest","pipeOpts","endFn","stdout","stderr","unpipe","onunpipe","unpipeInfo","hasUnpiped","onclose","onfinish","ondrain","ondata","cleanedUp","pipeOnDrain","increasedAwaitDrain","pause","resume","dests","ev","wrap","paused","_fromList","emitErrorNT","readableDestroyed","writableDestroyed","afterTransform","ts","_transformState","transforming","writechunk","rs","needTransform","writeencoding","_transform","flush","_this2","err2","msCrypto","rnds8","rnds","byteToHex","bth","activate","insertActive","deactivate","editMode","initEditMode","tabIds","tab","selectedOption","insertDisabled","resetCursor","bindElements","toggleInsert","toggleEdit","insertContents","editContents","selBySyl","selByNeume","selByNc","selByStaff","selectBySylHandler","selectByNeumeHandler","selectByNcHandler","selectByStaffHandler","groupingAction","getChildrenIds","getIds","syllable0","syllable1","secondSyllable","groupType","neumeParent","Warnings","groupingNotRecognized","childrenIds","PointNames","TopLeft","Top","TopRight","Right","BottomRight","Bottom","BottomLeft","Left","skew","initialPoint","initialUly","initialLry","whichSkewPoint","initialRectY","polyLen","initialSkew","redraw","points","sin","pointString","pointName","pointStringRight","pointStringLeft","drawInitialRect","atan","whichPoint","viewportElement","resizeStart","resizeDrag","resizeEnd","skewStart","temp","tempSkew","skewEnd","which","polygon","currentPoint","tan","firstClick","removeInsertClickHandlers","keydownListener","resetInsertHandler","clickawayHandler","insertMenu","staffHandler","cursorpt","coord","buttonId","alreadyInInsertMode","editModeButton","getGetParam","manifestLocation","storage","statusText","Response","location","annotations","verovioWrapper","Validation","undoStacks","redoStacks","neonCache","DOMParser","blankPages","mei_annotations","lastPageLoaded","annotation","getTime","newAnnotation","loadData","blankPage","convertSbToStaff","dirty","sendForValidation","handle","parseFromString","loadPage","currentMEI","updateCache","svgText","meiPromise","svgPromise","updateTimestamp","pair","SyntaxError","_cache","RE","xpath_tokenizer","ops","parent_map","_SelectorContext","getToken","resultElements","parsers","sax","onopentag","_handleOpenTag","ontext","_handleText","oncdata","_handleCdata","ondoctype","_handleDoctype","oncomment","_handleComment","onclosetag","_handleCloseTag","_handleError","comment","strict","opt","SAXParser","SAXStream","createStream","MAX_BUFFER_LENGTH","buffers","clearBuffers","q","bufferCheckPosition","lowercase","lowercasetags","looseCase","tags","closed","closedRoot","sawRoot","noscript","BEGIN","strictEntities","ENTITIES","XML_ENTITIES","attribList","xmlns","rootNS","trackPosition","column","EVENTS","F","BEGIN_WHITESPACE","beginWhiteSpace","TEXT","starti","textNode","whitespace","strictFail","TEXT_ENTITY","OPEN_WAKA","startTagPosition","SCRIPT","SCRIPT_ENDING","script","CLOSE_TAG","SGML_DECL","sgmlDecl","is","nameStart","OPEN_TAG","PROC_INST","procInstName","procInstBody","CDATA","emitNode","cdata","COMMENT","DOCTYPE","doctype","quote","SGML_DECL_QUOTED","DOCTYPE_DTD","DOCTYPE_QUOTED","DOCTYPE_DTD_QUOTED","COMMENT_ENDING","COMMENT_ENDED","textopts","CDATA_ENDING","CDATA_ENDING_2","PROC_INST_ENDING","PROC_INST_BODY","nameBody","newTag","openTag","OPEN_TAG_SLASH","ATTRIB","closeTag","attribName","attribValue","ATTRIB_NAME","ATTRIB_VALUE","ATTRIB_NAME_SAW_WHITE","ATTRIB_VALUE_QUOTED","ATTRIB_VALUE_UNQUOTED","ATTRIB_VALUE_ENTITY_Q","ATTRIB_VALUE_CLOSED","attribEnd","ATTRIB_VALUE_ENTITY_U","CLOSE_TAG_SAW_WHITE","returnState","parseEntity","entity","entityBody","entityStart","maxAllowed","maxActual","closeText","checkBufferLength","ex","streamWraps","_parser","me","_decoder","SD","letter","XML_NAMESPACE","XMLNS_NAMESPACE","xml","charClass","charclass","stringFromCharCode","fromCodePoint","STATE","COMMENT_STARTING","nodeType","attribute","qualName","qn","selfClosing","isSelfClosing","closeTo","entityLC","numStr","highSurrogate","lowSurrogate","MAX_SIZE","codeUnits","lens","getLens","validLen","placeHoldersLen","Arr","_byteLength","curByte","revLookup","uint8","extraBytes","len2","encodeChunk","lookup","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","rt","LN2","EE","_isStdio","didOnEnd","cleanup","Constructor","_classCallCheck","Timeout","clearFn","_clearFn","setInterval","clearInterval","unref","enroll","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","clearImmediate","registerImmediate","html","messagePrefix","onGlobalMessage","nextHandle","tasksByHandle","currentlyRunningATask","attachTo","runIfPresent","importScripts","postMessageIsAsynchronous","oldOnMessage","canUsePostMessage","attachEvent","config","schemaResponse","Worker","worker","statusField","updateUI","link","panelBlock","pNotif","meiData","VerovioWorker","verovioWorker","_nodeId","_clockseq","rng","bytesToUuid","_lastMSecs","_lastNSecs","clockseq","seedBytes","nsecs","dt","tl","tmh","ii","NeonSchema","NeonContext","manifestString","Validator","unresolvedRefs","types","validators","shouldResolve","addSchema","ourUri","addSubSchemaArray","addSubSchema","addSubSchemaObject","setSchemas","getSchema","urn","sch","validateSchema","switchSchema","schemaobj","schemaTraverser","superResolve","resolved","subctx","subschema","skipAttributes","ignoreProperties","validatorErr","allowUnknownAttributes","rewrite","fragment","testType","integer","boolean","date","any","freeGlobal","maxInt","tMin","tMax","damp","initialBias","initialN","delimiter","regexPunycode","regexNonASCII","regexSeparators","baseMinusTMin","mapDomain","ucs2decode","extra","counter","ucs2encode","digitToBasic","digit","flag","adapt","numPoints","firstTime","decode","basic","oldi","baseMinusT","inputLength","bias","encode","handledCPCount","basicLength","currentValue","handledCPCountPlusOne","qMinusT","webpackPolyfill","qs","sep","eq","maxKeys","kstr","vstr","stringifyPrimitive","ks","testSchemaNoThrow","testAdditionalProperty","preValidateProperty","nestedErrors","minProperties","maxProperties","minimum","exclusiveMinimum","maximum","exclusiveMaximum","validateMultipleOfOrDivisbleBy","validationType","errorMessage","validationArgument","instanceDecimals","divisorDecimals","maxDecimals","multiplier","testArrays","multipleOf","divisibleBy","required","minLength","hsp","maxLength","minItems","maxItems","uniqueItems","dep","childContext","notTypes","schemaId","startEditMode","navbarDropdownMenu","undoRedoPanel","initNavbar","initUndoRedoPanel","selectionHighlight","divider","save","export","download","confirm","reload","getPageMEI","convertStaffToSb","getPageName","undoHandler","redoHandler","editItem","editButton","fileLink","navbarContents","navbarFinalize","ViewBox","imageWidth","imageHeight","z","zoomHeight","zoomWidth","ZoomHandler","bgimg","viewBox","updateViewBox","getViewBox","translate","rawViewBox","dragCoordinates","matrix","newCoordinates","deltaX","deltaY","newTransform","dragTransform","slider","newK","getZoom","splitDisable","capture","resetHandler"],"mappings":"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","file":"editor.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 58);\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = $getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  var args = [];\n  for (var i = 0; i < arguments.length; i++) args.push(arguments[i]);\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    ReflectApply(this.listener, this.target, args);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a duplex stream is just a stream that is both readable and writable.\n// Since JS doesn't have multiple prototypal inheritance, this class\n// prototypally inherits from Readable, and then parasitically from\n// Writable.\n\n'use strict';\n\n/*<replacement>*/\n\nvar pna = require('process-nextick-args');\n/*</replacement>*/\n\n/*<replacement>*/\nvar objectKeys = Object.keys || function (obj) {\n  var keys = [];\n  for (var key in obj) {\n    keys.push(key);\n  }return keys;\n};\n/*</replacement>*/\n\nmodule.exports = Duplex;\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nvar Readable = require('./_stream_readable');\nvar Writable = require('./_stream_writable');\n\nutil.inherits(Duplex, Readable);\n\n{\n  // avoid scope creep, the keys array can then be collected\n  var keys = objectKeys(Writable.prototype);\n  for (var v = 0; v < keys.length; v++) {\n    var method = keys[v];\n    if (!Duplex.prototype[method]) Duplex.prototype[method] = Writable.prototype[method];\n  }\n}\n\nfunction Duplex(options) {\n  if (!(this instanceof Duplex)) return new Duplex(options);\n\n  Readable.call(this, options);\n  Writable.call(this, options);\n\n  if (options && options.readable === false) this.readable = false;\n\n  if (options && options.writable === false) this.writable = false;\n\n  this.allowHalfOpen = true;\n  if (options && options.allowHalfOpen === false) this.allowHalfOpen = false;\n\n  this.once('end', onend);\n}\n\nObject.defineProperty(Duplex.prototype, 'writableHighWaterMark', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function () {\n    return this._writableState.highWaterMark;\n  }\n});\n\n// the no-half-open enforcer\nfunction onend() {\n  // if we allow half-open state, or if the writable side ended,\n  // then we're ok.\n  if (this.allowHalfOpen || this._writableState.ended) return;\n\n  // no more data can be written.\n  // But allow more writes to happen in this tick.\n  pna.nextTick(onEndNT, this);\n}\n\nfunction onEndNT(self) {\n  self.end();\n}\n\nObject.defineProperty(Duplex.prototype, 'destroyed', {\n  get: function () {\n    if (this._readableState === undefined || this._writableState === undefined) {\n      return false;\n    }\n    return this._readableState.destroyed && this._writableState.destroyed;\n  },\n  set: function (value) {\n    // we ignore the value if the stream\n    // has not been initialized yet\n    if (this._readableState === undefined || this._writableState === undefined) {\n      return;\n    }\n\n    // backward compatibility, the user is explicitly\n    // managing destroyed\n    this._readableState.destroyed = value;\n    this._writableState.destroyed = value;\n  }\n});\n\nDuplex.prototype._destroy = function (err, cb) {\n  this.push(null);\n  this.end();\n\n  pna.nextTick(cb, err);\n};","module.exports = d3;","'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","'use strict';\n\nvar uri = require('url');\n\nvar ValidationError = exports.ValidationError = function ValidationError (message, instance, schema, propertyPath, name, argument) {\n  if (propertyPath) {\n    this.property = propertyPath;\n  }\n  if (message) {\n    this.message = message;\n  }\n  if (schema) {\n    if (schema.id) {\n      this.schema = schema.id;\n    } else {\n      this.schema = schema;\n    }\n  }\n  if (instance) {\n    this.instance = instance;\n  }\n  this.name = name;\n  this.argument = argument;\n  this.stack = this.toString();\n};\n\nValidationError.prototype.toString = function toString() {\n  return this.property + ' ' + this.message;\n};\n\nvar ValidatorResult = exports.ValidatorResult = function ValidatorResult(instance, schema, options, ctx) {\n  this.instance = instance;\n  this.schema = schema;\n  this.propertyPath = ctx.propertyPath;\n  this.errors = [];\n  this.throwError = options && options.throwError;\n  this.disableFormat = options && options.disableFormat === true;\n};\n\nValidatorResult.prototype.addError = function addError(detail) {\n  var err;\n  if (typeof detail == 'string') {\n    err = new ValidationError(detail, this.instance, this.schema, this.propertyPath);\n  } else {\n    if (!detail) throw new Error('Missing error detail');\n    if (!detail.message) throw new Error('Missing error message');\n    if (!detail.name) throw new Error('Missing validator type');\n    err = new ValidationError(detail.message, this.instance, this.schema, this.propertyPath, detail.name, detail.argument);\n  }\n\n  if (this.throwError) {\n    throw err;\n  }\n  this.errors.push(err);\n  return err;\n};\n\nValidatorResult.prototype.importErrors = function importErrors(res) {\n  if (typeof res == 'string' || (res && res.validatorType)) {\n    this.addError(res);\n  } else if (res && res.errors) {\n    Array.prototype.push.apply(this.errors, res.errors);\n  }\n};\n\nfunction stringizer (v,i){\n  return i+': '+v.toString()+'\\n';\n}\nValidatorResult.prototype.toString = function toString(res) {\n  return this.errors.map(stringizer).join('');\n};\n\nObject.defineProperty(ValidatorResult.prototype, \"valid\", { get: function() {\n  return !this.errors.length;\n} });\n\n/**\n * Describes a problem with a Schema which prevents validation of an instance\n * @name SchemaError\n * @constructor\n */\nvar SchemaError = exports.SchemaError = function SchemaError (msg, schema) {\n  this.message = msg;\n  this.schema = schema;\n  Error.call(this, msg);\n  Error.captureStackTrace(this, SchemaError);\n};\nSchemaError.prototype = Object.create(Error.prototype,\n  { constructor: {value: SchemaError, enumerable: false}\n  , name: {value: 'SchemaError', enumerable: false}\n  });\n\nvar SchemaContext = exports.SchemaContext = function SchemaContext (schema, options, propertyPath, base, schemas) {\n  this.schema = schema;\n  this.options = options;\n  this.propertyPath = propertyPath;\n  this.base = base;\n  this.schemas = schemas;\n};\n\nSchemaContext.prototype.resolve = function resolve (target) {\n  return uri.resolve(this.base, target);\n};\n\nSchemaContext.prototype.makeChild = function makeChild(schema, propertyName){\n  var propertyPath = (propertyName===undefined) ? this.propertyPath : this.propertyPath+makeSuffix(propertyName);\n  var base = uri.resolve(this.base, schema.id||'');\n  var ctx = new SchemaContext(schema, this.options, propertyPath, base, Object.create(this.schemas));\n  if(schema.id && !ctx.schemas[base]){\n    ctx.schemas[base] = schema;\n  }\n  return ctx;\n}\n\nvar FORMAT_REGEXPS = exports.FORMAT_REGEXPS = {\n  'date-time': /^\\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\\.\\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,\n  'date': /^\\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,\n  'time': /^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,\n\n  'email': /^(?:[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+\\.)*[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!\\.)){0,61}[a-zA-Z0-9]?\\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\\[(?:(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\.){3}(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\]))$/,\n  'ip-address': /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,\n  'ipv6': /^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/,\n  'uri': /^[a-zA-Z][a-zA-Z0-9+-.]*:[^\\s]*$/,\n\n  'color': /^(#?([0-9A-Fa-f]{3}){1,2}\\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\\(\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*\\))|(rgb\\(\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*\\)))$/,\n\n  // hostname regex from: http://stackoverflow.com/a/1420225/5628\n  'hostname': /^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\\.?$/,\n  'host-name': /^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\\.?$/,\n\n  'alpha': /^[a-zA-Z]+$/,\n  'alphanumeric': /^[a-zA-Z0-9]+$/,\n  'utc-millisec': function (input) {\n    return (typeof input === 'string') && parseFloat(input) === parseInt(input, 10) && !isNaN(input);\n  },\n  'regex': function (input) {\n    var result = true;\n    try {\n      new RegExp(input);\n    } catch (e) {\n      result = false;\n    }\n    return result;\n  },\n  'style': /\\s*(.+?):\\s*([^;]+);?/g,\n  'phone': /^\\+(?:[0-9] ?){6,14}[0-9]$/\n};\n\nFORMAT_REGEXPS.regexp = FORMAT_REGEXPS.regex;\nFORMAT_REGEXPS.pattern = FORMAT_REGEXPS.regex;\nFORMAT_REGEXPS.ipv4 = FORMAT_REGEXPS['ip-address'];\n\nexports.isFormat = function isFormat (input, format, validator) {\n  if (typeof input === 'string' && FORMAT_REGEXPS[format] !== undefined) {\n    if (FORMAT_REGEXPS[format] instanceof RegExp) {\n      return FORMAT_REGEXPS[format].test(input);\n    }\n    if (typeof FORMAT_REGEXPS[format] === 'function') {\n      return FORMAT_REGEXPS[format](input);\n    }\n  } else if (validator && validator.customFormats &&\n      typeof validator.customFormats[format] === 'function') {\n    return validator.customFormats[format](input);\n  }\n  return true;\n};\n\nvar makeSuffix = exports.makeSuffix = function makeSuffix (key) {\n  key = key.toString();\n  // This function could be capable of outputting valid a ECMAScript string, but the\n  // resulting code for testing which form to use would be tens of thousands of characters long\n  // That means this will use the name form for some illegal forms\n  if (!key.match(/[.\\s\\[\\]]/) && !key.match(/^[\\d]/)) {\n    return '.' + key;\n  }\n  if (key.match(/^\\d+$/)) {\n    return '[' + key + ']';\n  }\n  return '[' + JSON.stringify(key) + ']';\n};\n\nexports.deepCompareStrict = function deepCompareStrict (a, b) {\n  if (typeof a !== typeof b) {\n    return false;\n  }\n  if (a instanceof Array) {\n    if (!(b instanceof Array)) {\n      return false;\n    }\n    if (a.length !== b.length) {\n      return false;\n    }\n    return a.every(function (v, i) {\n      return deepCompareStrict(a[i], b[i]);\n    });\n  }\n  if (typeof a === 'object') {\n    if (!a || !b) {\n      return a === b;\n    }\n    var aKeys = Object.keys(a);\n    var bKeys = Object.keys(b);\n    if (aKeys.length !== bKeys.length) {\n      return false;\n    }\n    return aKeys.every(function (v) {\n      return deepCompareStrict(a[v], b[v]);\n    });\n  }\n  return a === b;\n};\n\nfunction deepMerger (target, dst, e, i) {\n  if (typeof e === 'object') {\n    dst[i] = deepMerge(target[i], e)\n  } else {\n    if (target.indexOf(e) === -1) {\n      dst.push(e)\n    }\n  }\n}\n\nfunction copyist (src, dst, key) {\n  dst[key] = src[key];\n}\n\nfunction copyistWithDeepMerge (target, src, dst, key) {\n  if (typeof src[key] !== 'object' || !src[key]) {\n    dst[key] = src[key];\n  }\n  else {\n    if (!target[key]) {\n      dst[key] = src[key];\n    } else {\n      dst[key] = deepMerge(target[key], src[key])\n    }\n  }\n}\n\nfunction deepMerge (target, src) {\n  var array = Array.isArray(src);\n  var dst = array && [] || {};\n\n  if (array) {\n    target = target || [];\n    dst = dst.concat(target);\n    src.forEach(deepMerger.bind(null, target, dst));\n  } else {\n    if (target && typeof target === 'object') {\n      Object.keys(target).forEach(copyist.bind(null, target, dst));\n    }\n    Object.keys(src).forEach(copyistWithDeepMerge.bind(null, target, src, dst));\n  }\n\n  return dst;\n};\n\nmodule.exports.deepMerge = deepMerge;\n\n/**\n * Validates instance against the provided schema\n * Implements URI+JSON Pointer encoding, e.g. \"%7e\"=\"~0\"=>\"~\", \"~1\"=\"%2f\"=>\"/\"\n * @param o\n * @param s The path to walk o along\n * @return any\n */\nexports.objectGetPath = function objectGetPath(o, s) {\n  var parts = s.split('/').slice(1);\n  var k;\n  while (typeof (k=parts.shift()) == 'string') {\n    var n = decodeURIComponent(k.replace(/~0/,'~').replace(/~1/g,'/'));\n    if (!(n in o)) return;\n    o = o[n];\n  }\n  return o;\n};\n\nfunction pathEncoder (v) {\n  return '/'+encodeURIComponent(v).replace(/~/g,'%7E');\n}\n/**\n * Accept an Array of property names and return a JSON Pointer URI fragment\n * @param Array a\n * @return {String}\n */\nexports.encodePath = function encodePointer(a){\n\t// ~ must be encoded explicitly because hacks\n\t// the slash is encoded by encodeURIComponent\n\treturn a.map(pathEncoder).join('');\n};\n\n\n/**\n * Calculate the number of decimal places a number uses\n * We need this to get correct results out of multipleOf and divisibleBy\n * when either figure is has decimal places, due to IEEE-754 float issues.\n * @param number\n * @returns {number}\n */\nexports.getDecimalPlaces = function getDecimalPlaces(number) {\n\n  var decimalPlaces = 0;\n  if (isNaN(number)) return decimalPlaces;\n\n  if (typeof number !== 'number') {\n    number = Number(number);\n  }\n\n  var parts = number.toString().split('e');\n  if (parts.length === 2) {\n    if (parts[1][0] !== '-') {\n      return decimalPlaces;\n    } else {\n      decimalPlaces = Number(parts[1].slice(1));\n    }\n  }\n\n  var decimalParts = parts[0].split('.');\n  if (decimalParts.length === 2) {\n    decimalPlaces += decimalParts[1].length;\n  }\n\n  return decimalPlaces;\n};\n\n","/** @module DisplayPanel/DisplayControls */\n\nimport * as Color from '../utils/Color';\nimport ZoomHandler from '../SingleView/Zoom';\n\nlet lastGlyphOpacity: number, lastImageOpacity: number;\n\n/**\n * Initialize listeners and controls for display panel.\n * @param {string} meiClassName - The class used to signifiy the MEI element(s).\n * @param {string} background - The class used to signify the background.\n */\nexport function initDisplayControls (meiClassName: string, background: string): void {\n  setOpacityControls(meiClassName);\n  setBackgroundOpacityControls(background);\n  setHighlightControls();\n  setBurgerControls();\n\n  const displayContents = document.getElementById('displayContents');\n  const toggleDisplay = document.getElementById('toggleDisplay');\n\n  toggleDisplay.addEventListener('click', () => {\n    if (displayContents.style.display === 'none') {\n      displayContents.style.display = '';\n      toggleDisplay.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down');\n    } else {\n      displayContents.style.display = 'none';\n      toggleDisplay.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-side');\n    }\n  });\n}\n\n/**\n * Set zoom control listener for button and slider\n */\nexport function setZoomControls (zoomHandler?: ZoomHandler): void {\n  if (zoomHandler === undefined) {\n    return;\n  }\n  const zoomSlider = document.getElementById('zoomSlider') as HTMLInputElement;\n  const zoomOutput = document.getElementById('zoomOutput') as HTMLOutputElement;\n\n  zoomSlider.value = '100';\n  document.getElementById('reset-zoom').addEventListener('click', () => {\n    zoomOutput.value = '100';\n    zoomSlider.value = '100';\n    zoomHandler.resetZoomAndPan();\n  });\n\n  zoomSlider.addEventListener('input', inputChangeHandler);\n  zoomSlider.addEventListener('change', inputChangeHandler);\n\n  function inputChangeHandler (): void {\n    zoomOutput.value = zoomSlider.value;\n    zoomHandler.zoomTo(Number(zoomOutput.value) / 100.0);\n  }\n\n  document.body.addEventListener('keydown', (evt) => {\n    const currentZoom = parseInt(zoomOutput.value);\n    if (evt.key === '+') { // increase zoom by 20\n      const newZoom = Math.min(currentZoom + 20, parseInt(zoomSlider.getAttribute('max')));\n      zoomHandler.zoomTo(newZoom / 100.0);\n      zoomOutput.value = String(newZoom);\n      zoomSlider.value = String(newZoom);\n    } else if (evt.key === '-') { // decrease zoom by 20\n      const newZoom = Math.max(currentZoom - 20, parseInt(zoomSlider.getAttribute('min')));\n      zoomHandler.zoomTo(newZoom / 100.0);\n      zoomOutput.value = String(Math.round(newZoom));\n      zoomSlider.value = String(newZoom);\n    } else if (evt.key === '0') {\n      zoomOutput.value = '100';\n      zoomSlider.value = '100';\n      zoomHandler.resetZoomAndPan();\n    }\n  });\n}\n\n/**\n * Set rendered MEI opacity button and slider listeners.\n */\nfunction setOpacityControls (meiClassName: string): void {\n  lastGlyphOpacity = 100;\n  const opacitySlider = document.getElementById('opacitySlider') as HTMLInputElement;\n  const opacityOutput = document.getElementById('opacityOutput') as HTMLOutputElement;\n\n  opacitySlider.value = '100';\n\n  document.getElementById('reset-opacity').addEventListener('click', () => {\n    // Definition scale is the root element of what is generated by verovio\n    const lowerOpacity = lastGlyphOpacity < 95 ? lastGlyphOpacity / 100.0 : 0;\n    const newOpacity = opacitySlider.value === '100' ? lowerOpacity : 1;\n    (document.querySelector('.' + meiClassName) as HTMLElement)\n      .style.opacity = newOpacity.toString();\n\n    lastGlyphOpacity = Number(opacitySlider.value);\n    opacitySlider.value = String(newOpacity * 100);\n    opacityOutput.value = String(Math.round(newOpacity * 100));\n  });\n\n  opacitySlider.addEventListener('input', inputChangeOpacity);\n  opacitySlider.addEventListener('change', inputChangeOpacity);\n\n  function inputChangeOpacity (): void {\n    opacityOutput.value = opacitySlider.value;\n    lastGlyphOpacity = Number(opacitySlider.value);\n    (document.querySelector('.' + meiClassName) as HTMLElement)\n      .style.opacity = (Number(opacityOutput.value) / 100.0).toString();\n  }\n}\n\n/**\n * Update MEI opacity to value from the slider.\n */\nexport function setOpacityFromSlider (meiClassName?: string): void {\n  const opacityOutput = document.getElementById('opacityOutput') as HTMLOutputElement;\n  opacityOutput.value = (document.getElementById('opacitySlider') as HTMLInputElement).value;\n  try {\n    ((document.querySelector('.' + meiClassName)) as HTMLElement)\n      .style.opacity = (Number(opacityOutput.value) / 100.0).toString();\n  } catch (e) {}\n}\n\n/**\n * Set background image opacity button and slider listeners.\n */\nfunction setBackgroundOpacityControls (background: string): void {\n  lastImageOpacity = 100;\n  const bgOpacitySlider = document.getElementById('bgOpacitySlider') as HTMLInputElement;\n  const bgOpacityOutput = document.getElementById('bgOpacityOutput') as HTMLOutputElement;\n\n  bgOpacitySlider.value = '100';\n  document.getElementById('reset-bg-opacity').addEventListener('click', () => {\n    const lowerOpacity = lastImageOpacity < 95 ? lastImageOpacity / 100.0 : 0;\n    const newOpacity = bgOpacitySlider.value === '100' ? lowerOpacity : 1;\n    (document.getElementsByClassName(background)[0] as HTMLElement)\n      .style.opacity = newOpacity.toString();\n\n    lastImageOpacity = Number(bgOpacitySlider.value);\n    bgOpacitySlider.value = String(newOpacity * 100);\n    bgOpacityOutput.value = String(Math.round(newOpacity * 100));\n  });\n\n  bgOpacitySlider.addEventListener('input', bgInputChangeHandler);\n  bgOpacitySlider.addEventListener('change', bgInputChangeHandler);\n\n  function bgInputChangeHandler (): void {\n    bgOpacityOutput.value = bgOpacitySlider.value;\n    lastImageOpacity = Number(bgOpacitySlider.value);\n    (document.getElementsByClassName(background)[0] as HTMLElement)\n      .style.opacity = (Number(bgOpacityOutput.value) / 100.0).toString();\n  }\n}\n\n/**\n * Set listener on staff highlighting checkbox.\n */\nexport function setHighlightControls (): void {\n  const highlightDropdown = document.getElementById('highlight-dropdown');\n  const highlightStaff = document.getElementById('highlight-staff');\n  const highlightSyllable = document.getElementById('highlight-syllable');\n  const highlightNeume = document.getElementById('highlight-neume');\n  const highlightNone = document.getElementById('highlight-none');\n  const highlightType = document.getElementById('highlight-type');\n\n  document.getElementById('highlight-button').addEventListener('click', (evt) => {\n    evt.stopPropagation();\n    highlightDropdown.classList.toggle('is-active');\n    if (highlightDropdown.classList.contains('is-active')) {\n      document.body.addEventListener('click', highlightClickaway);\n      highlightStaff.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightStaff.classList.add('highlight-selected');\n        highlightType.textContent = ' - Staff';\n        Color.setGroupingHighlight('staff');\n      });\n      highlightSyllable.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightSyllable.classList.add('highlight-selected');\n        highlightType.textContent = ' - Syllable';\n        Color.setGroupingHighlight('syllable');\n      });\n      highlightNeume.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightNeume.classList.add('highlight-selected');\n        highlightType.textContent = ' - Neume';\n        Color.setGroupingHighlight('neume');\n      });\n      highlightNone.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightType.textContent = ' - Off';\n        Color.unsetGroupingHighlight();\n      });\n    } else {\n      document.body.removeEventListener('click', highlightClickaway);\n    }\n  });\n}\n\nexport function setHighlightSelectionControls (): void {\n  const highlightSelection = document.getElementById('highlight-selection');\n  highlightSelection.addEventListener('click', () => {\n    document.getElementById('highlight-dropdown').classList.remove('is-active');\n    document.querySelectorAll('.highlight-selected').forEach(elem => {\n      elem.classList.remove('highlight-selected');\n    });\n    highlightSelection.classList.add('highlight-selected');\n    document.getElementById('highlight-type').textContent = ' - Selection';\n    Color.setGroupingHighlight('selection');\n  });\n}\n\n/**\n * Reset the highlight for different types based on the 'highlight-selected' class in the DOM.\n */\nexport function updateHighlight (): void {\n  let highlightId: string;\n  try {\n    highlightId = document.querySelector('.highlight-selected').id;\n  } catch (e) {\n    highlightId = '';\n  }\n  switch (highlightId) {\n    case 'highlight-staff':\n      Color.setGroupingHighlight('staff');\n      break;\n    case 'highlight-syllable':\n      Color.setGroupingHighlight('syllable');\n      break;\n    case 'highlight-neume':\n      Color.setGroupingHighlight('neume');\n      break;\n    case 'highlight-selection':\n      Color.setGroupingHighlight('selection');\n      break;\n    default:\n      Color.unsetGroupingHighlight();\n  }\n}\n\n/**\n * Set listener on burger menu for smaller screens.\n */\nfunction setBurgerControls () {\n  document.getElementById('burgerMenu').addEventListener('click', () => {\n    document.getElementById('burgerMenu').classList.toggle('is-active');\n    document.getElementById('navMenu').classList.toggle('is-active');\n  });\n}\n\n/**\n * Clickaway listener for the highlight dropdown.\n */\nfunction highlightClickaway () {\n  document.body.removeEventListener('click', highlightClickaway);\n  document.getElementById('highlight-dropdown').classList.remove('is-active');\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\n\nfunction isArray(arg) {\n  if (Array.isArray) {\n    return Array.isArray(arg);\n  }\n  return objectToString(arg) === '[object Array]';\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = Buffer.isBuffer;\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n","import { uuidv4 } from './random';\n\nconst notifications: Notification[] = new Array(0);\nlet currentModeMessage: Notification = null;\nlet notifying = false;\n\n/**\n * Number of notifications to display at a time.\n */\nconst NUMBER_TO_DISPLAY = 3;\n\n/**\n * Add a notification to the queue.\n */\nexport function queueNotification (notification: string): void {\n  const notif = new Notification(notification);\n  notifications.push(notif);\n  if (!notifying || document.getElementById('notification-content').querySelectorAll('.neon-notification').length < NUMBER_TO_DISPLAY) {\n    startNotification();\n  }\n}\n\n/**\n * Start displaying notifications. Called automatically.\n */\nfunction startNotification (): void {\n  if (notifications.length > 0) {\n    notifying = true;\n    const currentNotification = notifications.pop();\n    displayNotification(currentNotification);\n    currentNotification.setTimeoutId(window.setTimeout(clearOrShowNextNotification, 5000, currentNotification.getId()));\n    document.getElementById(currentNotification.getId()).addEventListener('click', () => {\n      window.clearTimeout(currentNotification.timeoutID);\n      clearOrShowNextNotification(currentNotification.getId());\n    });\n  }\n}\n\n/**\n * Display a notification.\n */\nfunction displayNotification (notification: Notification): void {\n  if (notification.isModeMessage) {\n    if (currentModeMessage === null) {\n      currentModeMessage = notification;\n    } else {\n      window.clearTimeout(currentModeMessage.timeoutID);\n      notifications.push(notification);\n      clearOrShowNextNotification(currentModeMessage.getId());\n      return;\n    }\n  }\n  const notificationContent = document.getElementById('notification-content');\n  notificationContent.innerHTML += '<div class=\\'neon-notification\\' id=\\'' + notification.getId() + '\\'>' + notification.message + '</div> ';\n  notificationContent.style.display = '';\n  notification.display();\n}\n\n/**\n * Clear the notifications if no more exist or display another from the queue.\n * @param currentId - The ID of the notification to be cleared.\n */\nfunction clearOrShowNextNotification (currentId: string): void {\n  document.getElementById(currentId).remove();\n  if (currentModeMessage !== null && currentModeMessage.getId() === currentId) {\n    currentModeMessage = null;\n  }\n  if (notifications.length > 0) {\n    startNotification();\n  } else if (document.querySelectorAll('.neon-notification').length === 0) {\n    document.getElementById('notification-content').style.display = 'none';\n    notifying = false;\n  }\n}\n\n/**\n * A class to manage Neon notifications.\n */\nclass Notification {\n  message: string;\n  displayed: boolean;\n  id: string;\n  isModeMessage: boolean;\n  timeoutID: number;\n  /**\n   * Create a new notification.\n   */\n  constructor (message: string) {\n    this.message = message;\n    this.displayed = false;\n    this.id = uuidv4();\n    this.isModeMessage = message.search('Mode') !== -1;\n    this.timeoutID = -1;\n  }\n\n  /** Set the ID from setTimeout. */\n  setTimeoutId (id: number): void {\n    this.timeoutID = Math.max(id, -1);\n  }\n\n  /** Display the Notification. */\n  display (): void {\n    this.displayed = true;\n  }\n\n  /**\n   * Get the UUID for this notification\n   */\n  getId (): string {\n    return this.id;\n  }\n}\n","import * as Color from './Color';\nimport { updateHighlight } from '../DisplayPanel/DisplayControls';\nimport * as Grouping from '../SquareEdit/Grouping';\nimport { resize } from './Resize';\nimport { Attributes } from '../Types';\nimport NeonView from '../NeonView';\nimport DragHandler from './DragHandler';\nimport * as SelectOptions from '../SquareEdit/SelectOptions';\n\nimport * as d3 from 'd3';\n/**\n * Get the selection mode chosen by the user.\n */\nexport function getSelectionType (): string {\n  const element = document.getElementsByClassName('sel-by is-active');\n  if (element.length !== 0) {\n    return element[0].id;\n  } else {\n    return null;\n  }\n}\n\n/**\n * Unselect all selected elements and run undo any extra\n * actions.\n */\nexport function unselect (): void {\n  document.querySelectorAll('.selected').forEach((selected: SVGGElement) => {\n    selected.classList.remove('selected');\n    if (selected.classList.contains('staff')) {\n      selected.removeAttribute('style');\n      Color.unhighlight(selected);\n    } else {\n      selected.removeAttribute('style');\n      selected.style.fill = '';\n    }\n  });\n  Array.from(document.getElementsByClassName('text-select')).forEach((el: SVGElement) => {\n    el.style.color = '';\n    el.style.fontWeight = '';\n    el.classList.remove('text-select');\n  });\n  Array.from(document.getElementsByClassName('sylTextRect-display')).forEach((sylRect: HTMLElement) => {\n    sylRect.style.fill = 'blue';\n  });\n\n  Array.from(document.getElementsByClassName('syllable-highlighted')).forEach((syllable: HTMLElement) => {\n    syllable.style.fill = '';\n    syllable.classList.add('syllable');\n    syllable.classList.remove('syllable-highlighted');\n  });\n\n  d3.selectAll('#resizeRect').remove();\n  d3.selectAll('.resizePoint').remove();\n  d3.selectAll('.skewPoint').remove();\n\n  if (!document.getElementById('selByStaff').classList.contains('is-active')) {\n    Grouping.endGroupingSelection();\n  } else {\n    SelectOptions.endOptionsSelection();\n  }\n  updateHighlight();\n}\n\n/**\n * Generic select function.\n */\nexport function select (el: SVGGraphicsElement, dragHandler?: DragHandler): void {\n  if (el.classList.contains('staff')) {\n    return selectStaff(el, dragHandler);\n  }\n  if (!el.classList.contains('selected') && !el.classList.contains('sylTextRect') &&\n      !el.classList.contains('sylTextRect-display')) {\n    el.classList.add('selected');\n    el.style.fill = '#d00';\n    if (el.querySelectorAll('.sylTextRect-display').length) {\n      el.querySelectorAll('.sylTextRect-display').forEach((elem: HTMLElement) => {\n        elem.style.fill = 'red';\n      });\n    }\n    let sylId;\n    if (el.classList.contains('syllable')) {\n      sylId = el.id;\n    } else if (el.closest('.syllable') !== null) {\n      sylId = el.closest('.syllable').id;\n    }\n    if (sylId !== undefined) {\n      const spans = document.querySelectorAll('span.' + sylId);\n      spans.forEach((span: HTMLElement) => {\n        span.style.color = '#d00';\n        span.style.fontWeight = 'bold';\n        span.classList.add('text-select');\n      });\n    }\n  }\n  updateHighlight();\n}\n\n/**\n * Select an nc.\n */\nexport async function selectNcs (el: SVGGraphicsElement, neonView: NeonView, dragHandler: DragHandler): Promise<void> {\n  if (!el.parentElement.classList.contains('selected')) {\n    const parent = el.parentElement as unknown as SVGGraphicsElement;\n    unselect();\n    select(parent);\n    if (await isLigature(parent, neonView)) {\n      const prevNc = parent.previousSibling as unknown as SVGGraphicsElement;\n      if (await isLigature(prevNc, neonView)) {\n        select(prevNc);\n      } else {\n        const nextNc = parent.nextSibling as unknown as SVGGraphicsElement;\n        if (await isLigature(nextNc, neonView)) {\n          select(nextNc);\n        } else {\n          console.warn('Error: Neither prev or next nc are ligatures');\n        }\n      }\n      Grouping.triggerGrouping('ligature');\n    } else if (parent.classList.contains('nc')) {\n      SelectOptions.triggerNcActions(parent);\n    } else {\n      console.warn('No action triggered!');\n    }\n    dragHandler.dragInit();\n  }\n}\n\n/**\n * Check if neume component is part of a ligature\n */\nexport async function isLigature (nc: SVGGraphicsElement, neonView: NeonView): Promise<boolean> {\n  const attributes: Attributes = await neonView.getElementAttr(nc.id, neonView.view.getCurrentPageURI());\n  return (attributes.ligated);\n}\n\n/**\n * Check if the elements have the same parent up two levels.\n */\nexport function sharedSecondLevelParent (elements: SVGElement[]): boolean {\n  const tempElements = Array.from(elements);\n  const firstElement = tempElements.pop();\n  const secondParent = firstElement.parentElement.parentElement;\n  for (const element of tempElements) {\n    const secPar = element.parentElement.parentElement;\n    if (secPar.id !== secondParent.id) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Get the bounding box of a staff based on its staff lines.\n */\nexport function getStaffBBox (staff: SVGGElement): {ulx: number; uly: number; lrx: number; lry: number} {\n  let ulx, uly, lrx, lry;\n  staff.querySelectorAll('path').forEach(path => {\n    const coordinates: number[] = path.getAttribute('d')\n      .match(/\\d+/g)\n      .map(element => Number(element));\n    if (uly === undefined || coordinates[1] < uly) {\n      uly = coordinates[1];\n    }\n    if (ulx === undefined || coordinates[0] < ulx) {\n      ulx = coordinates[0];\n    }\n    if (lry === undefined || coordinates[3] > lry) {\n      lry = coordinates[3];\n    }\n    if (lrx === undefined || coordinates[2] > lrx) {\n      lrx = coordinates[2];\n    }\n  });\n  return { 'ulx': ulx, 'uly': uly, 'lrx': lrx, 'lry': lry };\n}\n\n/**\n * select a boundingbox element\n * @param el - the bbox (sylTextRect) element in the DOM\n * @param dragHandler - the drag handler in use\n */\nexport function selectBBox (el: SVGGraphicsElement, dragHandler: DragHandler, neonView: NeonView): void {\n  const bbox = el;\n  const syl = bbox.closest('.syl');\n  if (!syl.classList.contains('selected')) {\n    syl.classList.add('selected');\n    bbox.style.fill = '#d00';\n    const closest = el.closest('.syllable') as HTMLElement;\n    closest.style.fill = 'red';\n    closest.classList.add('syllable-highlighted');\n    if (neonView !== undefined ){\n      resize(syl as SVGGraphicsElement, neonView, dragHandler);\n    }\n    if (dragHandler !== undefined) {\n      dragHandler.dragInit();\n    }\n    const sylId = el.closest('.syllable').id;\n    if (sylId !== undefined) {\n      const span: HTMLSpanElement = document.querySelector('span.' + sylId);\n      if (span) {\n        span.style.color = '#d00';\n        span.style.fontWeight = 'bold';\n        span.classList.add('text-select');\n      }\n    }\n  }\n}\n\n/**\n * Select not neume elements.\n * @param notNeumes - An array of not neumes elements.\n */\nexport function selectNn (notNeumes: SVGGraphicsElement[]): boolean {\n  if (notNeumes.length > 0) {\n    notNeumes.forEach(nn => { select(nn); });\n    return false;\n  } else {\n    return true;\n  }\n}\n\n/**\n * Select a staff element.\n * @param staff - The staff element in the DOM.\n * @param dragHandler - The drag handler in use.\n */\nexport function selectStaff (staff: SVGGElement, dragHandler: DragHandler): void {\n  if (!staff.classList.contains('selected')) {\n    staff.classList.add('selected');\n    Color.unhighlight(staff);\n    Color.highlight(staff, '#d00');\n    dragHandler.dragInit();\n  }\n}\n\n/**\n * Handle selecting an array of elements based on the selection type.\n */\nexport async function selectAll (elements: Array<SVGGraphicsElement>, neonView: NeonView, dragHandler: DragHandler): Promise<void> {\n  const selectionType = getSelectionType();\n  unselect();\n  if (elements.length === 0) {\n    return;\n  }\n\n  let selectionClass;\n  let containsClefOrCustos = false;\n\n  switch (selectionType) {\n    case 'selBySyl':\n      selectionClass = '.syllable';\n      break;\n    case 'selByNeume':\n      selectionClass = '.neume';\n      break;\n    case 'selByNc':\n      selectionClass = '.nc';\n      break;\n    case 'selByStaff':\n      selectionClass = '.staff';\n      break;\n    case 'selByBBox':\n      selectionClass = '.sylTextRect-display';\n      break;\n    default:\n      console.error('Unknown selection type ' + selectionType);\n      return;\n  }\n\n  // Get the groupings specified by selectionClass\n  // that contain the provided elements to select.\n  const groupsToSelect = new Set();\n  for (const element of elements) {\n    let grouping = element.closest(selectionClass);\n    if (grouping === null) {\n      // Check if we click-selected a clef or a custos\n      grouping = element.closest('.clef, .custos');\n      if (grouping === null) {\n        console.warn('Element ' + element.id + ' is not part of specified group and is not a clef or custos.');\n        continue;\n      }\n      containsClefOrCustos = containsClefOrCustos || true;\n    }\n    groupsToSelect.add(grouping);\n\n    // Check for precedes/follows\n    const follows = grouping.getAttribute('mei:follows');\n    if (follows) {\n      groupsToSelect.add(document.getElementById(follows));\n    }\n    const precedes = grouping.getAttribute('mei:precedes');\n    if (precedes) {\n      groupsToSelect.add(document.getElementById(precedes));\n    }\n  }\n\n  // Select the elements\n  groupsToSelect.forEach((group: SVGGraphicsElement) => { select(group, dragHandler); });\n\n  /* Determine the context menu to display (if any) */\n\n  const groups = Array.from(groupsToSelect.values()) as SVGGraphicsElement[];\n\n  // Handle occurance of clef or custos\n  if (containsClefOrCustos) {\n    // A context menu will only be displayed if there is a single clef\n    if (groupsToSelect.size === 1 && groups[0].classList.contains('clef')) {\n      SelectOptions.triggerClefActions(groups[0]);\n    } else if (groupsToSelect.size === 1 && groups[0].classList.contains('custos')) {\n      SelectOptions.triggerCustosActions();\n    } else {\n      SelectOptions.triggerDefaultActions();\n    }\n    return;\n  }\n\n  switch (selectionType) {\n    case 'selByStaff':\n      switch (groups.length) {\n        case 1:\n          SelectOptions.triggerSplitActions();\n          resize(groups[0], neonView, dragHandler);\n          break;\n        default:\n          SelectOptions.triggerStaffActions();\n      }\n      break;\n\n    case 'selBySyl':\n      switch (groups.length) {\n        case 1:\n          // TODO change context if it is only a neume/nc.\n          SelectOptions.triggerSylActions();\n          break;\n        case 2:\n          // Check if this is a linked syllable split by a staff break\n          if ((groups[0].getAttribute('mei:follows') === groups[1].id) || (groups[0].getAttribute('mei:precedes') === groups[1].id)) {\n            Grouping.triggerGrouping('splitSyllable');\n          } else if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('syl');\n          } else {\n            // Check if this *could* be a selection with a single logical syllable split by a staff break.\n            const staff0 = groups[0].closest('.staff');\n            const staff1 = groups[1].closest('.staff');\n            const staffChildren = Array.from(staff0.parentElement.children);\n            // Check if these are adjacent staves (logically)\n            if (Math.abs(staffChildren.indexOf(staff0) - staffChildren.indexOf(staff1)) === 1) {\n              // Check if one syllable is the last in the first staff and the other is the first in the second.\n              // Determine which staff is first.\n              const firstStaff = (staffChildren.indexOf(staff0) < staffChildren.indexOf(staff1)) ? staff0 : staff1;\n              const secondStaff = (firstStaff.id === staff0.id) ? staff1 : staff0;\n              const firstLayer = firstStaff.querySelector('.layer');\n              const secondLayer = secondStaff.querySelector('.layer');\n\n              // Check that the first staff has either syllable as the last syllable\n              const firstSyllableChildren = Array.from(firstLayer.children)\n                .filter((elem: HTMLElement) => elem.classList.contains('syllable')) as HTMLElement[];\n              const secondSyllableChildren = Array.from(secondLayer.children)\n                .filter((elem: HTMLElement) => elem.classList.contains('syllable')) as HTMLElement[];\n              const lastSyllable = firstSyllableChildren[firstSyllableChildren.length - 1];\n              const firstSyllable = secondSyllableChildren[0];\n              if (lastSyllable.id === groups[0].id && firstSyllable.id === groups[1].id) {\n                Grouping.triggerGrouping('splitSyllable');\n                break;\n              } else if (lastSyllable.id === groups[1].id && firstSyllable.id === groups[0].id) {\n                Grouping.triggerGrouping('splitSyllable');\n                break;\n              }\n            }\n            SelectOptions.triggerDefaultActions();\n          }\n          break;\n        default:\n          if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('syl');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n      }\n      break;\n\n    case 'selByNeume':\n      switch (groups.length) {\n        case 1:\n          // TODO change context if it is only a nc.\n          SelectOptions.triggerNeumeActions();\n          break;\n        default:\n          if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('neume');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n      }\n      break;\n\n    case 'selByNc':\n      switch (groups.length) {\n        case 1:\n          SelectOptions.triggerNcActions(groups[0]);\n          break;\n        case 2:\n          if (sharedSecondLevelParent(groups)) {\n            // Check if this selection is a ligature or can be a ligature\n            // Check if these neume components are part of the same neume\n            if (groups[0].parentElement === groups[1].parentElement) {\n              const children = Array.from(groups[0].parentElement.children);\n              // Check that neume components are adjacent\n              if (Math.abs(children.indexOf(groups[0]) - children.indexOf(groups[1])) === 1) {\n                // Check that second neume component is lower than first.\n                // Note that the order in the list may not be the same as the\n                // order by x-position.\n                const orderFirstX = (groups[0].children[0] as SVGUseElement)\n                  .x.baseVal.value;\n                const orderSecondX = (groups[1].children[0] as SVGUseElement)\n                  .x.baseVal.value;\n                let posFirstY, posSecondY;\n\n                if (orderFirstX < orderSecondX) {\n                  posFirstY = (groups[0].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                  posSecondY = (groups[1].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                } else {\n                  posFirstY = (groups[1].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                  posSecondY = (groups[0].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                }\n\n                // Also ensure both components are marked or not marked as ligatures.\n                const isFirstLigature = await isLigature(groups[0], neonView);\n                const isSecondLigature = await isLigature(groups[1], neonView);\n                if ((posSecondY > posFirstY) && !(isFirstLigature !== isSecondLigature)) {\n                  Grouping.triggerGrouping('ligature');\n                  break;\n                }\n              }\n            }\n            Grouping.triggerGrouping('nc');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n          break;\n        default:\n          if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('nc');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n      }\n      break;\n    case 'selByBBox':\n      switch (groups.length) {\n        case 1:\n          selectBBox(groups[0], dragHandler, neonView);\n          break;\n        default:\n          groups.forEach(g => selectBBox(g, dragHandler, undefined));\n          break;\n      }\n      break;\n    default:\n      console.error('Unknown selection type. This should not have occurred.');\n  }\n}\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('isarray')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\n/*\n * Export kMaxLength after typed array support is determined.\n */\nexports.kMaxLength = kMaxLength()\n\nfunction typedArraySupport () {\n  try {\n    var arr = new Uint8Array(1)\n    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\nfunction createBuffer (that, length) {\n  if (kMaxLength() < length) {\n    throw new RangeError('Invalid typed array length')\n  }\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = new Uint8Array(length)\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    if (that === null) {\n      that = new Buffer(length)\n    }\n    that.length = length\n  }\n\n  return that\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {\n    return new Buffer(arg, encodingOrOffset, length)\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new Error(\n        'If encoding is specified then the first argument must be a string'\n      )\n    }\n    return allocUnsafe(this, arg)\n  }\n  return from(this, arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\n// TODO: Legacy, not needed anymore. Remove in next major version.\nBuffer._augment = function (arr) {\n  arr.__proto__ = Buffer.prototype\n  return arr\n}\n\nfunction from (that, value, encodingOrOffset, length) {\n  if (typeof value === 'number') {\n    throw new TypeError('\"value\" argument must not be a number')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {\n    return fromArrayBuffer(that, value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'string') {\n    return fromString(that, value, encodingOrOffset)\n  }\n\n  return fromObject(that, value)\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(null, value, encodingOrOffset, length)\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n  if (typeof Symbol !== 'undefined' && Symbol.species &&\n      Buffer[Symbol.species] === Buffer) {\n    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97\n    Object.defineProperty(Buffer, Symbol.species, {\n      value: null,\n      configurable: true\n    })\n  }\n}\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be a number')\n  } else if (size < 0) {\n    throw new RangeError('\"size\" argument must not be negative')\n  }\n}\n\nfunction alloc (that, size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(that, size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpretted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(that, size).fill(fill, encoding)\n      : createBuffer(that, size).fill(fill)\n  }\n  return createBuffer(that, size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(null, size, fill, encoding)\n}\n\nfunction allocUnsafe (that, size) {\n  assertSize(size)\n  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < size; ++i) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(null, size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(null, size)\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('\"encoding\" must be a valid string encoding')\n  }\n\n  var length = byteLength(string, encoding) | 0\n  that = createBuffer(that, length)\n\n  var actual = that.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    that = that.slice(0, actual)\n  }\n\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = array.length < 0 ? 0 : checked(array.length) | 0\n  that = createBuffer(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array, byteOffset, length) {\n  array.byteLength // this throws if `array` is not a valid ArrayBuffer\n\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\\'offset\\' is out of bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\\'length\\' is out of bounds')\n  }\n\n  if (byteOffset === undefined && length === undefined) {\n    array = new Uint8Array(array)\n  } else if (length === undefined) {\n    array = new Uint8Array(array, byteOffset)\n  } else {\n    array = new Uint8Array(array, byteOffset, length)\n  }\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = array\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromArrayLike(that, array)\n  }\n  return that\n}\n\nfunction fromObject (that, obj) {\n  if (Buffer.isBuffer(obj)) {\n    var len = checked(obj.length) | 0\n    that = createBuffer(that, len)\n\n    if (that.length === 0) {\n      return that\n    }\n\n    obj.copy(that, 0, 0, len)\n    return that\n  }\n\n  if (obj) {\n    if ((typeof ArrayBuffer !== 'undefined' &&\n        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {\n      if (typeof obj.length !== 'number' || isnan(obj.length)) {\n        return createBuffer(that, 0)\n      }\n      return fromArrayLike(that, obj)\n    }\n\n    if (obj.type === 'Buffer' && isArray(obj.data)) {\n      return fromArrayLike(that, obj.data)\n    }\n  }\n\n  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength()` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  var buffer = Buffer.allocUnsafe(length)\n  var pos = 0\n  for (i = 0; i < list.length; ++i) {\n    var buf = list[i]\n    if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    }\n    buf.copy(buffer, pos)\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&\n      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    string = '' + string\n  }\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n      case undefined:\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect\n// Buffer instances.\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  var i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  var len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (var i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  var len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (var i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  var len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (var i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError('Argument must be a Buffer')\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  var x = thisEnd - thisStart\n  var y = end - start\n  var len = Math.min(x, y)\n\n  var thisCopy = this.slice(thisStart, thisEnd)\n  var targetCopy = target.slice(start, end)\n\n  for (var i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset  // Coerce to Number.\n  if (isNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (Buffer.TYPED_ARRAY_SUPPORT &&\n        typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  var indexSize = 1\n  var arrLength = arr.length\n  var valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  var i\n  if (dir) {\n    var foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      var found = true\n      for (var j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; ++i) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction latin1Write (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Write(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; ++i) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = this.subarray(start, end)\n    newBuf.__proto__ = Buffer.prototype\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; ++i) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; --i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; ++i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, start + len),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (val.length === 1) {\n      var code = val.charCodeAt(0)\n      if (code < 256) {\n        val = code\n      }\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  var i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    var bytes = Buffer.isBuffer(val)\n      ? val\n      : utf8ToBytes(new Buffer(val, encoding).toString())\n    var len = bytes.length\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction isnan (val) {\n  return val !== val // eslint-disable-line no-self-compare\n}\n","'use strict';\n\nif (typeof process === 'undefined' ||\n    !process.version ||\n    process.version.indexOf('v0.') === 0 ||\n    process.version.indexOf('v1.') === 0 && process.version.indexOf('v1.8.') !== 0) {\n  module.exports = { nextTick: nextTick };\n} else {\n  module.exports = process\n}\n\nfunction nextTick(fn, arg1, arg2, arg3) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('\"callback\" argument must be a function');\n  }\n  var len = arguments.length;\n  var args, i;\n  switch (len) {\n  case 0:\n  case 1:\n    return process.nextTick(fn);\n  case 2:\n    return process.nextTick(function afterTickOne() {\n      fn.call(null, arg1);\n    });\n  case 3:\n    return process.nextTick(function afterTickTwo() {\n      fn.call(null, arg1, arg2);\n    });\n  case 4:\n    return process.nextTick(function afterTickThree() {\n      fn.call(null, arg1, arg2, arg3);\n    });\n  default:\n    args = new Array(len - 1);\n    i = 0;\n    while (i < args.length) {\n      args[i++] = arguments[i];\n    }\n    return process.nextTick(function afterTick() {\n      fn.apply(null, args);\n    });\n  }\n}\n\n","/**\n * Adapted from color palette from Figure 2 (Colors optimized for color-blind\n * individuals) from\n * [\"Points of view: Color blindness\" by Bang Wong published in Nature Methods volume 8 on 27 May 2011](https://www.nature.com/articles/nmeth.1618?WT.ec_id=NMETH-201106)\n */\nconst ColorPalette: string[] = [\n  'rgb(230, 159, 0)',\n  'rgb(86, 180, 233)',\n  'rgb(0, 158, 115)',\n  'rgb(240, 228, 66)',\n  'rgb(0, 114, 178)',\n  'rgb(213, 94, 0)',\n  'rgb(204, 121, 167)'\n];\n\n/**\n * Remove the highlight from a staff.\n * @param staff If undefined, the all staves are unhighlighted.\n */\nexport function unhighlight (staff?: SVGGElement): void {\n  let children: NodeListOf<Element>;\n  if (staff) {\n    children = staff.querySelectorAll(':not(.selected) .highlighted');\n  } else {\n    children = document.querySelectorAll(':not(.selected) .highlighted');\n  }\n  children.forEach(elem => {\n    if (elem.tagName === 'path') {\n      elem.setAttribute('stroke', '#000000');\n    } else {\n      elem.removeAttribute('fill');\n      let rects = elem.querySelectorAll('.sylTextRect-display');\n      if (!rects.length) {\n        try {\n          rects = elem.closest('.syllable').querySelectorAll('.sylTextRect-display');\n        } catch (e) {\n          rects = [] as unknown as NodeListOf<Element>;\n        }\n      }\n      rects.forEach(function (rect: HTMLElement) {\n        if (rect.closest('.syllable').classList.contains('selected')) {\n          rect.style.fill = 'red';\n        } else {\n          rect.style.fill = 'blue';\n        }\n        rect.classList.remove('highlighted');\n      });\n    }\n    elem.classList.remove('highlighted');\n  });\n}\n\n/**\n * Remove the highlight from each staff.\n */\nexport function unsetStaffHighlight (): void {\n  unhighlight();\n}\n\n/**\n * Unset highlight for all grouping types\n */\nexport function unsetGroupingHighlight (): void {\n  unsetStaffHighlight();\n  const highlighted = Array.from(document.getElementsByClassName('highlighted'))\n    .filter((elem: HTMLElement) => !elem.parentElement.classList.contains('selected'));\n  highlighted.forEach((elem: HTMLElement) => {\n    elem.setAttribute('fill', null);\n    let rects = elem.querySelectorAll('.sylTextRect-display');\n    if (!rects.length) {\n      if (elem.closest('.syllable') !== null) {\n        rects = elem.closest('.syllable').querySelectorAll('sylTextRect-display');\n      }\n    }\n    rects.forEach(function (rect: HTMLElement) {\n      if (rect.closest('.syllable').classList.contains('selected')) {\n        rect.style.fill = 'red';\n      } else {\n        rect.style.fill = 'blue';\n      }\n      rect.classList.remove('highlighted');\n    });\n    elem.classList.remove('highlighted');\n    elem.querySelectorAll('sylTextRect-display').forEach(rect => {\n      rect.classList.remove('highlighted');\n    });\n  });\n}\n\n/**\n * Highlight a staff a certain color.\n */\nexport function highlight (staff: SVGGElement, color: string): void {\n  const children = Array.from(staff.children);\n  for (var i = 0; i < children.length; i++) {\n    let child = children[i];\n    if (child.tagName === 'path') {\n      child.setAttribute('stroke', color);\n    } else if (child.classList.contains('resizePoint') || child.id === 'resizeRect' || child.classList.contains('skewPoint')) {\n      return;\n    } else if (child.classList.contains('layer')) {\n      Array.from(child.children).forEach(cchild => { children.push(cchild); });\n    } else if (document.getElementsByClassName('highlight-selected').length && \n      document.getElementsByClassName('highlight-selected')[0].id === 'highlight-neume'\n      && child.classList.contains('syllable')) {\n      Array.from(child.children).filter(el => el.classList.contains('neume')).forEach(cchild => { children.push(cchild); });\n    } else {\n      child.setAttribute('fill', color);\n      let rects = child.querySelectorAll('.sylTextRect-display');\n      if (!rects.length) {\n        try {\n          rects = child.closest('.syllable').querySelectorAll('.sylTextRect-display');\n        } catch (e) {\n          rects = [] as unknown as NodeListOf<Element>;\n        }\n      }\n      rects.forEach(function (rect: HTMLElement) {\n        const syllable = rect.closest('.syllable');\n        if (!syllable.classList.contains('selected')) {\n          rect.style.fill = color;\n          rect.classList.add('highlighted');\n        }\n      });\n    }\n    child.classList.add('highlighted');\n  }\n}\n\n/**\n * Highlight each staff a different color.\n */\nexport function setStaffHighlight (): void {\n  const staves = Array.from(document.getElementsByClassName('staff')) as SVGGElement[];\n  for (let i = 0; i < staves.length; i++) {\n    const staffColor = ColorPalette[i % ColorPalette.length];\n    highlight(staves[i], staffColor);\n  }\n}\n\n/**\n * Set a highlight by a different grouping.\n * @param grouping - Either \"staff\", \"syllable\", or \"neume\".\n */\nexport function setGroupingHighlight (grouping: string): void {\n  unsetGroupingHighlight();\n  if (grouping === 'staff') {\n    setStaffHighlight();\n    return;\n  } else if (grouping === 'selection') {\n    const temp = document.querySelector('.sel-by.is-active').id;\n    switch (temp) {\n      case 'selBySyl':\n      case 'selByBBox':\n        grouping = 'syllable';\n        break;\n      case 'selByStaff':\n        grouping = 'staff';\n        break;\n      default:\n        grouping = 'neume';\n        break;\n    }\n    setGroupingHighlight(grouping);\n    return;\n  }\n\n  const groups = document.getElementsByClassName(grouping) as HTMLCollectionOf<HTMLElement>;\n  for (let i = 0; i < groups.length; i++) {\n    const groupColor = ColorPalette[i % ColorPalette.length];\n    if ((groups[i].closest('.selected') === null) && !groups[i].classList.contains('selected')) {\n      groups[i].setAttribute('fill', groupColor);\n      const rects = groups[i].querySelectorAll('.sylTextRect-display') as NodeListOf<HTMLElement>;\n      rects.forEach(function (rect) {\n        rect.style.fill = groupColor;\n      });\n      groups[i].classList.add('highlighted');\n      groups[i].querySelectorAll('.sylTextRect-display').forEach(rect => {\n        rect.classList.add('highlighted');\n      });\n    } else {\n      if (!groups[i].classList.contains('selected')) {\n        groups[i].setAttribute('fill', null);\n      } else {\n        groups[i].setAttribute('fill', '#d00');\n      }\n      groups[i].classList.remove('highlighted');\n    }\n  }\n}\n","import * as Contents from './Contents';\nimport * as Grouping from './Grouping';\nimport * as Notification from '../utils/Notification';\nimport NeonView from '../NeonView';\nimport { SplitHandler } from './StaffTools';\nimport { EditorAction } from '../Types';\n\n/**\n * The NeonView parent to call editor actions.\n */\nlet neonView: NeonView;\n\n/**\n * Initialize NeonView.\n */\nexport function initNeonView (view: NeonView): void {\n  neonView = view;\n  Grouping.initNeonView(view);\n}\n\n/**\n * Return an action that unsets the inclinatum parameter of an nc.\n * @param id - The id of the neume component.\n */\nexport function unsetInclinatumAction (id: string): object {\n  return {\n    'action': 'set',\n    'param': {\n      'elementId': id,\n      'attrType': 'tilt',\n      'attrValue': ''\n    }\n  };\n}\n\n/**\n * Return an action that unsets the virga parameter of an nc.\n * @param id - The id of the neume component.\n */\nexport function unsetVirgaAction (id: string): object {\n  return {\n    'action': 'set',\n    'param': {\n      'elementId': id,\n      'attrType': 'tilt',\n      'attrValue': ''\n    }\n  };\n}\n\n/**\n * Function to handle removing elements\n */\nexport function removeHandler (): void {\n  const toRemove = [];\n  const selected = Array.from(document.getElementsByClassName('selected'));\n  selected.forEach(elem => {\n    toRemove.push(\n      {\n        'action': 'remove',\n        'param': {\n          'elementId': elem.id\n        }\n      }\n    );\n  });\n  const chainAction: EditorAction = {\n    'action': 'chain',\n    'param': toRemove\n  };\n  endOptionsSelection();\n  neonView.edit(chainAction, neonView.view.getCurrentPageURI()).then(() => { neonView.updateForCurrentPage(); });\n}\n\n/**\n * Function to handle re-associating elements to the nearest staff\n */\nexport function changeStaffHandler(): void {\n  const toChange: EditorAction[] = [];\n  const selected = Array.from(document.getElementsByClassName('selected'));\n  selected.forEach(elem => {\n    toChange.push(\n      {\n        'action': 'changeStaff',\n        'param': {\n          'elementId': elem.id\n        }\n      }\n    );\n  });\n  const chainAction: EditorAction = {\n    'action': 'chain',\n    'param': toChange\n  };\n  endOptionsSelection();\n  neonView.edit(chainAction, neonView.view.getCurrentPageURI()).then(() => { neonView.updateForCurrentPage(); });\n}\n\n/**\n * Trigger the extra nc action menu for a selection.\n */\nexport function triggerNcActions (nc: SVGGraphicsElement): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.ncActionContents;\n  } catch (e) {}\n\n  document.querySelector('#Punctum.dropdown-item')\n    .addEventListener('click', () => {\n      const unsetInclinatum = unsetInclinatumAction(nc.id);\n      const unsetVirga = unsetVirgaAction(nc.id);\n      neonView.edit({ 'action': 'chain', 'param': [ unsetInclinatum, unsetVirga ] }, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n\n  document.querySelector('#Inclinatum.dropdown-item')\n    .addEventListener('click', () => {\n      const setInclinatum = {\n        'action': 'set',\n        'param': {\n          'elementId': nc.id,\n          'attrType': 'tilt',\n          'attrValue': 'se'\n        }\n      };\n      neonView.edit(setInclinatum, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n\n  document.querySelector('#Virga.dropdown-item')\n    .addEventListener('click', () => {\n      const unsetInclinatum = unsetInclinatumAction(nc.id);\n      const setVirga = {\n        'action': 'set',\n        'param': {\n          'elementId': nc.id,\n          'attrType': 'tilt',\n          'attrValue': 'n'\n        }\n      };\n      neonView.edit({ 'action': 'chain', 'param': [ unsetInclinatum, setVirga ] }, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n  initOptionsListeners();\n}\n\n/**\n * Trigger extra neume actions.\n */\nexport function triggerNeumeActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.neumeActionContents;\n  } catch (e) {}\n  const neume = document.querySelectorAll('.selected');\n  if (neume.length !== 1) {\n    console.warn('More than one neume selected! Cannot trigger Neume ClickSelect actions.');\n    return;\n  }\n\n  document.querySelector('.grouping')\n    .addEventListener('click', (e) => {\n      const contour = neonView.info.getContourByValue((e.target as HTMLElement).id);\n      triggerChangeGroup(contour);\n    });\n\n  function triggerChangeGroup (contour): void {\n    const changeGroupingAction: EditorAction = {\n      'action': 'changeGroup',\n      'param': {\n        'elementId': neume[0].id,\n        'contour': contour\n      }\n    };\n    neonView.edit(changeGroupingAction, neonView.view.getCurrentPageURI()).then((result) => {\n      if (result) {\n        Notification.queueNotification('Grouping Changed');\n      } else {\n        Notification.queueNotification('Grouping Failed');\n      }\n      endOptionsSelection();\n      neonView.updateForCurrentPage();\n    });\n  }\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n  initOptionsListeners();\n  Grouping.initGroupingListeners();\n}\n\n/**\n * Trigger extra syllable actions.\n */\nexport function triggerSylActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML =\n      '<div><p class=\\'control\\'>' +\n          '<button class=\\'button\\' id=\\'ungroupNeumes\\'>Ungroup</button></p></div>' +\n      '<div><p class=\\'control\\'>' +\n          '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>' +\n      '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>';\n    document.getElementById('changeStaff').addEventListener('click', changeStaffHandler);\n  } catch (e) {}\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n  Grouping.initGroupingListeners();\n}\n\n/**\n * Trigger extra clef actions for a specific clef.\n */\nexport function triggerClefActions (clef: SVGGraphicsElement): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.clefActionContents;\n  } catch (e) {}\n  document.querySelector('#CClef.dropdown-item')\n    .addEventListener('click', () => {\n      const setCClef: EditorAction = {\n        'action': 'setClef',\n        'param': {\n          'elementId': clef.id,\n          'shape': 'C'\n        }\n      };\n      neonView.edit(setCClef, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  document.querySelector('#FClef.dropdown-item')\n    .addEventListener('click', () => {\n      const setFClef: EditorAction = {\n        'action': 'setClef',\n        'param': {\n          'elementId': clef.id,\n          'shape': 'F'\n        }\n      };\n      neonView.edit(setFClef, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n    document.getElementById('changeStaff').addEventListener('click', changeStaffHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n\n  initOptionsListeners();\n}\n\n/**\n * trigger extra custos actions.\n */\nexport function triggerCustosActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML += Contents.custosActionContents;\n  } catch (e) {}\n\n  try {\n    document.getElementById('changeStaff')\n      .addEventListener('click', changeStaffHandler);\n  } catch (e) {}\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n    document.body.addEventListener('keydown', deleteButtonHandler);\n  } catch (e) {}\n}\n\n/**\n * Trigger extra staff actions.\n */\nexport function triggerStaffActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.staffActionContents;\n  } catch (e) {}\n\n  document.getElementById('merge-systems')\n    .addEventListener('click', () => {\n      const systems = document.querySelectorAll('.staff.selected');\n      const elementIds = [];\n      systems.forEach(staff => {\n        elementIds.push(staff.id);\n      });\n      const editorAction: EditorAction = {\n        'action': 'merge',\n        'param': {\n          'elementIds': elementIds\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Staff Merged');\n          endOptionsSelection();\n          neonView.updateForCurrentPage();\n        } else {\n          Notification.queueNotification('Merge Failed');\n        }\n      });\n    });\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * Trigger split staff option\n */\nexport function triggerSplitActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.splitActionContents;\n  } catch (e) {}\n\n  // TODO add trigger for split action\n  document.getElementById('split-system')\n    .addEventListener('click', () => {\n      const staff = document.querySelector('.staff.selected') as SVGGElement;\n      if (staff !== null) {\n        const split = new SplitHandler(neonView, staff);\n        split.startSplit();\n        endOptionsSelection();\n      } else {\n        console.error('No staff was selected!');\n        endOptionsSelection();\n      }\n    });\n\n  document.getElementById('reset-skew')\n    .addEventListener('click', () => {\n      const staff = document.querySelector('.staff.selected') as SVGElement;\n      const rect = staff.querySelector('#resizeRect');\n      const co = rect.getAttribute('points').split(' ');\n      let dy = parseInt(co[0].split(',')[1]) - parseInt(co[1].split(',')[1]);\n      if (staff !== null) {\n        const editorAction: EditorAction = {\n          'action': 'changeSkew',\n          'param': {\n            'elementId': staff.id,\n            'dy': dy,\n            'rightSide': true\n          }\n        };\n        neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then(async (result) => {\n          if (result) {\n            await neonView.updateForCurrentPagePromise();\n          }\n        });\n        endOptionsSelection();\n      } else {\n        console.error('No staff was selected');\n        endOptionsSelection();\n      }\n    });\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * Trigger default selection option.\n */\nexport function triggerDefaultActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.defaultActionContents;\n  } catch (e) {}\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * End the extra options menu.\n */\nexport function endOptionsSelection (): void {\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.innerHTML = '';\n    moreEdit.classList.add('is-invisible');\n  } catch (e) {}\n  document.body.removeEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * Initialize extra dropdown options.\n */\nfunction initOptionsListeners (): void {\n  document.getElementById('drop_select').addEventListener('click', function () {\n    this.classList.toggle('is-active');\n  });\n}\n\n/** Event handler for delete button press. */\nexport function deleteButtonHandler (evt: KeyboardEvent): void {\n  if (evt.key === 'd' || evt.key === 'Backspace') { removeHandler(); evt.preventDefault(); }\n}\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} raw     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     raw True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","/*\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\nvar cache = {};\n\n\n// Do any others need escaping?\nvar TO_ESCAPE = {\n  '\\'': '\\\\\\'',\n  '\\n': '\\\\n'\n};\n\n\nfunction populate(formatter) {\n  var i, type,\n      key = formatter,\n      prev = 0,\n      arg = 1,\n      builder = 'return \\'';\n\n  for (i = 0; i < formatter.length; i++) {\n    if (formatter[i] === '%') {\n      type = formatter[i + 1];\n\n      switch (type) {\n        case 's':\n          builder += formatter.slice(prev, i) + '\\' + arguments[' + arg + '] + \\'';\n          prev = i + 2;\n          arg++;\n          break;\n        case 'j':\n          builder += formatter.slice(prev, i) + '\\' + JSON.stringify(arguments[' + arg + ']) + \\'';\n          prev = i + 2;\n          arg++;\n          break;\n        case '%':\n          builder += formatter.slice(prev, i + 1);\n          prev = i + 2;\n          i++;\n          break;\n      }\n\n\n    } else if (TO_ESCAPE[formatter[i]]) {\n      builder += formatter.slice(prev, i) + TO_ESCAPE[formatter[i]];\n      prev = i + 1;\n    }\n  }\n\n  builder += formatter.slice(prev) + '\\';';\n  cache[key] = new Function(builder);\n}\n\n\n/**\n * A fast version of sprintf(), which currently only supports the %s and %j.\n * This caches a formatting function for each format string that is used, so\n * you should only use this sprintf() will be called many times with a single\n * format string and a limited number of format strings will ever be used (in\n * general this means that format strings should be string literals).\n *\n * @param {String} formatter A format string.\n * @param {...String} var_args Values that will be formatted by %s and %j.\n * @return {String} The formatted output.\n */\nexports.sprintf = function(formatter, var_args) {\n  if (!cache[formatter]) {\n    populate(formatter);\n  }\n\n  return cache[formatter].apply(null, arguments);\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar getOwnPropertyDescriptors = Object.getOwnPropertyDescriptors ||\n  function getOwnPropertyDescriptors(obj) {\n    var keys = Object.keys(obj);\n    var descriptors = {};\n    for (var i = 0; i < keys.length; i++) {\n      descriptors[keys[i]] = Object.getOwnPropertyDescriptor(obj, keys[i]);\n    }\n    return descriptors;\n  };\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  if (typeof process !== 'undefined' && process.noDeprecation === true) {\n    return fn;\n  }\n\n  // Allow for deprecating things in the process of starting up.\n  if (typeof process === 'undefined') {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nvar kCustomPromisifiedSymbol = typeof Symbol !== 'undefined' ? Symbol('util.promisify.custom') : undefined;\n\nexports.promisify = function promisify(original) {\n  if (typeof original !== 'function')\n    throw new TypeError('The \"original\" argument must be of type Function');\n\n  if (kCustomPromisifiedSymbol && original[kCustomPromisifiedSymbol]) {\n    var fn = original[kCustomPromisifiedSymbol];\n    if (typeof fn !== 'function') {\n      throw new TypeError('The \"util.promisify.custom\" argument must be of type Function');\n    }\n    Object.defineProperty(fn, kCustomPromisifiedSymbol, {\n      value: fn, enumerable: false, writable: false, configurable: true\n    });\n    return fn;\n  }\n\n  function fn() {\n    var promiseResolve, promiseReject;\n    var promise = new Promise(function (resolve, reject) {\n      promiseResolve = resolve;\n      promiseReject = reject;\n    });\n\n    var args = [];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    args.push(function (err, value) {\n      if (err) {\n        promiseReject(err);\n      } else {\n        promiseResolve(value);\n      }\n    });\n\n    try {\n      original.apply(this, args);\n    } catch (err) {\n      promiseReject(err);\n    }\n\n    return promise;\n  }\n\n  Object.setPrototypeOf(fn, Object.getPrototypeOf(original));\n\n  if (kCustomPromisifiedSymbol) Object.defineProperty(fn, kCustomPromisifiedSymbol, {\n    value: fn, enumerable: false, writable: false, configurable: true\n  });\n  return Object.defineProperties(\n    fn,\n    getOwnPropertyDescriptors(original)\n  );\n}\n\nexports.promisify.custom = kCustomPromisifiedSymbol\n\nfunction callbackifyOnRejected(reason, cb) {\n  // `!reason` guard inspired by bluebird (Ref: https://goo.gl/t5IS6M).\n  // Because `null` is a special error value in callbacks which means \"no error\n  // occurred\", we error-wrap so the callback consumer can distinguish between\n  // \"the promise rejected with null\" or \"the promise fulfilled with undefined\".\n  if (!reason) {\n    var newReason = new Error('Promise was rejected with a falsy value');\n    newReason.reason = reason;\n    reason = newReason;\n  }\n  return cb(reason);\n}\n\nfunction callbackify(original) {\n  if (typeof original !== 'function') {\n    throw new TypeError('The \"original\" argument must be of type Function');\n  }\n\n  // We DO NOT return the promise as it gives the user a false sense that\n  // the promise is actually somehow related to the callback's execution\n  // and that the callback throwing will reject the promise.\n  function callbackified() {\n    var args = [];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n\n    var maybeCb = args.pop();\n    if (typeof maybeCb !== 'function') {\n      throw new TypeError('The last argument must be of type Function');\n    }\n    var self = this;\n    var cb = function() {\n      return maybeCb.apply(self, arguments);\n    };\n    // In true node style we process the callback on `nextTick` with all the\n    // implications (stack, `uncaughtException`, `async_hooks`)\n    original.apply(this, args)\n      .then(function(ret) { process.nextTick(cb, null, ret) },\n            function(rej) { process.nextTick(callbackifyOnRejected, rej, cb) });\n  }\n\n  Object.setPrototypeOf(callbackified, Object.getPrototypeOf(original));\n  Object.defineProperties(callbackified,\n                          getOwnPropertyDescriptors(original));\n  return callbackified;\n}\nexports.callbackify = callbackify;\n","exports = module.exports = require('./lib/_stream_readable.js');\nexports.Stream = exports;\nexports.Readable = exports;\nexports.Writable = require('./lib/_stream_writable.js');\nexports.Duplex = require('./lib/_stream_duplex.js');\nexports.Transform = require('./lib/_stream_transform.js');\nexports.PassThrough = require('./lib/_stream_passthrough.js');\n","/* eslint-disable node/no-deprecated-api */\nvar buffer = require('buffer')\nvar Buffer = buffer.Buffer\n\n// alternative to using Object.keys for old browsers\nfunction copyProps (src, dst) {\n  for (var key in src) {\n    dst[key] = src[key]\n  }\n}\nif (Buffer.from && Buffer.alloc && Buffer.allocUnsafe && Buffer.allocUnsafeSlow) {\n  module.exports = buffer\n} else {\n  // Copy properties from require('buffer')\n  copyProps(buffer, exports)\n  exports.Buffer = SafeBuffer\n}\n\nfunction SafeBuffer (arg, encodingOrOffset, length) {\n  return Buffer(arg, encodingOrOffset, length)\n}\n\n// Copy static methods from Buffer\ncopyProps(Buffer, SafeBuffer)\n\nSafeBuffer.from = function (arg, encodingOrOffset, length) {\n  if (typeof arg === 'number') {\n    throw new TypeError('Argument must not be a number')\n  }\n  return Buffer(arg, encodingOrOffset, length)\n}\n\nSafeBuffer.alloc = function (size, fill, encoding) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  var buf = Buffer(size)\n  if (fill !== undefined) {\n    if (typeof encoding === 'string') {\n      buf.fill(fill, encoding)\n    } else {\n      buf.fill(fill)\n    }\n  } else {\n    buf.fill(0)\n  }\n  return buf\n}\n\nSafeBuffer.allocUnsafe = function (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  return Buffer(size)\n}\n\nSafeBuffer.allocUnsafeSlow = function (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  return buffer.SlowBuffer(size)\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// A bit simpler than readable streams.\n// Implement an async ._write(chunk, encoding, cb), and it'll handle all\n// the drain event emission and buffering.\n\n'use strict';\n\n/*<replacement>*/\n\nvar pna = require('process-nextick-args');\n/*</replacement>*/\n\nmodule.exports = Writable;\n\n/* <replacement> */\nfunction WriteReq(chunk, encoding, cb) {\n  this.chunk = chunk;\n  this.encoding = encoding;\n  this.callback = cb;\n  this.next = null;\n}\n\n// It seems a linked list but it is not\n// there will be only 2 of these for each stream\nfunction CorkedRequest(state) {\n  var _this = this;\n\n  this.next = null;\n  this.entry = null;\n  this.finish = function () {\n    onCorkedFinish(_this, state);\n  };\n}\n/* </replacement> */\n\n/*<replacement>*/\nvar asyncWrite = !process.browser && ['v0.10', 'v0.9.'].indexOf(process.version.slice(0, 5)) > -1 ? setImmediate : pna.nextTick;\n/*</replacement>*/\n\n/*<replacement>*/\nvar Duplex;\n/*</replacement>*/\n\nWritable.WritableState = WritableState;\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\n/*<replacement>*/\nvar internalUtil = {\n  deprecate: require('util-deprecate')\n};\n/*</replacement>*/\n\n/*<replacement>*/\nvar Stream = require('./internal/streams/stream');\n/*</replacement>*/\n\n/*<replacement>*/\n\nvar Buffer = require('safe-buffer').Buffer;\nvar OurUint8Array = global.Uint8Array || function () {};\nfunction _uint8ArrayToBuffer(chunk) {\n  return Buffer.from(chunk);\n}\nfunction _isUint8Array(obj) {\n  return Buffer.isBuffer(obj) || obj instanceof OurUint8Array;\n}\n\n/*</replacement>*/\n\nvar destroyImpl = require('./internal/streams/destroy');\n\nutil.inherits(Writable, Stream);\n\nfunction nop() {}\n\nfunction WritableState(options, stream) {\n  Duplex = Duplex || require('./_stream_duplex');\n\n  options = options || {};\n\n  // Duplex streams are both readable and writable, but share\n  // the same options object.\n  // However, some cases require setting options to different\n  // values for the readable and the writable sides of the duplex stream.\n  // These options can be provided separately as readableXXX and writableXXX.\n  var isDuplex = stream instanceof Duplex;\n\n  // object stream flag to indicate whether or not this stream\n  // contains buffers or objects.\n  this.objectMode = !!options.objectMode;\n\n  if (isDuplex) this.objectMode = this.objectMode || !!options.writableObjectMode;\n\n  // the point at which write() starts returning false\n  // Note: 0 is a valid value, means that we always return false if\n  // the entire buffer is not flushed immediately on write()\n  var hwm = options.highWaterMark;\n  var writableHwm = options.writableHighWaterMark;\n  var defaultHwm = this.objectMode ? 16 : 16 * 1024;\n\n  if (hwm || hwm === 0) this.highWaterMark = hwm;else if (isDuplex && (writableHwm || writableHwm === 0)) this.highWaterMark = writableHwm;else this.highWaterMark = defaultHwm;\n\n  // cast to ints.\n  this.highWaterMark = Math.floor(this.highWaterMark);\n\n  // if _final has been called\n  this.finalCalled = false;\n\n  // drain event flag.\n  this.needDrain = false;\n  // at the start of calling end()\n  this.ending = false;\n  // when end() has been called, and returned\n  this.ended = false;\n  // when 'finish' is emitted\n  this.finished = false;\n\n  // has it been destroyed\n  this.destroyed = false;\n\n  // should we decode strings into buffers before passing to _write?\n  // this is here so that some node-core streams can optimize string\n  // handling at a lower level.\n  var noDecode = options.decodeStrings === false;\n  this.decodeStrings = !noDecode;\n\n  // Crypto is kind of old and crusty.  Historically, its default string\n  // encoding is 'binary' so we have to make this configurable.\n  // Everything else in the universe uses 'utf8', though.\n  this.defaultEncoding = options.defaultEncoding || 'utf8';\n\n  // not an actual buffer we keep track of, but a measurement\n  // of how much we're waiting to get pushed to some underlying\n  // socket or file.\n  this.length = 0;\n\n  // a flag to see when we're in the middle of a write.\n  this.writing = false;\n\n  // when true all writes will be buffered until .uncork() call\n  this.corked = 0;\n\n  // a flag to be able to tell if the onwrite cb is called immediately,\n  // or on a later tick.  We set this to true at first, because any\n  // actions that shouldn't happen until \"later\" should generally also\n  // not happen before the first write call.\n  this.sync = true;\n\n  // a flag to know if we're processing previously buffered items, which\n  // may call the _write() callback in the same tick, so that we don't\n  // end up in an overlapped onwrite situation.\n  this.bufferProcessing = false;\n\n  // the callback that's passed to _write(chunk,cb)\n  this.onwrite = function (er) {\n    onwrite(stream, er);\n  };\n\n  // the callback that the user supplies to write(chunk,encoding,cb)\n  this.writecb = null;\n\n  // the amount that is being written when _write is called.\n  this.writelen = 0;\n\n  this.bufferedRequest = null;\n  this.lastBufferedRequest = null;\n\n  // number of pending user-supplied write callbacks\n  // this must be 0 before 'finish' can be emitted\n  this.pendingcb = 0;\n\n  // emit prefinish if the only thing we're waiting for is _write cbs\n  // This is relevant for synchronous Transform streams\n  this.prefinished = false;\n\n  // True if the error was already emitted and should not be thrown again\n  this.errorEmitted = false;\n\n  // count buffered requests\n  this.bufferedRequestCount = 0;\n\n  // allocate the first CorkedRequest, there is always\n  // one allocated and free to use, and we maintain at most two\n  this.corkedRequestsFree = new CorkedRequest(this);\n}\n\nWritableState.prototype.getBuffer = function getBuffer() {\n  var current = this.bufferedRequest;\n  var out = [];\n  while (current) {\n    out.push(current);\n    current = current.next;\n  }\n  return out;\n};\n\n(function () {\n  try {\n    Object.defineProperty(WritableState.prototype, 'buffer', {\n      get: internalUtil.deprecate(function () {\n        return this.getBuffer();\n      }, '_writableState.buffer is deprecated. Use _writableState.getBuffer ' + 'instead.', 'DEP0003')\n    });\n  } catch (_) {}\n})();\n\n// Test _writableState for inheritance to account for Duplex streams,\n// whose prototype chain only points to Readable.\nvar realHasInstance;\nif (typeof Symbol === 'function' && Symbol.hasInstance && typeof Function.prototype[Symbol.hasInstance] === 'function') {\n  realHasInstance = Function.prototype[Symbol.hasInstance];\n  Object.defineProperty(Writable, Symbol.hasInstance, {\n    value: function (object) {\n      if (realHasInstance.call(this, object)) return true;\n      if (this !== Writable) return false;\n\n      return object && object._writableState instanceof WritableState;\n    }\n  });\n} else {\n  realHasInstance = function (object) {\n    return object instanceof this;\n  };\n}\n\nfunction Writable(options) {\n  Duplex = Duplex || require('./_stream_duplex');\n\n  // Writable ctor is applied to Duplexes, too.\n  // `realHasInstance` is necessary because using plain `instanceof`\n  // would return false, as no `_writableState` property is attached.\n\n  // Trying to use the custom `instanceof` for Writable here will also break the\n  // Node.js LazyTransform implementation, which has a non-trivial getter for\n  // `_writableState` that would lead to infinite recursion.\n  if (!realHasInstance.call(Writable, this) && !(this instanceof Duplex)) {\n    return new Writable(options);\n  }\n\n  this._writableState = new WritableState(options, this);\n\n  // legacy.\n  this.writable = true;\n\n  if (options) {\n    if (typeof options.write === 'function') this._write = options.write;\n\n    if (typeof options.writev === 'function') this._writev = options.writev;\n\n    if (typeof options.destroy === 'function') this._destroy = options.destroy;\n\n    if (typeof options.final === 'function') this._final = options.final;\n  }\n\n  Stream.call(this);\n}\n\n// Otherwise people can pipe Writable streams, which is just wrong.\nWritable.prototype.pipe = function () {\n  this.emit('error', new Error('Cannot pipe, not readable'));\n};\n\nfunction writeAfterEnd(stream, cb) {\n  var er = new Error('write after end');\n  // TODO: defer error events consistently everywhere, not just the cb\n  stream.emit('error', er);\n  pna.nextTick(cb, er);\n}\n\n// Checks that a user-supplied chunk is valid, especially for the particular\n// mode the stream is in. Currently this means that `null` is never accepted\n// and undefined/non-string values are only allowed in object mode.\nfunction validChunk(stream, state, chunk, cb) {\n  var valid = true;\n  var er = false;\n\n  if (chunk === null) {\n    er = new TypeError('May not write null values to stream');\n  } else if (typeof chunk !== 'string' && chunk !== undefined && !state.objectMode) {\n    er = new TypeError('Invalid non-string/buffer chunk');\n  }\n  if (er) {\n    stream.emit('error', er);\n    pna.nextTick(cb, er);\n    valid = false;\n  }\n  return valid;\n}\n\nWritable.prototype.write = function (chunk, encoding, cb) {\n  var state = this._writableState;\n  var ret = false;\n  var isBuf = !state.objectMode && _isUint8Array(chunk);\n\n  if (isBuf && !Buffer.isBuffer(chunk)) {\n    chunk = _uint8ArrayToBuffer(chunk);\n  }\n\n  if (typeof encoding === 'function') {\n    cb = encoding;\n    encoding = null;\n  }\n\n  if (isBuf) encoding = 'buffer';else if (!encoding) encoding = state.defaultEncoding;\n\n  if (typeof cb !== 'function') cb = nop;\n\n  if (state.ended) writeAfterEnd(this, cb);else if (isBuf || validChunk(this, state, chunk, cb)) {\n    state.pendingcb++;\n    ret = writeOrBuffer(this, state, isBuf, chunk, encoding, cb);\n  }\n\n  return ret;\n};\n\nWritable.prototype.cork = function () {\n  var state = this._writableState;\n\n  state.corked++;\n};\n\nWritable.prototype.uncork = function () {\n  var state = this._writableState;\n\n  if (state.corked) {\n    state.corked--;\n\n    if (!state.writing && !state.corked && !state.finished && !state.bufferProcessing && state.bufferedRequest) clearBuffer(this, state);\n  }\n};\n\nWritable.prototype.setDefaultEncoding = function setDefaultEncoding(encoding) {\n  // node::ParseEncoding() requires lower case.\n  if (typeof encoding === 'string') encoding = encoding.toLowerCase();\n  if (!(['hex', 'utf8', 'utf-8', 'ascii', 'binary', 'base64', 'ucs2', 'ucs-2', 'utf16le', 'utf-16le', 'raw'].indexOf((encoding + '').toLowerCase()) > -1)) throw new TypeError('Unknown encoding: ' + encoding);\n  this._writableState.defaultEncoding = encoding;\n  return this;\n};\n\nfunction decodeChunk(state, chunk, encoding) {\n  if (!state.objectMode && state.decodeStrings !== false && typeof chunk === 'string') {\n    chunk = Buffer.from(chunk, encoding);\n  }\n  return chunk;\n}\n\nObject.defineProperty(Writable.prototype, 'writableHighWaterMark', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function () {\n    return this._writableState.highWaterMark;\n  }\n});\n\n// if we're already writing something, then just put this\n// in the queue, and wait our turn.  Otherwise, call _write\n// If we return false, then we need a drain event, so set that flag.\nfunction writeOrBuffer(stream, state, isBuf, chunk, encoding, cb) {\n  if (!isBuf) {\n    var newChunk = decodeChunk(state, chunk, encoding);\n    if (chunk !== newChunk) {\n      isBuf = true;\n      encoding = 'buffer';\n      chunk = newChunk;\n    }\n  }\n  var len = state.objectMode ? 1 : chunk.length;\n\n  state.length += len;\n\n  var ret = state.length < state.highWaterMark;\n  // we must ensure that previous needDrain will not be reset to false.\n  if (!ret) state.needDrain = true;\n\n  if (state.writing || state.corked) {\n    var last = state.lastBufferedRequest;\n    state.lastBufferedRequest = {\n      chunk: chunk,\n      encoding: encoding,\n      isBuf: isBuf,\n      callback: cb,\n      next: null\n    };\n    if (last) {\n      last.next = state.lastBufferedRequest;\n    } else {\n      state.bufferedRequest = state.lastBufferedRequest;\n    }\n    state.bufferedRequestCount += 1;\n  } else {\n    doWrite(stream, state, false, len, chunk, encoding, cb);\n  }\n\n  return ret;\n}\n\nfunction doWrite(stream, state, writev, len, chunk, encoding, cb) {\n  state.writelen = len;\n  state.writecb = cb;\n  state.writing = true;\n  state.sync = true;\n  if (writev) stream._writev(chunk, state.onwrite);else stream._write(chunk, encoding, state.onwrite);\n  state.sync = false;\n}\n\nfunction onwriteError(stream, state, sync, er, cb) {\n  --state.pendingcb;\n\n  if (sync) {\n    // defer the callback if we are being called synchronously\n    // to avoid piling up things on the stack\n    pna.nextTick(cb, er);\n    // this can emit finish, and it will always happen\n    // after error\n    pna.nextTick(finishMaybe, stream, state);\n    stream._writableState.errorEmitted = true;\n    stream.emit('error', er);\n  } else {\n    // the caller expect this to happen before if\n    // it is async\n    cb(er);\n    stream._writableState.errorEmitted = true;\n    stream.emit('error', er);\n    // this can emit finish, but finish must\n    // always follow error\n    finishMaybe(stream, state);\n  }\n}\n\nfunction onwriteStateUpdate(state) {\n  state.writing = false;\n  state.writecb = null;\n  state.length -= state.writelen;\n  state.writelen = 0;\n}\n\nfunction onwrite(stream, er) {\n  var state = stream._writableState;\n  var sync = state.sync;\n  var cb = state.writecb;\n\n  onwriteStateUpdate(state);\n\n  if (er) onwriteError(stream, state, sync, er, cb);else {\n    // Check if we're actually ready to finish, but don't emit yet\n    var finished = needFinish(state);\n\n    if (!finished && !state.corked && !state.bufferProcessing && state.bufferedRequest) {\n      clearBuffer(stream, state);\n    }\n\n    if (sync) {\n      /*<replacement>*/\n      asyncWrite(afterWrite, stream, state, finished, cb);\n      /*</replacement>*/\n    } else {\n      afterWrite(stream, state, finished, cb);\n    }\n  }\n}\n\nfunction afterWrite(stream, state, finished, cb) {\n  if (!finished) onwriteDrain(stream, state);\n  state.pendingcb--;\n  cb();\n  finishMaybe(stream, state);\n}\n\n// Must force callback to be called on nextTick, so that we don't\n// emit 'drain' before the write() consumer gets the 'false' return\n// value, and has a chance to attach a 'drain' listener.\nfunction onwriteDrain(stream, state) {\n  if (state.length === 0 && state.needDrain) {\n    state.needDrain = false;\n    stream.emit('drain');\n  }\n}\n\n// if there's something in the buffer waiting, then process it\nfunction clearBuffer(stream, state) {\n  state.bufferProcessing = true;\n  var entry = state.bufferedRequest;\n\n  if (stream._writev && entry && entry.next) {\n    // Fast case, write everything using _writev()\n    var l = state.bufferedRequestCount;\n    var buffer = new Array(l);\n    var holder = state.corkedRequestsFree;\n    holder.entry = entry;\n\n    var count = 0;\n    var allBuffers = true;\n    while (entry) {\n      buffer[count] = entry;\n      if (!entry.isBuf) allBuffers = false;\n      entry = entry.next;\n      count += 1;\n    }\n    buffer.allBuffers = allBuffers;\n\n    doWrite(stream, state, true, state.length, buffer, '', holder.finish);\n\n    // doWrite is almost always async, defer these to save a bit of time\n    // as the hot path ends with doWrite\n    state.pendingcb++;\n    state.lastBufferedRequest = null;\n    if (holder.next) {\n      state.corkedRequestsFree = holder.next;\n      holder.next = null;\n    } else {\n      state.corkedRequestsFree = new CorkedRequest(state);\n    }\n    state.bufferedRequestCount = 0;\n  } else {\n    // Slow case, write chunks one-by-one\n    while (entry) {\n      var chunk = entry.chunk;\n      var encoding = entry.encoding;\n      var cb = entry.callback;\n      var len = state.objectMode ? 1 : chunk.length;\n\n      doWrite(stream, state, false, len, chunk, encoding, cb);\n      entry = entry.next;\n      state.bufferedRequestCount--;\n      // if we didn't call the onwrite immediately, then\n      // it means that we need to wait until it does.\n      // also, that means that the chunk and cb are currently\n      // being processed, so move the buffer counter past them.\n      if (state.writing) {\n        break;\n      }\n    }\n\n    if (entry === null) state.lastBufferedRequest = null;\n  }\n\n  state.bufferedRequest = entry;\n  state.bufferProcessing = false;\n}\n\nWritable.prototype._write = function (chunk, encoding, cb) {\n  cb(new Error('_write() is not implemented'));\n};\n\nWritable.prototype._writev = null;\n\nWritable.prototype.end = function (chunk, encoding, cb) {\n  var state = this._writableState;\n\n  if (typeof chunk === 'function') {\n    cb = chunk;\n    chunk = null;\n    encoding = null;\n  } else if (typeof encoding === 'function') {\n    cb = encoding;\n    encoding = null;\n  }\n\n  if (chunk !== null && chunk !== undefined) this.write(chunk, encoding);\n\n  // .end() fully uncorks\n  if (state.corked) {\n    state.corked = 1;\n    this.uncork();\n  }\n\n  // ignore unnecessary end() calls.\n  if (!state.ending && !state.finished) endWritable(this, state, cb);\n};\n\nfunction needFinish(state) {\n  return state.ending && state.length === 0 && state.bufferedRequest === null && !state.finished && !state.writing;\n}\nfunction callFinal(stream, state) {\n  stream._final(function (err) {\n    state.pendingcb--;\n    if (err) {\n      stream.emit('error', err);\n    }\n    state.prefinished = true;\n    stream.emit('prefinish');\n    finishMaybe(stream, state);\n  });\n}\nfunction prefinish(stream, state) {\n  if (!state.prefinished && !state.finalCalled) {\n    if (typeof stream._final === 'function') {\n      state.pendingcb++;\n      state.finalCalled = true;\n      pna.nextTick(callFinal, stream, state);\n    } else {\n      state.prefinished = true;\n      stream.emit('prefinish');\n    }\n  }\n}\n\nfunction finishMaybe(stream, state) {\n  var need = needFinish(state);\n  if (need) {\n    prefinish(stream, state);\n    if (state.pendingcb === 0) {\n      state.finished = true;\n      stream.emit('finish');\n    }\n  }\n  return need;\n}\n\nfunction endWritable(stream, state, cb) {\n  state.ending = true;\n  finishMaybe(stream, state);\n  if (cb) {\n    if (state.finished) pna.nextTick(cb);else stream.once('finish', cb);\n  }\n  state.ended = true;\n  stream.writable = false;\n}\n\nfunction onCorkedFinish(corkReq, state, err) {\n  var entry = corkReq.entry;\n  corkReq.entry = null;\n  while (entry) {\n    var cb = entry.callback;\n    state.pendingcb--;\n    cb(err);\n    entry = entry.next;\n  }\n  if (state.corkedRequestsFree) {\n    state.corkedRequestsFree.next = corkReq;\n  } else {\n    state.corkedRequestsFree = corkReq;\n  }\n}\n\nObject.defineProperty(Writable.prototype, 'destroyed', {\n  get: function () {\n    if (this._writableState === undefined) {\n      return false;\n    }\n    return this._writableState.destroyed;\n  },\n  set: function (value) {\n    // we ignore the value if the stream\n    // has not been initialized yet\n    if (!this._writableState) {\n      return;\n    }\n\n    // backward compatibility, the user is explicitly\n    // managing destroyed\n    this._writableState.destroyed = value;\n  }\n});\n\nWritable.prototype.destroy = destroyImpl.destroy;\nWritable.prototype._undestroy = destroyImpl.undestroy;\nWritable.prototype._destroy = function (err, cb) {\n  this.end();\n  cb(err);\n};","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n/*<replacement>*/\n\nvar Buffer = require('safe-buffer').Buffer;\n/*</replacement>*/\n\nvar isEncoding = Buffer.isEncoding || function (encoding) {\n  encoding = '' + encoding;\n  switch (encoding && encoding.toLowerCase()) {\n    case 'hex':case 'utf8':case 'utf-8':case 'ascii':case 'binary':case 'base64':case 'ucs2':case 'ucs-2':case 'utf16le':case 'utf-16le':case 'raw':\n      return true;\n    default:\n      return false;\n  }\n};\n\nfunction _normalizeEncoding(enc) {\n  if (!enc) return 'utf8';\n  var retried;\n  while (true) {\n    switch (enc) {\n      case 'utf8':\n      case 'utf-8':\n        return 'utf8';\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return 'utf16le';\n      case 'latin1':\n      case 'binary':\n        return 'latin1';\n      case 'base64':\n      case 'ascii':\n      case 'hex':\n        return enc;\n      default:\n        if (retried) return; // undefined\n        enc = ('' + enc).toLowerCase();\n        retried = true;\n    }\n  }\n};\n\n// Do not cache `Buffer.isEncoding` when checking encoding names as some\n// modules monkey-patch it to support additional encodings\nfunction normalizeEncoding(enc) {\n  var nenc = _normalizeEncoding(enc);\n  if (typeof nenc !== 'string' && (Buffer.isEncoding === isEncoding || !isEncoding(enc))) throw new Error('Unknown encoding: ' + enc);\n  return nenc || enc;\n}\n\n// StringDecoder provides an interface for efficiently splitting a series of\n// buffers into a series of JS strings without breaking apart multi-byte\n// characters.\nexports.StringDecoder = StringDecoder;\nfunction StringDecoder(encoding) {\n  this.encoding = normalizeEncoding(encoding);\n  var nb;\n  switch (this.encoding) {\n    case 'utf16le':\n      this.text = utf16Text;\n      this.end = utf16End;\n      nb = 4;\n      break;\n    case 'utf8':\n      this.fillLast = utf8FillLast;\n      nb = 4;\n      break;\n    case 'base64':\n      this.text = base64Text;\n      this.end = base64End;\n      nb = 3;\n      break;\n    default:\n      this.write = simpleWrite;\n      this.end = simpleEnd;\n      return;\n  }\n  this.lastNeed = 0;\n  this.lastTotal = 0;\n  this.lastChar = Buffer.allocUnsafe(nb);\n}\n\nStringDecoder.prototype.write = function (buf) {\n  if (buf.length === 0) return '';\n  var r;\n  var i;\n  if (this.lastNeed) {\n    r = this.fillLast(buf);\n    if (r === undefined) return '';\n    i = this.lastNeed;\n    this.lastNeed = 0;\n  } else {\n    i = 0;\n  }\n  if (i < buf.length) return r ? r + this.text(buf, i) : this.text(buf, i);\n  return r || '';\n};\n\nStringDecoder.prototype.end = utf8End;\n\n// Returns only complete characters in a Buffer\nStringDecoder.prototype.text = utf8Text;\n\n// Attempts to complete a partial non-UTF-8 character using bytes from a Buffer\nStringDecoder.prototype.fillLast = function (buf) {\n  if (this.lastNeed <= buf.length) {\n    buf.copy(this.lastChar, this.lastTotal - this.lastNeed, 0, this.lastNeed);\n    return this.lastChar.toString(this.encoding, 0, this.lastTotal);\n  }\n  buf.copy(this.lastChar, this.lastTotal - this.lastNeed, 0, buf.length);\n  this.lastNeed -= buf.length;\n};\n\n// Checks the type of a UTF-8 byte, whether it's ASCII, a leading byte, or a\n// continuation byte. If an invalid byte is detected, -2 is returned.\nfunction utf8CheckByte(byte) {\n  if (byte <= 0x7F) return 0;else if (byte >> 5 === 0x06) return 2;else if (byte >> 4 === 0x0E) return 3;else if (byte >> 3 === 0x1E) return 4;\n  return byte >> 6 === 0x02 ? -1 : -2;\n}\n\n// Checks at most 3 bytes at the end of a Buffer in order to detect an\n// incomplete multi-byte UTF-8 character. The total number of bytes (2, 3, or 4)\n// needed to complete the UTF-8 character (if applicable) are returned.\nfunction utf8CheckIncomplete(self, buf, i) {\n  var j = buf.length - 1;\n  if (j < i) return 0;\n  var nb = utf8CheckByte(buf[j]);\n  if (nb >= 0) {\n    if (nb > 0) self.lastNeed = nb - 1;\n    return nb;\n  }\n  if (--j < i || nb === -2) return 0;\n  nb = utf8CheckByte(buf[j]);\n  if (nb >= 0) {\n    if (nb > 0) self.lastNeed = nb - 2;\n    return nb;\n  }\n  if (--j < i || nb === -2) return 0;\n  nb = utf8CheckByte(buf[j]);\n  if (nb >= 0) {\n    if (nb > 0) {\n      if (nb === 2) nb = 0;else self.lastNeed = nb - 3;\n    }\n    return nb;\n  }\n  return 0;\n}\n\n// Validates as many continuation bytes for a multi-byte UTF-8 character as\n// needed or are available. If we see a non-continuation byte where we expect\n// one, we \"replace\" the validated continuation bytes we've seen so far with\n// a single UTF-8 replacement character ('\\ufffd'), to match v8's UTF-8 decoding\n// behavior. The continuation byte check is included three times in the case\n// where all of the continuation bytes for a character exist in the same buffer.\n// It is also done this way as a slight performance increase instead of using a\n// loop.\nfunction utf8CheckExtraBytes(self, buf, p) {\n  if ((buf[0] & 0xC0) !== 0x80) {\n    self.lastNeed = 0;\n    return '\\ufffd';\n  }\n  if (self.lastNeed > 1 && buf.length > 1) {\n    if ((buf[1] & 0xC0) !== 0x80) {\n      self.lastNeed = 1;\n      return '\\ufffd';\n    }\n    if (self.lastNeed > 2 && buf.length > 2) {\n      if ((buf[2] & 0xC0) !== 0x80) {\n        self.lastNeed = 2;\n        return '\\ufffd';\n      }\n    }\n  }\n}\n\n// Attempts to complete a multi-byte UTF-8 character using bytes from a Buffer.\nfunction utf8FillLast(buf) {\n  var p = this.lastTotal - this.lastNeed;\n  var r = utf8CheckExtraBytes(this, buf, p);\n  if (r !== undefined) return r;\n  if (this.lastNeed <= buf.length) {\n    buf.copy(this.lastChar, p, 0, this.lastNeed);\n    return this.lastChar.toString(this.encoding, 0, this.lastTotal);\n  }\n  buf.copy(this.lastChar, p, 0, buf.length);\n  this.lastNeed -= buf.length;\n}\n\n// Returns all complete UTF-8 characters in a Buffer. If the Buffer ended on a\n// partial character, the character's bytes are buffered until the required\n// number of bytes are available.\nfunction utf8Text(buf, i) {\n  var total = utf8CheckIncomplete(this, buf, i);\n  if (!this.lastNeed) return buf.toString('utf8', i);\n  this.lastTotal = total;\n  var end = buf.length - (total - this.lastNeed);\n  buf.copy(this.lastChar, 0, end);\n  return buf.toString('utf8', i, end);\n}\n\n// For UTF-8, a replacement character is added when ending on a partial\n// character.\nfunction utf8End(buf) {\n  var r = buf && buf.length ? this.write(buf) : '';\n  if (this.lastNeed) return r + '\\ufffd';\n  return r;\n}\n\n// UTF-16LE typically needs two bytes per character, but even if we have an even\n// number of bytes available, we need to check if we end on a leading/high\n// surrogate. In that case, we need to wait for the next two bytes in order to\n// decode the last character properly.\nfunction utf16Text(buf, i) {\n  if ((buf.length - i) % 2 === 0) {\n    var r = buf.toString('utf16le', i);\n    if (r) {\n      var c = r.charCodeAt(r.length - 1);\n      if (c >= 0xD800 && c <= 0xDBFF) {\n        this.lastNeed = 2;\n        this.lastTotal = 4;\n        this.lastChar[0] = buf[buf.length - 2];\n        this.lastChar[1] = buf[buf.length - 1];\n        return r.slice(0, -1);\n      }\n    }\n    return r;\n  }\n  this.lastNeed = 1;\n  this.lastTotal = 2;\n  this.lastChar[0] = buf[buf.length - 1];\n  return buf.toString('utf16le', i, buf.length - 1);\n}\n\n// For UTF-16LE we do not explicitly append special replacement characters if we\n// end on a partial character, we simply let v8 handle that.\nfunction utf16End(buf) {\n  var r = buf && buf.length ? this.write(buf) : '';\n  if (this.lastNeed) {\n    var end = this.lastTotal - this.lastNeed;\n    return r + this.lastChar.toString('utf16le', 0, end);\n  }\n  return r;\n}\n\nfunction base64Text(buf, i) {\n  var n = (buf.length - i) % 3;\n  if (n === 0) return buf.toString('base64', i);\n  this.lastNeed = 3 - n;\n  this.lastTotal = 3;\n  if (n === 1) {\n    this.lastChar[0] = buf[buf.length - 1];\n  } else {\n    this.lastChar[0] = buf[buf.length - 2];\n    this.lastChar[1] = buf[buf.length - 1];\n  }\n  return buf.toString('base64', i, buf.length - n);\n}\n\nfunction base64End(buf) {\n  var r = buf && buf.length ? this.write(buf) : '';\n  if (this.lastNeed) return r + this.lastChar.toString('base64', 0, 3 - this.lastNeed);\n  return r;\n}\n\n// Pass bytes on through for single-byte encodings (e.g. ascii, latin1, hex)\nfunction simpleWrite(buf) {\n  return buf.toString(this.encoding);\n}\n\nfunction simpleEnd(buf) {\n  return buf && buf.length ? this.write(buf) : '';\n}","function uint8ToUuid (data: Uint8Array): string {\n  if (data.length !== 16) {\n    return '';\n  }\n\n  function cb (previous: string, current: number): string {\n    return previous + current.toString(16).padStart(2, '0');\n  }\n\n  return data.slice(0, 4).reduce(cb, '') +\n    '-' + data.slice(4, 6).reduce(cb, '') +\n    '-' + data.slice(6, 8).reduce(cb, '') +\n    '-' + data.slice(8, 10).reduce(cb, '') +\n    '-' + data.slice(10).reduce(cb, '');\n}\n\nexport function uuidv4 (): string {\n  // Check for crypto API\n  if (window.crypto === undefined) {\n    return uint8ToUuid(new Uint8Array(16));\n  }\n\n  // Get 16 octets for UUID\n  const octets = new Uint8Array(16);\n  const modifiers = Uint8Array.from([\n    parseInt('01000000', 2),  // Version bits (4 => 0100)\n    parseInt('10000000', 2),  // Variant bits (10x)\n    parseInt('00001111', 2),  // Mask to zero higher bits, version\n    parseInt('00111111', 2)   // Mask to zero higher bits, variant\n  ]);\n  window.crypto.getRandomValues(octets);\n  // Set version bits and variant bits\n  octets[6] = (octets[6] & modifiers[2]) | modifiers[0];\n  octets[8] = (octets[8] & modifiers[3]) | modifiers[1];\n\n  return uint8ToUuid(octets);\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar punycode = require('punycode');\nvar util = require('./util');\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // Special case for a simple path URL\n    simplePathPattern = /^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[+a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = require('querystring');\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && util.isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!util.isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  // Copy chrome, IE, opera backslash-handling behavior.\n  // Back slashes before the query string get converted to forward slashes\n  // See: https://code.google.com/p/chromium/issues/detail?id=25916\n  var queryIndex = url.indexOf('?'),\n      splitter =\n          (queryIndex !== -1 && queryIndex < url.indexOf('#')) ? '?' : '#',\n      uSplit = url.split(splitter),\n      slashRegex = /\\\\/g;\n  uSplit[0] = uSplit[0].replace(slashRegex, '/');\n  url = uSplit.join(splitter);\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  if (!slashesDenoteHost && url.split('#').length === 1) {\n    // Try fast path regexp\n    var simplePath = simplePathPattern.exec(rest);\n    if (simplePath) {\n      this.path = rest;\n      this.href = rest;\n      this.pathname = simplePath[1];\n      if (simplePath[2]) {\n        this.search = simplePath[2];\n        if (parseQueryString) {\n          this.query = querystring.parse(this.search.substr(1));\n        } else {\n          this.query = this.search.substr(1);\n        }\n      } else if (parseQueryString) {\n        this.search = '';\n        this.query = {};\n      }\n      return this;\n    }\n  }\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a punycoded representation of \"domain\".\n      // It only converts parts of the domain name that\n      // have non-ASCII characters, i.e. it doesn't matter if\n      // you call it with a domain that already is ASCII-only.\n      this.hostname = punycode.toASCII(this.hostname);\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      if (rest.indexOf(ae) === -1)\n        continue;\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (util.isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      util.isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (util.isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  var tkeys = Object.keys(this);\n  for (var tk = 0; tk < tkeys.length; tk++) {\n    var tkey = tkeys[tk];\n    result[tkey] = this[tkey];\n  }\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    var rkeys = Object.keys(relative);\n    for (var rk = 0; rk < rkeys.length; rk++) {\n      var rkey = rkeys[rk];\n      if (rkey !== 'protocol')\n        result[rkey] = relative[rkey];\n    }\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      var keys = Object.keys(relative);\n      for (var v = 0; v < keys.length; v++) {\n        var k = keys[v];\n        result[k] = relative[k];\n      }\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!util.isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especially happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host || srcPath.length > 1) &&\n      (last === '.' || last === '..') || last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last === '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especially happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n","\nvar urilib = require('url');\nvar helpers = require('./helpers');\n\nmodule.exports.SchemaScanResult = SchemaScanResult;\nfunction SchemaScanResult(found, ref){\n  this.id = found;\n  this.ref = ref;\n}\n\n/**\n * Adds a schema with a certain urn to the Validator instance.\n * @param string uri\n * @param object schema\n * @return {Object}\n */\nmodule.exports.scan = function scan(base, schema){\n  function scanSchema(baseuri, schema){\n    if(!schema || typeof schema!='object') return;\n    // Mark all referenced schemas so we can tell later which schemas are referred to, but never defined\n    if(schema.$ref){\n      var resolvedUri = urilib.resolve(baseuri, schema.$ref);\n      ref[resolvedUri] = ref[resolvedUri] ? ref[resolvedUri]+1 : 0;\n      return;\n    }\n    var ourBase = schema.id ? urilib.resolve(baseuri, schema.id) : baseuri;\n    if (ourBase) {\n      // If there's no fragment, append an empty one\n      if(ourBase.indexOf('#')<0) ourBase += '#';\n      if(found[ourBase]){\n        if(!helpers.deepCompareStrict(found[ourBase], schema)){\n          throw new Error('Schema <'+schema+'> already exists with different definition');\n        }\n        return found[ourBase];\n      }\n      found[ourBase] = schema;\n      // strip trailing fragment\n      if(ourBase[ourBase.length-1]=='#'){\n        found[ourBase.substring(0, ourBase.length-1)] = schema;\n      }\n    }\n    scanArray(ourBase+'/items', ((schema.items instanceof Array)?schema.items:[schema.items]));\n    scanArray(ourBase+'/extends', ((schema.extends instanceof Array)?schema.extends:[schema.extends]));\n    scanSchema(ourBase+'/additionalItems', schema.additionalItems);\n    scanObject(ourBase+'/properties', schema.properties);\n    scanSchema(ourBase+'/additionalProperties', schema.additionalProperties);\n    scanObject(ourBase+'/definitions', schema.definitions);\n    scanObject(ourBase+'/patternProperties', schema.patternProperties);\n    scanObject(ourBase+'/dependencies', schema.dependencies);\n    scanArray(ourBase+'/disallow', schema.disallow);\n    scanArray(ourBase+'/allOf', schema.allOf);\n    scanArray(ourBase+'/anyOf', schema.anyOf);\n    scanArray(ourBase+'/oneOf', schema.oneOf);\n    scanSchema(ourBase+'/not', schema.not);\n  }\n  function scanArray(baseuri, schemas){\n    if(!(schemas instanceof Array)) return;\n    for(var i=0; i<schemas.length; i++){\n      scanSchema(baseuri+'/'+i, schemas[i]);\n    }\n  }\n  function scanObject(baseuri, schemas){\n    if(!schemas || typeof schemas!='object') return;\n    for(var p in schemas){\n      scanSchema(baseuri+'/'+p, schemas[p]);\n    }\n  }\n\n  var found = {};\n  var ref = {};\n  var schemaUri = base;\n  scanSchema(base, schema);\n  return new SchemaScanResult(found, ref);\n}\n","/**\n * Update the cursor to a crosshair.\n */\nexport function updateCursor (): void {\n  return;\n}\n\n/**\n * Reset the cursor to the typical pointer.\n */\nexport function resetCursor (): void {\n  return;\n}\n\n/**\n * Update to specified cursor type.\n * @param {string} type - The CSS cursor property value.\n */\nexport function updateCursorTo (_type: string): void {\n  return;\n}\n","/**\n * HTML for each insert tab (neume, grouping, clef, system, and division).\n */\nexport const insertTabHtml: Record<string, string> = {\n  primitiveTab: '<p class=\\'control\\'>' +\n        '<button id=\\'punctum\\' class=\\'button insertel smallel\\' title=\\'punctum\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/punctum.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'virga\\' class=\\'button insertel smallel\\' title=\\'virga\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/virga.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'diamond\\' class=\\'button insertel smallel\\' title=\\'inclinatum\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/diamond.png' + '\\' class=\\'image\\'/></button></p>' +\n  /*  \"<p class='control'>\" +\n        \"<button id='white_punct' class='button insertel smallel' title='white punctum'><img src='\" + White__ASSET_PREFIX__ + 'assets/img/punctum.png' + \"' class='image'/></button></p>\" +\n        \"<p class='control'>\" +\n        \"<button id='quilisma' class='button insertel smallel' title='quilisma'><img src='\" + __ASSET_PREFIX__ + 'assets/img/quilisma.png' + \"' class='image'/></button></p>\" + */\n        '<p class=\\'control\\'>' +\n        '<button id=\\'custos\\' class=\\'button insertel smallel\\' title=\\'custos\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/custos.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'cClef\\' class=\\'button insertel smallel\\' title=\\' C Clef\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/cClef.png' + '\\' class=\\'image\\' /></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'fClef\\' class=\\'button insertel smallel\\' title=\\'F Clef\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/fClef.png' + '\\' class=\\'image\\'/></button></p>',\n  groupingTab: '<p class=\\'control\\'>' +\n        '<button id=\\'pes\\' class=\\'button insertel smallel\\' title=\\'pes\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/pes.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'clivis\\' class=\\'button insertel smallel\\' title=\\'clivis\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/clivis.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'scandicus\\' class=\\'button insertel smallel\\' title=\\'scandicus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/scandicus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'climacus\\' class=\\'button insertel smallel\\' title=\\'climacus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/climacus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'torculus\\' class=\\'button insertel smallel\\' title=\\'toculus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/torculus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'porrectus\\' class=\\'button insertel smallel\\' title=\\'porrectus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/porrectus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'pressus\\' class=\\'button insertel smallel\\' title=\\'pressus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/pressus.png' + '\\' class=\\'image\\'/></button></p>',\n  systemTab: '<p class=\\'control\\'>' +\n        '<button id=\\'staff\\' class=\\'button insertel longel\\' title=\\'system\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/staff.png' + '\\' class=\\'image\\' /></button></p>' +\n        '<p>Click upper left and lower right corners of new staff.</p>'\n  // divisionTab: \"<p class='control'>\" +\n  //     \"<button id='smallDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/smalldiv.png' + \"' class='image'/></button></p>\" +\n  //     \"<p class='control'>\" +\n  //     \"<button id='minorDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/minordiv.png' +\"' class='image'/></button></p>\" +\n  //     \"<p class='control'>\" +\n  //     \"<button id='majorDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/majordiv.png' + \"' class='image'/></button></p>\" +\n  //     \"<p class='control'>\" +\n  //     \"<button id='finalDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/finaldiv.png' + \"' class='image'/></button></p>\"\n};\n\n/**\n * Structure of insert panel with basic grouping tabs.\n */\nexport const insertControlsPanel: string =\n    '<p class=\\'panel-heading\\' id=\\'insertMenu\\'>Insert' +\n    '<svg class=\\'icon is-pulled-right\\'><use id=\\'toggleInsert\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></p>' +\n    '<div id=\\'insertContents\\' style=\\'overflow-y: hidden;\\'>' +\n    '<p class=\\'panel-tabs\\'>' +\n    '<a id=\\'primitiveTab\\' class=\\'insertTab\\'>Primitive Elements</a>' +\n    '<a id=\\'groupingTab\\' class=\\'insertTab\\'>Grouping</a>' +\n    '<a id=\\'systemTab\\' class=\\'insertTab\\'>System</a></p>' +\n    // \"<a id='divisionTab' class='insertTab'>Division</a></p>\" +\n    '<a class=\\'panel-block has-text-centered\\'>' +\n    '<div id=\\'insert_data\\' class=\\'field is-grouped buttons\\'></div></a></div>';\n\n/**\n * Contents of edit panel with buttons.\n */\nexport const editControlsPanel: string =\n    '<p class=\\'panel-heading\\' id=\\'editMenu\\'>Edit' +\n    '<svg class=\\'icon is-pulled-right\\'><use id=\\'toggleEdit\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></p>' +\n    '<div id=\\'editContents\\'>' +\n    '<a class=\\'panel-block\\'>' +\n    '<label>Select By:&nbsp;</label>' +\n    '<div class=\\'field has-addons buttons\\' style=\\'overflow-x: auto;\\'>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by is-active\\' id=\\'selBySyl\\'>Syllable</button></p>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by\\' id=\\'selByNeume\\'>Neume</button></p>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by\\' id=\\'selByNc\\'>Neume Component</button></p>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by\\' id=\\'selByStaff\\'>Staff</button></p></div></a>' +\n    '<div class=\\'field is-grouped buttons\\'>' +\n    '<p class=\\'control\\'>' +\n    '<a id=\\'moreEdit\\' class=\\'panel-block is-invisible\\'>' +\n    '<a id=\\'neumeEdit\\' class=\\'panel-block is-invisible\\'></div>';\n\n/**\n * Contents of extra nc action menu.\n */\nexport const ncActionContents: string =\n        '<label>Change Head Shape:&nbsp;</label>' +\n        '<div id=\\'drop_select\\' class=\\'dropdown\\'>' +\n        '<div class=\\'dropdown-trigger\\'>' +\n        '<button id=\\'select-options\\' class=\\'button\\' aria-haspopup=\\'true\\' aria-controls=\\'dropdown-menu\\'>' +\n        '<span>Head Shapes</span>' +\n        '<svg class=\\'icon\\'><use xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></button></div>' +\n        '<div class=\\'dropdown-menu\\' id=\\'dropdown-menu\\' role=\\'menu\\'>' +\n        '<div class=\\'dropdown-content\\'>' +\n        '<a id=\\'Punctum\\' class=\\'dropdown-item\\'>Punctum</a>' +\n        '<a id=\\'Virga\\' class=\\'dropdown-item\\'>Virga</a>' +\n        '<a id=\\'Inclinatum\\' class=\\'dropdown-item\\'>Inclinatum</a></div></div></div>' +\n        '<p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of extra neume action menu.\n */\nexport const neumeActionContents: string =\n        '<label>Change Grouping:&nbsp;</label>' +\n        '<div id=\\'drop_select\\' class=\\'dropdown\\'>' +\n        '<div class=\\'dropdown-trigger\\'>' +\n        '<button id=\\'select-options\\' class=\\'button\\' aria-haspopup=\\'true\\' aria-controls=\\'dropdown-menu\\'>' +\n        '<span>Groupings</span>' +\n        '<svg class=\\'icon\\'><use xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></button></div>' +\n        '<div class=\\'dropdown-menu\\' id=\\'dropdown-menu\\' role=\\'menu\\'>' +\n        '<div class=\\'dropdown-content scrollable-dropdown\\'>' +\n        '<a id=\\'Pes\\' class=\\'dropdown-item grouping\\'>Pes</a>' +\n        '<a id=\\'Pes subpunctis\\' class=\\'dropdown-item grouping\\'>Pes Subpunctis</a>' +\n        '<a id=\\'Clivis\\' class=\\'dropdown-item grouping\\'>Clivis</a>' +\n        '<a id=\\'Scandicus\\' class=\\'dropdown-item grouping\\'>Scandicus</a>' +\n        '<a id=\\'Scandicus flexus\\' class=\\'dropdown-item grouping\\'>Scandicus Flexus</a>' +\n        '<a id=\\'Scandicus subpunctis\\' class=\\'dropdown-item grouping\\'>Scandicus Subpunctis</a>' +\n        '<a id=\\'Climacus\\' class=\\'dropdown-item grouping\\'>Climacus</a>' +\n        '<a id=\\'Climacus resupinus\\' class=\\'dropdown-item grouping\\'>Climacus Resupinus</a>' +\n        '<a id=\\'Torculus\\' class=\\'dropdown-item grouping\\'>Torculus</a>' +\n        '<a id=\\'Torculus resupinus\\' class=\\'dropdown-item grouping\\'>Torculus Resupinus</a>' +\n        '<a id=\\'Porrectus\\' class=\\'dropdown-item grouping\\'>Porrectus</a>' +\n        '<a id=\\'Porrectus flexus\\' class=\\'dropdown-item grouping\\'>Porrectus Flexus</a>' +\n        '<a id=\\'Porrectus subpunctis\\' class=\\'dropdown-item grouping\\'>Porrectus Subpunctis</a>' +\n        '<a id=\\'Pressus\\' class=\\'dropdown-item grouping\\'>Pressus</a>' +\n        '</div></div></div>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'ungroupNcs\\'>Ungroup</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of extra staff action menu.\n */\nexport const staffActionContents: string =\n    '<label>Merge Systems:&nbsp;</label>' +\n    '<div><p class=\\'control\\'>' +\n    '<button id=\\'merge-systems\\' class=\\'button\\'>Merge</button>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of default action menu.\n */\nexport const defaultActionContents: string =\n    '<div><p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of custos action menu.\n */\nexport const custosActionContents: string =\n    '<div><p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n    '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>';\n\n/**\n * Contents of split action menu.\n * @type {string}\n */\nexport const splitActionContents: string=\n    '<label>Split System:&nbsp;</label>' +\n    '<div><p class=\\'control\\'>' +\n    '<button id=\\'split-system\\' class=\\'button\\'>Split</button>' +\n    '<button id=\\'reset-skew\\' class=\\'button\\'>Reset Skew</button>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of extra clef action menu.\n */\nexport const clefActionContents: string =\n    '<label>Change Clef Shape:&nbsp;</label>' +\n    '<div id=\\'drop_select\\' class=\\'dropdown\\'>' +\n    '<div class=\\'dropdown-trigger\\'>' +\n    '<button id=\\'select-options\\' class=\\'button\\' aria-haspopup=\\'true\\' aria-controls=\\'dropdown-menu\\'>' +\n    '<span>Clef Shapes</span>' +\n    '<svg class=\\'icon\\'><use xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></button></div>' +\n    '<div class=\\'dropdown-menu\\' id=\\'dropdown-menu\\' role=\\'menu\\'>' +\n    '<div class=\\'dropdown-content\\'>' +\n    '<a id=\\'CClef\\' class=\\'dropdown-item\\'>C Clef</a>' +\n    '<a id=\\'FClef\\' class=\\'dropdown-item\\'>F Clef</a></div></div>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n    '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></div>';\n\n/**\n * HTML for grouping selection menu.\n */\nexport const groupingMenu: object = {\n  'nc': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'groupNcs\\'>Group Neume Components</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>',\n  'neume': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'groupNeumes\\'>Group Neumes</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>',\n  'syl': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'mergeSyls\\'>Merge Syllables</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n        '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>',\n  'ligatureNc': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'groupNcs\\'>Group Neume Components</button></p></div>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'toggle-ligature\\'>Toggle Ligature</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div></div>',\n  'ligature': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'toggle-ligature\\'>Toggle Ligature</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div></div>',\n  'splitSyllable': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'toggle-link\\'>Toggle Linked Syllables</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div></div>'\n};\n","/** @module utils/Select */\n\nimport {\n  unselect, getStaffBBox, selectStaff, selectAll, getSelectionType\n} from './SelectTools';\nimport { resize } from './Resize';\nimport NeonView from '../NeonView';\nimport DragHandler from './DragHandler';\nimport { InfoInterface } from '../Interfaces';\nimport ZoomHandler from '../SingleView/Zoom';\n\nimport * as d3 from 'd3';\n\nlet dragHandler: DragHandler, neonView: NeonView, info: InfoInterface, zoomHandler: ZoomHandler;\nlet strokeWidth = 7;\n\nexport function setSelectStrokeWidth (width: number): void {\n  strokeWidth = width;\n}\n\n/**\n * Set the objects for this module.\n */\nexport function setSelectHelperObjects (nv: NeonView, dh: DragHandler): void {\n  dragHandler = dh;\n  neonView = nv;\n  info = neonView.info;\n  zoomHandler = neonView.view.zoomHandler;\n}\n\nfunction escapeKeyListener (evt: KeyboardEvent): void {\n  if (evt.key === 'Escape') {\n    if (document.getElementsByClassName('selected').length > 0) {\n      info.infoListeners();\n    }\n    unselect();\n  }\n}\n\nfunction isSelByBBox (): boolean {\n  const selByBBox = document.getElementById('selByBBox');\n  if (selByBBox) {\n    return selByBBox.classList.contains('is-active');\n  }\n  return false;\n}\n\nfunction stopPropHandler (evt): void { evt.stopPropagation(); }\n\n/**\n * Apply listeners for click selection.\n * @param selector - The CSS selector used to choose where listeners are applied.\n */\nexport function clickSelect (selector: string): void {\n  document.querySelectorAll(selector).forEach(sel => {\n    sel.removeEventListener('mousedown', clickHandler);\n    sel.addEventListener('mousedown', clickHandler);\n  });\n\n  // Click away listeners\n  document.body.removeEventListener('keydown', escapeKeyListener);\n  document.body.addEventListener('keydown', escapeKeyListener);\n\n  document.getElementById('container')\n    .addEventListener('contextmenu', (evt) => { evt.preventDefault(); });\n\n  document.querySelectorAll('use,rect,#moreEdit').forEach(sel => {\n    sel.removeEventListener('click', stopPropHandler);\n    sel.addEventListener('click', stopPropHandler);\n  });\n}\n\n/**\n * Handle click events related to element selection.\n */\nfunction clickHandler (evt: MouseEvent): void {\n  if (!neonView) return;\n  const mode = neonView.getUserMode();\n\n  // If in insert mode or panning is active from shift key\n  if (mode === 'insert' || evt.shiftKey) { return; }\n  // Check if the element being clicked on is part of a drag Selection\n  if (this.tagName === 'use' && getSelectionType() !== 'selByBBox') {\n    if (this.closest('.selected') === null) {\n      let selection = [this];\n      // Check if this is part of a ligature and, if so, add all of it to the selection.\n      const firstLigatureHalf = /E9B[45678]/;\n      const secondLigatureHalf = /E9B[9ABC]/;\n      if (this.getAttribute('xlink:href').match(secondLigatureHalf)) {\n        // This is the second part of a ligature\n        const nc = this.closest('.nc');\n        const neume = this.closest('.neume');\n        const ncIndex = Array.from(neume.children).indexOf(nc);\n        const firstUse = neume.children[ncIndex - 1].children[0];\n        console.assert(firstUse.getAttribute('xlink:href').match(firstLigatureHalf), 'First glyph of ligature unexpected!');\n        if (firstUse.closest('.selected') === null) {\n          selection.unshift(firstUse);\n        }\n      } else if (this.getAttribute('xlink:href').match(firstLigatureHalf)) {\n        // This is the first part of a ligature\n        const nc = this.closest('.nc');\n        const neume = this.closest('.neume');\n        const ncIndex = Array.from(neume.children).indexOf(nc);\n        const secondUse = neume.children[ncIndex + 1].children[0];\n        console.assert(secondUse.getAttribute('xlink:href').match(secondLigatureHalf), 'Second glyph of ligature unexpected!');\n        if (secondUse.closest('.selected') === null) {\n          selection.push(secondUse);\n        }\n      }\n      if (window.navigator.userAgent.match(/Mac/) ? evt.metaKey : evt.ctrlKey) {\n        selection = selection.concat(Array.from(document.getElementsByClassName('selected')));\n      }\n      selectAll(selection, neonView, dragHandler);\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n    }\n  } else if ((evt.target as HTMLElement).tagName === 'rect' && getSelectionType() === 'selByBBox') {\n    if (this.closest('.selected') === null) {\n      let selection = [evt.target] as SVGGElement[];\n      if (window.navigator.userAgent.match(/Mac/) ? evt.metaKey : evt.ctrlKey) {\n        selection = selection.concat(Array.from(document.getElementsByClassName('selected')) as SVGGElement[]);\n      }\n      selectAll(selection, neonView, dragHandler);\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n    }\n  } else {\n    // Check if the point being clicked on is a staff selection (if applicable)\n    if (getSelectionType() !== 'selByStaff') {\n      info.infoListeners();\n      return;\n    }\n\n    // Check if the point is in a staff.\n    const container = document.getElementsByClassName('active-page')[0].getElementsByClassName('definition-scale')[0] as SVGSVGElement;\n    let pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGraphicsElement).getScreenCTM();\n    pt = pt.matrixTransform(transformMatrix.inverse());\n\n    const selectedStaves = Array.from(document.getElementsByClassName('staff'))\n      .filter((staff: SVGGElement) => {\n        const bbox = getStaffBBox(staff);\n        return (bbox.ulx < pt.x && pt.x < bbox.lrx) && (bbox.uly < pt.y && pt.y < bbox.lry);\n      });\n    if (selectedStaves.length !== 1) {\n      if (document.getElementsByClassName('selected').length > 0) {\n        info.infoListeners();\n      }\n      unselect();\n      return;\n    }\n\n    // Select a staff\n    const staff = selectedStaves[0] as SVGGElement;\n    if (!staff.classList.contains('selected')) {\n      // Select previously unselected staff\n      selectStaff(staff, dragHandler);\n      resize(staff, neonView, dragHandler);\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n    }\n    // Trigger mousedown event on the staff\n    staff.dispatchEvent(new MouseEvent('mousedown', {\n      screenX: evt.screenX,\n      screenY: evt.screenY,\n      clientX: evt.clientX,\n      clientY: evt.clientY,\n      ctrlKey: evt.ctrlKey,\n      shiftKey: evt.shiftKey,\n      altKey: evt.altKey,\n      metaKey: evt.metaKey,\n      view: evt.view\n    }));\n  }\n}\n\n/**\n * Apply listeners for drag selection.\n * @param selector - The CSS selector used to choose where listeners are applied.\n */\nexport function dragSelect (selector: string): void {\n  let initialX = 0;\n  let initialY = 0;\n  let panning = false;\n  let dragSelecting = false;\n  // var canvas = d3.select('#svg_group');\n  d3.selectAll(selector.replace('.active-page', '').trim())\n    .on('.drag', null);\n  const canvas = d3.select(selector);\n  const dragSelectAction = d3.drag()\n    .on('start', selStart)\n    .on('drag', selecting)\n    .on('end', selEnd);\n  canvas.call(dragSelectAction);\n  if (dragHandler) {\n    dragHandler.resetTo(dragSelectAction);\n  }\n\n  function selStart (): void {\n    if (!neonView) return;\n    const userMode = neonView.getUserMode();\n    if (d3.event.sourceEvent.target.nodeName !== 'use' && userMode !== 'insert' && d3.event.sourceEvent.target.nodeName !== 'rect') {\n      if (!d3.event.sourceEvent.shiftKey) { // If not holding down shift key to pan\n        if (!document.getElementById('selByStaff').classList.contains('is-active') ||\n          pointNotInStaff(d3.mouse(this))) {\n          unselect();\n          dragSelecting = true;\n          const initialP = d3.mouse(this);\n          initialX = initialP[0];\n          initialY = initialP[1];\n          initRect(initialX, initialY);\n        }\n      } else {\n        panning = true;\n        if (zoomHandler !== undefined) {\n          zoomHandler.startDrag();\n        }\n      }\n    } else if (d3.event.sourceEvent.shiftKey) {\n      panning = true;\n      if (zoomHandler !== undefined) {\n        zoomHandler.startDrag();\n      }\n    }\n  }\n\n  /**\n   * Check if a point is in the bounds of a staff element.\n   * Skew is not taken into account.\n   */\n  function pointNotInStaff (point: number[]): boolean {\n    const staves = Array.from(document.getElementsByClassName('staff'));\n    const filtered = staves.filter((staff: SVGGElement) => {\n      const box = getStaffBBox(staff);\n      return (box.ulx < point[0] && point[0] < box.lrx) && (box.uly < point[1] && point[1] < box.lry);\n    });\n    return (filtered.length === 0);\n  }\n\n  function selecting (): void {\n    if (!panning && dragSelecting) {\n      const currentPt = d3.mouse(this);\n      const curX = currentPt[0];\n      const curY = currentPt[1];\n\n      const newX = curX < initialX ? curX : initialX;\n      const newY = curY < initialY ? curY : initialY;\n      const width = curX < initialX ? initialX - curX : curX - initialX;\n      const height = curY < initialY ? initialY - curY : curY - initialY;\n\n      updateRect(newX, newY, width, height);\n    } else if (panning) {\n      if (zoomHandler !== undefined) {\n        zoomHandler.dragging();\n      }\n    }\n  }\n\n  function selEnd (): void {\n    if (!panning && dragSelecting) {\n      const rx = parseInt(document.getElementById('selectRect').getAttribute('x'));\n      const ry = parseInt(document.getElementById('selectRect').getAttribute('y'));\n      const lx = parseInt(document.getElementById('selectRect').getAttribute('x')) +\n        parseInt(document.getElementById('selectRect').getAttribute('width'));\n      const ly = parseInt(document.getElementById('selectRect').getAttribute('y')) +\n        parseInt(document.getElementById('selectRect').getAttribute('height'));\n      // Transform to the correct coordinate system\n      const node = canvas.node() as SVGSVGElement;\n      let ul = node.createSVGPoint();\n      ul.x = rx;\n      ul.y = ry;\n      let lr = node.createSVGPoint();\n      lr.x = lx;\n      lr.y = ly;\n      const transform = node.getScreenCTM().inverse()\n        .multiply((canvas.select('.system').node() as SVGGraphicsElement)\n          .getScreenCTM()).inverse();\n      ul = ul.matrixTransform(transform);\n      lr = lr.matrixTransform(transform);\n\n      let nc;\n      if (document.getElementById('selByStaff').classList.contains('is-active')) {\n        nc = document.querySelectorAll(selector + ' use, ' + selector + ' .staff');\n      } else if (isSelByBBox()) {\n        nc = document.querySelectorAll(selector + ' .sylTextRect-display');\n      } else {\n        nc = document.querySelectorAll(selector + ' use');\n      }\n      const els = Array.from(nc);\n\n      const elements = els.filter(function (d: SVGGraphicsElement): boolean {\n        let ulx, uly, lrx, lry;\n        if (isSelByBBox()) {\n          ulx = Number(d.getAttribute('x'));\n          uly = Number(d.getAttribute('y'));\n          lrx = +ulx + +(d.getAttribute('width').slice(0, -2));\n          lry = +uly + +(d.getAttribute('height').slice(0, -2));\n          return !(((ul.x < ulx && lr.x < ulx) || (ul.x > lrx && lr.x > lrx)) || ((ul.y < uly && lr.y < uly) || (ul.y > lry && lr.y > lry)));\n        } else if (d.tagName === 'use') {\n          const box = (d.parentNode as SVGGElement).getBBox();\n          ulx = box.x;\n          uly = box.y;\n          lrx = box.x + box.width;\n          lry = box.y + box.height;\n          return !(((ul.x < ulx && lr.x < ulx) || (ul.x > lrx && lr.x > lrx)) || ((ul.y < uly && lr.y < uly) || (ul.y > lry && lr.y > lry)));\n        } else {\n          const box = getStaffBBox(d);\n          return !(((ul.x < box.ulx && lr.x < box.ulx) || (ul.x > box.lrx && lr.x > box.lrx)) || ((ul.y < box.uly && lr.y < box.uly) || (ul.y > box.lry && lr.y > box.lry)));\n        }\n      }) as SVGGraphicsElement[];\n\n      // Get other halves of ligatures if only one is selected\n      elements.forEach((element: SVGElement) => {\n        if (element.tagName === 'use' && element.getAttribute('xlink:href').match(/E9B[456789ABC]/)) {\n          const neume = element.closest('.neume');\n          const ncIndex = Array.from(neume.children).indexOf(element.closest('.nc'));\n          if (element.getAttribute('xlink:href').match(/E9B[45678]/)) {\n            // Add second half of ligature to selected list if not already present\n            const secondNc = neume.children[ncIndex + 1];\n            const secondUse = secondNc.querySelector('use');\n            if (elements.indexOf(secondUse) < 0) {\n              elements.push(secondUse);\n            }\n          } else {\n            // Add first half of ligature to selected list if not already present\n            const firstNc = neume.children[ncIndex - 1];\n            const firstUse = firstNc.querySelector('use');\n            if (elements.indexOf(firstUse) < 0) {\n              elements.push(firstUse);\n            }\n          }\n        }\n      });\n      selectAll(elements, neonView, dragHandler);\n\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n      d3.selectAll('#selectRect').remove();\n      dragSelecting = false;\n    }\n    panning = false;\n  }\n\n  /**\n     * Create an initial dragging rectangle.\n     * @param ulx - The upper left x-position of the new rectangle.\n     * @param uly - The upper left y-position of the new rectangle.\n     */\n  function initRect (ulx: number, uly: number): void {\n    canvas.append('rect')\n      .attr('x', ulx)\n      .attr('y', uly)\n      .attr('width', 0)\n      .attr('height', 0)\n      .attr('id', 'selectRect')\n      .attr('stroke', 'black')\n      .attr('stroke-width', strokeWidth)\n      .attr('fill', 'none');\n  }\n\n  /**\n     * Update the dragging rectangle.\n     * @param newX - The new ulx.\n     * @param newY - The new uly.\n     * @param currentWidth - The width of the rectangle in pixels.\n     * @param currentHeight - The height of the rectangle in pixels.\n     */\n  function updateRect (newX: number, newY: number, currentWidth: number, currentHeight: number): void {\n    d3.select('#selectRect')\n      .attr('x', newX)\n      .attr('y', newY)\n      .attr('width', currentWidth)\n      .attr('height', currentHeight);\n  }\n}\n","import NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport * as d3 from 'd3';\n\nclass DragHandler {\n  private dragStartCoords: Array<number>;\n  private dragEndCoords: Array<number>;\n  private resetToAction: (selection: d3.Selection<d3.BaseType, {}, HTMLElement, any>, args: any[]) => void;\n  readonly neonView: NeonView;\n  private selector: string;\n  private selection: Element[];\n\n  constructor (neonView: NeonView, selector: string) {\n    this.neonView = neonView;\n    this.selector = selector;\n  }\n\n  /**\n   * Initialize the dragging action and handler for selected elements.\n   */\n  dragInit (): void {\n    // Adding listeners\n    const dragBehaviour = d3.drag()\n      .on('start', dragStarted.bind(this))\n      .on('drag', this.dragging.bind(this))\n      .on('end', this.dragEnded.bind(this));\n\n    const activeNc = d3.selectAll('.selected');\n    const selection = Array.from(document.getElementsByClassName('selected'));\n    this.selection = selection.concat(Array.from(document.getElementsByClassName('resizePoint')));\n\n    this.dragStartCoords = new Array(activeNc.size());\n    this.dragEndCoords = new Array(activeNc.size());\n\n    activeNc.call(dragBehaviour);\n\n    // Drag effects\n    function dragStarted (): void {\n      const target = d3.event.sourceEvent.target;\n      this.dragStartCoords = d3.mouse(target);\n      if (target.classList.contains('staff')) {\n        d3.select(this.selector).call(dragBehaviour);\n      }\n    }\n  }\n\n  dragging (): void {\n    const relativeY = d3.event.y - this.dragStartCoords[1];\n    const relativeX = d3.event.x - this.dragStartCoords[0];\n    this.selection.forEach((el) => {\n      d3.select(el).attr('transform', function () {\n        return 'translate(' + [relativeX, relativeY] + ')';\n      });\n    });\n    /*\n     * if we're dragging a syllable (or neume etc) then there won't be a syl selected\n     * then we don't want the bounding box (if it is displayed) to move when dragging the neumes\n     * it will be a child of the element in selection, so it will get moved in the above loop\n     * so we cancel that movement out here\n     */\n    if (this.selection.filter((element: HTMLElement) => element.classList.contains('syl')).length === 0) {\n      d3.selectAll('.syllable.selected').selectAll('.sylTextRect-display').attr('transform', function () {\n        return 'translate(' + [-1 * relativeX, -1 * relativeY] + ')';\n      });\n    }\n  }\n\n  dragEnded (): void {\n    this.dragEndCoords = [d3.event.x, d3.event.y];\n    const paramArray = [];\n    this.selection.filter((el: SVGElement) => !el.classList.contains('resizePoint')).forEach((el: SVGElement) => {\n      const id = (el.tagName === 'rect') ? el.closest('.syl').id : el.id;\n      const singleAction = { action: 'drag',\n        param: { elementId: id,\n          x: this.dragEndCoords[0] - this.dragStartCoords[0],\n          y: (this.dragEndCoords[1] - this.dragStartCoords[1]) * -1 }\n      };\n      paramArray.push(singleAction);\n    });\n    const editorAction: EditorAction = {\n      'action': 'chain',\n      'param': paramArray\n    };\n\n    const xDiff = Math.abs(this.dragStartCoords[0] - this.dragEndCoords[0]);\n    const yDiff = Math.abs(this.dragStartCoords[1] - this.dragEndCoords[1]);\n\n    if (xDiff > 5 || yDiff > 5) {\n      this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then(() => {\n        this.neonView.updateForCurrentPage();\n        this.endOptionsSelection();\n        this.reset();\n        this.dragInit();\n      });\n    } else {\n      this.reset();\n      this.dragInit();\n    }\n  }\n\n  /** Set the d3 action to use for [[reset]]. */\n  resetTo (reset: (selection: d3.Selection<d3.BaseType, {}, HTMLElement, any>, args: any[]) => void): void {\n    this.resetToAction = reset;\n  }\n\n  /** Reset to a previous d3 action for [[this.selector]]. */\n  reset (): void {\n    if (this.resetToAction !== undefined) {\n      d3.select(this.selector).call(this.resetToAction);\n    }\n  }\n\n  endOptionsSelection (): void {\n    try {\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('moreEdit').classList.add('is-invisible');\n    } catch (e) {}\n  }\n}\n\nexport { DragHandler as default };\n","import immediate from 'immediate';\nimport uuidV4 from 'uuid';\nimport Md5 from 'spark-md5';\nimport vuvuzela from 'vuvuzela';\nimport getArguments from 'argsarray';\nimport inherits from 'inherits';\nimport { EventEmitter } from 'events';\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = global.setImmediate || global.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EventEmitter);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EventEmitter.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev$$1 = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev$$1] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev$$1});\n    }\n    return rev$$1;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      immediate(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EventEmitter);\n\nfunction AbstractPouchDB() {\n  EventEmitter.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev$$1,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev$$1) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev$$1,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev$$1) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev$$1 = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev$$1);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev$$1);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev$$1) {\n      addToMissing(id, rev$$1);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev$$1) {\n      if (height[rev$$1] > maxHeight) {\n        candidates.push(rev$$1);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev$$1 = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev$$1) !== -1) {\n        revs.push(rev$$1);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      /* istanbul ignore if */\n      if (!path) {\n        err = new Error('invalid rev tree');\n        err.docId = id;\n        return cb(err);\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev$$1) {\n            return rev$$1.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev$$1) {\n          pos--;\n          return {\n            rev: pos + '-' + rev$$1.id,\n            status: rev$$1.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EventEmitter();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EventEmitter.prototype).forEach(function (key) {\n    if (typeof EventEmitter.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.1.1\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n//#7458: execute function mergeAndedSelectors on nested $and\nfunction mergeAndedSelectorsNested(obj) {\n    for (var prop in obj) {\n        if (Array.isArray(obj)) {\n            for (var i in obj) {\n                if (obj[i]['$and']) {\n                    obj[i] = mergeAndedSelectors(obj[i]['$and']);\n                }\n            }\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            mergeAndedSelectorsNested(value); // <- recursive call\n        }\n    }\n    return obj;\n}\n\n//#7458: determine id $and is present in selector (at any level)\nfunction isAndInSelector(obj, isAnd) {\n    for (var prop in obj) {\n        if (prop === '$and') {\n            isAnd = true;\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            isAnd = isAndInSelector(value, isAnd); // <- recursive call\n        }\n    }\n    return isAnd;\n}\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n    //#7458: if $and is present in selector (at any level) merge nested $and\n    if (isAndInSelector(result, false)) {\n        result = mergeAndedSelectorsNested(result);\n        if ('$and' in result) {\n            result = mergeAndedSelectors(result['$and']);\n        }\n        wasAnded = true;\n    }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  // is matcher an object, if so continue recursion\n  if (typeof matcher === 'object') {\n    return Object.keys(matcher).every(function (userOperator) {\n      var userValue = matcher[userOperator];\n      return match(userOperator, doc, userValue, parsedField, docFieldValue);\n    });\n  }\n\n  // no more depth, No need to recurse further\n  return matcher === docFieldValue;\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev$$1) {\n  if (!/^\\d+-./.test(rev$$1)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev$$1.indexOf('-');\n  var left = rev$$1.substring(0, idx);\n  var right = rev$$1.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev$$1) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev$$1;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending  no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      immediate(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev$$1 = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev$$1;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev$$1;\n      if (!opts.rev) {\n        rev$$1 = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev$$1 = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev$$1;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev$$1 = pos + '-' + revHash;\n        if (revs.indexOf(rev$$1) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return immediate(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function () {\n    var msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc && doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    options.credentials = 'include';\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  immediate(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).catch(function () {\n      return {};\n    }).then(function (result) {\n      // Bad response or missing `uuid` should not prevent ID generation.\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      var url = path.substring(0, 1) === '/' ?\n        genUrl(host, path.substring(1)) :\n        genDBUrl(host, path);\n      return ourFetch(url, options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if (typeof process !== 'undefined' && !process.browser) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            // TODO: Can we remove this?\n            if (typeof process !== 'undefined' && !process.browser) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev$$1 = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev$$1;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser) {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev$$1,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev$$1;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev$$1, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev$$1;\n      rev$$1 = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev$$1) {\n      url += '?rev=' + rev$$1;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n    \n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        immediate(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      immediate(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      immediate(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              immediate(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev$$1) {\n  return /^1-/.test(rev$$1);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate$$1) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate$$1 ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    immediate(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EventEmitter);\nfunction Replication() {\n  EventEmitter.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EventEmitter);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\n// Pull from src because pouchdb-node/pouchdb-browser themselves\n\nexport default PouchDB;\n","import NeonCore from './NeonCore';\n\nimport { parseManifest } from './utils/NeonManifest';\nimport { prepareEditMode } from './utils/EditControls';\nimport setBody from './utils/template/Template';\nimport * as Types from './Types';\nimport * as Interfaces from './Interfaces';\n\n\n/**\n * NeonView class. Manages the other modules of Neon and communicates with\n * NeonCore.\n */\nclass NeonView {\n  /** The manifest describing what to load and where to find it. */\n  manifest: Types.NeonManifest;\n  /** Module that displays rendered MEI. */\n  view: Interfaces.ViewInterface;\n  /** Name of the document loaded. */\n  name: string;\n  /** Module that handles managing resources, rendering SVGs. */\n  core: NeonCore;\n  /** Module that provides additional information on musical elements. */\n  info: Interfaces.InfoInterface;\n  /** Module that allows editing of musical elements. */\n  NeumeEdit: Interfaces.NeumeEditInterface;\n  /** Module that allows viewing of syllable text. */\n  textView: Interfaces.TextViewInterface;\n  /** Module that allows editing of syllable text. */\n  TextEdit: Interfaces.TextEditInterface;\n\n  params: Interfaces.NeonViewParams;\n\n\n  /**\n   * Constructor for NeonView. Sets mode and passes constructors.\n   */\n  constructor (params: Interfaces.NeonViewParams) {\n    if (!parseManifest(params.manifest)) {\n      console.error('Unable to parse the manifest');\n    }\n\n    this.params = params;\n    this.manifest = params.manifest;\n  }\n\n  /**\n   * Set up Neon for any provided editing modules.\n   */\n  setupEdit(params: Interfaces.NeonViewParams): void {\n    if (params.NeumeEdit !== undefined || (params.TextEdit !== undefined && params.TextView !== undefined)) {\n      // Set up display for edit button\n      prepareEditMode(this);\n    }\n\n    if (params.NeumeEdit !== undefined) {\n      this.NeumeEdit = new params.NeumeEdit(this);\n    }\n    if (params.TextView !== undefined) {\n      this.textView = new params.TextView(this);\n      if (params.TextEdit !== undefined) {\n        this.TextEdit = new params.TextEdit(this);\n      }\n    }\n  }\n\n  /**\n   * Start Neon\n   */\n  start (): void {\n    /* this.core.db.info().then((info) => {\n      if (info.doc_count === 0) {\n        this.core.initDb().then(() => { this.updateForCurrentPage(); });\n      } else {\n        Notification.queueNotification('Existing database found. Revert to start from the beginning.');\n        this.updateForCurrentPage();\n      }\n    }); */\n    setBody().then(() => {\n      this.view = new this.params.View(this, this.params.Display, this.manifest.image);\n      this.name = this.manifest.title;\n\n      this.core = new NeonCore(this.manifest);\n      this.info = new this.params.Info(this);\n\n      window.setTimeout(this.setupEdit.bind(this), 2000, this.params);\n      return this.core.initDb();\n    }).then(() => {\n      this.updateForCurrentPage(true);\n    });\n  }\n\n  /**\n   * Get the current page from the loaded view and then display the\n   * most up to date SVG.\n   */\n  updateForCurrentPage (delay = false): void {\n    const pageNo = this.view.getCurrentPage();\n    this.view.changePage(pageNo, delay);\n  }\n\n  /**\n   * Same as [[updateForCurrentPage]] but returns a promise.\n   */\n  updateForCurrentPagePromise (delay = false): Promise<void> {\n    const pageNo = this.view.getCurrentPage();\n    return Promise.resolve(this.view.changePage(pageNo, delay));\n  }\n\n  /**\n   * Redo an action performed on the current page (if there is one).\n   */\n  redo (): Promise<boolean> {\n    return this.core.redo(this.view.getCurrentPageURI());\n  }\n\n  /**\n   * Undo the last action performed on the current page (if there is one).\n   */\n  undo (): Promise<boolean> {\n    return this.core.undo(this.view.getCurrentPageURI());\n  }\n\n  /**\n   * Get the mode Neon is in.\n   * @returns Value is \"viewer\", \"insert\", or \"edit\".\n   */\n  getUserMode (): string {\n    if (this.NeumeEdit !== undefined) {\n      return this.NeumeEdit.getUserMode();\n    } else if (this.TextEdit !== undefined) {\n      return 'edit';\n    } else {\n      return 'viewer';\n    }\n  }\n\n  /**\n   * Attempt to perform an editor action.\n   * @param action - The editor toolkit action object.\n   * @param pageURI - The URI of the page to perform the action on\n   */\n  edit (action: Types.EditorAction, pageURI: string): Promise<boolean> {\n    return this.core.edit(action, pageURI);\n  }\n\n  /**\n   * Get the attributes for a specific musical element.\n   * @param elementId - The unique ID of the musical element.\n   * @param pageURI - The URI of the page the element is found on.\n   */\n  getElementAttr (elementID: string, pageURI: string): Promise<Types.Attributes> {\n    return this.core.getElementAttr(elementID, pageURI);\n  }\n\n  /**\n   * Updates browser database and creates JSON-LD save file.\n   * @returns The contents of this file.\n   */\n  export (): Promise<string | ArrayBuffer> {\n    return (new Promise((resolve, reject): void => {\n      this.core.updateDatabase().then(() => {\n        this.manifest['mei_annotations'] = this.core.getAnnotations();\n        this.manifest.timestamp = (new Date()).toISOString();\n        const data = new window.Blob([JSON.stringify(this.manifest, null, 2)], { type: 'application/ld+json' });\n        const reader = new FileReader();\n        reader.addEventListener('load', () => {\n          resolve(reader.result);\n        });\n        reader.readAsDataURL(data);\n      }).catch(err => { reject(err); });\n    }));\n  }\n\n  /**\n   * Save the current state to the browser database.\n   */\n  save (): Promise<void> {\n    return this.core.updateDatabase();\n  }\n\n  /**\n   * Deletes the local database of the loaded MEI file(s).\n   */\n  deleteDb (): Promise<void> {\n    return this.core.deleteDb();\n  }\n\n  /**\n   * Get the page's MEI file encoded as a data URI.\n   * @param pageNo - The URI specifying the page.\n   * @returns A [Data URI](https://en.wikipedia.org/wiki/Data_URI_scheme).\n   */\n  getPageURI (pageNo?: string): Promise<string> {\n    if (pageNo === undefined) {\n      pageNo = this.view.getCurrentPageURI();\n    }\n    return new Promise((resolve): void => {\n      this.core.getMEI(pageNo).then((mei) => {\n        resolve('data:application/mei+xml;charset=utf-8,' + encodeURIComponent(mei));\n      });\n    });\n  }\n\n  /**\n   * Get the page's MEI file as a string.\n   * @param pageNo - The identifying URI of the page.\n   */\n  getPageMEI (pageNo: string): Promise<string> {\n    return this.core.getMEI(pageNo);\n  }\n\n  /**\n   * Get the page's SVG.\n   * @param pageNo - The identifying URI of the page.\n   */\n  getPageSVG (pageNo: string): Promise<SVGSVGElement> {\n    return this.core.getSVG(pageNo);\n  }\n}\n\nexport { NeonView as default };\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","import * as DisplayControls from './DisplayControls';\nimport ZoomHandler from '../SingleView/Zoom';\nimport { DisplayInterface, ViewInterface } from '../Interfaces';\n\n/**\n * Return the HTML for the display panel.\n * @param {ZoomHandler} handleZoom - Includes zoom controls if defined.\n * @returns {string}\n */\nfunction displayControlsPanel (handleZoom: ZoomHandler): string {\n  let contents =\n  '<p class=\\'panel-heading\\' id=\\'displayHeader\\'>Display' +\n  '<svg class=\\'icon is-pulled-right\\'><use id=\\'toggleDisplay\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></p>' +\n  '<div id=\\'displayContents\\'>';\n  if (handleZoom !== undefined) {\n    contents +=\n    '<a class=\\'panel-block has-text-centered\\'><button class=\\'button\\' id=\\'reset-zoom\\'>Zoom</button>' +\n    '<input class=\\'slider is-fullwidth\\' id=\\'zoomSlider\\' step=\\'5\\' min=\\'25\\' max=\\'400\\' value=\\'100\\' type=\\'range\\'/>' +\n    '<output id=\\'zoomOutput\\' for=\\'zoomSlider\\'>100</output></a>';\n  }\n  contents +=\n  '<a class=\\'panel-block has-text-centered\\'><button class=\\'button\\' id=\\'reset-opacity\\'>Glyph Opacity</button>' +\n  '<input class=\\'slider is-fullwidth\\' id=\\'opacitySlider\\' step=\\'5\\' min=\\'0\\' max=\\'100\\' value=\\'100\\' type=\\'range\\'/>' +\n  '<output id=\\'opacityOutput\\' for=\\'opacitySlider\\'>100</output></a>' +\n  '<a class=\\'panel-block has-text-centered\\'><button class=\\'button\\' id=\\'reset-bg-opacity\\'>Image Opacity</button>' +\n  '<input class=\\'slider is-fullwidth\\' id=\\'bgOpacitySlider\\' step=\\'5\\' min=\\'0\\' max=\\'100\\' value=\\'100\\' type=\\'range\\'/>' +\n  '<output id=\\'bgOpacityOutput\\' for=\\'bgOpacitySlider\\'>100</output></a>' +\n  '<div class=\\'panel-block\\' id=\\'extensible-block\\'>' +\n  '<div class=\\'dropdown\\' id=\\'highlight-dropdown\\'><div class=\\'dropdown-trigger\\'>' +\n  '<button class=\\'button\\' id=\\'highlight-button\\' aria-haspopup=\\'true\\' aria-controls=\\'highlight-menu\\' style=\\'width: auto\\'>' +\n  '<span>Highlight</span><span id=\\'highlight-type\\'>&nbsp;- Off</span>' +\n  '<svg class=\\'icon\\'><use id=\\'toggleDisplay\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use>' +\n  '</svg></button></div><div class=\\'dropdown-menu\\' id=\\'highlight-menu\\' role=\\'menu\\'>' +\n  '<div class=\\'dropdown-content\\'><a class=\\'dropdown-item\\' id=\\'highlight-staff\\'>Staff</a>' +\n  '<a class=\\'dropdown-item\\' id=\\'highlight-syllable\\'>Syllable</a>' +\n  '<a class=\\'dropdown-item\\' id=\\'highlight-neume\\'>Neume</a><hr class=\\'dropdown-divider\\'/>' +\n  '<a class=\\'dropdown-item\\' id=\\'highlight-none\\'>None</a></div></div></div></div></div>';\n  return contents;\n}\n\n/**\n * A class that sets the content of the display panel to the right and\n * manages controls for viewing.\n */\nclass DisplayPanel implements DisplayInterface {\n  view: ViewInterface;\n  className: string;\n  background: string;\n  zoomHandler: ZoomHandler;\n\n  /**\n   * Constructor for DisplayPanel.\n   * @param {SingleView | DivaView} view - The View parent.\n   * @param {string} className - The class name for the rendered SVG object(s).\n   * @param {string} background - The class name associated with the background.\n   * @param {ZoomHandler} [zoomHandler] - The ZoomHandler object, if SingleView.\n   */\n  constructor (view: ViewInterface, className: string,\n    background: string, zoomHandler: ZoomHandler = undefined) {\n    this.view = view;\n    this.className = className;\n    this.background = background;\n    this.zoomHandler = zoomHandler;\n\n    const displayPanel = document.getElementById('display_controls');\n    displayPanel.innerHTML = displayControlsPanel(this.zoomHandler);\n    this.view.addUpdateCallback(this.updateVisualization.bind(this));\n  }\n\n  /**\n   * Apply event listeners related to the DisplayPanel.\n   */\n  setDisplayListeners (): void {\n    if (this.zoomHandler) {\n      // Zoom handler stuff\n      DisplayControls.setZoomControls(this.zoomHandler);\n    }\n    DisplayControls.initDisplayControls(this.className, this.background);\n  }\n\n  /**\n   * Update SVG based on visualization settings\n   */\n  updateVisualization (): void {\n    DisplayControls.setOpacityFromSlider(this.className);\n    DisplayControls.updateHighlight();\n  }\n}\n\nexport { DisplayPanel as default };\n","import NeonView from './NeonView';\nimport DisplayPanel from './DisplayPanel/DisplayPanel';\nimport { DisplayConstructable, ViewInterface } from './Interfaces';\nimport ZoomHandler from './SingleView/Zoom';\n\ndeclare let Diva: any;\n\n/**\n * View module that uses the diva.js viewer to render the pages of a IIIF manifests\n * and then display the rendered MEI files over the proper pages.\n */\nclass DivaView implements ViewInterface {\n  readonly neonView: NeonView;\n  private updateCallbacks: Array<() => void>;\n  divaReady: boolean;\n  private diva: any;\n  private indexMap: Map<number, string>;\n  private displayPanel: DisplayPanel;\n  private loadDelay: number;\n  zoomHandler: ZoomHandler;\n\n  /**\n   * @param manifest - Link to the IIIF manifest.\n   */\n  constructor (neonView: NeonView, Display: DisplayConstructable, manifest: string) {\n    this.neonView = neonView;\n    this.updateCallbacks = [];\n    this.divaReady = false;\n    this.diva = new Diva('container', {\n      objectData: manifest\n    });\n    document.getElementById('container').style.minHeight = '100%';\n    this.indexMap = new Map();\n    this.diva.disableDragScrollable();\n    this.displayPanel = new Display(this, 'neon-container', 'diva-viewer-canvas');\n    this.loadDelay = 500; // in milliseconds\n    this.initDivaEvents();\n    this.setViewEventHandlers();\n\n    window.onresize = (): void => {\n      const height = window.innerHeight;\n      const width = window.innerWidth;\n\n      window.setTimeout((): void => {\n        if ((height === window.innerHeight) && (width === window.innerWidth)) {\n          this.changePage(this.getCurrentPage(), false);\n        }\n      }, this.loadDelay);\n    };\n  }\n\n  /**\n   * Set the listeners for certain events internal to diva.js\n   */\n  initDivaEvents (): void {\n    Diva.Events.subscribe('ManifestDidLoad', this.parseManifest.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ObjectDidLoad', this.didLoad.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ActivePageDidChange', this.changePage.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ZoomLevelDidChange', this.adjustZoom.bind(this), this.diva.settings.ID);\n  }\n\n  /**\n   * Called when the visible page changes in the diva.js viewer.\n   * @param pageIndex - The zero-indexed page that is most visible.\n   * @param delay - Whether to delay the loading of the page so that neon doesn't lag while scrolling.\n   */\n  async changePage (pageIndex: number, delay = true): Promise<void> {\n    function checkAndLoad (page: number): void {\n      if (page === this.getCurrentPage()) {\n        const pageURI = this.indexMap.get(page);\n        this.neonView.getPageSVG(pageURI).then((svg: SVGSVGElement) => {\n          this.updateSVG(svg, page);\n          const containerId = 'neon-container-' + page;\n          const container = document.getElementById(containerId);\n          if (container !== null) {\n            container.classList.add('active-page');\n          }\n          this.updateCallbacks.forEach((callback: Function) => callback());\n        }).catch((err: { name: string }) => {\n          if (err.name !== 'not_found' && err.name !== 'missing_mei') {\n            console.error(err);\n          }\n        });\n      }\n    }\n\n    const pageIndexes = [pageIndex];\n    Array.from(document.getElementsByClassName('active-page')).forEach(elem => {\n      elem.classList.remove('active-page');\n    });\n    for (const page of pageIndexes) {\n      if (delay) {\n        window.setTimeout(checkAndLoad.bind(this), (this.loadDelay), page);\n      } else {\n        checkAndLoad.bind(this)(page);\n      }\n    }\n  }\n\n  /**\n   * Get the active page in the diva.js viewer.\n   */\n  getCurrentPage (): number {\n    return this.diva.getActivePageIndex();\n  }\n\n  /**\n   * Get the active page URI in the diva.js viewer.\n   */\n  getCurrentPageURI (): string {\n    return this.indexMap.get(this.getCurrentPage());\n  }\n\n  /**\n   * Adjust the rendered SVG(s) to be the correct size after zooming.\n   */\n  adjustZoom (): void {\n    (new Promise((resolve): void => {\n      Array.from(document.getElementsByClassName('neon-container'))\n        .forEach((elem: HTMLElement) => { elem.style.display = 'none'; });\n      setTimeout(resolve, this.diva.settings.zoomDuration + 100);\n    })).then(() => {\n      this.changePage(this.diva.getActivePageIndex(), true);\n      Array.from(document.getElementsByClassName('neon-container'))\n        .forEach((elem: HTMLElement) => {\n          const svg = elem.firstChild as SVGSVGElement;\n          const pageNo = parseInt(elem.id.match(/\\d+/)[0]);\n          this.updateSVG(svg, pageNo);\n          elem.style.display = '';\n        });\n    });\n  }\n\n  /**\n   * Update the SVG being displayed for the specified page.\n   * @param pageNo - The zero-indexed page number.\n   */\n  updateSVG (svg: SVGSVGElement, pageNo: number): void {\n    const inner = document.getElementById('diva-1-inner');\n    const dimensions = this.diva.getPageDimensionsAtCurrentZoomLevel(pageNo);\n    const offset = this.diva.settings.viewHandler._viewerCore.getPageRegion(pageNo, {\n      includePadding: true,\n      incorporateViewport: true\n    });\n    const marginLeft = window.getComputedStyle(inner, null)\n      .getPropertyValue('margin-left');\n\n    const containerId = 'neon-container-' + pageNo.toString();\n    let container = document.getElementById(containerId);\n    if (container === null) {\n      container = document.createElement('div');\n      container.id = containerId;\n      container.classList.add('neon-container');\n      inner.appendChild(container);\n    }\n\n    while (container.firstChild) {\n      container.removeChild(container.firstChild);\n    }\n\n    svg.setAttribute('width', dimensions.width);\n    svg.setAttribute('height', dimensions.height);\n    container.style.position = 'absolute';\n    container.style.top = `${offset.top}px`;\n    container.style.left = `${offset.left - parseInt(marginLeft)}px`;\n\n    container.appendChild(svg);\n  }\n\n  /**\n   * Function called when diva.js finishes loading.\n   */\n  didLoad (): void {\n    this.divaReady = true;\n    this.displayPanel.setDisplayListeners();\n    document.getElementById('loading').style.display = 'none';\n    console.log(this.diva);\n  }\n\n  /**\n   * Add a callback function that will be run whenever an SVG is updated.\n   */\n  addUpdateCallback (cb: () => void): void {\n    this.updateCallbacks.push(cb);\n  }\n\n  /**\n   * Remove a callback function previously added to the list of functions to call.\n   */\n  removeUpdateCallback (cb: () => void): void {\n    const index = this.updateCallbacks.findIndex((elem) => {\n      return elem === cb;\n    });\n    if (index !== -1) {\n      this.updateCallbacks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Set listeners on the body element for global events.\n   */\n  setViewEventHandlers (): void {\n    document.body.addEventListener('keydown', (evt) => {\n      switch (evt.key) {\n        case 'h':\n          for (const container of document.getElementsByClassName('neon-container') as HTMLCollectionOf<HTMLElement>) {\n            container.style.visibility = 'hidden';\n          }\n          break;\n        default: break;\n      }\n    });\n\n    document.body.addEventListener('keyup', (evt) => {\n      switch (evt.key) {\n        case 'h':\n          for (const container of document.getElementsByClassName('neon-container') as HTMLCollectionOf<HTMLElement>) {\n            container.style.visibility = '';\n          }\n          break;\n        default: break;\n      }\n    });\n  }\n\n  /**\n   * Use the IIIF manifest to create a map between IIIF canvases and page indexes.\n   * @param manifest - The IIIF manifest object.\n   */\n  parseManifest (manifest: { sequences: { canvases: object[] }[] }): void {\n    this.indexMap.clear();\n    for (const sequence of manifest.sequences) {\n      for (const canvas of sequence.canvases) {\n        this.indexMap.set(sequence.canvases.indexOf(canvas), canvas['@id']);\n      }\n    }\n  }\n\n  /**\n   * Get the name of the active page/canvas combined with the manuscript name.\n   */\n  getPageName (): string {\n    const manuscriptName = this.diva.settings.manifest.itemTitle;\n    const pageName = this.diva.settings.manifest.pages[this.getCurrentPage()].l;\n    return manuscriptName + ' \\u2014 ' + pageName;\n  }\n}\n\nexport { DivaView as default };\n","import { updateHighlight, setOpacityFromSlider } from '../DisplayPanel/DisplayControls';\nimport * as Cursor from '../utils/Cursor';\nimport NeonView from '../NeonView';\nimport DisplayPanel from '../DisplayPanel/DisplayPanel';\nimport ZoomHandler from './Zoom';\nimport { ViewInterface, DisplayConstructable } from '../Interfaces';\n\nimport * as d3 from 'd3';\n\n/**\n * A view module for displaying a single page of a manuscript.\n */\nclass SingleView implements ViewInterface {\n  readonly neonView: NeonView;\n  private container: HTMLElement;\n  private updateCallbacks: Array<() => void>;\n  private group: SVGSVGElement;\n  private bg: SVGImageElement;\n  private mei: SVGSVGElement;\n  zoomHandler: ZoomHandler;\n  private displayPanel: DisplayPanel;\n  readonly pageURI: string;\n  /**\n   * Constructor for SingleView.\n   * @param image - The URI to the background image for the page.\n   */\n  constructor (neonView: NeonView, panel: DisplayConstructable, image: string) {\n    this.neonView = neonView;\n    this.container = document.getElementById('container');\n    this.updateCallbacks = new Array(0);\n    // Group will contain the image and the rendered SVG\n    this.group = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    this.group.id = 'svg_group';\n    this.group.setAttribute('height', window.innerHeight.toString());\n    this.group.setAttribute('width', '100%');\n\n    this.bg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\n    this.bg.id = 'bgimg';\n    this.bg.classList.add('background');\n    this.bg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', image);\n    this.bg.setAttribute('x', '0');\n    this.bg.setAttribute('y', '0');\n\n    this.mei = document.createElementNS('http://www.w3.org/svg', 'svg') as SVGSVGElement;\n    this.mei.id = 'mei_output';\n    this.mei.classList.add('neon-container', 'active-page');\n\n    this.group.appendChild(this.bg);\n    this.group.appendChild(this.mei);\n    this.container.appendChild(this.group);\n\n    this.zoomHandler = new ZoomHandler();\n    this.displayPanel = new panel(this, 'neon-container', 'background', this.zoomHandler);\n\n    this.setViewEventHandlers();\n    this.displayPanel.setDisplayListeners();\n\n    this.pageURI = image;\n\n    document.getElementById('loading').style.display = 'none';\n  }\n\n  /**\n   * Update the SVG being displayed.\n   */\n  updateSVG (svg: SVGSVGElement): void {\n    this.group.replaceChild(svg, this.mei);\n    this.mei = svg;\n    this.mei.id = 'mei_output';\n    this.mei.classList.add('neon-container', 'active-page');\n    const height = parseInt(this.mei.getAttribute('height'));\n    const width = parseInt(this.mei.getAttribute('width'));\n\n    this.bg.setAttribute('height', height.toString());\n    this.bg.setAttribute('width', width.toString());\n    this.group.setAttribute('viewBox', '0 0 ' + width + ' ' + height);\n    updateHighlight();\n    this.resetTransformations();\n    this.updateCallbacks.forEach(callback => callback());\n  }\n\n  /**\n   * Change to a certain page\n   * Since there is only one page, this is essentially a wrapper for updateSVG\n   */\n  async changePage (_page: number, _delay: boolean): Promise<void> {\n    const svg = await this.neonView.getPageSVG(this.getCurrentPageURI());\n    this.updateSVG(svg);\n  }\n\n  /**\n   * Add a callback to the list of those be called when the page updates.\n   */\n  addUpdateCallback (cb: () => void): void {\n    this.updateCallbacks.push(cb);\n  }\n\n  /**\n   * Remove a callback from the list of callbacks if it is part of the list.\n   */\n  removeUpdateCallback (cb: () => void): void {\n    const index = this.updateCallbacks.findIndex((elem) => {\n      return elem === cb;\n    });\n    if (index !== -1) {\n      this.updateCallbacks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Reset the transformations that have been applied to the SVG upon update.\n   */\n  resetTransformations (): void {\n    this.displayPanel.zoomHandler.restoreTransformation();\n    setOpacityFromSlider();\n  }\n\n  /**\n   * Returns the zero-indexed number of the current page. This will always be zero.\n   */\n  getCurrentPage (): number {\n    return 0;\n  }\n\n  /**\n   * Returns the page URI.\n   */\n  getCurrentPageURI (): string {\n    return this.pageURI;\n  }\n\n  /**\n   * Set event handlers for the view and display panel.\n   */\n  setViewEventHandlers (): void {\n    document.body.addEventListener('keydown', (evt) => {\n      switch (evt.key) {\n        case 'Shift':\n          d3.select('#svg_group').on('.drag', null);\n          d3.select('#svg_group').call(\n            d3.drag().on('start', this.displayPanel.zoomHandler.startDrag.bind(this.displayPanel.zoomHandler))\n              .on('drag', this.displayPanel.zoomHandler.dragging.bind(this.displayPanel.zoomHandler))\n          );\n          Cursor.updateCursorTo('grab');\n          break;\n        case 'h':\n          document.getElementById('mei_output').setAttribute('visibility', 'hidden');\n          break;\n        default: break;\n      }\n    });\n    document.body.addEventListener('keyup', (evt) => {\n      switch (evt.key) {\n        case 'Shift':\n          d3.select('#svg_group').on('.drag', null);\n          Cursor.updateCursorTo('');\n          if (this.neonView.getUserMode() !== 'viewer') {\n            this.neonView.NeumeEdit.setSelectListeners();\n          }\n          if (this.neonView.getUserMode() === 'insert') {\n            Cursor.updateCursor();\n          }\n          break;\n        case 'h':\n          document.getElementById('mei_output').setAttribute('visibility', 'visible');\n          break;\n        default: break;\n      }\n    });\n\n    d3.select('#container').on('touchstart', () => {\n      if (d3.event.touches.length === 2) {\n        this.displayPanel.zoomHandler.startDrag();\n        d3.select('#container').on('touchmove', this.displayPanel.zoomHandler.dragging.bind(this.displayPanel.zoomHandler));\n        d3.select('#container').on('touchend', () => {\n          d3.select('#container').on('touchmove', null);\n        });\n      }\n    });\n    d3.select('#container').on('wheel', this.displayPanel.zoomHandler.scrollZoom.bind(this.displayPanel.zoomHandler), false);\n    // Update height of container based on window\n    window.onresize = (): void => {\n      const newHeight = window.innerHeight;\n      const container = document.getElementById('container');\n      if (newHeight > Number(container.getAttribute('height'))) {\n        container.setAttribute('height', newHeight.toString());\n      }\n    };\n  }\n\n  /**\n   * A human readable name for the page. Used for downloads.\n   */\n  getPageName (): string {\n    return this.neonView.name;\n  }\n}\n\nexport { SingleView as default };\n","import { bindInsertTabs, initInsertEditControls, initEditModeControls, initSelectionButtons } from './Controls';\nimport * as Select from '../utils/Select';\nimport InsertHandler from './InsertHandler';\nimport NeonView from '../NeonView';\nimport * as SelectOptions from './SelectOptions';\nimport { setHighlightSelectionControls } from '../DisplayPanel/DisplayControls';\nimport DragHandler from '../utils/DragHandler';\nimport { NeumeEditInterface } from '../Interfaces';\n\nclass DivaEdit implements NeumeEditInterface {\n  neonView: NeonView;\n  dragHandler: DragHandler;\n  insertHandler: InsertHandler;\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    initEditModeControls(this);\n  }\n\n  initEditMode (): void {\n    this.dragHandler = new DragHandler(this.neonView, '.active-page > svg');\n    this.insertHandler = new InsertHandler(this.neonView, '.active-page > svg');\n    bindInsertTabs(this.insertHandler);\n    document.getElementById('primitiveTab').click();\n    Select.setSelectHelperObjects(this.neonView, this.dragHandler);\n    this.setSelectListeners();\n\n    SelectOptions.initNeonView(this.neonView);\n    initInsertEditControls();\n    const editMenu = document.getElementById('editMenu');\n    editMenu.style.backgroundColor = '#ffc7c7';\n    editMenu.style.fontWeight = 'bold';\n\n    Select.setSelectStrokeWidth(1);\n\n    initSelectionButtons();\n\n    setHighlightSelectionControls();\n\n    this.neonView.view.addUpdateCallback(this.setSelectListeners.bind(this));\n  }\n\n  /**\n   * Get the user mode that Neon is in. Either insert, edit, or viewer.\n   * @returns {string}\n   */\n  getUserMode (): string {\n    if (this.insertHandler !== undefined) {\n      if (this.insertHandler.isInsertMode()) {\n        return 'insert';\n      }\n      return 'edit';\n    }\n    return 'viewer';\n  }\n\n  setSelectListeners (): void {\n    Select.clickSelect('.active-page > svg > svg, .active-page > svg > svg use, .active-page > svg > svg rect');\n    Select.dragSelect('.active-page svg');\n  }\n}\n\nexport { DivaEdit as default };\n","import { bindInsertTabs, initInsertEditControls, initEditModeControls, initSelectionButtons } from './Controls';\nimport { setHighlightSelectionControls } from '../DisplayPanel/DisplayControls';\nimport * as Select from '../utils/Select';\nimport InsertHandler from './InsertHandler';\nimport NeonView from '../NeonView';\nimport * as SelectOptions from './SelectOptions';\nimport DragHandler from '../utils/DragHandler';\nimport { NeumeEditInterface } from '../Interfaces';\n\n/**\n * An Edit Module for a single page of a manuscript.\n * Works with the SingleView module.\n */\nclass SingleEditMode implements NeumeEditInterface {\n  neonView: NeonView;\n  dragHandler: DragHandler;\n  insertHandler: InsertHandler;\n  /**\n   * Constructor for an EditMode object.\n   * @param {NeonView} neonView - The NeonView parent.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    initEditModeControls(this);\n  }\n\n  /**\n   * Initialize the start of edit mode when first leaving viewer mode.\n   */\n  initEditMode (): void {\n    this.dragHandler = new DragHandler(this.neonView, '#svg_group');\n    this.insertHandler = new InsertHandler(this.neonView, '#svg_group');\n    bindInsertTabs(this.insertHandler);\n    document.getElementById('primitiveTab').click();\n    Select.setSelectHelperObjects(this.neonView, this.dragHandler);\n    this.setSelectListeners();\n\n    SelectOptions.initNeonView(this.neonView);\n    initInsertEditControls();\n    const editMenu = document.getElementById('editMenu');\n    editMenu.style.backgroundColor = '#ffc7c7';\n    editMenu.style.fontWeight = 'bold';\n\n    initSelectionButtons();\n\n    setHighlightSelectionControls();\n\n    this.neonView.view.addUpdateCallback(this.setSelectListeners.bind(this));\n  }\n\n  /**\n   * Get the user mode that Neon is in. Either insert, edit, or viewer.\n   * @returns {string}\n   */\n  getUserMode (): string {\n    if (this.insertHandler !== undefined) {\n      if (this.insertHandler.isInsertMode()) {\n        return 'insert';\n      }\n      return 'edit';\n    }\n    return 'viewer';\n  }\n\n  setSelectListeners (): void {\n    Select.clickSelect('#mei_output, #mei_output use, #mei_output rect');\n    Select.dragSelect('#svg_group');\n  }\n}\n\nexport { SingleEditMode as default };\n","/** @module InfoModule */\n\nimport NeonView from './NeonView';\nimport { InfoInterface } from './Interfaces';\nimport { Attributes } from './Types';\n\n/**\n * Map of contours to neume names.\n */\nconst neumeGroups = new Map(\n  [['', 'Punctum'], ['u', 'Pes'], ['d', 'Clivis'], ['uu', 'Scandicus'], ['ud', 'Torculus'], ['du', 'Porrectus'], ['s', 'Distropha'], ['ss', 'Tristopha'],\n    ['sd', 'Pressus'], ['dd', 'Climacus'], ['ddu', 'Climacus resupinus'], ['udu', 'Torculus resupinus'], ['dud', 'Porrectus flexus'],\n    ['udd', 'Pes subpunctis'], ['uud', 'Scandicus flexus'], ['uudd', 'Scandicus subpunctis'], ['dudd', 'Porrectus subpunctis']]\n);\n\nfunction startInfoVisibility (): void {\n  document.getElementById('neume_info').innerHTML =\n    '<article class=\\'message\\'><div class=\\'message-header\\'><p></p></div>' +\n      '<div class=\\'message-body\\'></div>';\n  document.getElementById('neume_info').setAttribute('style', 'display: none');\n}\n\n/**\n * Update the visibility of infoBox\n */\nfunction updateInfoVisibility (): void {\n  const neumeInfo = document.getElementById('neume_info');\n  if ((document.getElementById('displayInfo') as HTMLInputElement).checked) {\n    neumeInfo.setAttribute('style', '');\n  } else {\n    neumeInfo.setAttribute('style', 'display: none');\n  }\n}\n\n/**\n * Set listener on info visibility checkbox.\n */\nfunction setInfoControls (): void {\n  startInfoVisibility();\n  updateInfoVisibility();\n  document.getElementById('displayInfo').addEventListener('click', updateInfoVisibility);\n}\n\n/**\n * Class that manages getting information for elements in Neon from Verovio.\n */\nclass InfoModule implements InfoInterface {\n  private neonView: NeonView;\n\n  /**\n   * A constructor for an InfoModule.\n   * @param {NeonView} neonView - The NeonView parent.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    // Add info box enable/disable check box\n    const block = document.getElementById('extensible-block');\n    const label = document.createElement('label');\n    label.classList.add('checkbox');\n    label.textContent = 'Display Info: ';\n    const input = document.createElement('input');\n    input.classList.add('checkbox');\n    input.id = 'displayInfo';\n    input.type = 'checkbox';\n    input.checked = false;\n    label.appendChild(input);\n    block.prepend(label);\n\n    this.neonView.view.addUpdateCallback(this.resetInfoListeners.bind(this));\n    setInfoControls();\n    this.resetInfoListeners();\n  }\n\n  /**\n   * Set listeners for the InfoModule.\n   */\n  infoListeners (): void {\n    try {\n      document.getElementsByClassName('active-page')[0]\n        .querySelectorAll('.neume,.custos,.clef')\n        .forEach(node => {\n          node.addEventListener('mouseover', this.updateInfo.bind(this));\n        });\n    } catch (e) {}\n  }\n\n  /**\n   * Stop listeners for the InfoModule.\n   */\n  stopListeners (): void {\n    document.querySelectorAll('.neume,.custos,.clef').forEach(node => {\n      node.removeEventListener('mouseover', this.updateInfo.bind(this));\n    });\n  }\n\n  /**\n   * Restart listeners for the InfoModule.\n   */\n  resetInfoListeners (): void {\n    this.stopListeners();\n    this.infoListeners();\n  }\n\n  /**\n   * Get updated info for the calling element based on its element type.\n   * Makes calls to NeonCore to get the information necessary.\n   */\n  async updateInfo (event: MouseEvent): Promise<void> {\n  // For now, since Clefs do not have their own element tag in mei4, there is not a way to select the <g> element\n  // So we will simply return if ID does not exist for now\n    const id = (event.currentTarget as HTMLElement).id;\n    if (id === '') {\n      Array.from(document.getElementById('neume_info').children).forEach(child => {\n        child.remove();\n      });\n      console.log('No id!');\n      return;\n    }\n\n    const element = document.getElementById(id);\n    const classRe = /neume|nc|clef|custos|staff/;\n    const elementClass = element.getAttribute('class').match(classRe)[0];\n    let body = '';\n    let attributes: Attributes;\n\n    // Gets the pitches depending on element type and\n    switch (elementClass) {\n      case 'neume':\n        // Select neume components of selected neume\n        const ncs = element.querySelectorAll('.nc') as NodeListOf<SVGGraphicsElement>;\n        let contour = await this.getContour(ncs);\n        if (contour === 'Clivis') {\n          const attr: Attributes = await this.neonView.getElementAttr(ncs[0].id, this.neonView.view.getCurrentPageURI());\n          if (attr.ligated) {\n            contour = 'Ligature';\n          }\n        }\n        let pitches = await this.getPitches(ncs);\n\n        pitches = pitches.trim().toUpperCase();\n        body = 'Shape: ' + (contour === undefined ? 'Compound' : contour) + '\\r\\n' +\n                'Pitch(es): ' + pitches;\n        break;\n      case 'custos':\n        attributes = await this.neonView.getElementAttr(id, this.neonView.view.getCurrentPageURI());\n        body += 'Pitch: ' + (attributes['pname']).toUpperCase() + attributes['oct'];\n        break;\n      case 'clef':\n        attributes = await this.neonView.getElementAttr(id, this.neonView.view.getCurrentPageURI());\n        body += 'Shape: ' + attributes['shape'] + '\\r\\n' +\n                'Line: ' + attributes['line'];\n        break;\n      default:\n        body += 'nothing';\n        break;\n    }\n    this.updateInfoModule(elementClass, body);\n  }\n\n  /**\n   * Get the individual pitches of a neume.\n   * @param ncs - Neume components in the neume.\n   * @returns Space separated pitches of the neume components in order.\n   */\n  async getPitches (ncs: Iterable<SVGGraphicsElement>): Promise<string> {\n    let pitches = '';\n    for (const nc of ncs) {\n      const attributes: Attributes = await this.neonView.getElementAttr(nc.id, this.neonView.view.getCurrentPageURI());\n      pitches += attributes['pname'] + attributes['oct'] + ' ';\n    }\n    return pitches;\n  }\n\n  /**\n   * Get the contour of a neume.\n   * @param ncs - Neume components in the neume.\n   */\n  async getContour (ncs: Iterable<SVGGraphicsElement>): Promise<string> {\n    let contour = '';\n    let previous: Attributes = null;\n    for (const nc of ncs) {\n      const attributes: Attributes = await this.neonView.getElementAttr(nc.id, this.neonView.view.getCurrentPageURI());\n      if (previous !== null) {\n        if (previous['oct'] > attributes['oct']) {\n          contour += 'd';\n        } else if (previous['oct'] < attributes['oct']) {\n          contour += 'u';\n        } else {\n          if (this.pitchNameToNum(previous['pname']) < this.pitchNameToNum(attributes['pname'])) {\n            contour += 'u';\n          } else if (this.pitchNameToNum(previous['pname']) > this.pitchNameToNum(attributes['pname'])) {\n            contour += 'd';\n          } else {\n            contour += 's';\n          }\n        }\n      }\n      previous = attributes;\n    }\n    if (neumeGroups.get(contour) === undefined) {\n      console.warn('Unknown contour: ' + contour);\n    }\n    return neumeGroups.get(contour);\n  }\n\n  /**\n   * Show and update the info box.\n   * @param title - The info box title.\n   * @param body - The info box contents.\n   */\n  updateInfoModule (title: string, body: string): void {\n    document.getElementsByClassName('message-header')[0].querySelector('p')\n      .textContent = title;\n    (document.getElementsByClassName('message-body')[0] as HTMLElement).innerText = body;\n\n    if ((document.getElementById('displayInfo') as HTMLInputElement).checked) {\n      (document.getElementsByClassName('message')[0] as HTMLElement).style.display = '';\n    }\n  }\n\n  /**\n   * Convert a pitch name (a-g) to a number (where c is 1, d is 2, ...and b is 7).\n   * @param pname - The pitch name.\n   * @returns\n   */\n  pitchNameToNum (pname: string): number {\n    switch (pname) {\n      case 'c':\n        return 1;\n      case 'd':\n        return 2;\n      case 'e':\n        return 3;\n      case 'f':\n        return 4;\n      case 'g':\n        return 5;\n      case 'a':\n        return 6;\n      case 'b':\n        return 7;\n      default:\n        console.log('Unknown pitch name');\n    }\n  }\n\n  /**\n   * Find the contour of an neume grouping based on the grouping name.\n   * @param value - The contour name.\n   */\n  getContourByValue (value: string): string {\n    for (const [cont, v] of neumeGroups.entries()) {\n      if (v === value) {\n        return cont;\n      }\n    }\n  }\n}\n\nexport { InfoModule as default };\n","import * as Notification from './utils/Notification';\nimport NeonView from './NeonView';\nimport { unselect } from './utils/SelectTools';\nimport { updateHighlight } from './DisplayPanel/DisplayControls';\nimport { TextViewInterface } from './Interfaces';\n\n/*\n * Class that manages getting the text for syllables in Neon from the mei file\n */\nclass TextView implements TextViewInterface {\n  private neonView: NeonView;\n  /** Whether or not the user has been notified about blank syllables. */\n  private notificationSent: boolean;\n  /**\n   * A constructor for a TextView.\n   * @param neonView - The calling [[NeonView]] for the instance.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    this.notificationSent = false;\n\n    // add checkbox to enable/disable the view\n    const block = document.getElementById('extensible-block');\n    const textLabel = document.createElement('label');\n    const bboxLabel = document.createElement('label');\n    const textButton = document.createElement('input');\n    const bboxButton = document.createElement('input');\n    textLabel.classList.add('checkbox');\n    bboxLabel.classList.add('checkbox');\n    textLabel.textContent = 'Display Text: ';\n    bboxLabel.textContent = 'Display Text BBoxes: ';\n    textButton.classList.add('checkbox');\n    bboxButton.classList.add('checkbox');\n    textButton.id = 'displayText';\n    textButton.type = 'checkbox';\n    bboxButton.id = 'displayBBox';\n    bboxButton.type = 'checkbox';\n    textButton.checked = false;\n    bboxButton.checked = false;\n    textLabel.appendChild(textButton);\n    bboxLabel.appendChild(bboxButton);\n    block.prepend(bboxLabel);\n    block.prepend(textLabel);\n\n    this.setTextViewControls();\n    this.neonView.view.addUpdateCallback(this.updateTextViewVisibility.bind(this));\n    this.neonView.view.addUpdateCallback(this.updateBBoxViewVisibility.bind(this));\n  }\n\n  /**\n  * Set listeners on textview visibility checkbox\n  */\n  setTextViewControls (): void {\n    function textViewVis (): void { this.updateTextViewVisibility(); }\n    function bboxViewVis (): void { this.updateBBoxViewVisibility(); }\n\n    this.updateTextViewVisibility();\n    this.updateBBoxViewVisibility();\n    document.getElementById('displayText')\n      .addEventListener('click', textViewVis.bind(this));\n    document.getElementById('displayBBox')\n      .addEventListener('click', bboxViewVis.bind(this));\n  }\n\n  /**\n   * Update visibility of text bounding boxes\n   */\n  updateBBoxViewVisibility (): void {\n    if ((document.getElementById('displayBBox')as HTMLInputElement).checked) {\n      document.querySelectorAll('.sylTextRect').forEach(rect => {\n        rect.classList.add('sylTextRect-display');\n        rect.classList.remove('sylTextRect');\n      });\n      document.querySelectorAll('.syl.selected .sylTextRect-display')\n        .forEach((rect: HTMLElement) => { rect.style.fill = 'red'; });\n\n      if (this.neonView.getUserMode() !== 'viewer' && this.neonView.TextEdit !== undefined) {\n        this.neonView.TextEdit.initSelectByBBoxButton();\n      }\n    } else {\n      if ((document.getElementById('selByBBox') !== null) &&\n        document.getElementById('selByBBox').classList.contains('is-active')) {\n        unselect();\n        document.getElementById('selByBBox').classList.remove('is-active');\n        document.getElementById('selBySyl').classList.add('is-active');\n      }\n      document.querySelectorAll('.sylTextRect-display').forEach(rect => {\n        rect.classList.add('sylTextRect');\n        rect.classList.remove('sylTextRect-display');\n      });\n      document.querySelectorAll('.syl.selected .sylTextRect').forEach((rect: HTMLElement) => {\n        rect.style.fill = 'none';\n      });\n      try {\n        document.getElementById('selByBBox').style.display = 'none';\n      } catch (e) {}\n    }\n    updateHighlight();\n  }\n\n  /**\n  * Update the visibility of the textview box\n  * and add the event listeners to make sure the syl highlights when moused over\n  */\n  updateTextViewVisibility (): void {\n    if ((document.getElementById('displayText') as HTMLInputElement).checked) {\n      const sylText = document.getElementById('syl_text');\n      sylText.style.display = '';\n      sylText.innerHTML = '<p>' + this.getSylText() + '</p>';\n      const spans = sylText.querySelectorAll('p > span');\n      spans.forEach(span => {\n        const syllable = document.getElementById(span.className);\n        const syl = syllable.querySelector('.syl');\n        const text = syl.querySelector('text');\n        const rect = syl.querySelector('rect');\n        if (text.classList.length === 0) {\n          text.classList.add('text');\n        }\n\n        span.addEventListener('mouseover', () => {\n          syllable.classList.add('selected');\n          syllable.querySelectorAll('.neume').forEach(neume => {\n            neume.classList.add('selected');\n          });\n          if (rect !== null) {\n            rect.style.fill = '#d00';\n          }\n          // syl.attr('fill', '#ffc7c7');\n          // this.highlightBoundingBox(span);\n        });\n\n        span.addEventListener('mouseleave', () => {\n          syllable.classList.remove('selected');\n          syllable.querySelectorAll('.neume').forEach(neume => {\n            neume.classList.remove('selected');\n          });\n          if (rect !== null) {\n            if (syllable.style.fill !== 'rgb(0, 0, 0)') { // syllable.getAttributeNS('http://www.w3.org/2000/SVG', 'fill');\n              rect.style.fill = syllable.getAttribute('fill');\n            } else {\n              rect.style.fill = 'blue';\n            }\n          }\n          // syl.attr('fill', null);\n          // this.removeBoundingBox(span);\n        });\n      });\n      if (this.neonView.getUserMode() !== 'viewer' && this.neonView.TextEdit !== undefined) {\n        this.neonView.TextEdit.initTextEdit();\n      }\n    } else {\n      document.getElementById('syl_text').style.display = 'none';\n    }\n  }\n\n  /**\n   * Get the syllable text of the loaded file\n   */\n  getSylText (): string {\n    let lyrics = '';\n    const uniToDash = /\\ue551/g;\n    const syllables = document.querySelectorAll('.active-page .syllable');\n    syllables.forEach(syllable => {\n      if (syllable.querySelector('.syl') !== null) {\n        const syl = syllable.querySelector('.syl');\n        lyrics += '<span class=\\'' + syllable.id + '\\'>';\n        if (syl.textContent.trim() === '') {\n          lyrics += '&#x25CA; ';\n        } else {\n          Array.from(syl.children[0].children[0].children).forEach(text => {\n            lyrics += text.textContent !== '' ? text.textContent : '&#x25CA; ';\n          });\n        }\n        lyrics += ' </span>';\n      }\n    });\n    if (!this.notificationSent) {\n      Notification.queueNotification('Blank syllables are represented by &#x25CA;!');\n      this.notificationSent = true;\n    }\n    return lyrics.replace(uniToDash, '-');\n  }\n}\n\nexport { TextView as default };\n","import { unselect } from './utils/SelectTools';\nimport DragHandler from './utils/DragHandler';\nimport NeonView from './NeonView';\nimport { setSelectHelperObjects, dragSelect, clickSelect } from './utils/Select';\nimport { setGroupingHighlight } from './utils/Color';\nimport { TextEditInterface } from './Interfaces';\n\n/**\n * Format a string for prompting the user.\n * @param rawString - The unformatted string.\n */\nfunction formatRaw (rawString: string): string {\n  const removeSymbol = /\\u{25CA}/u;\n  return rawString.replace(removeSymbol, '').trim();\n}\n\nfunction selBySylListener (): void {\n  if (!document.getElementById('selByBBox').classList.contains('is-active')) {\n    unselect();\n    try {\n      document.getElementById('moreEdit').innerHTML = '';\n    } catch (e) {}\n    document.getElementById('selByBBox').classList.add('is-active');\n    try {\n      document.getElementById('selByNc').classList.remove('is-active');\n      document.getElementById('selByNeume').classList.remove('is-active');\n      document.getElementById('selByStaff').classList.remove('is-active');\n      document.getElementById('selBySyl').classList.remove('is-active');\n    } catch (e) {}\n    try {\n      if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n        setGroupingHighlight('syllable');\n      }\n    } catch (e) {}\n  }\n  this.addBBoxListeners();\n}\n\n/**\n * A Text editing module that works with the SingleView and DivaView modules\n */\nexport default class TextEditMode implements TextEditInterface {\n  private dragHandler: DragHandler;\n  private neonView: NeonView;\n\n  /**\n   * Constructor for a TextEdit\n   * @param neonView - The calling [[NeonView]] for the instance.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    this.initEditModeControls();\n  }\n\n  /**\n   * Set listener on edit mode button to start editing.\n   */\n  initEditModeControls (): void {\n    document.getElementById('edit_mode').addEventListener('click', () => {\n      this.initTextEdit();\n      if ((document.getElementById('displayBBox') as HTMLInputElement).checked) {\n        this.initSelectByBBoxButton();\n      }\n    });\n  }\n\n  /**\n  * Set text to edit mode\n  */\n  initTextEdit (): void {\n    const spans = document.getElementById('syl_text').querySelectorAll('p > span');\n    spans.forEach(span => {\n      function updateSylText (): void {\n        this.updateSylText(span);\n      }\n\n      span.removeEventListener('click', updateSylText.bind(this));\n      span.addEventListener('click', updateSylText.bind(this));\n    });\n  }\n\n  /**\n  * Add the selectByBBox button.\n  * If neume edit mode is there, add it to the bar with the other select by buttons.\n  * Otherwise add an invisible button\n  * since the only edit mode is selectByRect in that case\n  */\n  initSelectByBBoxButton (): void {\n    if (this.neonView.NeumeEdit !== undefined) {\n      const selByBBox = document.getElementById('selByBBox');\n      if (selByBBox) {\n        selByBBox.style.display = '';\n        return;\n      }\n\n      const block = document.getElementById('selBySyl')\n        .closest('.control')\n        .closest('.field');\n      const p = document.createElement('p');\n      p.classList.add('control');\n      const button = document.createElement('button');\n      button.classList.add('button', 'sel-by');\n      button.id = 'selByBBox';\n      button.textContent = 'BBox';\n      p.appendChild(button);\n      block.appendChild(p);\n      button.addEventListener('click', selBySylListener.bind(this));\n      document.body.addEventListener('keydown', (evt) => {\n        if (evt.key === '5') {\n          if (document.getElementById('selByBBox').style.display === '') {\n            selBySylListener.bind(this)();\n          }\n        }\n      });\n      this.neonView.view.addUpdateCallback(this.addBBoxListeners.bind(this));\n    } else {\n      const block = document.getElementById('undo').closest('.control');\n      const p = document.createElement('p');\n      p.classList.add('control');\n      const button = document.createElement('button');\n      button.classList.add('button', 'sel-by');\n      button.id = 'selByBBox';\n      button.textContent = 'BBox';\n      p.appendChild(button);\n      block.appendChild(p);\n      button.classList.add('is-active');\n      button.style.display = 'none';\n      this.addBBoxListeners();\n      this.neonView.view.addUpdateCallback(this.addBBoxListeners.bind(this));\n    }\n  }\n\n  /**\n   * Initialize select by bbox mode\n   */\n  addBBoxListeners (): void {\n    if (document.getElementById('selByBBox').classList.contains('is-active')) {\n      unselect();\n      if (this.neonView.NeumeEdit === undefined) {\n        // just in case\n        this.dragHandler = new DragHandler(this.neonView, '.sylTextRect-display');\n        setSelectHelperObjects(this.neonView, this.dragHandler);\n        if (this.neonView.view.constructor.name === 'SingleView') {\n          clickSelect('#mei_output, #mei_output rect');\n          dragSelect('#svg_group');\n        } else {\n          clickSelect('.active-page > svg > svg, .active-page > svg > svg rect');\n          dragSelect('.active-page svg');\n        }\n      }\n    }\n  }\n\n  /**\n  * Update the text for a single syl element\n  */\n  updateSylText (span: HTMLSpanElement): void {\n    const orig = formatRaw(span.textContent);\n    const corrected = window.prompt('', orig);\n    if (corrected !== null && corrected !== orig) {\n      const editorAction = {\n        'action': 'setText',\n        'param': {\n          'elementId': [...span.classList.entries()].filter(e => e[1] !== 'text-select')[0][1],\n          'text': corrected\n        }\n      };\n      this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then((response) => {\n        if (response) {\n          this.neonView.updateForCurrentPage();\n        }\n      });\n    }\n  }\n}\n","import * as et from 'elementtree';\nimport { uuidv4 } from './random';\n\net.register_namespace('xml', 'http://www.w3.org/XML/1998/namespace');\net.register_namespace('', 'http://www.music-encoding.org/ns/mei');\n\nexport function convertStaffToSb (staffBasedMei: string): string {\n  const meiTree = et.parse(staffBasedMei);\n  const meiTag = meiTree.getroot();\n  for (const section of meiTag.findall('.//section')) {\n    const newStaff = et.Element('staff', { 'n': '1' });\n    const container: any = et.SubElement(newStaff, 'layer');\n\n    container.set('n', '1');\n\n    for (const staff of section.getchildren()) {\n      for (const layer of staff.getchildren()) {\n        // Replace every staff + layer with a sb with the same facsimile info\n        const sb = et.Element('sb', {\n          'n': staff.get('n'),\n          'facs': staff.get('facs'),\n          'xml:id': staff.get('xml:id')\n        });\n\n        // Check for custos\n        if (container.len() > 1) {\n          if (container.getItem(container.len() - 1).tag === 'custos') {\n            sb.append(container.getItem(container.len() - 1));\n            container.remove(container.getItem(container.len() - 1));\n          }\n        }\n\n        // Check if first syllable has @follows\n        let firstSyllable = layer.find('syllable');\n        let syllableId = '';\n        if (firstSyllable) {\n          if (firstSyllable.get('follows')) {\n            syllableId = firstSyllable.get('follows');\n            for (const syl of firstSyllable.findall('syl')) {\n              firstSyllable.remove(syl);\n            }\n            layer.remove(firstSyllable);\n          } else {\n            firstSyllable = undefined;\n          }\n        }\n\n        if (!firstSyllable) {\n          container.append(sb);\n        } else {\n          const syllable: any = container.find(\n            './/*[@xml:id=\\'' + syllableId + '\\']'\n          );\n          syllable.append(sb);\n          syllable._children = syllable._children.concat(firstSyllable.getchildren());\n        }\n        container._children = container._children.concat(layer.getchildren());\n      }\n    }\n    const sectionId = section.get('xml:id');\n    section.clear();\n    section.set('xml:id', sectionId);\n    section.append(newStaff);\n  }\n\n  return meiTree.write({ 'xml_declaration': true, indent: 4 });\n}\n\nexport function convertSbToStaff (sbBasedMei: string): string {\n  const meiTree = et.parse(sbBasedMei);\n  const meiTag = meiTree.getroot();\n\n  for (const section of meiTag.findall('.//section') as any) {\n    const staffStore = [];\n    for (const staff of section.getchildren()) {\n      for (const layer of staff.getchildren()) {\n        const sbIndexes = [];\n        for (const sb of layer.findall('sb')) {\n          sbIndexes.push(layer.getchildren().indexOf(sb));\n        }\n\n        for (const [sbIndex, n] of zip(sbIndexes, [...Array(sbIndexes.length).keys()])) {\n          const sb = layer.getItem(sbIndex);\n          const newStaff = et.Element('staff', sb.attrib);\n          const container: any = et.Element('layer', { 'n': '1' });\n\n          // Check for custos\n          for (let i = 0; i < sb.len(); i++) {\n            const custos = sb.getItem(0);\n            const lastStaff = staffStore[staffStore.length - 1];\n            lastStaff.getItem(lastStaff.len() - 1).append(custos);\n          }\n\n          // Get elements to add\n          const lastIndex = n + 1 === sbIndexes.length ? layer.len() : sbIndexes[n + 1];\n          container._children = container._children.concat(layer.getSlice(sbIndex + 1, lastIndex));\n          newStaff.append(container);\n          staffStore.push(newStaff);\n        }\n      }\n    }\n    const sectionId = section.get('xml:id');\n    section.clear();\n    section.set('xml:id', sectionId);\n    section._children = section._children.concat(staffStore);\n\n    // Handle sb in syllables\n    const stavesAdded = 0;\n    for (const [staff, staffIndex] of zip(section.getchildren(), [...Array(section.len()).keys()])) {\n      for (const layer of staff.getchildren()) {\n        for (const syllable of layer.findall('.//syllable')) {\n          const sb = syllable.find('sb');\n          if (!sb) {\n            continue;\n          }\n          const newStaff = et.Element('staff', sb.attrib);\n          const newLayer: any = et.SubElement(newStaff, 'layer');\n          newLayer.set('n', '1');\n\n          const newSyllableId = uuidv4();\n          const newSyllable: any = et.SubElement(newLayer, 'syllable');\n          newSyllable.set('follows', syllable.get('xml:id'));\n          newSyllable.set('xml:id', newSyllableId);\n          syllable.set('precedes', newSyllableId);\n          newSyllable._children = newSyllable._children.concat(syllable.getSlice(syllable.getchildren().indexOf(sb) + 1, syllable.len()));\n\n          const oldSyllableContent = syllable.getSlice(0, syllable.getchildren().indexOf(sb));\n          const syllableAttrib = syllable.attrib;\n\n          // Move remaining components to new staff.\n          newLayer._children = newLayer._children.concat(layer.getSlice(layer.getchildren().indexOf(syllable) + 1, layer.len()));\n          const layerAttrib = layer.attrib;\n          const layerContent = layer.getSlice(0, layer.getchildren().indexOf(syllable) + 1);\n          layer.clear();\n          layer.attrib = layerAttrib;\n          layer._children = layer._children.concat(layerContent);\n\n          // Handle custos;\n          layer._children = layer._children.concat(sb.getchildren());\n\n          // Shrink syllable\n          syllable.clear();\n          syllable.attrib = syllableAttrib;\n          syllable._children = syllable._children.concat(oldSyllableContent);\n\n          section._children.splice(staffIndex + stavesAdded + 1, 0, newStaff);\n        }\n      }\n    }\n  }\n\n  return meiTree.write({ 'xml_declaration': true, indent: 4 });\n}\n\nfunction zip (array1: Array<any>, array2: Array<any>): Array<any> {\n  const result = [];\n  for (let i = 0; i < (array1.length > array2.length ? array2.length : array1.length); i++) {\n    result.push([array1[i], array2[i]]);\n  }\n  return result;\n}\n","/**\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\nvar sprintf = require('./sprintf').sprintf;\n\nvar utils = require('./utils');\nvar ElementPath = require('./elementpath');\nvar TreeBuilder = require('./treebuilder').TreeBuilder;\nvar get_parser = require('./parser').get_parser;\nvar constants = require('./constants');\n\nvar element_ids = 0;\n\nfunction Element(tag, attrib)\n{\n  this._id = element_ids++;\n  this.tag = tag;\n  this.attrib = {};\n  this.text = null;\n  this.tail = null;\n  this._children = [];\n\n  if (attrib) {\n    this.attrib = utils.merge(this.attrib, attrib);\n  }\n}\n\nElement.prototype.toString = function()\n{\n  return sprintf(\"<Element %s at %s>\", this.tag, this._id);\n};\n\nElement.prototype.makeelement = function(tag, attrib)\n{\n  return new Element(tag, attrib);\n};\n\nElement.prototype.len = function()\n{\n  return this._children.length;\n};\n\nElement.prototype.getItem = function(index)\n{\n  return this._children[index];\n};\n\nElement.prototype.setItem = function(index, element)\n{\n  this._children[index] = element;\n};\n\nElement.prototype.delItem = function(index)\n{\n  this._children.splice(index, 1);\n};\n\nElement.prototype.getSlice = function(start, stop)\n{\n  return this._children.slice(start, stop);\n};\n\nElement.prototype.setSlice = function(start, stop, elements)\n{\n  var i;\n  var k = 0;\n  for (i = start; i < stop; i++, k++) {\n    this._children[i] = elements[k];\n  }\n};\n\nElement.prototype.delSlice = function(start, stop)\n{\n  this._children.splice(start, stop - start);\n};\n\nElement.prototype.append = function(element)\n{\n  this._children.push(element);\n};\n\nElement.prototype.extend = function(elements)\n{\n  this._children.concat(elements);\n};\n\nElement.prototype.insert = function(index, element)\n{\n  this._children[index] = element;\n};\n\nElement.prototype.remove = function(element)\n{\n  this._children = this._children.filter(function(e) {\n    /* TODO: is this the right way to do this? */\n    if (e._id === element._id) {\n      return false;\n    }\n    return true;\n  });\n};\n\nElement.prototype.getchildren = function() {\n  return this._children;\n};\n\nElement.prototype.find = function(path)\n{\n  return ElementPath.find(this, path);\n};\n\nElement.prototype.findtext = function(path, defvalue)\n{\n  return ElementPath.findtext(this, path, defvalue);\n};\n\nElement.prototype.findall = function(path, defvalue)\n{\n  return ElementPath.findall(this, path, defvalue);\n};\n\nElement.prototype.clear = function()\n{\n  this.attrib = {};\n  this._children = [];\n  this.text = null;\n  this.tail = null;\n};\n\nElement.prototype.get = function(key, defvalue)\n{\n  if (this.attrib[key] !== undefined) {\n    return this.attrib[key];\n  }\n  else {\n    return defvalue;\n  }\n};\n\nElement.prototype.set = function(key, value)\n{\n  this.attrib[key] = value;\n};\n\nElement.prototype.keys = function()\n{\n  return Object.keys(this.attrib);\n};\n\nElement.prototype.items = function()\n{\n  return utils.items(this.attrib);\n};\n\n/*\n * In python this uses a generator, but in v8 we don't have em,\n * so we use a callback instead.\n **/\nElement.prototype.iter = function(tag, callback)\n{\n  var self = this;\n  var i, child;\n\n  if (tag === \"*\") {\n    tag = null;\n  }\n\n  if (tag === null || this.tag === tag) {\n    callback(self);\n  }\n\n  for (i = 0; i < this._children.length; i++) {\n    child = this._children[i];\n    child.iter(tag, function(e) {\n      callback(e);\n    });\n  }\n};\n\nElement.prototype.itertext = function(callback)\n{\n  this.iter(null, function(e) {\n    if (e.text) {\n      callback(e.text);\n    }\n\n    if (e.tail) {\n      callback(e.tail);\n    }\n  });\n};\n\n\nfunction SubElement(parent, tag, attrib) {\n  var element = parent.makeelement(tag, attrib);\n  parent.append(element);\n  return element;\n}\n\nfunction Comment(text) {\n  var element = new Element(Comment);\n  if (text) {\n    element.text = text;\n  }\n  return element;\n}\n\nfunction CData(text) {\n  var element = new Element(CData);\n  if (text) {\n    element.text = text;\n  }\n  return element;\n}\n\nfunction ProcessingInstruction(target, text)\n{\n  var element = new Element(ProcessingInstruction);\n  element.text = target;\n  if (text) {\n    element.text = element.text + \" \" + text;\n  }\n  return element;\n}\n\nfunction QName(text_or_uri, tag)\n{\n  if (tag) {\n    text_or_uri = sprintf(\"{%s}%s\", text_or_uri, tag);\n  }\n  this.text = text_or_uri;\n}\n\nQName.prototype.toString = function() {\n  return this.text;\n};\n\nfunction ElementTree(element)\n{\n  this._root = element;\n}\n\nElementTree.prototype.getroot = function() {\n  return this._root;\n};\n\nElementTree.prototype._setroot = function(element) {\n  this._root = element;\n};\n\nElementTree.prototype.parse = function(source, parser) {\n  if (!parser) {\n    parser = get_parser(constants.DEFAULT_PARSER);\n    parser = new parser.XMLParser(new TreeBuilder());\n  }\n\n  parser.feed(source);\n  this._root = parser.close();\n  return this._root;\n};\n\nElementTree.prototype.iter = function(tag, callback) {\n  this._root.iter(tag, callback);\n};\n\nElementTree.prototype.find = function(path) {\n  return this._root.find(path);\n};\n\nElementTree.prototype.findtext = function(path, defvalue) {\n  return this._root.findtext(path, defvalue);\n};\n\nElementTree.prototype.findall = function(path) {\n  return this._root.findall(path);\n};\n\n/**\n * Unlike ElementTree, we don't write to a file, we return you a string.\n */\nElementTree.prototype.write = function(options) {\n  var sb = [];\n  options = utils.merge({\n    encoding: 'utf-8',\n    xml_declaration: null,\n    default_namespace: null,\n    method: 'xml'}, options);\n\n  if (options.xml_declaration !== false) {\n    sb.push(\"<?xml version='1.0' encoding='\"+options.encoding +\"'?>\\n\");\n  }\n\n  if (options.method === \"text\") {\n    _serialize_text(sb, self._root, encoding);\n  }\n  else {\n    var qnames, namespaces, indent, indent_string;\n    var x = _namespaces(this._root, options.encoding, options.default_namespace);\n    qnames = x[0];\n    namespaces = x[1];\n\n    if (options.hasOwnProperty('indent')) {\n      indent = 0;\n      indent_string = new Array(options.indent + 1).join(' ');\n    }\n    else {\n      indent = false;\n    }\n\n    if (options.method === \"xml\") {\n      _serialize_xml(function(data) {\n        sb.push(data);\n      }, this._root, options.encoding, qnames, namespaces, indent, indent_string);\n    }\n    else {\n      /* TODO: html */\n      throw new Error(\"unknown serialization method \"+ options.method);\n    }\n  }\n\n  return sb.join(\"\");\n};\n\nvar _namespace_map = {\n    /* \"well-known\" namespace prefixes */\n    \"http://www.w3.org/XML/1998/namespace\": \"xml\",\n    \"http://www.w3.org/1999/xhtml\": \"html\",\n    \"http://www.w3.org/1999/02/22-rdf-syntax-ns#\": \"rdf\",\n    \"http://schemas.xmlsoap.org/wsdl/\": \"wsdl\",\n    /* xml schema */\n    \"http://www.w3.org/2001/XMLSchema\": \"xs\",\n    \"http://www.w3.org/2001/XMLSchema-instance\": \"xsi\",\n    /* dublic core */\n    \"http://purl.org/dc/elements/1.1/\": \"dc\",\n};\n\nfunction register_namespace(prefix, uri) {\n  if (/ns\\d+$/.test(prefix)) {\n    throw new Error('Prefix format reserved for internal use');\n  }\n\n  if (_namespace_map.hasOwnProperty(uri) && _namespace_map[uri] === prefix) {\n    delete _namespace_map[uri];\n  }\n\n  _namespace_map[uri] = prefix;\n}\n\n\nfunction _escape(text, encoding, isAttribute, isText) {\n  if (text) {\n    text = text.toString();\n    text = text.replace(/&/g, '&amp;');\n    text = text.replace(/</g, '&lt;');\n    text = text.replace(/>/g, '&gt;');\n    if (!isText) {\n        text = text.replace(/\\n/g, '&#xA;');\n        text = text.replace(/\\r/g, '&#xD;');\n    }\n    if (isAttribute) {\n      text = text.replace(/\"/g, '&quot;');\n    }\n  }\n  return text;\n}\n\n/* TODO: benchmark single regex */\nfunction _escape_attrib(text, encoding) {\n  return _escape(text, encoding, true);\n}\n\nfunction _escape_cdata(text, encoding) {\n  return _escape(text, encoding, false);\n}\n\nfunction _escape_text(text, encoding) {\n  return _escape(text, encoding, false, true);\n}\n\nfunction _namespaces(elem, encoding, default_namespace) {\n  var qnames = {};\n  var namespaces = {};\n\n  if (default_namespace) {\n    namespaces[default_namespace] = \"\";\n  }\n\n  function encode(text) {\n    return text;\n  }\n\n  function add_qname(qname) {\n    if (qname[0] === \"{\") {\n      var tmp = qname.substring(1).split(\"}\", 2);\n      var uri = tmp[0];\n      var tag = tmp[1];\n      var prefix = namespaces[uri];\n\n      if (prefix === undefined) {\n        prefix = _namespace_map[uri];\n        if (prefix === undefined) {\n          prefix = \"ns\" + Object.keys(namespaces).length;\n        }\n        if (prefix !== \"xml\") {\n          namespaces[uri] = prefix;\n        }\n      }\n\n      if (prefix) {\n        qnames[qname] = sprintf(\"%s:%s\", prefix, tag);\n      }\n      else {\n        qnames[qname] = tag;\n      }\n    }\n    else {\n      if (default_namespace) {\n        throw new Error('cannot use non-qualified names with default_namespace option');\n      }\n\n      qnames[qname] = qname;\n    }\n  }\n\n\n  elem.iter(null, function(e) {\n    var i;\n    var tag = e.tag;\n    var text = e.text;\n    var items = e.items();\n\n    if (tag instanceof QName && qnames[tag.text] === undefined) {\n      add_qname(tag.text);\n    }\n    else if (typeof(tag) === \"string\") {\n      add_qname(tag);\n    }\n    else if (tag !== null && tag !== Comment && tag !== CData && tag !== ProcessingInstruction) {\n      throw new Error('Invalid tag type for serialization: '+ tag);\n    }\n\n    if (text instanceof QName && qnames[text.text] === undefined) {\n      add_qname(text.text);\n    }\n\n    items.forEach(function(item) {\n      var key = item[0],\n          value = item[1];\n      if (key instanceof QName) {\n        key = key.text;\n      }\n\n      if (qnames[key] === undefined) {\n        add_qname(key);\n      }\n\n      if (value instanceof QName && qnames[value.text] === undefined) {\n        add_qname(value.text);\n      }\n    });\n  });\n  return [qnames, namespaces];\n}\n\nfunction _serialize_xml(write, elem, encoding, qnames, namespaces, indent, indent_string) {\n  var tag = elem.tag;\n  var text = elem.text;\n  var items;\n  var i;\n\n  var newlines = indent || (indent === 0);\n  write(Array(indent + 1).join(indent_string));\n\n  if (tag === Comment) {\n    write(sprintf(\"<!--%s-->\", _escape_cdata(text, encoding)));\n  }\n  else if (tag === ProcessingInstruction) {\n    write(sprintf(\"<?%s?>\", _escape_cdata(text, encoding)));\n  }\n  else if (tag === CData) {\n    text = text || '';\n    write(sprintf(\"<![CDATA[%s]]>\", text));\n  }\n  else {\n    tag = qnames[tag];\n    if (tag === undefined) {\n      if (text) {\n        write(_escape_text(text, encoding));\n      }\n      elem.iter(function(e) {\n        _serialize_xml(write, e, encoding, qnames, null, newlines ? indent + 1 : false, indent_string);\n      });\n    }\n    else {\n      write(\"<\" + tag);\n      items = elem.items();\n\n      if (items || namespaces) {\n        items.sort(); // lexical order\n\n        items.forEach(function(item) {\n          var k = item[0],\n              v = item[1];\n\n            if (k instanceof QName) {\n              k = k.text;\n            }\n\n            if (v instanceof QName) {\n              v = qnames[v.text];\n            }\n            else {\n              v = _escape_attrib(v, encoding);\n            }\n            write(sprintf(\" %s=\\\"%s\\\"\", qnames[k], v));\n        });\n\n        if (namespaces) {\n          items = utils.items(namespaces);\n          items.sort(function(a, b) { return a[1] < b[1]; });\n\n          items.forEach(function(item) {\n            var k = item[1],\n                v = item[0];\n\n            if (k) {\n              k = ':' + k;\n            }\n\n            write(sprintf(\" xmlns%s=\\\"%s\\\"\", k, _escape_attrib(v, encoding)));\n          });\n        }\n      }\n\n      if (text || elem.len()) {\n        if (text && text.toString().match(/^\\s*$/)) {\n            text = null;\n        }\n\n        write(\">\");\n        if (!text && newlines) {\n          write(\"\\n\");\n        }\n\n        if (text) {\n          write(_escape_text(text, encoding));\n        }\n        elem._children.forEach(function(e) {\n          _serialize_xml(write, e, encoding, qnames, null, newlines ? indent + 1 : false, indent_string);\n        });\n\n        if (!text && indent) {\n          write(Array(indent + 1).join(indent_string));\n        }\n        write(\"</\" + tag + \">\");\n      }\n      else {\n        write(\" />\");\n      }\n    }\n  }\n\n  if (newlines) {\n    write(\"\\n\");\n  }\n}\n\nfunction parse(source, parser) {\n  var tree = new ElementTree();\n  tree.parse(source, parser);\n  return tree;\n}\n\nfunction tostring(element, options) {\n  return new ElementTree(element).write(options);\n}\n\nexports.PI = ProcessingInstruction;\nexports.Comment = Comment;\nexports.CData = CData;\nexports.ProcessingInstruction = ProcessingInstruction;\nexports.SubElement = SubElement;\nexports.QName = QName;\nexports.ElementTree = ElementTree;\nexports.ElementPath = ElementPath;\nexports.Element = function(tag, attrib) {\n  return new Element(tag, attrib);\n};\n\nexports.XML = function(data) {\n  var et = new ElementTree();\n  return et.parse(data);\n};\n\nexports.parse = parse;\nexports.register_namespace = register_namespace;\nexports.tostring = tostring;\n","/**\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\n/**\n * @param {Object} hash.\n * @param {Array} ignored.\n */\nfunction items(hash, ignored) {\n  ignored = ignored || null;\n  var k, rv = [];\n\n  function is_ignored(key) {\n    if (!ignored || ignored.length === 0) {\n      return false;\n    }\n\n    return ignored.indexOf(key);\n  }\n\n  for (k in hash) {\n    if (hash.hasOwnProperty(k) && !(is_ignored(ignored))) {\n      rv.push([k, hash[k]]);\n    }\n  }\n\n  return rv;\n}\n\n\nfunction findall(re, str) {\n  var match, matches = [];\n\n  while ((match = re.exec(str))) {\n      matches.push(match);\n  }\n\n  return matches;\n}\n\nfunction merge(a, b) {\n  var c = {}, attrname;\n\n  for (attrname in a) {\n    if (a.hasOwnProperty(attrname)) {\n      c[attrname] = a[attrname];\n    }\n  }\n  for (attrname in b) {\n    if (b.hasOwnProperty(attrname)) {\n      c[attrname] = b[attrname];\n    }\n  }\n  return c;\n}\n\nexports.items = items;\nexports.findall = findall;\nexports.merge = merge;\n","function TreeBuilder(element_factory) {\n  this._data = [];\n  this._elem = [];\n  this._last = null;\n  this._tail = null;\n  if (!element_factory) {\n    /* evil circular dep */\n    element_factory = require('./elementtree').Element;\n  }\n  this._factory = element_factory;\n}\n\nTreeBuilder.prototype.close = function() {\n  return this._last;\n};\n\nTreeBuilder.prototype._flush = function() {\n  if (this._data) {\n    if (this._last !== null) {\n      var text = this._data.join(\"\");\n      if (this._tail) {\n        this._last.tail = text;\n      }\n      else {\n        this._last.text = text;\n      }\n    }\n    this._data = [];\n  }\n};\n\nTreeBuilder.prototype.data = function(data) {\n  this._data.push(data);\n};\n\nTreeBuilder.prototype.start = function(tag, attrs) {\n  this._flush();\n  var elem = this._factory(tag, attrs);\n  this._last = elem;\n\n  if (this._elem.length) {\n    this._elem[this._elem.length - 1].append(elem);\n  }\n\n  this._elem.push(elem);\n\n  this._tail = null;\n};\n\nTreeBuilder.prototype.end = function(tag) {\n  this._flush();\n  this._last = this._elem.pop();\n  if (this._last.tag !== tag) {\n    throw new Error(\"end tag mismatch\");\n  }\n  this._tail = 1;\n  return this._last;\n};\n\nexports.TreeBuilder = TreeBuilder;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n/*<replacement>*/\n\nvar pna = require('process-nextick-args');\n/*</replacement>*/\n\nmodule.exports = Readable;\n\n/*<replacement>*/\nvar isArray = require('isarray');\n/*</replacement>*/\n\n/*<replacement>*/\nvar Duplex;\n/*</replacement>*/\n\nReadable.ReadableState = ReadableState;\n\n/*<replacement>*/\nvar EE = require('events').EventEmitter;\n\nvar EElistenerCount = function (emitter, type) {\n  return emitter.listeners(type).length;\n};\n/*</replacement>*/\n\n/*<replacement>*/\nvar Stream = require('./internal/streams/stream');\n/*</replacement>*/\n\n/*<replacement>*/\n\nvar Buffer = require('safe-buffer').Buffer;\nvar OurUint8Array = global.Uint8Array || function () {};\nfunction _uint8ArrayToBuffer(chunk) {\n  return Buffer.from(chunk);\n}\nfunction _isUint8Array(obj) {\n  return Buffer.isBuffer(obj) || obj instanceof OurUint8Array;\n}\n\n/*</replacement>*/\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\n/*<replacement>*/\nvar debugUtil = require('util');\nvar debug = void 0;\nif (debugUtil && debugUtil.debuglog) {\n  debug = debugUtil.debuglog('stream');\n} else {\n  debug = function () {};\n}\n/*</replacement>*/\n\nvar BufferList = require('./internal/streams/BufferList');\nvar destroyImpl = require('./internal/streams/destroy');\nvar StringDecoder;\n\nutil.inherits(Readable, Stream);\n\nvar kProxyEvents = ['error', 'close', 'destroy', 'pause', 'resume'];\n\nfunction prependListener(emitter, event, fn) {\n  // Sadly this is not cacheable as some libraries bundle their own\n  // event emitter implementation with them.\n  if (typeof emitter.prependListener === 'function') return emitter.prependListener(event, fn);\n\n  // This is a hack to make sure that our error handler is attached before any\n  // userland ones.  NEVER DO THIS. This is here only because this code needs\n  // to continue to work with older versions of Node.js that do not include\n  // the prependListener() method. The goal is to eventually remove this hack.\n  if (!emitter._events || !emitter._events[event]) emitter.on(event, fn);else if (isArray(emitter._events[event])) emitter._events[event].unshift(fn);else emitter._events[event] = [fn, emitter._events[event]];\n}\n\nfunction ReadableState(options, stream) {\n  Duplex = Duplex || require('./_stream_duplex');\n\n  options = options || {};\n\n  // Duplex streams are both readable and writable, but share\n  // the same options object.\n  // However, some cases require setting options to different\n  // values for the readable and the writable sides of the duplex stream.\n  // These options can be provided separately as readableXXX and writableXXX.\n  var isDuplex = stream instanceof Duplex;\n\n  // object stream flag. Used to make read(n) ignore n and to\n  // make all the buffer merging and length checks go away\n  this.objectMode = !!options.objectMode;\n\n  if (isDuplex) this.objectMode = this.objectMode || !!options.readableObjectMode;\n\n  // the point at which it stops calling _read() to fill the buffer\n  // Note: 0 is a valid value, means \"don't call _read preemptively ever\"\n  var hwm = options.highWaterMark;\n  var readableHwm = options.readableHighWaterMark;\n  var defaultHwm = this.objectMode ? 16 : 16 * 1024;\n\n  if (hwm || hwm === 0) this.highWaterMark = hwm;else if (isDuplex && (readableHwm || readableHwm === 0)) this.highWaterMark = readableHwm;else this.highWaterMark = defaultHwm;\n\n  // cast to ints.\n  this.highWaterMark = Math.floor(this.highWaterMark);\n\n  // A linked list is used to store data chunks instead of an array because the\n  // linked list can remove elements from the beginning faster than\n  // array.shift()\n  this.buffer = new BufferList();\n  this.length = 0;\n  this.pipes = null;\n  this.pipesCount = 0;\n  this.flowing = null;\n  this.ended = false;\n  this.endEmitted = false;\n  this.reading = false;\n\n  // a flag to be able to tell if the event 'readable'/'data' is emitted\n  // immediately, or on a later tick.  We set this to true at first, because\n  // any actions that shouldn't happen until \"later\" should generally also\n  // not happen before the first read call.\n  this.sync = true;\n\n  // whenever we return null, then we set a flag to say\n  // that we're awaiting a 'readable' event emission.\n  this.needReadable = false;\n  this.emittedReadable = false;\n  this.readableListening = false;\n  this.resumeScheduled = false;\n\n  // has it been destroyed\n  this.destroyed = false;\n\n  // Crypto is kind of old and crusty.  Historically, its default string\n  // encoding is 'binary' so we have to make this configurable.\n  // Everything else in the universe uses 'utf8', though.\n  this.defaultEncoding = options.defaultEncoding || 'utf8';\n\n  // the number of writers that are awaiting a drain event in .pipe()s\n  this.awaitDrain = 0;\n\n  // if true, a maybeReadMore has been scheduled\n  this.readingMore = false;\n\n  this.decoder = null;\n  this.encoding = null;\n  if (options.encoding) {\n    if (!StringDecoder) StringDecoder = require('string_decoder/').StringDecoder;\n    this.decoder = new StringDecoder(options.encoding);\n    this.encoding = options.encoding;\n  }\n}\n\nfunction Readable(options) {\n  Duplex = Duplex || require('./_stream_duplex');\n\n  if (!(this instanceof Readable)) return new Readable(options);\n\n  this._readableState = new ReadableState(options, this);\n\n  // legacy\n  this.readable = true;\n\n  if (options) {\n    if (typeof options.read === 'function') this._read = options.read;\n\n    if (typeof options.destroy === 'function') this._destroy = options.destroy;\n  }\n\n  Stream.call(this);\n}\n\nObject.defineProperty(Readable.prototype, 'destroyed', {\n  get: function () {\n    if (this._readableState === undefined) {\n      return false;\n    }\n    return this._readableState.destroyed;\n  },\n  set: function (value) {\n    // we ignore the value if the stream\n    // has not been initialized yet\n    if (!this._readableState) {\n      return;\n    }\n\n    // backward compatibility, the user is explicitly\n    // managing destroyed\n    this._readableState.destroyed = value;\n  }\n});\n\nReadable.prototype.destroy = destroyImpl.destroy;\nReadable.prototype._undestroy = destroyImpl.undestroy;\nReadable.prototype._destroy = function (err, cb) {\n  this.push(null);\n  cb(err);\n};\n\n// Manually shove something into the read() buffer.\n// This returns true if the highWaterMark has not been hit yet,\n// similar to how Writable.write() returns true if you should\n// write() some more.\nReadable.prototype.push = function (chunk, encoding) {\n  var state = this._readableState;\n  var skipChunkCheck;\n\n  if (!state.objectMode) {\n    if (typeof chunk === 'string') {\n      encoding = encoding || state.defaultEncoding;\n      if (encoding !== state.encoding) {\n        chunk = Buffer.from(chunk, encoding);\n        encoding = '';\n      }\n      skipChunkCheck = true;\n    }\n  } else {\n    skipChunkCheck = true;\n  }\n\n  return readableAddChunk(this, chunk, encoding, false, skipChunkCheck);\n};\n\n// Unshift should *always* be something directly out of read()\nReadable.prototype.unshift = function (chunk) {\n  return readableAddChunk(this, chunk, null, true, false);\n};\n\nfunction readableAddChunk(stream, chunk, encoding, addToFront, skipChunkCheck) {\n  var state = stream._readableState;\n  if (chunk === null) {\n    state.reading = false;\n    onEofChunk(stream, state);\n  } else {\n    var er;\n    if (!skipChunkCheck) er = chunkInvalid(state, chunk);\n    if (er) {\n      stream.emit('error', er);\n    } else if (state.objectMode || chunk && chunk.length > 0) {\n      if (typeof chunk !== 'string' && !state.objectMode && Object.getPrototypeOf(chunk) !== Buffer.prototype) {\n        chunk = _uint8ArrayToBuffer(chunk);\n      }\n\n      if (addToFront) {\n        if (state.endEmitted) stream.emit('error', new Error('stream.unshift() after end event'));else addChunk(stream, state, chunk, true);\n      } else if (state.ended) {\n        stream.emit('error', new Error('stream.push() after EOF'));\n      } else {\n        state.reading = false;\n        if (state.decoder && !encoding) {\n          chunk = state.decoder.write(chunk);\n          if (state.objectMode || chunk.length !== 0) addChunk(stream, state, chunk, false);else maybeReadMore(stream, state);\n        } else {\n          addChunk(stream, state, chunk, false);\n        }\n      }\n    } else if (!addToFront) {\n      state.reading = false;\n    }\n  }\n\n  return needMoreData(state);\n}\n\nfunction addChunk(stream, state, chunk, addToFront) {\n  if (state.flowing && state.length === 0 && !state.sync) {\n    stream.emit('data', chunk);\n    stream.read(0);\n  } else {\n    // update the buffer info.\n    state.length += state.objectMode ? 1 : chunk.length;\n    if (addToFront) state.buffer.unshift(chunk);else state.buffer.push(chunk);\n\n    if (state.needReadable) emitReadable(stream);\n  }\n  maybeReadMore(stream, state);\n}\n\nfunction chunkInvalid(state, chunk) {\n  var er;\n  if (!_isUint8Array(chunk) && typeof chunk !== 'string' && chunk !== undefined && !state.objectMode) {\n    er = new TypeError('Invalid non-string/buffer chunk');\n  }\n  return er;\n}\n\n// if it's past the high water mark, we can push in some more.\n// Also, if we have no data yet, we can stand some\n// more bytes.  This is to work around cases where hwm=0,\n// such as the repl.  Also, if the push() triggered a\n// readable event, and the user called read(largeNumber) such that\n// needReadable was set, then we ought to push more, so that another\n// 'readable' event will be triggered.\nfunction needMoreData(state) {\n  return !state.ended && (state.needReadable || state.length < state.highWaterMark || state.length === 0);\n}\n\nReadable.prototype.isPaused = function () {\n  return this._readableState.flowing === false;\n};\n\n// backwards compatibility.\nReadable.prototype.setEncoding = function (enc) {\n  if (!StringDecoder) StringDecoder = require('string_decoder/').StringDecoder;\n  this._readableState.decoder = new StringDecoder(enc);\n  this._readableState.encoding = enc;\n  return this;\n};\n\n// Don't raise the hwm > 8MB\nvar MAX_HWM = 0x800000;\nfunction computeNewHighWaterMark(n) {\n  if (n >= MAX_HWM) {\n    n = MAX_HWM;\n  } else {\n    // Get the next highest power of 2 to prevent increasing hwm excessively in\n    // tiny amounts\n    n--;\n    n |= n >>> 1;\n    n |= n >>> 2;\n    n |= n >>> 4;\n    n |= n >>> 8;\n    n |= n >>> 16;\n    n++;\n  }\n  return n;\n}\n\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction howMuchToRead(n, state) {\n  if (n <= 0 || state.length === 0 && state.ended) return 0;\n  if (state.objectMode) return 1;\n  if (n !== n) {\n    // Only flow one buffer at a time\n    if (state.flowing && state.length) return state.buffer.head.data.length;else return state.length;\n  }\n  // If we're asking for more than the current hwm, then raise the hwm.\n  if (n > state.highWaterMark) state.highWaterMark = computeNewHighWaterMark(n);\n  if (n <= state.length) return n;\n  // Don't have enough\n  if (!state.ended) {\n    state.needReadable = true;\n    return 0;\n  }\n  return state.length;\n}\n\n// you can override either this method, or the async _read(n) below.\nReadable.prototype.read = function (n) {\n  debug('read', n);\n  n = parseInt(n, 10);\n  var state = this._readableState;\n  var nOrig = n;\n\n  if (n !== 0) state.emittedReadable = false;\n\n  // if we're doing read(0) to trigger a readable event, but we\n  // already have a bunch of data in the buffer, then just trigger\n  // the 'readable' event and move on.\n  if (n === 0 && state.needReadable && (state.length >= state.highWaterMark || state.ended)) {\n    debug('read: emitReadable', state.length, state.ended);\n    if (state.length === 0 && state.ended) endReadable(this);else emitReadable(this);\n    return null;\n  }\n\n  n = howMuchToRead(n, state);\n\n  // if we've ended, and we're now clear, then finish it up.\n  if (n === 0 && state.ended) {\n    if (state.length === 0) endReadable(this);\n    return null;\n  }\n\n  // All the actual chunk generation logic needs to be\n  // *below* the call to _read.  The reason is that in certain\n  // synthetic stream cases, such as passthrough streams, _read\n  // may be a completely synchronous operation which may change\n  // the state of the read buffer, providing enough data when\n  // before there was *not* enough.\n  //\n  // So, the steps are:\n  // 1. Figure out what the state of things will be after we do\n  // a read from the buffer.\n  //\n  // 2. If that resulting state will trigger a _read, then call _read.\n  // Note that this may be asynchronous, or synchronous.  Yes, it is\n  // deeply ugly to write APIs this way, but that still doesn't mean\n  // that the Readable class should behave improperly, as streams are\n  // designed to be sync/async agnostic.\n  // Take note if the _read call is sync or async (ie, if the read call\n  // has returned yet), so that we know whether or not it's safe to emit\n  // 'readable' etc.\n  //\n  // 3. Actually pull the requested chunks out of the buffer and return.\n\n  // if we need a readable event, then we need to do some reading.\n  var doRead = state.needReadable;\n  debug('need readable', doRead);\n\n  // if we currently have less than the highWaterMark, then also read some\n  if (state.length === 0 || state.length - n < state.highWaterMark) {\n    doRead = true;\n    debug('length less than watermark', doRead);\n  }\n\n  // however, if we've ended, then there's no point, and if we're already\n  // reading, then it's unnecessary.\n  if (state.ended || state.reading) {\n    doRead = false;\n    debug('reading or ended', doRead);\n  } else if (doRead) {\n    debug('do read');\n    state.reading = true;\n    state.sync = true;\n    // if the length is currently zero, then we *need* a readable event.\n    if (state.length === 0) state.needReadable = true;\n    // call internal read method\n    this._read(state.highWaterMark);\n    state.sync = false;\n    // If _read pushed data synchronously, then `reading` will be false,\n    // and we need to re-evaluate how much data we can return to the user.\n    if (!state.reading) n = howMuchToRead(nOrig, state);\n  }\n\n  var ret;\n  if (n > 0) ret = fromList(n, state);else ret = null;\n\n  if (ret === null) {\n    state.needReadable = true;\n    n = 0;\n  } else {\n    state.length -= n;\n  }\n\n  if (state.length === 0) {\n    // If we have nothing in the buffer, then we want to know\n    // as soon as we *do* get something into the buffer.\n    if (!state.ended) state.needReadable = true;\n\n    // If we tried to read() past the EOF, then emit end on the next tick.\n    if (nOrig !== n && state.ended) endReadable(this);\n  }\n\n  if (ret !== null) this.emit('data', ret);\n\n  return ret;\n};\n\nfunction onEofChunk(stream, state) {\n  if (state.ended) return;\n  if (state.decoder) {\n    var chunk = state.decoder.end();\n    if (chunk && chunk.length) {\n      state.buffer.push(chunk);\n      state.length += state.objectMode ? 1 : chunk.length;\n    }\n  }\n  state.ended = true;\n\n  // emit 'readable' now to make sure it gets picked up.\n  emitReadable(stream);\n}\n\n// Don't emit readable right away in sync mode, because this can trigger\n// another read() call => stack overflow.  This way, it might trigger\n// a nextTick recursion warning, but that's not so bad.\nfunction emitReadable(stream) {\n  var state = stream._readableState;\n  state.needReadable = false;\n  if (!state.emittedReadable) {\n    debug('emitReadable', state.flowing);\n    state.emittedReadable = true;\n    if (state.sync) pna.nextTick(emitReadable_, stream);else emitReadable_(stream);\n  }\n}\n\nfunction emitReadable_(stream) {\n  debug('emit readable');\n  stream.emit('readable');\n  flow(stream);\n}\n\n// at this point, the user has presumably seen the 'readable' event,\n// and called read() to consume some data.  that may have triggered\n// in turn another _read(n) call, in which case reading = true if\n// it's in progress.\n// However, if we're not ended, or reading, and the length < hwm,\n// then go ahead and try to read some more preemptively.\nfunction maybeReadMore(stream, state) {\n  if (!state.readingMore) {\n    state.readingMore = true;\n    pna.nextTick(maybeReadMore_, stream, state);\n  }\n}\n\nfunction maybeReadMore_(stream, state) {\n  var len = state.length;\n  while (!state.reading && !state.flowing && !state.ended && state.length < state.highWaterMark) {\n    debug('maybeReadMore read 0');\n    stream.read(0);\n    if (len === state.length)\n      // didn't get any data, stop spinning.\n      break;else len = state.length;\n  }\n  state.readingMore = false;\n}\n\n// abstract method.  to be overridden in specific implementation classes.\n// call cb(er, data) where data is <= n in length.\n// for virtual (non-string, non-buffer) streams, \"length\" is somewhat\n// arbitrary, and perhaps not very meaningful.\nReadable.prototype._read = function (n) {\n  this.emit('error', new Error('_read() is not implemented'));\n};\n\nReadable.prototype.pipe = function (dest, pipeOpts) {\n  var src = this;\n  var state = this._readableState;\n\n  switch (state.pipesCount) {\n    case 0:\n      state.pipes = dest;\n      break;\n    case 1:\n      state.pipes = [state.pipes, dest];\n      break;\n    default:\n      state.pipes.push(dest);\n      break;\n  }\n  state.pipesCount += 1;\n  debug('pipe count=%d opts=%j', state.pipesCount, pipeOpts);\n\n  var doEnd = (!pipeOpts || pipeOpts.end !== false) && dest !== process.stdout && dest !== process.stderr;\n\n  var endFn = doEnd ? onend : unpipe;\n  if (state.endEmitted) pna.nextTick(endFn);else src.once('end', endFn);\n\n  dest.on('unpipe', onunpipe);\n  function onunpipe(readable, unpipeInfo) {\n    debug('onunpipe');\n    if (readable === src) {\n      if (unpipeInfo && unpipeInfo.hasUnpiped === false) {\n        unpipeInfo.hasUnpiped = true;\n        cleanup();\n      }\n    }\n  }\n\n  function onend() {\n    debug('onend');\n    dest.end();\n  }\n\n  // when the dest drains, it reduces the awaitDrain counter\n  // on the source.  This would be more elegant with a .once()\n  // handler in flow(), but adding and removing repeatedly is\n  // too slow.\n  var ondrain = pipeOnDrain(src);\n  dest.on('drain', ondrain);\n\n  var cleanedUp = false;\n  function cleanup() {\n    debug('cleanup');\n    // cleanup event handlers once the pipe is broken\n    dest.removeListener('close', onclose);\n    dest.removeListener('finish', onfinish);\n    dest.removeListener('drain', ondrain);\n    dest.removeListener('error', onerror);\n    dest.removeListener('unpipe', onunpipe);\n    src.removeListener('end', onend);\n    src.removeListener('end', unpipe);\n    src.removeListener('data', ondata);\n\n    cleanedUp = true;\n\n    // if the reader is waiting for a drain event from this\n    // specific writer, then it would cause it to never start\n    // flowing again.\n    // So, if this is awaiting a drain, then we just call it now.\n    // If we don't know, then assume that we are waiting for one.\n    if (state.awaitDrain && (!dest._writableState || dest._writableState.needDrain)) ondrain();\n  }\n\n  // If the user pushes more data while we're writing to dest then we'll end up\n  // in ondata again. However, we only want to increase awaitDrain once because\n  // dest will only emit one 'drain' event for the multiple writes.\n  // => Introduce a guard on increasing awaitDrain.\n  var increasedAwaitDrain = false;\n  src.on('data', ondata);\n  function ondata(chunk) {\n    debug('ondata');\n    increasedAwaitDrain = false;\n    var ret = dest.write(chunk);\n    if (false === ret && !increasedAwaitDrain) {\n      // If the user unpiped during `dest.write()`, it is possible\n      // to get stuck in a permanently paused state if that write\n      // also returned false.\n      // => Check whether `dest` is still a piping destination.\n      if ((state.pipesCount === 1 && state.pipes === dest || state.pipesCount > 1 && indexOf(state.pipes, dest) !== -1) && !cleanedUp) {\n        debug('false write response, pause', src._readableState.awaitDrain);\n        src._readableState.awaitDrain++;\n        increasedAwaitDrain = true;\n      }\n      src.pause();\n    }\n  }\n\n  // if the dest has an error, then stop piping into it.\n  // however, don't suppress the throwing behavior for this.\n  function onerror(er) {\n    debug('onerror', er);\n    unpipe();\n    dest.removeListener('error', onerror);\n    if (EElistenerCount(dest, 'error') === 0) dest.emit('error', er);\n  }\n\n  // Make sure our error handler is attached before userland ones.\n  prependListener(dest, 'error', onerror);\n\n  // Both close and finish should trigger unpipe, but only once.\n  function onclose() {\n    dest.removeListener('finish', onfinish);\n    unpipe();\n  }\n  dest.once('close', onclose);\n  function onfinish() {\n    debug('onfinish');\n    dest.removeListener('close', onclose);\n    unpipe();\n  }\n  dest.once('finish', onfinish);\n\n  function unpipe() {\n    debug('unpipe');\n    src.unpipe(dest);\n  }\n\n  // tell the dest that it's being piped to\n  dest.emit('pipe', src);\n\n  // start the flow if it hasn't been started already.\n  if (!state.flowing) {\n    debug('pipe resume');\n    src.resume();\n  }\n\n  return dest;\n};\n\nfunction pipeOnDrain(src) {\n  return function () {\n    var state = src._readableState;\n    debug('pipeOnDrain', state.awaitDrain);\n    if (state.awaitDrain) state.awaitDrain--;\n    if (state.awaitDrain === 0 && EElistenerCount(src, 'data')) {\n      state.flowing = true;\n      flow(src);\n    }\n  };\n}\n\nReadable.prototype.unpipe = function (dest) {\n  var state = this._readableState;\n  var unpipeInfo = { hasUnpiped: false };\n\n  // if we're not piping anywhere, then do nothing.\n  if (state.pipesCount === 0) return this;\n\n  // just one destination.  most common case.\n  if (state.pipesCount === 1) {\n    // passed in one, but it's not the right one.\n    if (dest && dest !== state.pipes) return this;\n\n    if (!dest) dest = state.pipes;\n\n    // got a match.\n    state.pipes = null;\n    state.pipesCount = 0;\n    state.flowing = false;\n    if (dest) dest.emit('unpipe', this, unpipeInfo);\n    return this;\n  }\n\n  // slow case. multiple pipe destinations.\n\n  if (!dest) {\n    // remove all.\n    var dests = state.pipes;\n    var len = state.pipesCount;\n    state.pipes = null;\n    state.pipesCount = 0;\n    state.flowing = false;\n\n    for (var i = 0; i < len; i++) {\n      dests[i].emit('unpipe', this, unpipeInfo);\n    }return this;\n  }\n\n  // try to find the right one.\n  var index = indexOf(state.pipes, dest);\n  if (index === -1) return this;\n\n  state.pipes.splice(index, 1);\n  state.pipesCount -= 1;\n  if (state.pipesCount === 1) state.pipes = state.pipes[0];\n\n  dest.emit('unpipe', this, unpipeInfo);\n\n  return this;\n};\n\n// set up data events if they are asked for\n// Ensure readable listeners eventually get something\nReadable.prototype.on = function (ev, fn) {\n  var res = Stream.prototype.on.call(this, ev, fn);\n\n  if (ev === 'data') {\n    // Start flowing on next tick if stream isn't explicitly paused\n    if (this._readableState.flowing !== false) this.resume();\n  } else if (ev === 'readable') {\n    var state = this._readableState;\n    if (!state.endEmitted && !state.readableListening) {\n      state.readableListening = state.needReadable = true;\n      state.emittedReadable = false;\n      if (!state.reading) {\n        pna.nextTick(nReadingNextTick, this);\n      } else if (state.length) {\n        emitReadable(this);\n      }\n    }\n  }\n\n  return res;\n};\nReadable.prototype.addListener = Readable.prototype.on;\n\nfunction nReadingNextTick(self) {\n  debug('readable nexttick read 0');\n  self.read(0);\n}\n\n// pause() and resume() are remnants of the legacy readable stream API\n// If the user uses them, then switch into old mode.\nReadable.prototype.resume = function () {\n  var state = this._readableState;\n  if (!state.flowing) {\n    debug('resume');\n    state.flowing = true;\n    resume(this, state);\n  }\n  return this;\n};\n\nfunction resume(stream, state) {\n  if (!state.resumeScheduled) {\n    state.resumeScheduled = true;\n    pna.nextTick(resume_, stream, state);\n  }\n}\n\nfunction resume_(stream, state) {\n  if (!state.reading) {\n    debug('resume read 0');\n    stream.read(0);\n  }\n\n  state.resumeScheduled = false;\n  state.awaitDrain = 0;\n  stream.emit('resume');\n  flow(stream);\n  if (state.flowing && !state.reading) stream.read(0);\n}\n\nReadable.prototype.pause = function () {\n  debug('call pause flowing=%j', this._readableState.flowing);\n  if (false !== this._readableState.flowing) {\n    debug('pause');\n    this._readableState.flowing = false;\n    this.emit('pause');\n  }\n  return this;\n};\n\nfunction flow(stream) {\n  var state = stream._readableState;\n  debug('flow', state.flowing);\n  while (state.flowing && stream.read() !== null) {}\n}\n\n// wrap an old-style stream as the async data source.\n// This is *not* part of the readable stream interface.\n// It is an ugly unfortunate mess of history.\nReadable.prototype.wrap = function (stream) {\n  var _this = this;\n\n  var state = this._readableState;\n  var paused = false;\n\n  stream.on('end', function () {\n    debug('wrapped end');\n    if (state.decoder && !state.ended) {\n      var chunk = state.decoder.end();\n      if (chunk && chunk.length) _this.push(chunk);\n    }\n\n    _this.push(null);\n  });\n\n  stream.on('data', function (chunk) {\n    debug('wrapped data');\n    if (state.decoder) chunk = state.decoder.write(chunk);\n\n    // don't skip over falsy values in objectMode\n    if (state.objectMode && (chunk === null || chunk === undefined)) return;else if (!state.objectMode && (!chunk || !chunk.length)) return;\n\n    var ret = _this.push(chunk);\n    if (!ret) {\n      paused = true;\n      stream.pause();\n    }\n  });\n\n  // proxy all the other methods.\n  // important when wrapping filters and duplexes.\n  for (var i in stream) {\n    if (this[i] === undefined && typeof stream[i] === 'function') {\n      this[i] = function (method) {\n        return function () {\n          return stream[method].apply(stream, arguments);\n        };\n      }(i);\n    }\n  }\n\n  // proxy certain important events.\n  for (var n = 0; n < kProxyEvents.length; n++) {\n    stream.on(kProxyEvents[n], this.emit.bind(this, kProxyEvents[n]));\n  }\n\n  // when we try to consume some more bytes, simply unpause the\n  // underlying stream.\n  this._read = function (n) {\n    debug('wrapped _read', n);\n    if (paused) {\n      paused = false;\n      stream.resume();\n    }\n  };\n\n  return this;\n};\n\nObject.defineProperty(Readable.prototype, 'readableHighWaterMark', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function () {\n    return this._readableState.highWaterMark;\n  }\n});\n\n// exposed for testing purposes only.\nReadable._fromList = fromList;\n\n// Pluck off n bytes from an array of buffers.\n// Length is the combined lengths of all the buffers in the list.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction fromList(n, state) {\n  // nothing buffered\n  if (state.length === 0) return null;\n\n  var ret;\n  if (state.objectMode) ret = state.buffer.shift();else if (!n || n >= state.length) {\n    // read it all, truncate the list\n    if (state.decoder) ret = state.buffer.join('');else if (state.buffer.length === 1) ret = state.buffer.head.data;else ret = state.buffer.concat(state.length);\n    state.buffer.clear();\n  } else {\n    // read part of list\n    ret = fromListPartial(n, state.buffer, state.decoder);\n  }\n\n  return ret;\n}\n\n// Extracts only enough buffered data to satisfy the amount requested.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction fromListPartial(n, list, hasStrings) {\n  var ret;\n  if (n < list.head.data.length) {\n    // slice is the same for buffers and strings\n    ret = list.head.data.slice(0, n);\n    list.head.data = list.head.data.slice(n);\n  } else if (n === list.head.data.length) {\n    // first chunk is a perfect match\n    ret = list.shift();\n  } else {\n    // result spans more than one buffer\n    ret = hasStrings ? copyFromBufferString(n, list) : copyFromBuffer(n, list);\n  }\n  return ret;\n}\n\n// Copies a specified amount of characters from the list of buffered data\n// chunks.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction copyFromBufferString(n, list) {\n  var p = list.head;\n  var c = 1;\n  var ret = p.data;\n  n -= ret.length;\n  while (p = p.next) {\n    var str = p.data;\n    var nb = n > str.length ? str.length : n;\n    if (nb === str.length) ret += str;else ret += str.slice(0, n);\n    n -= nb;\n    if (n === 0) {\n      if (nb === str.length) {\n        ++c;\n        if (p.next) list.head = p.next;else list.head = list.tail = null;\n      } else {\n        list.head = p;\n        p.data = str.slice(nb);\n      }\n      break;\n    }\n    ++c;\n  }\n  list.length -= c;\n  return ret;\n}\n\n// Copies a specified amount of bytes from the list of buffered data chunks.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction copyFromBuffer(n, list) {\n  var ret = Buffer.allocUnsafe(n);\n  var p = list.head;\n  var c = 1;\n  p.data.copy(ret);\n  n -= p.data.length;\n  while (p = p.next) {\n    var buf = p.data;\n    var nb = n > buf.length ? buf.length : n;\n    buf.copy(ret, ret.length - n, 0, nb);\n    n -= nb;\n    if (n === 0) {\n      if (nb === buf.length) {\n        ++c;\n        if (p.next) list.head = p.next;else list.head = list.tail = null;\n      } else {\n        list.head = p;\n        p.data = buf.slice(nb);\n      }\n      break;\n    }\n    ++c;\n  }\n  list.length -= c;\n  return ret;\n}\n\nfunction endReadable(stream) {\n  var state = stream._readableState;\n\n  // If we get here before consuming all the bytes, then that is a\n  // bug in node.  Should never happen.\n  if (state.length > 0) throw new Error('\"endReadable()\" called on non-empty stream');\n\n  if (!state.endEmitted) {\n    state.ended = true;\n    pna.nextTick(endReadableNT, state, stream);\n  }\n}\n\nfunction endReadableNT(state, stream) {\n  // Check that we didn't get one last unshift.\n  if (!state.endEmitted && state.length === 0) {\n    state.endEmitted = true;\n    stream.readable = false;\n    stream.emit('end');\n  }\n}\n\nfunction indexOf(xs, x) {\n  for (var i = 0, l = xs.length; i < l; i++) {\n    if (xs[i] === x) return i;\n  }\n  return -1;\n}","module.exports = require('events').EventEmitter;\n","'use strict';\n\n/*<replacement>*/\n\nvar pna = require('process-nextick-args');\n/*</replacement>*/\n\n// undocumented cb() API, needed for core, not for public API\nfunction destroy(err, cb) {\n  var _this = this;\n\n  var readableDestroyed = this._readableState && this._readableState.destroyed;\n  var writableDestroyed = this._writableState && this._writableState.destroyed;\n\n  if (readableDestroyed || writableDestroyed) {\n    if (cb) {\n      cb(err);\n    } else if (err && (!this._writableState || !this._writableState.errorEmitted)) {\n      pna.nextTick(emitErrorNT, this, err);\n    }\n    return this;\n  }\n\n  // we set destroyed to true before firing error callbacks in order\n  // to make it re-entrance safe in case destroy() is called within callbacks\n\n  if (this._readableState) {\n    this._readableState.destroyed = true;\n  }\n\n  // if this is a duplex stream mark the writable part as destroyed as well\n  if (this._writableState) {\n    this._writableState.destroyed = true;\n  }\n\n  this._destroy(err || null, function (err) {\n    if (!cb && err) {\n      pna.nextTick(emitErrorNT, _this, err);\n      if (_this._writableState) {\n        _this._writableState.errorEmitted = true;\n      }\n    } else if (cb) {\n      cb(err);\n    }\n  });\n\n  return this;\n}\n\nfunction undestroy() {\n  if (this._readableState) {\n    this._readableState.destroyed = false;\n    this._readableState.reading = false;\n    this._readableState.ended = false;\n    this._readableState.endEmitted = false;\n  }\n\n  if (this._writableState) {\n    this._writableState.destroyed = false;\n    this._writableState.ended = false;\n    this._writableState.ending = false;\n    this._writableState.finished = false;\n    this._writableState.errorEmitted = false;\n  }\n}\n\nfunction emitErrorNT(self, err) {\n  self.emit('error', err);\n}\n\nmodule.exports = {\n  destroy: destroy,\n  undestroy: undestroy\n};","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a transform stream is a readable/writable stream where you do\n// something with the data.  Sometimes it's called a \"filter\",\n// but that's not a great name for it, since that implies a thing where\n// some bits pass through, and others are simply ignored.  (That would\n// be a valid example of a transform, of course.)\n//\n// While the output is causally related to the input, it's not a\n// necessarily symmetric or synchronous transformation.  For example,\n// a zlib stream might take multiple plain-text writes(), and then\n// emit a single compressed chunk some time in the future.\n//\n// Here's how this works:\n//\n// The Transform stream has all the aspects of the readable and writable\n// stream classes.  When you write(chunk), that calls _write(chunk,cb)\n// internally, and returns false if there's a lot of pending writes\n// buffered up.  When you call read(), that calls _read(n) until\n// there's enough pending readable data buffered up.\n//\n// In a transform stream, the written data is placed in a buffer.  When\n// _read(n) is called, it transforms the queued up data, calling the\n// buffered _write cb's as it consumes chunks.  If consuming a single\n// written chunk would result in multiple output chunks, then the first\n// outputted bit calls the readcb, and subsequent chunks just go into\n// the read buffer, and will cause it to emit 'readable' if necessary.\n//\n// This way, back-pressure is actually determined by the reading side,\n// since _read has to be called to start processing a new chunk.  However,\n// a pathological inflate type of transform can cause excessive buffering\n// here.  For example, imagine a stream where every byte of input is\n// interpreted as an integer from 0-255, and then results in that many\n// bytes of output.  Writing the 4 bytes {ff,ff,ff,ff} would result in\n// 1kb of data being output.  In this case, you could write a very small\n// amount of input, and end up with a very large amount of output.  In\n// such a pathological inflating mechanism, there'd be no way to tell\n// the system to stop doing the transform.  A single 4MB write could\n// cause the system to run out of memory.\n//\n// However, even in such a pathological case, only a single written chunk\n// would be consumed, and then the rest would wait (un-transformed) until\n// the results of the previous transformed chunk were consumed.\n\n'use strict';\n\nmodule.exports = Transform;\n\nvar Duplex = require('./_stream_duplex');\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nutil.inherits(Transform, Duplex);\n\nfunction afterTransform(er, data) {\n  var ts = this._transformState;\n  ts.transforming = false;\n\n  var cb = ts.writecb;\n\n  if (!cb) {\n    return this.emit('error', new Error('write callback called multiple times'));\n  }\n\n  ts.writechunk = null;\n  ts.writecb = null;\n\n  if (data != null) // single equals check for both `null` and `undefined`\n    this.push(data);\n\n  cb(er);\n\n  var rs = this._readableState;\n  rs.reading = false;\n  if (rs.needReadable || rs.length < rs.highWaterMark) {\n    this._read(rs.highWaterMark);\n  }\n}\n\nfunction Transform(options) {\n  if (!(this instanceof Transform)) return new Transform(options);\n\n  Duplex.call(this, options);\n\n  this._transformState = {\n    afterTransform: afterTransform.bind(this),\n    needTransform: false,\n    transforming: false,\n    writecb: null,\n    writechunk: null,\n    writeencoding: null\n  };\n\n  // start out asking for a readable event once data is transformed.\n  this._readableState.needReadable = true;\n\n  // we have implemented the _read method, and done the other things\n  // that Readable wants before the first _read call, so unset the\n  // sync guard flag.\n  this._readableState.sync = false;\n\n  if (options) {\n    if (typeof options.transform === 'function') this._transform = options.transform;\n\n    if (typeof options.flush === 'function') this._flush = options.flush;\n  }\n\n  // When the writable side finishes, then flush out anything remaining.\n  this.on('prefinish', prefinish);\n}\n\nfunction prefinish() {\n  var _this = this;\n\n  if (typeof this._flush === 'function') {\n    this._flush(function (er, data) {\n      done(_this, er, data);\n    });\n  } else {\n    done(this, null, null);\n  }\n}\n\nTransform.prototype.push = function (chunk, encoding) {\n  this._transformState.needTransform = false;\n  return Duplex.prototype.push.call(this, chunk, encoding);\n};\n\n// This is the part where you do stuff!\n// override this function in implementation classes.\n// 'chunk' is an input chunk.\n//\n// Call `push(newChunk)` to pass along transformed output\n// to the readable side.  You may call 'push' zero or more times.\n//\n// Call `cb(err)` when you are done with this chunk.  If you pass\n// an error, then that'll put the hurt on the whole operation.  If you\n// never call cb(), then you'll never get another chunk.\nTransform.prototype._transform = function (chunk, encoding, cb) {\n  throw new Error('_transform() is not implemented');\n};\n\nTransform.prototype._write = function (chunk, encoding, cb) {\n  var ts = this._transformState;\n  ts.writecb = cb;\n  ts.writechunk = chunk;\n  ts.writeencoding = encoding;\n  if (!ts.transforming) {\n    var rs = this._readableState;\n    if (ts.needTransform || rs.needReadable || rs.length < rs.highWaterMark) this._read(rs.highWaterMark);\n  }\n};\n\n// Doesn't matter what the args are here.\n// _transform does all the work.\n// That we got here means that the readable side wants more data.\nTransform.prototype._read = function (n) {\n  var ts = this._transformState;\n\n  if (ts.writechunk !== null && ts.writecb && !ts.transforming) {\n    ts.transforming = true;\n    this._transform(ts.writechunk, ts.writeencoding, ts.afterTransform);\n  } else {\n    // mark that we need a transform, so that any data that comes in\n    // will get processed, now that we've asked for it.\n    ts.needTransform = true;\n  }\n};\n\nTransform.prototype._destroy = function (err, cb) {\n  var _this2 = this;\n\n  Duplex.prototype._destroy.call(this, err, function (err2) {\n    cb(err2);\n    _this2.emit('close');\n  });\n};\n\nfunction done(stream, er, data) {\n  if (er) return stream.emit('error', er);\n\n  if (data != null) // single equals check for both `null` and `undefined`\n    stream.push(data);\n\n  // if there's nothing in the write buffer, then that means\n  // that nothing more will ever be provided\n  if (stream._writableState.length) throw new Error('Calling transform done when ws.length != 0');\n\n  if (stream._transformState.transforming) throw new Error('Calling transform done when still transforming');\n\n  return stream.push(null);\n}","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && msCrypto.getRandomValues.bind(msCrypto));\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","/** @module SquareEdit/Controls */\n\nimport * as Contents from './Contents';\nimport * as Cursor from '../utils/Cursor';\nimport { setGroupingHighlight } from '../utils/Color';\nimport { unselect } from '../utils/SelectTools';\nimport InsertHandler from './InsertHandler';\nimport { NeumeEditInterface } from '../Interfaces';\n\n/**\n * Set listener on EditMode button.\n */\nexport function initEditModeControls (editMode: NeumeEditInterface) {\n  document.getElementById('edit_mode').addEventListener('click', function () {\n    document.getElementById('insert_controls').innerHTML += Contents.insertControlsPanel;\n    document.getElementById('edit_controls').innerHTML += Contents.editControlsPanel;\n    editMode.initEditMode();\n  });\n}\n\n/**\n * Bind listeners to insert tabs.'\n */\nexport function bindInsertTabs (insertHandler: InsertHandler) {\n  const insertTabs: Element[] = Array.from(document.getElementsByClassName('insertTab'));\n  const tabIds: string[] = insertTabs.map((tab) => { return tab.id; });\n\n  document.body.addEventListener('keydown', (evt: KeyboardEvent) => {\n    if (evt.code.match(/^Digit\\d$/) && evt.shiftKey) {\n      try {\n        const index = Number(evt.code[evt.code.length - 1]) - 1;\n        const insertOptions = document.getElementsByClassName('insertel');\n        const selectedOption = insertOptions[index];\n        deactivate('.insertel');\n        insertHandler.insertDisabled();\n        activate(selectedOption.id, insertHandler);\n        Cursor.updateCursor();\n      } catch (e) {\n        console.debug(e);\n      }\n    }\n  });\n\n  tabIds.forEach((tab) => {\n    document.getElementById(tab).addEventListener('click', () => {\n      deactivate('.insertTab');\n      activate(tab, insertHandler);\n      Cursor.resetCursor();\n      document.getElementById('insert_data').innerHTML = Contents.insertTabHtml[tab];\n      bindElements(insertHandler);\n      deactivate('.insertel');\n      const firstOption = document.getElementsByClassName('insertel')[0];\n      activate(firstOption.id, insertHandler);\n      Cursor.updateCursor();\n    });\n  });\n}\n\n/**\n * Initialize Edit and Insert control panels.\n */\nexport function initInsertEditControls () {\n  const toggleInsert = document.getElementById('toggleInsert');\n  const toggleEdit = document.getElementById('toggleEdit');\n  const insertContents = document.getElementById('insertContents');\n  const editContents = document.getElementById('editContents');\n  toggleInsert.addEventListener('click', () => {\n    if (insertContents.style.display === 'none') {\n      insertContents.style.display = '';\n      toggleInsert.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down');\n    } else {\n      insertContents.style.display = 'none';\n      toggleInsert.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-side');\n    }\n  });\n\n  toggleEdit.addEventListener('click', () => {\n    if (editContents.style.display === 'none') {\n      editContents.style.display = '';\n      toggleEdit.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down');\n    } else {\n      editContents.style.display = 'none';\n      toggleEdit.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-side');\n    }\n  });\n}\n\n/**\n * Activate a certain insert action.\n * @param id - The ID of the insert action tab.\n */\nfunction activate (id: string, insertHandler: InsertHandler) {\n  document.getElementById(id).classList.add('is-active');\n  if (document.getElementById(id).classList.contains('insertel')) {\n    insertHandler.insertActive(id);\n  }\n}\n\n/**\n * Deactivate a certain insert action.\n * @param type - A CSS selector for the action tab.\n */\nfunction deactivate (type: string) {\n  const elList = document.querySelectorAll(type);\n  elList.forEach(el => {\n    el.classList.remove('is-active');\n  });\n}\n\n/**\n * Bind listeners to insert tab elements.\n */\nfunction bindElements (insertHandler: InsertHandler) {\n  const insertElements = Array.from(document.getElementsByClassName('insertel'));\n  const elementIds = insertElements.map(el => el.id);\n  elementIds.forEach(el => {\n    document.getElementById(el).addEventListener('click', () => {\n      deactivate('.insertel');\n      activate(el, insertHandler);\n      Cursor.updateCursor();\n    });\n  });\n}\n\n/**\n * Set listeners on the buttons to change selection modes.\n */\nexport function initSelectionButtons () {\n  const selBySyl = document.getElementById('selBySyl');\n  const selByNeume = document.getElementById('selByNeume');\n  const selByNc = document.getElementById('selByNc');\n  const selByStaff = document.getElementById('selByStaff');\n\n  selBySyl.addEventListener('click', selectBySylHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '1') {\n      selectBySylHandler();\n    }\n  });\n\n  selByNeume.addEventListener('click', selectByNeumeHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '2') {\n      selectByNeumeHandler();\n    }\n  });\n\n  selByNc.addEventListener('click', selectByNcHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '3') {\n      selectByNcHandler();\n    }\n  });\n\n  selByStaff.addEventListener('click', selectByStaffHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '4') {\n      selectByStaffHandler();\n    }\n  });\n\n  function selectBySylHandler () {\n    if (!selBySyl.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      selBySyl.classList.add('is-active');\n      selByNeume.classList.remove('is-active');\n      selByNc.classList.remove('is-active');\n      selByStaff.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('syllable');\n        }\n      } catch (e) {}\n    }\n  }\n\n  function selectByNeumeHandler () {\n    if (!selByNeume.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      selByNeume.classList.add('is-active');\n      selByNc.classList.remove('is-active');\n      selBySyl.classList.remove('is-active');\n      selByStaff.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('neume');\n        }\n      } catch (e) {}\n    }\n  }\n\n  function selectByNcHandler () {\n    if (!selByNc.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      selByNc.classList.add('is-active');\n      selByNeume.classList.remove('is-active');\n      selBySyl.classList.remove('is-active');\n      selByStaff.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('neume');\n        }\n      } catch (e) {}\n    }\n  }\n\n  function selectByStaffHandler () {\n    if (!selByStaff.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      selByStaff.classList.add('is-active');\n      selByNeume.classList.remove('is-active');\n      selByNc.classList.remove('is-active');\n      selBySyl.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('staff');\n        }\n      } catch (e) {}\n    }\n  }\n}\n","import * as Contents from './Contents';\nimport * as Warnings from '../Warnings';\nimport * as Notification from '../utils/Notification';\nimport NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport { unsetVirgaAction, unsetInclinatumAction, removeHandler, deleteButtonHandler } from './SelectOptions';\n\n/**\n * The NeonView parent to access editor actions.\n */\nlet neonView: NeonView;\n\n/**\n * Set the neonView member.\n * @param {NeonView} view\n */\nexport function initNeonView (view: NeonView): void {\n  neonView = view;\n}\n\n/**\n * Trigger the grouping selection menu.\n * @param {string} type - The grouping type: nc, neume, syl, ligatureNc, or ligature\n */\nexport function triggerGrouping (type: string): void {\n  const moreEdit = document.getElementById('moreEdit');\n  moreEdit.classList.remove('is-invisible');\n  moreEdit.innerHTML += Contents.groupingMenu[type];\n  initGroupingListeners();\n}\n\n/**\n * Remove the grouping selection menu.\n */\nexport function endGroupingSelection (): void {\n  const moreEdit = document.getElementById('moreEdit');\n  moreEdit.innerHTML = '';\n  moreEdit.classList.add('is-invisible');\n  document.body.removeEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * The grouping dropdown listener.\n */\nexport function initGroupingListeners (): void {\n  const del = document.getElementById('delete');\n  del.removeEventListener('click', removeHandler);\n  del.addEventListener('click', removeHandler);\n  document.body.addEventListener('keydown', deleteButtonHandler);\n  try {\n    document.getElementById('mergeSyls').addEventListener('click', () => {\n      const elementIds = getChildrenIds().filter(e =>\n        document.getElementById(e).classList.contains('neume')\n      );\n      groupingAction('group', 'neume', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('groupNeumes').addEventListener('click', () => {\n      const elementIds = getIds();\n      groupingAction('group', 'neume', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('groupNcs').addEventListener('click', () => {\n      const elementIds = getIds();\n      groupingAction('group', 'nc', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('ungroupNeumes').addEventListener('click', () => {\n      const elementIds = getChildrenIds();\n      groupingAction('ungroup', 'neume', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('ungroupNcs').addEventListener('click', () => {\n      const elementIds = getChildrenIds();\n      groupingAction('ungroup', 'nc', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('toggle-ligature').addEventListener('click', async () => {\n      const elementIds = getIds();\n      let isLigature;\n      const ligatureRegex = /#E99[016]/;\n      if (!ligatureRegex.test(document.getElementById(elementIds[0]).children[0].getAttribute('xlink:href'))) { // SMUFL codes for ligature glyphs\n        isLigature = true;\n      } else {\n        isLigature = false;\n        const chainAction: EditorAction = { 'action': 'chain',\n          'param': [\n            unsetInclinatumAction(elementIds[0]), unsetVirgaAction(elementIds[0]),\n            unsetInclinatumAction(elementIds[1]), unsetVirgaAction(elementIds[1])\n          ] };\n        await neonView.edit(chainAction, neonView.view.getCurrentPageURI());\n      }\n\n      const editorAction: EditorAction = {\n        'action': 'toggleLigature',\n        'param': {\n          'elementIds': elementIds,\n          'isLigature': isLigature.toString()\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Ligature Toggled');\n        } else {\n          Notification.queueNotification('Ligature Toggle Failed');\n        }\n        endGroupingSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('toggle-link').addEventListener('click', () => {\n      const elementIds = getIds();\n      const chainAction: EditorAction = {\n        'action': 'chain',\n        'param': []\n      };\n      const param = new Array<EditorAction>();\n      if (document.getElementById(elementIds[0]).getAttribute('mei:precedes')) {\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[0],\n            'attrType': 'precedes',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[1],\n            'attrType': 'follows',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'setText',\n          'param': {\n            'elementId': elementIds[1],\n            'text': ''\n          }\n        });\n      } else if (document.getElementById(elementIds[0]).getAttribute('mei:follows')) {\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[0],\n            'attrType': 'follows',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[1],\n            'attrType': 'precedes',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'setText',\n          'param': {\n            'elementId': elementIds[0],\n            'text': ''\n          }\n        });\n      } else {\n        // Associate syllables. Will need to find which is first. Use staves.\n        const syllable0 = document.getElementById(elementIds[0]);\n        const syllable1 = document.getElementById(elementIds[1]);\n        const staff0 = syllable0.closest('.staff');\n        const staff1 = syllable1.closest('.staff');\n        const staffChildren = Array.from(staff0.parentElement.children).filter((elem: HTMLElement) => elem.classList.contains('staff'));\n\n        let firstSyllable, secondSyllable;\n        // Determine first syllable comes first by staff\n        if (staffChildren.indexOf(staff0) < staffChildren.indexOf(staff1)) {\n          firstSyllable = syllable0;\n          secondSyllable = syllable1;\n        } else {\n          firstSyllable = syllable1;\n          secondSyllable = syllable0;\n        }\n\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': firstSyllable.id,\n            'attrType': 'precedes',\n            'attrValue': secondSyllable.id\n          }\n        });\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': secondSyllable.id,\n            'attrType': 'follows',\n            'attrValue': firstSyllable.id\n          }\n        });\n        // Delete syl on second syllable\n        const syl = secondSyllable.querySelector('.syl');\n        if (syl !== null) {\n          param.push({\n            'action': 'remove',\n            'param': {\n              'elementId': syl.id\n            }\n          });\n        }\n      }\n      chainAction.param = param;\n      neonView.edit(chainAction, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Toggled Syllable Link');\n        } else {\n          Notification.queueNotification('Failed to Toggle Syllable Link');\n        }\n        endGroupingSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  } catch (e) {}\n}\n\n/**\n * Form and execute a group/ungroup action.\n * @param action - The action to execute. Either \"group\" or \"ungroup\".\n * @param groupType - The type of elements to group. Either \"neume\" or \"nc\".\n * @param elementIds - The IDs of the elements.\n */\nfunction groupingAction (action: string, groupType: string, elementIds: string[]): void {\n  const editorAction: EditorAction = {\n    'action': action,\n    'param': {\n      'groupType': groupType,\n      'elementIds': elementIds\n    }\n  };\n  neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then((result) => {\n    if (result) {\n      if (action === 'group') {\n        Notification.queueNotification('Grouping Success');\n      } else {\n        Notification.queueNotification('Ungrouping Success');\n      }\n    } else {\n      if (action === 'group') {\n        Notification.queueNotification('Grouping Failed');\n      } else {\n        Notification.queueNotification('Ungrouping Failed');\n      }\n    }\n    neonView.updateForCurrentPage();\n\n    // Prompt user to confirm if Neon does not re cognize contour\n    if (groupType === 'nc') {\n      const neumeParent = document.getElementById(elementIds[0]).parentElement;\n      const ncs = Array.from(neumeParent.children) as SVGGraphicsElement[];\n      const contour = neonView.info.getContour(ncs);\n      if (contour === undefined) {\n        Warnings.groupingNotRecognized();\n      }\n    }\n    endGroupingSelection();\n  });\n}\n\n/**\n * Get the IDs of selected elements.\n */\nfunction getIds (): string[] {\n  const ids = [];\n  const elements = Array.from(document.getElementsByClassName('selected'));\n  elements.forEach(el => {\n    ids.push(el.id);\n  });\n  return ids;\n}\n\n/**\n * Get the IDs of the selected elements' children.\n */\nfunction getChildrenIds (): string[] {\n  const childrenIds = [];\n  const elements = Array.from(document.getElementsByClassName('selected'));\n  elements.forEach(el => {\n    const children = Array.from(el.children);\n    children.forEach(ch => {\n      childrenIds.push(ch.id);\n    });\n  });\n  return childrenIds;\n}\n","import { getStaffBBox, selectBBox, selectStaff } from './SelectTools';\nimport NeonView from '../NeonView';\nimport DragHandler from './DragHandler';\n\nimport * as d3 from 'd3';\n\n/**\n * Resize a staff or a syllable text bounding box.\n * For staves, this also supports adjusting the skew.\n */\ntype Point = { x: number; y: number; name: number };\n\n/**\n * The points you can click and drag to resize\n */\nconst PointNames = {\n  TopLeft: 0,\n  Top: 1,\n  TopRight: 2,\n  Right: 3,\n  BottomRight: 4,\n  Bottom: 5,\n  BottomLeft: 6,\n  Left: 7\n};\n\nexport function resize (element: SVGGraphicsElement, neonView: NeonView, dragHandler: DragHandler): void {\n  /**\n   * The upper-left x-coordinate of the element.\n   */\n  let ulx: number;\n  /**\n   * The upper-left y-coordinate of the element.\n   */\n  let uly: number;\n  /**\n   * The lower-right x-coordinate of the element.\n   */\n  let lrx: number;\n  /**\n   * The lower-right y-coordinate of the element.\n   */\n  let lry: number;\n\n  /**\n   * The skew of the rect in radians.\n   */\n  let skew: number;\n\n  let initialPoint: number[], initialUly: number, initialLry: number, whichSkewPoint: string,\n    initialY: number, initialRectY: number, polyLen: number, dy: number, initialSkew: number;\n\n  drawInitialRect();\n  /**\n   * Draw the initial rectangle around the element\n   * and add the listeners to support dragging to resize.\n   */\n  function drawInitialRect (): void {\n    if (element === null) return;\n\n    // if it's a boundingbox just get the coordinates\n    if (element.classList.contains('syl')) {\n      const rect = element.querySelector('.sylTextRect-display');\n      if (rect === null) {\n        console.warn('Tried to draw resize rect for a sylTextRect that doesn\\'t exist (or isn\\'t displaying)');\n        return;\n      }\n      ulx = Number(rect.getAttribute('x'));\n      uly = Number(rect.getAttribute('y'));\n      lrx = +ulx + +rect.getAttribute('width');\n      lry = +uly + +rect.getAttribute('height');\n\n      skew = 0;\n    }\n\n    // if it's a staff use the paths to get it's boundingbox\n    if (element.classList.contains('staff')) {\n      const bbox = getStaffBBox(element);\n      ulx = bbox.ulx;\n      uly = bbox.uly;\n      lrx = bbox.lrx;\n      lry = bbox.lry;\n\n      const coordinates: number[] = element.querySelector('path')\n        .getAttribute('d')\n        .match(/\\d+/g)\n        .map(element => Number(element));\n      skew = Math.atan((coordinates[3] - coordinates[1]) /\n        (coordinates[2] - coordinates[0]));\n    }\n\n    let whichPoint: string;\n\n    const points: Array<Point> = [\n      { x: ulx, y: uly, name: PointNames.TopLeft },\n      { x: (ulx + lrx) / 2, y: uly + (lrx - ulx) / 2 * Math.sin(skew), name: PointNames.Top },\n      { x: lrx, y: uly + (lrx - ulx) * Math.sin(skew), name: PointNames.TopRight },\n      { x: lrx, y: (uly + lry + (lrx - ulx) * Math.sin(skew)) / 2, name: PointNames.Right },\n      { x: lrx, y: lry, name: PointNames.BottomRight },\n      { x: (ulx + lrx) / 2, y: lry - (lrx - ulx) / 2 * Math.sin(skew), name: PointNames.Bottom },\n      { x: ulx, y: lry - (lrx - ulx) * Math.sin(skew), name: PointNames.BottomLeft },\n      { x: ulx, y: (uly + lry - (lrx - ulx) * Math.sin(skew)) / 2, name: PointNames.Left }\n    ];\n\n    polyLen = points[2].x - points[0].x;\n\n    const pointString = points.filter((_elem, index) => { return index % 2 === 0; })\n      .map(elem => elem.x + ',' + elem.y)\n      .join(' ');\n\n    d3.select('#' + element.id).append('polygon')\n      .attr('points', pointString)\n      .attr('id', 'resizeRect')\n      .attr('stroke', 'black')\n      .attr('stroke-width', 10)\n      .attr('fill', 'none')\n      .style('cursor', 'move')\n      .style('stroke-dasharray', '20 10');\n\n    for (const pointName in PointNames) {\n      const point: Point = points[PointNames[pointName]];\n      d3.select(element.viewportElement).append('circle')\n        .attr('cx', point.x)\n        .attr('cy', point.y)\n        .attr('r', 25)\n        .attr('stroke', 'black')\n        .attr('stroke-width', 4)\n        .attr('fill', '#0099ff')\n        .attr('class', 'resizePoint')\n        .attr('id', 'p-' + pointName);\n    }\n\n    // do it as a loop instead of selectAll so that you can easily know which point was\n    for (const name in PointNames) {\n      d3.select('#p-' + name).filter('.resizePoint').call(\n        d3.drag()\n          .on('start', () => { resizeStart(name); })\n          .on('drag', resizeDrag)\n          .on('end', resizeEnd.bind(this)));\n    }\n\n    if (element.classList.contains('staff')) {\n      let x = points[3].x;\n      let y = points[3].y;\n      const pointStringRight = (x + 100) + ',' + (y + 85) + ' ' +\n        (x + 70) + ',' + (y + 50) + ' ' + (x + 100) + ',' + (y + 15) + ' ' + (x + 130) + ',' + (y + 50);\n      x = points[7].x;\n      y = points[7].y;\n      const pointStringLeft = (x - 100) + ',' + (y - 15) + ' ' +\n        (x - 130) + ',' + (y - 50) + ' ' + (x - 100) + ',' + (y - 85) + ' ' + (x - 70) + ',' + (y - 50);\n\n      d3.select('#' + element.id).append('polygon')\n        .attr('points', pointStringRight)\n        .attr('id', 'skewRight')\n        .attr('stroke', 'black')\n        .attr('stroke-width', 7)\n        .attr('fill', '#0099ff')\n        .attr('class', 'skewPoint');\n\n      d3.select('#' + element.id).append('polygon')\n        .attr('points', pointStringLeft)\n        .attr('id', 'skewLeft')\n        .attr('stroke', 'black')\n        .attr('stroke-width', 7)\n        .attr('fill', '#0099ff')\n        .attr('class', 'skewPoint');\n\n      d3.select('#skewLeft').call(\n        d3.drag()\n          .on('start', () => { skewStart('skewLeft'); })\n          .on('drag', skewDragLeft)\n          .on('end', skewEnd));\n\n      d3.select('#skewRight').call(\n        d3.drag()\n          .on('start', () => { skewStart('skewRight'); })\n          .on('drag', skewDragRight)\n          .on('end', skewEnd));\n    }\n\n    function skewStart (which: string): void {\n      const polygon = d3.select('#' + which);\n      const points = polygon.attr('points');\n      whichSkewPoint = which;\n      initialY = Number(points.split(' ')[0].split(',')[1]);\n      initialRectY = (which === 'skewRight' ? lry : uly);\n      initialSkew = skew;\n    }\n\n    function skewDragLeft (): void {\n      const currentY = d3.mouse(this)[1];\n      const temp = currentY - initialY;\n      const tempSkew = initialSkew - Math.atan(temp / polyLen);\n      if (tempSkew > -0.2 && tempSkew < 0.2) {\n        dy = temp;\n        uly = initialRectY + dy;\n        skew = tempSkew;\n      }\n      redraw();\n    }\n\n    function skewDragRight (): void {\n      const currentY = d3.mouse(this)[1];\n      const temp = currentY - initialY;\n      const tempSkew = initialSkew + Math.atan(temp / polyLen);\n      if (tempSkew > -0.2 && tempSkew < 0.2) {\n        dy = temp;\n        skew = tempSkew;\n        lry = initialRectY + dy;\n      }\n      redraw();\n    }\n\n    function skewEnd (): void {\n      const editorAction = {\n        'action': 'changeSkew',\n        'param': {\n          'elementId': element.id,\n          'dy': dy,\n          'rightSide': (whichSkewPoint === 'skewRight')\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then(async (result) => {\n        if (result) {\n          await neonView.updateForCurrentPagePromise();\n        }\n        element = document.getElementById(element.id) as unknown as SVGGraphicsElement;\n        ulx = undefined;\n        uly = undefined;\n        lrx = undefined;\n        lry = undefined;\n        drawInitialRect();\n        if (element.classList.contains('syl')) {\n          selectBBox(element.querySelector('.sylTextRect-display'), dragHandler, this);\n        } else {\n          selectStaff(element, dragHandler);\n        }\n      });\n    }\n\n    function resizeStart (name: string): void {\n      whichPoint = name;\n      const point = points.find(point => { return point.name === PointNames[name]; });\n      initialPoint = [point.x, point.y];\n      initialUly = uly;\n      initialLry = lry;\n    }\n\n    function resizeDrag (): void {\n      const currentPoint = d3.mouse(this);\n      switch (PointNames[whichPoint]) {\n        case PointNames.TopLeft:\n          ulx = currentPoint[0];\n          uly = currentPoint[1];\n          break;\n        case PointNames.Top:\n          uly = currentPoint[1] - (lrx - ulx) * Math.tan(skew) / 2;\n          break;\n        case PointNames.TopRight:\n          lrx = currentPoint[0];\n          uly = currentPoint[1] - (lrx - ulx) * Math.tan(skew);\n          break;\n        case PointNames.Right:\n          lrx = currentPoint[0];\n          lry = initialLry + (currentPoint[0] - initialPoint[0]) * Math.tan(skew);\n          break;\n        case PointNames.BottomRight:\n          lrx = currentPoint[0];\n          lry = currentPoint[1];\n          break;\n        case PointNames.Bottom:\n          lry = currentPoint[1] + (lrx - ulx) * Math.tan(skew) / 2;\n          break;\n        case PointNames.BottomLeft:\n          ulx = currentPoint[0];\n          lry = currentPoint[1] + (lrx - ulx) * Math.tan(skew);\n          break;\n        case PointNames.Left:\n          ulx = currentPoint[0];\n          uly = initialUly + (currentPoint[0] - initialPoint[0]) * Math.tan(skew);\n          break;\n        default:\n          console.error('Something that wasn\\'t a side of the rectangle was dragged. This shouldn\\'t happen.');\n      }\n      redraw();\n    }\n\n    function resizeEnd (): void {\n      const editorAction = {\n        'action': 'resize',\n        'param': {\n          'elementId': element.id,\n          'ulx': ulx,\n          'uly': uly,\n          'lrx': lrx,\n          'lry': lry\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then(async (result) => {\n        if (result) {\n          await neonView.updateForCurrentPagePromise();\n        }\n        element = document.getElementById(element.id) as unknown as SVGGraphicsElement;\n        ulx = undefined;\n        uly = undefined;\n        lrx = undefined;\n        lry = undefined;\n        if (element.classList.contains('syl')) {\n          selectBBox(element.querySelector('.sylTextRect-display'), dragHandler, this);\n        } else {\n          selectStaff(element, dragHandler);\n        }\n        d3.selectAll('.resizePoint').remove();\n        d3.selectAll('#resizeRect').remove();\n        d3.selectAll('.skewPoint').remove();\n        drawInitialRect();\n      });\n    }\n  }\n\n  /**\n   * Redraw the rectangle with the new bounds\n   */\n  function redraw (): void {\n    const points: Point[] = [\n      { x: ulx, y: uly, name: PointNames.TopLeft },\n      { x: (ulx + lrx) / 2, y: uly + (lrx - ulx) / 2 * Math.sin(skew), name: PointNames.Top },\n      { x: lrx, y: uly + (lrx - ulx) * Math.sin(skew), name: PointNames.TopRight },\n      { x: lrx, y: (uly + lry + (lrx - ulx) * Math.sin(skew)) / 2, name: PointNames.Right },\n      { x: lrx, y: lry, name: PointNames.BottomRight },\n      { x: (ulx + lrx) / 2, y: lry - (lrx - ulx) / 2 * Math.sin(skew), name: PointNames.Bottom },\n      { x: ulx, y: lry - (lrx - ulx) * Math.sin(skew), name: PointNames.BottomLeft },\n      { x: ulx, y: (uly + lry - (lrx - ulx) * Math.sin(skew)) / 2, name: PointNames.Left }\n    ];\n\n    const pointString: string = points.filter((_elem, index) => { return index % 2 === 0; })\n      .map(elem => elem.x + ',' + elem.y)\n      .join(' ');\n\n    d3.select('#resizeRect').attr('points', pointString);\n\n    for (const pointName in PointNames) {\n      const point: Point = points[PointNames[pointName]];\n      d3.select('#p-' + pointName).filter('.resizePoint')\n        .attr('cx', point.x)\n        .attr('cy', point.y);\n    }\n\n    let x = points[3].x;\n    let y = points[3].y;\n    const pointStringRight = (x + 100) + ',' + (y + 85) + ' ' +\n      (x + 70) + ',' + (y + 50) + ' ' + (x + 100) + ',' + (y + 15) + ' ' + (x + 130) + ',' + (y + 50);\n    x = points[7].x;\n    y = points[7].y;\n    const pointStringLeft = (x - 100) + ',' + (y - 15) + ' ' +\n      (x - 130) + ',' + (y - 50) + ' ' + (x - 100) + ',' + (y - 85) + ' ' + (x - 70) + ',' + (y - 50);\n\n    d3.select('#skewLeft').attr('points', pointStringLeft);\n    d3.select('#skewRight').attr('points', pointStringRight);\n  }\n}\n","import * as Cursor from '../utils/Cursor';\nimport NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport * as d3 from 'd3';\n\n/**\n * Class that handles insert mode, events, and actions.\n */\nclass InsertHandler {\n  type: string;\n  firstClick = true;\n  coord: DOMPoint;\n  attributes: object;\n  selector: string;\n  neonView: NeonView;\n\n  constructor (neonView: NeonView, sel: string) {\n    this.neonView = neonView;\n    this.selector = sel;\n  }\n\n  /**\n   * Called when an insert button is clicked.\n   * Triggers the start of insert mode.\n   * @param buttonId - The ID of the button that was clicked.\n   */\n  insertActive (buttonId: string): void {\n    const alreadyInInsertMode = this.isInsertMode();\n    switch (buttonId) {\n      case 'punctum':\n        this.type = 'nc';\n        this.attributes = null;\n        break;\n      case 'diamond':\n        this.type = 'nc';\n        this.attributes = { 'tilt': 'se' };\n        break;\n      case 'virga':\n        this.type = 'nc';\n        this.attributes = { 'tilt': 'n' };\n        break;\n      case 'pes':\n      case 'clivis':\n      case 'scandicus':\n      case 'climacus':\n      case 'torculus':\n      case 'porrectus':\n      case 'pressus':\n        const contour = this.neonView.info.getContourByValue(\n          buttonId.charAt(0).toUpperCase() + buttonId.slice(1)\n        );\n        this.type = 'grouping';\n        this.attributes = { 'contour': contour };\n        break;\n      case 'cClef':\n      case 'fClef':\n        this.type = 'clef';\n        this.attributes = { 'shape': buttonId.charAt(0).toUpperCase() };\n        break;\n      case 'custos':\n        this.type = 'custos';\n        this.attributes = null;\n        break;\n      case 'staff':\n        this.type = 'staff';\n        this.attributes = null;\n        break;\n      default:\n        this.type = '';\n        this.attributes = null;\n        console.error('Invalid button for insertion: ' + buttonId + '.');\n        return;\n    }\n\n    this.removeInsertClickHandlers();\n    if (this.type === 'staff') {\n      document.querySelector(this.selector)\n        .addEventListener('click', this.staffHandler);\n    } else {\n      document.querySelector(this.selector)\n        .addEventListener('click', this.handler);\n    }\n\n    // Disable edit mode listeners\n    document.body.addEventListener('keydown', this.keydownListener);\n    document.body.addEventListener('keyup', this.resetInsertHandler);\n    document.body.addEventListener('click', this.clickawayHandler);\n\n    // Add 'return to edit mode' button\n    if (!alreadyInInsertMode) {\n      const editModeButton = document.createElement('button');\n      editModeButton.id = 'returnToEditMode';\n      editModeButton.classList.add('button');\n      editModeButton.innerHTML = 'Return to Edit Mode';\n      document.getElementById('redo').parentNode.appendChild(editModeButton);\n      editModeButton.addEventListener('click', this.insertDisabled);\n    }\n    const editMenu = document.getElementById('editMenu');\n    editMenu.style.backgroundColor = 'whitesmoke';\n    editMenu.style.fontWeight = '';\n    const insertMenu = document.getElementById('insertMenu');\n    insertMenu.style.backgroundColor = '#ffc7c7';\n    insertMenu.style.fontWeight = 'bold';\n  }\n\n  /**\n   * Disable insert mode and remove event listeners.\n   */\n  insertDisabled = (function insertDisabled (): void {\n    this.type = '';\n    this.removeInsertClickHandlers();\n    document.body.removeEventListener('keydown', this.keydownListener);\n    document.body.removeEventListener('keyup', this.resetInsertHandler);\n    document.body.removeEventListener('click', this.clickawayHandler);\n    document.querySelector('.insertel.is-active').classList.remove('is-active');\n    this.firstClick = true;\n    Cursor.resetCursor();\n    try {\n      document.getElementById('returnToEditMode').remove();\n    } catch (e) {\n      // console.debug(e);\n    }\n    const editMenu = document.getElementById('editMenu');\n    const insertMenu = document.getElementById('insertMenu');\n    editMenu.style.backgroundColor = '#ffc7c7';\n    editMenu.style.fontWeight = 'bold';\n    insertMenu.style.backgroundColor = 'whitesmoke';\n    insertMenu.style.fontWeight = '';\n  }).bind(this);\n\n  /**\n   * Event handler to handle a user clicking away from the active page\n   * causing insert mode to end.\n   */\n  clickawayHandler = (function clickawayHandler (evt: MouseEvent): void {\n    const target = evt.target as HTMLElement;\n    if (target.closest('.active-page') === null &&\n      target.closest('#insert_controls') === null &&\n      target.closest('#svg_group') === null) {\n      this.insertDisabled();\n      document.body.removeEventListener('keydown',\n        this.staffHandler);\n      document.body.removeEventListener('keydown',\n        this.handler);\n    }\n  }).bind(this);\n\n  /**\n   * Resets an insert event listener after temporarily removing it.\n   */\n  resetInsertHandler = (function resetInsertHandler (evt: KeyboardEvent): void {\n    if (evt.key === 'Shift') {\n      document.querySelector(this.selector)\n        .addEventListener('click', this.type === 'staff' ?\n          this.staffHandler : this.handler);\n    }\n  }).bind(this);\n\n  /**\n   * Listens to key presses to either exit edit mode (if Escape) or\n   * temporarily remove insert event listeners (if Shift).\n   */\n  keydownListener = (function keydownListener (evt: KeyboardEvent): void {\n    if (evt.key === 'Escape') {\n      this.insertDisabled();\n      document.body.removeEventListener('keydown', this.staffHandler);\n      document.body.removeEventListener('keydown', this.handler);\n    } else if (evt.key === 'Shift') {\n      this.removeInsertClickHandlers();\n    }\n  }).bind(this);\n\n  /**\n   * Event handler for clicking to insert any element except a staff.\n   */\n  handler = (function handler (evt: MouseEvent): void {\n    evt.stopPropagation();\n    const container = document.getElementsByClassName('active-page')[0].getElementsByClassName('definition-scale')[0] as SVGSVGElement;\n    const pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n    // Transform pt to SVG context\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGraphicsElement).getScreenCTM();\n    const cursorpt = pt.matrixTransform(transformMatrix.inverse());\n\n    const editorAction: EditorAction = {\n      'action': 'insert',\n      'param': {\n        'elementType': this.type,\n        'staffId': 'auto',\n        'ulx': cursorpt.x,\n        'uly': cursorpt.y\n      }\n    };\n\n    if (this.attributes !== null) {\n      editorAction['param']['attributes'] = this.attributes;\n      if (this.attributes['shape'] === 'F') {\n        editorAction['param']['ulx'] -= 50;\n      }\n    }\n\n    this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then(() => {\n      return this.neonView.updateForCurrentPagePromise();\n    }).then(() => {\n      document.querySelector(this.selector).addEventListener('click', this.handler);\n    });\n  }).bind(this);\n\n  /**\n   * Event handler to insert a staff.\n   */\n  staffHandler = (function staffHandler (evt: MouseEvent): void {\n    const container = document.getElementsByClassName('active-page')[0].getElementsByClassName('definition-scale')[0] as SVGSVGElement;\n    const pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGraphicsElement).getScreenCTM();\n    const cursorpt = pt.matrixTransform(transformMatrix.inverse());\n\n    if (this.firstClick) {\n      this.coord = cursorpt;\n      d3.select(container).append('circle').attr('cx', cursorpt.x)\n        .attr('cy', cursorpt.y)\n        .attr('r', 10)\n        .attr('id', 'staff-circle')\n        .attr('fill', 'green');\n      this.firstClick = false;\n    } else {\n      let ul, lr;\n      if (cursorpt.x < this.coord.x || cursorpt.y < this.coord.y) { // second point is not lr\n        ul = cursorpt;\n        lr = this.coord;\n      } else {\n        ul = this.coord;\n        lr = cursorpt;\n      }\n      document.getElementById('staff-circle').remove();\n      const action: EditorAction = {\n        'action': 'insert',\n        'param': {\n          'elementType': 'staff',\n          'staffId': 'auto',\n          'ulx': ul.x,\n          'uly': ul.y,\n          'lrx': lr.x,\n          'lry': lr.y\n        }\n      };\n\n      this.neonView.edit(action, this.neonView.view.getCurrentPageURI()).then(() => {\n        this.neonView.updateForCurrentPage();\n        this.firstClick = true;\n      });\n    }\n  }).bind(this);\n\n  /**\n   * Remove the insert listeners while not leaving insert mode entirely.\n   */\n  removeInsertClickHandlers = (function removeInsertClickHandlers (): void {\n    document.querySelector(this.selector).removeEventListener('click', this.staffHandler);\n    document.querySelector(this.selector).removeEventListener('click', this.handler);\n  }).bind(this);\n\n  isInsertMode (): boolean {\n    return (this.type !== '');\n  }\n}\nexport { InsertHandler as default };\n","import NeonView from '../../src/NeonView';\nimport DisplayPanel from '../../src/DisplayPanel/DisplayPanel';\nimport DivaView from '../../src/DivaView';\nimport SingleView from '../../src/SingleView/SingleView';\nimport DivaEdit from '../../src/SquareEdit/DivaEditMode';\nimport SingleEditMode from '../../src/SquareEdit/SingleEditMode';\nimport InfoModule from '../../src/InfoModule';\nimport TextView from '../../src/TextView';\nimport TextEditMode from '../../src/TextEditMode';\n\nimport PouchDB from 'pouchdb';\n\nlet name = getGetParam('manifest');\nlet manifestLocation = 'manifests/' + name + '.jsonld';\nlet storage = getGetParam('storage');\n\nif (name) {\n  window.fetch(manifestLocation).then(response => {\n    if (response.ok) {\n      return response.text();\n    } else {\n      throw new Error(response.statusText);\n    }\n  }).then(async text => {\n    let manifest;\n    try {\n      manifest = JSON.parse(text);\n    } catch (e) {\n      console.error(e);\n      console.debug(text);\n      return;\n    }\n    let params = {\n      manifest: manifest,\n      Display: DisplayPanel,\n      Info: InfoModule,\n      TextView: TextView,\n      TextEdit: TextEditMode\n    };\n    // Determine if it is a single page or multiple by media type\n    let mediaType = await new Promise((resolve, reject) => {\n      window.fetch(manifest.image).then(response => {\n        resolve(response.headers.get('Content-Type'));\n      }).catch(err => {\n        reject(err);\n      });\n    });\n    if (mediaType.match(/image\\/*/)) {\n      params.View = SingleView;\n      params.NeumeEdit = SingleEditMode;\n    } else {\n      params.View = DivaView;\n      params.NeumeEdit = DivaEdit;\n    }\n\n    var view = new NeonView(params);\n    view.start();\n  });\n} else {\n  let db = new PouchDB('Neon-User-Storage');\n  db.getAttachment(storage, 'manifest').then(blob => {\n    return new window.Response(blob).json();\n  }).then(async manifest => {\n    console.log(manifest);\n    let params = {\n      manifest: manifest,\n      Display: DisplayPanel,\n      Info: InfoModule,\n      TextView: TextView,\n      TextEdit: TextEditMode\n    };\n\n    let mediaType = await new Promise((resolve, reject) => {\n      window.fetch(manifest.image).then(response => {\n        resolve(response.headers.get('Content-Type'));\n      }).catch(err => {\n        reject(err);\n      });\n    });\n    if (mediaType.match(/image\\/*/)) {\n      params.View = SingleView;\n      params.NeumeEdit = SingleEditMode;\n    } else {\n      params.View = DivaView;\n      params.NeumeEdit = DivaEdit;\n    }\n\n    var view = new NeonView(params);\n    view.start();\n  });\n}\n\nfunction getGetParam (paramName) {\n  let result = null;\n\n  let tmp = [];\n  window.location.search\n    .substr(1)\n    .split('&')\n    .forEach((item) => {\n      tmp = item.split('=');\n      if (tmp[0] === paramName) {\n        result = decodeURIComponent(tmp[1]);\n      }\n    });\n  return result;\n}\n","import { convertSbToStaff } from './utils/ConvertMei';\nimport * as Validation from './Validation';\nimport VerovioWrapper from './VerovioWrapper';\nimport { WebAnnotation, Attributes, EditorAction, NeonManifest, VerovioMessage } from './Types';\nimport { uuidv4 } from './utils/random';\n\nimport PouchDB from 'pouchdb';\n\ninterface CacheEntry {\n  dirty: boolean;\n  mei: string;\n  svg: SVGSVGElement;\n}\n\n/**\n * The core component of Neon. This manages the database,\n * the verovio toolkit, the cache, and undo/redo stacks.\n */\nclass NeonCore {\n  /** Wrapper for the Verovio WebWorker. */\n  private verovioWrapper: VerovioWrapper;\n  /** Stacks of actions that can be undone per page. */\n  private undoStacks: Map<string, string[]>;\n  /** Stacks of actions that can be redone per page. */\n  private redoStacks: Map<string, string[]>;\n  /** Cache containing entries for each page. */\n  private neonCache: Map<string, CacheEntry>;\n  private db: PouchDB.Database;\n  private parser: DOMParser;\n  /** Pages known not to have any associated MEI. */\n  private blankPages: Array<string>;\n  /** A collection of W3 Web Annotations. */\n  private annotations: WebAnnotation[];\n  private manifest: NeonManifest;\n  private lastPageLoaded: string;\n\n  getAnnotations (): WebAnnotation[] { return this.annotations; }\n\n  /**\n   * Constructor for NeonCore\n   */\n  constructor (manifest: NeonManifest) {\n    this.verovioWrapper = new VerovioWrapper();\n    Validation.init();\n\n    /**\n     * Stacks of previous MEI files representing actions that can be undone for each page.\n     * @type {Map.<string, Array.<string>>}\n     */\n    this.undoStacks = new Map<string, string[]>();\n\n    /**\n     * Stacks of previous MEI files representing actions that can be redone for each page.\n     * @type {Map.<string, Array.<string>>}\n     */\n    this.redoStacks = new Map();\n\n    this.neonCache = new Map();\n\n    this.parser = new DOMParser();\n\n    this.db = new PouchDB('Neon');\n\n    this.blankPages = [];\n\n    // Add each MEI to the database\n    this.manifest = manifest;\n    this.annotations = manifest.mei_annotations;\n    this.lastPageLoaded = '';\n  }\n\n  /**\n   * Initialize the PouchDb database based on the provided manifest.\n   * If a newer version already exists in the database, this will\n   * not update the database unless forced.\n   * @param force - If a database update should be forced.\n   */\n  async initDb (force = false): Promise<{}> {\n    // Check for existing manifest\n    type DbAnnotation = PouchDB.Core.IdMeta & PouchDB.Core.GetMeta & WebAnnotation;\n    type Doc = PouchDB.Core.IdMeta & PouchDB.Core.GetMeta & { timestamp: string; annotations: string[]};\n    const response = await new Promise<{}>((resolve, reject): void => {\n      this.db.get(this.manifest['@id']).catch(err => {\n        if (err.name === 'not_found') {\n          // This is a new document.\n          const doc = {\n            _id: this.manifest['@id'],\n            timestamp: this.manifest.timestamp,\n            image: this.manifest.image,\n            title: this.manifest.title,\n            annotations: []\n          };\n          this.annotations.forEach(annotation => {\n            doc.annotations.push(annotation.id);\n          });\n          return doc;\n        } else {\n          console.error(err);\n          return reject(err);\n        }\n      }).then(async (doc: Doc) => {\n        // Check if doc timestamp is newer than manifest\n        const docTime = (new Date(doc.timestamp)).getTime();\n        const manTime = (new Date(this.manifest.timestamp)).getTime();\n        if (docTime > manTime) {\n          if (!force) {\n            // Fill annotations list with db annotations\n            this.annotations = [];\n            doc.annotations.forEach(async (id: string) => {\n              await this.db.get(id).then((annotation: DbAnnotation) => {\n                this.annotations.push({\n                  id: annotation._id,\n                  type: 'Annotation',\n                  body: annotation.body,\n                  target: annotation.target\n                });\n              }).catch(err => {\n                console.error(err);\n              });\n            });\n            return resolve(false);\n          }\n        }\n        for (const annotation of this.annotations) {\n          // Add annotations to database\n          await this.db.get(annotation.id).catch(err => {\n            if (err.name === 'not_found') {\n              return {\n                _id: annotation.id\n              };\n            } else {\n              console.error(err);\n              return reject(err);\n            }\n          }).then((newAnnotation: DbAnnotation) => {\n            newAnnotation.body = annotation.body;\n            newAnnotation.target = annotation.target;\n            return this.db.put(newAnnotation);\n          }).catch(err => {\n            reject(err);\n            console.error(err);\n          });\n        }\n        return this.db.put(doc);\n      }).then(() => {\n        return resolve(true);\n      }).catch(err => {\n        reject(err);\n        console.error(err);\n      });\n    });\n\n    return response;\n  }\n\n  /**\n   * Load a page into the verovio toolkit. This will fetch the\n   * page from the cache or from the database.\n   * @param pageURI - The URI of the selected page.\n   */\n  loadPage (pageURI: string): Promise<CacheEntry> {\n    return new Promise((resolve, reject): void => {\n      if (this.lastPageLoaded === pageURI && this.neonCache.has(pageURI)) {\n        resolve(this.neonCache.get(pageURI));\n      } else if (this.neonCache.has(pageURI)) {\n        this.loadData(pageURI, this.neonCache.get(pageURI).mei).then(() => {\n          resolve(this.neonCache.get(pageURI));\n        });\n      } else if (this.blankPages.includes(pageURI)) {\n        Validation.blankPage();\n        const e = new Error('No MEI file for page ' + pageURI);\n        e.name = 'missing_mei';\n        reject(e);\n      } else {\n        // Find annotation\n        const annotation = this.annotations.find(elem => {\n          return elem.target === pageURI;\n        });\n        if (annotation) {\n          window.fetch(annotation.body).then(response => {\n            if (response.ok) {\n              return response.text();\n            } else {\n              throw new Error(response.statusText);\n            }\n          }).then(data => {\n            // Check if the MEI file is sb-based. If so, convert to staff-based.\n            if (data.match(/<sb .+>/)) {\n              data = convertSbToStaff(data);\n            }\n            this.loadData(pageURI, data).then(() => {\n              resolve(this.neonCache.get(pageURI));\n            });\n          }).catch(err => {\n            reject(err);\n          });\n        } else {\n          Validation.blankPage();\n          this.blankPages.push(pageURI);\n        }\n      }\n    });\n  }\n\n  /**\n   * Load data into the verovio toolkit and update the cache.\n   * @param pageURI - The URI of the selected page.\n   * @param data - The MEI of the page as a string.\n   * @param dirty - If the cache entry should be marked as dirty.\n   */\n  loadData (pageURI: string, data: string, dirty = false): Promise<void> {\n    Validation.sendForValidation(data);\n    this.lastPageLoaded = pageURI;\n    /* A promise is returned that will resolve to the result of the action.\n     * However the value that is must return comes from the Web Worker and\n     * information passed between the worker and main context much be in a\n     * message. So an event handler is put on verovioWrapper for when a message\n     * is receieved from the worker. Then a message is sent to the worker to\n     * take an action. A response is sent back and the previously mentioned\n     * event handler handles the response. Since it is defined within the\n     * promise it has access to the necessary resolve function.\n     */\n    return new Promise((resolve): void => {\n      const message: VerovioMessage = {\n        id: uuidv4(),\n        action: 'renderData',\n        mei: data\n      };\n      function handle (evt: MessageEvent): void {\n        if (evt.data.id === message.id) {\n          const svg = this.parser.parseFromString(\n            evt.data.svg,\n            'image/svg+xml'\n          ).documentElement;\n          this.neonCache.set(pageURI, {\n            svg: svg,\n            mei: data,\n            dirty: dirty\n          });\n          evt.target.removeEventListener('message', handle);\n          resolve();\n        }\n      }\n      this.verovioWrapper.addEventListener('message', handle.bind(this));\n      this.verovioWrapper.postMessage(message);\n    });\n  }\n\n  /**\n   * Get the SVG for a specific page.\n   * @param pageURI - The URI of the selected page.\n   */\n  getSVG (pageURI: string): Promise<SVGSVGElement> {\n    return new Promise((resolve, reject): void => {\n      this.loadPage(pageURI).then((entry) => {\n        resolve(entry.svg);\n      }).catch((err) => { reject(err); });\n    });\n  }\n\n  /**\n   * Get the MEI for a specific page.\n   * @param pageURI - The URI of the selected page.\n   */\n  getMEI (pageURI: string): Promise<string> {\n    return new Promise((resolve, reject): void => {\n      this.loadPage(pageURI).then((entry) => {\n        resolve(entry.mei);\n      }).catch((err) => { reject(err); });\n    });\n  }\n\n  /**\n   * Get musical element attributes from the verovio toolkit.\n   * @param elementId - The unique ID of the musical element.\n   * @param pageURI - The URI of the selected page.\n   */\n  getElementAttr (elementId: string, pageURI: string): Promise<Attributes> {\n    return new Promise((resolve): void => {\n      this.loadPage(pageURI).then(() => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'getElementAttr',\n          elementId: elementId\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            evt.target.removeEventListener('message', handle);\n            resolve(evt.data.attributes);\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n    });\n  }\n\n  /**\n   * Perform an editor action on a specific page.\n   * @param action - The editor toolkit action object.\n   * @param pageURI - The URI of the selected page.\n   */\n  edit (editorAction: EditorAction, pageURI: string): Promise<boolean> {\n    let promise: Promise<CacheEntry>;\n    if (this.lastPageLoaded === pageURI) {\n      promise = Promise.resolve(this.neonCache.get(pageURI));\n    } else {\n      promise = this.loadPage(pageURI);\n    }\n    return new Promise((resolve): void => {\n      promise.then(entry => {\n        const currentMEI = entry.mei;\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'edit',\n          editorAction: editorAction\n        };\n        function handle (evt: MessageEvent): void {\n          if (evt.data.id === message.id) {\n            if (evt.data.result) {\n              if (!this.undoStacks.has(pageURI)) {\n                this.undoStacks.set(pageURI, []);\n              }\n              this.undoStacks.get(pageURI).push(currentMEI);\n              this.redoStacks.set(pageURI, []);\n            }\n            evt.target.removeEventListener('message', handle);\n            this.updateCache(pageURI).then(() => { resolve(evt.data.result); });\n          }\n        }\n        this.verovioWrapper.addEventListener('message', handle.bind(this));\n        this.verovioWrapper.postMessage(message);\n      });\n    });\n  }\n\n  /**\n   * Update contents of the cache using information in verovio toolkit.\n   * @param pageURI - Page to be updated in cache.\n   * @param dirty - If the entry should be marked as dirty\n   */\n  updateCache (pageURI: string, dirty: boolean): Promise<void> {\n    return new Promise((resolve): void => {\n      // Must get MEI and then get SVG then finish.\n      let mei: string, svgText: string;\n      const meiPromise = new Promise((resolve): void => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'getMEI'\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            mei = evt.data.mei;\n            evt.target.removeEventListener('message', handle);\n            resolve();\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n      const svgPromise = new Promise((resolve): void => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'renderToSVG'\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            svgText = evt.data.svg;\n            evt.target.removeEventListener('message', handle);\n            resolve();\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n\n      meiPromise.then(() => { return svgPromise; }).then(() => {\n        const svg = this.parser.parseFromString(\n          svgText,\n          'image/svg+xml'\n        ).documentElement as unknown as SVGSVGElement;\n        this.neonCache.set(pageURI, {\n          mei: mei,\n          svg: svg,\n          dirty: dirty\n        });\n        resolve();\n      });\n    });\n  }\n\n  /**\n   * Get the edit info string from the verovio toolkit.\n   * @param pageURI - The URI of the page to get the edit info string from.\n   */\n  info (pageURI: string): Promise<string> {\n    let promise: Promise<CacheEntry | void>;\n    if (this.lastPageLoaded === pageURI) {\n      promise = Promise.resolve();\n    } else {\n      promise = this.loadPage(pageURI);\n    }\n    return new Promise((resolve): void => {\n      promise.then(() => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'editInfo'\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            evt.target.removeEventListener('message', handle);\n            resolve(JSON.parse(evt.data.info));\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n    });\n  }\n\n  /**\n   * Undo the last action performed on a specific page.\n   * @param pageURI - The URI of the selected page.\n   * @returns If the action was undone.\n   */\n  undo (pageURI: string): Promise<boolean> {\n    return new Promise((resolve): void => {\n      if (this.undoStacks.has(pageURI)) {\n        const state = this.undoStacks.get(pageURI).pop();\n        if (state !== undefined) {\n          this.getMEI(pageURI).then(mei => {\n            this.redoStacks.get(pageURI).push(mei);\n            return this.loadData(pageURI, state, true);\n          }).then(() => {\n            resolve(true);\n          });\n          return;\n        }\n      }\n      resolve(false);\n    });\n  }\n\n  /**\n   * Redo the last action performed on a page.\n   * @param pageURI - The page URI.\n   * @returns If the action was redone.\n   */\n  redo (pageURI: string): Promise<boolean> {\n    return new Promise((resolve): void => {\n      if (this.redoStacks.has(pageURI)) {\n        const state = this.redoStacks.get(pageURI).pop();\n        if (state !== undefined) {\n          this.getMEI(pageURI).then((mei) => {\n            this.undoStacks.get(pageURI).push(mei);\n            return this.loadData(pageURI, state, true);\n          }).then(() => {\n            resolve(true);\n          });\n          return;\n        }\n      }\n      resolve(false);\n    });\n  }\n\n  /**\n   * Update the PouchDb database stored in the browser.\n   * This is based on the data stored in the cache. To save time,\n   * only entries marked as dirty will be updated.\n   */\n  async updateDatabase (): Promise<void> {\n    type Doc = PouchDB.Core.GetMeta & PouchDB.Core.IdMeta & { body: string; timestamp: string };\n    let updateTimestamp = false;\n    for (const pair of this.neonCache) {\n      const key = pair[0];\n      const value = pair[1];\n      if (value.dirty) {\n        updateTimestamp = true;\n        const index = this.annotations.findIndex(elem => { return elem.target === key; });\n        // try to update server with PUT (if applicable\n        // only attempt if not a data URI\n        let uri: string;\n        if (!this.annotations[index].body.match(/^data:/)) {\n          await window.fetch(this.annotations[index].body,\n            {\n              method: 'PUT',\n              headers: { 'Content-Type': 'application/mei+xml' },\n              body: value.mei\n            }\n          ).then(response => {\n            if (response.ok) {\n              uri = this.annotations[index].body;\n            } else {\n              uri = 'data:application/mei+xml;base64,' + window.btoa(value.mei);\n            }\n          }).catch(err => {\n            console.error(err);\n            console.warn('Falling back to data URI');\n            uri = 'data:application/mei+xml;base64,' + window.btoa(value.mei);\n          });\n        } else {\n          uri = 'data:application/mei+xml;base64,' + window.btoa(value.mei);\n        }\n        // Update URI in annotations, database\n        this.annotations[index].body = uri;\n        await this.db.get(this.annotations[index].id).then((doc: Doc) => {\n          doc.body = uri;\n          return this.db.put(doc);\n        }).then(() => {\n          value.dirty = false;\n        }).catch(err => {\n          console.error(err);\n        });\n      }\n    }\n\n    if (updateTimestamp) {\n      await this.db.get(this.manifest['@id']).then((doc: Doc) => {\n        doc.timestamp = (new Date()).toISOString();\n        return this.db.put(doc);\n      }).catch(err => {\n        console.error(err);\n      });\n    }\n  }\n\n  /** Completely remove the database. */\n  deleteDb (): Promise<void> {\n    return this.db.destroy();\n  }\n}\n\nexport { NeonCore as default };\n","/**\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\nvar sprintf = require('./sprintf').sprintf;\n\nvar utils = require('./utils');\nvar SyntaxError = require('./errors').SyntaxError;\n\nvar _cache = {};\n\nvar RE = new RegExp(\n  \"(\" +\n  \"'[^']*'|\\\"[^\\\"]*\\\"|\" +\n  \"::|\" +\n  \"//?|\" +\n  \"\\\\.\\\\.|\" +\n  \"\\\\(\\\\)|\" +\n  \"[/.*:\\\\[\\\\]\\\\(\\\\)@=])|\" +\n  \"((?:\\\\{[^}]+\\\\})?[^/\\\\[\\\\]\\\\(\\\\)@=\\\\s]+)|\" +\n  \"\\\\s+\", 'g'\n);\n\nvar xpath_tokenizer = utils.findall.bind(null, RE);\n\nfunction prepare_tag(next, token) {\n  var tag = token[0];\n\n  function select(context, result) {\n    var i, len, elem, rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      elem._children.forEach(function(e) {\n        if (e.tag === tag) {\n          rv.push(e);\n        }\n      });\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_star(next, token) {\n  function select(context, result) {\n    var i, len, elem, rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      elem._children.forEach(function(e) {\n        rv.push(e);\n      });\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_dot(next, token) {\n  function select(context, result) {\n    var i, len, elem, rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      rv.push(elem);\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_iter(next, token) {\n  var tag;\n  token = next();\n\n  if (token[1] === '*') {\n    tag = '*';\n  }\n  else if (!token[1]) {\n    tag = token[0] || '';\n  }\n  else {\n    throw new SyntaxError(token);\n  }\n\n  function select(context, result) {\n    var i, len, elem, rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      elem.iter(tag, function(e) {\n        if (e !== elem) {\n          rv.push(e);\n        }\n      });\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_dot_dot(next, token) {\n  function select(context, result) {\n    var i, len, elem, rv = [], parent_map = context.parent_map;\n\n    if (!parent_map) {\n      context.parent_map = parent_map = {};\n\n      context.root.iter(null, function(p) {\n        p._children.forEach(function(e) {\n          parent_map[e] = p;\n        });\n      });\n    }\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n\n      if (parent_map.hasOwnProperty(elem)) {\n        rv.push(parent_map[elem]);\n      }\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\n\nfunction prepare_predicate(next, token) {\n  var tag, key, value, select;\n  token = next();\n\n  if (token[1] === '@') {\n    // attribute\n    token = next();\n\n    if (token[1]) {\n      throw new SyntaxError(token, 'Invalid attribute predicate');\n    }\n\n    key = token[0];\n    token = next();\n\n    if (token[1] === ']') {\n      select = function(context, result) {\n        var i, len, elem, rv = [];\n\n        for (i = 0, len = result.length; i < len; i++) {\n          elem = result[i];\n\n          if (elem.get(key)) {\n            rv.push(elem);\n          }\n        }\n\n        return rv;\n      };\n    }\n    else if (token[1] === '=') {\n      value = next()[1];\n\n      if (value[0] === '\"' || value[value.length - 1] === '\\'') {\n        value = value.slice(1, value.length - 1);\n      }\n      else {\n        throw new SyntaxError(token, 'Ivalid comparison target');\n      }\n\n      token = next();\n      select = function(context, result) {\n        var i, len, elem, rv = [];\n\n        for (i = 0, len = result.length; i < len; i++) {\n          elem = result[i];\n\n          if (elem.get(key) === value) {\n            rv.push(elem);\n          }\n        }\n\n        return rv;\n      };\n    }\n\n    if (token[1] !== ']') {\n      throw new SyntaxError(token, 'Invalid attribute predicate');\n    }\n  }\n  else if (!token[1]) {\n    tag = token[0] || '';\n    token = next();\n\n    if (token[1] !== ']') {\n      throw new SyntaxError(token, 'Invalid node predicate');\n    }\n\n    select = function(context, result) {\n      var i, len, elem, rv = [];\n\n      for (i = 0, len = result.length; i < len; i++) {\n        elem = result[i];\n\n        if (elem.find(tag)) {\n          rv.push(elem);\n        }\n      }\n\n      return rv;\n    };\n  }\n  else {\n    throw new SyntaxError(null, 'Invalid predicate');\n  }\n\n  return select;\n}\n\n\n\nvar ops = {\n  \"\": prepare_tag,\n  \"*\": prepare_star,\n  \".\": prepare_dot,\n  \"..\": prepare_dot_dot,\n  \"//\": prepare_iter,\n  \"[\": prepare_predicate,\n};\n\nfunction _SelectorContext(root) {\n  this.parent_map = null;\n  this.root = root;\n}\n\nfunction findall(elem, path) {\n  var selector, result, i, len, token, value, select, context;\n\n  if (_cache.hasOwnProperty(path)) {\n    selector = _cache[path];\n  }\n  else {\n    // TODO: Use smarter cache purging approach\n    if (Object.keys(_cache).length > 100) {\n      _cache = {};\n    }\n\n    if (path.charAt(0) === '/') {\n      throw new SyntaxError(null, 'Cannot use absolute path on element');\n    }\n\n    result = xpath_tokenizer(path);\n    selector = [];\n\n    function getToken() {\n      return result.shift();\n    }\n\n    token = getToken();\n    while (true) {\n      var c = token[1] || '';\n      value = ops[c](getToken, token);\n\n      if (!value) {\n        throw new SyntaxError(null, sprintf('Invalid path: %s', path));\n      }\n\n      selector.push(value);\n      token = getToken();\n\n      if (!token) {\n        break;\n      }\n      else if (token[1] === '/') {\n        token = getToken();\n      }\n\n      if (!token) {\n        break;\n      }\n    }\n\n    _cache[path] = selector;\n  }\n\n  // Execute slector pattern\n  result = [elem];\n  context = new _SelectorContext(elem);\n\n  for (i = 0, len = selector.length; i < len; i++) {\n    select = selector[i];\n    result = select(context, result);\n  }\n\n  return result || [];\n}\n\nfunction find(element, path) {\n  var resultElements = findall(element, path);\n\n  if (resultElements && resultElements.length > 0) {\n    return resultElements[0];\n  }\n\n  return null;\n}\n\nfunction findtext(element, path, defvalue) {\n  var resultElements = findall(element, path);\n\n  if (resultElements && resultElements.length > 0) {\n    return resultElements[0].text;\n  }\n\n  return defvalue;\n}\n\n\nexports.find = find;\nexports.findall = findall;\nexports.findtext = findtext;\n","/**\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\nvar util = require('util');\n\nvar sprintf = require('./sprintf').sprintf;\n\nfunction SyntaxError(token, msg) {\n  msg = msg || sprintf('Syntax Error at token %s', token.toString());\n  this.token = token;\n  this.message = msg;\n  Error.call(this, msg);\n}\n\nutil.inherits(SyntaxError, Error);\n\nexports.SyntaxError = SyntaxError;\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","/*\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\n/* TODO: support node-expat C++ module optionally */\n\nvar util = require('util');\nvar parsers = require('./parsers/index');\n\nfunction get_parser(name) {\n  if (name === 'sax') {\n    return parsers.sax;\n  }\n  else {\n    throw new Error('Invalid parser: ' + name);\n  }\n}\n\n\nexports.get_parser = get_parser;\n","exports.sax = require('./sax');\n","var util = require('util');\n\nvar sax = require('sax');\n\nvar TreeBuilder = require('./../treebuilder').TreeBuilder;\n\nfunction XMLParser(target) {\n  this.parser = sax.parser(true);\n\n  this.target = (target) ? target : new TreeBuilder();\n\n  this.parser.onopentag = this._handleOpenTag.bind(this);\n  this.parser.ontext = this._handleText.bind(this);\n  this.parser.oncdata = this._handleCdata.bind(this);\n  this.parser.ondoctype = this._handleDoctype.bind(this);\n  this.parser.oncomment = this._handleComment.bind(this);\n  this.parser.onclosetag = this._handleCloseTag.bind(this);\n  this.parser.onerror = this._handleError.bind(this);\n}\n\nXMLParser.prototype._handleOpenTag = function(tag) {\n  this.target.start(tag.name, tag.attributes);\n};\n\nXMLParser.prototype._handleText = function(text) {\n  this.target.data(text);\n};\n\nXMLParser.prototype._handleCdata = function(text) {\n  this.target.data(text);\n};\n\nXMLParser.prototype._handleDoctype = function(text) {\n};\n\nXMLParser.prototype._handleComment = function(comment) {\n};\n\nXMLParser.prototype._handleCloseTag = function(tag) {\n  this.target.end(tag);\n};\n\nXMLParser.prototype._handleError = function(err) {\n  throw err;\n};\n\nXMLParser.prototype.feed = function(chunk) {\n  this.parser.write(chunk);\n};\n\nXMLParser.prototype.close = function() {\n  this.parser.close();\n  return this.target.close();\n};\n\nexports.XMLParser = XMLParser;\n",";(function (sax) { // wrapper for non-node envs\n  sax.parser = function (strict, opt) { return new SAXParser(strict, opt) }\n  sax.SAXParser = SAXParser\n  sax.SAXStream = SAXStream\n  sax.createStream = createStream\n\n  // When we pass the MAX_BUFFER_LENGTH position, start checking for buffer overruns.\n  // When we check, schedule the next check for MAX_BUFFER_LENGTH - (max(buffer lengths)),\n  // since that's the earliest that a buffer overrun could occur.  This way, checks are\n  // as rare as required, but as often as necessary to ensure never crossing this bound.\n  // Furthermore, buffers are only tested at most once per write(), so passing a very\n  // large string into write() might have undesirable effects, but this is manageable by\n  // the caller, so it is assumed to be safe.  Thus, a call to write() may, in the extreme\n  // edge case, result in creating at most one complete copy of the string passed in.\n  // Set to Infinity to have unlimited buffers.\n  sax.MAX_BUFFER_LENGTH = 64 * 1024\n\n  var buffers = [\n    'comment', 'sgmlDecl', 'textNode', 'tagName', 'doctype',\n    'procInstName', 'procInstBody', 'entity', 'attribName',\n    'attribValue', 'cdata', 'script'\n  ]\n\n  sax.EVENTS = [\n    'text',\n    'processinginstruction',\n    'sgmldeclaration',\n    'doctype',\n    'comment',\n    'attribute',\n    'opentag',\n    'closetag',\n    'opencdata',\n    'cdata',\n    'closecdata',\n    'error',\n    'end',\n    'ready',\n    'script',\n    'opennamespace',\n    'closenamespace'\n  ]\n\n  function SAXParser (strict, opt) {\n    if (!(this instanceof SAXParser)) {\n      return new SAXParser(strict, opt)\n    }\n\n    var parser = this\n    clearBuffers(parser)\n    parser.q = parser.c = ''\n    parser.bufferCheckPosition = sax.MAX_BUFFER_LENGTH\n    parser.opt = opt || {}\n    parser.opt.lowercase = parser.opt.lowercase || parser.opt.lowercasetags\n    parser.looseCase = parser.opt.lowercase ? 'toLowerCase' : 'toUpperCase'\n    parser.tags = []\n    parser.closed = parser.closedRoot = parser.sawRoot = false\n    parser.tag = parser.error = null\n    parser.strict = !!strict\n    parser.noscript = !!(strict || parser.opt.noscript)\n    parser.state = S.BEGIN\n    parser.strictEntities = parser.opt.strictEntities\n    parser.ENTITIES = parser.strictEntities ? Object.create(sax.XML_ENTITIES) : Object.create(sax.ENTITIES)\n    parser.attribList = []\n\n    // namespaces form a prototype chain.\n    // it always points at the current tag,\n    // which protos to its parent tag.\n    if (parser.opt.xmlns) {\n      parser.ns = Object.create(rootNS)\n    }\n\n    // mostly just for error reporting\n    parser.trackPosition = parser.opt.position !== false\n    if (parser.trackPosition) {\n      parser.position = parser.line = parser.column = 0\n    }\n    emit(parser, 'onready')\n  }\n\n  if (!Object.create) {\n    Object.create = function (o) {\n      function F () {}\n      F.prototype = o\n      var newf = new F()\n      return newf\n    }\n  }\n\n  if (!Object.keys) {\n    Object.keys = function (o) {\n      var a = []\n      for (var i in o) if (o.hasOwnProperty(i)) a.push(i)\n      return a\n    }\n  }\n\n  function checkBufferLength (parser) {\n    var maxAllowed = Math.max(sax.MAX_BUFFER_LENGTH, 10)\n    var maxActual = 0\n    for (var i = 0, l = buffers.length; i < l; i++) {\n      var len = parser[buffers[i]].length\n      if (len > maxAllowed) {\n        // Text/cdata nodes can get big, and since they're buffered,\n        // we can get here under normal conditions.\n        // Avoid issues by emitting the text node now,\n        // so at least it won't get any bigger.\n        switch (buffers[i]) {\n          case 'textNode':\n            closeText(parser)\n            break\n\n          case 'cdata':\n            emitNode(parser, 'oncdata', parser.cdata)\n            parser.cdata = ''\n            break\n\n          case 'script':\n            emitNode(parser, 'onscript', parser.script)\n            parser.script = ''\n            break\n\n          default:\n            error(parser, 'Max buffer length exceeded: ' + buffers[i])\n        }\n      }\n      maxActual = Math.max(maxActual, len)\n    }\n    // schedule the next check for the earliest possible buffer overrun.\n    var m = sax.MAX_BUFFER_LENGTH - maxActual\n    parser.bufferCheckPosition = m + parser.position\n  }\n\n  function clearBuffers (parser) {\n    for (var i = 0, l = buffers.length; i < l; i++) {\n      parser[buffers[i]] = ''\n    }\n  }\n\n  function flushBuffers (parser) {\n    closeText(parser)\n    if (parser.cdata !== '') {\n      emitNode(parser, 'oncdata', parser.cdata)\n      parser.cdata = ''\n    }\n    if (parser.script !== '') {\n      emitNode(parser, 'onscript', parser.script)\n      parser.script = ''\n    }\n  }\n\n  SAXParser.prototype = {\n    end: function () { end(this) },\n    write: write,\n    resume: function () { this.error = null; return this },\n    close: function () { return this.write(null) },\n    flush: function () { flushBuffers(this) }\n  }\n\n  var Stream\n  try {\n    Stream = require('stream').Stream\n  } catch (ex) {\n    Stream = function () {}\n  }\n\n  var streamWraps = sax.EVENTS.filter(function (ev) {\n    return ev !== 'error' && ev !== 'end'\n  })\n\n  function createStream (strict, opt) {\n    return new SAXStream(strict, opt)\n  }\n\n  function SAXStream (strict, opt) {\n    if (!(this instanceof SAXStream)) {\n      return new SAXStream(strict, opt)\n    }\n\n    Stream.apply(this)\n\n    this._parser = new SAXParser(strict, opt)\n    this.writable = true\n    this.readable = true\n\n    var me = this\n\n    this._parser.onend = function () {\n      me.emit('end')\n    }\n\n    this._parser.onerror = function (er) {\n      me.emit('error', er)\n\n      // if didn't throw, then means error was handled.\n      // go ahead and clear error, so we can write again.\n      me._parser.error = null\n    }\n\n    this._decoder = null\n\n    streamWraps.forEach(function (ev) {\n      Object.defineProperty(me, 'on' + ev, {\n        get: function () {\n          return me._parser['on' + ev]\n        },\n        set: function (h) {\n          if (!h) {\n            me.removeAllListeners(ev)\n            me._parser['on' + ev] = h\n            return h\n          }\n          me.on(ev, h)\n        },\n        enumerable: true,\n        configurable: false\n      })\n    })\n  }\n\n  SAXStream.prototype = Object.create(Stream.prototype, {\n    constructor: {\n      value: SAXStream\n    }\n  })\n\n  SAXStream.prototype.write = function (data) {\n    if (typeof Buffer === 'function' &&\n      typeof Buffer.isBuffer === 'function' &&\n      Buffer.isBuffer(data)) {\n      if (!this._decoder) {\n        var SD = require('string_decoder').StringDecoder\n        this._decoder = new SD('utf8')\n      }\n      data = this._decoder.write(data)\n    }\n\n    this._parser.write(data.toString())\n    this.emit('data', data)\n    return true\n  }\n\n  SAXStream.prototype.end = function (chunk) {\n    if (chunk && chunk.length) {\n      this.write(chunk)\n    }\n    this._parser.end()\n    return true\n  }\n\n  SAXStream.prototype.on = function (ev, handler) {\n    var me = this\n    if (!me._parser['on' + ev] && streamWraps.indexOf(ev) !== -1) {\n      me._parser['on' + ev] = function () {\n        var args = arguments.length === 1 ? [arguments[0]] : Array.apply(null, arguments)\n        args.splice(0, 0, ev)\n        me.emit.apply(me, args)\n      }\n    }\n\n    return Stream.prototype.on.call(me, ev, handler)\n  }\n\n  // character classes and tokens\n  var whitespace = '\\r\\n\\t '\n\n  // this really needs to be replaced with character classes.\n  // XML allows all manner of ridiculous numbers and digits.\n  var number = '0124356789'\n  var letter = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'\n\n  // (Letter | \"_\" | \":\")\n  var quote = '\\'\"'\n  var attribEnd = whitespace + '>'\n  var CDATA = '[CDATA['\n  var DOCTYPE = 'DOCTYPE'\n  var XML_NAMESPACE = 'http://www.w3.org/XML/1998/namespace'\n  var XMLNS_NAMESPACE = 'http://www.w3.org/2000/xmlns/'\n  var rootNS = { xml: XML_NAMESPACE, xmlns: XMLNS_NAMESPACE }\n\n  // turn all the string character sets into character class objects.\n  whitespace = charClass(whitespace)\n  number = charClass(number)\n  letter = charClass(letter)\n\n  // http://www.w3.org/TR/REC-xml/#NT-NameStartChar\n  // This implementation works on strings, a single character at a time\n  // as such, it cannot ever support astral-plane characters (10000-EFFFF)\n  // without a significant breaking change to either this  parser, or the\n  // JavaScript language.  Implementation of an emoji-capable xml parser\n  // is left as an exercise for the reader.\n  var nameStart = /[:_A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]/\n\n  var nameBody = /[:_A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\u00B7\\u0300-\\u036F\\u203F-\\u2040\\.\\d-]/\n\n  var entityStart = /[#:_A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]/\n  var entityBody = /[#:_A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\u00B7\\u0300-\\u036F\\u203F-\\u2040\\.\\d-]/\n\n  quote = charClass(quote)\n  attribEnd = charClass(attribEnd)\n\n  function charClass (str) {\n    return str.split('').reduce(function (s, c) {\n      s[c] = true\n      return s\n    }, {})\n  }\n\n  function isRegExp (c) {\n    return Object.prototype.toString.call(c) === '[object RegExp]'\n  }\n\n  function is (charclass, c) {\n    return isRegExp(charclass) ? !!c.match(charclass) : charclass[c]\n  }\n\n  function not (charclass, c) {\n    return !is(charclass, c)\n  }\n\n  var S = 0\n  sax.STATE = {\n    BEGIN: S++, // leading byte order mark or whitespace\n    BEGIN_WHITESPACE: S++, // leading whitespace\n    TEXT: S++, // general stuff\n    TEXT_ENTITY: S++, // &amp and such.\n    OPEN_WAKA: S++, // <\n    SGML_DECL: S++, // <!BLARG\n    SGML_DECL_QUOTED: S++, // <!BLARG foo \"bar\n    DOCTYPE: S++, // <!DOCTYPE\n    DOCTYPE_QUOTED: S++, // <!DOCTYPE \"//blah\n    DOCTYPE_DTD: S++, // <!DOCTYPE \"//blah\" [ ...\n    DOCTYPE_DTD_QUOTED: S++, // <!DOCTYPE \"//blah\" [ \"foo\n    COMMENT_STARTING: S++, // <!-\n    COMMENT: S++, // <!--\n    COMMENT_ENDING: S++, // <!-- blah -\n    COMMENT_ENDED: S++, // <!-- blah --\n    CDATA: S++, // <![CDATA[ something\n    CDATA_ENDING: S++, // ]\n    CDATA_ENDING_2: S++, // ]]\n    PROC_INST: S++, // <?hi\n    PROC_INST_BODY: S++, // <?hi there\n    PROC_INST_ENDING: S++, // <?hi \"there\" ?\n    OPEN_TAG: S++, // <strong\n    OPEN_TAG_SLASH: S++, // <strong /\n    ATTRIB: S++, // <a\n    ATTRIB_NAME: S++, // <a foo\n    ATTRIB_NAME_SAW_WHITE: S++, // <a foo _\n    ATTRIB_VALUE: S++, // <a foo=\n    ATTRIB_VALUE_QUOTED: S++, // <a foo=\"bar\n    ATTRIB_VALUE_CLOSED: S++, // <a foo=\"bar\"\n    ATTRIB_VALUE_UNQUOTED: S++, // <a foo=bar\n    ATTRIB_VALUE_ENTITY_Q: S++, // <foo bar=\"&quot;\"\n    ATTRIB_VALUE_ENTITY_U: S++, // <foo bar=&quot\n    CLOSE_TAG: S++, // </a\n    CLOSE_TAG_SAW_WHITE: S++, // </a   >\n    SCRIPT: S++, // <script> ...\n    SCRIPT_ENDING: S++ // <script> ... <\n  }\n\n  sax.XML_ENTITIES = {\n    'amp': '&',\n    'gt': '>',\n    'lt': '<',\n    'quot': '\"',\n    'apos': \"'\"\n  }\n\n  sax.ENTITIES = {\n    'amp': '&',\n    'gt': '>',\n    'lt': '<',\n    'quot': '\"',\n    'apos': \"'\",\n    'AElig': 198,\n    'Aacute': 193,\n    'Acirc': 194,\n    'Agrave': 192,\n    'Aring': 197,\n    'Atilde': 195,\n    'Auml': 196,\n    'Ccedil': 199,\n    'ETH': 208,\n    'Eacute': 201,\n    'Ecirc': 202,\n    'Egrave': 200,\n    'Euml': 203,\n    'Iacute': 205,\n    'Icirc': 206,\n    'Igrave': 204,\n    'Iuml': 207,\n    'Ntilde': 209,\n    'Oacute': 211,\n    'Ocirc': 212,\n    'Ograve': 210,\n    'Oslash': 216,\n    'Otilde': 213,\n    'Ouml': 214,\n    'THORN': 222,\n    'Uacute': 218,\n    'Ucirc': 219,\n    'Ugrave': 217,\n    'Uuml': 220,\n    'Yacute': 221,\n    'aacute': 225,\n    'acirc': 226,\n    'aelig': 230,\n    'agrave': 224,\n    'aring': 229,\n    'atilde': 227,\n    'auml': 228,\n    'ccedil': 231,\n    'eacute': 233,\n    'ecirc': 234,\n    'egrave': 232,\n    'eth': 240,\n    'euml': 235,\n    'iacute': 237,\n    'icirc': 238,\n    'igrave': 236,\n    'iuml': 239,\n    'ntilde': 241,\n    'oacute': 243,\n    'ocirc': 244,\n    'ograve': 242,\n    'oslash': 248,\n    'otilde': 245,\n    'ouml': 246,\n    'szlig': 223,\n    'thorn': 254,\n    'uacute': 250,\n    'ucirc': 251,\n    'ugrave': 249,\n    'uuml': 252,\n    'yacute': 253,\n    'yuml': 255,\n    'copy': 169,\n    'reg': 174,\n    'nbsp': 160,\n    'iexcl': 161,\n    'cent': 162,\n    'pound': 163,\n    'curren': 164,\n    'yen': 165,\n    'brvbar': 166,\n    'sect': 167,\n    'uml': 168,\n    'ordf': 170,\n    'laquo': 171,\n    'not': 172,\n    'shy': 173,\n    'macr': 175,\n    'deg': 176,\n    'plusmn': 177,\n    'sup1': 185,\n    'sup2': 178,\n    'sup3': 179,\n    'acute': 180,\n    'micro': 181,\n    'para': 182,\n    'middot': 183,\n    'cedil': 184,\n    'ordm': 186,\n    'raquo': 187,\n    'frac14': 188,\n    'frac12': 189,\n    'frac34': 190,\n    'iquest': 191,\n    'times': 215,\n    'divide': 247,\n    'OElig': 338,\n    'oelig': 339,\n    'Scaron': 352,\n    'scaron': 353,\n    'Yuml': 376,\n    'fnof': 402,\n    'circ': 710,\n    'tilde': 732,\n    'Alpha': 913,\n    'Beta': 914,\n    'Gamma': 915,\n    'Delta': 916,\n    'Epsilon': 917,\n    'Zeta': 918,\n    'Eta': 919,\n    'Theta': 920,\n    'Iota': 921,\n    'Kappa': 922,\n    'Lambda': 923,\n    'Mu': 924,\n    'Nu': 925,\n    'Xi': 926,\n    'Omicron': 927,\n    'Pi': 928,\n    'Rho': 929,\n    'Sigma': 931,\n    'Tau': 932,\n    'Upsilon': 933,\n    'Phi': 934,\n    'Chi': 935,\n    'Psi': 936,\n    'Omega': 937,\n    'alpha': 945,\n    'beta': 946,\n    'gamma': 947,\n    'delta': 948,\n    'epsilon': 949,\n    'zeta': 950,\n    'eta': 951,\n    'theta': 952,\n    'iota': 953,\n    'kappa': 954,\n    'lambda': 955,\n    'mu': 956,\n    'nu': 957,\n    'xi': 958,\n    'omicron': 959,\n    'pi': 960,\n    'rho': 961,\n    'sigmaf': 962,\n    'sigma': 963,\n    'tau': 964,\n    'upsilon': 965,\n    'phi': 966,\n    'chi': 967,\n    'psi': 968,\n    'omega': 969,\n    'thetasym': 977,\n    'upsih': 978,\n    'piv': 982,\n    'ensp': 8194,\n    'emsp': 8195,\n    'thinsp': 8201,\n    'zwnj': 8204,\n    'zwj': 8205,\n    'lrm': 8206,\n    'rlm': 8207,\n    'ndash': 8211,\n    'mdash': 8212,\n    'lsquo': 8216,\n    'rsquo': 8217,\n    'sbquo': 8218,\n    'ldquo': 8220,\n    'rdquo': 8221,\n    'bdquo': 8222,\n    'dagger': 8224,\n    'Dagger': 8225,\n    'bull': 8226,\n    'hellip': 8230,\n    'permil': 8240,\n    'prime': 8242,\n    'Prime': 8243,\n    'lsaquo': 8249,\n    'rsaquo': 8250,\n    'oline': 8254,\n    'frasl': 8260,\n    'euro': 8364,\n    'image': 8465,\n    'weierp': 8472,\n    'real': 8476,\n    'trade': 8482,\n    'alefsym': 8501,\n    'larr': 8592,\n    'uarr': 8593,\n    'rarr': 8594,\n    'darr': 8595,\n    'harr': 8596,\n    'crarr': 8629,\n    'lArr': 8656,\n    'uArr': 8657,\n    'rArr': 8658,\n    'dArr': 8659,\n    'hArr': 8660,\n    'forall': 8704,\n    'part': 8706,\n    'exist': 8707,\n    'empty': 8709,\n    'nabla': 8711,\n    'isin': 8712,\n    'notin': 8713,\n    'ni': 8715,\n    'prod': 8719,\n    'sum': 8721,\n    'minus': 8722,\n    'lowast': 8727,\n    'radic': 8730,\n    'prop': 8733,\n    'infin': 8734,\n    'ang': 8736,\n    'and': 8743,\n    'or': 8744,\n    'cap': 8745,\n    'cup': 8746,\n    'int': 8747,\n    'there4': 8756,\n    'sim': 8764,\n    'cong': 8773,\n    'asymp': 8776,\n    'ne': 8800,\n    'equiv': 8801,\n    'le': 8804,\n    'ge': 8805,\n    'sub': 8834,\n    'sup': 8835,\n    'nsub': 8836,\n    'sube': 8838,\n    'supe': 8839,\n    'oplus': 8853,\n    'otimes': 8855,\n    'perp': 8869,\n    'sdot': 8901,\n    'lceil': 8968,\n    'rceil': 8969,\n    'lfloor': 8970,\n    'rfloor': 8971,\n    'lang': 9001,\n    'rang': 9002,\n    'loz': 9674,\n    'spades': 9824,\n    'clubs': 9827,\n    'hearts': 9829,\n    'diams': 9830\n  }\n\n  Object.keys(sax.ENTITIES).forEach(function (key) {\n    var e = sax.ENTITIES[key]\n    var s = typeof e === 'number' ? String.fromCharCode(e) : e\n    sax.ENTITIES[key] = s\n  })\n\n  for (var s in sax.STATE) {\n    sax.STATE[sax.STATE[s]] = s\n  }\n\n  // shorthand\n  S = sax.STATE\n\n  function emit (parser, event, data) {\n    parser[event] && parser[event](data)\n  }\n\n  function emitNode (parser, nodeType, data) {\n    if (parser.textNode) closeText(parser)\n    emit(parser, nodeType, data)\n  }\n\n  function closeText (parser) {\n    parser.textNode = textopts(parser.opt, parser.textNode)\n    if (parser.textNode) emit(parser, 'ontext', parser.textNode)\n    parser.textNode = ''\n  }\n\n  function textopts (opt, text) {\n    if (opt.trim) text = text.trim()\n    if (opt.normalize) text = text.replace(/\\s+/g, ' ')\n    return text\n  }\n\n  function error (parser, er) {\n    closeText(parser)\n    if (parser.trackPosition) {\n      er += '\\nLine: ' + parser.line +\n        '\\nColumn: ' + parser.column +\n        '\\nChar: ' + parser.c\n    }\n    er = new Error(er)\n    parser.error = er\n    emit(parser, 'onerror', er)\n    return parser\n  }\n\n  function end (parser) {\n    if (parser.sawRoot && !parser.closedRoot) strictFail(parser, 'Unclosed root tag')\n    if ((parser.state !== S.BEGIN) &&\n      (parser.state !== S.BEGIN_WHITESPACE) &&\n      (parser.state !== S.TEXT)) {\n      error(parser, 'Unexpected end')\n    }\n    closeText(parser)\n    parser.c = ''\n    parser.closed = true\n    emit(parser, 'onend')\n    SAXParser.call(parser, parser.strict, parser.opt)\n    return parser\n  }\n\n  function strictFail (parser, message) {\n    if (typeof parser !== 'object' || !(parser instanceof SAXParser)) {\n      throw new Error('bad call to strictFail')\n    }\n    if (parser.strict) {\n      error(parser, message)\n    }\n  }\n\n  function newTag (parser) {\n    if (!parser.strict) parser.tagName = parser.tagName[parser.looseCase]()\n    var parent = parser.tags[parser.tags.length - 1] || parser\n    var tag = parser.tag = { name: parser.tagName, attributes: {} }\n\n    // will be overridden if tag contails an xmlns=\"foo\" or xmlns:foo=\"bar\"\n    if (parser.opt.xmlns) {\n      tag.ns = parent.ns\n    }\n    parser.attribList.length = 0\n  }\n\n  function qname (name, attribute) {\n    var i = name.indexOf(':')\n    var qualName = i < 0 ? [ '', name ] : name.split(':')\n    var prefix = qualName[0]\n    var local = qualName[1]\n\n    // <x \"xmlns\"=\"http://foo\">\n    if (attribute && name === 'xmlns') {\n      prefix = 'xmlns'\n      local = ''\n    }\n\n    return { prefix: prefix, local: local }\n  }\n\n  function attrib (parser) {\n    if (!parser.strict) {\n      parser.attribName = parser.attribName[parser.looseCase]()\n    }\n\n    if (parser.attribList.indexOf(parser.attribName) !== -1 ||\n      parser.tag.attributes.hasOwnProperty(parser.attribName)) {\n      parser.attribName = parser.attribValue = ''\n      return\n    }\n\n    if (parser.opt.xmlns) {\n      var qn = qname(parser.attribName, true)\n      var prefix = qn.prefix\n      var local = qn.local\n\n      if (prefix === 'xmlns') {\n        // namespace binding attribute. push the binding into scope\n        if (local === 'xml' && parser.attribValue !== XML_NAMESPACE) {\n          strictFail(parser,\n            'xml: prefix must be bound to ' + XML_NAMESPACE + '\\n' +\n            'Actual: ' + parser.attribValue)\n        } else if (local === 'xmlns' && parser.attribValue !== XMLNS_NAMESPACE) {\n          strictFail(parser,\n            'xmlns: prefix must be bound to ' + XMLNS_NAMESPACE + '\\n' +\n            'Actual: ' + parser.attribValue)\n        } else {\n          var tag = parser.tag\n          var parent = parser.tags[parser.tags.length - 1] || parser\n          if (tag.ns === parent.ns) {\n            tag.ns = Object.create(parent.ns)\n          }\n          tag.ns[local] = parser.attribValue\n        }\n      }\n\n      // defer onattribute events until all attributes have been seen\n      // so any new bindings can take effect. preserve attribute order\n      // so deferred events can be emitted in document order\n      parser.attribList.push([parser.attribName, parser.attribValue])\n    } else {\n      // in non-xmlns mode, we can emit the event right away\n      parser.tag.attributes[parser.attribName] = parser.attribValue\n      emitNode(parser, 'onattribute', {\n        name: parser.attribName,\n        value: parser.attribValue\n      })\n    }\n\n    parser.attribName = parser.attribValue = ''\n  }\n\n  function openTag (parser, selfClosing) {\n    if (parser.opt.xmlns) {\n      // emit namespace binding events\n      var tag = parser.tag\n\n      // add namespace info to tag\n      var qn = qname(parser.tagName)\n      tag.prefix = qn.prefix\n      tag.local = qn.local\n      tag.uri = tag.ns[qn.prefix] || ''\n\n      if (tag.prefix && !tag.uri) {\n        strictFail(parser, 'Unbound namespace prefix: ' +\n          JSON.stringify(parser.tagName))\n        tag.uri = qn.prefix\n      }\n\n      var parent = parser.tags[parser.tags.length - 1] || parser\n      if (tag.ns && parent.ns !== tag.ns) {\n        Object.keys(tag.ns).forEach(function (p) {\n          emitNode(parser, 'onopennamespace', {\n            prefix: p,\n            uri: tag.ns[p]\n          })\n        })\n      }\n\n      // handle deferred onattribute events\n      // Note: do not apply default ns to attributes:\n      //   http://www.w3.org/TR/REC-xml-names/#defaulting\n      for (var i = 0, l = parser.attribList.length; i < l; i++) {\n        var nv = parser.attribList[i]\n        var name = nv[0]\n        var value = nv[1]\n        var qualName = qname(name, true)\n        var prefix = qualName.prefix\n        var local = qualName.local\n        var uri = prefix === '' ? '' : (tag.ns[prefix] || '')\n        var a = {\n          name: name,\n          value: value,\n          prefix: prefix,\n          local: local,\n          uri: uri\n        }\n\n        // if there's any attributes with an undefined namespace,\n        // then fail on them now.\n        if (prefix && prefix !== 'xmlns' && !uri) {\n          strictFail(parser, 'Unbound namespace prefix: ' +\n            JSON.stringify(prefix))\n          a.uri = prefix\n        }\n        parser.tag.attributes[name] = a\n        emitNode(parser, 'onattribute', a)\n      }\n      parser.attribList.length = 0\n    }\n\n    parser.tag.isSelfClosing = !!selfClosing\n\n    // process the tag\n    parser.sawRoot = true\n    parser.tags.push(parser.tag)\n    emitNode(parser, 'onopentag', parser.tag)\n    if (!selfClosing) {\n      // special case for <script> in non-strict mode.\n      if (!parser.noscript && parser.tagName.toLowerCase() === 'script') {\n        parser.state = S.SCRIPT\n      } else {\n        parser.state = S.TEXT\n      }\n      parser.tag = null\n      parser.tagName = ''\n    }\n    parser.attribName = parser.attribValue = ''\n    parser.attribList.length = 0\n  }\n\n  function closeTag (parser) {\n    if (!parser.tagName) {\n      strictFail(parser, 'Weird empty close tag.')\n      parser.textNode += '</>'\n      parser.state = S.TEXT\n      return\n    }\n\n    if (parser.script) {\n      if (parser.tagName !== 'script') {\n        parser.script += '</' + parser.tagName + '>'\n        parser.tagName = ''\n        parser.state = S.SCRIPT\n        return\n      }\n      emitNode(parser, 'onscript', parser.script)\n      parser.script = ''\n    }\n\n    // first make sure that the closing tag actually exists.\n    // <a><b></c></b></a> will close everything, otherwise.\n    var t = parser.tags.length\n    var tagName = parser.tagName\n    if (!parser.strict) {\n      tagName = tagName[parser.looseCase]()\n    }\n    var closeTo = tagName\n    while (t--) {\n      var close = parser.tags[t]\n      if (close.name !== closeTo) {\n        // fail the first time in strict mode\n        strictFail(parser, 'Unexpected close tag')\n      } else {\n        break\n      }\n    }\n\n    // didn't find it.  we already failed for strict, so just abort.\n    if (t < 0) {\n      strictFail(parser, 'Unmatched closing tag: ' + parser.tagName)\n      parser.textNode += '</' + parser.tagName + '>'\n      parser.state = S.TEXT\n      return\n    }\n    parser.tagName = tagName\n    var s = parser.tags.length\n    while (s-- > t) {\n      var tag = parser.tag = parser.tags.pop()\n      parser.tagName = parser.tag.name\n      emitNode(parser, 'onclosetag', parser.tagName)\n\n      var x = {}\n      for (var i in tag.ns) {\n        x[i] = tag.ns[i]\n      }\n\n      var parent = parser.tags[parser.tags.length - 1] || parser\n      if (parser.opt.xmlns && tag.ns !== parent.ns) {\n        // remove namespace bindings introduced by tag\n        Object.keys(tag.ns).forEach(function (p) {\n          var n = tag.ns[p]\n          emitNode(parser, 'onclosenamespace', { prefix: p, uri: n })\n        })\n      }\n    }\n    if (t === 0) parser.closedRoot = true\n    parser.tagName = parser.attribValue = parser.attribName = ''\n    parser.attribList.length = 0\n    parser.state = S.TEXT\n  }\n\n  function parseEntity (parser) {\n    var entity = parser.entity\n    var entityLC = entity.toLowerCase()\n    var num\n    var numStr = ''\n\n    if (parser.ENTITIES[entity]) {\n      return parser.ENTITIES[entity]\n    }\n    if (parser.ENTITIES[entityLC]) {\n      return parser.ENTITIES[entityLC]\n    }\n    entity = entityLC\n    if (entity.charAt(0) === '#') {\n      if (entity.charAt(1) === 'x') {\n        entity = entity.slice(2)\n        num = parseInt(entity, 16)\n        numStr = num.toString(16)\n      } else {\n        entity = entity.slice(1)\n        num = parseInt(entity, 10)\n        numStr = num.toString(10)\n      }\n    }\n    entity = entity.replace(/^0+/, '')\n    if (numStr.toLowerCase() !== entity) {\n      strictFail(parser, 'Invalid character entity')\n      return '&' + parser.entity + ';'\n    }\n\n    return String.fromCodePoint(num)\n  }\n\n  function beginWhiteSpace (parser, c) {\n    if (c === '<') {\n      parser.state = S.OPEN_WAKA\n      parser.startTagPosition = parser.position\n    } else if (not(whitespace, c)) {\n      // have to process this as a text node.\n      // weird, but happens.\n      strictFail(parser, 'Non-whitespace before first tag.')\n      parser.textNode = c\n      parser.state = S.TEXT\n    }\n  }\n\n  function write (chunk) {\n    var parser = this\n    if (this.error) {\n      throw this.error\n    }\n    if (parser.closed) {\n      return error(parser,\n        'Cannot write after close. Assign an onready handler.')\n    }\n    if (chunk === null) {\n      return end(parser)\n    }\n    var i = 0\n    var c = ''\n    while (true) {\n      c = chunk.charAt(i++)\n      parser.c = c\n      if (!c) {\n        break\n      }\n      if (parser.trackPosition) {\n        parser.position++\n        if (c === '\\n') {\n          parser.line++\n          parser.column = 0\n        } else {\n          parser.column++\n        }\n      }\n      switch (parser.state) {\n        case S.BEGIN:\n          parser.state = S.BEGIN_WHITESPACE\n          if (c === '\\uFEFF') {\n            continue\n          }\n          beginWhiteSpace(parser, c)\n          continue\n\n        case S.BEGIN_WHITESPACE:\n          beginWhiteSpace(parser, c)\n          continue\n\n        case S.TEXT:\n          if (parser.sawRoot && !parser.closedRoot) {\n            var starti = i - 1\n            while (c && c !== '<' && c !== '&') {\n              c = chunk.charAt(i++)\n              if (c && parser.trackPosition) {\n                parser.position++\n                if (c === '\\n') {\n                  parser.line++\n                  parser.column = 0\n                } else {\n                  parser.column++\n                }\n              }\n            }\n            parser.textNode += chunk.substring(starti, i - 1)\n          }\n          if (c === '<' && !(parser.sawRoot && parser.closedRoot && !parser.strict)) {\n            parser.state = S.OPEN_WAKA\n            parser.startTagPosition = parser.position\n          } else {\n            if (not(whitespace, c) && (!parser.sawRoot || parser.closedRoot)) {\n              strictFail(parser, 'Text data outside of root node.')\n            }\n            if (c === '&') {\n              parser.state = S.TEXT_ENTITY\n            } else {\n              parser.textNode += c\n            }\n          }\n          continue\n\n        case S.SCRIPT:\n          // only non-strict\n          if (c === '<') {\n            parser.state = S.SCRIPT_ENDING\n          } else {\n            parser.script += c\n          }\n          continue\n\n        case S.SCRIPT_ENDING:\n          if (c === '/') {\n            parser.state = S.CLOSE_TAG\n          } else {\n            parser.script += '<' + c\n            parser.state = S.SCRIPT\n          }\n          continue\n\n        case S.OPEN_WAKA:\n          // either a /, ?, !, or text is coming next.\n          if (c === '!') {\n            parser.state = S.SGML_DECL\n            parser.sgmlDecl = ''\n          } else if (is(whitespace, c)) {\n            // wait for it...\n          } else if (is(nameStart, c)) {\n            parser.state = S.OPEN_TAG\n            parser.tagName = c\n          } else if (c === '/') {\n            parser.state = S.CLOSE_TAG\n            parser.tagName = ''\n          } else if (c === '?') {\n            parser.state = S.PROC_INST\n            parser.procInstName = parser.procInstBody = ''\n          } else {\n            strictFail(parser, 'Unencoded <')\n            // if there was some whitespace, then add that in.\n            if (parser.startTagPosition + 1 < parser.position) {\n              var pad = parser.position - parser.startTagPosition\n              c = new Array(pad).join(' ') + c\n            }\n            parser.textNode += '<' + c\n            parser.state = S.TEXT\n          }\n          continue\n\n        case S.SGML_DECL:\n          if ((parser.sgmlDecl + c).toUpperCase() === CDATA) {\n            emitNode(parser, 'onopencdata')\n            parser.state = S.CDATA\n            parser.sgmlDecl = ''\n            parser.cdata = ''\n          } else if (parser.sgmlDecl + c === '--') {\n            parser.state = S.COMMENT\n            parser.comment = ''\n            parser.sgmlDecl = ''\n          } else if ((parser.sgmlDecl + c).toUpperCase() === DOCTYPE) {\n            parser.state = S.DOCTYPE\n            if (parser.doctype || parser.sawRoot) {\n              strictFail(parser,\n                'Inappropriately located doctype declaration')\n            }\n            parser.doctype = ''\n            parser.sgmlDecl = ''\n          } else if (c === '>') {\n            emitNode(parser, 'onsgmldeclaration', parser.sgmlDecl)\n            parser.sgmlDecl = ''\n            parser.state = S.TEXT\n          } else if (is(quote, c)) {\n            parser.state = S.SGML_DECL_QUOTED\n            parser.sgmlDecl += c\n          } else {\n            parser.sgmlDecl += c\n          }\n          continue\n\n        case S.SGML_DECL_QUOTED:\n          if (c === parser.q) {\n            parser.state = S.SGML_DECL\n            parser.q = ''\n          }\n          parser.sgmlDecl += c\n          continue\n\n        case S.DOCTYPE:\n          if (c === '>') {\n            parser.state = S.TEXT\n            emitNode(parser, 'ondoctype', parser.doctype)\n            parser.doctype = true // just remember that we saw it.\n          } else {\n            parser.doctype += c\n            if (c === '[') {\n              parser.state = S.DOCTYPE_DTD\n            } else if (is(quote, c)) {\n              parser.state = S.DOCTYPE_QUOTED\n              parser.q = c\n            }\n          }\n          continue\n\n        case S.DOCTYPE_QUOTED:\n          parser.doctype += c\n          if (c === parser.q) {\n            parser.q = ''\n            parser.state = S.DOCTYPE\n          }\n          continue\n\n        case S.DOCTYPE_DTD:\n          parser.doctype += c\n          if (c === ']') {\n            parser.state = S.DOCTYPE\n          } else if (is(quote, c)) {\n            parser.state = S.DOCTYPE_DTD_QUOTED\n            parser.q = c\n          }\n          continue\n\n        case S.DOCTYPE_DTD_QUOTED:\n          parser.doctype += c\n          if (c === parser.q) {\n            parser.state = S.DOCTYPE_DTD\n            parser.q = ''\n          }\n          continue\n\n        case S.COMMENT:\n          if (c === '-') {\n            parser.state = S.COMMENT_ENDING\n          } else {\n            parser.comment += c\n          }\n          continue\n\n        case S.COMMENT_ENDING:\n          if (c === '-') {\n            parser.state = S.COMMENT_ENDED\n            parser.comment = textopts(parser.opt, parser.comment)\n            if (parser.comment) {\n              emitNode(parser, 'oncomment', parser.comment)\n            }\n            parser.comment = ''\n          } else {\n            parser.comment += '-' + c\n            parser.state = S.COMMENT\n          }\n          continue\n\n        case S.COMMENT_ENDED:\n          if (c !== '>') {\n            strictFail(parser, 'Malformed comment')\n            // allow <!-- blah -- bloo --> in non-strict mode,\n            // which is a comment of \" blah -- bloo \"\n            parser.comment += '--' + c\n            parser.state = S.COMMENT\n          } else {\n            parser.state = S.TEXT\n          }\n          continue\n\n        case S.CDATA:\n          if (c === ']') {\n            parser.state = S.CDATA_ENDING\n          } else {\n            parser.cdata += c\n          }\n          continue\n\n        case S.CDATA_ENDING:\n          if (c === ']') {\n            parser.state = S.CDATA_ENDING_2\n          } else {\n            parser.cdata += ']' + c\n            parser.state = S.CDATA\n          }\n          continue\n\n        case S.CDATA_ENDING_2:\n          if (c === '>') {\n            if (parser.cdata) {\n              emitNode(parser, 'oncdata', parser.cdata)\n            }\n            emitNode(parser, 'onclosecdata')\n            parser.cdata = ''\n            parser.state = S.TEXT\n          } else if (c === ']') {\n            parser.cdata += ']'\n          } else {\n            parser.cdata += ']]' + c\n            parser.state = S.CDATA\n          }\n          continue\n\n        case S.PROC_INST:\n          if (c === '?') {\n            parser.state = S.PROC_INST_ENDING\n          } else if (is(whitespace, c)) {\n            parser.state = S.PROC_INST_BODY\n          } else {\n            parser.procInstName += c\n          }\n          continue\n\n        case S.PROC_INST_BODY:\n          if (!parser.procInstBody && is(whitespace, c)) {\n            continue\n          } else if (c === '?') {\n            parser.state = S.PROC_INST_ENDING\n          } else {\n            parser.procInstBody += c\n          }\n          continue\n\n        case S.PROC_INST_ENDING:\n          if (c === '>') {\n            emitNode(parser, 'onprocessinginstruction', {\n              name: parser.procInstName,\n              body: parser.procInstBody\n            })\n            parser.procInstName = parser.procInstBody = ''\n            parser.state = S.TEXT\n          } else {\n            parser.procInstBody += '?' + c\n            parser.state = S.PROC_INST_BODY\n          }\n          continue\n\n        case S.OPEN_TAG:\n          if (is(nameBody, c)) {\n            parser.tagName += c\n          } else {\n            newTag(parser)\n            if (c === '>') {\n              openTag(parser)\n            } else if (c === '/') {\n              parser.state = S.OPEN_TAG_SLASH\n            } else {\n              if (not(whitespace, c)) {\n                strictFail(parser, 'Invalid character in tag name')\n              }\n              parser.state = S.ATTRIB\n            }\n          }\n          continue\n\n        case S.OPEN_TAG_SLASH:\n          if (c === '>') {\n            openTag(parser, true)\n            closeTag(parser)\n          } else {\n            strictFail(parser, 'Forward-slash in opening tag not followed by >')\n            parser.state = S.ATTRIB\n          }\n          continue\n\n        case S.ATTRIB:\n          // haven't read the attribute name yet.\n          if (is(whitespace, c)) {\n            continue\n          } else if (c === '>') {\n            openTag(parser)\n          } else if (c === '/') {\n            parser.state = S.OPEN_TAG_SLASH\n          } else if (is(nameStart, c)) {\n            parser.attribName = c\n            parser.attribValue = ''\n            parser.state = S.ATTRIB_NAME\n          } else {\n            strictFail(parser, 'Invalid attribute name')\n          }\n          continue\n\n        case S.ATTRIB_NAME:\n          if (c === '=') {\n            parser.state = S.ATTRIB_VALUE\n          } else if (c === '>') {\n            strictFail(parser, 'Attribute without value')\n            parser.attribValue = parser.attribName\n            attrib(parser)\n            openTag(parser)\n          } else if (is(whitespace, c)) {\n            parser.state = S.ATTRIB_NAME_SAW_WHITE\n          } else if (is(nameBody, c)) {\n            parser.attribName += c\n          } else {\n            strictFail(parser, 'Invalid attribute name')\n          }\n          continue\n\n        case S.ATTRIB_NAME_SAW_WHITE:\n          if (c === '=') {\n            parser.state = S.ATTRIB_VALUE\n          } else if (is(whitespace, c)) {\n            continue\n          } else {\n            strictFail(parser, 'Attribute without value')\n            parser.tag.attributes[parser.attribName] = ''\n            parser.attribValue = ''\n            emitNode(parser, 'onattribute', {\n              name: parser.attribName,\n              value: ''\n            })\n            parser.attribName = ''\n            if (c === '>') {\n              openTag(parser)\n            } else if (is(nameStart, c)) {\n              parser.attribName = c\n              parser.state = S.ATTRIB_NAME\n            } else {\n              strictFail(parser, 'Invalid attribute name')\n              parser.state = S.ATTRIB\n            }\n          }\n          continue\n\n        case S.ATTRIB_VALUE:\n          if (is(whitespace, c)) {\n            continue\n          } else if (is(quote, c)) {\n            parser.q = c\n            parser.state = S.ATTRIB_VALUE_QUOTED\n          } else {\n            strictFail(parser, 'Unquoted attribute value')\n            parser.state = S.ATTRIB_VALUE_UNQUOTED\n            parser.attribValue = c\n          }\n          continue\n\n        case S.ATTRIB_VALUE_QUOTED:\n          if (c !== parser.q) {\n            if (c === '&') {\n              parser.state = S.ATTRIB_VALUE_ENTITY_Q\n            } else {\n              parser.attribValue += c\n            }\n            continue\n          }\n          attrib(parser)\n          parser.q = ''\n          parser.state = S.ATTRIB_VALUE_CLOSED\n          continue\n\n        case S.ATTRIB_VALUE_CLOSED:\n          if (is(whitespace, c)) {\n            parser.state = S.ATTRIB\n          } else if (c === '>') {\n            openTag(parser)\n          } else if (c === '/') {\n            parser.state = S.OPEN_TAG_SLASH\n          } else if (is(nameStart, c)) {\n            strictFail(parser, 'No whitespace between attributes')\n            parser.attribName = c\n            parser.attribValue = ''\n            parser.state = S.ATTRIB_NAME\n          } else {\n            strictFail(parser, 'Invalid attribute name')\n          }\n          continue\n\n        case S.ATTRIB_VALUE_UNQUOTED:\n          if (not(attribEnd, c)) {\n            if (c === '&') {\n              parser.state = S.ATTRIB_VALUE_ENTITY_U\n            } else {\n              parser.attribValue += c\n            }\n            continue\n          }\n          attrib(parser)\n          if (c === '>') {\n            openTag(parser)\n          } else {\n            parser.state = S.ATTRIB\n          }\n          continue\n\n        case S.CLOSE_TAG:\n          if (!parser.tagName) {\n            if (is(whitespace, c)) {\n              continue\n            } else if (not(nameStart, c)) {\n              if (parser.script) {\n                parser.script += '</' + c\n                parser.state = S.SCRIPT\n              } else {\n                strictFail(parser, 'Invalid tagname in closing tag.')\n              }\n            } else {\n              parser.tagName = c\n            }\n          } else if (c === '>') {\n            closeTag(parser)\n          } else if (is(nameBody, c)) {\n            parser.tagName += c\n          } else if (parser.script) {\n            parser.script += '</' + parser.tagName\n            parser.tagName = ''\n            parser.state = S.SCRIPT\n          } else {\n            if (not(whitespace, c)) {\n              strictFail(parser, 'Invalid tagname in closing tag')\n            }\n            parser.state = S.CLOSE_TAG_SAW_WHITE\n          }\n          continue\n\n        case S.CLOSE_TAG_SAW_WHITE:\n          if (is(whitespace, c)) {\n            continue\n          }\n          if (c === '>') {\n            closeTag(parser)\n          } else {\n            strictFail(parser, 'Invalid characters in closing tag')\n          }\n          continue\n\n        case S.TEXT_ENTITY:\n        case S.ATTRIB_VALUE_ENTITY_Q:\n        case S.ATTRIB_VALUE_ENTITY_U:\n          var returnState\n          var buffer\n          switch (parser.state) {\n            case S.TEXT_ENTITY:\n              returnState = S.TEXT\n              buffer = 'textNode'\n              break\n\n            case S.ATTRIB_VALUE_ENTITY_Q:\n              returnState = S.ATTRIB_VALUE_QUOTED\n              buffer = 'attribValue'\n              break\n\n            case S.ATTRIB_VALUE_ENTITY_U:\n              returnState = S.ATTRIB_VALUE_UNQUOTED\n              buffer = 'attribValue'\n              break\n          }\n\n          if (c === ';') {\n            parser[buffer] += parseEntity(parser)\n            parser.entity = ''\n            parser.state = returnState\n          } else if (is(parser.entity.length ? entityBody : entityStart, c)) {\n            parser.entity += c\n          } else {\n            strictFail(parser, 'Invalid character in entity name')\n            parser[buffer] += '&' + parser.entity + c\n            parser.entity = ''\n            parser.state = returnState\n          }\n\n          continue\n\n        default:\n          throw new Error(parser, 'Unknown state: ' + parser.state)\n      }\n    } // while\n\n    if (parser.position >= parser.bufferCheckPosition) {\n      checkBufferLength(parser)\n    }\n    return parser\n  }\n\n  /*! http://mths.be/fromcodepoint v0.1.0 by @mathias */\n  if (!String.fromCodePoint) {\n    (function () {\n      var stringFromCharCode = String.fromCharCode\n      var floor = Math.floor\n      var fromCodePoint = function () {\n        var MAX_SIZE = 0x4000\n        var codeUnits = []\n        var highSurrogate\n        var lowSurrogate\n        var index = -1\n        var length = arguments.length\n        if (!length) {\n          return ''\n        }\n        var result = ''\n        while (++index < length) {\n          var codePoint = Number(arguments[index])\n          if (\n            !isFinite(codePoint) || // `NaN`, `+Infinity`, or `-Infinity`\n            codePoint < 0 || // not a valid Unicode code point\n            codePoint > 0x10FFFF || // not a valid Unicode code point\n            floor(codePoint) !== codePoint // not an integer\n          ) {\n            throw RangeError('Invalid code point: ' + codePoint)\n          }\n          if (codePoint <= 0xFFFF) { // BMP code point\n            codeUnits.push(codePoint)\n          } else { // Astral code point; split in surrogate halves\n            // http://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae\n            codePoint -= 0x10000\n            highSurrogate = (codePoint >> 10) + 0xD800\n            lowSurrogate = (codePoint % 0x400) + 0xDC00\n            codeUnits.push(highSurrogate, lowSurrogate)\n          }\n          if (index + 1 === length || codeUnits.length > MAX_SIZE) {\n            result += stringFromCharCode.apply(null, codeUnits)\n            codeUnits.length = 0\n          }\n        }\n        return result\n      }\n      if (Object.defineProperty) {\n        Object.defineProperty(String, 'fromCodePoint', {\n          value: fromCodePoint,\n          configurable: true,\n          writable: true\n        })\n      } else {\n        String.fromCodePoint = fromCodePoint\n      }\n    }())\n  }\n})(typeof exports === 'undefined' ? this.sax = {} : exports)\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(\n      uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)\n    ))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","exports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nmodule.exports = Stream;\n\nvar EE = require('events').EventEmitter;\nvar inherits = require('inherits');\n\ninherits(Stream, EE);\nStream.Readable = require('readable-stream/readable.js');\nStream.Writable = require('readable-stream/writable.js');\nStream.Duplex = require('readable-stream/duplex.js');\nStream.Transform = require('readable-stream/transform.js');\nStream.PassThrough = require('readable-stream/passthrough.js');\n\n// Backwards-compat with node 0.4.x\nStream.Stream = Stream;\n\n\n\n// old-style streams.  Note that the pipe method (the only relevant\n// part of this class) is overridden in the Readable class.\n\nfunction Stream() {\n  EE.call(this);\n}\n\nStream.prototype.pipe = function(dest, options) {\n  var source = this;\n\n  function ondata(chunk) {\n    if (dest.writable) {\n      if (false === dest.write(chunk) && source.pause) {\n        source.pause();\n      }\n    }\n  }\n\n  source.on('data', ondata);\n\n  function ondrain() {\n    if (source.readable && source.resume) {\n      source.resume();\n    }\n  }\n\n  dest.on('drain', ondrain);\n\n  // If the 'end' option is not supplied, dest.end() will be called when\n  // source gets the 'end' or 'close' events.  Only dest.end() once.\n  if (!dest._isStdio && (!options || options.end !== false)) {\n    source.on('end', onend);\n    source.on('close', onclose);\n  }\n\n  var didOnEnd = false;\n  function onend() {\n    if (didOnEnd) return;\n    didOnEnd = true;\n\n    dest.end();\n  }\n\n\n  function onclose() {\n    if (didOnEnd) return;\n    didOnEnd = true;\n\n    if (typeof dest.destroy === 'function') dest.destroy();\n  }\n\n  // don't leave dangling pipes when there are errors.\n  function onerror(er) {\n    cleanup();\n    if (EE.listenerCount(this, 'error') === 0) {\n      throw er; // Unhandled stream error in pipe.\n    }\n  }\n\n  source.on('error', onerror);\n  dest.on('error', onerror);\n\n  // remove all the event listeners that were added.\n  function cleanup() {\n    source.removeListener('data', ondata);\n    dest.removeListener('drain', ondrain);\n\n    source.removeListener('end', onend);\n    source.removeListener('close', onclose);\n\n    source.removeListener('error', onerror);\n    dest.removeListener('error', onerror);\n\n    source.removeListener('end', cleanup);\n    source.removeListener('close', cleanup);\n\n    dest.removeListener('close', cleanup);\n  }\n\n  source.on('end', cleanup);\n  source.on('close', cleanup);\n\n  dest.on('close', cleanup);\n\n  dest.emit('pipe', source);\n\n  // Allow for unix-like usage: A.pipe(B).pipe(C)\n  return dest;\n};\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","'use strict';\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Buffer = require('safe-buffer').Buffer;\nvar util = require('util');\n\nfunction copyBuffer(src, target, offset) {\n  src.copy(target, offset);\n}\n\nmodule.exports = function () {\n  function BufferList() {\n    _classCallCheck(this, BufferList);\n\n    this.head = null;\n    this.tail = null;\n    this.length = 0;\n  }\n\n  BufferList.prototype.push = function push(v) {\n    var entry = { data: v, next: null };\n    if (this.length > 0) this.tail.next = entry;else this.head = entry;\n    this.tail = entry;\n    ++this.length;\n  };\n\n  BufferList.prototype.unshift = function unshift(v) {\n    var entry = { data: v, next: this.head };\n    if (this.length === 0) this.tail = entry;\n    this.head = entry;\n    ++this.length;\n  };\n\n  BufferList.prototype.shift = function shift() {\n    if (this.length === 0) return;\n    var ret = this.head.data;\n    if (this.length === 1) this.head = this.tail = null;else this.head = this.head.next;\n    --this.length;\n    return ret;\n  };\n\n  BufferList.prototype.clear = function clear() {\n    this.head = this.tail = null;\n    this.length = 0;\n  };\n\n  BufferList.prototype.join = function join(s) {\n    if (this.length === 0) return '';\n    var p = this.head;\n    var ret = '' + p.data;\n    while (p = p.next) {\n      ret += s + p.data;\n    }return ret;\n  };\n\n  BufferList.prototype.concat = function concat(n) {\n    if (this.length === 0) return Buffer.alloc(0);\n    if (this.length === 1) return this.head.data;\n    var ret = Buffer.allocUnsafe(n >>> 0);\n    var p = this.head;\n    var i = 0;\n    while (p) {\n      copyBuffer(p.data, ret, i);\n      i += p.data.length;\n      p = p.next;\n    }\n    return ret;\n  };\n\n  return BufferList;\n}();\n\nif (util && util.inspect && util.inspect.custom) {\n  module.exports.prototype[util.inspect.custom] = function () {\n    var obj = util.inspect({ length: this.length });\n    return this.constructor.name + ' ' + obj;\n  };\n}","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","\n/**\n * Module exports.\n */\n\nmodule.exports = deprecate;\n\n/**\n * Mark that a method should not be used.\n * Returns a modified function which warns once by default.\n *\n * If `localStorage.noDeprecation = true` is set, then it is a no-op.\n *\n * If `localStorage.throwDeprecation = true` is set, then deprecated functions\n * will throw an Error when invoked.\n *\n * If `localStorage.traceDeprecation = true` is set, then deprecated functions\n * will invoke `console.trace()` instead of `console.error()`.\n *\n * @param {Function} fn - the function to deprecate\n * @param {String} msg - the string to print to the console when `fn` is invoked\n * @returns {Function} a new \"deprecated\" version of `fn`\n * @api public\n */\n\nfunction deprecate (fn, msg) {\n  if (config('noDeprecation')) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (config('throwDeprecation')) {\n        throw new Error(msg);\n      } else if (config('traceDeprecation')) {\n        console.trace(msg);\n      } else {\n        console.warn(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n}\n\n/**\n * Checks `localStorage` for boolean values for the given `name`.\n *\n * @param {String} name\n * @returns {Boolean}\n * @api private\n */\n\nfunction config (name) {\n  // accessing global.localStorage can trigger a DOMException in sandboxed iframes\n  try {\n    if (!global.localStorage) return false;\n  } catch (_) {\n    return false;\n  }\n  var val = global.localStorage[name];\n  if (null == val) return false;\n  return String(val).toLowerCase() === 'true';\n}\n","/* eslint-disable node/no-deprecated-api */\nvar buffer = require('buffer')\nvar Buffer = buffer.Buffer\n\n// alternative to using Object.keys for old browsers\nfunction copyProps (src, dst) {\n  for (var key in src) {\n    dst[key] = src[key]\n  }\n}\nif (Buffer.from && Buffer.alloc && Buffer.allocUnsafe && Buffer.allocUnsafeSlow) {\n  module.exports = buffer\n} else {\n  // Copy properties from require('buffer')\n  copyProps(buffer, exports)\n  exports.Buffer = SafeBuffer\n}\n\nfunction SafeBuffer (arg, encodingOrOffset, length) {\n  return Buffer(arg, encodingOrOffset, length)\n}\n\nSafeBuffer.prototype = Object.create(Buffer.prototype)\n\n// Copy static methods from Buffer\ncopyProps(Buffer, SafeBuffer)\n\nSafeBuffer.from = function (arg, encodingOrOffset, length) {\n  if (typeof arg === 'number') {\n    throw new TypeError('Argument must not be a number')\n  }\n  return Buffer(arg, encodingOrOffset, length)\n}\n\nSafeBuffer.alloc = function (size, fill, encoding) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  var buf = Buffer(size)\n  if (fill !== undefined) {\n    if (typeof encoding === 'string') {\n      buf.fill(fill, encoding)\n    } else {\n      buf.fill(fill)\n    }\n  } else {\n    buf.fill(0)\n  }\n  return buf\n}\n\nSafeBuffer.allocUnsafe = function (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  return Buffer(size)\n}\n\nSafeBuffer.allocUnsafeSlow = function (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  return buffer.SlowBuffer(size)\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a passthrough stream.\n// basically just the most minimal sort of Transform stream.\n// Every written chunk gets output as-is.\n\n'use strict';\n\nmodule.exports = PassThrough;\n\nvar Transform = require('./_stream_transform');\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nutil.inherits(PassThrough, Transform);\n\nfunction PassThrough(options) {\n  if (!(this instanceof PassThrough)) return new PassThrough(options);\n\n  Transform.call(this, options);\n}\n\nPassThrough.prototype._transform = function (chunk, encoding, cb) {\n  cb(null, chunk);\n};","module.exports = require('./lib/_stream_writable.js');\n","module.exports = require('./lib/_stream_duplex.js');\n","module.exports = require('./readable').Transform\n","module.exports = require('./readable').PassThrough\n","/*\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\nvar DEFAULT_PARSER = 'sax';\n\nexports.DEFAULT_PARSER = DEFAULT_PARSER;\n","const schemaResponse = fetch(__ASSET_PREFIX__ + 'assets/mei-all.rng');\nconst Worker: WorkerConstructable = require('./Worker.js');\nlet worker: Worker, schema: string, statusField: HTMLSpanElement;\n\ninterface WorkerConstructable {\n  new (): Worker;\n}\n\n/**\n * Update the UI with the validation results. Called when the WebWorker finishes validating.\n */\nfunction updateUI (message: { data: string[] }): void {\n  const errors = message.data;\n  if (errors === null) {\n    statusField.textContent = 'VALID';\n    statusField.style.color = 'green';\n    for (const child of statusField.children) {\n      child.remove();\n    }\n  } else {\n    let log = '';\n    errors.forEach(line => {\n      log += line + '\\n';\n    });\n    statusField.textContent = '';\n    statusField.style.color = 'red';\n    const link = document.createElement('a');\n    link.setAttribute('href', 'data:text/plain;charset=utf-8,' +\n      encodeURIComponent(log));\n    link.setAttribute('download', 'validation.log');\n    link.textContent = 'INVALID';\n    statusField.appendChild(link);\n  }\n}\n\n/**\n * Add the validation information to the display and create the WebWorker\n * for validation MEI.\n */\nexport async function init (): Promise<void> {\n  const displayContents = document.getElementById('displayContents');\n  if (displayContents !== null) {\n    const panelBlock = document.createElement('div');\n    panelBlock.classList.add('panel-block');\n    const pNotif = document.createElement('p');\n    pNotif.textContent = 'MEI Status: ';\n    const span = document.createElement('span');\n    span.id = 'validation_status';\n    span.textContent = 'unknown';\n    pNotif.appendChild(span);\n    panelBlock.appendChild(pNotif);\n    displayContents.appendChild(panelBlock);\n    statusField = document.getElementById('validation_status');\n    worker = new Worker();\n    worker.onmessage = updateUI;\n  }\n}\n\n/**\n * Send the contents of an MEI file to the WebWorker for validation.\n * @param {string} meiData\n */\nexport async function sendForValidation (meiData: string): Promise<void> {\n  if (statusField === undefined) {\n    return;\n  }\n  if (schema === undefined) {\n    const response = await schemaResponse;\n    schema = await response.text();\n  }\n  statusField.textContent = 'checking...';\n  statusField.style.color = 'gray';\n  worker.postMessage({\n    mei: meiData,\n    schema: schema\n  });\n}\n\n/**\n * Update the message on a blank page when there is no MEI.\n */\nexport function blankPage (): void {\n  for (const child of statusField.children) {\n    child.remove();\n  }\n  statusField.textContent = 'No MEI';\n  statusField.style.color = 'color:gray';\n}\n","module.exports = function() {\n  return new Worker(\"/Neon/Neon-gh/\" + \"4a6820e001c1066639b7.worker.js\");\n};","import { VerovioMessage } from './Types';\nconst VerovioWorker: WorkerConstructable = require('./VerovioWorker.js');\n\ninterface WorkerConstructable {\n  new (): Worker;\n}\n\n/**\n * A wrapper around the verovio web worker to permit mocking in tests.\n */\nexport default class VerovioWrapper {\n  verovioWorker: Worker;\n  constructor () {\n    this.verovioWorker = new VerovioWorker();\n  }\n\n  /**\n   * Set an event listener onto the actual web worker.\n   */\n  addEventListener (type: string, handler: EventListenerOrEventListenerObject): void {\n    return this.verovioWorker.addEventListener(type, handler);\n  }\n\n  /**\n   * Send a message to the actual web worker.\n   */\n  postMessage (message: VerovioMessage): void {\n    return this.verovioWorker.postMessage(message);\n  }\n}\n","module.exports = function() {\n  return new Worker(\"/Neon/Neon-gh/\" + \"9ead383fc4b5f2e6b26e.worker.js\");\n};","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","import { NeonManifest } from '../Types';\nconst NeonSchema = require('./manifest/NeonSchema.json');\nconst NeonContext = require('./manifest/context.json');\n\nimport { validate } from 'jsonschema';\n/**\n * Check if the provided Neon manifest is parseable.\n * @param {string} manifestString - The Neon manifest as a string.\n */\nexport function parseManifest (manifestString: NeonManifest): boolean {\n  const results = validate(manifestString, NeonSchema);\n  const instance = results.instance;\n  if (results.errors.length > 0) {\n    console.error(results.errors);\n    return false;\n  }\n  const context = instance['@context'];\n  if (context === 'https://ddmal.music.mcgill.ca/Neon/contexts/1/manifest.jsonld') {\n    return true;\n  }\n  if ((context[0] === NeonContext[0]) &&\n      (context[1]['schema'] === NeonContext[1]['schema']) &&\n      (context[1]['title'] === NeonContext[1]['title']) &&\n      (context[1]['timestamp'] === NeonContext[1]['timestamp']) &&\n      (context[1]['image']['@id'] === NeonContext[1]['image']['@id']) &&\n      (context[1]['image']['@type'] === NeonContext[1]['image']['@type']) &&\n      (context[1]['mei_annotations']['@id'] === NeonContext[1]['mei_annotations']['@id']) &&\n      (context[1]['mei_annotations']['@type'] === NeonContext[1]['mei_annotations']['@type']) &&\n      (context[1]['mei_annotations']['@container'] === NeonContext[1]['mei_annotations']['@container'])) {\n    return true;\n  } else {\n    console.error('Context mismatch');\n    console.error(context);\n    console.error(NeonContext);\n    return false;\n  }\n}\n","'use strict';\n\nvar Validator = module.exports.Validator = require('./validator');\n\nmodule.exports.ValidatorResult = require('./helpers').ValidatorResult;\nmodule.exports.ValidationError = require('./helpers').ValidationError;\nmodule.exports.SchemaError = require('./helpers').SchemaError;\nmodule.exports.SchemaScanResult = require('./scan').SchemaScanResult;\nmodule.exports.scan = require('./scan').scan;\n\nmodule.exports.validate = function (instance, schema, options) {\n  var v = new Validator();\n  return v.validate(instance, schema, options);\n};\n","'use strict';\n\nvar urilib = require('url');\n\nvar attribute = require('./attribute');\nvar helpers = require('./helpers');\nvar scanSchema = require('./scan').scan;\nvar ValidatorResult = helpers.ValidatorResult;\nvar SchemaError = helpers.SchemaError;\nvar SchemaContext = helpers.SchemaContext;\n//var anonymousBase = 'vnd.jsonschema:///';\nvar anonymousBase = '/';\n\n/**\n * Creates a new Validator object\n * @name Validator\n * @constructor\n */\nvar Validator = function Validator () {\n  // Allow a validator instance to override global custom formats or to have their\n  // own custom formats.\n  this.customFormats = Object.create(Validator.prototype.customFormats);\n  this.schemas = {};\n  this.unresolvedRefs = [];\n\n  // Use Object.create to make this extensible without Validator instances stepping on each other's toes.\n  this.types = Object.create(types);\n  this.attributes = Object.create(attribute.validators);\n};\n\n// Allow formats to be registered globally.\nValidator.prototype.customFormats = {};\n\n// Hint at the presence of a property\nValidator.prototype.schemas = null;\nValidator.prototype.types = null;\nValidator.prototype.attributes = null;\nValidator.prototype.unresolvedRefs = null;\n\n/**\n * Adds a schema with a certain urn to the Validator instance.\n * @param schema\n * @param urn\n * @return {Object}\n */\nValidator.prototype.addSchema = function addSchema (schema, base) {\n  var self = this;\n  if (!schema) {\n    return null;\n  }\n  var scan = scanSchema(base||anonymousBase, schema);\n  var ourUri = base || schema.id;\n  for(var uri in scan.id){\n    this.schemas[uri] = scan.id[uri];\n  }\n  for(var uri in scan.ref){\n    this.unresolvedRefs.push(uri);\n  }\n  this.unresolvedRefs = this.unresolvedRefs.filter(function(uri){\n    return typeof self.schemas[uri]==='undefined';\n  });\n  return this.schemas[ourUri];\n};\n\nValidator.prototype.addSubSchemaArray = function addSubSchemaArray(baseuri, schemas) {\n  if(!(schemas instanceof Array)) return;\n  for(var i=0; i<schemas.length; i++){\n    this.addSubSchema(baseuri, schemas[i]);\n  }\n};\n\nValidator.prototype.addSubSchemaObject = function addSubSchemaArray(baseuri, schemas) {\n  if(!schemas || typeof schemas!='object') return;\n  for(var p in schemas){\n    this.addSubSchema(baseuri, schemas[p]);\n  }\n};\n\n\n\n/**\n * Sets all the schemas of the Validator instance.\n * @param schemas\n */\nValidator.prototype.setSchemas = function setSchemas (schemas) {\n  this.schemas = schemas;\n};\n\n/**\n * Returns the schema of a certain urn\n * @param urn\n */\nValidator.prototype.getSchema = function getSchema (urn) {\n  return this.schemas[urn];\n};\n\n/**\n * Validates instance against the provided schema\n * @param instance\n * @param schema\n * @param [options]\n * @param [ctx]\n * @return {Array}\n */\nValidator.prototype.validate = function validate (instance, schema, options, ctx) {\n  if (!options) {\n    options = {};\n  }\n  var propertyName = options.propertyName || 'instance';\n  // This will work so long as the function at uri.resolve() will resolve a relative URI to a relative URI\n  var base = urilib.resolve(options.base||anonymousBase, schema.id||'');\n  if(!ctx){\n    ctx = new SchemaContext(schema, options, propertyName, base, Object.create(this.schemas));\n    if (!ctx.schemas[base]) {\n      ctx.schemas[base] = schema;\n    }\n    var found = scanSchema(base, schema);\n    for(var n in found.id){\n      var sch = found.id[n];\n      ctx.schemas[n] = sch;\n    }\n  }\n  if (schema) {\n    var result = this.validateSchema(instance, schema, options, ctx);\n    if (!result) {\n      throw new Error('Result undefined');\n    }\n    return result;\n  }\n  throw new SchemaError('no schema specified', schema);\n};\n\n/**\n* @param Object schema\n* @return mixed schema uri or false\n*/\nfunction shouldResolve(schema) {\n  var ref = (typeof schema === 'string') ? schema : schema.$ref;\n  if (typeof ref=='string') return ref;\n  return false;\n}\n\n/**\n * Validates an instance against the schema (the actual work horse)\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @private\n * @return {ValidatorResult}\n */\nValidator.prototype.validateSchema = function validateSchema (instance, schema, options, ctx) {\n  var result = new ValidatorResult(instance, schema, options, ctx);\n\n    // Support for the true/false schemas\n  if(typeof schema==='boolean') {\n    if(schema===true){\n      // `true` is always valid\n      schema = {};\n    }else if(schema===false){\n      // `false` is always invalid\n      schema = {type: []};\n    }\n  }else if(!schema){\n    // This might be a string\n    throw new Error(\"schema is undefined\");\n  }\n\n  if (schema['extends']) {\n    if (schema['extends'] instanceof Array) {\n      var schemaobj = {schema: schema, ctx: ctx};\n      schema['extends'].forEach(this.schemaTraverser.bind(this, schemaobj));\n      schema = schemaobj.schema;\n      schemaobj.schema = null;\n      schemaobj.ctx = null;\n      schemaobj = null;\n    } else {\n      schema = helpers.deepMerge(schema, this.superResolve(schema['extends'], ctx));\n    }\n  }\n\n  // If passed a string argument, load that schema URI\n  var switchSchema;\n  if (switchSchema = shouldResolve(schema)) {\n    var resolved = this.resolve(schema, switchSchema, ctx);\n    var subctx = new SchemaContext(resolved.subschema, options, ctx.propertyPath, resolved.switchSchema, ctx.schemas);\n    return this.validateSchema(instance, resolved.subschema, options, subctx);\n  }\n\n  var skipAttributes = options && options.skipAttributes || [];\n  // Validate each schema attribute against the instance\n  for (var key in schema) {\n    if (!attribute.ignoreProperties[key] && skipAttributes.indexOf(key) < 0) {\n      var validatorErr = null;\n      var validator = this.attributes[key];\n      if (validator) {\n        validatorErr = validator.call(this, instance, schema, options, ctx);\n      } else if (options.allowUnknownAttributes === false) {\n        // This represents an error with the schema itself, not an invalid instance\n        throw new SchemaError(\"Unsupported attribute: \" + key, schema);\n      }\n      if (validatorErr) {\n        result.importErrors(validatorErr);\n      }\n    }\n  }\n\n  if (typeof options.rewrite == 'function') {\n    var value = options.rewrite.call(this, instance, schema, options, ctx);\n    result.instance = value;\n  }\n  return result;\n};\n\n/**\n* @private\n* @param Object schema\n* @param SchemaContext ctx\n* @returns Object schema or resolved schema\n*/\nValidator.prototype.schemaTraverser = function schemaTraverser (schemaobj, s) {\n  schemaobj.schema = helpers.deepMerge(schemaobj.schema, this.superResolve(s, schemaobj.ctx));\n}\n\n/**\n* @private\n* @param Object schema\n* @param SchemaContext ctx\n* @returns Object schema or resolved schema\n*/\nValidator.prototype.superResolve = function superResolve (schema, ctx) {\n  var ref;\n  if(ref = shouldResolve(schema)) {\n    return this.resolve(schema, ref, ctx).subschema;\n  }\n  return schema;\n}\n\n/**\n* @private\n* @param Object schema\n* @param Object switchSchema\n* @param SchemaContext ctx\n* @return Object resolved schemas {subschema:String, switchSchema: String}\n* @throws SchemaError\n*/\nValidator.prototype.resolve = function resolve (schema, switchSchema, ctx) {\n  switchSchema = ctx.resolve(switchSchema);\n  // First see if the schema exists under the provided URI\n  if (ctx.schemas[switchSchema]) {\n    return {subschema: ctx.schemas[switchSchema], switchSchema: switchSchema};\n  }\n  // Else try walking the property pointer\n  var parsed = urilib.parse(switchSchema);\n  var fragment = parsed && parsed.hash;\n  var document = fragment && fragment.length && switchSchema.substr(0, switchSchema.length - fragment.length);\n  if (!document || !ctx.schemas[document]) {\n    throw new SchemaError(\"no such schema <\" + switchSchema + \">\", schema);\n  }\n  var subschema = helpers.objectGetPath(ctx.schemas[document], fragment.substr(1));\n  if(subschema===undefined){\n    throw new SchemaError(\"no such schema \" + fragment + \" located in <\" + document + \">\", schema);\n  }\n  return {subschema: subschema, switchSchema: switchSchema};\n};\n\n/**\n * Tests whether the instance if of a certain type.\n * @private\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @param type\n * @return {boolean}\n */\nValidator.prototype.testType = function validateType (instance, schema, options, ctx, type) {\n  if (typeof this.types[type] == 'function') {\n    return this.types[type].call(this, instance);\n  }\n  if (type && typeof type == 'object') {\n    var res = this.validateSchema(instance, type, options, ctx);\n    return res === undefined || !(res && res.errors.length);\n  }\n  // Undefined or properties not on the list are acceptable, same as not being defined\n  return true;\n};\n\nvar types = Validator.prototype.types = {};\ntypes.string = function testString (instance) {\n  return typeof instance == 'string';\n};\ntypes.number = function testNumber (instance) {\n  // isFinite returns false for NaN, Infinity, and -Infinity\n  return typeof instance == 'number' && isFinite(instance);\n};\ntypes.integer = function testInteger (instance) {\n  return (typeof instance == 'number') && instance % 1 === 0;\n};\ntypes.boolean = function testBoolean (instance) {\n  return typeof instance == 'boolean';\n};\ntypes.array = function testArray (instance) {\n  return Array.isArray(instance);\n};\ntypes['null'] = function testNull (instance) {\n  return instance === null;\n};\ntypes.date = function testDate (instance) {\n  return instance instanceof Date;\n};\ntypes.any = function testAny (instance) {\n  return true;\n};\ntypes.object = function testObject (instance) {\n  // TODO: fix this - see #15\n  return instance && (typeof instance) === 'object' && !(instance instanceof Array) && !(instance instanceof Date);\n};\n\nmodule.exports = Validator;\n","/*! https://mths.be/punycode v1.4.1 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports &&\n\t\t!exports.nodeType && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\t!module.nodeType && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (\n\t\tfreeGlobal.global === freeGlobal ||\n\t\tfreeGlobal.window === freeGlobal ||\n\t\tfreeGlobal.self === freeGlobal\n\t) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^\\x20-\\x7E]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow new RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\tvar result = [];\n\t\twhile (length--) {\n\t\t\tresult[length] = fn(array[length]);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t * addresses.\n\t * @private\n\t * @param {String} domain The domain name or email address.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\tvar parts = string.split('@');\n\t\tvar result = '';\n\t\tif (parts.length > 1) {\n\t\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t\t// the local part (i.e. everything up to `@`) intact.\n\t\t\tresult = parts[0] + '@';\n\t\t\tstring = parts[1];\n\t\t}\n\t\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\t\tstring = string.replace(regexSeparators, '\\x2E');\n\t\tvar labels = string.split('.');\n\t\tvar encoded = map(labels, fn).join('.');\n\t\treturn result + encoded;\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * https://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t * Punycode string of ASCII-only symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name or an email address\n\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t * it doesn't matter if you call it on a string that has already been\n\t * converted to Unicode.\n\t * @memberOf punycode\n\t * @param {String} input The Punycoded domain name or email address to\n\t * convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name or an email address to\n\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t * ASCII.\n\t * @memberOf punycode\n\t * @param {String} input The domain name or email address to convert, as a\n\t * Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name or\n\t * email address.\n\t */\n\tfunction toASCII(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.4.1',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && freeModule) {\n\t\tif (module.exports == freeExports) {\n\t\t\t// in Node.js, io.js, or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else {\n\t\t\t// in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n","module.exports = function(module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function() {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","'use strict';\n\nmodule.exports = {\n  isString: function(arg) {\n    return typeof(arg) === 'string';\n  },\n  isObject: function(arg) {\n    return typeof(arg) === 'object' && arg !== null;\n  },\n  isNull: function(arg) {\n    return arg === null;\n  },\n  isNullOrUndefined: function(arg) {\n    return arg == null;\n  }\n};\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n","'use strict';\n\nvar helpers = require('./helpers');\n\n/** @type ValidatorResult */\nvar ValidatorResult = helpers.ValidatorResult;\n/** @type SchemaError */\nvar SchemaError = helpers.SchemaError;\n\nvar attribute = {};\n\nattribute.ignoreProperties = {\n  // informative properties\n  'id': true,\n  'default': true,\n  'description': true,\n  'title': true,\n  // arguments to other properties\n  'exclusiveMinimum': true,\n  'exclusiveMaximum': true,\n  'additionalItems': true,\n  // special-handled properties\n  '$schema': true,\n  '$ref': true,\n  'extends': true\n};\n\n/**\n * @name validators\n */\nvar validators = attribute.validators = {};\n\n/**\n * Validates whether the instance if of a certain type\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {ValidatorResult|null}\n */\nvalidators.type = function validateType (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var types = Array.isArray(schema.type) ? schema.type : [schema.type];\n  if (!types.some(this.testType.bind(this, instance, schema, options, ctx))) {\n    var list = types.map(function (v) {\n      return v.id && ('<' + v.id + '>') || (v+'');\n    });\n    result.addError({\n      name: 'type',\n      argument: list,\n      message: \"is not of a type(s) \" + list,\n    });\n  }\n  return result;\n};\n\nfunction testSchemaNoThrow(instance, options, ctx, callback, schema){\n  var throwError = options.throwError;\n  options.throwError = false;\n  var res = this.validateSchema(instance, schema, options, ctx);\n  options.throwError = throwError;\n\n  if (! res.valid && callback instanceof Function) {\n    callback(res);\n  }\n  return res.valid;\n}\n\n/**\n * Validates whether the instance matches some of the given schemas\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {ValidatorResult|null}\n */\nvalidators.anyOf = function validateAnyOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var inner = new ValidatorResult(instance, schema, options, ctx);\n  if (!Array.isArray(schema.anyOf)){\n    throw new SchemaError(\"anyOf must be an array\");\n  }\n  if (!schema.anyOf.some(\n    testSchemaNoThrow.bind(\n      this, instance, options, ctx, function(res){inner.importErrors(res);}\n      ))) {\n    var list = schema.anyOf.map(function (v, i) {\n      return (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n    });\n    if (options.nestedErrors) {\n      result.importErrors(inner);\n    }\n    result.addError({\n      name: 'anyOf',\n      argument: list,\n      message: \"is not any of \" + list.join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance matches every given schema\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.allOf = function validateAllOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema.allOf)){\n    throw new SchemaError(\"allOf must be an array\");\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var self = this;\n  schema.allOf.forEach(function(v, i){\n    var valid = self.validateSchema(instance, v, options, ctx);\n    if(!valid.valid){\n      var msg = (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n      result.addError({\n        name: 'allOf',\n        argument: { id: msg, length: valid.errors.length, valid: valid },\n        message: 'does not match allOf schema ' + msg + ' with ' + valid.errors.length + ' error[s]:',\n      });\n      result.importErrors(valid);\n    }\n  });\n  return result;\n};\n\n/**\n * Validates whether the instance matches exactly one of the given schemas\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.oneOf = function validateOneOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema.oneOf)){\n    throw new SchemaError(\"oneOf must be an array\");\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var inner = new ValidatorResult(instance, schema, options, ctx);\n  var count = schema.oneOf.filter(\n    testSchemaNoThrow.bind(\n      this, instance, options, ctx, function(res) {inner.importErrors(res);}\n      ) ).length;\n  var list = schema.oneOf.map(function (v, i) {\n    return (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n  });\n  if (count!==1) {\n    if (options.nestedErrors) {\n      result.importErrors(inner);\n    }\n    result.addError({\n      name: 'oneOf',\n      argument: list,\n      message: \"is not exactly one from \" + list.join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates properties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.properties = function validateProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var properties = schema.properties || {};\n  for (var property in properties) {\n    if (typeof options.preValidateProperty == 'function') {\n      options.preValidateProperty(instance, property, properties[property], options, ctx);\n    }\n\n    var prop = Object.hasOwnProperty.call(instance, property) ? instance[property] : undefined;\n    var res = this.validateSchema(prop, properties[property], options, ctx.makeChild(properties[property], property));\n    if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n    result.importErrors(res);\n  }\n  return result;\n};\n\n/**\n * Test a specific property within in instance against the additionalProperties schema attribute\n * This ignores properties with definitions in the properties schema attribute, but no other attributes.\n * If too many more types of property-existance tests pop up they may need their own class of tests (like `type` has)\n * @private\n * @return {boolean}\n */\nfunction testAdditionalProperty (instance, schema, options, ctx, property, result) {\n  if(!this.types.object(instance)) return;\n  if (schema.properties && schema.properties[property] !== undefined) {\n    return;\n  }\n  if (schema.additionalProperties === false) {\n    result.addError({\n      name: 'additionalProperties',\n      argument: property,\n      message: \"additionalProperty \" + JSON.stringify(property) + \" exists in instance when not allowed\",\n    });\n  } else {\n    var additionalProperties = schema.additionalProperties || {};\n\n    if (typeof options.preValidateProperty == 'function') {\n      options.preValidateProperty(instance, property, additionalProperties, options, ctx);\n    }\n\n    var res = this.validateSchema(instance[property], additionalProperties, options, ctx.makeChild(additionalProperties, property));\n    if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n    result.importErrors(res);\n  }\n}\n\n/**\n * Validates patternProperties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.patternProperties = function validatePatternProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var patternProperties = schema.patternProperties || {};\n\n  for (var property in instance) {\n    var test = true;\n    for (var pattern in patternProperties) {\n      var expr = new RegExp(pattern);\n      if (!expr.test(property)) {\n        continue;\n      }\n      test = false;\n\n      if (typeof options.preValidateProperty == 'function') {\n        options.preValidateProperty(instance, property, patternProperties[pattern], options, ctx);\n      }\n\n      var res = this.validateSchema(instance[property], patternProperties[pattern], options, ctx.makeChild(patternProperties[pattern], property));\n      if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n      result.importErrors(res);\n    }\n    if (test) {\n      testAdditionalProperty.call(this, instance, schema, options, ctx, property, result);\n    }\n  }\n\n  return result;\n};\n\n/**\n * Validates additionalProperties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.additionalProperties = function validateAdditionalProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  // if patternProperties is defined then we'll test when that one is called instead\n  if (schema.patternProperties) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  for (var property in instance) {\n    testAdditionalProperty.call(this, instance, schema, options, ctx, property, result);\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at least of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minProperties = function validateMinProperties (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var keys = Object.keys(instance);\n  if (!(keys.length >= schema.minProperties)) {\n    result.addError({\n      name: 'minProperties',\n      argument: schema.minProperties,\n      message: \"does not meet minimum property length of \" + schema.minProperties,\n    })\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at most of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxProperties = function validateMaxProperties (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var keys = Object.keys(instance);\n  if (!(keys.length <= schema.maxProperties)) {\n    result.addError({\n      name: 'maxProperties',\n      argument: schema.maxProperties,\n      message: \"does not meet maximum property length of \" + schema.maxProperties,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates items when instance is an array\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.items = function validateItems (instance, schema, options, ctx) {\n  var self = this;\n  if (!this.types.array(instance)) return;\n  if (!schema.items) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  instance.every(function (value, i) {\n    var items = Array.isArray(schema.items) ? (schema.items[i] || schema.additionalItems) : schema.items;\n    if (items === undefined) {\n      return true;\n    }\n    if (items === false) {\n      result.addError({\n        name: 'items',\n        message: \"additionalItems not permitted\",\n      });\n      return false;\n    }\n    var res = self.validateSchema(value, items, options, ctx.makeChild(items, i));\n    if(res.instance !== result.instance[i]) result.instance[i] = res.instance;\n    result.importErrors(res);\n    return true;\n  });\n  return result;\n};\n\n/**\n * Validates minimum and exclusiveMinimum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minimum = function validateMinimum (instance, schema, options, ctx) {\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var valid = true;\n  if (schema.exclusiveMinimum && schema.exclusiveMinimum === true) {\n    valid = instance > schema.minimum;\n  } else {\n    valid = instance >= schema.minimum;\n  }\n  if (!valid) {\n    result.addError({\n      name: 'minimum',\n      argument: schema.minimum,\n      message: \"must have a minimum value of \" + schema.minimum,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates maximum and exclusiveMaximum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maximum = function validateMaximum (instance, schema, options, ctx) {\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var valid;\n  if (schema.exclusiveMaximum && schema.exclusiveMaximum === true) {\n    valid = instance < schema.maximum;\n  } else {\n    valid = instance <= schema.maximum;\n  }\n  if (!valid) {\n    result.addError({\n      name: 'maximum',\n      argument: schema.maximum,\n      message: \"must have a maximum value of \" + schema.maximum,\n    });\n  }\n  return result;\n};\n\n/**\n * Perform validation for multipleOf and divisibleBy, which are essentially the same.\n * @param instance\n * @param schema\n * @param validationType\n * @param errorMessage\n * @returns {String|null}\n */\nvar validateMultipleOfOrDivisbleBy = function validateMultipleOfOrDivisbleBy (instance, schema, options, ctx, validationType, errorMessage) {\n  if (!this.types.number(instance)) return;\n\n  var validationArgument = schema[validationType];\n  if (validationArgument == 0) {\n    throw new SchemaError(validationType + \" cannot be zero\");\n  }\n\n  var result = new ValidatorResult(instance, schema, options, ctx);\n\n  var instanceDecimals = helpers.getDecimalPlaces(instance);\n  var divisorDecimals = helpers.getDecimalPlaces(validationArgument);\n\n  var maxDecimals = Math.max(instanceDecimals , divisorDecimals);\n  var multiplier = Math.pow(10, maxDecimals);\n\n  if (Math.round(instance * multiplier) % Math.round(validationArgument * multiplier) !== 0) {\n    result.addError({\n      name: validationType,\n      argument:  validationArgument,\n      message: errorMessage + JSON.stringify(validationArgument)\n    });\n  }\n\n  return result;\n};\n\n/**\n * Validates divisibleBy when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.multipleOf = function validateMultipleOf (instance, schema, options, ctx) {\n return validateMultipleOfOrDivisbleBy.call(this, instance, schema, options, ctx, \"multipleOf\", \"is not a multiple of (divisible by) \");\n};\n\n/**\n * Validates multipleOf when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.divisibleBy = function validateDivisibleBy (instance, schema, options, ctx) {\n  return validateMultipleOfOrDivisbleBy.call(this, instance, schema, options, ctx, \"divisibleBy\", \"is not divisible by (multiple of) \");\n};\n\n/**\n * Validates whether the instance value is present.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.required = function validateRequired (instance, schema, options, ctx) {\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (instance === undefined && schema.required === true) {\n    // A boolean form is implemented for reverse-compatability with schemas written against older drafts\n    result.addError({\n      name: 'required',\n      message: \"is required\"\n    });\n  } else if (this.types.object(instance) && Array.isArray(schema.required)) {\n    schema.required.forEach(function(n){\n      if(instance[n]===undefined){\n        result.addError({\n          name: 'required',\n          argument: n,\n          message: \"requires property \" + JSON.stringify(n),\n        });\n      }\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value matches the regular expression, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.pattern = function validatePattern (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!instance.match(schema.pattern)) {\n    result.addError({\n      name: 'pattern',\n      argument: schema.pattern,\n      message: \"does not match pattern \" + JSON.stringify(schema.pattern),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is of a certain defined format or a custom\n * format.\n * The following formats are supported for string types:\n *   - date-time\n *   - date\n *   - time\n *   - ip-address\n *   - ipv6\n *   - uri\n *   - color\n *   - host-name\n *   - alpha\n *   - alpha-numeric\n *   - utc-millisec\n * @param instance\n * @param schema\n * @param [options]\n * @param [ctx]\n * @return {String|null}\n */\nvalidators.format = function validateFormat (instance, schema, options, ctx) {\n  if (instance===undefined) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!result.disableFormat && !helpers.isFormat(instance, schema.format, this)) {\n    result.addError({\n      name: 'format',\n      argument: schema.format,\n      message: \"does not conform to the \" + JSON.stringify(schema.format) + \" format\",\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at least of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minLength = function validateMinLength (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var hsp = instance.match(/[\\uDC00-\\uDFFF]/g);\n  var length = instance.length - (hsp ? hsp.length : 0);\n  if (!(length >= schema.minLength)) {\n    result.addError({\n      name: 'minLength',\n      argument: schema.minLength,\n      message: \"does not meet minimum length of \" + schema.minLength,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at most of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxLength = function validateMaxLength (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  // TODO if this was already computed in \"minLength\", use that value instead of re-computing\n  var hsp = instance.match(/[\\uDC00-\\uDFFF]/g);\n  var length = instance.length - (hsp ? hsp.length : 0);\n  if (!(length <= schema.maxLength)) {\n    result.addError({\n      name: 'maxLength',\n      argument: schema.maxLength,\n      message: \"does not meet maximum length of \" + schema.maxLength,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether instance contains at least a minimum number of items, when the instance is an Array.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minItems = function validateMinItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!(instance.length >= schema.minItems)) {\n    result.addError({\n      name: 'minItems',\n      argument: schema.minItems,\n      message: \"does not meet minimum length of \" + schema.minItems,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether instance contains no more than a maximum number of items, when the instance is an Array.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxItems = function validateMaxItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!(instance.length <= schema.maxItems)) {\n    result.addError({\n      name: 'maxItems',\n      argument: schema.maxItems,\n      message: \"does not meet maximum length of \" + schema.maxItems,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates that every item in an instance array is unique, when instance is an array\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.uniqueItems = function validateUniqueItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  function testArrays (v, i, a) {\n    for (var j = i + 1; j < a.length; j++) if (helpers.deepCompareStrict(v, a[j])) {\n      return false;\n    }\n    return true;\n  }\n  if (!instance.every(testArrays)) {\n    result.addError({\n      name: 'uniqueItems',\n      message: \"contains duplicate item\",\n    });\n  }\n  return result;\n};\n\n/**\n * Deep compares arrays for duplicates\n * @param v\n * @param i\n * @param a\n * @private\n * @return {boolean}\n */\nfunction testArrays (v, i, a) {\n  var j, len = a.length;\n  for (j = i + 1, len; j < len; j++) {\n    if (helpers.deepCompareStrict(v, a[j])) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Validates whether there are no duplicates, when the instance is an Array.\n * @param instance\n * @return {String|null}\n */\nvalidators.uniqueItems = function validateUniqueItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!instance.every(testArrays)) {\n    result.addError({\n      name: 'uniqueItems',\n      message: \"contains duplicate item\",\n    });\n  }\n  return result;\n};\n\n/**\n * Validate for the presence of dependency properties, if the instance is an object.\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {null|ValidatorResult}\n */\nvalidators.dependencies = function validateDependencies (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  for (var property in schema.dependencies) {\n    if (instance[property] === undefined) {\n      continue;\n    }\n    var dep = schema.dependencies[property];\n    var childContext = ctx.makeChild(dep, property);\n    if (typeof dep == 'string') {\n      dep = [dep];\n    }\n    if (Array.isArray(dep)) {\n      dep.forEach(function (prop) {\n        if (instance[prop] === undefined) {\n          result.addError({\n            // FIXME there's two different \"dependencies\" errors here with slightly different outputs\n            // Can we make these the same? Or should we create different error types?\n            name: 'dependencies',\n            argument: childContext.propertyPath,\n            message: \"property \" + prop + \" not found, required by \" + childContext.propertyPath,\n          });\n        }\n      });\n    } else {\n      var res = this.validateSchema(instance, dep, options, childContext);\n      if(result.instance !== res.instance) result.instance = res.instance;\n      if (res && res.errors.length) {\n        result.addError({\n          name: 'dependencies',\n          argument: childContext.propertyPath,\n          message: \"does not meet dependency required by \" + childContext.propertyPath,\n        });\n        result.importErrors(res);\n      }\n    }\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is one of the enumerated values.\n *\n * @param instance\n * @param schema\n * @return {ValidatorResult|null}\n */\nvalidators['enum'] = function validateEnum (instance, schema, options, ctx) {\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema['enum'])) {\n    throw new SchemaError(\"enum expects an array\", schema);\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!schema['enum'].some(helpers.deepCompareStrict.bind(null, instance))) {\n    result.addError({\n      name: 'enum',\n      argument: schema['enum'],\n      message: \"is not one of enum values: \" + schema['enum'].map(String).join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance exactly matches a given value\n *\n * @param instance\n * @param schema\n * @return {ValidatorResult|null}\n */\nvalidators['const'] = function validateEnum (instance, schema, options, ctx) {\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!helpers.deepCompareStrict(schema['const'], instance)) {\n    result.addError({\n      name: 'const',\n      argument: schema['const'],\n      message: \"does not exactly match expected constant: \" + schema['const'],\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance if of a prohibited type.\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {null|ValidatorResult}\n */\nvalidators.not = validators.disallow = function validateNot (instance, schema, options, ctx) {\n  var self = this;\n  if(instance===undefined) return null;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var notTypes = schema.not || schema.disallow;\n  if(!notTypes) return null;\n  if(!Array.isArray(notTypes)) notTypes=[notTypes];\n  notTypes.forEach(function (type) {\n    if (self.testType(instance, schema, options, ctx, type)) {\n      var schemaId = type && type.id && ('<' + type.id + '>') || type;\n      result.addError({\n        name: 'not',\n        argument: schemaId,\n        message: \"is of prohibited type \" + schemaId,\n      });\n    }\n  });\n  return result;\n};\n\nmodule.exports = attribute;\n","import * as Notification from './Notification';\nimport NeonView from '../NeonView';\nimport { navbarDropdownMenu, undoRedoPanel } from './EditContents';\nimport { convertStaffToSb } from './ConvertMei';\n\n/**\n * prepare the edit mode button\n */\nexport function prepareEditMode (neonView: NeonView): void {\n  const parent = document.getElementById('dropdown_toggle');\n  const editItem = document.createElement('a');\n  editItem.classList.add('navbar-item');\n  const editButton = document.createElement('button');\n  editButton.classList.add('button');\n  editButton.id = 'edit_mode';\n  editButton.textContent = 'Edit MEI';\n  editItem.appendChild(editButton);\n  parent.appendChild(editItem);\n\n  editButton.addEventListener('click', () => {\n    startEditMode(neonView);\n  });\n}\n\n/**\n * start the basic edit mode features\n * is called when the edit mode button is clicked\n */\nexport function startEditMode (neonView: NeonView): void {\n  const parent: HTMLElement = document.getElementById('dropdown_toggle').parentElement;\n  document.getElementById('dropdown_toggle').remove();\n  parent.prepend(navbarDropdownMenu);\n  document.getElementById('undoRedo_controls').innerHTML = undoRedoPanel;\n  initNavbar(neonView);\n  initUndoRedoPanel(neonView);\n\n  const selectionHighlight = document.createElement('a');\n  const divider = document.createElement('hr');\n  divider.classList.add('dropdown-divider');\n  selectionHighlight.classList.add('dropdown-item');\n  selectionHighlight.id = 'highlight-selection';\n  selectionHighlight.textContent = 'By Selection Mode';\n  (document.getElementsByClassName('dropdown-content'))[0].appendChild(divider);\n  (document.getElementsByClassName('dropdown-content'))[0].appendChild(selectionHighlight);\n}\n\n/**\n * Set listener on switching EditMode button to File dropdown in the navbar.\n */\nexport function initNavbar (neonView: NeonView): void {\n  // setup navbar listeners\n  document.getElementById('save').addEventListener('click', () => {\n    neonView.save().then(() => {\n      Notification.queueNotification('Saved');\n    });\n  });\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === 's') {\n      neonView.save().then(() => {\n        Notification.queueNotification('Saved');\n      });\n    }\n  });\n\n  document.getElementById('export').addEventListener('click', () => {\n    neonView.export().then(manifest => {\n      const link: HTMLAnchorElement = document.createElement('a');\n      link.href = manifest as string;\n      link.download = neonView.name + '.jsonld';\n      document.body.appendChild(link);\n      link.click();\n      link.remove();\n      Notification.queueNotification('Saved');\n    });\n  });\n\n  document.getElementById('revert').addEventListener('click', function () {\n    if (window.confirm('Reverting will cause all changes to be lost. Press OK to continue.')) {\n      neonView.deleteDb().then(() => {\n        window.location.reload();\n      });\n    }\n  });\n  // Download link for MEI\n  // Is an actual file with a valid URI except in local mode where it must be generated.\n  document.getElementById('getmei').addEventListener('click', () => {\n    const uri = neonView.view.getCurrentPageURI();\n    neonView.getPageMEI(uri).then(mei => {\n      const data = 'data:application/mei+xml;base64,' + window.btoa(convertStaffToSb(mei));\n      document.getElementById('getmei').setAttribute('href', data);\n      document.getElementById('getmei').setAttribute('download', neonView.view.getPageName() + '.mei');\n    });\n  });\n}\n\n/**\n * Initialize the undo/redo panel\n */\nexport function initUndoRedoPanel (neonView: NeonView): void {\n  document.getElementById('undo').addEventListener('click', undoHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === 'z' && (evt.ctrlKey || evt.metaKey)) {\n      undoHandler();\n    }\n  });\n\n  document.getElementById('redo').addEventListener('click', redoHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if ((evt.key === 'Z' || (evt.key === 'z' && evt.shiftKey)) && (evt.ctrlKey || evt.metaKey)) {\n      redoHandler();\n    }\n  });\n\n  /**\n   * Tries to undo an action and update the page if it succeeds.\n   */\n  function undoHandler (): void {\n    neonView.undo().then((result: boolean) => {\n      if (result) {\n        neonView.updateForCurrentPage();\n      } else {\n        console.error('Failed to undo action');\n      }\n    });\n  }\n\n  /**\n   * Tries to redo an action and update the page if it succeeds.\n   */\n  function redoHandler (): void {\n    neonView.redo().then((result: boolean) => {\n      if (result) {\n        neonView.updateForCurrentPage();\n      } else {\n        console.error('Failed to redo action');\n      }\n    });\n  }\n}\n","/**\n * Contents of navbar menu after switching to edit mode.\n */\nexport const navbarDropdownMenu: HTMLDivElement = document.createElement('div');\nnavbarDropdownMenu.classList.add('navbar-item', 'has-dropdown', 'is-hoverable');\nconst fileLink = document.createElement('a');\nfileLink.classList.add('navbar-link');\nfileLink.textContent = 'File';\nconst navbarContents = document.createElement('div');\nnavbarContents.classList.add('navbar-dropdown');\nnavbarContents.id = 'navbar-dropdown-options';\nconst contents = [['save', 'Save'], ['export', 'Save and Export to File'],\n  ['getmei', 'Download MEI'], ['revert', 'Revert']];\ncontents.forEach(content => {\n  const item = document.createElement('a');\n  item.id = content[0];\n  item.classList.add('navbar-item');\n  item.textContent = content[1];\n  navbarContents.appendChild(item);\n});\nnavbarDropdownMenu.appendChild(fileLink);\nnavbarDropdownMenu.appendChild(navbarContents);\n\n/**\n * Finalize option in the navbar for rodan\n */\nexport const navbarFinalize =\n    '<a id=\\'finalize\\' class=\\'navbar-item\\'> Finalize MEI </a>';\n\n/**\n * Contents of the undo/redo panel with buttons\n */\nexport const undoRedoPanel: string =\n    '<div class=\\'field has-addons buttons\\' style=\\'overflow-x: auto;\\'>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'undo\\'>Undo</button>' +\n    '<button class=\\'button\\' id=\\'redo\\'>Redo</button></p></a></div>';\n","async function setBody (): Promise<void> {\n  const response = await fetch(__ASSET_PREFIX__ + 'assets/template.html');\n  document.body.innerHTML = await response.text();\n  (document.getElementById('home-link') as HTMLAnchorElement)\n    .href = __LINK_LOCATION__;\n  document.getElementById('neon-version').textContent = __NEON_VERSION__;\n}\n\nexport { setBody as default };\n","import * as d3 from 'd3';\n\nexport class ViewBox {\n  a: number;\n  b: number;\n  c: number;\n  d: number;\n\n  imageHeight: number;\n  imageWidth: number;\n\n  constructor (imageWidth: number, imageHeight: number) {\n    this.a = 0;\n    this.b = 0;\n    this.c = imageWidth;\n    this.d = imageHeight;\n\n    this.imageWidth = imageWidth;\n    this.imageHeight = imageHeight;\n  }\n\n  set (w: number, x: number, y: number, z: number): void {\n    this.a = w;\n    this.b = x;\n    this.c = y;\n    this.d = z;\n  }\n\n  get (): string {\n    return this.a.toString() + ' ' + this.b.toString() + ' ' +\n      this.c + ' ' + this.d;\n  }\n\n  zoomTo (k: number): void {\n    const zoomHeight = (this.imageHeight / k);\n    const zoomWidth = (this.imageWidth / k);\n\n    this.c = zoomWidth;\n    this.d = zoomHeight;\n  }\n\n  getZoom (): number {\n    return this.imageWidth / this.c;\n  }\n\n  translate (xDiff: number, yDiff: number): void {\n    this.a += xDiff;\n    this.b += yDiff;\n  }\n}\n\nexport class ZoomHandler {\n  dragCoordinates: DOMPoint;\n  viewBox: ViewBox;\n  matrix: DOMMatrix;\n\n  /**\n   * reset the zoom and pan of the SVG viewbox\n   */\n  resetZoomAndPan (): void {\n    const bgimg = document.getElementById('bgimg') as HTMLImageElement;\n    this.viewBox = new ViewBox(parseInt(bgimg.getAttribute('width')), parseInt(bgimg.getAttribute('height')));\n\n    this.updateViewBox();\n  }\n\n  /**\n   * Zoom to a certain factor.\n   */\n  zoomTo (k: number): void {\n    this.getViewBox();\n    this.viewBox.zoomTo(k);\n    this.updateViewBox();\n  }\n\n  /**\n   * Translate the view box by relative coordinates.\n   */\n  translate (xDiff: number, yDiff: number): void {\n    this.getViewBox();\n    this.viewBox.translate(xDiff, yDiff);\n    this.updateViewBox();\n  }\n\n  /**\n   * Restore the view box to its position before the editor action.\n   */\n  restoreTransformation (): void {\n    if (this.viewBox === undefined) {\n      this.resetZoomAndPan();\n    } else {\n      this.updateViewBox();\n    }\n  }\n\n  /**\n   * Get the view box from the SVG in the page.\n   */\n  getViewBox (): void {\n    if (this.viewBox === undefined) {\n      const bgimg = document.getElementById('bgimg') as HTMLImageElement;\n      this.viewBox = new ViewBox(parseInt(bgimg.getAttribute('width')), parseInt(bgimg.getAttribute('height')));\n    }\n    const rawViewBox = document.getElementById('svg_group')\n      .getAttribute('viewBox')\n      .split(' ');\n    this.viewBox.set(\n      parseInt(rawViewBox[0]),\n      parseInt(rawViewBox[1]),\n      parseInt(rawViewBox[2]),\n      parseInt(rawViewBox[3])\n    );\n  }\n\n  /**\n   * Update the viewBox attribute of svg_group\n   */\n  updateViewBox (): void {\n    document.getElementById('svg_group').setAttribute('viewBox', this.viewBox.get());\n  }\n\n  startDrag (): void {\n    const group = document.getElementById('svg_group') as unknown as SVGSVGElement;\n    this.dragCoordinates = group.createSVGPoint();\n    if (d3.event.type === 'touchstart') {\n      // If drag is triggered by a touch event\n      this.dragCoordinates.x = d3.event.touches[0].screenX;\n      this.dragCoordinates.y = d3.event.touches[0].screenY;\n    } else {\n      // Otherwise triggered by a mouse click\n      this.dragCoordinates.x = d3.event.x;\n      this.dragCoordinates.y = d3.event.y;\n    }\n\n    this.matrix = group.getScreenCTM().inverse();\n  }\n\n  dragging (): void {\n    const group = document.getElementById('svg_group') as unknown as SVGSVGElement;\n    const newCoordinates = group.createSVGPoint();\n    // Same kind of checking as in startDrag\n    if (d3.event.type === 'touchmove') {\n      newCoordinates.x = d3.event.touches[0].screenX;\n      newCoordinates.y = d3.event.touches[0].screenY;\n    } else if (d3.event.type === 'wheel' && d3.event.shiftKey === false) {\n      if (this.matrix === undefined) {\n        this.matrix = group.getScreenCTM().inverse();\n      }\n      if (this.dragCoordinates === undefined) {\n        this.dragCoordinates = group.createSVGPoint();\n      }\n      this.dragCoordinates.x = d3.event.x;\n      this.dragCoordinates.y = d3.event.y;\n      newCoordinates.x = this.dragCoordinates.x - d3.event.deltaX;\n      newCoordinates.y = this.dragCoordinates.y - d3.event.deltaY;\n      d3.event.preventDefault();\n    } else {\n      newCoordinates.x = d3.event.x;\n      newCoordinates.y = d3.event.y;\n    }\n    const newTransform = newCoordinates.matrixTransform(this.matrix);\n    const dragTransform = this.dragCoordinates.matrixTransform(this.matrix);\n    this.translate(-newTransform.x + dragTransform.x, -newTransform.y + dragTransform.y);\n    this.dragCoordinates = newCoordinates;\n  }\n\n  scrollZoom (): void {\n    if (d3.event.type !== 'wheel') return;\n    if (!d3.event.shiftKey) {\n      this.dragging();\n      return;\n    }\n    const slider = document.getElementById('zoomSlider') as HTMLInputElement;\n    this.getViewBox();\n    const k = this.viewBox.getZoom();\n    let newK = k - d3.event.deltaX / 100;\n    if (newK < parseInt(slider.getAttribute('min')) / 100) newK = 0.25;\n    if (newK > parseInt(slider.getAttribute('max')) / 100) newK = 4;\n    this.zoomTo(newK);\n\n    // Update zoom slider\n    slider.value = (newK * 100).toString();\n    (document.getElementById('zoomOutput') as HTMLOutputElement).value = String(Math.round(newK * 100));\n  }\n}\n\nexport { ZoomHandler as default };\n","/** @module Warnings */\n\n/**\n * Warn when grouped neume components form an unrecognized neume.\n */\nexport function groupingNotRecognized () {\n  if (!(window.confirm('Neon does not recognize this neume grouping. Would you like to create a compound neume?'))) {\n    document.getElementById('undo').click();\n  }\n}\n","import * as Notification from '../utils/Notification';\nimport NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\n\n/** Handle splitting a staff into two staves through Verovio. */\nexport class SplitHandler {\n  readonly neonView: NeonView;\n  readonly staff: SVGGElement;\n\n  constructor (neonView: NeonView, staff: SVGGElement) {\n    this.neonView = neonView;\n    this.staff = staff;\n  }\n\n  startSplit (): void {\n    this.splitDisable();\n\n    document.body.addEventListener('click', this.handler, { capture: true });\n\n    // Handle keypresses\n    document.body.addEventListener('keydown', this.keydownListener);\n    document.body.addEventListener('keyup', this.resetHandler);\n    document.body.addEventListener('click', this.clickawayHandler);\n\n    Notification.queueNotification('Click Where to Split');\n  }\n\n  splitDisable (): void {\n    document.body.removeEventListener('keydown', this.keydownListener);\n    document.body.removeEventListener('keyup', this.resetHandler);\n    document.body.removeEventListener('click', this.clickawayHandler);\n    document.body.removeEventListener('click', this.handler, { capture: true });\n  }\n\n  /** Handle input to split a staff. */\n  handler = ((evt: MouseEvent): void => {\n    const id = this.staff.id;\n\n    const container = this.staff.closest('.definition-scale') as SVGSVGElement;\n    const pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n\n    // Transform to SVG coordinate system.\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGElement)\n      .getScreenCTM().inverse();\n    const cursorPt = pt.matrixTransform(transformMatrix);\n    // Find staff point corresponds to if one exists\n    // TODO\n\n    const editorAction: EditorAction = {\n      'action': 'split',\n      'param': {\n        'elementId': id,\n        'x': cursorPt.x\n      }\n    };\n\n    this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then(async (result) => {\n      if (result) {\n        await this.neonView.updateForCurrentPagePromise();\n      }\n      this.splitDisable();\n    });\n  }).bind(this);\n\n  /** Exits split on Escape press, disables on Shift. */\n  keydownListener = ((evt: KeyboardEvent): void => {\n    if (evt.key === 'Escape') {\n      this.splitDisable();\n    } else if (evt.key === 'Shift') {\n      document.body.removeEventListener('click', this.handler, { capture: true });\n    }\n  }).bind(this);\n\n  /** Exit split if user clicks off of active page. */\n  clickawayHandler = ((evt: MouseEvent): void => {\n    const target = evt.target as HTMLElement;\n    if (target.closest('.active-page') === null) {\n      this.splitDisable();\n      document.body.removeEventListener('click', this.handler, { capture: true });\n    }\n  }).bind(this);\n\n  /** Called to reapply the event listener if necessary. */\n  resetHandler = ((evt: KeyboardEvent): void => {\n    if (evt.key === 'Shift') {\n      document.body.addEventListener('click', this.handler, { capture: true });\n    }\n  }).bind(this);\n}\n"],"sourceRoot":""}